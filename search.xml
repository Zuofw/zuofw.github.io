<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ThreadLoocalåŸç†è§£æ</title>
      <link href="/2024/09/30/51/"/>
      <url>/2024/09/30/51/</url>
      
        <content type="html"><![CDATA[<h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>ThreadLocalå®é™…èµ·ä½œç”¨çš„æ˜¯ThreadLocalå†…éƒ¨çš„ThreadLocalMapç±»ï¼Œå¯¹äºæ¯ä¸€ä¸ªTreadï¼Œéƒ½æœ‰ä¸€ä¸ªThreadLocalMapå±æ€§ï¼Œä»è€Œå®ç°çº¿ç¨‹éš”ç¦»ï¼Œç„¶åsetçš„æ—¶å€™å°±é€šè¿‡è·å–å½“å‰çº¿ç¨‹ç„¶åç»™ä»–çš„ThreadLcoalMapå±æ€§æ·»åŠ å€¼</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span>  <span class="token keyword">class</span> <span class="token class-name">Thread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span><span class="token class-name">ThreadLocal<span class="token punctuation">.</span>ThreadLocalMap</span> threadLocals <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ThreadLocalMap"><a href="#ThreadLocalMap" class="headerlink" title="ThreadLocalMap"></a>ThreadLocalMap</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ThreadLocalMap</span> <span class="token punctuation">{</span>        <span class="token comment">/**       * The entries in this hash map extend WeakReference, using     * its main ref field as the key (which is always a     * ThreadLocal object).  Note that null keys (i.e. entry.get()     * == null) mean that the key is no longer referenced, so the     * entry can be expunged from table.  Such entries are referred to     * as "stale entries" in the code that follows. */</span>     <span class="token comment">// Entryæ˜¯èŠ‚ç‚¹ï¼Œç»§æ‰¿äº†WeakReferentceï¼Œå®šä¹‰äº†ä¸€ä¸ªvalue</span>     <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Entry</span> <span class="token keyword">extends</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ThreadLocal</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>   <span class="token class-name">Object</span> value<span class="token punctuation">;</span>            <span class="token class-name">Entry</span><span class="token punctuation">(</span><span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> k<span class="token punctuation">,</span> <span class="token class-name">Object</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">super</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>                value <span class="token operator">=</span> v<span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// è·å–å½“å‰çº¿ç¨‹</span>        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// é€šè¿‡å½“å‰çº¿ç¨‹è·å–çº¿ç¨‹ä¸­ç»´æŠ¤çš„ThreadLocalMapå¯¹è±¡</span>        <span class="token class-name">ThreadLocalMap</span> map <span class="token operator">=</span> <span class="token function">getMap</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token function">createMap</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¸ºä½•ä½¿ç”¨å¼±å¼•ç”¨"><a href="#ä¸ºä½•ä½¿ç”¨å¼±å¼•ç”¨" class="headerlink" title="ä¸ºä½•ä½¿ç”¨å¼±å¼•ç”¨"></a>ä¸ºä½•ä½¿ç”¨å¼±å¼•ç”¨</h3><p>å› ä¸ºThreadLocalMapçš„keyæ˜¯Threadï¼Œå¦‚æœåƒæ™®é€šçš„key-valueçš„å®šä¹‰ï¼Œåªè¦çº¿ç¨‹æœªé”€æ¯<br>å°±ä¼šä¸€ç›´å­˜åœ¨ï¼Œæ‰€ä»¥ä½¿ç”¨å¼±å¼•ç”¨å°±å¯ä»¥åœ¨ä¸å­˜åœ¨å¼ºå¼•ç”¨çš„æ—¶å€™å°±å°†è¿™ä¸ªé”€æ¯ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥æµ…å‡ºçº¿ç¨‹æ± </title>
      <link href="/2024/09/29/15/"/>
      <url>/2024/09/29/15/</url>
      
        <content type="html"><![CDATA[<p>#todo </p><ul><li><input disabled="" type="checkbox"> çº¿ç¨‹æ± å‚æ•°</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æŒä¸Šå…ˆæœºå‡‰ç»</title>
      <link href="/2024/09/29/08/"/>
      <url>/2024/09/29/08/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MySQLä¸­NULLå€¼æ˜¯å¦ä¼šå½±å“ç´¢å¼•çš„ä½¿ç”¨</title>
      <link href="/2024/09/29/55/"/>
      <url>/2024/09/29/55/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸ºä½•å†™è¿™ä¸€ç¯‡æ–‡ç« "><a href="#ä¸ºä½•å†™è¿™ä¸€ç¯‡æ–‡ç« " class="headerlink" title="ä¸ºä½•å†™è¿™ä¸€ç¯‡æ–‡ç« "></a>ä¸ºä½•å†™è¿™ä¸€ç¯‡æ–‡ç« </h1><p>ğŸ­ğŸ­åœ¨é¢è¯•çš„æ—¶å€™è¢«é—®åˆ°NULLå€¼æ˜¯å¦ä¼šèµ°ç´¢å¼•çš„æ—¶å€™ï¼Œæ„Ÿåˆ°æœ‰ç‚¹ä¸ç†è§£ï¼Œäºæ˜¯äº‹åå°±æœ‰äº†è¿™ç¯‡æ–‡ç« <br>é—®é¢˜ï¼š<br>ä¸ºnameå»ºç«‹ç´¢å¼•ï¼Œnameå¯ä»¥ä¸ºç©º<br><code>select * from user where name is null</code>æ˜¯å¦ä¼šä½¿ç”¨ç´¢å¼•ï¼Ÿ<br>ç”Ÿæ´»ä¼šæ‹·æ‰“æ¯ä¸€ä¸ªåšäº‹ä¸è®¤çœŸçš„äººğŸ˜­</p><h1 id="ç´¢å¼•çš„ç»“æ„"><a href="#ç´¢å¼•çš„ç»“æ„" class="headerlink" title="ç´¢å¼•çš„ç»“æ„"></a>ç´¢å¼•çš„ç»“æ„</h1><p>è¯¦ç»†çš„å¯ä»¥å‚ç…§æˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« æ·±å…¥æµ…å‡ºMySQLï¼Œé‡Œé¢æœ‰å…³äºç´¢å¼•çš„è¯¦ç»†ä»‹ç»<br>åœ¨InnoDBå¼•æ“ä¸­ï¼Œç´¢å¼•åˆ†ä¸ºèšç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•ï¼Œå¯¹äºäºŒçº§ç´¢å¼•ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸‹æˆ‘ä»¬è¦è€ƒè™‘çš„å°±æ˜¯æ˜¯å¦ä¼šä¸ºNULLå»ºç«‹ç´¢å¼•å’Œå¦‚æœåˆ—ä¸­å­˜åœ¨NULLå€¼ï¼Œæ˜¯å¦ä¼šèµ°ç´¢å¼•å»æŸ¥æ‰¾è¿™ä¸ªNULL</p><h1 id="è®¿é—®æ–¹æ³•"><a href="#è®¿é—®æ–¹æ³•" class="headerlink" title="è®¿é—®æ–¹æ³•"></a>è®¿é—®æ–¹æ³•</h1><p>è®¿é—®æ–¹æ³•æ˜¯MySQLæ¥å®é™…è®¿é—®æ•°æ®çš„æ‰§è¡Œæ–¹æ³•<br>å¤§è‡´åˆ†ä¸ºï¼š</p><ol><li>å…¨è¡¨æ‰«æ</li><li>ä½¿ç”¨ç´¢å¼•æ‰«</li></ol><h2 id="æµ‹è¯•è¡¨"><a href="#æµ‹è¯•è¡¨" class="headerlink" title="æµ‹è¯•è¡¨"></a>æµ‹è¯•è¡¨</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE user (                            `id` int(11) NOT NULL AUTO_INCREMENT,                            `name` varchar(20) NOT NULL,                            `age` int(11) DEFAULT NULL,                            `sex` varchar(20) DEFAULT NULL,                            PRIMARY KEY (`id`)  ) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;    INSERT INTO user (`id`, `name`, `age`, `sex`) VALUES ('1', 'Bob', '20', 'ç”·');  INSERT INTO user (`id`, `name`, `age`, `sex`) VALUES ('2', 'Jack', '20', 'ç”·');  INSERT INTO user (`id`, `name`, `age`, `sex`) VALUES ('3', 'Tony', '20', 'ç”·');  INSERT INTO user (`id`, `name`, `age`, `sex`) VALUES ('4', 'Alan', '20', 'ç”·');    CREATE  UNIQUE  INDEX indexName ON user(name(20));  # ä¸ºageå»ºç«‹ç´¢å¼•  CREATE INDEX indexAge ON user(age);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="const"><a href="#const" class="headerlink" title="const"></a>const</h2><p>é€šè¿‡ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—æ¥å®šä½ä¸€æ¡è®°å½•çš„è®¿é—®æ–¹æ³•<br><code>explain select * from user where id = 1;</code><br>è§£å†³å¦‚ä¸‹ï¼š<br><img src="/2024/09/29/55/const.png" alt="|1150"><br>é€šè¿‡typeæˆ‘ä»¬å¯ä»¥çœ‹è§è®¿é—®æ–¹æ³•æ˜¯const</p><h2 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h2><p>å¦‚æœäºŒçº§ç´¢å¼•åˆ—ä¸æ˜¯å”¯ä¸€çš„ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨äºŒçº§ç´¢å¼•çš„å€¼å»åŒ¹é…ï¼Œä¹‹åå†å›è¡¨<br><img src="/2024/09/29/55/ref.png"><br><code>explain select * from user where age = 20;</code><br><img src="/2024/09/29/55/ref-result.png"><br>å¦‚å›¾ä½¿ç”¨çš„æ˜¯refæ–¹æ³•<br><strong>äºŒçº§ç´¢å¼•åˆ—å€¼ä¸ºNULLæ—¶</strong>ï¼š<br>äºŒçº§ç´¢å¼•åˆ—å¯¹NULLå€¼çš„æ•°é‡æ—¶ä¸é™åˆ¶çš„ï¼Œæ‰€ä»¥key is NULLæœ€å¤šä½¿ç”¨çš„æ˜¯refï¼Œè€Œä¸æ˜¯const</p><h2 id="ref-or-null"><a href="#ref-or-null" class="headerlink" title="ref_or_null"></a>ref_or_null</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æ‰¾å‡ºäºŒçº§ç´¢å¼•ç­‰äºå¸¸æ•°å’Œä¸ºNULLçš„è®°å½•ä¸€åŒæ‰¾å‡º<br><code>explain select * from user where age = 20 or age is null ;</code><br><img src="/2024/09/29/55/ref_or_null-result.png"><br>æ‰§è¡Œçš„æµç¨‹ï¼š<br>å¦‚å›¾ï¼ŒNULLæ˜¯æ”¾åœ¨æ¯ä¸€å±‚ä¸­æœ€å·¦ä¾§çš„ï¼Œå¹¶ä¸”æ˜¯è¿åœ¨ä¸€èµ·çš„<br><img src="/2024/09/29/55/ref_or_null.png"></p><h2 id="range"><a href="#range" class="headerlink" title="range"></a>range</h2><p>ä½¿ç”¨ç´¢å¼•è¿›è¡ŒèŒƒå›´è®¿é—®ï¼Œå¯ä»¥æ˜¯èšç°‡ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥æ˜¯äºŒçº§ç´¢å¼•ã€‚<br><code>explain select * from user where age &gt; 11 and age &lt;= 20;</code><br><img src="/2024/09/29/55/range.png"></p><h2 id="index"><a href="#index" class="headerlink" title="index"></a>index</h2><p>éå†äºŒçº§ç´¢å¼•è®°å½•çš„æ‰§è¡Œæ–¹å¼ï¼Œå¸¸å¸¸å‡ºç°åœ¨æŸ¥è¯¢åˆ—å’Œæ¡ä»¶éƒ½åŒ…å«åœ¨ç´¢å¼•ä¸­ï¼Œä¸éœ€è¦å›è¡¨ï¼Œæ‰€ä»¥ç›´æ¥éå†å³å¯</p><h2 id="all"><a href="#all" class="headerlink" title="all"></a>all</h2><p>å…¨è¡¨æ‰«æ</p><h1 id="NULLåœ¨äºŒçº§ç´¢å¼•ä¸­çš„ä½ç½®"><a href="#NULLåœ¨äºŒçº§ç´¢å¼•ä¸­çš„ä½ç½®" class="headerlink" title="NULLåœ¨äºŒçº§ç´¢å¼•ä¸­çš„ä½ç½®"></a>NULLåœ¨äºŒçº§ç´¢å¼•ä¸­çš„ä½ç½®</h1><p>é€šè¿‡æŸ¥è¯¢èµ„æ–™ï¼Œå‘ç°å¦‚æœç´¢å¼•åˆ—å…è®¸NULLå€¼ï¼Œé‚£ä¹ˆNULLåœ¨äºŒçº§ç´¢å¼•ä¸­æ˜¯è¢«å½“ä½œæœ€å°å€¼æ”¾åœ¨æ ‘çš„æ¯ä¸€å±‚çš„æœ€å·¦ä¾§çš„ï¼Œä¹Ÿå°±æ˜¯NULLå€¼ä¼šè¢«å½“æˆç´¢å¼•åˆ—çš„æ•°æ®ä½¿ç”¨çš„ï¼Œæ‰€ä»¥NULLå€¼åŒ¹é…æ˜¯å¯èƒ½ä¼šèµ°ç´¢å¼•çš„</p><ol><li>å¦‚æœåœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨IS NULLæˆ–IS NOT NULLï¼ŒMySQLé€šå¸¸ä¼šèµ°ç´¢å¼•<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// typeä¸ºrefï¼Œæ‰€ä»¥èµ°ç´¢å¼•äº†</span>explain select <span class="token operator">*</span> from user where age is <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token comment">// typeä¸ºrangeï¼Œæ‰€ä»¥èµ°ç´¢å¼•äº†</span>explain select <span class="token operator">*</span> from user where age is not <span class="token keyword">null</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li>ç¬¦åˆç´¢å¼•ï¼Œå¦‚æœç­¾åˆ°åˆ—ä¸ä¸ºNULLï¼Œåç»­çš„åˆ—ä¹Ÿæ˜¯å¯ä»¥èµ°ç´¢å¼•çš„</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HashMapæºç åˆ†æä¸å¸¸è§å…«è‚¡</title>
      <link href="/2024/09/28/24/"/>
      <url>/2024/09/28/24/</url>
      
        <content type="html"><![CDATA[<h1 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h1><h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><h3 id="åŸºæœ¬å±æ€§-é˜ˆå€¼-amp-ç³»æ•°-amp-å®¹é‡"><a href="#åŸºæœ¬å±æ€§-é˜ˆå€¼-amp-ç³»æ•°-amp-å®¹é‡" class="headerlink" title="åŸºæœ¬å±æ€§(é˜ˆå€¼&amp;ç³»æ•°&amp;å®¹é‡)"></a>åŸºæœ¬å±æ€§(é˜ˆå€¼&amp;ç³»æ•°&amp;å®¹é‡)</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>    <span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span><span class="token comment">// åºåˆ—å·</span>    <span class="token annotation punctuation">@java.io.Serial</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">362498820763181265L</span><span class="token punctuation">;</span><span class="token comment">// é»˜è®¤å®¹é‡ï¼Œä¹Ÿå°±æ˜¯ 16</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">/** * æœ€å¤§å®¹é‡ï¼Œå¦‚æœé€šè¿‡æ„é€ å‡½æ•°éšå¼æŒ‡å®šäº†æ›´é«˜çš„å€¼ï¼Œåˆ™ä½¿ç”¨æ­¤å€¼ã€‚ * å¿…é¡»æ˜¯2çš„å¹‚ä¸” &lt;= 1&lt;&lt;30ã€‚ * ä¹Ÿå°±æ˜¯æœ€å¤§å®¹é‡æ˜¯ 2^30 */</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span><span class="token comment">/** * æ„é€ å‡½æ•°æœªæŒ‡å®šæ—¶ä½¿ç”¨çš„è´Ÿè½½å› å­ã€‚ */</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span> <span class="token operator">=</span> <span class="token number">0.75f</span><span class="token punctuation">;</span><span class="token comment">// å½“æ¡¶ä¸Šçš„èŠ‚ç‚¹æ•°&gt;=è¿™ä¸ªå€¼æ—¶ä¼šè½¬åŒ–ä¸ºçº¢é»‘æ ‘</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">TREEIFY_THRESHOLD</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span><span class="token comment">// å½“æ¡¶ä¸Šçš„èŠ‚ç‚¹æ•°å°äºè¿™ä¸ªå€¼æ—¶ä¼šè½¬åŒ–ä¸ºé“¾è¡¨</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">UNTREEIFY_THRESHOLD</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span><span class="token comment">// è½¬åŒ–ä¸ºçº¢é»‘æ ‘å¯¹åº”çš„æ‰€éœ€è¦çš„æœ€å°çš„æ•°ç»„å®¹é‡</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MIN_TREEIFY_CAPACITY</span> <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">;</span><span class="token comment">// å­˜å‚¨å…ƒç´ çš„æ•°ç»„ï¼Œå®¹é‡æ€»æ˜¯2çš„å¹‚æ¬¡å€</span><span class="token keyword">transient</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> table<span class="token punctuation">;</span><span class="token comment">// transientç”¨äºæ ‡è¯†è¿™ä¸ªå­—æ®µä¸åº”è¯¥è¢«åºåˆ—åŒ–</span><span class="token keyword">transient</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> entrySet<span class="token punctuation">;</span><span class="token comment">// å­˜æ”¾å…ƒç´ çš„ä¸ªæ•°ï¼Œ</span><span class="token keyword">transient</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span><span class="token comment">// æ¯æ¬¡æ‰©å®¹å’Œæ›´æ”¹mapç»“æ„çš„è®¡æ•°å™¨</span><span class="token comment">/** 1.æ£€æµ‹å¹¶å‘ä¿®æ”¹ï¼šåœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œå¦‚æœ modCount å‘ç”Ÿå˜åŒ–ï¼Œè¿­ä»£å™¨ä¼šæŠ›å‡º ConcurrentModificationExceptionï¼Œä»¥é˜²æ­¢å¹¶å‘ä¿®æ”¹å¯¼è‡´çš„ä¸ä¸€è‡´æ€§ã€‚2.ç»´æŠ¤å†…éƒ¨çŠ¶æ€ï¼šåœ¨æŸäº›æ“ä½œï¼ˆå¦‚æ’å…¥ã€åˆ é™¤ã€æ‰©å®¹ï¼‰ä¸­ï¼ŒmodCount ä¼šå¢åŠ ï¼Œä»¥ç¡®ä¿ HashMap çš„å†…éƒ¨çŠ¶æ€ä¿æŒä¸€è‡´*/</span><span class="token keyword">transient</span> <span class="token keyword">int</span> modCount<span class="token punctuation">;</span><span class="token comment">// é˜ˆå€¼(å®¹é‡*è´Ÿè½½å› å­) å½“å®é™…å¤§å°è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œä¼šè¿›è¡Œæ‰©å®¹</span><span class="token keyword">int</span> threshold<span class="token punctuation">;</span><span class="token comment">// è´Ÿè½½å› å­</span><span class="token keyword">final</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="loadFactorè´Ÿè½½å› å­"><a href="#loadFactorè´Ÿè½½å› å­" class="headerlink" title="loadFactorè´Ÿè½½å› å­"></a>loadFactorè´Ÿè½½å› å­</h4><p>è´Ÿè½½å› å­æ˜¯æ§åˆ¶æ•°ç»„å­˜æ”¾æ•°æ®çš„ç–å¯†ç¨‹åº¦ï¼ŒloadFactorè¶Šæ¥è¿‘1ï¼Œé‚£ä¹ˆæ•°ç»„ä¸­å­˜æ”¾çš„æ•°æ®(entry)ä¹Ÿå°±è¶Šå¤š,å¦åˆ™å°±è¶Šå°‘ã€‚<br>å¤ªå¤§æŸ¥æ‰¾å…ƒç´ çš„æ•ˆç‡ä½ï¼Œå¤ªå°åˆ©ç”¨ç‡å¤ªä½<br>æ‰€ä»¥é»˜è®¤ 16 * 0.75 = 12ï¼Œè¶…è¿‡è¿™ä¸ªæ•°æ®é‡æ—¶ï¼Œå°±ä¼šè¿›è¡Œæ‰©å®¹</p><h4 id="threshold"><a href="#threshold" class="headerlink" title="threshold"></a>threshold</h4><p>threshold = capacity * loadFacotryï¼Œæ˜¯æ•°ç»„æ‰©å®¹çš„æ ‡å‡†<br>å› ä¸ºhashmapä¸­æ²¡æœ‰capacityè¿™ä¸ªå±æ€§ï¼Œæ‰€ä»¥å³ä½¿æŒ‡å®šäº†åˆå§‹åŒ–çš„capacityï¼Œä¹Ÿä¼šè¢«æ‰©å®¹åˆ°2çš„æœ€æ¥è¿‘è¿™ä¸ªå¤§å°çš„å¹‚æ¬¡æ–¹</p><h3 id="Node-èŠ‚ç‚¹ç±»æºç "><a href="#Node-èŠ‚ç‚¹ç±»æºç " class="headerlink" title="Node èŠ‚ç‚¹ç±»æºç "></a>Node èŠ‚ç‚¹ç±»æºç </h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ç»§æ‰¿Map.Entry&lt;K,V&gt;</span><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>  <span class="token comment">// hashå€¼ï¼Œå­˜æ”¾å…ƒç´ åˆ°hashmapæ—¶ç”¨æ¥ä¸å…¶ä»–å…ƒç´ è¿›è¡Œæ¯”è¾ƒ</span>    <span class="token keyword">final</span> <span class="token keyword">int</span> hash<span class="token punctuation">;</span>      <span class="token keyword">final</span> <span class="token class-name">K</span> key<span class="token punctuation">;</span>      <span class="token class-name">V</span> value<span class="token punctuation">;</span>  <span class="token comment">// æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span>    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> next<span class="token punctuation">;</span>        <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>hash <span class="token operator">=</span> hash<span class="token punctuation">;</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">K</span> <span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span> <span class="token keyword">return</span> key<span class="token punctuation">;</span> <span class="token punctuation">}</span>      <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span> <span class="token keyword">return</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>      <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> key <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token class-name">V</span> newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token class-name">V</span> oldValue <span class="token operator">=</span> value<span class="token punctuation">;</span>          value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>          <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">)</span>              <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> o <span class="token keyword">instanceof</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> e                  <span class="token operator">&amp;&amp;</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                  <span class="token operator">&amp;&amp;</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ ‘èŠ‚ç‚¹æºç "><a href="#æ ‘èŠ‚ç‚¹æºç " class="headerlink" title="æ ‘èŠ‚ç‚¹æºç "></a>æ ‘èŠ‚ç‚¹æºç </h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ä»…æˆªå–éƒ¨åˆ†æºç </span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">LinkedHashMap<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>      <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> parent<span class="token punctuation">;</span>  <span class="token comment">// çˆ¶</span>    <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> left<span class="token punctuation">;</span>    <span class="token comment">// å·¦</span>    <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> right<span class="token punctuation">;</span>   <span class="token comment">// å³ </span>    <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> prev<span class="token punctuation">;</span>    <span class="token comment">// needed to unlink next upon deletion  </span>    <span class="token keyword">boolean</span> red<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="hashæ–¹æ³•"><a href="#hashæ–¹æ³•" class="headerlink" title="hashæ–¹æ³•"></a>hashæ–¹æ³•</h3><h3 id="put"><a href="#put" class="headerlink" title="put"></a>put</h3><p>putæ–¹æ³•å®é™…å°±æ˜¯è°ƒç”¨putValï¼Œå¹¶ä¸”putValç”¨æˆ·ä¸å¯ç›´æ¥ä½¿ç”¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">,</span>               <span class="token keyword">boolean</span> evict<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> p<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> i<span class="token punctuation">;</span>    <span class="token comment">// å¦‚æœè¡¨ä¸ºç©ºæˆ–é•¿åº¦ä¸º0ï¼Œåˆ™è¿›è¡Œåˆå§‹åŒ–æˆ–æ‰©å®¹</span>    <span class="token comment">// å°†å±æ€§ä¸­çš„tableèµ‹å€¼ï¼Œå¹¶ä¸”åˆ¤æ–­æ˜¯å¦ä¸ºç©ºæˆ–è€…é•¿åº¦ä¸º0ï¼Œå¦‚æœæ˜¯å°±è¿›è¡Œåˆå§‹åŒ–æˆ–è€…æ‰©å®¹</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token comment">// resize()å‡½æ•°å°±æ˜¯è¿›è¡Œæ‰©å®¹æˆ–è€…åˆå§‹åŒ–</span>        n <span class="token operator">=</span> <span class="token punctuation">(</span>tab <span class="token operator">=</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token comment">// è®¡ç®—ç´¢å¼•ä½ç½®ï¼Œå¦‚æœå½“å‰ä½ç½®ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ’å…¥æ–°èŠ‚ç‚¹</span>    <span class="token comment">// (n - 1) &amp; hash ç¡®å®šå…ƒç´ æ”¾åœ¨å“ªä¸ªæ¡¶é‡Œï¼Œæ¡¶ä¸ºç©ºï¼Œæ–°ç”ŸæˆèŠ‚ç‚¹æ”¾å…¥æ•°ç»„ä¸­</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> tab<span class="token punctuation">[</span>i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>        tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e<span class="token punctuation">;</span> <span class="token class-name">K</span> k<span class="token punctuation">;</span>        <span class="token comment">// å¦‚æœå½“å‰ä½ç½®çš„èŠ‚ç‚¹çš„å“ˆå¸Œå€¼å’Œé”®éƒ½ç›¸ç­‰ï¼Œåˆ™ç›´æ¥è¦†ç›–</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> p<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            e <span class="token operator">=</span> p<span class="token punctuation">;</span>        <span class="token comment">// å¦‚æœæ˜¯æ ‘èŠ‚ç‚¹ï¼Œåˆ™è°ƒç”¨æ ‘èŠ‚ç‚¹çš„æ’å…¥æ–¹æ³•</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>            e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> tab<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token comment">// éå†é“¾è¡¨ï¼ŒæŸ¥æ‰¾æ’å…¥ä½ç½®æˆ–ç›¸åŒé”®çš„èŠ‚ç‚¹</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    p<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// å¦‚æœé“¾è¡¨é•¿åº¦è¾¾åˆ°é˜ˆå€¼ï¼Œåˆ™è½¬æ¢ä¸ºæ ‘ç»“æ„</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">&gt;=</span> <span class="token constant">TREEIFY_THRESHOLD</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// -1 for 1st</span>                        <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment">// å¦‚æœæ‰¾åˆ°ç›¸åŒé”®çš„èŠ‚ç‚¹ï¼Œåˆ™è·³å‡ºå¾ªç¯</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>                    <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                p <span class="token operator">=</span> e<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment">// å¦‚æœæ‰¾åˆ°ç›¸åŒé”®çš„èŠ‚ç‚¹ï¼Œåˆ™æ›´æ–°å€¼</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// existing mapping for key</span>            <span class="token class-name">V</span> oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent <span class="token operator">||</span> oldValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>                e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>            <span class="token function">afterNodeAccess</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// ä¿®æ”¹è®¡æ•°å™¨</span>    <span class="token operator">++</span>modCount<span class="token punctuation">;</span>    <span class="token comment">// å¦‚æœå¤§å°è¶…è¿‡é˜ˆå€¼ï¼Œåˆ™è¿›è¡Œæ‰©å®¹</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>size <span class="token operator">&gt;</span> threshold<span class="token punctuation">)</span>        <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">afterNodeInsertion</span><span class="token punctuation">(</span>evict<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŸºæœ¬é€»è¾‘ï¼š</p><ol><li>å¦‚æœå®šä½åˆ°çš„æ•°ç»„ä½ç½®æ²¡æœ‰å…ƒç´ ï¼Œåˆ™ç›´æ¥æ’å…¥</li><li>å¦‚æœæœ‰å…ƒç´ ï¼Œå°±è¦ä¸æ’å…¥çš„keyè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒï¼Œå°±è¦†ç›–ã€‚å¦‚æœä¸åŒå°±åˆ¤æ–­pæ˜¯å¦æ˜¯æ ‘èŠ‚ç‚¹ï¼Œå¦‚æœä¸æ˜¯å°±ç›´æ¥éå†é“¾è¡¨æ’å…¥ï¼Œä½¿ç”¨å°¾æ’æ³•ï¼Œå¦åˆ™è°ƒç”¨putTreeValå‡½æ•°</li></ol><h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>e <span class="token operator">=</span> <span class="token function">getNode</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">getNode</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> first<span class="token punctuation">,</span> e<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> hash<span class="token punctuation">;</span> <span class="token class-name">K</span> k<span class="token punctuation">;</span>    <span class="token comment">// æ£€æŸ¥è¡¨æ˜¯å¦ä¸ºç©ºä¸”é•¿åº¦å¤§äº0ï¼Œå¹¶è®¡ç®—å“ˆå¸Œå€¼å’Œç´¢å¼•</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>        <span class="token punctuation">(</span>first <span class="token operator">=</span> tab<span class="token punctuation">[</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>hash <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// æ£€æŸ¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦åŒ¹é…</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>first<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span> <span class="token comment">// å§‹ç»ˆæ£€æŸ¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> first<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> first<span class="token punctuation">;</span>        <span class="token comment">// éå†é“¾è¡¨æˆ–æ ‘èŠ‚ç‚¹</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> first<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>first <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>first<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTreeNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">do</span> <span class="token punctuation">{</span>                <span class="token comment">// æ£€æŸ¥é“¾è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹æ˜¯å¦åŒ¹é…</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>                    <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span> e<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œè¿”å›null</span>    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="resize"><a href="#resize" class="headerlink" title="resize"></a>resize</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> oldTab <span class="token operator">=</span> table<span class="token punctuation">;</span> <span class="token comment">// æ—§çš„å“ˆå¸Œè¡¨</span>    <span class="token keyword">int</span> oldCap <span class="token operator">=</span> <span class="token punctuation">(</span>oldTab <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> oldTab<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// æ—§çš„å®¹é‡</span>    <span class="token keyword">int</span> oldThr <span class="token operator">=</span> threshold<span class="token punctuation">;</span> <span class="token comment">// æ—§çš„é˜ˆå€¼</span>    <span class="token keyword">int</span> newCap<span class="token punctuation">,</span> newThr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// æ–°çš„å®¹é‡å’Œé˜ˆå€¼</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ—§çš„å®¹é‡å¤§äº0</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">&gt;=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ—§çš„å®¹é‡å·²ç»è¾¾åˆ°æœ€å¤§å®¹é‡</span>            threshold <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span> <span class="token comment">// å°†é˜ˆå€¼è®¾ä¸ºæœ€å¤§æ•´æ•°å€¼</span>            <span class="token keyword">return</span> oldTab<span class="token punctuation">;</span> <span class="token comment">// è¿”å›æ—§çš„å“ˆå¸Œè¡¨</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>newCap <span class="token operator">=</span> oldCap <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">&amp;&amp;</span> oldCap <span class="token operator">&gt;=</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">)</span>            newThr <span class="token operator">=</span> oldThr <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// å°†å®¹é‡å’Œé˜ˆå€¼éƒ½ç¿»å€</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldThr <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// å¦‚æœæ—§çš„é˜ˆå€¼å¤§äº0</span>        newCap <span class="token operator">=</span> oldThr<span class="token punctuation">;</span> <span class="token comment">// å°†æ–°çš„å®¹é‡è®¾ä¸ºæ—§çš„é˜ˆå€¼</span>    <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ—§çš„é˜ˆå€¼ä¸º0ï¼Œä½¿ç”¨é»˜è®¤å€¼</span>        newCap <span class="token operator">=</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">;</span> <span class="token comment">// é»˜è®¤åˆå§‹å®¹é‡</span>        newThr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_LOAD_FACTOR</span> <span class="token operator">*</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é»˜è®¤é˜ˆå€¼</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>newThr <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ–°çš„é˜ˆå€¼ä¸º0</span>        <span class="token keyword">float</span> ft <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>newCap <span class="token operator">*</span> loadFactor<span class="token punctuation">;</span> <span class="token comment">// è®¡ç®—æ–°çš„é˜ˆå€¼</span>        newThr <span class="token operator">=</span> <span class="token punctuation">(</span>newCap <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">&amp;&amp;</span> ft <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ft <span class="token operator">:</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    threshold <span class="token operator">=</span> newThr<span class="token punctuation">;</span> <span class="token comment">// æ›´æ–°é˜ˆå€¼</span>    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"rawtypes"</span><span class="token punctuation">,</span><span class="token string">"unchecked"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">[</span>newCap<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºæ–°çš„å“ˆå¸Œè¡¨</span>    table <span class="token operator">=</span> newTab<span class="token punctuation">;</span> <span class="token comment">// æ›´æ–°å“ˆå¸Œè¡¨å¼•ç”¨</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldTab <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ—§çš„å“ˆå¸Œè¡¨ä¸ä¸ºç©º</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> oldCap<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// éå†æ—§çš„å“ˆå¸Œè¡¨</span>            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ—§è¡¨ä¸­çš„æ¡¶ä¸ä¸ºç©º</span>                oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// æ¸…ç©ºæ—§è¡¨ä¸­çš„æ¡¶</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>next <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// å¦‚æœæ¡¶ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹</span>                    newTab<span class="token punctuation">[</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> <span class="token punctuation">(</span>newCap <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span> <span class="token comment">// ç›´æ¥æ”¾å…¥æ–°è¡¨</span>                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span> <span class="token comment">// å¦‚æœæ¡¶ä¸­æ˜¯æ ‘èŠ‚ç‚¹</span>                    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> newTab<span class="token punctuation">,</span> j<span class="token punctuation">,</span> oldCap<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‹†åˆ†æ ‘èŠ‚ç‚¹</span>                <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ¡¶ä¸­æ˜¯é“¾è¡¨èŠ‚ç‚¹</span>                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> loHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> loTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// ä½ä½é“¾è¡¨çš„å¤´å’Œå°¾</span>                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> hiHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> hiTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// é«˜ä½é“¾è¡¨çš„å¤´å’Œå°¾</span>                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> next<span class="token punctuation">;</span>                    <span class="token keyword">do</span> <span class="token punctuation">{</span>                        next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> oldCap<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ä½ä½é“¾è¡¨</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>                                loHead <span class="token operator">=</span> e<span class="token punctuation">;</span>                            <span class="token keyword">else</span>                                loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span>                            loTail <span class="token operator">=</span> e<span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// é«˜ä½é“¾è¡¨</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>                                hiHead <span class="token operator">=</span> e<span class="token punctuation">;</span>                            <span class="token keyword">else</span>                                hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span>                            hiTail <span class="token operator">=</span> e<span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                        newTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> loHead<span class="token punctuation">;</span> <span class="token comment">// æ”¾å…¥ä½ä½é“¾è¡¨</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                        newTab<span class="token punctuation">[</span>j <span class="token operator">+</span> oldCap<span class="token punctuation">]</span> <span class="token operator">=</span> hiHead<span class="token punctuation">;</span> <span class="token comment">// æ”¾å…¥é«˜ä½é“¾è¡¨</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> newTab<span class="token punctuation">;</span> <span class="token comment">// è¿”å›æ–°çš„å“ˆå¸Œè¡¨</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h2><h2 id="JDK1-7"><a href="#JDK1-7" class="headerlink" title="JDK1.7"></a>JDK1.7</h2><p>JDK1.7ä¸­ï¼ŒConcurrentHashMapæ˜¯ç”±å¤šä¸ªSegmentç»„åˆï¼Œè€Œæ¯ä¸€ä¸ªSegmentéƒ½æ˜¯ä¸€ä¸ªç±»ä¼¼äºHashMapçš„ç»“æ„ï¼Œå¯ä»¥å†…éƒ¨è¿›è¡Œæ‰©å®¹ï¼Œä½†æ˜¯Segmentçš„ä¸ªæ•°ä¸€æ—¦åˆå§‹åŒ–å°±ä¸èƒ½æ”¹å˜äº†ã€‚é»˜è®¤æ”¯æŒ16ä¸ªï¼Œä¹Ÿå°±æ˜¯é»˜è®¤æ”¯æŒ16ä¸ªçº¿ç¨‹å¹¶å‘<img src="/2024/09/28/24/jdk1.7concurrent.png"></p><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>æ— å‚æ„é€ ä¸­è°ƒç”¨äº†æœ‰å‚æ„é€ ï¼Œä¼ å…¥ä¸‰ä¸ªé»˜è®¤å€¼</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * é»˜è®¤åˆå§‹åŒ–å®¹é‡ */</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span> <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span><span class="token comment">/** * é»˜è®¤è´Ÿè½½å› å­ */</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span> <span class="token operator">=</span> <span class="token number">0.75f</span><span class="token punctuation">;</span><span class="token comment">/** * é»˜è®¤å¹¶å‘çº§åˆ« */</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_CONCURRENCY_LEVEL</span> <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆå§‹åŒ–é€»è¾‘</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">ConcurrentHashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span><span class="token keyword">float</span> loadFactor<span class="token punctuation">,</span> <span class="token keyword">int</span> concurrencyLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// å‚æ•°æ ¡éªŒ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>loadFactor <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> initialCapacity <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> concurrencyLevel <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ ¡éªŒå¹¶å‘çº§åˆ«å¤§å°ï¼Œå¤§äº 1&lt;&lt;16ï¼Œé‡ç½®ä¸º 65536</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>concurrencyLevel <span class="token operator">&gt;</span> <span class="token constant">MAX_SEGMENTS</span><span class="token punctuation">)</span>        concurrencyLevel <span class="token operator">=</span> <span class="token constant">MAX_SEGMENTS</span><span class="token punctuation">;</span>    <span class="token comment">// Find power-of-two sizes best matching arguments</span>    <span class="token comment">// 2çš„å¤šå°‘æ¬¡æ–¹</span>    <span class="token keyword">int</span> sshift <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> ssize <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">// è¿™ä¸ªå¾ªç¯å¯ä»¥æ‰¾åˆ° concurrencyLevel ä¹‹ä¸Šæœ€è¿‘çš„ 2çš„æ¬¡æ–¹å€¼</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>ssize <span class="token operator">&lt;</span> concurrencyLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token operator">++</span>sshift<span class="token punctuation">;</span>        ssize <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// è®°å½•æ®µåç§»é‡</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>segmentShift <span class="token operator">=</span> <span class="token number">32</span> <span class="token operator">-</span> sshift<span class="token punctuation">;</span>    <span class="token comment">// è®°å½•æ®µæ©ç </span>    <span class="token keyword">this</span><span class="token punctuation">.</span>segmentMask <span class="token operator">=</span> ssize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">// è®¾ç½®å®¹é‡</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">&gt;</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span>        initialCapacity <span class="token operator">=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">;</span>    <span class="token comment">// c = å®¹é‡ / ssize ï¼Œé»˜è®¤ 16 / 16 = 1ï¼Œè¿™é‡Œæ˜¯è®¡ç®—æ¯ä¸ª Segment ä¸­çš„ç±»ä¼¼äº HashMap çš„å®¹é‡</span>    <span class="token keyword">int</span> c <span class="token operator">=</span> initialCapacity <span class="token operator">/</span> ssize<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">*</span> ssize <span class="token operator">&lt;</span> initialCapacity<span class="token punctuation">)</span>        <span class="token operator">++</span>c<span class="token punctuation">;</span>    <span class="token keyword">int</span> cap <span class="token operator">=</span> <span class="token constant">MIN_SEGMENT_TABLE_CAPACITY</span><span class="token punctuation">;</span>    <span class="token comment">//Segment ä¸­çš„ç±»ä¼¼äº HashMap çš„å®¹é‡è‡³å°‘æ˜¯2æˆ–è€…2çš„å€æ•°</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>cap <span class="token operator">&lt;</span> c<span class="token punctuation">)</span>        cap <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">// create segments and segments[0]</span>    <span class="token comment">// åˆ›å»º Segment æ•°ç»„ï¼Œè®¾ç½® segments[0]</span>    <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> s0 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>loadFactor<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>cap <span class="token operator">*</span> loadFactor<span class="token punctuation">)</span><span class="token punctuation">,</span>                         <span class="token punctuation">(</span><span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">HashEntry</span><span class="token punctuation">[</span>cap<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> ss <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Segment</span><span class="token punctuation">[</span>ssize<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">putOrderedObject</span><span class="token punctuation">(</span>ss<span class="token punctuation">,</span> <span class="token constant">SBASE</span><span class="token punctuation">,</span> s0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ordered write of segments[0]</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>segments <span class="token operator">=</span> ss<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>æ ¡éªŒå¹¶å‘ç­‰çº§å¤§å°ï¼Œå¦‚æœå¤§äºæœ€å¤§å€¼ï¼Œå°±é‡ç½®ä¸ºæœ€å¤§å€¼</li><li>åˆå§‹åŒ–å®¹é‡ä¸ºå¤§äºå¹¶å‘ç­‰çº§æœ€è¿‘çš„2çš„å¹‚æ¬¡æ–¹ï¼Œé»˜è®¤16</li><li>è®°å½•segmentShiftåç§»é‡ï¼Œ2^n ä¸­çš„nï¼Œé»˜è®¤ä¸º32 - sshift = 28  </li><li>è®°å½•segmentMaskï¼Œé»˜è®¤æ˜¯ssize - 1 = 16 - 1 = 15</li><li>åˆå§‹åŒ–<code>segment[0]</code>ï¼Œé»˜è®¤å¤§å°ä¸º2ï¼Œæ‰©å®¹é˜ˆå€¼ä¸º 2 * 0.75 = 1.5ã€‚æ’å…¥ç¬¬äºŒä¸ªå€¼æ—¶æ‰ä¼šè¿›è¡Œæ‰©å®¹</li></ol><h3 id="put-1"><a href="#put-1" class="headerlink" title="put"></a>put</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * Maps the specified key to the specified value in this table. * Neither the key nor the value can be null. * * &lt;p&gt; The value can be retrieved by calling the &lt;tt&gt;get&lt;/tt&gt; method * with a key that is equal to the original key. * * @param key key with which the specified value is to be associated * @param value value to be associated with the specified key * @return the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or *         &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt; * @throws NullPointerException if the specified key or value is null */</span><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> s<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// hash å€¼æ— ç¬¦å·å³ç§» 28ä½ï¼ˆåˆå§‹åŒ–æ—¶è·å¾—ï¼‰ï¼Œç„¶åä¸ segmentMask=15 åšä¸è¿ç®—</span>    <span class="token comment">// å…¶å®ä¹Ÿå°±æ˜¯æŠŠé«˜4ä½ä¸segmentMaskï¼ˆ1111ï¼‰åšä¸è¿ç®—</span>    <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token punctuation">(</span>hash <span class="token operator">&gt;&gt;&gt;</span> segmentShift<span class="token punctuation">)</span> <span class="token operator">&amp;</span> segmentMask<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token constant">UNSAFE</span><span class="token punctuation">.</span>getObject          <span class="token comment">// nonvolatile; recheck</span>         <span class="token punctuation">(</span>segments<span class="token punctuation">,</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;&lt;</span> <span class="token constant">SSHIFT</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">SBASE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">//  in ensureSegment</span>        <span class="token comment">// å¦‚æœæŸ¥æ‰¾åˆ°çš„ Segment ä¸ºç©ºï¼Œåˆå§‹åŒ–</span>        s <span class="token operator">=</span> <span class="token function">ensureSegment</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/** * Returns the segment for the given index, creating it and * recording in segment table (via CAS) if not already present. * * @param k the index * @return the segment */</span><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">ensureSegment</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">final</span> <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> ss <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>segments<span class="token punctuation">;</span>    <span class="token keyword">long</span> u <span class="token operator">=</span> <span class="token punctuation">(</span>k <span class="token operator">&lt;&lt;</span> <span class="token constant">SSHIFT</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">SBASE</span><span class="token punctuation">;</span> <span class="token comment">// raw offset</span>    <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> seg<span class="token punctuation">;</span>    <span class="token comment">// åˆ¤æ–­ u ä½ç½®çš„ Segment æ˜¯å¦ä¸ºnull</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>seg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">getObjectVolatile</span><span class="token punctuation">(</span>ss<span class="token punctuation">,</span> u<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> proto <span class="token operator">=</span> ss<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// use segment 0 as prototype</span>        <span class="token comment">// è·å–0å· segment é‡Œçš„ HashEntry&lt;K,V&gt; åˆå§‹åŒ–é•¿åº¦</span>        <span class="token keyword">int</span> cap <span class="token operator">=</span> proto<span class="token punctuation">.</span>table<span class="token punctuation">.</span>length<span class="token punctuation">;</span>        <span class="token comment">// è·å–0å· segment é‡Œçš„ hash è¡¨é‡Œçš„æ‰©å®¹è´Ÿè½½å› å­ï¼Œæ‰€æœ‰çš„ segment çš„ loadFactor æ˜¯ç›¸åŒçš„</span>        <span class="token keyword">float</span> lf <span class="token operator">=</span> proto<span class="token punctuation">.</span>loadFactor<span class="token punctuation">;</span>        <span class="token comment">// è®¡ç®—æ‰©å®¹é˜€å€¼</span>        <span class="token keyword">int</span> threshold <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>cap <span class="token operator">*</span> lf<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ›å»ºä¸€ä¸ª cap å®¹é‡çš„ HashEntry æ•°ç»„</span>        <span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">HashEntry</span><span class="token punctuation">[</span>cap<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>seg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">getObjectVolatile</span><span class="token punctuation">(</span>ss<span class="token punctuation">,</span> u<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// recheck</span>            <span class="token comment">// å†æ¬¡æ£€æŸ¥ u ä½ç½®çš„ Segment æ˜¯å¦ä¸ºnullï¼Œå› ä¸ºè¿™æ—¶å¯èƒ½æœ‰å…¶ä»–çº¿ç¨‹è¿›è¡Œäº†æ“ä½œ</span>            <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>lf<span class="token punctuation">,</span> threshold<span class="token punctuation">,</span> tab<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è‡ªæ—‹æ£€æŸ¥ u ä½ç½®çš„ Segment æ˜¯å¦ä¸ºnull</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>seg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">getObjectVolatile</span><span class="token punctuation">(</span>ss<span class="token punctuation">,</span> u<span class="token punctuation">)</span><span class="token punctuation">)</span>                   <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// ä½¿ç”¨CAS èµ‹å€¼ï¼Œåªä¼šæˆåŠŸä¸€æ¬¡</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">compareAndSwapObject</span><span class="token punctuation">(</span>ss<span class="token punctuation">,</span> u<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> seg <span class="token operator">=</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> seg<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>è®¡ç®—keyçš„ä½ç½®ï¼Œè·å–æŒ‡å®šä½ç½®çš„Segment</li><li>å¦‚æœæŒ‡å®šä½ç½®çš„Segmentä¸ºç©ºï¼Œåˆ™åˆå§‹åŒ–è¿™ä¸ªSegment<ul><li>å¦‚æœä¸ºnullï¼Œä½¿ç”¨<code>Segment[0]</code>çš„å®¹é‡å’Œè´Ÿè½½å› å­åˆ›å»ºä¸€ä¸ªHashEntryæ•°ç»„</li><li>å†æ¬¡æ£€æŸ¥æ˜¯å¦ä¸ºnull</li><li>ä½¿ç”¨HashEntryåˆå§‹åŒ–è¿™ä¸ªSegment</li><li>è‡ªæ—‹è®¡ç®—å¾—åˆ°çš„æŒ‡å®šä½ç½®æ˜¯å¦ä¸ºnullï¼Œä½¿ç”¨CASåœ¨è¿™ä¸ªä½ç½®èµ‹å€¼Segment</li></ul></li><li>Segment.putæ’å…¥keyï¼Œvalue<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// è·å– ReentrantLock ç‹¬å é”ï¼Œè·å–ä¸åˆ°ï¼ŒscanAndLockForPut è·å–ã€‚</span>    <span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> node <span class="token operator">=</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> <span class="token function">scanAndLockForPut</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">V</span> oldValue<span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab <span class="token operator">=</span> table<span class="token punctuation">;</span>        <span class="token comment">// è®¡ç®—è¦putçš„æ•°æ®ä½ç½®</span>        <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token punctuation">(</span>tab<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">;</span>        <span class="token comment">// CAS è·å– index åæ ‡çš„å€¼</span>        <span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> first <span class="token operator">=</span> <span class="token function">entryAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e <span class="token operator">=</span> first<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// æ£€æŸ¥æ˜¯å¦ key å·²ç»å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™éå†é“¾è¡¨å¯»æ‰¾ä½ç½®ï¼Œæ‰¾åˆ°åæ›¿æ¢ value</span>                <span class="token class-name">K</span> k<span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span>                    <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>                        <span class="token operator">++</span>modCount<span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token comment">// first æœ‰å€¼æ²¡è¯´æ˜ index ä½ç½®å·²ç»æœ‰å€¼äº†ï¼Œæœ‰å†²çªï¼Œé“¾è¡¨å¤´æ’æ³•ã€‚</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>                    node<span class="token punctuation">.</span><span class="token function">setNext</span><span class="token punctuation">(</span>first<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">else</span>                    node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> first<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">int</span> c <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token comment">// å®¹é‡å¤§äºæ‰©å®¹é˜€å€¼ï¼Œå°äºæœ€å¤§å®¹é‡ï¼Œè¿›è¡Œæ‰©å®¹</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">&gt;</span> threshold <span class="token operator">&amp;&amp;</span> tab<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span>                    <span class="token function">rehash</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">else</span>                    <span class="token comment">// index ä½ç½®èµ‹å€¼ nodeï¼Œnode å¯èƒ½æ˜¯ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªé“¾è¡¨çš„è¡¨å¤´</span>                    <span class="token function">setEntryAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> index<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token operator">++</span>modCount<span class="token punctuation">;</span>                count <span class="token operator">=</span> c<span class="token punctuation">;</span>                oldValue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>        <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><ul><li><p><code>tryLock()</code> è·å–é”ï¼Œè·å–ä¸åˆ°ä½¿ç”¨ <strong><code>scanAndLockForPut</code></strong> æ–¹æ³•ç»§ç»­è·å–ã€‚</p></li><li><p>è®¡ç®— put çš„æ•°æ®è¦æ”¾å…¥çš„ index ä½ç½®ï¼Œç„¶åè·å–è¿™ä¸ªä½ç½®ä¸Šçš„ <code>HashEntry</code> ã€‚</p></li><li><p>éå† put æ–°å…ƒç´ ï¼Œä¸ºä»€ä¹ˆè¦éå†ï¼Ÿå› ä¸ºè¿™é‡Œè·å–çš„ <code>HashEntry</code> å¯èƒ½æ˜¯ä¸€ä¸ªç©ºå…ƒç´ ï¼Œä¹Ÿå¯èƒ½æ˜¯é“¾è¡¨å·²å­˜åœ¨ï¼Œæ‰€ä»¥è¦åŒºåˆ«å¯¹å¾…ã€‚</p><p>  å¦‚æœè¿™ä¸ªä½ç½®ä¸Šçš„ <strong><code>HashEntry</code> ä¸å­˜åœ¨</strong>ï¼š</p><ol><li>å¦‚æœå½“å‰å®¹é‡å¤§äºæ‰©å®¹é˜€å€¼ï¼Œå°äºæœ€å¤§å®¹é‡ï¼Œ<strong>è¿›è¡Œæ‰©å®¹</strong>ã€‚</li><li>ç›´æ¥å¤´æ’æ³•æ’å…¥ã€‚</li></ol><p>  å¦‚æœè¿™ä¸ªä½ç½®ä¸Šçš„ <strong><code>HashEntry</code> å­˜åœ¨</strong>ï¼š</p><ol><li>åˆ¤æ–­é“¾è¡¨å½“å‰å…ƒç´  key å’Œ hash å€¼æ˜¯å¦å’Œè¦ put çš„ key å’Œ hash å€¼ä¸€è‡´ã€‚ä¸€è‡´åˆ™æ›¿æ¢å€¼</li><li>ä¸ä¸€è‡´ï¼Œè·å–é“¾è¡¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›´åˆ°å‘ç°ç›¸åŒè¿›è¡Œå€¼æ›¿æ¢ï¼Œæˆ–è€…é“¾è¡¨è¡¨é‡Œå®Œæ¯•æ²¡æœ‰ç›¸åŒçš„ã€‚<ol><li>å¦‚æœå½“å‰å®¹é‡å¤§äºæ‰©å®¹é˜€å€¼ï¼Œå°äºæœ€å¤§å®¹é‡ï¼Œ<strong>è¿›è¡Œæ‰©å®¹</strong>ã€‚</li><li>ç›´æ¥é“¾è¡¨å¤´æ’æ³•æ’å…¥ã€‚</li></ol></li></ol></li><li><p>å¦‚æœè¦æ’å…¥çš„ä½ç½®ä¹‹å‰å·²ç»å­˜åœ¨ï¼Œæ›¿æ¢åè¿”å›æ—§å€¼ï¼Œå¦åˆ™è¿”å› null.</p></li></ul><h3 id="resize-1"><a href="#resize-1" class="headerlink" title="resize"></a>resize</h3><p>æ‰©å®¹ä½¿ç”¨çš„æ˜¯å¤´æ’æ³•</p><h2 id="JDK1-8"><a href="#JDK1-8" class="headerlink" title="JDK1.8"></a>JDK1.8</h2><p><img src="/2024/09/28/24/jdk1.8concurrent.png"><br>ç”±åŸå…ˆçš„Segmentæ•°ç»„ + HashEntryè½¬åŒ–ä¸ºNodeæ•°ç»„ + é“¾è¡¨/çº¢é»‘æ ‘</p><h3 id="é‡è¦å±æ€§"><a href="#é‡è¦å±æ€§" class="headerlink" title="é‡è¦å±æ€§"></a>é‡è¦å±æ€§</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>      <span class="token keyword">implements</span> <span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>    <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> table<span class="token punctuation">;</span> <span class="token comment">// å“ˆå¸Œè¡¨æ•°ç»„ï¼Œå­˜å‚¨é”®å€¼å¯¹</span><span class="token comment">/** * ä¸‹ä¸€ä¸ªå“ˆå¸Œè¡¨æ•°ç»„ï¼Œä»…åœ¨æ‰©å®¹æ—¶ä½¿ç”¨ï¼Œä¸ä¸ºç©º */</span><span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> nextTable<span class="token punctuation">;</span><span class="token comment">/** * åŸºç¡€è®¡æ•°å™¨å€¼ï¼Œä¸»è¦åœ¨æ²¡æœ‰ç«äº‰æ—¶ä½¿ç”¨ï¼Œä¹Ÿä½œä¸ºè¡¨åˆå§‹åŒ–ç«äº‰æœŸé—´çš„å›é€€ã€‚é€šè¿‡CASæ›´æ–° */</span><span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token keyword">long</span> baseCount<span class="token punctuation">;</span><span class="token comment">/** * è¡¨åˆå§‹åŒ–å’Œæ‰©å®¹æ§åˆ¶ã€‚å½“ä¸ºè´Ÿæ•°æ—¶ï¼Œè¡¨ç¤ºè¡¨æ­£åœ¨åˆå§‹åŒ–æˆ–æ‰©å®¹ï¼š-1è¡¨ç¤ºåˆå§‹åŒ–ï¼Œå¦åˆ™ä¸º-(1 + æ´»åŠ¨æ‰©å®¹çº¿ç¨‹æ•°)ã€‚ * å¦åˆ™ï¼Œå½“è¡¨ä¸ºç©ºæ—¶ï¼Œä¿å­˜åˆ›å»ºæ—¶ä½¿ç”¨çš„åˆå§‹è¡¨å¤§å°ï¼Œé»˜è®¤ä¸º0ã€‚åˆå§‹åŒ–åï¼Œä¿å­˜ä¸‹ä¸€ä¸ªç”¨äºæ‰©å®¹çš„å…ƒç´ è®¡æ•°å€¼ */</span><span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> sizeCtl<span class="token punctuation">;</span><span class="token comment">/** * æ‰©å®¹æ—¶è¦æ‹†åˆ†çš„ä¸‹ä¸€ä¸ªè¡¨ç´¢å¼•ï¼ˆåŠ ä¸€ï¼‰ */</span><span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> transferIndex<span class="token punctuation">;</span><span class="token comment">/** * æ‰©å®¹å’Œ/æˆ–åˆ›å»ºCounterCellsæ—¶ä½¿ç”¨çš„è‡ªæ—‹é”ï¼ˆé€šè¿‡CASé”å®šï¼‰ */</span><span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> cellsBusy<span class="token punctuation">;</span><span class="token comment">/** * è®¡æ•°å•å…ƒè¡¨ã€‚å½“ä¸ä¸ºç©ºæ—¶ï¼Œå¤§å°ä¸º2çš„å¹‚ */</span><span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">CounterCell</span><span class="token punctuation">[</span><span class="token punctuation">]</span> counterCells<span class="token punctuation">;</span><span class="token comment">// views</span><span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">KeySetView</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> keySet<span class="token punctuation">;</span> <span class="token comment">// é”®é›†åˆè§†å›¾</span><span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">ValuesView</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">;</span> <span class="token comment">// å€¼é›†åˆè§†å›¾</span><span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">EntrySetView</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> entrySet<span class="token punctuation">;</span> <span class="token comment">// é”®å€¼å¯¹é›†åˆè§†å›¾</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h3><p>åŸºæœ¬ä¸HashMapä¸­çš„ç›¸åŒï¼Œæ‰€ä»¥ç•¥è¿‡</p><h3 id="initTable"><a href="#initTable" class="headerlink" title="initTable"></a>initTable</h3><p>åˆå§‹åŒ–</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">initTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> <span class="token keyword">int</span> sc<span class="token punctuation">;</span>       <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> tab<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// sizeCtl &lt; 0 è¯´æ˜å…¶ä»–çº¿ç¨‹CASæˆåŠŸï¼Œæ­£åœ¨åˆå§‹åŒ–æˆ–</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sc <span class="token operator">=</span> sizeCtl<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">// è®©å‡ºcpu</span>               <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">SIZECTL</span><span class="token punctuation">,</span> sc<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>               <span class="token keyword">try</span> <span class="token punctuation">{</span>                   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> tab<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                       <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token punctuation">(</span>sc <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> sc <span class="token operator">:</span> <span class="token constant">DEFAULT_CAPACITY</span><span class="token punctuation">;</span>                       <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>                       <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> nt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>                       table <span class="token operator">=</span> tab <span class="token operator">=</span> nt<span class="token punctuation">;</span>                       sc <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token punctuation">(</span>n <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token punctuation">}</span>               <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>                   sizeCtl <span class="token operator">=</span> sc<span class="token punctuation">;</span>               <span class="token punctuation">}</span>               <span class="token keyword">break</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span>       <span class="token punctuation">}</span>       <span class="token keyword">return</span> tab<span class="token punctuation">;</span>   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>é€šè¿‡è‡ªæ—‹ + CASæ“ä½œæ¥å®Œæˆåˆå§‹åŒ–</li><li>sizeCtl çš„å€¼<ul><li>-1 ï¼š æ­£åœ¨åˆå§‹åŒ–</li><li><ul><li>Nï¼šæ­£åœ¨æ‰©å®¹é«˜16ä½ä½æ‰©å®¹çš„æ ‡è¯†æˆ³ï¼Œä½16ä½-1ä½æ­£åœ¨æ‰©å®¹çš„çº¿ç¨‹æ•°</li></ul></li><li>0 ï¼štableåˆå§‹åŒ–å¤§å°ï¼Œå¦‚æœtableæ²¡æœ‰åˆå§‹åŒ–</li><li><blockquote><p>0 ï¼š æ‰©å®¹é˜ˆå€¼</p></blockquote></li></ul></li></ol><h3 id="put-2"><a href="#put-2" class="headerlink" title="put"></a>put</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token function">putVal</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>    <span class="token comment">/** Implementation for put and putIfAbsent */</span>  <span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// è®¡ç®—hash</span>    <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">spread</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// è®¡æ•°å™¨ï¼Œæ£€æµ‹é“¾è¡¨é•¿åº¦ï¼Œç»Ÿè®¡èŠ‚ç‚¹ä¸ªæ•°ï¼Œæ§åˆ¶å¾ªç¯</span>    <span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab <span class="token operator">=</span> table<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// fæ˜¯ç›®æ ‡å…ƒç´ çš„ä½ç½®, fhæ˜¯åé¢å­˜æ”¾ç›®æ ‡ä½ç½®å…ƒç´ çš„hashå€¼</span>        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> f<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> i<span class="token punctuation">,</span> fh<span class="token punctuation">;</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>tab <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>      <span class="token comment">// æ•°æ®æ¡¶ä¸ºç©ºï¼Œå°±å…ˆåˆå§‹åŒ–</span>            tab <span class="token operator">=</span> <span class="token function">initTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// å®šä½åˆ°è¿™ä¸ªä½ç½®ä¹‹åå‘ç°æ¡¶ä¸­æ²¡æœ‰æ•°æ®ï¼Œå°±ç›´æ¥æ”¾å…¥ï¼Œä¸åŠ é”ï¼Œç„¶åè·³å‡ºå³å¯</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>f <span class="token operator">=</span> <span class="token function">tabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">casTabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>                           <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                  <span class="token keyword">break</span><span class="token punctuation">;</span>                   <span class="token comment">// no lock when adding to empty bin  </span>        <span class="token punctuation">}</span>          <span class="token comment">// æ£€æŸ¥å½“å‰æ¡¶ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯ä¸€ä¸ª ForwardingNodeã€‚ForwardingNode æ˜¯åœ¨å“ˆå¸Œè¡¨æ‰©å®¹æ—¶ä½¿ç”¨çš„ä¸€ç§ç‰¹æ®ŠèŠ‚ç‚¹ç±»å‹ï¼Œç”¨äºæŒ‡ç¤ºè¯¥æ¡¶çš„å†…å®¹å·²ç»è¢«ç§»åŠ¨åˆ°æ–°çš„å“ˆå¸Œè¡¨ä¸­ã€‚ </span>        <span class="token comment">// å¦‚æœæ˜¯å°±éœ€è¦helpTranfer</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fh <span class="token operator">=</span> f<span class="token punctuation">.</span>hash<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">MOVED</span><span class="token punctuation">)</span>              tab <span class="token operator">=</span> <span class="token function">helpTransfer</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">else</span> <span class="token punctuation">{</span>              <span class="token class-name">V</span> oldVal <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>              <span class="token comment">// å¯¹èŠ‚ç‚¹fåŠ é”</span>            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token punctuation">{</span>                  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">tabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">==</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>                  <span class="token comment">// å‘ç°æ˜¯é“¾è¡¨</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>fh <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                          binCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                          <span class="token comment">// å¾ªç¯åŠ å…¥æ–°çš„èŠ‚ç‚¹ï¼Œæˆ–è€…è¦†ç›–</span>                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e <span class="token operator">=</span> f<span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>                              <span class="token class-name">K</span> ek<span class="token punctuation">;</span>                              <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>                                  <span class="token punctuation">(</span><span class="token punctuation">(</span>ek <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span>                                   <span class="token punctuation">(</span>ek <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>ek<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                  oldVal <span class="token operator">=</span> e<span class="token punctuation">.</span>val<span class="token punctuation">;</span>                                  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent<span class="token punctuation">)</span>                                      e<span class="token punctuation">.</span>val <span class="token operator">=</span> value<span class="token punctuation">;</span>                                  <span class="token keyword">break</span><span class="token punctuation">;</span>                              <span class="token punctuation">}</span>                            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> pred <span class="token operator">=</span> e<span class="token punctuation">;</span>                              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                  pred<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span>                                                            value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                  <span class="token keyword">break</span><span class="token punctuation">;</span>                              <span class="token punctuation">}</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token keyword">instanceof</span> <span class="token class-name">TreeBin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                              <span class="token comment">//å‘ç°æ˜¯çº¢é»‘æ ‘</span>                        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> p<span class="token punctuation">;</span>                          binCount <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>                          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeBin</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span>                                                         value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                              oldVal <span class="token operator">=</span> p<span class="token punctuation">.</span>val<span class="token punctuation">;</span>                              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent<span class="token punctuation">)</span>                                  p<span class="token punctuation">.</span>val <span class="token operator">=</span> value<span class="token punctuation">;</span>                          <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                  <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">&gt;=</span> <span class="token constant">TREEIFY_THRESHOLD</span><span class="token punctuation">)</span>                      <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVal <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>                      <span class="token keyword">return</span> oldVal<span class="token punctuation">;</span>                  <span class="token keyword">break</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token function">addCount</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> binCount<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>é€šè¿‡keyè®¡ç®—hashcode</li><li>åˆ¤æ–­æ˜¯å¦éœ€è¦åˆå§‹åŒ–</li><li>å®šä½åˆ°Nodeï¼Œå¦‚æœä¸ºç©ºç›´æ¥ç”¨CASå†™å…¥ï¼Œå¤±è´¥å°±è‡ªæ—‹ä¿è¯æˆåŠŸ</li><li>å¦‚æœhashcode == MOVED == - 1éœ€è¦è¿›è¡Œæ‰©å®¹</li><li>å¦‚æœéƒ½ä¸æ»¡è¶³å°±ä½¿ç”¨synchronizedé”å†™å…¥æ•°æ®</li><li>å¦‚æœæ•°é‡å¤§äºTREEIFY_THRESHOLDè°ƒç”¨treeifyBinè¿›è¡Œè½¬åŒ–</li></ol><h3 id="get-1"><a href="#get-1" class="headerlink" title="get"></a>get</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e<span class="token punctuation">,</span> p<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> eh<span class="token punctuation">;</span> <span class="token class-name">K</span> ek<span class="token punctuation">;</span>    <span class="token comment">// key æ‰€åœ¨çš„ hash ä½ç½®</span>    <span class="token keyword">int</span> h <span class="token operator">=</span> <span class="token function">spread</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>        <span class="token punctuation">(</span>e <span class="token operator">=</span> <span class="token function">tabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// å¦‚æœæŒ‡å®šä½ç½®å…ƒç´ å­˜åœ¨ï¼Œå¤´ç»“ç‚¹hashå€¼ç›¸åŒ</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>eh <span class="token operator">=</span> e<span class="token punctuation">.</span>hash<span class="token punctuation">)</span> <span class="token operator">==</span> h<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ek <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>ek <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>ek<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token comment">// key hash å€¼ç›¸ç­‰ï¼Œkeyå€¼ç›¸åŒï¼Œç›´æ¥è¿”å›å…ƒç´  value</span>                <span class="token keyword">return</span> e<span class="token punctuation">.</span>val<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>eh <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token comment">// å¤´ç»“ç‚¹hashå€¼å°äº0ï¼Œè¯´æ˜æ­£åœ¨æ‰©å®¹æˆ–è€…æ˜¯çº¢é»‘æ ‘ï¼ŒfindæŸ¥æ‰¾</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> p<span class="token punctuation">.</span>val <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// æ˜¯é“¾è¡¨ï¼Œéå†æŸ¥æ‰¾</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> h <span class="token operator">&amp;&amp;</span>                <span class="token punctuation">(</span><span class="token punctuation">(</span>ek <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>ek <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>ek<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> e<span class="token punctuation">.</span>val<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="å¸¸è§å…«è‚¡"><a href="#å¸¸è§å…«è‚¡" class="headerlink" title="å¸¸è§å…«è‚¡"></a>å¸¸è§å…«è‚¡</h1><h2 id="HashMapçš„åº•å±‚å®ç°æ˜¯ä»€ä¹ˆ"><a href="#HashMapçš„åº•å±‚å®ç°æ˜¯ä»€ä¹ˆ" class="headerlink" title="HashMapçš„åº•å±‚å®ç°æ˜¯ä»€ä¹ˆ"></a>HashMapçš„åº•å±‚å®ç°æ˜¯ä»€ä¹ˆ</h2><p>JDK1.8ä¹‹å‰æ˜¯æ•°ç»„ + é“¾è¡¨ï¼Œæ•°ç»„æ˜¯HashMapçš„ä¸»ä½“ï¼Œé“¾è¡¨æ˜¯ç”¨æ¥è§£å†³å“ˆå¸Œå†²çªã€‚ä½¿ç”¨æ‹‰é“¾æ³•æ¥è§£å†³ã€‚<br>JDK1.8ä¹‹åå˜ä¸ºæ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºç­‰äºé˜ˆå€¼ <u>8</u> æ—¶ï¼Œä¼šè½¬åŒ–ï¼Œå¦‚æœå½“å‰æ•°ç»„é•¿åº¦å°äº64å°±å­¦ä¼šå…ˆè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œå¦åˆ™å°±è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œé»˜è®¤å¤§å°ä¸º16ï¼Œæ¯æ¬¡æ‰©å®¹2å€ã€‚</p><h2 id="æ‹‰é“¾æ³•åˆ°åº•æ˜¯ä»€ä¹ˆ"><a href="#æ‹‰é“¾æ³•åˆ°åº•æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ‹‰é“¾æ³•åˆ°åº•æ˜¯ä»€ä¹ˆ"></a>æ‹‰é“¾æ³•åˆ°åº•æ˜¯ä»€ä¹ˆ</h2><p>æ‹‰é“¾æ³•å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€æ ¼éƒ½æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œå¦‚æœé‡è§å“ˆå¸Œå†²çªï¼Œåˆ™å°†å†²çªçš„å€¼åŠ åˆ°é“¾è¡¨ä¸­ã€‚<br>JDK1.8ä¹‹åä¼šå…ˆåˆ¤æ–­é“¾è¡¨çš„é•¿åº¦æ˜¯å¦å¤§äºé˜ˆå€¼8ï¼Œç„¶åå»æ ¹æ®æ•°æ®æ¥åˆ¤æ–­æ˜¯å¦è½¬åŒ–ä¸ºçº¢é»‘æ ‘ã€‚<br><img src="/2024/09/28/24/%E6%95%B0%E6%8D%AE+%E7%BA%A2%E9%BB%91%E6%A0%91.png" alt="|450"></p><h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨2ä½œä¸ºåº•æ•°"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨2ä½œä¸ºåº•æ•°" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨2ä½œä¸ºåº•æ•°"></a>ä¸ºä»€ä¹ˆä½¿ç”¨2ä½œä¸ºåº•æ•°</h2><ol><li>ä½¿ç”¨2ä½œä¸ºåº•æ•°å¯ä»¥ä½¿ç”¨ä½è¿ç®—è€Œä¸æ˜¯å–æ¨¡å»è®¡ç®—ç´¢å¼•ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼Œæé«˜æ€§èƒ½</li><li>åŒæ—¶å®¹é‡æ˜¯2çš„å¹‚æ¬¡æ—¶ï¼Œå“ˆå¸Œå€¼çš„ä½ä½å’Œé«˜ä½éƒ½å¯ä»¥å‚ä¸ç´¢å¼•çš„è®¡ç®—ï¼Œå‡å°‘å“ˆå¸Œå†²çª(capacity æ˜¯ 2 çš„å¹‚æ¬¡ï¼Œå› æ­¤ capacity - 1 çš„äºŒè¿›åˆ¶è¡¨ç¤ºå…¨æ˜¯ 1ï¼Œè¿™æ · hash &amp; (capacity - 1) å°±èƒ½é«˜æ•ˆåœ°è®¡ç®—å‡ºç´¢å¼•ã€‚)</li><li>æ‰©å®¹æ›´æ›´ç®€å•ï¼Œé‡æ–°è®¡ç®—å“ˆå¸Œåªéœ€è¦æ£€æŸ¥å“ˆå¸Œå€¼çš„ä¸€ä¸ªé¢å¤–ä½</li></ol><h2 id="è®²è§£ä¸€ä¸‹putçš„è¿‡ç¨‹"><a href="#è®²è§£ä¸€ä¸‹putçš„è¿‡ç¨‹" class="headerlink" title="è®²è§£ä¸€ä¸‹putçš„è¿‡ç¨‹"></a>è®²è§£ä¸€ä¸‹putçš„è¿‡ç¨‹</h2><ol><li>åˆ¤æ–­mapæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºæˆ–è€…é•¿åº¦ä½0å°±åŠé€†è¡Œåˆå§‹åŒ–æˆ–è€…æ‰©å®¹</li><li>ä¹‹åè®¡ç®—hashå€¼ï¼Œå»åŒ¹é…Nodeæ•°ç»„ï¼Œå¦‚æœå®šä½åˆ°çš„æ•°ç»„æ²¡æœ‰ä½ç½®ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ’å…¥åˆ°Nodeæ•°ç»„ä¸­</li><li>å¦‚æœä¸ä¸ºç©ºï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯æ ‘èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯å°±è°ƒç”¨putTreeValï¼Œå¦åˆ™å°±å»éå†è¿™ä¸ªæ•°ç»„æ‰€å¯¹åº”çš„é“¾è¡¨ï¼Œå¦‚æœå‡ºç°å“ˆå¸Œå€¼å’Œkeyå®Œå…¨ä¸€è‡´å°±è¦†ç›–æ•°æ®ï¼Œå¦åˆ™å°±éå†åˆ°æœ€åä½¿ç”¨å°¾æ’æ³•ï¼Œæ’å…¥æ•°æ®</li><li>æ’å…¥æˆ–è€…è¦†ç›–æ•°æ®ä¹‹ååˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹æˆ–è€…è½¬åŒ–ä¸ºæ ‘å½¢ç»“æ„</li></ol><h2 id="ä¸ºä»€ä¹ˆJDK1-8ä½¿ç”¨å°¾æ’æ³•è€Œä¸æ˜¯å’ŒJDK1-7ä¸€æ ·ä½¿ç”¨å¤´æ’æ³•"><a href="#ä¸ºä»€ä¹ˆJDK1-8ä½¿ç”¨å°¾æ’æ³•è€Œä¸æ˜¯å’ŒJDK1-7ä¸€æ ·ä½¿ç”¨å¤´æ’æ³•" class="headerlink" title="ä¸ºä»€ä¹ˆJDK1.8ä½¿ç”¨å°¾æ’æ³•è€Œä¸æ˜¯å’ŒJDK1.7ä¸€æ ·ä½¿ç”¨å¤´æ’æ³•"></a>ä¸ºä»€ä¹ˆJDK1.8ä½¿ç”¨å°¾æ’æ³•è€Œä¸æ˜¯å’ŒJDK1.7ä¸€æ ·ä½¿ç”¨å¤´æ’æ³•</h2><p>å› ä¸ºå¤šçº¿ç¨‹çš„æƒ…å†µå¤´æ’æ³•æœ‰å¯èƒ½ä¼šå‡ºç°ç¯</p><h2 id="HashMapä½•æ—¶ä¼šæ‰©å®¹"><a href="#HashMapä½•æ—¶ä¼šæ‰©å®¹" class="headerlink" title="HashMapä½•æ—¶ä¼šæ‰©å®¹"></a>HashMapä½•æ—¶ä¼šæ‰©å®¹</h2><p>å½“é“¾è¡¨çš„é•¿åº¦å¤§äºTREEIFY_THRESHOLD(é»˜è®¤ä¸º8)æ—¶ä¼šå¼€å§‹è½¬åŒ–ï¼ŒåŒæ—¶è¦åˆ¤æ–­Nodeæ•°ç»„çš„ä¸ªæ•°æ˜¯å¦å¤§äºMIN_TREEIFY_CAPACITY(é»˜è®¤64)ï¼Œå¦‚æœå°äºå°±ä¼šå…ˆè¿›è¡Œæ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬åŒ–ï¼Œå¦‚æœå¤§äºå°±ç›´æ¥è½¬åŒ–ä¸ºçº¢é»‘æ ‘</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥æµ…å‡ºåŠ¨æ€ä»£ç†</title>
      <link href="/2024/09/22/32/"/>
      <url>/2024/09/22/32/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>é¢è¯•ä¸­ç»å¸¸è¢«é—®åˆ°åŠ¨æ€ä»£ç†ç›¸å…³å†…å®¹ï¼Œæ¯æ¬¡éƒ½ç­”å¾—ä¸å¤Ÿå®Œç¾ï¼Œåˆå› è¿‘æœŸåœ¨å°è¯•æ‰‹å†™RPCæ¡†æ¶ï¼Œäº†è§£åˆ°ä¸å°‘çš„åŠ¨æ€ä»£ç†ç›¸å…³çš„å†…å®¹ï¼Œé¡ºé“æ€»ç»“ä¸€ä¸‹ï¼Œäºæ˜¯å°±æœ‰äº†è¿™ç¯‡æ–‡ç« </p><h1 id="é™æ€ä»£ç†-åŠ¨æ€ä»£ç†ï¼"><a href="#é™æ€ä»£ç†-åŠ¨æ€ä»£ç†ï¼" class="headerlink" title="é™æ€ä»£ç†? åŠ¨æ€ä»£ç†ï¼"></a>é™æ€ä»£ç†? åŠ¨æ€ä»£ç†ï¼</h1><h2 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h2><p>é™æ€ä»£ç†æ˜¯åœ¨ç¼–è¯‘æœŸé—´å°±ç”Ÿæˆäº†å®é™…çš„å­—èŠ‚ç å’Œå¯¹åº”çš„classæ–‡ä»¶ï¼Œè€ŒåŠ¨æ€ä»£ç†å¯ä»¥åœ¨è¿è¡Œä¸­åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ã€‚</p><ul><li>é™æ€ä»£ç†ç¤ºä¾‹<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// å®é™…ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RealService</span> <span class="token keyword">implements</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Performing service..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// ä»£ç†ç±»ä¹Ÿè¦å®ç°å’Œè¢«ä»£ç†çš„ç±»å®ç°çš„åŒä¸€ä¸ªæ¥å£æ‰èƒ½è¿›è¡Œä»£ç†</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticProxy</span> <span class="token keyword">implements</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span><span class="token comment">// å°†éœ€è¦ä»£ç†çš„ç±»å°è£…åˆ°è‡ªå·±çš„å†…éƒ¨</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Service</span> realService<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">StaticProxy</span><span class="token punctuation">(</span><span class="token class-name">Service</span> realService<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>realService <span class="token operator">=</span> realService<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token comment">// å®é™…å°±æ˜¯åœ¨å®ç°çš„æ–¹æ³•ä¸­è¿›è¡Œä»£ç†æ“ä½œï¼Œç„¶åæ‰§è¡Œè¢«ä»£ç†çš„ç±»çš„æ–¹æ³•</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Static Proxy: Before performing service"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        realService<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Static Proxy: After performing service"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>å®é™…ä¸Šå°±æ˜¯é€šè¿‡å°†è¢«ä»£ç†ç±»å°è£…åˆ°å†…éƒ¨ï¼Œç„¶åè°ƒç”¨ã€‚ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼šæ²¡æ–°å¢ä¸€ä¸ªä»£ç†éƒ½éœ€è¦é‡æ–°æ–°å»ºä¸€ä¸ªç±»ç„¶åé‡æ–°å†™ä¸€ä¸ªåŒ…è£…ã€‚</li><li>åŠ¨æ€ä»£ç†å®ä¾‹(JDKä»£ç†)<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RealService</span> <span class="token keyword">implements</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Performing service..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicProxyHandler</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">DynamicProxyHandler</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token comment">// </span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Dynamic Proxy: Before performing service"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Dynamic Proxy: After performing service"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicProxyDemo</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Service</span> realService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RealService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Service</span> proxyInstance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Service</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>                realService<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                realService<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">DynamicProxyHandler</span><span class="token punctuation">(</span>realService<span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        proxyInstance<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="æºç è§£è¯»"><a href="#æºç è§£è¯»" class="headerlink" title="æºç è§£è¯»"></a>æºç è§£è¯»</h2><p><a href="https://www.cnblogs.com/mingshan/p/17793555.html">å‚è€ƒ</a></p><h3 id="è§£å¯†Proxy"><a href="#è§£å¯†Proxy" class="headerlink" title="è§£å¯†Proxy"></a>è§£å¯†Proxy</h3><p>(ä»¥ä¸‹æ˜¯åŸºäºJava8çš„æºç )<br>æˆ‘ä»¬åœ¨ä½¿ç”¨JDKåŠ¨æ€ä»£ç†çš„æ—¶å€™ä½¿ç”¨çš„æœ€å¤šçš„å°±æ˜¯<code>Proxy.newProxyInstance()</code>æ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥è§£å¯†è¿™ä¸ªæ–¹æ³•æ˜¯å¦‚ä½•å®ç°æˆ‘ä»¬çš„åŠ¨æ€ä»£ç†ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@CallerSensitive</span>   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">newProxyInstance</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> loader<span class="token punctuation">,</span>                                         <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> interfaces<span class="token punctuation">,</span>                                         <span class="token class-name">InvocationHandler</span> h<span class="token punctuation">)</span>       <span class="token keyword">throws</span> <span class="token class-name">IllegalArgumentException</span>   <span class="token punctuation">{</span>    <span class="token comment">// æ£€æŸ¥ç©ºæŒ‡é’ˆå¼‚å¸¸</span>       <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> intfs <span class="token operator">=</span> interfaces<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// å®‰å…¨æ£€æŸ¥</span>       <span class="token keyword">final</span> <span class="token class-name">SecurityManager</span> sm <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>sm <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token function">checkProxyAccess</span><span class="token punctuation">(</span><span class="token class-name">Reflection</span><span class="token punctuation">.</span><span class="token function">getCallerClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> loader<span class="token punctuation">,</span> intfs<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span>       <span class="token comment">// ç”Ÿæˆä»£ç†ç±»</span>       <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> cl <span class="token operator">=</span> <span class="token function">getProxyClass0</span><span class="token punctuation">(</span>loader<span class="token punctuation">,</span> intfs<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">/*        * Invoke its constructor with the designated invocation handler.        */</span>       <span class="token keyword">try</span> <span class="token punctuation">{</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span>sm <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>               <span class="token function">checkNewProxyPermission</span><span class="token punctuation">(</span><span class="token class-name">Reflection</span><span class="token punctuation">.</span><span class="token function">getCallerClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cl<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span>           <span class="token keyword">final</span> <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> cons <span class="token operator">=</span> cl<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span>constructorParams<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">final</span> <span class="token class-name">InvocationHandler</span> ih <span class="token operator">=</span> h<span class="token punctuation">;</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Modifier</span><span class="token punctuation">.</span><span class="token function">isPublic</span><span class="token punctuation">(</span>cl<span class="token punctuation">.</span><span class="token function">getModifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>               <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PrivilegedAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                   <span class="token keyword">public</span> <span class="token class-name">Void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                       cons<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                   <span class="token punctuation">}</span>               <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span>           <span class="token keyword">return</span> cons<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>h<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalAccessException</span><span class="token operator">|</span><span class="token class-name">InstantiationException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InternalError</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvocationTargetException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token class-name">Throwable</span> t <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token keyword">instanceof</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>               <span class="token keyword">throw</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span><span class="token punctuation">)</span> t<span class="token punctuation">;</span>           <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>               <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InternalError</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span>       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchMethodException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InternalError</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span>   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‚æ•°è§£æ:</p><ul><li>loaderï¼šç±»åŠ è½½å™¨ï¼Œç”¨äºè‡ªå®šä¹‰åŠ è½½ç±»</li><li>interface æ¥å£æ•°ç»„ï¼Œä»£ç†ç±»å°†å®ç°è¿™äº›æ¥å£</li><li>h è°ƒç”¨å¤„ç†å™¨ï¼Œå¤„ç†ä»£ç†å®ä¾‹ä¸Šçš„æ–¹æ³•è°ƒç”¨<br>è¿™æ®µä»£ç çš„ä¸»è¦æ„æ€æ˜¯è·å–è°ƒç”¨è€…ç±»å’Œä»£ç†ç±»æ„é€ å‡½æ•°ã€‚<br>æ¥ç€å…³æ³¨getProxyClass0æ–¹æ³•<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getProxyClass0</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> loader<span class="token punctuation">,</span>                                          <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> interfaces<span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token comment">// è§„å®šå¯¹å®ç°çš„æ¥å£æ•°é‡ä¸å¾—è¶…è¿‡è¿™ä¸ªæ•°é‡</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>interfaces<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">65535</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"interface limit exceeded"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span>       <span class="token comment">// If the proxy class defined by the given loader implementing</span>       <span class="token comment">// the given interfaces exists, this will simply return the cached copy;</span>       <span class="token comment">// otherwise, it will create the proxy class via the ProxyClassFactory</span>       <span class="token keyword">return</span> proxyClassCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>loader<span class="token punctuation">,</span> interfaces<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>æ¥ç€çœ‹proxyClassCache<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ä½¿ç”¨WeakCacheé™ä½å‡ºç°å†…å­˜æ³„æ¼çš„æ¦‚ç‡</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">WeakCache</span><span class="token operator">&lt;</span><span class="token class-name">ClassLoader</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span>      proxyClassCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ProxyClassFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>æ ¸å¿ƒæ˜¯ProxyClassFactroyï¼Œè®©æˆ‘ä»¬å…³æ³¨å®ƒ<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æ ¸å¿ƒæ˜¯å®ç°BiFunction</span><span class="token comment">/** * ProxyClassFactory æ˜¯ä¸€ä¸ªå·¥å‚ç±»ï¼Œç”¨äºç”Ÿæˆå’Œå®šä¹‰ä»£ç†ç±»ã€‚ * å®ƒå®ç°äº† BiFunction æ¥å£ï¼Œæ¥å— ClassLoader å’Œæ¥å£æ•°ç»„ä½œä¸ºè¾“å…¥ï¼Œ * è¿”å›ç”Ÿæˆçš„ä»£ç†ç±»ã€‚ */</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ProxyClassFactory</span>    <span class="token keyword">implements</span> <span class="token class-name">BiFunction</span><span class="token operator">&lt;</span><span class="token class-name">ClassLoader</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token comment">// æ‰€æœ‰ä»£ç†ç±»åç§°çš„å‰ç¼€</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> proxyClassNamePrefix <span class="token operator">=</span> <span class="token string">"$Proxy"</span><span class="token punctuation">;</span>    <span class="token comment">// ç”¨äºç”Ÿæˆå”¯ä¸€ä»£ç†ç±»åç§°çš„ä¸‹ä¸€ä¸ªæ•°å­—</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">AtomicLong</span> nextUniqueNumber <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * ç”Ÿæˆå¹¶å®šä¹‰ä»£ç†ç±»ã€‚     *     * @param loader ç”¨äºå®šä¹‰ä»£ç†ç±»çš„ï¿½ï¿½åŠ è½½å™¨     * @param interfaces ä»£ç†ç±»è¦å®ç°çš„æ¥å£æ•°ç»„     * @return ç”Ÿæˆçš„ä»£ç†ç±»     * @throws IllegalArgumentException å¦‚æœæ¥å£æ•°ç»„ä¸­çš„ä»»ä½•æ¥å£ä¸å¯è§æˆ–ä¸æ˜¯æ¥å£ï¼Œæˆ–æ¥å£é‡å¤     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> loader<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> interfaces<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// ä½¿ç”¨ IdentityHashMap æ£€æŸ¥æ¥å£æ˜¯å¦é‡å¤</span>        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> interfaceSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IdentityHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>interfaces<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> intf <span class="token operator">:</span> interfaces<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">/*             * éªŒè¯ç±»åŠ è½½å™¨æ˜¯å¦å°†æ­¤æ¥å£çš„åç§°è§£æä¸ºç›¸åŒçš„ Class å¯¹è±¡ã€‚             */</span>            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> interfaceClass <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment">// å¯¹äºæ¯ä¸€ä¸ªä½¿ç”¨æŒ‡å®šçš„åŠ è½½å™¨å»åŠ è½½ä»–çš„å¯¹è±¡</span>                interfaceClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>intf<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> loader<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>interfaceClass <span class="token operator">!=</span> intf<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span>                    intf <span class="token operator">+</span> <span class="token string">" is not visible from class loader: "</span> <span class="token operator">+</span> loader<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment">/*             * éªŒè¯ Class å¯¹è±¡æ˜¯å¦å®é™…ä»£è¡¨ä¸€ä¸ªæ¥å£ã€‚             */</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>interfaceClass<span class="token punctuation">.</span><span class="token function">isInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span>                    interfaceClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" is not an interface"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment">/*             * éªŒè¯æ­¤æ¥å£æ˜¯å¦é‡å¤ã€‚             */</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>interfaceSet<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>interfaceClass<span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span>                    <span class="token string">"repeated interface: "</span> <span class="token operator">+</span> interfaceClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token class-name">String</span> proxyPkg <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>     <span class="token comment">// å®šä¹‰ä»£ç†ç±»çš„åŒ…</span>        <span class="token keyword">int</span> accessFlags <span class="token operator">=</span> <span class="token class-name">Modifier</span><span class="token punctuation">.</span><span class="token constant">PUBLIC</span> <span class="token operator">|</span> <span class="token class-name">Modifier</span><span class="token punctuation">.</span><span class="token constant">FINAL</span><span class="token punctuation">;</span>        <span class="token comment">/*         * è®°å½•éå…¬å…±ä»£ç†æ¥å£çš„åŒ…ï¼Œä»¥ä¾¿ä»£ç†ç±»å°†åœ¨åŒä¸€åŒ…ä¸­å®šä¹‰ã€‚         * éªŒè¯æ‰€æœ‰éå…¬å…±ä»£ç†æ¥å£æ˜¯å¦åœ¨åŒä¸€åŒ…ä¸­ã€‚         */</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> intf <span class="token operator">:</span> interfaces<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> flags <span class="token operator">=</span> intf<span class="token punctuation">.</span><span class="token function">getModifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Modifier</span><span class="token punctuation">.</span><span class="token function">isPublic</span><span class="token punctuation">(</span>flags<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                accessFlags <span class="token operator">=</span> <span class="token class-name">Modifier</span><span class="token punctuation">.</span><span class="token constant">FINAL</span><span class="token punctuation">;</span>                <span class="token class-name">String</span> name <span class="token operator">=</span> intf<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">int</span> n <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">String</span> pkg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">""</span> <span class="token operator">:</span> name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>proxyPkg <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    proxyPkg <span class="token operator">=</span> pkg<span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pkg<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>proxyPkg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span>                        <span class="token string">"non-public interfaces from different packages"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>proxyPkg <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// å¦‚æœæ²¡æœ‰éå…¬å…±ä»£ç†æ¥å£ï¼Œä½¿ç”¨ com.sun.proxy åŒ…</span>            proxyPkg <span class="token operator">=</span> <span class="token class-name">ReflectUtil</span><span class="token punctuation">.</span><span class="token constant">PROXY_PACKAGE</span> <span class="token operator">+</span> <span class="token string">"."</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">/*         * é€‰æ‹©è¦ç”Ÿæˆçš„ä»£ç†ç±»çš„åç§°ã€‚         */</span>        <span class="token keyword">long</span> num <span class="token operator">=</span> nextUniqueNumber<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> proxyName <span class="token operator">=</span> proxyPkg <span class="token operator">+</span> proxyClassNamePrefix <span class="token operator">+</span> num<span class="token punctuation">;</span>        <span class="token comment">/*         * ç”ŸæˆæŒ‡å®šçš„ä»£ç†ç±»ã€‚         */</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> proxyClassFile <span class="token operator">=</span> <span class="token class-name">ProxyGenerator</span><span class="token punctuation">.</span><span class="token function">generateProxyClass</span><span class="token punctuation">(</span>            proxyName<span class="token punctuation">,</span> interfaces<span class="token punctuation">,</span> accessFlags<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">defineClass0</span><span class="token punctuation">(</span>loader<span class="token punctuation">,</span> proxyName<span class="token punctuation">,</span>                                proxyClassFile<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> proxyClassFile<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassFormatError</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">/*             * è¿™é‡Œçš„ ClassFormatError æ„å‘³ç€ï¼ˆé™¤éä»£ç†ç±»ç”Ÿæˆä»£ç ä¸­æœ‰é”™è¯¯ï¼‰ï¼Œ             * å¦åˆ™æ˜¯ä»£ç†ç±»åˆ›å»ºæ—¶æä¾›çš„å‚æ•°å­˜åœ¨å…¶ä»–æ— æ•ˆæ–¹é¢ï¼ˆä¾‹å¦‚è™šæ‹Ÿæœºé™åˆ¶è¶…å‡ºï¼‰ã€‚             */</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>BiFunction æ˜¯ Java 8 å¼•å…¥çš„ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œä½äº java.util.function åŒ…ä¸­ã€‚å®ƒä»£è¡¨ä¸€ä¸ªæ¥å—ä¸¤ä¸ªè¾“å…¥å‚æ•°å¹¶è¿”å›ä¸€ä¸ªç»“æœçš„å‡½æ•°ã€‚BiFunction æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@FunctionalInterface</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>    <span class="token class-name">R</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">,</span> <span class="token class-name">U</span> u<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å…¶ä»–é»˜è®¤æ–¹æ³•</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>ç„¶åæˆ‘ä»¬é¡ºç€å¾€ä¸‹æ‰¾ï¼Œé€šè¿‡generateProxyClass -&gt;generateClassFile -&gt;generateMethod<br>ä»£ç è¿‡é•¿è¿™é‡Œåªç»™å‡ºæ¯”è¾ƒé‡è¦çš„éƒ¨åˆ†<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">{</span><span class="token comment">// è·å–InvocationHandlerå­—æ®µ</span> out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span>opc_getfield<span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">writeShort</span><span class="token punctuation">(</span>cp<span class="token punctuation">.</span><span class="token function">getFieldRef</span><span class="token punctuation">(</span>                superclassName<span class="token punctuation">,</span>                handlerFieldName<span class="token punctuation">,</span> <span class="token string">"Ljava/lang/reflect/InvocationHandler;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åŠ è½½Methodå¯¹è±¡</span>            <span class="token function">code_aload</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span>opc_getstatic<span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">writeShort</span><span class="token punctuation">(</span>cp<span class="token punctuation">.</span><span class="token function">getFieldRef</span><span class="token punctuation">(</span>                <span class="token function">dotToSlash</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">,</span>                methodFieldName<span class="token punctuation">,</span> <span class="token string">"Ljava/lang/reflect/Method;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åé¢ç´§è·Ÿå¤„ç†æ–¹æ³•å‚æ•°çš„éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†çœç•¥</span><span class="token comment">// é‡ç‚¹ï¼</span><span class="token comment">// è°ƒç”¨InvocationHandler.invokeæ–¹æ³•</span> out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span>opc_invokeinterface<span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">writeShort</span><span class="token punctuation">(</span>cp<span class="token punctuation">.</span><span class="token function">getInterfaceMethodRef</span><span class="token punctuation">(</span>                <span class="token string">"java/lang/reflect/InvocationHandler"</span><span class="token punctuation">,</span>                <span class="token string">"invoke"</span><span class="token punctuation">,</span>                <span class="token string">"(Ljava/lang/Object;Ljava/lang/reflect/Method;"</span> <span class="token operator">+</span>                    <span class="token string">"[Ljava/lang/Object;)Ljava/lang/Object;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åé¢è®¾ç½®è¿”å›å€¼å’Œå¼‚å¸¸å¤„ç†ç­‰ä¿¡æ¯ï¼Œæœ€åè¿”å›æ–¹æ³•çš„ä¿¡æ¯</span><span class="token keyword">return</span> minfo<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>åˆ°è¿™é‡Œæˆ‘ä»¬æ‰ç»ˆäºå‘ç°JDKåŠ¨æ€ä»£ç†çš„åŸç†ï¼š<br>åŸæ¥å°±æ˜¯åœ¨ä»£ç†æ–¹æ³•ä¸­é€šè¿‡Proxyå¼•ç”¨äº†è‡ªå®šä¹‰çš„InvocationHandlerï¼ï¼<br>é€šè¿‡Proxy.newProxyInstance()æ–¹æ³•å°†invocationHandlerä¼ å…¥ï¼Œç„¶åç”Ÿæˆä»£ç†ç±»æ¥ç»§æ‰¿Proxyç±»ï¼Œä»è€Œæ‹¿åˆ°InvocationHandlerï¼Œæœ€ååœ¨ä»£ç†ç±»ä¸­è°ƒç”¨invoke()æ–¹æ³•</li></ul><h1 id="SpringAOP"><a href="#SpringAOP" class="headerlink" title="SpringAOP !"></a>SpringAOP !</h1><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒSpringAOPçš„å®ç°åŸç†æ˜¯åŠ¨æ€ä»£ç†ï¼Œé‚£ä¹ˆå®ƒåˆ°åº•æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</p><blockquote><p>åŸºäºåŠ¨æ€ä»£ç†æ¥å®ç°AOPã€‚å¦‚æœä½¿ç”¨æ¥å£çš„ï¼Œç”¨JDKæä¾›çš„åŠ¨æ€ä»£ç†å®ç°ï¼Œå¦‚æœæ²¡æœ‰æ¥å£ï¼Œä½¿ç”¨ CGLIB å®ç°ã€‚åœ¨ç¼–è¯‘æˆ–è¿è¡Œæ—¶ä¿®æ”¹å­—èŠ‚ç æ¥å®Œæˆå¯¹å¯¹è±¡çš„å¢å¼º</p></blockquote><p>#todo </p><ul><li><input disabled="" type="checkbox"> è¡¥ä¸€ä¸ªhashmapæºç è§£</li><li><input disabled="" type="checkbox"> ThreadLocalæºç è§£è¯»å•ç‹¬æ‘˜å‡ºæ¥ï¼Œå†æ€»ç»“æ€»ç»“</li><li><input disabled="" type="checkbox"> </li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥æµ…å‡ºMySQL</title>
      <link href="/2024/09/14/10/"/>
      <url>/2024/09/14/10/</url>
      
        <content type="html"><![CDATA[<h1 id="æ·±å…¥æµ…å‡ºMySQL"><a href="#æ·±å…¥æµ…å‡ºMySQL" class="headerlink" title="æ·±å…¥æµ…å‡ºMySQL"></a>æ·±å…¥æµ…å‡ºMySQL</h1><p>ä»¥ä¸‹å†…å®¹å‚è€ƒè‡ª ã€ŠMySQLæ˜¯æ€æ ·è¿è¡Œçš„ï¼šä»æ ¹å„¿ä¸Šç†è§£MySQLã€‹ä¸€ä¹¦ï¼Œå¼ºçƒˆæ¨è</p><h2 id="å­˜å‚¨å¼•æ“"><a href="#å­˜å‚¨å¼•æ“" class="headerlink" title="å­˜å‚¨å¼•æ“"></a>å­˜å‚¨å¼•æ“</h2><p>å¯¹äºä¸åŒçš„è¡¨å¯ä»¥è®¾ç½®ä¸åŒçš„å­˜å‚¨å¼•æ“</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE tableName (xxxx) ENGINE = å¼•æ“åç§°;# ä¿®æ”¹ALTER TABLE tableName ENGINE = xxx;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç¼–ç æ ¼å¼"><a href="#ç¼–ç æ ¼å¼" class="headerlink" title="ç¼–ç æ ¼å¼"></a>ç¼–ç æ ¼å¼</h3><p>mysqlä¸­çš„utf8é»˜è®¤çš„æ˜¯ä½¿ç”¨çš„è‡ªå®šä¹‰çš„1~3å­—èŠ‚è¡¨ç¤ºçš„uft8mb3ï¼Œå¯¹äºä¸€äº›ç‰¹æ®Šçš„å­—ç¬¦ï¼Œæ¯”å¦‚emojiï¼Œéœ€è¦æˆ‘ä»¬æŒ‡å®šä¸ºutf8mb4æ‰èƒ½å¤Ÿå­˜å‚¨ã€‚</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE / ALTER DATABASE æ•°æ®åº“å CHARACTER SET å­—ç¬¦é›†åç§° COLLATE æ¯”è¾ƒè§„åˆ™åç§°# æˆ–è€…å¯¹äºè¡¨æ¥ä¿®æ”¹CREATE TABLE tableName()CHARACTER SET å­—ç¬¦é›†COLLATE æ¯”è¾ƒè§„åˆ™ALTER tableName CHARACTER SET å­—ç¬¦é›†åç§°## æˆ–è€…å¯¹äºæŸä¸€åˆ—CREATE TABLE è¡¨å(åˆ—å å­—ç¬¦ä¸²ç±»å‹ [CHARACTER SET å­—ç¬¦é›†åç§°] [COLLATE æ¯”è¾ƒè§„åˆ™åç§°],å…¶ä»–åˆ—...);ALTER TABLE è¡¨å MODIFY åˆ—å å­—ç¬¦ä¸²ç±»å‹ [CHARACTER SET å­—ç¬¦é›†åç§°] [COLLATE æ¯”è¾ƒè§„åˆ™åç§°];<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h2><h2 id="ç‰©ç†å­˜å‚¨ç»“æ„"><a href="#ç‰©ç†å­˜å‚¨ç»“æ„" class="headerlink" title="ç‰©ç†å­˜å‚¨ç»“æ„"></a>ç‰©ç†å­˜å‚¨ç»“æ„</h2><ol><li>é¡µ<br>å°†æ•°æ®åˆ’åˆ†ä¸ºé¡µï¼Œä»¥é¡µä¸ºå•ä½ä½œä¸ºç£ç›˜å’Œå†…å­˜äº¤äº’çš„å•ä½ï¼Œé»˜è®¤é¡µå¤§å°ä¸º16KB</li><li>è¡Œç»“æ„<br>è®°å½•çš„å•ä½æ˜¯è¡Œã€‚</li></ol><h3 id="è¡Œæ ¼å¼"><a href="#è¡Œæ ¼å¼" class="headerlink" title="è¡Œæ ¼å¼"></a>è¡Œæ ¼å¼</h3><p>è¡Œ/è®°å½•æ ¼å¼æœ‰å¾ˆå¤šï¼Œå¯ä»¥åœ¨å»ºè¡¨çš„æ—¶å€™æŒ‡å®šè¡Œæ ¼å¼</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE tableName(xxxx;) ROW_FORMAT=COMPACT;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol><li>COMPACTæ ¼å¼ ï¼ˆé‡ç‚¹ï¼Œæœ€å¸¸ç”¨ï¼‰<br><img src="/2024/09/14/10/Compact.png"></li></ol><ul><li>å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ï¼Œ<strong>åªä¼šå­˜æ”¾å˜é•¿å­—æ®µçš„é•¿åº¦</strong><br>æ”¯æŒVARCHARç­‰å˜æˆå­—æ®µç±»å‹çš„ï¼Œç»“æ„</li></ul><ol><li>çœŸæ­£çš„æ•°æ®å†…å®¹</li><li>å ç”¨çš„å­—èŠ‚æ•°<br>æ‰€æœ‰å˜é•¿å­—æ®µçš„çœŸå®å ç”¨é•¿åº¦ï¼ŒæŒ‰ç…§åˆ—é¡ºåºçš„<strong>é€†åº</strong>æ¥è¿›è¡Œå­˜æ”¾ã€‚<br>è¿™ä¸ªé•¿åº¦å ç”¨çš„å­—èŠ‚æ•°ï¼š<br>å¦‚æœå¯å˜å­—æ®µå…è®¸çš„æœ€å¤§å­—èŠ‚æ•°è¶…è¿‡255å­—èŠ‚ï¼Œå¹¶ä¸”çœŸå®å­˜å‚¨çš„å­—èŠ‚æ•°è¶…è¿‡127å­—èŠ‚ï¼Œå°±ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºè¿™ä¸ªé•¿åº¦ï¼Œå¦åˆ™ä½¿ç”¨ä¸€ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºã€‚</li></ol><ul><li>NULLå€¼åˆ—è¡¨<br>Compactå°†åˆ—ä¸­çš„NULLå€¼ç»Ÿä¸€è¿›è¡Œç®¡ç†ã€‚è€Œä¸æ˜¯æ”¾åœ¨çœŸå®æ•°æ®é‡Œé¢ï¼Œä»è€Œå‡å°‘å­˜å‚¨å ç”¨<br>è¿›è¡Œçš„æµç¨‹ï¼š</li></ul><ol><li>ç»Ÿè®¡å…è®¸å­˜å‚¨NULLå€¼çš„åˆ—æœ‰å“ªäº›ï¼Œå¦‚æœä¸å­˜åœ¨ï¼ŒNULLå€¼åˆ—è¡¨å°±ä¸å­˜åœ¨äº†</li><li>è¡¨ç¤ºå½¢å¼ï¼šä½¿ç”¨1è¡¨ç¤ºä¸ºNULLå€¼ï¼Œ0è¡¨ç¤ºä¸ä¸ºNULLï¼ŒæŒ‰ç…§<strong>é€†åº</strong>æ’åºã€‚</li><li>è¦æ±‚NULLå€¼åˆ—è¡¨å¿…é¡»ä½¿ç”¨æ•´ä¸ªå­—èŠ‚çš„ä½æ¥è¡¨ç¤ºï¼Œå¦‚æœä¸è¶³ä½æ•°ï¼Œå°±åœ¨æœ€å‰é¢è¡¥0<img src="/2024/09/14/10/NULL%E5%80%BC%E8%A1%A8%E7%A4%BA.png"></li></ol><ul><li><p>è®°å½•å¤´ä¿¡æ¯<img src="/2024/09/14/10/%E8%AE%B0%E5%BD%95%E5%A4%B4%E4%BF%A1%E6%81%AF.png"></p></li><li><p>è®°å½•çš„çœŸå®æ•°æ®</p><blockquote><p>è®°å½•çš„çœŸå®æ•°æ®é™¤äº†ä¼šæœ‰æˆ‘ä»¬å®šä¹‰çš„æ•°æ®ï¼Œè¿˜ä¼šæœ‰MySQLä¸ºæ¯ä¸€æ¡è®°å½•æ·»åŠ çš„ä¸€äº›éšè—åˆ—<img src="/2024/09/14/10/%E9%9A%90%E8%97%8F%E5%88%97.png"></p><ol><li>row_id è¡Œidï¼Œå”¯ä¸€æ ‡è¯†ä¸€æ¡è®°å½•<br>2.(trx_id) transaction_id äº‹åŠ¡IDï¼ŒMVCCä¸­ä¼šä½¿ç”¨</li><li>roll_pointer å›æ»šæŒ‡é’ˆï¼Œäº‹åŠ¡å›æ»šä¼šç”¨åˆ°ï¼Œundo_logç›¸å…³</li></ol></blockquote></li><li><p>ä¸»é”®é€‰å–ï¼š<br>ä¼˜å…ˆä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„ä¸»é”®ï¼Œå¦‚æœæ²¡è®¾ç½®å°±é€‰æ‹©ä¸€ä¸ªUniqueçš„é”®ä½œä¸ºä¸»é”®ï¼Œå¦‚æœä¸å­˜åœ¨è¿™ç§ï¼Œå°±ç”Ÿæˆä¸€ä¸ªéšè—çš„row_idä½œä¸ºä¸»é”®ï¼Œæ‰€ä»¥ row_idä¸æ˜¯ <strong>å¿…é¡»çš„</strong></p></li></ul><p><em>å¯¹äºCHAR(M)ï¼ŒMySQLä¼šä¸ºåˆ†é…å¤§äºè¿™ä¸ªå€¼çš„ç©ºé—´ï¼Œå¹¶ä¸”è¦æ±‚è‡³å°‘å ç”¨Mä¸ªå­—èŠ‚ï¼Œå³ä½¿å­˜çš„æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ä¹Ÿä¼šå ç”¨Mä¸ªå­—èŠ‚ï¼Œè€ŒVARCHAR(M)æ²¡æœ‰è¿™ä¸ªè¦æ±‚ã€‚</em></p><p>ç›®çš„æ˜¯ï¼šå¦‚æœåç»­æ›´æ–°CHAR(M)çš„å¤§å°ï¼Œå°±æ— éœ€åˆ†é…ä¸€ä¸ªé¢å¤–çš„è®°å½•ç©ºé—´ï¼Œç›´æ¥åœ¨åŸè®°å½•ä¸Šè¿›è¡Œæ›´æ–°å³å¯ã€‚å°±ä¸ä¼šé€ æˆç¢ç‰‡ç©ºé—´ã€‚</p><ul><li>Redundantè¡Œæ ¼å¼(è€ä¸œè¥¿ï¼Œä¸å¸¸ç”¨äº†)</li></ul><h4 id="æº¢å‡ºæ•°æ®å­˜å‚¨"><a href="#æº¢å‡ºæ•°æ®å­˜å‚¨" class="headerlink" title="æº¢å‡ºæ•°æ®å­˜å‚¨"></a>æº¢å‡ºæ•°æ®å­˜å‚¨</h4><p>å¯å˜æ•°æ®ç±»å‹éœ€è¦å ç”¨3éƒ¨åˆ†çš„å­˜å‚¨ç©ºé—´ï¼š</p><ol><li>çœŸå®æ•°æ®</li><li>çœŸå®æ•°æ®å ç”¨å­—èŠ‚çš„é•¿åº¦</li><li>NULLå€¼æ ‡è¯†ï¼Œå¦‚æœè¯¥åˆ—æœ‰NOT NULLå±æ€§åˆ™å¯ä»¥æ²¡æœ‰è¿™éƒ¨åˆ†å­˜å‚¨ç©ºé—´<br>å¦‚æœè¦å­˜å‚¨çš„åˆ—éå¸¸å¤§ ï¼Œåªä¼šä¿å­˜å®é™…çœŸå®æ•°æ®çš„ä¸€éƒ¨åˆ†ï¼ŒæŠŠå‰©ä½™çš„æ•°æ®åˆ†æ•£åœ¨å‡ ä¸ªå…¶ä»–é¡µä¸­ã€‚</li></ol><h2 id="æ•°æ®é¡µ-é‡ç‚¹ï¼Œé‡ä¸­ä¹‹é‡"><a href="#æ•°æ®é¡µ-é‡ç‚¹ï¼Œé‡ä¸­ä¹‹é‡" class="headerlink" title="æ•°æ®é¡µ(é‡ç‚¹ï¼Œé‡ä¸­ä¹‹é‡)"></a>æ•°æ®é¡µ(é‡ç‚¹ï¼Œé‡ä¸­ä¹‹é‡)</h2><p><img src="/2024/09/14/10/InnoDB%E6%95%B0%E6%8D%AE%E9%A1%B5.png"><br>å¤§å°16KB</p><ul><li>File Header æ–‡ä»¶å¤´éƒ¨ï¼Œè®°å½•é¡µçš„ä¸€äº›é€šç”¨ä¿¡æ¯</li><li>Page Header é¡µé¢å¤´éƒ¨ï¼Œæ•°æ®é¡µä¸“æœ‰</li><li>Infimum + Supremum æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•ï¼Œ è™šæ‹Ÿè¡Œè®°å½•</li><li>User Records ç”¨æˆ·è®°å½•  å®é™…å­˜å‚¨çš„è¡Œè®°å½•å†…å®¹ï¼Œä¸€å¼€å§‹æ²¡æœ‰ï¼Œæ¯æ¬¡ä»Free Spaceä¸­åˆ†é…ç©ºé—´</li><li>Free Space ç©ºé—²ç©ºé—´ é¡µä¸­æœªä½¿ç”¨çš„ç©ºé—´</li><li>PageDirectory é¡µé¢ç›®å½•  é¡µä¸­æŸäº›è®°å½•çš„ç›¸å¯¹ä½ç½®</li><li>File Trailer æ–‡ä»¶å°¾éƒ¨   æ£€éªŒé¡µæ˜¯å¦å®Œæ•´</li></ul><h3 id="è®°å½•å¤´ä¿¡æ¯"><a href="#è®°å½•å¤´ä¿¡æ¯" class="headerlink" title="è®°å½•å¤´ä¿¡æ¯"></a>è®°å½•å¤´ä¿¡æ¯</h3><ol><li>delete_mask æ ‡è®°è®°å½•æ˜¯å¦è¢«åˆ é™¤ï¼Œå…ˆåšä¸€ä¸ªæ ‡è®°å®é™…è¿˜åœ¨ç£ç›˜é‡Œè¿˜æ²¡åˆ é™¤ã€‚æ‰€æœ‰åˆ é™¤æ‰çš„è®°å½•ä¼šç»„æˆä¸€ä¸ªåƒåœ¾é“¾è¡¨ï¼Œå¦‚æœåç»­æœ‰æ–°çš„è®°å½•æ’å…¥è¡¨ä¸­ï¼Œå¯èƒ½ä¼šç›´æ¥è¦†ç›–è¿™äº›è¢«åˆ é™¤çš„è®°å½•ç©ºé—´</li><li>min_rec_mask B+æ ‘çš„æ¯å±‚éå¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°è®°å½•éƒ½ä¼šæ·»åŠ è¯¥æ ‡è®°</li><li>n_owned è¡¨ç¤ºå½“å‰è®°å½•æ‹¥æœ‰çš„è®°å½•æ•°</li><li>heap_no è¡¨ç¤ºå½“å‰è®°å½•åœ¨è®°å½•å †çš„ä½ç½®ä¿¡æ¯ã€‚</li><li>record_type è®°å½•ç±»å‹  0æ™®é€šè®°å½•ï¼Œ 1 B+æ ‘éå¶å­èŠ‚ç‚¹è®°å½• 2æœ€å°è®°å½• 3æœ€å¤§è®°å½•</li><li>next_record è¡¨ç¤ºä»å½“å‰è®°å½•çš„<strong>çœŸå®æ•°æ®</strong>åˆ°ä¸‹ä¸€æ¡è®°å½•çš„<strong>çœŸå®æ•°æ®</strong>çš„åœ°å€åç§»é‡ã€‚ æŒ‡å‘è¿™ä¸ªä½ç½®ï¼Œå‘å·¦å°±æ˜¯è®°å½•å¤´ä¿¡æ¯ï¼Œå‘å³è¯»å°±æ˜¯çœŸå®æ•°æ®ï¼ŒåŒæ—¶å› ä¸ºå˜é•¿å­—æ®µåˆ—è¡¨å’ŒNULLå€¼åˆ—è¡¨éƒ½æ˜¯é€†åºå­˜æ”¾çš„ ï¼Œæ‰€ä»¥å¯ä»¥ä½¿å¾—çœŸå®æ•°æ®å’Œä»–ä»¬å¯¹åº”çš„é•¿åº¦åœ¨å†…å­˜ä¸­çš„åœ°å€æ›´è¿‘ï¼Œèƒ½å¤Ÿæé«˜ç¼“å­˜çš„å‘½ä¸­ç‡</li></ol><h3 id="æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•"><a href="#æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•" class="headerlink" title="æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•"></a>æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•</h3><p>æœ€å°è®°å½•heap_no = 0<br>æœ€å¤§è®°å½•heap_no = 1<br><img src="/2024/09/14/10/%E6%9C%80%E5%B0%8F%E8%AE%B0%E5%BD%95%E5%92%8C%E6%9C%80%E5%A4%A7%E8%AE%B0%E5%BD%95.png"><br>è¿™ä¸¤ä¸ªè®°å½•æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæ‰€ä»¥ä¸æ”¾åœ¨User_Recordä¸­<br><strong>é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ˜¯æŒ‰ç…§ä¸»é”®å€¼ä»å°åˆ°å¤§çš„é¡ºåºè¿æ¥èµ·æ¥çš„</strong></p><h3 id="MySQLæ˜¯å¦‚ä½•è¿›è¡ŒæŸ¥æ‰¾çš„"><a href="#MySQLæ˜¯å¦‚ä½•è¿›è¡ŒæŸ¥æ‰¾çš„" class="headerlink" title="MySQLæ˜¯å¦‚ä½•è¿›è¡ŒæŸ¥æ‰¾çš„"></a>MySQLæ˜¯å¦‚ä½•è¿›è¡ŒæŸ¥æ‰¾çš„</h3><p>å¯¹äºä¸»é”®æŸ¥æ‰¾è®°å½•ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ‘ä»¬çŸ¥é“MySQLä¸­çš„è®°å½•æ˜¯æ ¹æ®é“¾è¡¨ä»å°åˆ°å¤§è¿æ¥èµ·æ¥çš„ï¼Œé‚£ä¹ˆå¦‚ä½•å¿«é€Ÿä»ä¸æ”¯æŒéšæœºè®¿é—®çš„é“¾è¡¨ä¸­æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„æ•°æ®å‘¢ï¼Ÿ</p><h3 id="Page-Directory"><a href="#Page-Directory" class="headerlink" title="Page Directory"></a>Page Directory</h3><p>MySQLä¸­çš„è®¾è®¡ï¼š</p><ol><li>å°†æ‰€æœ‰çš„æ­£å¸¸è®°å½•(ä¸åŒ…æ‹¬æœ€å°å’Œæœ€å¤§è®°å½•)åˆ’åˆ†ä¸ºå¤šä¸ªç»„</li><li>æ¯ä¸ªç»„çš„æœ€åä¸€æ¡ä¿¡æ¯è®°å½•çš„n_ownedè®°å½•è¿™ä¸ªç»„ä¸­æœ‰å¤šå°‘æ¡è®°å½•</li><li>å°†æ¯ä¸ªç»„çš„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡å•ç‹¬æå–å‡ºå‡ºæ¥æŒ‰ç…§é¡ºåºå­˜å‚¨åˆ°é è¿‘ é¡µ å°¾éƒ¨çš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯Page Directoryé¡µç›®å½•ï¼Œè¿™äº›åç§»é‡è¢«ç§°ä¸ºSlot æ§½</li><li>æœ€å°è®°å½•ä¸ºå•ç‹¬ä¸€ä¸ªç»„ï¼Œæœ€å¤§è®°å½•æ‰€åœ¨çš„åˆ†ç»„æ¡æ•°åªèƒ½åœ¨1<del>8æ¡ï¼Œå…¶ä½™åˆ†ç»„åªèƒ½æœ‰4</del>8æ¡è®°å½•</li></ol><h3 id="æŸ¥æ‰¾è¿‡ç¨‹"><a href="#æŸ¥æ‰¾è¿‡ç¨‹" class="headerlink" title="æŸ¥æ‰¾è¿‡ç¨‹"></a>æŸ¥æ‰¾è¿‡ç¨‹</h3><ol><li>æ ¹æ®æ§½åˆ—è¡¨é€šè¿‡äºŒåˆ†æ³•æ¥è®¡ç®—ä¸­é—´å€¼ï¼Œé»˜è®¤low æ˜¯æœ€å°è®°å½•çš„å€¼ï¼Œä¹Ÿå°±æ˜¯0ï¼Œ highæ˜¯æœ€å¤§è®°å½•çš„åç§»é‡</li><li>é€šè¿‡å¯¹æ¯”ä¸­é—´æ§½çš„åç§»é‡çš„å€¼å¿«é€Ÿå®šä½åˆ°æ‰€åœ¨çš„è®°å½•çš„ä½ç½®ï¼Œæ¯”å¯¹è¿™æ¡è®°å½•çš„ä¸»é”®å€¼</li><li>å¯¹æ¯”ä¹‹åæ¥ç€é€šè¿‡äºŒåˆ†æ³•åå¤å®šä½ï¼Œç›´åˆ° heigh -  low = 1æ—¶ï¼Œä¹Ÿå°±ç¡®è®¤æ‰€éœ€è¦çš„è®°å½•çš„æ•°æ®æ‰€åœ¨çš„ç»„</li><li>é€šè¿‡éå†é“¾è¡¨æ‰¾åˆ°è¯¥æ§½ä¸­çš„ä¸»é”®å€¼å€¼æœ€å°çš„é‚£æ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€ä¸ªæ§½æ‰€å¯¹åº”çš„é‚£æ¡è®°å½•çš„ä¸‹ä¸€æ¡</li><li>é€šè¿‡next_recordå³å¯éå†è¯¥æ§½æ‰€åœ¨çš„ç»„çš„å„ä¸ªè®°å½•</li></ol><h3 id="Page-Header-é¡µé¢å¤´éƒ¨"><a href="#Page-Header-é¡µé¢å¤´éƒ¨" class="headerlink" title="Page Header é¡µé¢å¤´éƒ¨"></a>Page Header é¡µé¢å¤´éƒ¨</h3><blockquote><p>All problems in computer science can be solved by another level of indirection<br>è®¡ç®—æœºç§‘å­¦ä¸­çš„æ‰€æœ‰é—®é¢˜éƒ½å¯ä»¥é€šè¿‡å¢åŠ ä¸€ä¸ªé—´æ¥å±‚æ¥è§£å†³</p></blockquote><p>åœ¨ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥åœ¨ä¸€ä¸ªæ•°æ®é¡µå†…éƒ¨å¿«é€Ÿå®šä½åˆ°æˆ‘ä»¬æ‰€éœ€è¦çš„è®°å½•ï¼Œä½†æ˜¯ä¸€å¼ è¡¨ä¸­ä¸ä»…ä»…å­˜åœ¨ä¸€ä¸ªæ•°æ®é¡µï¼Œå¦‚ä½•å¿«é€Ÿå®šä½åˆ°æˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®é¡µå‘¢?<br>ç­”æ¡ˆæ˜¯å†åŠ ä¸€å±‚æŠ½è±¡ï¼šå¯¹äºæ¯ä¸€ä¸ªä¸‹å±‚ï¼Œæˆ‘ä»¬éƒ½å¯¹å…¶è¿›è¡ŒæŠ½è±¡ï¼Œå±è”½æ‰å…¶å†…éƒ¨ç»†èŠ‚ï¼Œæ–¹ä¾¿ä¸Šå±‚ä½¿ç”¨ã€‚</p><blockquote><p>Page Header ä½äºé¡µç»“æ„çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨é¡µæ€»çš„å„ç§ä¿¡æ¯ï¼Œæ¯”å¦‚ç¬¬ä¸€æ¡è®°å½•çš„åœ°å€æ˜¯ä»€ä¹ˆï¼Œæœ¬é¡µå­˜å‚¨äº†å¤šå°‘åœ°å€ï¼Œé¡µç›®å½•å­˜å‚¨äº†å¤šå°‘ä¸ªæ§½</p></blockquote><p>ä¸»è¦çš„ä¿¡æ¯ï¼š</p><ul><li>FIL_PAGE_SPAE_OR_CHECKSUMï¼šæ ¡éªŒå’Œï¼Œé€šè¿‡ç®—æ³•æ¥è®¡ç®—ä¸€ä¸ªå€¼ï¼Œæ–¹ä¾¿æˆ‘ä»¬å»æ¯”è¾ƒ</li><li>FIL_PAGE_OFFSETï¼šé¡µå·ï¼Œç”¨äºå®šä½é¡µ</li><li>FIL_PAGE_TYPEï¼šé¡µç±»å‹ï¼Œå­˜æ”¾è®°å½•çš„é¡µå°±æ˜¯ç´¢å¼•é¡µï¼Œä¹Ÿæ˜¯æ•°æ®é¡µ</li><li>FIL_PAGE_PREVå’ŒFIL_PAGE_NEXTï¼šç”¨äºç»„æˆåŒå‘é“¾è¡¨</li></ul><h3 id="File-Trailer"><a href="#File-Trailer" class="headerlink" title="File Trailer"></a>File Trailer</h3><ol><li>å­˜å‚¨é¡µçš„æ ¡éªŒå’Œï¼šä¸Headeréƒ¨åˆ†ä¸­çš„æ ¡éªŒå’Œå¯¹åº”ï¼Œå¦‚æœåŒæ­¥ç£ç›˜ä¸­åŒæ­¥åˆ°ä¸€åŠå°±å¤±è´¥äº†ï¼Œé‚£ä¹ˆHeaderä¸­çš„æ ¡éªŒå’Œå°±ä¼šå˜æˆå·²ç»ä¿®æ”¹åçš„æ ¡éªŒå’Œï¼Œè€ŒTrailerçš„æ ¡éªŒå’Œè¿˜ä»£è¡¨ç€åŸæ¥çš„æ ¡éªŒå’Œï¼Œä»è€Œç¡®å®šåŒæ­¥å‡ºç°é”™è¯¯</li><li>é¡µé¢æœ€åè¢«ä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®LSN</li></ol><h3 id="æ•°æ®é¡µç»“æ„æ€»ç»“"><a href="#æ•°æ®é¡µç»“æ„æ€»ç»“" class="headerlink" title="æ•°æ®é¡µç»“æ„æ€»ç»“"></a>æ•°æ®é¡µç»“æ„æ€»ç»“</h3><ul><li>File Header </li><li>Page Header</li><li>Infimum + Supremum </li><li>User Records</li><li>Free Space</li><li>Page Directory</li><li>File Trailer</li></ul><h2 id="ç´¢å¼•ï¼"><a href="#ç´¢å¼•ï¼" class="headerlink" title="ç´¢å¼•ï¼"></a>ç´¢å¼•ï¼</h2><p>ä»¥ä¸‹éƒ¨åˆ†æ˜¯é‡ä¸­ä¹‹é‡ï¼Œå¯ä»¥è¯´è¿™ç¯‡æ–‡ç« å°±æ˜¯ä¸ºäº†è¿™é‡Œæ‰æœ‰å†™çš„å¿…è¦çš„<br><del>æŒ‡é¢è¯•çš„æ—¶å€™å› ä¸ºå¿˜äº†è€Œè¢«ç–¯ç‹‚æ‹·æ‰“</del></p><h3 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h3><ol><li>InnoDBä¸­æ•°æ®é¡µé€šè¿‡åŒå‘é“¾è¡¨è¿æ¥èµ·æ¥</li><li>æ•°æ®é¡µå†…éƒ¨çš„è®°å½•é€šè¿‡åŒå‘é“¾è¡¨è¿æ¥èµ·æ¥ï¼Œå¹¶ä¸”æŒ‰ç…§ä¸»é”®ä»å°åˆ°å¤§è¿›è¡Œæ’åº</li><li>Page Directory ä¿å­˜äº†æ¯ç»„è®°å½•æœ€åä¸€æ¡è®°å½•çš„åç§»é‡ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¿«é€Ÿå®šä½åˆ°æ¯ä¸ªç»„<br><img src="/2024/09/14/10/%E7%89%A9%E7%90%86%E7%BB%93%E6%9E%84%E5%9B%9E%E9%A1%BE.png"></li></ol><h3 id="ç´¢å¼•ä¸ºä»€ä¹ˆä¼šå‡ºç°"><a href="#ç´¢å¼•ä¸ºä»€ä¹ˆä¼šå‡ºç°" class="headerlink" title="ç´¢å¼•ä¸ºä»€ä¹ˆä¼šå‡ºç°"></a>ç´¢å¼•ä¸ºä»€ä¹ˆä¼šå‡ºç°</h3><ol><li>å¯¹äºä¸»é”®æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¾è®¡å¿«é€Ÿå®šä½ï¼Œè€Œå¯¹äºå…¶ä»–åˆ—ï¼Œæˆ‘ä»¬æ²¡æœ‰è¿™ç§æ–¹ä¾¿çš„æ–¹å¼å¯ä»¥å¿«é€Ÿå®šä½</li><li>å¯¹äºä¸åŒçš„é¡µï¼Œæˆ‘ä»¬ä¹Ÿæ²¡åŠæ³•å¿«é€Ÿå®šä½åˆ°æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„è®°å½•æ‰€åœ¨çš„é¡µåœ¨å“ªé‡Œï¼Œä»è€Œåªèƒ½ä¸€ä¸ªä¸€ä¸ªè¿›è¡ŒæŸ¥æ‰¾</li></ol><h3 id="ç´¢å¼•çš„ç»“æ„ä¸å®ç°åŸç†"><a href="#ç´¢å¼•çš„ç»“æ„ä¸å®ç°åŸç†" class="headerlink" title="ç´¢å¼•çš„ç»“æ„ä¸å®ç°åŸç†"></a>ç´¢å¼•çš„ç»“æ„ä¸å®ç°åŸç†</h3><ol><li>æ•°æ®é¡µé“¾è¡¨ä¸­ï¼Œåä¸€ä¸ªæ•°æ®é¡µä¸­çš„ä¸»é”®å€¼å¿…é¡»å¤§äºä¸Šä¸€ä¸ªé¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼ã€‚</li><li>ä»¿ç…§Page Directoryï¼Œå°†æ•°æ®é¡µä¸­çš„é“¾è¡¨é¡¹å»ºç«‹ç›®å½•</li><li>keyä¸ºæ•°æ®é¡µä¸­æœ€å°çš„ä¸»é”®ï¼Œpage_noä¸ºé¡µå·<img src="/2024/09/14/10/%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%841.png"></li></ol><h4 id="MySQLä¸­çš„å®ç°"><a href="#MySQLä¸­çš„å®ç°" class="headerlink" title="MySQLä¸­çš„å®ç°"></a>MySQLä¸­çš„å®ç°</h4><ol><li>ä½¿ç”¨æ•°æ®é¡µæ¥å­˜å‚¨ç›®å½•é¡¹ï¼Œé€šè¿‡record_type(0ç”¨æˆ·è®°å½•ï¼Œ1ç›®å½•é¡¹è®°å½•ï¼Œ2æœ€å°è®°å½•ï¼Œ3æœ€å¤§è®°å½•)  æ¥ä¸ç”¨æˆ·è®°å½•è¿›è¡ŒåŒºåˆ†<img src="/2024/09/14/10/%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%842.png"></li><li>ä¸€ä¸ªæ•°æ®é¡µä¸­å­˜å‚¨çš„è®°å½•æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨é“¾è¡¨çš„å½¢å¼å°†ç›®å½•ä¸²èµ·æ¥ï¼Œä¿è¯åä¸€ä¸ªé¡µä¸­çš„é¡µå·è¦å¤§äºå‰ä¸€ä¸ª</li><li>ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ä»ç›®å½•é“¾è¡¨ä¸­å¿«é€Ÿå®šä½ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡å°†å…¶ä½¿ç”¨ç›®å½•è®°å½•<img src="/2024/09/14/10/%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%843.png"></li><li>åå¤ä¹‹åå°±å½¢æˆäº†B+æ ‘</li></ol><blockquote><p>B+æ ‘å’ŒBæ ‘çš„åŒºåˆ«ï¼š<br>B+æ ‘åªåœ¨æœ€åº•å±‚çš„èŠ‚ç‚¹ä¸Šå­˜å‚¨çœŸå®æ•°æ®ï¼Œå…¶ä½™éƒ½æ˜¯ç”¨æ¥å­˜å‚¨ç›®å½•é¡¹çš„ï¼ŒBæ ‘çš„ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹éƒ½èƒ½ä¿å­˜æ•°æ®</p></blockquote><h3 id="èšç°‡ç´¢å¼•-é‡ç‚¹"><a href="#èšç°‡ç´¢å¼•-é‡ç‚¹" class="headerlink" title="èšç°‡ç´¢å¼•(é‡ç‚¹)"></a>èšç°‡ç´¢å¼•(é‡ç‚¹)</h3><p>å®šä¹‰ï¼š</p><ol><li>ä½¿ç”¨ä¸»é”®å€¼çš„å¤§å°è¿›è¡Œè®°å½•å’Œé¡µçš„æ’åºï¼š<ul><li>é¡µå†…è®°å½•æŒ‰ç…§ä¸»é”®å¤§å°çš„å•å‘é“¾è¡¨</li><li>å­˜æ”¾ç”¨æˆ·è®°å½•çš„é¡µæ ¹æ®ä¸»é”®å¤§å°æ’æˆåŒå‘é“¾è¡¨</li><li>å­˜æ”¾ç›®å½•é¡¹çš„é¡µä¹Ÿæ˜¯åŒä¸€å±‚æ¬¡æ’æˆåŒå‘é“¾è¡¨</li></ul></li><li>å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯å®Œæ•´è®°å½•(åŒ…æ‹¬éšè—åˆ—)<br>ç´¢å¼•å³æ•°æ®ï¼Œæ•°æ®å³ç´¢å¼•ã€‚</li></ol><h3 id="äºŒçº§ç´¢å¼•"><a href="#äºŒçº§ç´¢å¼•" class="headerlink" title="äºŒçº§ç´¢å¼•"></a>äºŒçº§ç´¢å¼•</h3><ol><li>ä½¿ç”¨éä¸»é”®å€¼ä½œä¸ºæ’åºæ ‡å‡†<ul><li>åŒèšç°‡ç´¢å¼•ï¼Œä¸è¿‡æ ‡å‡†æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„éä¸»é”®</li></ul></li><li>B+æ ‘çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ è¿™ä¸ªåˆ— + ä¸»é”®ä¸¤ä¸ªåˆ—çš„å€¼</li><li>ç›®å½•é¡¹è®°å½•å­˜çš„æ˜¯ è¿™ä¸ªåˆ— + é¡µå· + ä¸»é”®<img src="/2024/09/14/10/%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95.png"><br>æŸ¥è¯¢è¿‡ç¨‹ï¼š<br>ä¾‹å¦‚æŸ¥è¯¢c2çš„å€¼ä¸º4çš„è®°å½•ï¼š</li><li>æ ¹æ®é¡µ44ï¼Œ 2 &lt; 4 &lt; 9ï¼Œå¯ä»¥å®šä½åˆ°é¡µ42</li><li>c2æ²¡æœ‰å”¯ä¸€çº¦æŸï¼Œæ‰€ä»¥4å¯èƒ½åœ¨å¤šä¸ªè®°å½•ä¸­ï¼Œç”±æ­¤å¯¹æ¯”å¯ä»¥ç¡®å®šåº”è¯¥åœ¨é¡µ34å’Œé¡µ35ï¼Œå› ä¸º 2 &lt;4 &lt; 5</li><li>å®šä½åˆ°å…·ä½“çš„è®°å½•</li><li>é€šè¿‡å…·ä½“è®°å½•ä¸­çš„ä¸»é”®å€¼è¿›è¡Œå›è¡¨æ“ä½œâ€”&gt; ä¹Ÿå°±æ˜¯æ ¹æ®ä¸»é”®å€¼å»èšç°‡ç´¢å¼•ä¸­å†æŸ¥æ‰¾ä¸€éå®Œæ•´çš„ç”¨æˆ·è®°å½•</li></ol><h4 id="å›è¡¨çš„å¥½å"><a href="#å›è¡¨çš„å¥½å" class="headerlink" title="å›è¡¨çš„å¥½å"></a>å›è¡¨çš„å¥½å</h4><p>ä¼˜ç‚¹ï¼š<br>å¯ä»¥ä¸ç”¨é‡æ–°å­˜å‚¨å®Œæ•´çš„æ•°æ®ï¼Œå‡å°‘ç©ºé—´å ç”¨<br>ç¼ºç‚¹ï¼š<br>å›è¡¨ä¼šæµªè´¹é¢å¤–çš„æ—¶é—´</p><h3 id="è”åˆç´¢å¼•-é‡ç‚¹ï¼ŒåŠ ä¸ªä¹¦ç­¾"><a href="#è”åˆç´¢å¼•-é‡ç‚¹ï¼ŒåŠ ä¸ªä¹¦ç­¾" class="headerlink" title="è”åˆç´¢å¼•(é‡ç‚¹ï¼ŒåŠ ä¸ªä¹¦ç­¾)"></a>è”åˆç´¢å¼•(é‡ç‚¹ï¼ŒåŠ ä¸ªä¹¦ç­¾)</h3><p>æ¯”å¦‚å¯¹c2ã€c3å»ºç«‹è”åˆç´¢å¼•</p><ol><li>è®°å½•å’Œé¡µæŒ‰ç…§c2è¿›è¡Œæ’åº</li><li>åœ¨è¿™ä¸ªåŸºç¡€ä¸Šå¯¹c3è¿›è¡Œæ’åº</li><li>å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯c2ã€c3å’Œä¸»é”®çš„å€¼</li><li>ä»ç„¶æ˜¯ä¸€ä¸ªäºŒçº§ç´¢å¼•ï¼Œä¹Ÿæ˜¯éœ€è¦å›è¡¨çš„</li></ol><h3 id="MyISAMç´¢å¼•æ–¹æ¡ˆçš„å·®åˆ«"><a href="#MyISAMç´¢å¼•æ–¹æ¡ˆçš„å·®åˆ«" class="headerlink" title="MyISAMç´¢å¼•æ–¹æ¡ˆçš„å·®åˆ«"></a>MyISAMç´¢å¼•æ–¹æ¡ˆçš„å·®åˆ«</h3><ol><li>InnoDBä½¿ç”¨ç´¢å¼•å³æ•°æ®ï¼Œè€ŒMyISAMå°†ç´¢å¼•å’Œæ•°æ®åˆ†å¼€å­˜å‚¨ã€‚</li><li>å°†æ•°æ®å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä½¿ç”¨è¡Œå·æ¥å¿«é€Ÿè®¿é—®ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¸»é”®å€¼è¿›è¡Œæ’åºï¼Œæ— æ³•è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾</li><li>ç´¢å¼•æ–‡ä»¶ä¸­å­˜å‚¨çš„æ˜¯ä¸»é”®å€¼ + è¡Œå·ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰æŸ¥è¯¢éƒ½éœ€è¦å›è¡¨ï¼Œå…¨æ˜¯äºŒçº§ç´¢å¼•</li><li>è”åˆç´¢å¼•å­˜å‚¨çš„ä¹Ÿæ˜¯è¡Œå· + ç›¸åº”çš„åˆ—</li></ol><h3 id="åˆ›å»ºå’Œåˆ é™¤ç´¢å¼•çš„sql"><a href="#åˆ›å»ºå’Œåˆ é™¤ç´¢å¼•çš„sql" class="headerlink" title="åˆ›å»ºå’Œåˆ é™¤ç´¢å¼•çš„sql"></a>åˆ›å»ºå’Œåˆ é™¤ç´¢å¼•çš„sql</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE è¡¨å(åˆ—ä¿¡æ¯,KEY / INDEX ç´¢å¼•å (éœ€è¦è¢«ç´¢å¼•çš„å•ä¸ªåˆ—æˆ–è€…å¤šä¸ªåˆ—ï¼Œè”åˆç´¢å¼•ä½¿ç”¨ , éš”å¼€åˆ—))ALTER TABLE è¡¨å ADD INDEX / KEY ç´¢å¼•å (åˆ—)ALTER TABLE è¡¨å DROP INDEX / KEY ç´¢å¼•å<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç´¢å¼•çš„ä¸€äº›å¸¸è§å…«è‚¡å’Œå¦‚ä½•åˆç†ä½¿ç”¨B-æ ‘ç´¢å¼•"><a href="#ç´¢å¼•çš„ä¸€äº›å¸¸è§å…«è‚¡å’Œå¦‚ä½•åˆç†ä½¿ç”¨B-æ ‘ç´¢å¼•" class="headerlink" title="ç´¢å¼•çš„ä¸€äº›å¸¸è§å…«è‚¡å’Œå¦‚ä½•åˆç†ä½¿ç”¨B+æ ‘ç´¢å¼•"></a>ç´¢å¼•çš„ä¸€äº›å¸¸è§å…«è‚¡å’Œå¦‚ä½•åˆç†ä½¿ç”¨B+æ ‘ç´¢å¼•</h3><h4 id="å¦‚ä½•é¿å…å›è¡¨ï¼Ÿ"><a href="#å¦‚ä½•é¿å…å›è¡¨ï¼Ÿ" class="headerlink" title="å¦‚ä½•é¿å…å›è¡¨ï¼Ÿ"></a>å¦‚ä½•é¿å…å›è¡¨ï¼Ÿ</h4><p>éœ€è¦å›è¡¨è®°å½•è¶Šå¤šï¼Œä½¿ç”¨äºŒçº§ç´¢å¼•çš„æ€§èƒ½å°±è¶Šä½ã€‚<br>è¦†ç›–ç´¢å¼•ï¼š<br>åœ¨æŸ¥è¯¢åˆ—è¡¨ä¸­åªåŒ…å«ç´¢å¼•åˆ—ï¼Œå³å¯é¿å…å›è¡¨ã€‚æ‰€ä»¥ä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨ * ä½œä¸ºæŸ¥è¯¢åˆ—è¡¨ï¼Œæœ€å¥½æŠŠéœ€è¦æŸ¥è¯¢çš„åˆ—éƒ½ä¾æ¬¡æ ‡æ˜</p><h4 id="è®¿é—®æ–¹æ³•"><a href="#è®¿é—®æ–¹æ³•" class="headerlink" title="è®¿é—®æ–¹æ³•"></a>è®¿é—®æ–¹æ³•</h4><h5 id="å…¨è¡¨æ‰«æ"><a href="#å…¨è¡¨æ‰«æ" class="headerlink" title="å…¨è¡¨æ‰«æ"></a>å…¨è¡¨æ‰«æ</h5><h5 id="ç´¢å¼•æ‰«æ"><a href="#ç´¢å¼•æ‰«æ" class="headerlink" title="ç´¢å¼•æ‰«æ"></a>ç´¢å¼•æ‰«æ</h5><p>p139ï¼Œæ¥ç€çœ‹</p><h4 id="æœ€é€‚åˆå»ºç«‹ç´¢å¼•çš„åœºæ™¯"><a href="#æœ€é€‚åˆå»ºç«‹ç´¢å¼•çš„åœºæ™¯" class="headerlink" title="æœ€é€‚åˆå»ºç«‹ç´¢å¼•çš„åœºæ™¯"></a>æœ€é€‚åˆå»ºç«‹ç´¢å¼•çš„åœºæ™¯</h4><ol><li>å…¨å€¼åŒ¹é…ï¼šæœç´¢æ¡ä»¶çš„åˆ—å’Œç´¢å¼•åˆ—ä¸€è‡´ï¼Œå¯ä»¥å¿«é€Ÿä½¿ç”¨ç´¢å¼•</li><li>è”åˆç´¢å¼•æœ€å·¦åŒ¹é…åŸåˆ™</li><li>å‰ç¼€åŒ¹é… abc%</li><li>ç´¢å¼•åˆ—çš„èŒƒå›´æŸ¥æ‰¾</li><li>å¯¹æŸ¥æ‰¾å‡ºçš„ç´¢å¼•åˆ—æ•°æ®è¿›è¡Œæ’åºï¼šç´¢å¼•åˆ—æœ¬æ¥å°±æ˜¯åŸºäºæ’åºçš„ï¼Œæ‰€ä»¥å¯ä»¥ä¸éœ€è¦å†å†…å­˜æˆ–æ–‡ä»¶ä¸­è¿›è¡Œæ’åº</li></ol><h4 id="ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯"><a href="#ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯" class="headerlink" title="ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯"></a>ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯</h4><ol><li>LiIKEæ“ä½œç¬¦ä»¥é€šé…ç¬¦å¼€å¤´ä¾‹å¦‚ â€œ%xxâ€æˆ– â€œ%xx%â€ ï¼Œä½†æ˜¯ â€œxx%â€ å¯ä»¥ä½¿ç”¨ç´¢å¼•ã€‚</li><li>å¯¹ç´¢å¼•ä½¿ç”¨å‡½æ•°æˆ–è€…è¡¨è¾¾å¼æ“ä½œ <code>select * from t_user where length(name)=6 </code>ï¼Œ å› ä¸ºç´¢å¼•å­˜çš„æ˜¯åŸå§‹å€¼</li><li>å¯¹ç´¢å¼•éšå¼è½¬æ¢ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­çš„ç±»å‹å’Œåˆ—çš„ç±»å‹ä¸åŒ¹é…ï¼ŒMySQLå¯èƒ½ä¼šè¿›è¡Œç±»å‹è½¬æ¢ï¼Œç´¢å¼•å°±ä¼šå¤±æ•ˆã€‚å› ä¸ºç´¢å¼•å­˜çš„æ˜¯åŸå§‹å€¼</li><li>è”åˆç´¢å¼•éæœ€å·¦åŒ¹é…ï¼Œå¤šä¸ªæ™®é€šå­—æ®µç»„åˆåœ¨ä¸€èµ·åˆ›å»ºçš„ç´¢å¼•å«åšè”åˆç´¢å¼•ï¼Œä¸éµå¾ªæœ€å·¦ä¼˜å…ˆçš„æ–¹å¼å°±ä¼šå¤±æ•ˆã€‚</li><li>whereå­å¥ä¸­ä½¿ç”¨äº†ORï¼Œå¦‚æœORåçš„æ¡ä»¶ä¸æ˜¯ç´¢å¼•åˆ—å°±ä¼šå¤±æ•ˆ</li><li>å‡ºç°NULLå€¼ï¼š<strong>ä¸ä¸€å®šä¸èµ°ç´¢å¼•</strong> ï¼Œéœ€è¦çœ‹æŸ¥è¯¢çš„costå’Œä¼˜åŒ–å™¨çš„é€‰æ‹©ã€‚</li><li>è”åˆç´¢å¼•æ²¡æœ‰å¯¹æœ€å·¦åˆ—è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾<br>ä¸ºä½•å¤±æ•ˆ</li><li>like %xxï¼šæˆ‘ä»¬ç´¢å¼•æ˜¯æ ¹æ®åˆ—çš„å€¼å¤§å°è¿›è¡Œæ’åˆ—çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯¹ å°å†™å­—æ¯å»ºç«‹ç´¢å¼•ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç´¢å¼•å…¨æ˜¯åŸºäº a -&gt; zçš„å¤§å°é¡ºåºæ’åˆ—çš„ï¼ŒåŒæ—¶æˆ‘ä»¬æ˜¯æŒ‰ç…§å­—å…¸åºçš„æ–¹å¼è¿›è¡Œæ’åºï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå‰ä¸€ä¸ªç›¸åŒæ‰ä¼šå»æ ¹æ®åé¢çš„å­—æ¯è¿›è¡Œæ’åºï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬åŒ¹é…abc%xxxçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é¡ºç€è¿™ä¸ªç´¢å¼•å»æŸ¥è¯¢ï¼Œè€Œæˆ‘ä»¬åŒ¹é… %abcæ—¶ï¼Œæˆ‘ä»¬æ— æ³•ç¡®è®¤%ä¹‹å‰çš„çš„å­—æ¯æ˜¯ä»€ä¹ˆï¼Œäºæ˜¯æˆ‘ä»¬å¿…é¡»èµ°ä¸€æ¬¡å…¨è¡¨åŒ¹é…æ‰€ä»¥æ— æ³•èµ°ç´¢å¼•å»å»åŒ¹é…</li><li>ä½¿ç”¨å‡½æ•°ä¿®æ”¹çš„åˆ—ä¸æ»¡è¶³æœ€åŸå§‹çš„æ’åºäº†</li><li>è”åˆç´¢å¼•ï¼Œé€šè¿‡ä¸Šæ–‡ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šçš„æ˜ç™½è”åˆç´¢å¼•å®é™…ä¸Šå°±æ˜¯å…ˆæŒ‰ç…§åˆ—çš„é¡ºåºå»å»ºç«‹ç´¢å¼•ï¼Œåªæœ‰å‰ä¸€ä¸ªåˆ—ç›¸åŒï¼Œæˆ‘ä»¬æ‰ä¼šæ ¹æ®åä¸€ä¸ªåˆ—è¿›è¡Œæ’åºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªæœ‰è¿™ç§é¡ºåºèƒ½å¤Ÿä¿è¯æ˜¯æŒ‰ç…§å¤§å°æ’åºã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰éµå¾ªæœ€å·¦åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯å°†é¡ºåºå€’ç½®ï¼Œé‚£ä¹ˆåé¢çš„åˆ—æ˜¯ä¸èƒ½æ»¡è¶³å¤§å°æ’åºçš„ï¼Œä¹Ÿå°±æ— æ³•èµ°ç´¢å¼•</li><li>è”åˆç´¢å¼•åªæœ‰æœ€å·¦åˆ—æ˜¯å®Œå…¨æŒ‰ç…§å¤§å°æ’åºçš„ï¼ŒåŒæ—¶æ•°æ®æ˜¯åŸºäºé“¾è¡¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥å¾ˆè½»æ˜“å°†æœ€å·¦åˆ—çš„èŒƒå›´æŸ¥æ‰¾å–å‡ºã€‚</li></ol><h4 id="å»ºç«‹ç´¢å¼•æ—¶åº”è¯¥è€ƒè™‘ä»€ä¹ˆï¼Ÿé‡ç‚¹"><a href="#å»ºç«‹ç´¢å¼•æ—¶åº”è¯¥è€ƒè™‘ä»€ä¹ˆï¼Ÿé‡ç‚¹" class="headerlink" title="å»ºç«‹ç´¢å¼•æ—¶åº”è¯¥è€ƒè™‘ä»€ä¹ˆï¼Ÿé‡ç‚¹"></a>å»ºç«‹ç´¢å¼•æ—¶åº”è¯¥è€ƒè™‘ä»€ä¹ˆï¼Ÿé‡ç‚¹</h4><ol><li>åªä¸ºç”¨äºæœç´¢ã€æ’åºã€åˆ†ç»„çš„åˆ—å»ºç«‹ç´¢å¼•ï¼Œå‡ºç°åœ¨æŸ¥è¯¢åˆ—è¡¨ä¸­çš„åˆ—å°±æ²¡å¿…è¦å»ºç«‹ç´¢å¼•äº†ï¼Œå› ä¸ºèµ°ä¸èµ°ç´¢å¼•è¿˜æ˜¯çœ‹æŸ¥è¯¢æ¡ä»¶ã€æ’åºæ¡ä»¶ã€åˆ†ç»„æ¡ä»¶ï¼Œè€Œä¸æ˜¯æŸ¥è¯¢çš„åˆ—</li><li>è€ƒè™‘åˆ—çš„åŸºæ•°(ä¸é‡å¤çš„æ•°æ®çš„ä¸ªæ•°)ï¼Œä¸ºåŸºæ•°å¤§çš„åˆ—å»ºç«‹ç´¢å¼•æ•ˆæœæ›´å¥½</li><li>ç´¢å¼•çš„ç±»å‹å°½é‡å°ï¼Œå› ä¸ºæ•°æ®ç±»å‹è¶Šå°ï¼ŒæŸ¥è¯¢æ—¶å ç”¨çš„å­˜å‚¨ç©ºé—´è¶Šå°‘ï¼ŒæŸ¥è¯¢é€Ÿåº¦è¶Šå¿«ï¼Œæ•°æ®é¡µä¸­å¯ä»¥æ”¾ä¸‹æ›´å¤šçš„è®°å½•ã€‚</li><li>å¯¹äºä¸€äº›è¾ƒé•¿çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥åªå¯¹å…¶å‰ç¼€å»ºç«‹ç´¢å¼•<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE person_info( name VARCHAR(100) NOT NULL, birthday DATE NOT NULL, phone_number CHAR(11) NOT NULL, country varchar(100) NOT NULL, KEY idx_name_birthday_phone_number (name(10), birthday, phone_number));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>è®©ç´¢å¼•åˆ—åœ¨æ¯”è¾ƒè¡¨è¾¾å¼ä¸­å•ç‹¬å‡ºç°ï¼šè¿™ä¸ªå’Œä½¿ç”¨å‡½æ•°å»ä¿®é¥°ç´¢å¼•åˆ—æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œä¼šæ”¹å˜ç´¢å¼•åˆ—çš„åŸæ¥çš„å½¢å¼ï¼Œä»è€Œä¸èƒ½å¤Ÿèµ°ç´¢å¼•ã€‚ä¾‹å¦‚:<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">WHERE c1 * 2 &lt; 4æ›¿æ¢ä¸ºWHERE c1 &lt; 4 / 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li>æ’å…¥æ•°æ®æ—¶åº”è¯¥æ³¨æ„ä¸»é”®çš„é¡ºåºï¼Œå› ä¸ºå½“æ•°æ®é¡µæ»¡äº†ï¼Œå†æ’å…¥è®°å½•æ—¶ï¼Œä¼šå¯¼è‡´é¡µåˆ†è£‚-&gt;å°†æœ¬é¡µä¸­çš„ä¸€äº›è®°å½•ç§»åŠ¨åˆ°æ–°åˆ›å»ºçš„é‡ç§ï¼Œä»è€Œéœ€è¦å°†è®°å½•è½¬ç§»ï¼Œå¸¦æ¥æ€§èƒ½æ¶ˆè€—ï¼Œæ‰€ä»¥æ¨èè®©ä¸»é”®å…·æœ‰AUTO_INCREMENT</li></ol><h2 id="è¿æ¥"><a href="#è¿æ¥" class="headerlink" title="è¿æ¥"></a>è¿æ¥</h2><h3 id="å¾ªç¯åµŒå¥—è¿æ¥"><a href="#å¾ªç¯åµŒå¥—è¿æ¥" class="headerlink" title="å¾ªç¯åµŒå¥—è¿æ¥"></a>å¾ªç¯åµŒå¥—è¿æ¥</h3><p>ä¸¤è¡¨è¿æ¥ï¼Œé©±åŠ¨è¡¨åªè®¿é—®ä¸€æ¬¡ï¼Œè€Œè¢«é©±åŠ¨è¡¨è¦è®¿é—®å¤šæ¬¡ã€‚<br>å·¦å¤–è¿æ¥å·¦è¾¹çš„æ˜¯é©±åŠ¨è¡¨ã€‚å³å¤–è¿æ¥å³è¾¹çš„è¡¨æ˜¯é©±åŠ¨è¡¨<br>ç„¶åæ¯ä¸€ä¸ªè¢«é©±åŠ¨è¡¨å…¶å®éƒ½æ˜¯ä¸€æ¬¡å¾ªç¯ï¼Œå¤šä¸ªè¡¨å¾ªç¯åµŒå¥—ï¼Œé©±åŠ¨è¡¨çš„æ¯ä¸€è¡Œéƒ½è¦å»éå†è¢«é©±åŠ¨è¡¨ã€‚è¿™ç§è¿æ¥è¢«ç§°ä¸ºåµŒå¥—å¾ªç¯è¿æ¥ã€‚</p><h2 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h2><h3 id="redo-log"><a href="#redo-log" class="headerlink" title="redo log"></a>redo log</h3><p>redo log ä¼šæŠŠäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯¹æ•°æ®åº“æ‰€åšçš„æ‰€æœ‰çš„ä¿®æ”¹éƒ½è®°å½•ä¸‹æ¥ï¼Œä¹‹åç³»ç»Ÿå´©æºƒé‡å¯åå¯ä»¥æŠŠäº‹åŠ¡æ‰€åšçš„ä»»ä½•æ“ä½œéƒ½å›å¤å‡ºæ¥ã€‚</p><h3 id="æ ¼å¼"><a href="#æ ¼å¼" class="headerlink" title="æ ¼å¼"></a>æ ¼å¼</h3><p><img src="/2024/09/14/10/redolog.png"></p><ul><li>typeï¼šè¡¨ç¤ºè¯¥redoæ—¥å¿—çš„ç±»å‹</li><li>space IDï¼šè¡¨ç©ºé—´ID</li><li>page numberï¼šé¡µå·</li><li>dataï¼šè¯¥æ¡redo æ—¥å¿—çš„å…·ä½“å†…å®¹<br>åˆ·ç›˜æ—¶æœºï¼š</li><li>å½“log bufferç©ºé—´ä¸è¶³æ—¶ï¼Œå½“redo logå æ»¡äº†log bufferçš„ä¸€åŠå·¦å³</li><li>äº‹åŠ¡æäº¤æ—¶</li><li>åå°çº¿ç¨‹è‡ªåŠ¨åˆ·æ–°ï¼Œçº¦æ˜¯æ¯ç§’ä¸€æ¬¡</li><li>æ­£å¸¸å…³é—­æœåŠ¡å™¨æ—¶</li></ul><h3 id="redo-log-å¦‚ä½•ä¿è¯äº‹åŠ¡çš„å®Œæ•´æ€§çš„"><a href="#redo-log-å¦‚ä½•ä¿è¯äº‹åŠ¡çš„å®Œæ•´æ€§çš„" class="headerlink" title="redo log å¦‚ä½•ä¿è¯äº‹åŠ¡çš„å®Œæ•´æ€§çš„"></a>redo log å¦‚ä½•ä¿è¯äº‹åŠ¡çš„å®Œæ•´æ€§çš„</h3><h2 id="undo-log"><a href="#undo-log" class="headerlink" title="undo log"></a>undo log</h2><p>undo log æ˜¯å•ç‹¬å­˜å‚¨çš„</p><p><img src="/2024/09/14/10/undolog%E6%A0%BC%E5%BC%8F.png"></p><ul><li>trx_idäº‹åŠ¡id<br>è¢«åˆ é™¤çš„è®°å½•ä¹Ÿä¼šé€šè¿‡è®°å½•å¤´ä¿¡æ¯ä¸­çš„next_recordç»„æˆä¸€ä¸ªå•é¡¹é“¾è¡¨ï¼Œç„¶åæŒ‡å‘PAGE_FREEç©ºé—´<img src="/2024/09/14/10/PAGE_FREE.png"><br>äº‹åŠ¡æäº¤ä¹‹å‰ï¼Œè¢«åˆ é™¤çš„è®°å½•çš„delete_maskä¼šè¢«è®¾ç½®ä¸º1ï¼Œä½†æ˜¯ä¸ä¼šè¢«åŠ å…¥åƒåœ¾é“¾è¡¨ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¼šå¤„äºä¸­é—´æ€</li></ul><h2 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h2><p>åªé MVCCä¸èƒ½è§£å†³å¹»è¯»ï¼Œéœ€è¦é¢å¤–ä½¿ç”¨é”</p><h3 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><ol><li>æ¯ä¸€è¡Œçš„æ•°æ®éƒ½æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œæ›´æ–°æ—¶ä¸ä¼šè¦†ç›–åŸæ¥çš„æ•°æ®ï¼Œè€Œæ˜¯ç”Ÿæˆæ–°çš„ç‰ˆæœ¬ã€‚</li><li>è¯»æ“ä½œæ ¹æ®ReadViewå»è¯»</li><li>å†™æ“ä½œï¼Œæ—§çš„ç‰ˆæœ¬ä¸ä¼šè¢«åˆ é™¤ï¼Œè€Œæ˜¯æ”¾åœ¨åƒåœ¾é“¾è¡¨ï¼Œå°†åŸæ¥çš„æ•°æ®å†™å…¥undo logä¹‹åï¼Œé€šè¿‡roll_idæŒ‡å‘è¿™ä¸€è¡Œçš„undo log</li></ol><h3 id="äº‹åŠ¡éš”ç¦»ç­‰çº§å’Œå‡ ä¸ªå¹¶å‘ä¼šå‡ºç°çš„é—®é¢˜"><a href="#äº‹åŠ¡éš”ç¦»ç­‰çº§å’Œå‡ ä¸ªå¹¶å‘ä¼šå‡ºç°çš„é—®é¢˜" class="headerlink" title="äº‹åŠ¡éš”ç¦»ç­‰çº§å’Œå‡ ä¸ªå¹¶å‘ä¼šå‡ºç°çš„é—®é¢˜"></a>äº‹åŠ¡éš”ç¦»ç­‰çº§å’Œå‡ ä¸ªå¹¶å‘ä¼šå‡ºç°çš„é—®é¢˜</h3><h4 id="å¹¶å‘å¸¸è§åˆ°çš„é—®é¢˜"><a href="#å¹¶å‘å¸¸è§åˆ°çš„é—®é¢˜" class="headerlink" title="å¹¶å‘å¸¸è§åˆ°çš„é—®é¢˜"></a>å¹¶å‘å¸¸è§åˆ°çš„é—®é¢˜</h4><ol><li>è„è¯»ï¼šä¸€ä¸ªäº‹åŠ¡è¯»åˆ°äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡ä¿®æ”¹è¿‡çš„æ•°æ®</li><li>ä¸å¯é‡å¤è¯»ï¼šä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–è¯»å–åˆ°çš„æ•°æ®ä¸åŒï¼Œä¹Ÿå°±æ˜¯ä¸¤æ¬¡è¯»å–ä¹‹é—´è¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹äº†æ•°æ®</li><li>å¹»è¯»ï¼šç›¸åŒçš„æŸ¥è¯¢ï¼ŒæŸ¥å‡ºæ¥çš„ç»“æœä¸åŒ<br>å‡ ä¸ªç­‰çº§ï¼š<br>è„å†™ &lt; è„è¯» &lt; ä¸å¯é‡å¤è¯» &lt; å¹»è¯»</li></ol><h4 id="äº‹åŠ¡éš”ç¦»ç­‰çº§"><a href="#äº‹åŠ¡éš”ç¦»ç­‰çº§" class="headerlink" title="äº‹åŠ¡éš”ç¦»ç­‰çº§"></a>äº‹åŠ¡éš”ç¦»ç­‰çº§</h4><ol><li>è¯»æœªæäº¤ï¼šå…è®¸ä¸€ä¸ªäº‹åŠ¡è¯»å–å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ® é˜»æ­¢ä¸äº†ä¸Šé¢å‡ ç§</li><li>è¯»å·²æäº¤ï¼šåªå…è®¸ä¸€ä¸ªäº‹åŠ¡è¯»å–å¦ä¸€ä¸ªäº‹åŠ¡å·²ç»æäº¤çš„ä¿®æ”¹ï¼Œå¯ä»¥é˜»æ­¢è„è¯»</li><li>å¯é‡å¤è¯»ï¼šä¿è¯åŒä¸€ä¸ªäº‹åŠ¡å¤šæ¬¡è¯»å–è·å¾—çš„æ•°æ®æ˜¯ç›¸åŒçš„ï¼Œé¿å…äº†è„è¯»ã€ä¸å¯é‡å¤è¯»</li><li>å¯ä¸²è¡ŒåŒ–ï¼šå®Œå…¨éš”ç¦»äº‹åŠ¡ï¼Œç¡®ä¿äº‹åŠ¡æŒ‰ç…§é¡ºåºæ‰§è¡Œï¼Œå½·ä½›ä»–ä»¬æ˜¯ä¸²è¡Œæ‰§è¡Œçš„</li></ol><h4 id="ç‰ˆæœ¬é“¾"><a href="#ç‰ˆæœ¬é“¾" class="headerlink" title="ç‰ˆæœ¬é“¾"></a>ç‰ˆæœ¬é“¾</h4><p>rolle_pointerï¼šæ¯æ¬¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œä¼šå°†åŸæ¥çš„æ—§ç‰ˆæœ¬å†™å…¥åˆ°undoæ—¥å¿—ä¸­ï¼Œç„¶åè¿™ä¸ªéšè—åˆ—å°±ç›¸å½“äºä¸€ä¸ªæŒ‡é’ˆï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥æ‰¾åˆ°è¯¥è®°å½•ä¿®æ”¹ä¹‹å‰çš„ä¿¡æ¯ã€‚<img src="/2024/09/14/10/%E7%89%88%E6%9C%AC%E9%93%BE.png"><br>æ¯æ¬¡å¯¹è®°å½•è¿›è¡Œæ›´æ–°åï¼Œéƒ½ä¼šå°†æ—§å€¼æ”¾åˆ°ä¸€æ¡undoæ—¥å¿—ä¸­ï¼Œå°±ç®—æ˜¯è¯¥è®°å½•ä¸­çš„ä¸€ä¸ªæ—§ç‰ˆæœ¬ï¼Œéšç€æ›´æ–°æ¬¡æ•°çš„å¢å¤šï¼Œæ‰€æœ‰çš„ç‰ˆæœ¬éƒ½ä¼šè¢«role_pointerè¿æ¥æˆä¸€ä¸ªé“¾è¡¨ï¼Œç‰ˆæœ¬é“¾çš„å¤´èŠ‚ç‚¹å°±æ˜¯å½“å‰è®°å½•çš„æœ€æ–°å€¼ï¼Œå¦å¤–ï¼Œæ¯ä¸ªç‰ˆæœ¬è¿˜åŒ…å«è¯¥ç‰ˆæœ¬æ—¶å¯¹åº”çš„äº‹åŠ¡id</p><h4 id="ReadView"><a href="#ReadView" class="headerlink" title="ReadView"></a>ReadView</h4><p>å¦‚ä½•åˆ¤æ–­ä¸€æ¡è®°å½•æ˜¯å¦å¯ä»¥è¢«æŸä¸ªäº‹åŠ¡å¯è§ã€‚<br>ReadViewçš„å†…å®¹</p><ul><li>m_idsï¼šè¡¨ç¤ºç”ŸæˆReadViewæ—¶å½“å‰ç³»ç»Ÿä¸­æ´»è·ƒè¯»å†™äº‹åŠ¡idåˆ—è¡¨</li><li>min_trx_idï¼šè¡¨ç¤ºç”ŸæˆReadViewæ—¶ï¼Œå½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„æœ€å°äº‹åŠ¡ä¸­çš„æœ€å°äº‹åŠ¡idï¼Œä¹Ÿå°±æ˜¯m_idsçš„æœ€å°å€¼</li><li>max_trx_idï¼šç”ŸæˆReadViewæ—¶ç³»ç»Ÿåº”è¯¥åˆ†é…ç»™ä¸‹ä¸€ä¸ªäº‹åŠ¡çš„idå€¼ã€‚</li><li>creator_trx_idï¼šè¡¨ç¤ºç”Ÿæˆè¯¥ReadViewçš„äº‹åŠ¡çš„äº‹åŠ¡id<br>å½“äº‹åŠ¡è®¿é—®æŸæ¡è®°å½•æ—¶ï¼Œè¿›è¡Œä¸€ä¸‹åˆ¤æ–­è®¿é—®æ˜¯å¦å¯è§ï¼š</li><li>è¢«è®¿é—®ç‰ˆæœ¬çš„trx_id == ReadViewä¸­çš„creator_trx_idæ—¶ï¼Œæ„å‘³ç€å½“å‰äº‹åŠ¡è®¿é—®çš„æ˜¯è‡ªå·±ä¿®æ”¹è¿‡çš„è®°å½•ï¼Œå¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®</li><li>trx_id &lt; ReadViewä¸­çš„min_trx_idï¼Œè¡¨ç¤ºè¯¥ç‰ˆæœ¬æ˜¯åœ¨å½“å‰äº‹åŠ¡ä¹‹å‰æ—§å·²ç»æäº¤äº†ï¼Œå¯ä»¥è®¿é—®</li><li>trx_id &gt; max_trx_idï¼Œè¡¨ç¤ºå½“å‰è®°å½•çš„äº‹åŠ¡æ˜¯åœ¨å½“å‰äº‹åŠ¡ä¹‹åæ‰å¼€å§‹çš„ï¼Œä¸èƒ½è®¿é—®</li><li>min_trx_id &lt; trx_id &lt; max_trx_idï¼Œè¯´æ˜åˆ›å»ºReadViewæ—¶ï¼Œè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡è¿˜æ˜¯æ´»è·ƒçš„ï¼Œéœ€è¦ä»m_idsä¸­åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±ä¸èƒ½è®¿é—®ï¼Œå¦åˆ™å°±å¯ä»¥è®¿é—®<br>å¦‚æœæŸä¸ªç‰ˆæœ¬çš„æ•°æ®å¯¹äºå½“å‰çš„äº‹åŠ¡ä¸å¯è§ï¼Œå°±æ²¿ç€ç‰ˆæœ¬é“¾å»æ‰¾ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œå¦‚æœç‰ˆæœ¬é“¾ä¸­æ‰€æœ‰çš„æ•°æ®éƒ½ä¸å¯è§ï¼Œæ‰æ„å‘³ç€è¿™æ¡è®°å½•å¯¹å½“å‰äº‹åŠ¡ä¸å¯è§ï¼ŒæŸ¥è¯¢æ¡ä»¶å°±ä¸ä¼šåŒ…æ‹¬è¿™æ¡è®°å½•ã€‚</li></ul><h4 id="è¯»å·²æäº¤å’Œå¯é‡å¤è¯»çš„åŒºåˆ«"><a href="#è¯»å·²æäº¤å’Œå¯é‡å¤è¯»çš„åŒºåˆ«" class="headerlink" title="è¯»å·²æäº¤å’Œå¯é‡å¤è¯»çš„åŒºåˆ«"></a>è¯»å·²æäº¤å’Œå¯é‡å¤è¯»çš„åŒºåˆ«</h4><p>åŒºåˆ«å°±æ˜¯äºŒè€…çš„ReadViewç”Ÿæˆæ—¶æœºä¸åŒï¼š</p><ul><li>è¯»å·²æäº¤åœ¨æ¯æ¬¡æ‰§è¡ŒæŸ¥è¯¢è¯­å¥æ—¶ç”Ÿæˆä¸€ä¸ªReadViewï¼Œæ­¤åä¸ä¼šå†é‡å¤ç”Ÿæˆäº†</li><li>å¯é‡å¤è¯»åªåœ¨ç¬¬ä¸€æ¬¡è¿›è¡ŒæŸ¥è¯¢è¯­å¥æ—¶ç”Ÿæˆä¸€ä¸ªReadViewï¼Œæ­¤åæŸ¥è¯¢æ“ä½œéƒ½é‡å¤ä½¿ç”¨è¿™ä¸ªReadViewï¼Œä»è€Œåšåˆ°ä¿è¯å¤šæ¬¡è¯»å–è¯»å–åˆ°ç›¸åŒçš„æ•°æ®ã€‚</li></ul><h2 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h2><h3 id="é”çš„ç»“æ„"><a href="#é”çš„ç»“æ„" class="headerlink" title="é”çš„ç»“æ„"></a>é”çš„ç»“æ„</h3><p><img src="/2024/09/14/10/%E9%94%81%E7%9A%84%E7%BB%93%E6%9E%84.png"><br>å¯¹äºæ¯ä¸€æ¡è®°å½•ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªé”å¯¹åº”ã€‚å½“ä¸€ä¸ªäº‹åŠ¡ç›¸å¯¹è¿™æ¡è®°å½•åšæ”¹åŠ¨æ—¶ï¼Œé¦–å…ˆä¼šçœ‹çœ‹å†…å­˜ä¸­æ˜¯å¦æœ‰ä¸è¿™æ¡è®°å½•æƒ³å…³è”çš„é”ç»“æ„ï¼Œå¦‚æœæ²¡æœ‰å°±éœ€è¦ç”Ÿæˆä¸€ä¸ªé”ç»“æ„ä¸ä¹‹å…³è”ã€‚<br>æ‰€ç»“æ„ä¸­çš„æœ€é‡è¦çš„ä¸¤ä¸ªå±æ€§ï¼š</p><ul><li>trxä¿¡æ¯ï¼šè¿™ä¸ªé”ç»“æ„æ˜¯ç”±å“ªä¸ªäº‹åŠ¡ç”Ÿæˆçš„</li><li>is_waitingï¼šä»£è¡¨å½“å‰äº‹åŠ¡æ˜¯å¦åœ¨ç­‰å¾…</li></ul><ol><li>è·å–é”æˆåŠŸ/åŠ é”ï¼šå½“äº‹åŠ¡ä¿®æ”¹è¿™æ¡è®°å½•æ—¶ï¼Œå¦‚æœä¸å­˜åœ¨é”ï¼Œå°±ä¼šåœ¨ä¿®æ”¹è®°å½•ä¹‹åç”Ÿæˆä¸€ä¸ªé”æœºæ„1ï¼Œtrxæ˜¯è¿™ä¸ªäº‹åŠ¡çš„idï¼Œis_waitingæ˜¯falseã€‚</li><li>è·å–é”å¤±è´¥ï¼šå½“å…¶ä»–äº‹åŠ¡å°è¯•ä¿®æ”¹è¿™æ¡è®°å½•æ—¶å‘ç°å­˜åœ¨äº†å¦‚æœå‘ç°å·²ç»å­˜åœ¨äº†è¿™ä¸ªé”1ï¼Œé‚£ä¹ˆå°±ä¼šç»™è‡ªå·±ç”Ÿæˆä¸€ä¸ªé”2ï¼Œä½†æ˜¯is_waitingæ˜¯trueï¼Œè¡¨ç¤ºéœ€è¦ç­‰å¾…ã€‚</li><li>å½“äº‹åŠ¡1æ­£å¸¸æäº¤ä¹‹åä¼šæŠŠè¯¥äº‹åŠ¡ç”Ÿæˆçš„é”ç»“æ„1åˆ é™¤ï¼Œç„¶åæŸ¥çœ‹æ˜¯å¦è¿˜æœ‰å…¶ä»–åˆ«çš„äº‹åŠ¡åœ¨ç­‰å¾…è·å–é”ï¼Œå‘ç°äº‹åŠ¡2åœ¨ç­‰å¾…ï¼Œäºæ˜¯å°±å°†é”2çš„is_waitingè®¾ç½®ä¸ºfalseï¼Œä¹‹åå°†è¿™ä¸ªäº‹åŠ¡çš„çº¿ç¨‹å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œã€‚</li></ol><h4 id="ä¸€è‡´æ€§è¯»"><a href="#ä¸€è‡´æ€§è¯»" class="headerlink" title="ä¸€è‡´æ€§è¯»"></a>ä¸€è‡´æ€§è¯»</h4><p>äº‹åŠ¡ä½¿ç”¨MVCCè¿›è¡Œè¯»å–è¢«ç§°ä¸ºä¸€è‡´æ€§è¯»ï¼Œæˆ–è€…ä¸€è‡´æ€§æ— é”è¯»ï¼Œä¹Ÿå«å¿«ç…§è¯»ã€‚</p><h4 id="é”å®šè¯»"><a href="#é”å®šè¯»" class="headerlink" title="é”å®šè¯»"></a>é”å®šè¯»</h4><p>è¡Œçº§é”<br>å¯¹äºè¯»å†™å†²çªé—®é¢˜ï¼ŒMySQLä½¿ç”¨äº†MVCC+é”æ¥è§£å†³</p><ol><li>å…±äº«é”ï¼šShared Locks Sé”ï¼Œè¯»å–è®°å½•æ—¶éœ€è¦å…ˆè·å–è¯¥è®°å½•çš„Sé”</li><li>ç‹¬å é”ï¼šä¹Ÿå«æ’ä»–é”ï¼Œ Xé”ï¼Œä¿®æ”¹è®°å½•æ—¶éœ€è¦é²œæ´»çš„è¯¥è®°å½•çš„Xé”ã€‚<br>ä¸»åŠ¨åŠ é”çš„sql<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT ... LOCK IN SHARE MODE; # åŠ Sé”SELECT ... FOR UPDATE; # åŠ Xé”<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol><h3 id="å¤šç²’åº¦é”"><a href="#å¤šç²’åº¦é”" class="headerlink" title="å¤šç²’åº¦é”"></a>å¤šç²’åº¦é”</h3><p>ä¸Šæ–‡æåˆ°çš„éƒ½æ˜¯è¡Œçº§é”</p><ul><li>æ„å‘å…±äº«é” ISé”ï¼šè¡¨çº§é”</li><li>æ„å‘ç‹¬å é” IXé”ï¼šè¡¨çº§é”<br>è¿™ä¸¤ä¸ªé”æ—¶ä¸ºäº†ä¹‹åå¯¹è¡¨æ·»åŠ è¡¨çº§åˆ«çš„Sé”å’ŒXé”æ—¶å¯ä»¥å¿«åˆ¤æ–­è¡¨ä¸­çš„è®°å½•æ˜¯å¦è¢«ä¸Šé”ï¼Œä»¥å…éœ€è¦ä½¿ç”¨éå†æ¥ç¡®å®šæ˜¯å¦æœ‰è®°å½•è¢«ä¸Šé”äº†ã€‚</li></ul><h3 id="InnoDBä¸­çš„é”"><a href="#InnoDBä¸­çš„é”" class="headerlink" title="InnoDBä¸­çš„é”"></a>InnoDBä¸­çš„é”</h3><h4 id="è¡¨çº§é”"><a href="#è¡¨çº§é”" class="headerlink" title="è¡¨çº§é”"></a>è¡¨çº§é”</h4><ul><li>è¡¨çº§çš„Sé”ã€Xé”ï¼š</li><li>è¡¨çº§çš„ISé”ã€IXé”ï¼š</li><li>è¡¨çº§çš„AUTO-INCé”ï¼šè‡ªå¢AUTO_INCREMENTä¿®é¥°çš„åˆ—é€’å¢èµ‹å€¼</li></ul><h4 id="è¡Œçº§é”-é‡ç‚¹"><a href="#è¡Œçº§é”-é‡ç‚¹" class="headerlink" title="è¡Œçº§é”(é‡ç‚¹)"></a>è¡Œçº§é”(é‡ç‚¹)</h4><ul><li>Record Locksï¼šæ­£ç»è®°å½•é”ï¼Œåˆ†ä¸ºSé”å’ŒXé”</li><li>Gap Locksï¼šé—´éš™é”ï¼ŒåŠ é”æ–¹æ¡ˆè§£å†³å¹»è¯»çš„å…³é”®</li><li>Next-Keyé”ï¼šç®€å•æ¥è¯´å°±æ˜¯ record locks + gap locks</li><li>Insert Intention Locksï¼šäº‹åŠ¡åœ¨ç­‰å¾…çš„æ—¶å€™ä¹Ÿéœ€è¦åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªé”ç»“æ„ï¼Œè¡¨æ˜æœ‰äº‹åŠ¡æƒ³åœ¨æŸä¸ªé—´éš™ä¸­æ’å…¥æ–°è®°å½•ã€‚å«åšæ’å…¥æ„å‘é”ï¼Œç›®çš„æ˜¯é¿å…æ’å…¥æ“ä½œçš„ç›¸äº’é˜»å¡</li></ul><h4 id="Gap-Locks"><a href="#Gap-Locks" class="headerlink" title="Gap Locks"></a>Gap Locks</h4><p>å¯¹äºå¹»è¯»ä¸­å‡ºç°çš„å¹»å½±è®°å½•ï¼Œæˆ‘ä»¬æ²¡æ³•åŠ é”ï¼Œå› ä¸ºä»–ä»¬è¿˜æœªå­˜åœ¨ã€‚<br>é—´éš™é”å°±æ˜¯æ‰€è‘—ä¸€ä¸ªèŒƒå›´å†…æ‰€æœ‰çš„é—´éš™ï¼Œä»è€Œé˜»æ­¢å…¶äº‹åŠ¡åœ¨è¿™äº›é—´éš™ä¸­æ’å…¥æ•°æ®</p><h1 id="å…«è‚¡"><a href="#å…«è‚¡" class="headerlink" title="å…«è‚¡"></a>å…«è‚¡</h1><h2 id="InnoDBä¸ºä»€ä¹ˆæ˜¯é»˜è®¤å¼•æ“"><a href="#InnoDBä¸ºä»€ä¹ˆæ˜¯é»˜è®¤å¼•æ“" class="headerlink" title="InnoDBä¸ºä»€ä¹ˆæ˜¯é»˜è®¤å¼•æ“"></a>InnoDBä¸ºä»€ä¹ˆæ˜¯é»˜è®¤å¼•æ“</h2><ol><li>å”¯ä¸€æ”¯æŒäº‹åŠ¡çš„å¼•æ“</li><li>è¡Œçº§é”</li><li>æ”¯æŒå¤–é”®çº¦æŸ</li><li>å´©æºƒæ¢å¤ï¼Œredologå’Œundolog</li></ol><h2 id="ä¸ºä»€ä¹ˆInnoDBä½¿ç”¨B-æ ‘"><a href="#ä¸ºä»€ä¹ˆInnoDBä½¿ç”¨B-æ ‘" class="headerlink" title="ä¸ºä»€ä¹ˆInnoDBä½¿ç”¨B+æ ‘"></a>ä¸ºä»€ä¹ˆInnoDBä½¿ç”¨B+æ ‘</h2><ol><li>æ”¯æŒå¿«é€ŸæŸ¥æ‰¾ï¼šå¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘ï¼Œé«˜åº¦è¾ƒä½</li><li>æœ‰åºæ€§ï¼šç¿»éèŒƒå›´æŸ¥æ‰¾åˆ†ç»„</li><li>æ’å…¥å’Œåˆ é™¤æ›´æç¬‘ï¼šä½¿ç”¨åŒå‘é“¾è¡¨</li><li>é€‚åº”ç£ç›˜å­˜å‚¨ï¼šèŠ‚ç‚¹çš„å¤§å°æ§åˆ¶åœ¨ç£ç›˜é¡µé¢å¤§å°èŒƒå›´å†…ï¼Œå‡å°‘I/Oæ“ä½œ</li><li>æ”¯æŒæœ‰åºæŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾</li></ol><h2 id="MVCC-1"><a href="#MVCC-1" class="headerlink" title="MVCC"></a>MVCC</h2><p>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</p><ol><li>æ¯ä¸€è¡Œçš„è®°å½•éƒ½ç»´æŠ¤å¤šä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸€è¡Œæ›´æ–°æ—¶ï¼Œä¸ä¼šè¦†ç›–åŸæ¥çš„æ•°æ®ï¼Œè€Œæ˜¯ä¼šç”Ÿæˆæ–°çš„ç‰ˆæœ¬</li><li>è¯»æ“ä½œåªè¯»äº‹åŠ¡åˆ›å»ºä¹‹å‰çš„</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¾å›¢æµ‹å¼€ä¸€é¢</title>
      <link href="/2024/09/09/30/"/>
      <url>/2024/09/09/30/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¾å›¢ä¸€è¿›å®«"><a href="#ç¾å›¢ä¸€è¿›å®«" class="headerlink" title="ç¾å›¢ä¸€è¿›å®«"></a>ç¾å›¢ä¸€è¿›å®«</h1><p>ğŸ¤¡</p><h2 id="åŸºæœ¬æµç¨‹"><a href="#åŸºæœ¬æµç¨‹" class="headerlink" title="åŸºæœ¬æµç¨‹"></a>åŸºæœ¬æµç¨‹</h2><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>ä»‹ç»å®ä¹ é¡¹ç›®</li><li>[[ç¾å›¢æµ‹å¼€ä¸€é¢#ç¾å›¢ä¸€è¿›å®«#å¤šæ€æœ‰å“ªäº›|å¦‚ä½•ç†è§£å°è£…ç»§æ‰¿å’Œå¤šæ€(å¤šæ€è®°å¾—ä¸ç‰¢)]]</li><li>å­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»çš„æ–¹æ³•å—ï¼Ÿ(çœ‹å…³é”®å­—ï¼Œå¯ä»¥ç»§æ‰¿publicå’Œprotectedæ–¹æ³•ï¼Œé»˜è®¤è®¿é—®æƒé™çš„è¯å¦‚æœåœ¨ä¸€ä¸ªåŒ…å†…å¯ä»¥ç»§æ‰¿ï¼Œprivateä¸å¯ç»§æ‰¿)</li><li>å¸¸è§çš„é›†åˆ(Listï¼ŒSetï¼ŒMapï¼ŒQueueï¼ŒStack)</li><li>[[ç¾å›¢æµ‹å¼€ä¸€é¢#ç¾å›¢ä¸€è¿›å®«#ArrayListå’ŒLinkedListçš„åŒºåˆ« |ArrayListå’ŒLinkedListçš„åŒºåˆ«]]</li><li>ä»€ä¹ˆåœºæ™¯ä¸‹LinkedListæ¯”ArrayListå¥½ç”¨</li><li>HashMapå¸¸è§å…«è‚¡ï¼š<ul><li>çº¿ç¨‹æ˜¯å¦å®‰å…¨</li><li>HashTable</li><li>ConcurrentHashMap</li><li>jdk1.7å’Œ1.8çš„åŒºåˆ«</li></ul></li><li>[[ç¾å›¢æµ‹å¼€ä¸€é¢#æŠ½è±¡ç±»ï¼Œæ¥å£ï¼ŒæŠ½è±¡ç±»å’Œæ¥å£çš„å¦‚ä½•é€‰|æŠ½è±¡ç±»ï¼Œæ¥å£ï¼ŒæŠ½è±¡ç±»å’Œæ¥å£çš„å¦‚ä½•é€‰æ‹©]]</li><li>[[ç¾å›¢æµ‹å¼€ä¸€é¢#@SpringBootApplicationåŒ…å«å“ªäº›|SpringBootå¸¸è§æ³¨è§£ï¼Œ@SpringBootApplicationåŒ…å«ä»€ä¹ˆ]]</li><li>å¸¸è§çš„å¼‚å¸¸<ul><li>IOå¼‚å¸¸</li><li>SQLå¼‚å¸¸</li><li>å †å†…å­˜æº¢å‡º</li><li>ç©ºæŒ‡é’ˆ</li><li>ç´¢å¼•è¶Šç•Œ</li></ul></li><li>ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¯¼è‡´å †å†…å­˜æº¢å‡ºï¼š<ul><li>å†…å­˜æ³„æ¼ï¼šå­˜åœ¨æŸäº›æœªé‡Šæ”¾çš„å¯¹è±¡å¼•ç”¨</li><li>å¤§å¯¹è±¡åˆ†é…</li><li>æ•°æ®ç»“æ„è¿‡å¤§</li><li>æ— é™é€’å½’</li><li><strong>çº¿ç¨‹åˆ›å»ºè¿‡å¤šä¼šå¯¼è‡´å †å¤–å†…å­˜æº¢å‡º</strong></li></ul></li><li>å¸¸è§çš„ç©ºæŒ‡é’ˆå¼‚å¸¸çš„æƒ…å†µï¼š<ul><li>è®¿é—®æœªåˆå§‹åŒ–çš„å¯¹è±¡</li><li>è®¿é—®æ•°ç»„ä¸­çš„ç©ºå…ƒç´ </li><li>è®¿é—®é›†åˆä¸­çš„ç©ºå…ƒç´ ï¼šmap.put(key, null)</li><li>è‡ªåŠ¨æ‹†ç®± Integer num = null; int value = num;</li><li>å¤šçº¿ç¨‹ä¸‹ä¸€ä¸ªçº¿ç¨‹å¯èƒ½ä¼šåœ¨å¦ä¸€ä¸ªçº¿ç¨‹åˆå§‹åŒ–å¯¹è±¡ä¹‹å‰å°±è®¿é—®è¯¥å¯¹è±¡ã€‚</li></ul></li><li>å¦‚ä½•è§£å†³ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼š<ul><li>ä½¿ç”¨ä¹‹å‰å…ˆæ£€æŸ¥æ˜¯å¦ä¸ºnull</li><li>ä½¿ç”¨Optionalç±»</li><li>try-catch</li><li>å¤šçº¿ç¨‹ä¸‹ä½¿ç”¨åŒæ­¥æœºåˆ¶æ¥ä¿è¯</li></ul></li><li>debugçš„æŠ€å·§ï¼Œè¿œç¨‹debugå¦‚ä½•ä¿è¯ä¸ä¼šè¢«å…¶ä»–è¯·æ±‚å¹²æ‰°</li><li>ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨å·¥å‚æ¨¡å¼ï¼Œæœ‰ä½•ä¼˜ç‚¹<ul><li>å¯¹è±¡åˆ›å»ºé€»è¾‘è¾ƒä¸ºå¤æ‚ï¼Œå¯ä»¥å°è£…åˆ›å»ºé€»è¾‘</li><li>éœ€è¦æ ¹æ®ä¸åŒçš„æ¡ä»¶åˆ›å»ºä¸åŒçš„å¯¹è±¡æ—¶</li><li>è§£è€¦å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨</li><li>æé«˜å¯ç»´æŠ¤æ€§</li><li>ä¼˜ç‚¹ï¼šå°è£…å¯¹è±¡åˆ›å»ºçš„ç»†èŠ‚ï¼Œå‡å°‘é‡å¤ä»£ç ï¼Œæ”¯æŒæ‰©å±•æ€§</li></ul></li><li>[[ç¾å›¢æµ‹å¼€ä¸€é¢#çº¿ç¨‹æ± å‚æ•°å¦‚ä½•è®¾ç½®|çº¿ç¨‹æ± çš„å‚æ•°å¦‚ä½•è®¾ç½®]]</li><li>[[ç¾å›¢æµ‹å¼€ä¸€é¢#æ—è·¯ç¼“å­˜æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Œæœ‰æ²¡æœ‰é‡åˆ°æŸ¥è¯¢æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ|æ—è·¯ç¼“å­˜æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Œæœ‰æ²¡æœ‰é‡åˆ°æŸ¥è¯¢æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ]]</li><li>ä¸ºä»€ä¹ˆä½¿ç”¨Token + Redisä¿è¯å¹‚ç­‰æ€§ï¼Œæœ‰ä»€ä¹ˆä¼˜ç‚¹</li><li>[[ç¾å›¢æµ‹å¼€ä¸€é¢#AOPç›¸å…³| AOPç›¸å…³]]ï¼Œå¦‚ä½•åšçš„å…¨å±€å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—å¤„ç†</li><li>å®ä¹ é¡¹ç›®ä¸­ä¸ºä½•ä½¿ç”¨Kafka</li><li>[[ç¾å›¢æµ‹å¼€ä¸€é¢#æ•°æ®åº“ä¸‰å¤§èŒƒå¼|æ•°æ®åº“ä¸‰å¤§èŒƒå¼]]</li><li>ç´¢å¼•ç±»å‹</li><li>æ‰‹å†™sqlä¸‰ä¸ªå¤§é¢˜ï¼Œä¸éš¾<code>ALTER TABLE table_name ADD column_name data_type [constraint];</code></li><li>å‰ç«¯çš„ä¸€äº›åŸºç¡€çŸ¥è¯†æé—®(ä¸è®°å½•äº†)</li><li>æ‰‹æ’• <a href="https://leetcode.cn/problems/wtcaE1/">æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</a>(æ€è·¯å¯¹äº†ï¼Œæ¡ä»¶åˆ¤æ–­å†™çš„æœ‰ç‚¹é—®é¢˜ï¼Œç»™è¿‡äº†)</li><li>åé—®ç¯èŠ‚ï¼š<ul><li>æµ‹å¼€æ¯”ä¾‹-&gt;å¼€å‘å 60%</li><li>é¢è¯•è¡¨ç°ï¼šæœ‰ç‚¹ç´§å¼ ï¼Œå¹³å¸¸å¿ƒå¯¹å¾…å°±è¡Œï¼Œæ²¡æœ‰ç»™å‡ºå®é™…å›ç­”(å¤šåŠæ˜¯æ¯é¢è¯„äº†)</li><li>å¤šä¹…èƒ½æœ‰åç»­-&gt;ä¸€ä¸ªæ˜ŸæœŸä¹‹å†…</li></ul></li></ol><h2 id="ç­”å¾—ä¸å¥½ä»¥åŠåç»­ç­”æ¡ˆ"><a href="#ç­”å¾—ä¸å¥½ä»¥åŠåç»­ç­”æ¡ˆ" class="headerlink" title="ç­”å¾—ä¸å¥½ä»¥åŠåç»­ç­”æ¡ˆ"></a>ç­”å¾—ä¸å¥½ä»¥åŠåç»­ç­”æ¡ˆ</h2><h3 id="å¤šæ€æœ‰å“ªäº›"><a href="#å¤šæ€æœ‰å“ªäº›" class="headerlink" title="å¤šæ€æœ‰å“ªäº›"></a>å¤šæ€æœ‰å“ªäº›</h3><blockquote><p>å·²ç»ç­”å‡ºæ–¹æ³•é‡è½½å’Œæ–¹æ³•é‡å†™ï¼Œé¢è¯•å®˜é—®æ˜¯å¦æœ‰å…¶ä»–</p></blockquote><p>è¿˜æœ‰æ¥å£å®ç°å’ŒæŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•ï¼Œè¿è¡Œæ—¶å¤šæ€</p><ol><li>æ¥å£å®ç°ï¼šä¸€ä¸ªç±»å¯ä»¥å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ï¼Œæ¥å£ä¸­çš„æ–¹æ³•å¯ä»¥æœ‰ä¸åŒçš„å®ç°ã€‚</li><li>æŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œå¿…é¡»ç”±å­ç±»å»å®ç°å…¶æŠ½è±¡æ–¹æ³•</li><li>è¿è¡Œæ—¶å¤šæ€ï¼šé€šè¿‡çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡å—ï¼Œåœ¨è¿è¡Œæ—¶å†³å®šè°ƒç”¨å“ªä¸ªç±»çš„æ–¹æ³•</li></ol><h3 id="ArrayListå’ŒLinkedListçš„åŒºåˆ«"><a href="#ArrayListå’ŒLinkedListçš„åŒºåˆ«" class="headerlink" title="ArrayListå’ŒLinkedListçš„åŒºåˆ«"></a>ArrayListå’ŒLinkedListçš„åŒºåˆ«</h3><ol><li>æ•°æ®ç»“æ„ä¸åŒ<ul><li>åŠ¨æ€æ•°ç»„ï¼Œéšæœºè®¿é—®ï¼Œç´¢å¼•è®¿é—®</li><li>åŒå‘é“¾è¡¨ï¼Œæ¯ä¸ªå…ƒç´ éƒ½åŒ…å«å‰ä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨</li></ul></li><li>æ€§èƒ½ä¸Šï¼š<ul><li>é€Ÿåº¦å¿«å¤æ‚åº¦O(1)</li><li>é€Ÿåº¦æ…¢ï¼šO(n)</li></ul></li><li>æ’å…¥å’Œåˆ é™¤å…ƒç´ ï¼š<ul><li>ä¸­é—´æ’å…¥è¾ƒæ…¢</li><li>å¤æ‚åº¦O(1)</li></ul></li><li>å†…å­˜ä½¿ç”¨<ul><li>ç´§å‡‘ï¼Œæ‰©å®¹æ—¶éœ€è¦é‡æ–°åˆ†é…å’Œå¤åˆ¶æ•°ç»„</li><li>æ¯ä¸ªå…ƒç´ éƒ½éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´æ¥ä¿å­˜å‰åå¼•ç”¨ï¼Œå†…å­˜å¼€é”€è¾ƒå¤§</li></ul></li></ol><ul><li><code>ArrayList</code>&nbsp;é€‚ç”¨äºé¢‘ç¹è¯»å–å’Œéšæœºè®¿é—®çš„åœºæ™¯ã€‚</li><li><code>LinkedList</code>&nbsp;é€‚ç”¨äºé¢‘ç¹æ’å…¥å’Œåˆ é™¤çš„åœºæ™¯ï¼Œå°¤å…¶æ˜¯åœ¨åˆ—è¡¨ä¸­é—´è¿›è¡Œæ“ä½œæ—¶ã€‚</li></ul><h3 id="æŠ½è±¡ç±»ï¼Œæ¥å£ï¼ŒæŠ½è±¡ç±»å’Œæ¥å£çš„å¦‚ä½•é€‰æ‹©"><a href="#æŠ½è±¡ç±»ï¼Œæ¥å£ï¼ŒæŠ½è±¡ç±»å’Œæ¥å£çš„å¦‚ä½•é€‰æ‹©" class="headerlink" title="æŠ½è±¡ç±»ï¼Œæ¥å£ï¼ŒæŠ½è±¡ç±»å’Œæ¥å£çš„å¦‚ä½•é€‰æ‹©"></a>æŠ½è±¡ç±»ï¼Œæ¥å£ï¼ŒæŠ½è±¡ç±»å’Œæ¥å£çš„å¦‚ä½•é€‰æ‹©</h3><h4 id="ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨æŠ½è±¡ç±»"><a href="#ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨æŠ½è±¡ç±»" class="headerlink" title="ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨æŠ½è±¡ç±»"></a>ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨æŠ½è±¡ç±»</h4><ol><li>å®šä¹‰é€šç”¨æ¥å£ï¼Œå…·ä½“å®ç°ç”±å­ç±»æä¾›</li><li>ä»£ç å¤ç”¨ï¼šä¸€äº›é€šç”¨çš„ä»£ç éœ€è¦åœ¨å­ç±»ä¹‹é—´è¿›è¡Œå¤ç”¨ï¼Œå¯ä»¥æ”¾åœ¨æŠ½è±¡ç±»ä¸­ï¼Œç”±å­ç±»ç»§æ‰¿å‡å°‘ä»£ç é‡å¤</li><li>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼šæŠ½è±¡ç±»é¡¶ä¸€ä¸ªä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼ŒåŒ…å«ä¸€äº›åˆ—çš„æ­¥éª¤ï¼Œå…·ä½“çš„å®ç°ç”±å­ç±»å®ç°ã€‚<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Game</span> <span class="token punctuation">{</span>    <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">startPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">endPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ¨¡æ¿æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">startPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">endPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Football</span> <span class="token keyword">extends</span> <span class="token class-name">Game</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Football Game Initialized"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">void</span> <span class="token function">startPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Football Game Started"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">void</span> <span class="token function">endPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Football Game Ended"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Basketball</span> <span class="token keyword">extends</span> <span class="token class-name">Game</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Basketball Game Initialized"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">void</span> <span class="token function">startPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Basketball Game Started"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">void</span> <span class="token function">endPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Basketball Game Ended"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>æä¾›é»˜è®¤è¡Œä¸º</li><li>å¼ºåˆ¶å­ç±»å®ç°æŸäº›æ–¹æ³•</li></ol><h4 id="äºŒè€…åŒºåˆ«"><a href="#äºŒè€…åŒºåˆ«" class="headerlink" title="äºŒè€…åŒºåˆ«"></a>äºŒè€…åŒºåˆ«</h4><ul><li>æŠ½è±¡ç±»ç”¨æ¥æè¿°å…±åŒè¡Œä¸ºå’Œç‰¹æ€§ï¼Œå¯ä»¥æœ‰è‡ªå·±çš„æˆå‘˜å˜é‡å’Œå…·ä½“æ–¹æ³•ï¼Œæœ‰æ˜æ˜¾çš„ç»§æ‰¿å…³ç³»</li><li>æ¥å£ç”¨äºå®šä¹‰è¡Œä¸ºè§„èŒƒï¼Œå¯ä»¥å¤šå®ç°ï¼Œåªèƒ½æœ‰å¸¸é‡å’ŒæŠ½è±¡æ–¹æ³•(jdk1.8ä¹‹åå¯ä»¥æœ‰é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•)</li></ul><h4 id="å¦‚ä½•é€‰æ‹©äºŒè€…"><a href="#å¦‚ä½•é€‰æ‹©äºŒè€…" class="headerlink" title="å¦‚ä½•é€‰æ‹©äºŒè€…"></a>å¦‚ä½•é€‰æ‹©äºŒè€…</h4><ol><li>æ˜¯å¦éœ€è¦ç»§æ‰¿å¤šä¸ªçˆ¶ç±»çš„è¡Œä¸º-&gt;æ¥å£</li><li>æ˜¯å¦éœ€è¦å…±äº«ä»£ç -&gt;æŠ½è±¡ç±»</li><li>æ˜¯å¦éœ€è¦æ„é€ æ–¹æ³•-&gt;æŠ½è±¡ç±»</li><li>æ˜¯å¦éœ€è¦é»˜è®¤æ–¹æ³•-&gt;æ¥å£</li></ol><h3 id="SpringBootApplicationåŒ…å«å“ªäº›"><a href="#SpringBootApplicationåŒ…å«å“ªäº›" class="headerlink" title="@SpringBootApplicationåŒ…å«å“ªäº›"></a>@SpringBootApplicationåŒ…å«å“ªäº›</h3><ol><li><strong><code>@SpringBootConfiguration</code></strong> é…ç½®ç±»ï¼Œå…è®¸åœ¨ç±»ä¸­å®šä¹‰@Beanæ–¹æ³•ï¼Œä»¥ä¾¿åœ¨Springå®¹å™¨ä¸­æ³¨å†ŒBean</li><li><strong><code>@EnableAutoConfiguration</code></strong> æ ¹æ®é¡¹ç›®ä¸­çš„ä¾èµ–è‡ªåŠ¨é…ç½®Springåº”ç”¨ç¨‹åºï¼Œæ‰«æç±»è·¯å¾„ä¸­çš„ä¾èµ–ï¼Œæ ¹æ®è¿™äº›ä¾èµ–è‡ªåŠ¨é…ç½®Spring Bean</li><li><strong><code>@ComponentScan</code></strong> å¯ç”¨ç»„ä»¶æ‰«æ</li></ol><h3 id="debugçš„æŠ€å·§ï¼Œè¿œç¨‹debugå¦‚ä½•ä¿è¯ä¸ä¼šè¢«å…¶ä»–è¯·æ±‚å¹²æ‰°"><a href="#debugçš„æŠ€å·§ï¼Œè¿œç¨‹debugå¦‚ä½•ä¿è¯ä¸ä¼šè¢«å…¶ä»–è¯·æ±‚å¹²æ‰°" class="headerlink" title="debugçš„æŠ€å·§ï¼Œè¿œç¨‹debugå¦‚ä½•ä¿è¯ä¸ä¼šè¢«å…¶ä»–è¯·æ±‚å¹²æ‰°"></a>debugçš„æŠ€å·§ï¼Œè¿œç¨‹debugå¦‚ä½•ä¿è¯ä¸ä¼šè¢«å…¶ä»–è¯·æ±‚å¹²æ‰°</h3><p>è¿œç¨‹debugçš„åŸç†æ˜¯é€šè¿‡ç½‘ç»œå°†æœ¬åœ°è°ƒè¯•å™¨å’Œè¿œç¨‹JVMé“¾æ¥èµ·æ¥ï¼Œä»è€Œå…è®¸å¼€å‘è€…åœ¨æœ¬åœ°æµ‹è¯•è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ä»£ç ã€‚<br>é€šè¿‡çš„æ˜¯JDWP Java Debug Wire Protocolåè®®è¿›è¡Œé€šä¿¡<br>ç¬¬äºŒä¸ªé—®é¢˜å¯ä»¥æä¸€ä¸ªæµ‹è¯•ç¯å¢ƒï¼Œå°†ç”Ÿäº§ç¯å¢ƒä¸­çš„æ•°æ®å¤åˆ¶è¿‡æ¥è¿›è¡Œdebug</p><h3 id="çº¿ç¨‹æ± å‚æ•°å¦‚ä½•è®¾ç½®"><a href="#çº¿ç¨‹æ± å‚æ•°å¦‚ä½•è®¾ç½®" class="headerlink" title="çº¿ç¨‹æ± å‚æ•°å¦‚ä½•è®¾ç½®"></a>çº¿ç¨‹æ± å‚æ•°å¦‚ä½•è®¾ç½®</h3><p>#todo </p><ul><li><input disabled="" type="checkbox"> çº¿ç¨‹æ± å‚æ•°å¦‚ä½•è®¾ç½®</li></ul><ol><li>CPUå¯†é›†å‹è®¾ç½®ä¸ºCPUæ ¸å¿ƒæ•°+1ï¼Œä¹Ÿå°±æ˜¯è®¡ç®—ä¸ºä¸»ï¼Œæ•°æ®æ’åº</li><li>I/Oå¯†é›†å‹è®¾ç½®ä¸º<code>n*2</code>ï¼Œä¹Ÿå°±æ˜¯ç½‘ç»œè¯»å–ï¼Œæ–‡ä»¶è¯»å–ã€‚</li></ol><h3 id="æ—è·¯ç¼“å­˜æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Œæœ‰æ²¡æœ‰é‡åˆ°æŸ¥è¯¢æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ"><a href="#æ—è·¯ç¼“å­˜æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Œæœ‰æ²¡æœ‰é‡åˆ°æŸ¥è¯¢æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ" class="headerlink" title="æ—è·¯ç¼“å­˜æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Œæœ‰æ²¡æœ‰é‡åˆ°æŸ¥è¯¢æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ"></a>æ—è·¯ç¼“å­˜æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Œæœ‰æ²¡æœ‰é‡åˆ°æŸ¥è¯¢æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ</h3><h3 id="AOPç›¸å…³"><a href="#AOPç›¸å…³" class="headerlink" title="AOPç›¸å…³"></a>AOPç›¸å…³</h3><h4 id="AOPåŸºç¡€"><a href="#AOPåŸºç¡€" class="headerlink" title="AOPåŸºç¡€"></a>AOPåŸºç¡€</h4><h4 id="æœ‰å“ªäº›é€šçŸ¥ç±»å‹"><a href="#æœ‰å“ªäº›é€šçŸ¥ç±»å‹" class="headerlink" title="æœ‰å“ªäº›é€šçŸ¥ç±»å‹"></a>æœ‰å“ªäº›é€šçŸ¥ç±»å‹</h4><ol><li>å‰ç½®é€šçŸ¥ è·å–æ–¹æ³•ç­¾åå’Œå‚æ•°ï¼Œä¸èƒ½è·å–è¿”å›å€¼</li><li>åç½®é€šçŸ¥ æ–¹æ³•æ‰§è¡Œåæ‰§è¡Œï¼Œæ— è®ºæ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œä¸èƒ½è·å¾—è¿”å›å€¼ï¼Œä½†å¯ä»¥è·å–å¼‚å¸¸ä¿¡æ¯</li><li>è¿”å›é€šçŸ¥ï¼šæ–¹æ³•æ‰§è¡Œå¹¶è¿”å›ç»“æœåæ‰§è¡Œå—ï¼Œå¯ä»¥è·å¾—è¿”å›å€¼ï¼Œä½†æ˜¯è·å¾—ä¸äº†å¼‚å¸¸ä¿¡æ¯</li><li>å¼‚å¸¸é€šçŸ¥ï¼šå¼‚å¸¸åæ‰§è¡Œï¼Œè·å–å¼‚å¸¸ä¿¡æ¯ï¼Œä¸èƒ½è·å¾—è¿”å›å€¼</li><li>ç¯ç»•é€šçŸ¥ï¼šå¯ä»¥åœ¨æ–¹æ³•ä¹‹å‰å’Œå®šä¹‰é€»è¾‘ï¼Œå¯ä»¥è·å–æ–¹æ³•ç­¾åã€å‚æ•°ã€è¿”å›å€¼ã€å¼‚å¸¸ä¿¡æ¯ã€‚</li></ol><h4 id="é¢è¯•è®°å½•-ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†-x2F-é™æ€ä»£ç†-åŠ¨æ€ä»£ç†çš„åŸç†"><a href="#é¢è¯•è®°å½•-ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†-x2F-é™æ€ä»£ç†-åŠ¨æ€ä»£ç†çš„åŸç†" class="headerlink" title="[[é¢è¯•è®°å½•#ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†/é™æ€ä»£ç†|åŠ¨æ€ä»£ç†çš„åŸç†]"></a>[[é¢è¯•è®°å½•#ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†/é™æ€ä»£ç†|åŠ¨æ€ä»£ç†çš„åŸç†]</h4><h4 id="ä½¿ç”¨AOPè¿›è¡Œæ“ä½œæ—¥å¿—å¤„ç†"><a href="#ä½¿ç”¨AOPè¿›è¡Œæ“ä½œæ—¥å¿—å¤„ç†" class="headerlink" title="ä½¿ç”¨AOPè¿›è¡Œæ“ä½œæ—¥å¿—å¤„ç†"></a>ä½¿ç”¨AOPè¿›è¡Œæ“ä½œæ—¥å¿—å¤„ç†</h4><p>ä¸»è¦æ˜¯ä½¿ç”¨ç¯ç»•é€šçŸ¥</p><h4 id="å…¨å±€å¼‚å¸¸å¤„ç†"><a href="#å…¨å±€å¼‚å¸¸å¤„ç†" class="headerlink" title="å…¨å±€å¼‚å¸¸å¤„ç†"></a>å…¨å±€å¼‚å¸¸å¤„ç†</h4><p>@ControllerAdviceåº•å±‚åŸç†æ˜¯AOP</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ControllerAdvice</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">BusinessException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">businessExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">BusinessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">ResultUtils</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">runtimeExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">ResultUtils</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>                <span class="token class-name">ErrorCodeEnum</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token string">"æœåŠ¡å™¨å‘ç”Ÿé”™è¯¯, è¯·åŠæ—¶å‘ŠçŸ¥å¼€å‘äººå‘˜"</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token class-name">MethodArgumentNotValidException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>            <span class="token class-name">HttpMessageNotReadableException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>            <span class="token class-name">ConstraintViolationException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>            <span class="token class-name">HandlerMethodValidationException</span><span class="token punctuation">.</span><span class="token keyword">class</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ArgumentValidExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ignored<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">ResultUtils</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>                <span class="token class-name">ErrorCodeEnum</span><span class="token punctuation">.</span><span class="token constant">BAD_REQUEST</span><span class="token punctuation">,</span>                <span class="token string">"è¯·æ£€æŸ¥å‚æ•°æ˜¯å¦æ­£ç¡®"</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">MissingServletRequestParameterException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">MissingServletParameterExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">ResultUtils</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>                <span class="token class-name">ErrorCodeEnum</span><span class="token punctuation">.</span><span class="token constant">BAD_REQUEST</span><span class="token punctuation">,</span>                <span class="token string">"è¯·æ ¸å¯¹å‚æ•°ï¼Œä»¥å…é‡æ–°ç™»å½•"</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">NoResourceFoundException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">illegalStateExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">NoResourceFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">ResultUtils</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>                <span class="token class-name">ErrorCodeEnum</span><span class="token punctuation">.</span><span class="token constant">BAD_REQUEST</span><span class="token punctuation">,</span>                <span class="token string">"è¯·æ±‚è·¯å¾„æˆ–èµ„æºä¸æ­£ç¡®ï¼"</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ•°æ®åº“ä¸‰å¤§èŒƒå¼"><a href="#æ•°æ®åº“ä¸‰å¤§èŒƒå¼" class="headerlink" title="æ•°æ®åº“ä¸‰å¤§èŒƒå¼"></a>æ•°æ®åº“ä¸‰å¤§èŒƒå¼</h3><ol><li>ç¬¬ä¸€èŒƒå¼ï¼šæ¯ä¸€åˆ—éƒ½æ˜¯åŸå­ï¼Œä¸å¯åˆ†å‰²</li><li>ç¬¬äºŒèŒƒå¼ï¼šè¦æ±‚æ¯ä¸ªéä¸»é”®åˆ—éƒ½å®Œå…¨ä¾èµ–äºä¸»é”®</li><li>ç¬¬ä¸‰èŒƒå¼è¦æ±‚åœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šï¼Œéä¸»é”®åˆ—ç›´æ¥ä¾èµ–äºä¸»é”®è€Œä¸æ˜¯ä¼ é€’ä¾èµ–</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥æµ…å‡ºKafka</title>
      <link href="/2024/09/03/19/"/>
      <url>/2024/09/03/19/</url>
      
        <content type="html"><![CDATA[<h1 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h1><h2 id="å¸¸è§é—®é¢˜-Java-API-ä¸€ä¸ªç‹¬ç«‹çš„KafkaæœåŠ¡å™¨è¢«ç§°ä½œbroker-brokeræ˜¯é›†ç¾¤çš„ç»„æˆéƒ¨åˆ†ï¼Œæ¯ä¸ªé›†ç¾¤éƒ½æœ‰ä¸€ä¸ªbrokeråŒæ—¶å……å½“äº†é›†ç¾¤æ§åˆ¶å™¨çš„è§’è‰²-kafkaçš„ä¸»é¢˜è¢«åˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼Œåˆ†åŒºå­˜å‚¨åœ¨ç£ç›˜ä¸­-kafkaçš„æ¶ˆæ¯ç‰¹ç‚¹ï¼šæ¶ˆæ¯ä¼šä¿ç•™ä¸€æ®µæ—¶é—´ï¼Œå³ä½¿åº”ç”¨ç¨‹åºä¸‹çº¿ï¼Œæ¶ˆæ¯ä»ç„¶ä¼šä¿å­˜åœ¨kafkaé‡Œï¼Œæ˜¯åŸºäºç£ç›˜çš„æ•°æ®å­˜å‚¨ã€‚-APIä½¿ç”¨ï¼š-producer-recordçš„å‚æ•°ï¼Œtopic-key-value-keyå¯ä»¥çœç•¥ï¼Œå½“çœç•¥æ—¶å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰keyçš„valueï¼Œkeyä¸€èˆ¬ç”¨äºæŠŠç›¸åŒkeyçš„æ•°æ®å†™å…¥åŒä¸€ä¸ªåˆ†åŒºé‡Œ-sendé»˜è®¤æ˜¯å‘é€å¹¶å¿˜è®°ï¼Œsendä¼šè¿”å›ä¸€ä¸ªFutureå¯¹è±¡ä½¿ç”¨-getæ–¹æ³•å¾—åˆ°RecordMetadataå¯¹è±¡ï¼Œå¯ä»¥è·å–æ¶ˆæ¯çš„åç§»é‡-å¼‚æ­¥å‘é€-send-record-å›è°ƒå‡½æ•°ç±»-ï¼Œå›è°ƒå‡½æ•°éœ€è¦å®ç°Callbackç±»ï¼Œå¹¶ä¸”é‡å†™å…¶ä¸­çš„æ–¹æ³•-é…ç½®è®¾ç½®ï¼š-1-acks-x3D-0-ç”Ÿäº§è€…æ— éœ€ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ï¼Œä½†æ¶ˆæ¯ä¸¢å¤±æ—¶ä¸ä¼šçŸ¥æ™“ï¼Œ-x3D-1ï¼Œåªè¦é›†ç¾¤çš„é¦–é¢†èŠ‚ç‚¹æ”¶åˆ°å³å¯ï¼Œ-x3D-alléœ€è¦æ‰€æœ‰å‚ä¸å¤åˆ¶çš„èŠ‚ç‚¹éƒ½å—åˆ°æ¶ˆæ¯æ‰ä¼šå—åˆ°æœåŠ¡å™¨çš„å“åº”ï¼Œä¸å»ºè®®-2-buffer-memoryè®¾ç½®producerå†…å­˜ç¼“å†²åŒºå¤§å°ï¼Œ-3-compression-typeè®¾ç½®æ¶ˆæ¯çš„å‹ç¼©æ ¼å¼ï¼Œé»˜è®¤ä¸ä¼šå‹ç¼©-4-retriesé‡è¯•æ¬¡æ•°-5-batch-size-å½“å¤šä¸ªæ¶ˆæ¯è¢«å‘é€åˆ°åŒä¸€ä¸ªåˆ†åŒºæ—¶ï¼Œproducerä¼šæŠŠä»–ä»¬æ”¾åœ¨ä¸€èµ·ï¼Œå½“ä½œä¸€ä¸ªæ‰¹æ¬¡ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å®šä¸€ä¸ªæ‰¹æ¬¡å¯ä»¥ä½¿ç”¨çš„æœ€å¤§å†…å­˜-6-max-in-flight-requests-per-connection-ç”Ÿäº§è€…åœ¨æ¥æ”¶åˆ°æœåŠ¡å™¨å“åº”ä¹‹å‰å¯ä»¥å‘é€å¤šå°‘ä¸ªæ¶ˆæ¯ï¼Œè®¾ç½®ä¸º-1-æ—¶å¯ä»¥ä¿è¯æ¶ˆæ¯æ˜¯æŒ‰ç…§é¡ºåºå†™å…¥çš„ï¼Œé€‚åˆåœ¨é“¶è¡Œç­‰ä¸¥æ ¼è¦æ±‚é¡ºåºçš„æ—¶å€™ä½¿ç”¨-è‡ªå®šä¹‰åˆ†åŒºï¼š-consumer-API-1-consumerç±»çš„åˆ›å»ºæ–¹å¼å’Œproducerä¸€è‡´ï¼Œä½†æ˜¯æ¨èæŒ‡å®š-group-idæ¥æŒ‡å®šå±äºå“ªä¸ªç¾¤ç»„ï¼Œ-2-consumer-subscirbe-è®¢é˜…ç›¸å…³çš„topicï¼ŒåŒæ—¶æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼-consumer-subscribe-Arrays-asList-quot-topic1-quot-quot-topic2-quot-3-consumer-poll-xxx-å‚æ•°æ˜¯è½®è¯¢çš„é˜»å¡æ—¶é—´ï¼Œä¼šç­‰å¾…brokerè¿”å›æ•°æ®-4-è®°å¾—-close-5-å»ºè®®ä¸€ä¸ªçº¿ç¨‹ä¸­åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…-é…ç½®ï¼š-å¤§éƒ¨åˆ†å’Œproducerç±»ä¼¼-fetch-min-bytesæ¶ˆè´¹è€…ä»æœåŠ¡å™¨è·å–è®°å½•çš„æœ€å°å­—èŠ‚æ•°ï¼Œå½“æ•°æ®é‡å¤§äºç­‰äºè¿™ä¸ªå€¼æ‰ä¼šè¢«è¿”å›ç»™æ¶ˆè´¹è€…-æäº¤å’Œåç§»é‡ï¼šæ¶ˆè´¹è€…å¾€-consumer-offsetç‰¹æ®Šä¸»é¢˜å‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯åŒ…å«æ¯ä¸ªåˆ†åŒºçš„åç§»é‡ï¼Œå½“è§¦å‘å†å‡è¡¡æ—¶ï¼Œæ¶ˆè´¹è€…ä¼šè¯»å–æ¯ä¸ªåˆ†åŒºç»„åä¸€æ¬¡æäº¤çš„åç§»é‡ï¼Œç„¶åä»åç§»é‡æŒ‡å®šçš„åœ°æ–¹å¼€å§‹å¤„ç†-æäº¤æ–¹å¼ï¼š-1-è‡ªåŠ¨æäº¤-æ¯éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨æäº¤ä¸€æ¬¡-2-æäº¤å½“å‰åç§»é‡-è®¾ç½®auto-commit-offsetä¸ºfalse-ç„¶åä½¿ç”¨commitSync-æäº¤åç§»é‡ï¼Œä¼šæäº¤æœ€æ–°çš„ä¸€æ¬¡ç”±pollè·å¾—çš„åç§»é‡-3-å¼‚æ­¥æäº¤ï¼šcommitAsync-ï¼Œä¹Ÿå¯ä½¿ç”¨å›è°ƒå‡½æ•°æ¥å¤„ç†-4-å¯ä»¥æäº¤ç‰¹å®šåç§»é‡ï¼Œè€Œä¸æ˜¯æœ€åä¸€æ¬¡pollå¾—åˆ°çš„åç§»é‡-é€šè¿‡å®ç°-ConsumerRebalanceListeneræ¥å£æ¥å®šä¹‰åœ¨consumerå¤±å»å¯¹åˆ†åŒºçš„æ‰€æœ‰æƒæ—¶éœ€è¦å¤„ç†çš„äº‹ä»¶ï¼Œå¯åœ¨è¿™é‡Œä½¿ç”¨-seek-æ–¹æ³•åŠ ä¸Šè‡ªå®šä¹‰çš„å‡½æ•°æ¥å®ç°ä»æ•°æ®åº“ä¸­è·å¾—åç§»é‡-Kafkaæœ¬ä½“-ä¼˜åŠ¿é«˜ååï¼Œé«˜æ€§èƒ½ï¼ŒæŒä¹…åŒ–-å°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œé€šè¿‡å°†æ•°æ®æŒä¹…åŒ–ç¡¬ç›˜ï¼Œä»¥åŠfollowerèŠ‚ç‚¹æ¥é˜²æ­¢æ•°æ®ä¸¢å¤±-ç¼ºç‚¹æ˜¯å¼‚æ­¥çš„ä¸é€‚åˆç”µå•†åœºæ™¯-æ¶æ„è®¾è®¡-Producer-Consumer-Topic-ä¸»é¢˜ï¼Œç”±ç”¨æˆ·å®šä¹‰å¹¶é…ç½®åœ¨KafkaæœåŠ¡å™¨ï¼Œå»ºç«‹Producerå’ŒConsumerä¹‹é—´çš„è®¢é˜…å…³ç³»ï¼Œèº«ç¼ è¿™å‘é€æ¶ˆæ¯åˆ°ç‰¹å®šçš„Topicä¸‹ï¼Œæ¶ˆè´¹è€…ä»è¿™ä¸ªTopicä¸‹æ¶ˆè´¹æ¶ˆæ¯ã€‚é€»è¾‘æ¦‚å¿µï¼Œç›¸å½“äºæ•°æ®åº“ä¸­çš„è¡¨-Partition-æ¶ˆæ¯åˆ†åŒºï¼Œä¸€ä¸ªTopicå¯ä»¥åˆ†ä¸ºå¤šä¸ªpartitionï¼Œpartitionæ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ï¼Œpartitionçš„æ¯æ¡æ¶ˆæ¯éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªæœ‰åºçš„id-offset-ç‰©ç†å®é™…æ¦‚å¿µï¼Œæ¯ä¸€ä¸ªpartitionå¯¹åº”ä¸€ä¸ªlogï¼Œproducerç”Ÿäº§çš„æ•°æ®ä¼šä¸æ–­åœ°è¿½åŠ åˆ°è¯¥logæ–‡ä»¶æœ«ç«¯ï¼Œä¸”æ¯æ¡æ•°æ®éƒ½æœ‰è‡ªå·±çš„offsetã€‚ç³»å“¦å•Šé£ç€ç»„ä¸­çš„æ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šå®æ—¶è®°å½•è‡ªå·±æ¶ˆè´¹åˆ°å“ªä¸ªoffset-Broker-ä¸€å°Kafkaå°±æ˜¯ä¸€ä¸ªbrokerï¼Œä¸€ä¸ªé›†ç¾¤ç”±å¤šä¸ªbrokerç»„æˆï¼Œä¸€ä¸ªbrokerå¯ä»¥å®¹çº³å¤šä¸ªtopic-ConsumerGroup-æ¶ˆè´¹è€…ç»„ï¼Œç”¨äºå½’ç»„åŒç±»æ¶ˆè´¹è€…ã€‚æ¯ä¸ªconsumerå±äºä¸€ä¸ªç‰¹å®šçš„consumer-groupï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥å…±åŒæ¶ˆè´¹ä¸€ä¸ªTopicä¸‹çš„æ¶ˆæ¯ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…è·å–éƒ¨åˆ†æ¶ˆæ¯ã€‚-ä¸€ä¸ªPartitionå¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸‹ä½¿ç”¨çš„æ˜¯Segment-Fileçš„å­˜å‚¨æ–¹å¼è¿›è¡Œå­˜å‚¨ã€‚å°†å¤§æ–‡ä»¶æ‹†æˆå°æ–‡ä»¶ï¼Œåˆ†ä¸ºç´¢å¼•æœªè§å’Œæ•°æ®æ–‡ä»¶-åŸºæœ¬æµç¨‹-producerå…ˆä»zookeeperçš„broker-x2F-x2F-stateèŠ‚ç‚¹æ‰¾åˆ°è¯¥partitonçš„leader-producerå°†æ¶ˆæ¯å‘é€ç»™è¯¥leader-leaderå°†æ¶ˆæ¯å†™å‡ºæœ¬åœ°log-followerä»leader-pull-æ¶ˆæ¯-å†™å…¥æœ¬åœ°logï¼Œåå‘leaderå‘é€ACK-leaderæ”¶åˆ°æ‰€æœ‰ISRä¸­çš„replicationçš„ACKï¼Œå¢åŠ HT-high-watermark-ï¼Œæœ€åcommit-çš„offset-å¹¶å‘producerå‘é€ACK-ç”Ÿäº§è¿‡ç¨‹1-Produceråˆ›å»ºæ—¶ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªSenderçº¿ç¨‹å¹¶ä¸”è®¾ç½®å®ˆæŠ¤çº¿ç¨‹2-ç”Ÿäº§çš„æ¶ˆæ¯ç»è¿‡æ‹¦æˆªå™¨-gt-åºåˆ—åŒ–å™¨-gt-åˆ†åŒºå™¨ï¼Œå°†æ¶ˆæ¯å­˜åœ¨ç¼“å†²åŒº3-æ‰¹é‡å‘é€çš„æ¡ä»¶ï¼šç¼“å†²åŒºæ•°æ®å¤§å°è¾¾åˆ°batch-sizeæˆ–è€…linger-msè¾¾åˆ°ä¸Šé™4-å‘å¾€æŒ‡å®šåˆ†åŒºï¼Œæœ€ååˆ°è¾¾broker-acks-x3D-0ï¼Œæ¶ˆæ¯æ”¾åˆ°ç¼“å†²åŒºå°±è®¤ä¸ºå‘é€å®Œæˆ-acks-x3D-1æ¶ˆæ¯å†™åˆ°ä¸»åˆ†åŒºå³å¯å®Œæˆï¼Œå¦‚æœä¸»åˆ†åŒºæ”¶åˆ°æ¶ˆæ¯ä¹‹åå®•æœºï¼Œå‰¯æœ¬åˆ†åŒºæ¥ä¸åŠåŒæ­¥æ¶ˆæ¯ï¼Œæ¶ˆæ¯å°±ä¼šä¸¢å¤±-acks-x3D-all-ç­‰å¾…æ‰€æœ‰çš„ISRå‰¯æœ¬çš„ç¼ºäººè®°å½•5-å¦‚æœè®¾ç½®äº†é‡è¯•æ¬¡æ•°å¹¶ä¸”å¤§äº0ï¼Œå°±ä¼šè¿›è¡Œé‡è¯•6-æˆåŠŸï¼Œè¿”å›å…ƒæ•°æ®ç»™ç”Ÿäº§è€…ISRï¼ˆIn-Sync-Replicasï¼‰æ˜¯æŒ‡ä¸é¢†å¯¼è€…å‰¯æœ¬ä¿æŒåŒæ­¥çš„å‰¯æœ¬é›†åˆ-ç”Ÿäº§è€…Offsetæ¶ˆæ¯å†™å…¥çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ªoffsetï¼Œå³æ¯ä¸ªåˆ†åŒºçš„æœ€æ–°æœ€å¤§çš„offsetã€‚-æ¶ˆè´¹è€…Offsetä¸åŒæ¶ˆè´¹ç»„ä¸­çš„æ¶ˆè´¹è€…å¯ä»¥é’ˆå¯¹ä¸€ä¸ªåˆ†åŒºå­˜å‚¨ä¸åŒçš„Offsetï¼Œäº’ä¸å½±å“ã€‚-LogSegmentæ—¥å¿—æ–‡ä»¶çš„ç»„æˆéƒ¨åˆ†-Leaderé€‰ä¸¾-Kafkaä¼šåœ¨Zookeeperä¸Šé’ˆå¯¹æ¯ä¸ªTopicç»´æŠ¤ä¸€ä¸ªæˆä¸ºISRçš„é›†åˆ-å½“é›†åˆä¸­å‰¯æœ¬éƒ½è·ŸLeaderåŒçš„å‰¯æœ¬åŒæ­¥ä¹‹åï¼Œkafkaæ‰ä¼šè®¤ä¸ºæ¶ˆæ¯å·²æäº¤-åªæœ‰è¿™äº›è·ŸLeaderä¿æŒåŒæ­¥çš„Followeræ‰åº”è¯¥è¢«é€‰ä½œæ–°çš„Leader"><a href="#å¸¸è§é—®é¢˜-Java-API-ä¸€ä¸ªç‹¬ç«‹çš„KafkaæœåŠ¡å™¨è¢«ç§°ä½œbroker-brokeræ˜¯é›†ç¾¤çš„ç»„æˆéƒ¨åˆ†ï¼Œæ¯ä¸ªé›†ç¾¤éƒ½æœ‰ä¸€ä¸ªbrokeråŒæ—¶å……å½“äº†é›†ç¾¤æ§åˆ¶å™¨çš„è§’è‰²-kafkaçš„ä¸»é¢˜è¢«åˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼Œåˆ†åŒºå­˜å‚¨åœ¨ç£ç›˜ä¸­-kafkaçš„æ¶ˆæ¯ç‰¹ç‚¹ï¼šæ¶ˆæ¯ä¼šä¿ç•™ä¸€æ®µæ—¶é—´ï¼Œå³ä½¿åº”ç”¨ç¨‹åºä¸‹çº¿ï¼Œæ¶ˆæ¯ä»ç„¶ä¼šä¿å­˜åœ¨kafkaé‡Œï¼Œæ˜¯åŸºäºç£ç›˜çš„æ•°æ®å­˜å‚¨ã€‚-APIä½¿ç”¨ï¼š-producer-recordçš„å‚æ•°ï¼Œtopic-key-value-keyå¯ä»¥çœç•¥ï¼Œå½“çœç•¥æ—¶å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰keyçš„valueï¼Œkeyä¸€èˆ¬ç”¨äºæŠŠç›¸åŒkeyçš„æ•°æ®å†™å…¥åŒä¸€ä¸ªåˆ†åŒºé‡Œ-sendé»˜è®¤æ˜¯å‘é€å¹¶å¿˜è®°ï¼Œsendä¼šè¿”å›ä¸€ä¸ªFutureå¯¹è±¡ä½¿ç”¨-getæ–¹æ³•å¾—åˆ°RecordMetadataå¯¹è±¡ï¼Œå¯ä»¥è·å–æ¶ˆæ¯çš„åç§»é‡-å¼‚æ­¥å‘é€-send-record-å›è°ƒå‡½æ•°ç±»-ï¼Œå›è°ƒå‡½æ•°éœ€è¦å®ç°Callbackç±»ï¼Œå¹¶ä¸”é‡å†™å…¶ä¸­çš„æ–¹æ³•-é…ç½®è®¾ç½®ï¼š-1-acks-x3D-0-ç”Ÿäº§è€…æ— éœ€ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ï¼Œä½†æ¶ˆæ¯ä¸¢å¤±æ—¶ä¸ä¼šçŸ¥æ™“ï¼Œ-x3D-1ï¼Œåªè¦é›†ç¾¤çš„é¦–é¢†èŠ‚ç‚¹æ”¶åˆ°å³å¯ï¼Œ-x3D-alléœ€è¦æ‰€æœ‰å‚ä¸å¤åˆ¶çš„èŠ‚ç‚¹éƒ½å—åˆ°æ¶ˆæ¯æ‰ä¼šå—åˆ°æœåŠ¡å™¨çš„å“åº”ï¼Œä¸å»ºè®®-2-buffer-memoryè®¾ç½®producerå†…å­˜ç¼“å†²åŒºå¤§å°ï¼Œ-3-compression-typeè®¾ç½®æ¶ˆæ¯çš„å‹ç¼©æ ¼å¼ï¼Œé»˜è®¤ä¸ä¼šå‹ç¼©-4-retriesé‡è¯•æ¬¡æ•°-5-batch-size-å½“å¤šä¸ªæ¶ˆæ¯è¢«å‘é€åˆ°åŒä¸€ä¸ªåˆ†åŒºæ—¶ï¼Œproducerä¼šæŠŠä»–ä»¬æ”¾åœ¨ä¸€èµ·ï¼Œå½“ä½œä¸€ä¸ªæ‰¹æ¬¡ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å®šä¸€ä¸ªæ‰¹æ¬¡å¯ä»¥ä½¿ç”¨çš„æœ€å¤§å†…å­˜-6-max-in-flight-requests-per-connection-ç”Ÿäº§è€…åœ¨æ¥æ”¶åˆ°æœåŠ¡å™¨å“åº”ä¹‹å‰å¯ä»¥å‘é€å¤šå°‘ä¸ªæ¶ˆæ¯ï¼Œè®¾ç½®ä¸º-1-æ—¶å¯ä»¥ä¿è¯æ¶ˆæ¯æ˜¯æŒ‰ç…§é¡ºåºå†™å…¥çš„ï¼Œé€‚åˆåœ¨é“¶è¡Œç­‰ä¸¥æ ¼è¦æ±‚é¡ºåºçš„æ—¶å€™ä½¿ç”¨-è‡ªå®šä¹‰åˆ†åŒºï¼š-consumer-API-1-consumerç±»çš„åˆ›å»ºæ–¹å¼å’Œproducerä¸€è‡´ï¼Œä½†æ˜¯æ¨èæŒ‡å®š-group-idæ¥æŒ‡å®šå±äºå“ªä¸ªç¾¤ç»„ï¼Œ-2-consumer-subscirbe-è®¢é˜…ç›¸å…³çš„topicï¼ŒåŒæ—¶æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼-consumer-subscribe-Arrays-asList-quot-topic1-quot-quot-topic2-quot-3-consumer-poll-xxx-å‚æ•°æ˜¯è½®è¯¢çš„é˜»å¡æ—¶é—´ï¼Œä¼šç­‰å¾…brokerè¿”å›æ•°æ®-4-è®°å¾—-close-5-å»ºè®®ä¸€ä¸ªçº¿ç¨‹ä¸­åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…-é…ç½®ï¼š-å¤§éƒ¨åˆ†å’Œproducerç±»ä¼¼-fetch-min-bytesæ¶ˆè´¹è€…ä»æœåŠ¡å™¨è·å–è®°å½•çš„æœ€å°å­—èŠ‚æ•°ï¼Œå½“æ•°æ®é‡å¤§äºç­‰äºè¿™ä¸ªå€¼æ‰ä¼šè¢«è¿”å›ç»™æ¶ˆè´¹è€…-æäº¤å’Œåç§»é‡ï¼šæ¶ˆè´¹è€…å¾€-consumer-offsetç‰¹æ®Šä¸»é¢˜å‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯åŒ…å«æ¯ä¸ªåˆ†åŒºçš„åç§»é‡ï¼Œå½“è§¦å‘å†å‡è¡¡æ—¶ï¼Œæ¶ˆè´¹è€…ä¼šè¯»å–æ¯ä¸ªåˆ†åŒºç»„åä¸€æ¬¡æäº¤çš„åç§»é‡ï¼Œç„¶åä»åç§»é‡æŒ‡å®šçš„åœ°æ–¹å¼€å§‹å¤„ç†-æäº¤æ–¹å¼ï¼š-1-è‡ªåŠ¨æäº¤-æ¯éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨æäº¤ä¸€æ¬¡-2-æäº¤å½“å‰åç§»é‡-è®¾ç½®auto-commit-offsetä¸ºfalse-ç„¶åä½¿ç”¨commitSync-æäº¤åç§»é‡ï¼Œä¼šæäº¤æœ€æ–°çš„ä¸€æ¬¡ç”±pollè·å¾—çš„åç§»é‡-3-å¼‚æ­¥æäº¤ï¼šcommitAsync-ï¼Œä¹Ÿå¯ä½¿ç”¨å›è°ƒå‡½æ•°æ¥å¤„ç†-4-å¯ä»¥æäº¤ç‰¹å®šåç§»é‡ï¼Œè€Œä¸æ˜¯æœ€åä¸€æ¬¡pollå¾—åˆ°çš„åç§»é‡-é€šè¿‡å®ç°-ConsumerRebalanceListeneræ¥å£æ¥å®šä¹‰åœ¨consumerå¤±å»å¯¹åˆ†åŒºçš„æ‰€æœ‰æƒæ—¶éœ€è¦å¤„ç†çš„äº‹ä»¶ï¼Œå¯åœ¨è¿™é‡Œä½¿ç”¨-seek-æ–¹æ³•åŠ ä¸Šè‡ªå®šä¹‰çš„å‡½æ•°æ¥å®ç°ä»æ•°æ®åº“ä¸­è·å¾—åç§»é‡-Kafkaæœ¬ä½“-ä¼˜åŠ¿é«˜ååï¼Œé«˜æ€§èƒ½ï¼ŒæŒä¹…åŒ–-å°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œé€šè¿‡å°†æ•°æ®æŒä¹…åŒ–ç¡¬ç›˜ï¼Œä»¥åŠfollowerèŠ‚ç‚¹æ¥é˜²æ­¢æ•°æ®ä¸¢å¤±-ç¼ºç‚¹æ˜¯å¼‚æ­¥çš„ä¸é€‚åˆç”µå•†åœºæ™¯-æ¶æ„è®¾è®¡-Producer-Consumer-Topic-ä¸»é¢˜ï¼Œç”±ç”¨æˆ·å®šä¹‰å¹¶é…ç½®åœ¨KafkaæœåŠ¡å™¨ï¼Œå»ºç«‹Producerå’ŒConsumerä¹‹é—´çš„è®¢é˜…å…³ç³»ï¼Œèº«ç¼ è¿™å‘é€æ¶ˆæ¯åˆ°ç‰¹å®šçš„Topicä¸‹ï¼Œæ¶ˆè´¹è€…ä»è¿™ä¸ªTopicä¸‹æ¶ˆè´¹æ¶ˆæ¯ã€‚é€»è¾‘æ¦‚å¿µï¼Œç›¸å½“äºæ•°æ®åº“ä¸­çš„è¡¨-Partition-æ¶ˆæ¯åˆ†åŒºï¼Œä¸€ä¸ªTopicå¯ä»¥åˆ†ä¸ºå¤šä¸ªpartitionï¼Œpartitionæ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ï¼Œpartitionçš„æ¯æ¡æ¶ˆæ¯éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªæœ‰åºçš„id-offset-ç‰©ç†å®é™…æ¦‚å¿µï¼Œæ¯ä¸€ä¸ªpartitionå¯¹åº”ä¸€ä¸ªlogï¼Œproducerç”Ÿäº§çš„æ•°æ®ä¼šä¸æ–­åœ°è¿½åŠ åˆ°è¯¥logæ–‡ä»¶æœ«ç«¯ï¼Œä¸”æ¯æ¡æ•°æ®éƒ½æœ‰è‡ªå·±çš„offsetã€‚ç³»å“¦å•Šé£ç€ç»„ä¸­çš„æ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šå®æ—¶è®°å½•è‡ªå·±æ¶ˆè´¹åˆ°å“ªä¸ªoffset-Broker-ä¸€å°Kafkaå°±æ˜¯ä¸€ä¸ªbrokerï¼Œä¸€ä¸ªé›†ç¾¤ç”±å¤šä¸ªbrokerç»„æˆï¼Œä¸€ä¸ªbrokerå¯ä»¥å®¹çº³å¤šä¸ªtopic-ConsumerGroup-æ¶ˆè´¹è€…ç»„ï¼Œç”¨äºå½’ç»„åŒç±»æ¶ˆè´¹è€…ã€‚æ¯ä¸ªconsumerå±äºä¸€ä¸ªç‰¹å®šçš„consumer-groupï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥å…±åŒæ¶ˆè´¹ä¸€ä¸ªTopicä¸‹çš„æ¶ˆæ¯ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…è·å–éƒ¨åˆ†æ¶ˆæ¯ã€‚-ä¸€ä¸ªPartitionå¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸‹ä½¿ç”¨çš„æ˜¯Segment-Fileçš„å­˜å‚¨æ–¹å¼è¿›è¡Œå­˜å‚¨ã€‚å°†å¤§æ–‡ä»¶æ‹†æˆå°æ–‡ä»¶ï¼Œåˆ†ä¸ºç´¢å¼•æœªè§å’Œæ•°æ®æ–‡ä»¶-åŸºæœ¬æµç¨‹-producerå…ˆä»zookeeperçš„broker-x2F-x2F-stateèŠ‚ç‚¹æ‰¾åˆ°è¯¥partitonçš„leader-producerå°†æ¶ˆæ¯å‘é€ç»™è¯¥leader-leaderå°†æ¶ˆæ¯å†™å‡ºæœ¬åœ°log-followerä»leader-pull-æ¶ˆæ¯-å†™å…¥æœ¬åœ°logï¼Œåå‘leaderå‘é€ACK-leaderæ”¶åˆ°æ‰€æœ‰ISRä¸­çš„replicationçš„ACKï¼Œå¢åŠ HT-high-watermark-ï¼Œæœ€åcommit-çš„offset-å¹¶å‘producerå‘é€ACK-ç”Ÿäº§è¿‡ç¨‹1-Produceråˆ›å»ºæ—¶ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªSenderçº¿ç¨‹å¹¶ä¸”è®¾ç½®å®ˆæŠ¤çº¿ç¨‹2-ç”Ÿäº§çš„æ¶ˆæ¯ç»è¿‡æ‹¦æˆªå™¨-gt-åºåˆ—åŒ–å™¨-gt-åˆ†åŒºå™¨ï¼Œå°†æ¶ˆæ¯å­˜åœ¨ç¼“å†²åŒº3-æ‰¹é‡å‘é€çš„æ¡ä»¶ï¼šç¼“å†²åŒºæ•°æ®å¤§å°è¾¾åˆ°batch-sizeæˆ–è€…linger-msè¾¾åˆ°ä¸Šé™4-å‘å¾€æŒ‡å®šåˆ†åŒºï¼Œæœ€ååˆ°è¾¾broker-acks-x3D-0ï¼Œæ¶ˆæ¯æ”¾åˆ°ç¼“å†²åŒºå°±è®¤ä¸ºå‘é€å®Œæˆ-acks-x3D-1æ¶ˆæ¯å†™åˆ°ä¸»åˆ†åŒºå³å¯å®Œæˆï¼Œå¦‚æœä¸»åˆ†åŒºæ”¶åˆ°æ¶ˆæ¯ä¹‹åå®•æœºï¼Œå‰¯æœ¬åˆ†åŒºæ¥ä¸åŠåŒæ­¥æ¶ˆæ¯ï¼Œæ¶ˆæ¯å°±ä¼šä¸¢å¤±-acks-x3D-all-ç­‰å¾…æ‰€æœ‰çš„ISRå‰¯æœ¬çš„ç¼ºäººè®°å½•5-å¦‚æœè®¾ç½®äº†é‡è¯•æ¬¡æ•°å¹¶ä¸”å¤§äº0ï¼Œå°±ä¼šè¿›è¡Œé‡è¯•6-æˆåŠŸï¼Œè¿”å›å…ƒæ•°æ®ç»™ç”Ÿäº§è€…ISRï¼ˆIn-Sync-Replicasï¼‰æ˜¯æŒ‡ä¸é¢†å¯¼è€…å‰¯æœ¬ä¿æŒåŒæ­¥çš„å‰¯æœ¬é›†åˆ-ç”Ÿäº§è€…Offsetæ¶ˆæ¯å†™å…¥çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ªoffsetï¼Œå³æ¯ä¸ªåˆ†åŒºçš„æœ€æ–°æœ€å¤§çš„offsetã€‚-æ¶ˆè´¹è€…Offsetä¸åŒæ¶ˆè´¹ç»„ä¸­çš„æ¶ˆè´¹è€…å¯ä»¥é’ˆå¯¹ä¸€ä¸ªåˆ†åŒºå­˜å‚¨ä¸åŒçš„Offsetï¼Œäº’ä¸å½±å“ã€‚-LogSegmentæ—¥å¿—æ–‡ä»¶çš„ç»„æˆéƒ¨åˆ†-Leaderé€‰ä¸¾-Kafkaä¼šåœ¨Zookeeperä¸Šé’ˆå¯¹æ¯ä¸ªTopicç»´æŠ¤ä¸€ä¸ªæˆä¸ºISRçš„é›†åˆ-å½“é›†åˆä¸­å‰¯æœ¬éƒ½è·ŸLeaderåŒçš„å‰¯æœ¬åŒæ­¥ä¹‹åï¼Œkafkaæ‰ä¼šè®¤ä¸ºæ¶ˆæ¯å·²æäº¤-åªæœ‰è¿™äº›è·ŸLeaderä¿æŒåŒæ­¥çš„Followeræ‰åº”è¯¥è¢«é€‰ä½œæ–°çš„Leader" class="headerlink" title="å¸¸è§é—®é¢˜## Java API- ä¸€ä¸ªç‹¬ç«‹çš„KafkaæœåŠ¡å™¨è¢«ç§°ä½œbroker,brokeræ˜¯é›†ç¾¤çš„ç»„æˆéƒ¨åˆ†ï¼Œæ¯ä¸ªé›†ç¾¤éƒ½æœ‰ä¸€ä¸ªbrokeråŒæ—¶å……å½“äº†é›†ç¾¤æ§åˆ¶å™¨çš„è§’è‰²- kafkaçš„ä¸»é¢˜è¢«åˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼Œåˆ†åŒºå­˜å‚¨åœ¨ç£ç›˜ä¸­- kafkaçš„æ¶ˆæ¯ç‰¹ç‚¹ï¼šæ¶ˆæ¯ä¼šä¿ç•™ä¸€æ®µæ—¶é—´ï¼Œå³ä½¿åº”ç”¨ç¨‹åºä¸‹çº¿ï¼Œæ¶ˆæ¯ä»ç„¶ä¼šä¿å­˜åœ¨kafkaé‡Œï¼Œæ˜¯åŸºäºç£ç›˜çš„æ•°æ®å­˜å‚¨ã€‚- APIä½¿ç”¨ï¼š    - producer        - recordçš„å‚æ•°ï¼Œtopic , key ,value keyå¯ä»¥çœç•¥ï¼Œå½“çœç•¥æ—¶å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰keyçš„valueï¼Œkeyä¸€èˆ¬ç”¨äºæŠŠç›¸åŒkeyçš„æ•°æ®å†™å…¥åŒä¸€ä¸ªåˆ†åŒºé‡Œ        - sendé»˜è®¤æ˜¯å‘é€å¹¶å¿˜è®°ï¼Œsendä¼šè¿”å›ä¸€ä¸ªFutureå¯¹è±¡ä½¿ç”¨.getæ–¹æ³•å¾—åˆ°RecordMetadataå¯¹è±¡ï¼Œå¯ä»¥è·å–æ¶ˆæ¯çš„åç§»é‡        - å¼‚æ­¥å‘é€.send(record,å›è°ƒå‡½æ•°ç±»)ï¼Œå›è°ƒå‡½æ•°éœ€è¦å®ç°Callbackç±»ï¼Œå¹¶ä¸”é‡å†™å…¶ä¸­çš„æ–¹æ³•        - é…ç½®è®¾ç½®ï¼š            1. acks = 0 ç”Ÿäº§è€…æ— éœ€ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ï¼Œä½†æ¶ˆæ¯ä¸¢å¤±æ—¶ä¸ä¼šçŸ¥æ™“ï¼Œ = 1ï¼Œåªè¦é›†ç¾¤çš„é¦–é¢†èŠ‚ç‚¹æ”¶åˆ°å³å¯ï¼Œ= alléœ€è¦æ‰€æœ‰å‚ä¸å¤åˆ¶çš„èŠ‚ç‚¹éƒ½å—åˆ°æ¶ˆæ¯æ‰ä¼šå—åˆ°æœåŠ¡å™¨çš„å“åº”ï¼Œä¸å»ºè®®            2. buffer.memoryè®¾ç½®producerå†…å­˜ç¼“å†²åŒºå¤§å°ï¼Œ            3. compression.typeè®¾ç½®æ¶ˆæ¯çš„å‹ç¼©æ ¼å¼ï¼Œé»˜è®¤ä¸ä¼šå‹ç¼©            4. retriesé‡è¯•æ¬¡æ•°            5. batch.size å½“å¤šä¸ªæ¶ˆæ¯è¢«å‘é€åˆ°åŒä¸€ä¸ªåˆ†åŒºæ—¶ï¼Œproducerä¼šæŠŠä»–ä»¬æ”¾åœ¨ä¸€èµ·ï¼Œå½“ä½œä¸€ä¸ªæ‰¹æ¬¡ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å®šä¸€ä¸ªæ‰¹æ¬¡å¯ä»¥ä½¿ç”¨çš„æœ€å¤§å†…å­˜            6. max.in.flight.requests.per.connection ç”Ÿäº§è€…åœ¨æ¥æ”¶åˆ°æœåŠ¡å™¨å“åº”ä¹‹å‰å¯ä»¥å‘é€å¤šå°‘ä¸ªæ¶ˆæ¯ï¼Œè®¾ç½®ä¸º 1 æ—¶å¯ä»¥ä¿è¯æ¶ˆæ¯æ˜¯æŒ‰ç…§é¡ºåºå†™å…¥çš„ï¼Œé€‚åˆåœ¨é“¶è¡Œç­‰ä¸¥æ ¼è¦æ±‚é¡ºåºçš„æ—¶å€™ä½¿ç”¨        - è‡ªå®šä¹‰åˆ†åŒºï¼š        -  consumer:        - API:            1. consumerç±»çš„åˆ›å»ºæ–¹å¼å’Œproducerä¸€è‡´ï¼Œä½†æ˜¯æ¨èæŒ‡å®š group.idæ¥æŒ‡å®šå±äºå“ªä¸ªç¾¤ç»„ï¼Œ            2. consumer.subscirbe()è®¢é˜…ç›¸å…³çš„topicï¼ŒåŒæ—¶æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ consumer.subscribe(Arrays.asList(&quot;topic1&quot;, &quot;topic2&quot;));            3. consumer.poll(xxx) å‚æ•°æ˜¯è½®è¯¢çš„é˜»å¡æ—¶é—´ï¼Œä¼šç­‰å¾…brokerè¿”å›æ•°æ®            4. è®°å¾—.close()            5. å»ºè®®ä¸€ä¸ªçº¿ç¨‹ä¸­åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…        - é…ç½®ï¼š            - å¤§éƒ¨åˆ†å’Œproducerç±»ä¼¼            - fetch.min.bytesæ¶ˆè´¹è€…ä»æœåŠ¡å™¨è·å–è®°å½•çš„æœ€å°å­—èŠ‚æ•°ï¼Œå½“æ•°æ®é‡å¤§äºç­‰äºè¿™ä¸ªå€¼æ‰ä¼šè¢«è¿”å›ç»™æ¶ˆè´¹è€…        - æäº¤å’Œåç§»é‡ï¼šæ¶ˆè´¹è€…å¾€_consumer_offsetç‰¹æ®Šä¸»é¢˜å‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯åŒ…å«æ¯ä¸ªåˆ†åŒºçš„åç§»é‡ï¼Œå½“è§¦å‘å†å‡è¡¡æ—¶ï¼Œæ¶ˆè´¹è€…ä¼šè¯»å–æ¯ä¸ªåˆ†åŒºç»„åä¸€æ¬¡æäº¤çš„åç§»é‡ï¼Œç„¶åä»åç§»é‡æŒ‡å®šçš„åœ°æ–¹å¼€å§‹å¤„ç†            - æäº¤æ–¹å¼ï¼š                1. è‡ªåŠ¨æäº¤:æ¯éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨æäº¤ä¸€æ¬¡                2. æäº¤å½“å‰åç§»é‡:è®¾ç½®auto.commit.offsetä¸ºfalse.ç„¶åä½¿ç”¨commitSync()æäº¤åç§»é‡ï¼Œä¼šæäº¤æœ€æ–°çš„ä¸€æ¬¡ç”±pollè·å¾—çš„åç§»é‡                3. å¼‚æ­¥æäº¤ï¼šcommitAsync()ï¼Œä¹Ÿå¯ä½¿ç”¨å›è°ƒå‡½æ•°æ¥å¤„ç†                4. å¯ä»¥æäº¤ç‰¹å®šåç§»é‡ï¼Œè€Œä¸æ˜¯æœ€åä¸€æ¬¡pollå¾—åˆ°çš„åç§»é‡        - é€šè¿‡å®ç° ConsumerRebalanceListeneræ¥å£æ¥å®šä¹‰åœ¨consumerå¤±å»å¯¹åˆ†åŒºçš„æ‰€æœ‰æƒæ—¶éœ€è¦å¤„ç†çš„äº‹ä»¶ï¼Œå¯åœ¨è¿™é‡Œä½¿ç”¨.seek()æ–¹æ³•åŠ ä¸Šè‡ªå®šä¹‰çš„å‡½æ•°æ¥å®ç°ä»æ•°æ®åº“ä¸­è·å¾—åç§»é‡## Kafkaæœ¬ä½“### ä¼˜åŠ¿é«˜ååï¼Œé«˜æ€§èƒ½ï¼ŒæŒä¹…åŒ–(å°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œé€šè¿‡å°†æ•°æ®æŒä¹…åŒ–ç¡¬ç›˜ï¼Œä»¥åŠfollowerèŠ‚ç‚¹æ¥é˜²æ­¢æ•°æ®ä¸¢å¤±)ç¼ºç‚¹æ˜¯å¼‚æ­¥çš„ä¸é€‚åˆç”µå•†åœºæ™¯### æ¶æ„è®¾è®¡- Producer- Consumer- Topic ä¸»é¢˜ï¼Œç”±ç”¨æˆ·å®šä¹‰å¹¶é…ç½®åœ¨KafkaæœåŠ¡å™¨ï¼Œå»ºç«‹Producerå’ŒConsumerä¹‹é—´çš„è®¢é˜…å…³ç³»ï¼Œèº«ç¼ è¿™å‘é€æ¶ˆæ¯åˆ°ç‰¹å®šçš„Topicä¸‹ï¼Œæ¶ˆè´¹è€…ä»è¿™ä¸ªTopicä¸‹æ¶ˆè´¹æ¶ˆæ¯ã€‚é€»è¾‘æ¦‚å¿µï¼Œç›¸å½“äºæ•°æ®åº“ä¸­çš„è¡¨- Partition æ¶ˆæ¯åˆ†åŒºï¼Œä¸€ä¸ªTopicå¯ä»¥åˆ†ä¸ºå¤šä¸ªpartitionï¼Œpartitionæ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ï¼Œpartitionçš„æ¯æ¡æ¶ˆæ¯éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªæœ‰åºçš„id(offset) ç‰©ç†å®é™…æ¦‚å¿µï¼Œæ¯ä¸€ä¸ªpartitionå¯¹åº”ä¸€ä¸ªlogï¼Œproducerç”Ÿäº§çš„æ•°æ®ä¼šä¸æ–­åœ°è¿½åŠ åˆ°è¯¥logæ–‡ä»¶æœ«ç«¯ï¼Œä¸”æ¯æ¡æ•°æ®éƒ½æœ‰è‡ªå·±çš„offsetã€‚ç³»å“¦å•Šé£ç€ç»„ä¸­çš„æ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šå®æ—¶è®°å½•è‡ªå·±æ¶ˆè´¹åˆ°å“ªä¸ªoffset- Broker ä¸€å°Kafkaå°±æ˜¯ä¸€ä¸ªbrokerï¼Œä¸€ä¸ªé›†ç¾¤ç”±å¤šä¸ªbrokerç»„æˆï¼Œä¸€ä¸ªbrokerå¯ä»¥å®¹çº³å¤šä¸ªtopic- ConsumerGroup æ¶ˆè´¹è€…ç»„ï¼Œç”¨äºå½’ç»„åŒç±»æ¶ˆè´¹è€…ã€‚æ¯ä¸ªconsumerå±äºä¸€ä¸ªç‰¹å®šçš„consumer groupï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥å…±åŒæ¶ˆè´¹ä¸€ä¸ªTopicä¸‹çš„æ¶ˆæ¯ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…è·å–éƒ¨åˆ†æ¶ˆæ¯ã€‚- ä¸€ä¸ªPartitionå¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸‹ä½¿ç”¨çš„æ˜¯Segment Fileçš„å­˜å‚¨æ–¹å¼è¿›è¡Œå­˜å‚¨ã€‚å°†å¤§æ–‡ä»¶æ‹†æˆå°æ–‡ä»¶ï¼Œåˆ†ä¸ºç´¢å¼•æœªè§å’Œæ•°æ®æ–‡ä»¶### åŸºæœ¬æµç¨‹- producerå…ˆä»zookeeperçš„broker/**/stateèŠ‚ç‚¹æ‰¾åˆ°è¯¥partitonçš„leader- producerå°†æ¶ˆæ¯å‘é€ç»™è¯¥leader- leaderå°†æ¶ˆæ¯å†™å‡ºæœ¬åœ°log- followerä»leader pull æ¶ˆæ¯- å†™å…¥æœ¬åœ°logï¼Œåå‘leaderå‘é€ACK- leaderæ”¶åˆ°æ‰€æœ‰ISRä¸­çš„replicationçš„ACKï¼Œå¢åŠ HT(high watermark ï¼Œæœ€åcommit çš„offset)å¹¶å‘producerå‘é€ACK#### ç”Ÿäº§è¿‡ç¨‹1. Produceråˆ›å»ºæ—¶ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªSenderçº¿ç¨‹å¹¶ä¸”è®¾ç½®å®ˆæŠ¤çº¿ç¨‹2. ç”Ÿäº§çš„æ¶ˆæ¯ç»è¿‡æ‹¦æˆªå™¨->åºåˆ—åŒ–å™¨->åˆ†åŒºå™¨ï¼Œå°†æ¶ˆæ¯å­˜åœ¨ç¼“å†²åŒº3. æ‰¹é‡å‘é€çš„æ¡ä»¶ï¼šç¼“å†²åŒºæ•°æ®å¤§å°è¾¾åˆ°batch.sizeæˆ–è€…linger.msè¾¾åˆ°ä¸Šé™4. å‘å¾€æŒ‡å®šåˆ†åŒºï¼Œæœ€ååˆ°è¾¾broker    - acks = 0ï¼Œæ¶ˆæ¯æ”¾åˆ°ç¼“å†²åŒºå°±è®¤ä¸ºå‘é€å®Œæˆ    - acks = 1æ¶ˆæ¯å†™åˆ°ä¸»åˆ†åŒºå³å¯å®Œæˆï¼Œå¦‚æœä¸»åˆ†åŒºæ”¶åˆ°æ¶ˆæ¯ä¹‹åå®•æœºï¼Œå‰¯æœ¬åˆ†åŒºæ¥ä¸åŠåŒæ­¥æ¶ˆæ¯ï¼Œæ¶ˆæ¯å°±ä¼šä¸¢å¤±    - acks = all ç­‰å¾…æ‰€æœ‰çš„ISRå‰¯æœ¬çš„ç¼ºäººè®°å½•5. å¦‚æœè®¾ç½®äº†é‡è¯•æ¬¡æ•°å¹¶ä¸”å¤§äº0ï¼Œå°±ä¼šè¿›è¡Œé‡è¯•6. æˆåŠŸï¼Œè¿”å›å…ƒæ•°æ®ç»™ç”Ÿäº§è€…ISRï¼ˆIn-Sync Replicasï¼‰æ˜¯æŒ‡ä¸é¢†å¯¼è€…å‰¯æœ¬ä¿æŒåŒæ­¥çš„å‰¯æœ¬é›†åˆ#### ç”Ÿäº§è€…Offsetæ¶ˆæ¯å†™å…¥çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ªoffsetï¼Œå³æ¯ä¸ªåˆ†åŒºçš„æœ€æ–°æœ€å¤§çš„offsetã€‚#### æ¶ˆè´¹è€…Offsetä¸åŒæ¶ˆè´¹ç»„ä¸­çš„æ¶ˆè´¹è€…å¯ä»¥é’ˆå¯¹ä¸€ä¸ªåˆ†åŒºå­˜å‚¨ä¸åŒçš„Offsetï¼Œäº’ä¸å½±å“ã€‚#### LogSegmentæ—¥å¿—æ–‡ä»¶çš„ç»„æˆéƒ¨åˆ†#### Leaderé€‰ä¸¾- Kafkaä¼šåœ¨Zookeeperä¸Šé’ˆå¯¹æ¯ä¸ªTopicç»´æŠ¤ä¸€ä¸ªæˆä¸ºISRçš„é›†åˆ- å½“é›†åˆä¸­å‰¯æœ¬éƒ½è·ŸLeaderåŒçš„å‰¯æœ¬åŒæ­¥ä¹‹åï¼Œkafkaæ‰ä¼šè®¤ä¸ºæ¶ˆæ¯å·²æäº¤- åªæœ‰è¿™äº›è·ŸLeaderä¿æŒåŒæ­¥çš„Followeræ‰åº”è¯¥è¢«é€‰ä½œæ–°çš„Leader"></a><a href="https://javaguide.cn/high-performance/message-queue/kafka-questions-01.html">å¸¸è§é—®é¢˜</a><br>## Java API<br>- ä¸€ä¸ªç‹¬ç«‹çš„KafkaæœåŠ¡å™¨è¢«ç§°ä½œbroker,brokeræ˜¯é›†ç¾¤çš„ç»„æˆéƒ¨åˆ†ï¼Œæ¯ä¸ªé›†ç¾¤éƒ½æœ‰ä¸€ä¸ªbrokeråŒæ—¶å……å½“äº†é›†ç¾¤æ§åˆ¶å™¨çš„è§’è‰²<br>- kafkaçš„ä¸»é¢˜è¢«åˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼Œåˆ†åŒºå­˜å‚¨åœ¨ç£ç›˜ä¸­<br>- kafkaçš„æ¶ˆæ¯ç‰¹ç‚¹ï¼šæ¶ˆæ¯ä¼šä¿ç•™ä¸€æ®µæ—¶é—´ï¼Œå³ä½¿åº”ç”¨ç¨‹åºä¸‹çº¿ï¼Œæ¶ˆæ¯ä»ç„¶ä¼šä¿å­˜åœ¨kafkaé‡Œï¼Œæ˜¯åŸºäºç£ç›˜çš„æ•°æ®å­˜å‚¨ã€‚<br>- APIä½¿ç”¨ï¼š<br>    - producer<br>        - recordçš„å‚æ•°ï¼Œtopic , key ,value keyå¯ä»¥çœç•¥ï¼Œå½“çœç•¥æ—¶å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰keyçš„valueï¼Œkeyä¸€èˆ¬ç”¨äºæŠŠç›¸åŒkeyçš„æ•°æ®å†™å…¥åŒä¸€ä¸ªåˆ†åŒºé‡Œ<br>        - sendé»˜è®¤æ˜¯å‘é€å¹¶å¿˜è®°ï¼Œsendä¼šè¿”å›ä¸€ä¸ªFutureå¯¹è±¡ä½¿ç”¨.getæ–¹æ³•å¾—åˆ°RecordMetadataå¯¹è±¡ï¼Œå¯ä»¥è·å–æ¶ˆæ¯çš„åç§»é‡<br>        - å¼‚æ­¥å‘é€.send(record,å›è°ƒå‡½æ•°ç±»)ï¼Œå›è°ƒå‡½æ•°éœ€è¦å®ç°Callbackç±»ï¼Œå¹¶ä¸”é‡å†™å…¶ä¸­çš„æ–¹æ³•<br>        - é…ç½®è®¾ç½®ï¼š<br>            1. acks = 0 ç”Ÿäº§è€…æ— éœ€ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ï¼Œä½†æ¶ˆæ¯ä¸¢å¤±æ—¶ä¸ä¼šçŸ¥æ™“ï¼Œ = 1ï¼Œåªè¦é›†ç¾¤çš„é¦–é¢†èŠ‚ç‚¹æ”¶åˆ°å³å¯ï¼Œ= alléœ€è¦æ‰€æœ‰å‚ä¸å¤åˆ¶çš„èŠ‚ç‚¹éƒ½å—åˆ°æ¶ˆæ¯æ‰ä¼šå—åˆ°æœåŠ¡å™¨çš„å“åº”ï¼Œä¸å»ºè®®<br>            2. buffer.memoryè®¾ç½®producerå†…å­˜ç¼“å†²åŒºå¤§å°ï¼Œ<br>            3. compression.typeè®¾ç½®æ¶ˆæ¯çš„å‹ç¼©æ ¼å¼ï¼Œé»˜è®¤ä¸ä¼šå‹ç¼©<br>            4. retriesé‡è¯•æ¬¡æ•°<br>            5. batch.size å½“å¤šä¸ªæ¶ˆæ¯è¢«å‘é€åˆ°åŒä¸€ä¸ªåˆ†åŒºæ—¶ï¼Œproducerä¼šæŠŠä»–ä»¬æ”¾åœ¨ä¸€èµ·ï¼Œå½“ä½œä¸€ä¸ªæ‰¹æ¬¡ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å®šä¸€ä¸ªæ‰¹æ¬¡å¯ä»¥ä½¿ç”¨çš„æœ€å¤§å†…å­˜<br>            6. max.in.flight.requests.per.connection ç”Ÿäº§è€…åœ¨æ¥æ”¶åˆ°æœåŠ¡å™¨å“åº”ä¹‹å‰å¯ä»¥å‘é€å¤šå°‘ä¸ªæ¶ˆæ¯ï¼Œè®¾ç½®ä¸º 1 æ—¶å¯ä»¥ä¿è¯æ¶ˆæ¯æ˜¯æŒ‰ç…§é¡ºåºå†™å…¥çš„ï¼Œé€‚åˆåœ¨é“¶è¡Œç­‰ä¸¥æ ¼è¦æ±‚é¡ºåºçš„æ—¶å€™ä½¿ç”¨<br>        - è‡ªå®šä¹‰åˆ†åŒºï¼š<br>    <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoPartitionser</span> <span class="token keyword">implements</span> <span class="token class-name">Partitioner</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> myKey<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">Object</span> key<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keyBytes<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> valueBytes<span class="token punctuation">,</span> <span class="token class-name">Cluster</span> cluster<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// è·å–åˆ†åŒºåˆ—è¡¨</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PartitionInfo</span><span class="token punctuation">&gt;</span></span> partitionInfos <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token function">partitionsForTopic</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–åˆ†åŒºæ•°</span>        <span class="token keyword">int</span> partitionNum <span class="token operator">=</span> partitionInfos<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>keyBytes <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"key is null or not a string"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// å¦‚æœkeyä¸ºkeyï¼Œåˆ™åˆ†é…åˆ°æœ€åä¸€ä¸ªåˆ†åŒº</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> partitionNum<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">//å…¶ä½™çš„æ¶ˆæ¯éƒ½åˆ†é…åˆ°æœ€åä¸€ä¸ªåˆ†åŒº</span>        <span class="token keyword">return</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span>partitionNum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token comment">/*     * @description:     * @author bronya     * @date: 2024/4/20 14:50     * @param map     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>        myKey <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>    -  consumer:<br>        - API:<br>            1. consumerç±»çš„åˆ›å»ºæ–¹å¼å’Œproducerä¸€è‡´ï¼Œä½†æ˜¯æ¨èæŒ‡å®š group.idæ¥æŒ‡å®šå±äºå“ªä¸ªç¾¤ç»„ï¼Œ<br>            2. consumer.subscirbe()è®¢é˜…ç›¸å…³çš„topicï¼ŒåŒæ—¶æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ <code>consumer.subscribe(Arrays.asList("topic1", "topic2"));</code><br>            3. consumer.poll(xxx) å‚æ•°æ˜¯è½®è¯¢çš„é˜»å¡æ—¶é—´ï¼Œä¼šç­‰å¾…brokerè¿”å›æ•°æ®<br>            4. è®°å¾—.close()<br>            5. å»ºè®®ä¸€ä¸ªçº¿ç¨‹ä¸­åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…<br>        - é…ç½®ï¼š<br>            - å¤§éƒ¨åˆ†å’Œproducerç±»ä¼¼<br>            - fetch.min.bytesæ¶ˆè´¹è€…ä»æœåŠ¡å™¨è·å–è®°å½•çš„æœ€å°å­—èŠ‚æ•°ï¼Œå½“æ•°æ®é‡å¤§äºç­‰äºè¿™ä¸ªå€¼æ‰ä¼šè¢«è¿”å›ç»™æ¶ˆè´¹è€…<br>        - æäº¤å’Œåç§»é‡ï¼šæ¶ˆè´¹è€…å¾€_consumer_offsetç‰¹æ®Šä¸»é¢˜å‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯åŒ…å«æ¯ä¸ªåˆ†åŒºçš„åç§»é‡ï¼Œå½“è§¦å‘å†å‡è¡¡æ—¶ï¼Œæ¶ˆè´¹è€…ä¼šè¯»å–æ¯ä¸ªåˆ†åŒºç»„åä¸€æ¬¡æäº¤çš„åç§»é‡ï¼Œç„¶åä»åç§»é‡æŒ‡å®šçš„åœ°æ–¹å¼€å§‹å¤„ç†<br>            - æäº¤æ–¹å¼ï¼š<br>                1. è‡ªåŠ¨æäº¤:æ¯éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨æäº¤ä¸€æ¬¡<br>                2. æäº¤å½“å‰åç§»é‡:è®¾ç½®auto.commit.offsetä¸ºfalse.ç„¶åä½¿ç”¨commitSync()æäº¤åç§»é‡ï¼Œä¼šæäº¤æœ€æ–°çš„ä¸€æ¬¡ç”±pollè·å¾—çš„åç§»é‡<br>                3. å¼‚æ­¥æäº¤ï¼šcommitAsync()ï¼Œä¹Ÿå¯ä½¿ç”¨å›è°ƒå‡½æ•°æ¥å¤„ç†<br>                4. å¯ä»¥æäº¤ç‰¹å®šåç§»é‡ï¼Œè€Œä¸æ˜¯æœ€åä¸€æ¬¡pollå¾—åˆ°çš„åç§»é‡<br>        - é€šè¿‡å®ç° ConsumerRebalanceListeneræ¥å£æ¥å®šä¹‰åœ¨consumerå¤±å»å¯¹åˆ†åŒºçš„æ‰€æœ‰æƒæ—¶éœ€è¦å¤„ç†çš„äº‹ä»¶ï¼Œå¯åœ¨è¿™é‡Œä½¿ç”¨.seek()æ–¹æ³•åŠ ä¸Šè‡ªå®šä¹‰çš„å‡½æ•°æ¥å®ç°ä»æ•°æ®åº“ä¸­è·å¾—åç§»é‡<br>## Kafkaæœ¬ä½“<br>### ä¼˜åŠ¿<br>é«˜ååï¼Œé«˜æ€§èƒ½ï¼ŒæŒä¹…åŒ–(å°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œé€šè¿‡å°†æ•°æ®æŒä¹…åŒ–ç¡¬ç›˜ï¼Œä»¥åŠfollowerèŠ‚ç‚¹æ¥é˜²æ­¢æ•°æ®ä¸¢å¤±)<br>ç¼ºç‚¹æ˜¯å¼‚æ­¥çš„ä¸é€‚åˆç”µå•†åœºæ™¯<br>### æ¶æ„è®¾è®¡<br>- Producer<br>- Consumer<br>- Topic ä¸»é¢˜ï¼Œç”±ç”¨æˆ·å®šä¹‰å¹¶é…ç½®åœ¨KafkaæœåŠ¡å™¨ï¼Œå»ºç«‹Producerå’ŒConsumerä¹‹é—´çš„è®¢é˜…å…³ç³»ï¼Œèº«ç¼ è¿™å‘é€æ¶ˆæ¯åˆ°ç‰¹å®šçš„Topicä¸‹ï¼Œæ¶ˆè´¹è€…ä»è¿™ä¸ªTopicä¸‹æ¶ˆè´¹æ¶ˆæ¯ã€‚é€»è¾‘æ¦‚å¿µï¼Œç›¸å½“äºæ•°æ®åº“ä¸­çš„è¡¨<br>- Partition æ¶ˆæ¯åˆ†åŒºï¼Œä¸€ä¸ªTopicå¯ä»¥åˆ†ä¸ºå¤šä¸ªpartitionï¼Œpartitionæ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ï¼Œpartitionçš„æ¯æ¡æ¶ˆæ¯éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªæœ‰åºçš„id(offset) ç‰©ç†å®é™…æ¦‚å¿µï¼Œæ¯ä¸€ä¸ªpartitionå¯¹åº”ä¸€ä¸ªlogï¼Œproducerç”Ÿäº§çš„æ•°æ®ä¼šä¸æ–­åœ°è¿½åŠ åˆ°è¯¥logæ–‡ä»¶æœ«ç«¯ï¼Œä¸”æ¯æ¡æ•°æ®éƒ½æœ‰è‡ªå·±çš„offsetã€‚ç³»å“¦å•Šé£ç€ç»„ä¸­çš„æ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šå®æ—¶è®°å½•è‡ªå·±æ¶ˆè´¹åˆ°å“ªä¸ªoffset<br>- Broker ä¸€å°Kafkaå°±æ˜¯ä¸€ä¸ªbrokerï¼Œä¸€ä¸ªé›†ç¾¤ç”±å¤šä¸ªbrokerç»„æˆï¼Œä¸€ä¸ªbrokerå¯ä»¥å®¹çº³å¤šä¸ªtopic<br>- ConsumerGroup æ¶ˆè´¹è€…ç»„ï¼Œç”¨äºå½’ç»„åŒç±»æ¶ˆè´¹è€…ã€‚æ¯ä¸ªconsumerå±äºä¸€ä¸ªç‰¹å®šçš„consumer groupï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥å…±åŒæ¶ˆè´¹ä¸€ä¸ªTopicä¸‹çš„æ¶ˆæ¯ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…è·å–éƒ¨åˆ†æ¶ˆæ¯ã€‚<br>- ä¸€ä¸ªPartitionå¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸‹ä½¿ç”¨çš„æ˜¯Segment Fileçš„å­˜å‚¨æ–¹å¼è¿›è¡Œå­˜å‚¨ã€‚å°†å¤§æ–‡ä»¶æ‹†æˆå°æ–‡ä»¶ï¼Œåˆ†ä¸ºç´¢å¼•æœªè§å’Œæ•°æ®æ–‡ä»¶<br>### åŸºæœ¬æµç¨‹<br>- producerå…ˆä»zookeeperçš„broker/**/stateèŠ‚ç‚¹æ‰¾åˆ°è¯¥partitonçš„leader<br>- producerå°†æ¶ˆæ¯å‘é€ç»™è¯¥leader<br>- leaderå°†æ¶ˆæ¯å†™å‡ºæœ¬åœ°log<br>- followerä»leader pull æ¶ˆæ¯<br>- å†™å…¥æœ¬åœ°logï¼Œåå‘leaderå‘é€ACK<br>- leaderæ”¶åˆ°æ‰€æœ‰ISRä¸­çš„replicationçš„ACKï¼Œå¢åŠ HT(high watermark ï¼Œæœ€åcommit çš„offset)å¹¶å‘producerå‘é€ACK<br>#### ç”Ÿäº§è¿‡ç¨‹<br>1. Produceråˆ›å»ºæ—¶ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªSenderçº¿ç¨‹å¹¶ä¸”è®¾ç½®å®ˆæŠ¤çº¿ç¨‹<br>2. ç”Ÿäº§çš„æ¶ˆæ¯ç»è¿‡æ‹¦æˆªå™¨-&gt;åºåˆ—åŒ–å™¨-&gt;åˆ†åŒºå™¨ï¼Œå°†æ¶ˆæ¯å­˜åœ¨ç¼“å†²åŒº<br>3. æ‰¹é‡å‘é€çš„æ¡ä»¶ï¼šç¼“å†²åŒºæ•°æ®å¤§å°è¾¾åˆ°batch.sizeæˆ–è€…linger.msè¾¾åˆ°ä¸Šé™<br>4. å‘å¾€æŒ‡å®šåˆ†åŒºï¼Œæœ€ååˆ°è¾¾broker<br>    - acks = 0ï¼Œæ¶ˆæ¯æ”¾åˆ°ç¼“å†²åŒºå°±è®¤ä¸ºå‘é€å®Œæˆ<br>    - acks = 1æ¶ˆæ¯å†™åˆ°ä¸»åˆ†åŒºå³å¯å®Œæˆï¼Œå¦‚æœä¸»åˆ†åŒºæ”¶åˆ°æ¶ˆæ¯ä¹‹åå®•æœºï¼Œå‰¯æœ¬åˆ†åŒºæ¥ä¸åŠåŒæ­¥æ¶ˆæ¯ï¼Œæ¶ˆæ¯å°±ä¼šä¸¢å¤±<br>    - acks = all ç­‰å¾…æ‰€æœ‰çš„ISRå‰¯æœ¬çš„ç¼ºäººè®°å½•<br>5. å¦‚æœè®¾ç½®äº†é‡è¯•æ¬¡æ•°å¹¶ä¸”å¤§äº0ï¼Œå°±ä¼šè¿›è¡Œé‡è¯•<br>6. æˆåŠŸï¼Œè¿”å›å…ƒæ•°æ®ç»™ç”Ÿäº§è€…<br>ISRï¼ˆIn-Sync Replicasï¼‰æ˜¯æŒ‡ä¸é¢†å¯¼è€…å‰¯æœ¬ä¿æŒåŒæ­¥çš„å‰¯æœ¬é›†åˆ<br>#### ç”Ÿäº§è€…Offset<br>æ¶ˆæ¯å†™å…¥çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ªoffsetï¼Œå³æ¯ä¸ªåˆ†åŒºçš„æœ€æ–°æœ€å¤§çš„offsetã€‚<br>#### æ¶ˆè´¹è€…Offset<br>ä¸åŒæ¶ˆè´¹ç»„ä¸­çš„æ¶ˆè´¹è€…å¯ä»¥é’ˆå¯¹ä¸€ä¸ªåˆ†åŒºå­˜å‚¨ä¸åŒçš„Offsetï¼Œäº’ä¸å½±å“ã€‚<br>#### LogSegment<br>æ—¥å¿—æ–‡ä»¶çš„ç»„æˆéƒ¨åˆ†<br>#### Leaderé€‰ä¸¾<br>- Kafkaä¼šåœ¨Zookeeperä¸Šé’ˆå¯¹æ¯ä¸ªTopicç»´æŠ¤ä¸€ä¸ªæˆä¸ºISRçš„é›†åˆ<br>- å½“é›†åˆä¸­å‰¯æœ¬éƒ½è·ŸLeaderåŒçš„å‰¯æœ¬åŒæ­¥ä¹‹åï¼Œkafkaæ‰ä¼šè®¤ä¸ºæ¶ˆæ¯å·²æäº¤<br>- åªæœ‰è¿™äº›è·ŸLeaderä¿æŒåŒæ­¥çš„Followeræ‰åº”è¯¥è¢«é€‰ä½œæ–°çš„Leader</h2>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹å†™rpc</title>
      <link href="/2024/09/02/00/"/>
      <url>/2024/09/02/00/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸ªäººåšå®¢"><a href="#ä¸ªäººåšå®¢" class="headerlink" title="ä¸ªäººåšå®¢"></a>ä¸ªäººåšå®¢</h2><p><a href="https://zuofw.github.io/">https://zuofw.github.io/</a><br>æœ¬é¡¹ç›®è¯¦ç»†ä»‹ç»å’Œå®ç°ï¼š<br><a href="https://zuofw.github.io/2024/09/02/00/">æ‰‹å†™rpc | QingQiuâ€™Blog (zuofw.github.io)</a><br>æºç åœ°å€ï¼š<a href="https://github.com/Zuofw/zuofw-rpc">Zuofw/zuofw-rpc: ä¸€ä¸ªåºŸç‰©çš„æ‰‹å†™rpc (github.com)</a></p><h2 id="é¡¹ç›®ä»‹ç»"><a href="#é¡¹ç›®ä»‹ç»" class="headerlink" title="é¡¹ç›®ä»‹ç»"></a>é¡¹ç›®ä»‹ç»</h2><p>zuofw-rpcæ˜¯ä¸€æ¬¾åŸºäºJavaã€Nettyã€Zookeeperå®ç°çš„RPCé€šä¿¡æ¡†æ¶ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§ï¼š</p><ol><li>ä½¿ç”¨â€å¾®å†…æ ¸+å¯æ’æ‹”â€æ¶æ„ï¼Œé€šè¿‡è‡ªå®šä¹‰SPIåŠ è½½æœºåˆ¶ï¼Œæ”¯æŒç¼“å­˜ï¼ŒåŠ¨æ€æ›¿ä»£æ‰©å±•ç‚¹ç»„ä»¶</li><li>çµæ´»ä½¿ç”¨è®¾è®¡æ¨¡å¼æ¥æé«˜ç³»ç»Ÿå¯æ‰©å±•æ€§ï¼Œå¦‚å•ä¾‹æ¨¡å¼ã€å·¥å‚æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼</li><li>å®ç°æœåŠ¡è°ƒç”¨è´Ÿè½½å‡è¡¡æœºåˆ¶ï¼Œæ”¯æŒè½®è¯¢ã€éšæœºã€ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œä¼˜åŒ–è°ƒç”¨ä½“éªŒ</li><li>é€šè¿‡è‡ªå®šä¹‰é€šä¿¡åè®®ã€æ”¯æŒå¤šç§åºåˆ—åŒ–æ–¹å¼ï¼ŒåŒæ—¶å®ç°Gzipå‹ç¼©ï¼Œæé«˜ç½‘ç»œä¼ è¾“æ•ˆç‡ã€‚</li><li>å®ç°è‡ªå®šä¹‰request - responseæ¨¡å‹ï¼Œåœ¨å¼‚æ­¥é€šä¿¡æ¡ä»¶ä¸‹ç¡®ä¿æ¶ˆæ¯çš„è¯·æ±‚å’Œå“åº”æˆåŠŸ</li><li>åŸºäºè‡ªå®šä¹‰starterå®ç°ï¼Œä¼˜åŒ–SpringBootç¯å¢ƒä¸‹çš„ä½¿ç”¨ã€‚</li></ol><h2 id="åŸºæœ¬æ¶æ„"><a href="#åŸºæœ¬æ¶æ„" class="headerlink" title="åŸºæœ¬æ¶æ„"></a>åŸºæœ¬æ¶æ„</h2><p><img src="/2024/09/02/00/%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84.png"></p><ol><li>æ³¨å†Œä¸­å¿ƒï¼Œç”¨äºæœåŠ¡æ³¨å†Œå’Œè·å–</li><li>æœåŠ¡ç«¯ï¼šæä¾›æœåŠ¡çš„ä¸€æ–¹Provider</li><li>å®¢æˆ·ç«¯ï¼šè°ƒç”¨æœåŠ¡çš„ä¸€æ–¹Consumer<br>åŸºæœ¬æµç¨‹ï¼š</li><li>æœåŠ¡ç«¯æŠŠæœåŠ¡ä¿¡æ¯æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸Šï¼Œä¸€èˆ¬åŒ…æ‹¬æœåŠ¡ç«¯åœ°å€ã€æ¥å£ç±»å’Œæ–¹æ³•</li><li>å®¢æˆ·ç«¯ä»æ³¨å†Œä¸­å¿ƒè·å–å¯¹åº”çš„æœåŠ¡ä¿¡æ¯</li><li>å®¢æˆ·ç«¯æ ¹æ®æœåŠ¡çš„ä¿¡æ¯ï¼Œé€šè¿‡ç½‘ç»œè°ƒç”¨æœåŠ¡ç«¯çš„æ¥å£</li></ol><h2 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h2><ol><li>SpringBootç¯å¢ƒä¸‹å¼•å…¥ä¾èµ–<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.zuofw.rpc.spring.boot.starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>zuofw-rpc-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>åœ¨å¯åŠ¨ç±»ä¸ŠåŠ ä¸Š <code>@EnableZuofwRpc(needServer = false)</code> æœåŠ¡æä¾›è€…å°†falseæ”¹ä¸ºtrue<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span>  <span class="token annotation punctuation">@EnableZuofwRpc</span><span class="token punctuation">(</span>needServer <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZuofwRpcSpringConsumerApplication</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ZuofwRpcSpringConsumerApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>æœåŠ¡æä¾›è€…åœ¨å®ç°ç±»ä¸ŠåŠ ä¸Š<code>@ZuofwRPCService</code>æ³¨è§£<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span><span class="token annotation punctuation">@ZuofwRPCService</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserserviceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚ï¼Œè¯·æ±‚å‚æ•°ä¸ºï¼š"</span> <span class="token operator">+</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> user<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>æœåŠ¡è°ƒç”¨è€…åœ¨éœ€è¦ä½¿ç”¨çš„æœåŠ¡ä¸ŠåŠ ä¸Š <code>@ZuofwRPCReference</code> å³å¯ä½¿ç”¨<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ZuofwRPCReference</span> <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"zuofw"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token class-name">User</span> resultUser <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"consumer get User:"</span> <span class="token operator">+</span> resultUser<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h2><ol><li>æ³¨å†Œä¸­å¿ƒï¼šå¦‚ä½•å®ç°æˆ–è€…ä½¿ç”¨å“ªä¸ª</li><li>åŠ¨æ€ä»£ç†ï¼šå®¢æˆ·ç«¯è°ƒç”¨æ¥å£ï¼Œéœ€è¦æ¡†æ¶å»æ ¹æ®æ¥å£å»è¿œç¨‹è°ƒç”¨æœåŠ¡ï¼Œéœ€è¦ä½¿ç”¨åŠ¨æ€ä»£ç†ï¼Œå¸¸è§çš„æœ‰ JDK Proxyã€CGLIbã€Javassistç­‰</li><li>ç½‘ç»œä¼ è¾“ï¼šRPCå®é™…ä¸Šæ˜¯ç½‘ç»œä¼ è¾“ï¼Œä½¿ç”¨Netty</li><li>è‡ªå®šä¹‰åè®®ï¼šç½‘ç»œä¼ è¾“éœ€è¦æ­é…è‰¯å¥½çš„åè®®æé«˜ä¼ è¾“æ•ˆç‡</li><li>åºåˆ—åŒ–ï¼šå°†å¯¹è±¡è½¬åŒ–ä¸ºå­—èŠ‚æµ/è½¬æ¢å›å¯¹è±¡ï¼Œç½‘ç»œä¼ è¾“åªèƒ½ä¼ è¾“å­—èŠ‚æµï¼Œæ‰€ä»¥éœ€è¦å®ç°åºåˆ—åŒ–ã€‚</li><li>è´Ÿè½½å‡è¡¡ï¼šè¯·æ±‚å¤§é‡è°ƒç”¨æ—¶ï¼ŒæœåŠ¡ç«¯å¦‚ä½•é€‰æ‹©ï¼Ÿ</li><li>é›†ç¾¤å®¹é”™ï¼šå½“è¯·æ±‚å¼‚å¸¸æ—¶ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ æŠ¥é”™ï¼Ÿé‡è¯•ï¼Ÿè¿˜æ˜¯è¯·æ±‚å…¶ä»–æœåŠ¡ï¼Ÿ</li></ol><h2 id="å¼€å‘è¿‡ç¨‹"><a href="#å¼€å‘è¿‡ç¨‹" class="headerlink" title="å¼€å‘è¿‡ç¨‹"></a>å¼€å‘è¿‡ç¨‹</h2><h3 id="æ•°æ®æ¨¡å‹"><a href="#æ•°æ®æ¨¡å‹" class="headerlink" title="æ•°æ®æ¨¡å‹"></a>æ•°æ®æ¨¡å‹</h3><ol><li>è¯·æ±‚<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RPCRequest</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * æœåŠ¡åç§°     */</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> serviceName<span class="token punctuation">;</span>    <span class="token comment">/**     * æ–¹æ³•åç§°     */</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> methodName<span class="token punctuation">;</span>    <span class="token comment">/**     * å‚æ•°ç±»å‹åˆ—è¡¨     * Classæ˜¯Javaåå°„æœºåˆ¶ä¸­çš„ç±»ï¼Œç”¨äºæè¿°ç±»çš„ç±»å‹ä¿¡æ¯     * ä¸ºä½•ä½¿ç”¨Class&lt;?&gt;è€Œä¸æ˜¯Class&lt;T&gt;ï¼Ÿ     * Class&lt;?&gt;è¡¨ç¤ºæœªçŸ¥ç±»å‹ï¼Œè€ŒClass&lt;T&gt;è¡¨ç¤ºå…·ä½“ç±»å‹     */</span>    <span class="token keyword">private</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes<span class="token punctuation">;</span>    <span class="token comment">/**     * å‚æ•°åˆ—è¡¨     */</span>    <span class="token keyword">private</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å“åº”<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RPCResponse</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * è¯·æ±‚ID     */</span>    <span class="token keyword">private</span> <span class="token keyword">long</span> requestId<span class="token punctuation">;</span>    <span class="token comment">/**     * å“åº”æ•°æ®     */</span>    <span class="token keyword">private</span> <span class="token class-name">Object</span> data<span class="token punctuation">;</span>    <span class="token comment">/**     * å“åº”æ•°æ®ç±»å‹     */</span>    <span class="token keyword">private</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> dataType<span class="token punctuation">;</span>    <span class="token comment">/**     * å“åº”ä¿¡æ¯     */</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>    <span class="token comment">/**     * å¼‚å¸¸ä¿¡æ¯     */</span>    <span class="token keyword">private</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="åˆå§‹åŒ–é…ç½®"><a href="#åˆå§‹åŒ–é…ç½®" class="headerlink" title="åˆå§‹åŒ–é…ç½®"></a>åˆå§‹åŒ–é…ç½®</h3><ul><li>é…ç½®å®šä¹‰<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span>  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RPCConfig</span> <span class="token punctuation">{</span>       <span class="token keyword">private</span> <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">"zuofw-rpc"</span><span class="token punctuation">;</span>       <span class="token keyword">private</span> <span class="token class-name">String</span> version <span class="token operator">=</span> <span class="token string">"1.0"</span><span class="token punctuation">;</span>       <span class="token keyword">private</span> <span class="token class-name">String</span> serverHost <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">;</span>       <span class="token keyword">private</span> <span class="token class-name">Integer</span> serverPort <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>         <span class="token keyword">private</span> <span class="token keyword">boolean</span> mock <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>       <span class="token comment">/**        * åºåˆ—åŒ–å™¨        */</span>       <span class="token keyword">private</span> <span class="token class-name">String</span> serializer <span class="token operator">=</span> <span class="token class-name">SerializerKeys</span><span class="token punctuation">.</span><span class="token constant">JDK</span><span class="token punctuation">;</span>         <span class="token keyword">private</span> <span class="token class-name">RegistryConfig</span> registryConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegistryConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token comment">// æ³¨å†Œä¸­å¿ƒé…ç½®</span><span class="token annotation punctuation">@Data</span>  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RegistryConfig</span> <span class="token punctuation">{</span>      <span class="token comment">/**       * æ³¨å†Œä¸­å¿ƒç±»å‹       */</span>      <span class="token keyword">private</span> <span class="token class-name">String</span> registry <span class="token operator">=</span> <span class="token string">"zookeeper"</span><span class="token punctuation">;</span>        <span class="token comment">/**       * åœ°å€       */</span>      <span class="token keyword">private</span> <span class="token class-name">String</span> address <span class="token operator">=</span> <span class="token string">"http://192.168.61.190:2181"</span><span class="token punctuation">;</span>        <span class="token comment">/**       * ç”¨æˆ·å       */</span>      <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>          <span class="token comment">/**       * å¯†ç        */</span>      <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>        <span class="token comment">/**       * è¶…æ—¶æ—¶é—´       */</span>      <span class="token keyword">private</span> <span class="token class-name">Long</span> timeout <span class="token operator">=</span> <span class="token number">100000L</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>åˆå§‹åŒ–è¿‡ç¨‹(é‡ç‚¹)ï¼šè¯»å–propertiesæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œç„¶åå¡«å…¥æˆ‘ä»¬é…ç½®ä¸­å³å¯</li></ul><ol><li>init()å®ç°<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">RPCConfig</span> newRpcConfig<span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        newRpcConfig <span class="token operator">=</span> <span class="token class-name">ConfigUtils</span><span class="token punctuation">.</span><span class="token function">loadConfig</span><span class="token punctuation">(</span><span class="token class-name">RPCConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">RPCConstant</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CONFIG_PREFIX</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// è¯»å–é…ç½®æ–‡ä»¶å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¯»å–æ–‡ä»¶å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è¯»å–æ–‡ä»¶é…ç½®å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        newRpcConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RPCConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"newRpcConfig: "</span> <span class="token operator">+</span> newRpcConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">init</span><span class="token punctuation">(</span>newRpcConfig<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>è¯»å–æ–‡ä»¶å®ç°ï¼Œä½¿ç”¨hutoolå·¥å…·<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">loadConfig</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> tClass<span class="token punctuation">,</span> <span class="token class-name">String</span> prefix<span class="token punctuation">,</span> <span class="token class-name">String</span> environment<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token class-name">StringBuilder</span> configFileBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token string">"application"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// å¦‚æœæœ‰ç¯å¢ƒï¼ŒåŠ è½½å¯¹åº”ç¯å¢ƒçš„é…ç½®</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment">//  application-dev.properties</span>          configFileBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      configFileBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">".properties"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//è¯»å–yamlé…ç½®æ–‡ä»¶</span>      <span class="token class-name">Props</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Props</span><span class="token punctuation">(</span>configFileBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> props<span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span>tClass<span class="token punctuation">,</span> prefix<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><ul><li>å®é™…ä½¿ç”¨:<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">RPCApplication</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h3 id="æœåŠ¡æ³¨å†Œ"><a href="#æœåŠ¡æ³¨å†Œ" class="headerlink" title="æœåŠ¡æ³¨å†Œ"></a>æœåŠ¡æ³¨å†Œ</h3><p>åŸºæœ¬æ¥å£å®šä¹‰</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Registry</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * åˆå§‹åŒ–     *     * @param registryConfig     */</span>    <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">RegistryConfig</span> registryConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * æ³¨å†ŒæœåŠ¡ æœåŠ¡ç«¯     *     * @param serviceMetaInfo     * @throws Exception     */</span>    <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">ServiceMetaInfo</span> serviceMetaInfo<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>    <span class="token comment">/**     * å–æ¶ˆæ³¨å†ŒæœåŠ¡ æœåŠ¡ç«¯     *     * @param serviceMetaInfo     */</span>    <span class="token keyword">void</span> <span class="token function">unRegister</span><span class="token punctuation">(</span><span class="token class-name">ServiceMetaInfo</span> serviceMetaInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * æœåŠ¡å‘ç°  è·å–æŸæœåŠ¡çš„æ‰€æœ‰èŠ‚ç‚¹  å®¢æˆ·ç«¯ æ¶ˆè´¹ç«¯     *     * @param serviceKey     * @return     */</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceMetaInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">serviceDiscovery</span><span class="token punctuation">(</span><span class="token class-name">String</span> serviceKey<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>æœ¬åœ°æ³¨å†Œ<br>æœ¬åœ°æ˜¯å®ç°çš„æ ¸å¿ƒæ€è·¯å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªConcurrentHashMapä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œå°†æœåŠ¡ä¿¡æ¯ä¿å­˜åœ¨é‡Œé¢ã€‚</li><li>ZooKeeperå®ç°<blockquote><p>ZooKeeperæ˜¯ä¸€ä¸ªå¼€æºçš„<strong>åˆ†å¸ƒå¼åè°ƒæœåŠ¡</strong>ï¼Œè®¾è®¡ç›®æ ‡æ˜¯å°†å“ªäº›å¤æ‚ä¸”å®¹æ˜“å‡ºé”™çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§æœåŠ¡å°è£…èµ·æ¥ï¼Œæ„æˆä¸€ä¸ªé«˜æ•ˆçš„åŸè¯­(åŸè¯­çš„æ‰§è¡Œå¿…é¡»è¿ç»­ä¸”ä¸å¯åˆ†å‰²)é›†ï¼Œå¹¶ä»¥ä¸€ç³»åˆ—ç®€å•æ˜“ç”¨çš„æ¥å£æä¾›ç»™ç”¨æˆ·æ—¶ä½¿ç”¨</p></blockquote></li></ol><ul><li><p>é¦–å…ˆå¼•å…¥ä¾èµ–</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.curator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>curator-x-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬ä½¿ç”¨curatoræ¡†æ¶ï¼Œè€Œä¸æ˜¯å®˜æ–¹æä¾›çš„åŸç”Ÿæ–¹æ¡ˆã€‚å› ä¸ºè¿™ä¸ªæ¡†æ¶ç®€åŒ–äº†ä¸ZooKeeperçš„äº¤äº’ã€‚</p><blockquote><p>ç®€åŒ–çš„APIï¼šæä¾›äº†æ›´é«˜å±‚æ¬¡çš„APIï¼Œç®€åŒ–äº†ä¸ZooKeeperçš„äº¤äº’ã€‚<br>å†…ç½®çš„é‡è¯•æœºåˆ¶ï¼šè‡ªåŠ¨å¤„ç†ZooKeeperçš„è¿æ¥å’Œä¼šè¯è¶…æ—¶ï¼Œæä¾›äº†å†…ç½®çš„é‡è¯•æœºåˆ¶ã€‚<br>æœåŠ¡å‘ç°å’Œæ³¨å†Œï¼šæä¾›äº†æœåŠ¡å‘ç°å’Œæ³¨å†Œçš„åŠŸèƒ½ï¼Œç®€åŒ–äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœåŠ¡çš„ç®¡ç†ã€‚<br>é›†æˆåº¦é«˜ï¼šä¸Curatorçš„å…¶ä»–æ¨¡å—æ— ç¼é›†æˆï¼Œæä¾›äº†æ›´å¤šçš„åŠŸèƒ½å’Œçµæ´»æ€§ã€‚</p></blockquote></li><li><p>æ ¸å¿ƒå®ç°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZooKeeperRegistry</span> <span class="token keyword">implements</span> <span class="token class-name">Registry</span> <span class="token punctuation">{</span>    <span class="token comment">// zkå®¢æˆ·ç«¯</span>    <span class="token keyword">private</span> <span class="token class-name">CuratorFramework</span> client<span class="token punctuation">;</span>    <span class="token comment">// æœåŠ¡å‘ç°</span>    <span class="token keyword">private</span> <span class="token class-name">ServiceDiscovery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceMetaInfo</span><span class="token punctuation">&gt;</span></span> serviceDiscovery<span class="token punctuation">;</span>    <span class="token comment">// æ ¹èŠ‚ç‚¹</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ZK_ROOT_PATH</span> <span class="token operator">=</span> <span class="token string">"/rpc/zk"</span><span class="token punctuation">;</span>    <span class="token comment">/**     * æœ¬åœ°æ³¨å†ŒèŠ‚ç‚¹ key é›†åˆ ç”¨äºç»´æŠ¤ç»­æœŸ     */</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> localRegisterNodeKeySet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * æ³¨å†Œä¸­å¿ƒç¼“å­˜     */</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RegistryInstanceCache</span> registryServiceCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegistryInstanceCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * ç›‘å¬çš„keyé›†åˆ, ç”¨äºç»­æœŸ     */</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> watchingKeySet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">RegistryConfig</span> registryConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">//Client æ˜¯ Curator æä¾›çš„ä¸€ä¸ªç±»ï¼Œç”¨äºç®¡ç†ä¸ Zookeeper çš„è¿æ¥ï¼Œå®ƒæä¾›äº†ä¸€äº›æ–¹æ³•ç”¨äºåˆ›å»ºã€åˆ é™¤ã€è¯»å–èŠ‚ç‚¹ç­‰æ“ä½œã€‚</span>        client <span class="token operator">=</span> <span class="token class-name">CuratorFrameworkFactory</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">connectString</span><span class="token punctuation">(</span>registryConfig<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">retryPolicy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ExponentialBackoffRetry</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">toIntExact</span><span class="token punctuation">(</span>registryConfig<span class="token punctuation">.</span><span class="token function">getTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ„å»ºserviceDiscovery å®ä¾‹</span>        <span class="token comment">//Discovery æ˜¯ç”¨äºç®¡ç†æœåŠ¡çš„æ³¨å†Œå’Œå‘ç°çš„ç»„ä»¶ï¼Œå®ƒæä¾›äº†æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€æœåŠ¡çŠ¶æ€ç›‘æ§ç­‰åŠŸèƒ½ã€‚</span>        serviceDiscovery <span class="token operator">=</span> <span class="token class-name">ServiceDiscoveryBuilder</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token class-name">ServiceMetaInfo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">client</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">basePath</span><span class="token punctuation">(</span><span class="token constant">ZK_ROOT_PATH</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">serializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JsonInstanceSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">ServiceMetaInfo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            client<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            serviceDiscovery<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">ServiceMetaInfo</span> serviceMetaInfo<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">//æ³¨å†Œè¿‡å»</span>        serviceDiscovery<span class="token punctuation">.</span><span class="token function">registerService</span><span class="token punctuation">(</span><span class="token function">buildServiceInstance</span><span class="token punctuation">(</span>serviceMetaInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æœåŠ¡æ³¨å†ŒæˆåŠŸ:{}"</span><span class="token punctuation">,</span> serviceMetaInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> registerKey <span class="token operator">=</span> <span class="token constant">ZK_ROOT_PATH</span> <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> serviceMetaInfo<span class="token punctuation">.</span><span class="token function">getServiceNodeKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ·»åŠ èŠ‚ç‚¹ä¿¡æ¯åˆ°æœ¬åœ°ç¼“å­˜ï¼Œæ–¹ä¾¿ç»­æœŸ</span>        localRegisterNodeKeySet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>registerKey<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unRegister</span><span class="token punctuation">(</span><span class="token class-name">ServiceMetaInfo</span> serviceMetaInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            serviceDiscovery<span class="token punctuation">.</span><span class="token function">unregisterService</span><span class="token punctuation">(</span><span class="token function">buildServiceInstance</span><span class="token punctuation">(</span>serviceMetaInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> registerKey <span class="token operator">=</span> <span class="token constant">ZK_ROOT_PATH</span> <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> serviceMetaInfo<span class="token punctuation">.</span><span class="token function">getServiceNodeKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            localRegisterNodeKeySet<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>registerKey<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceMetaInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">serviceDiscovery</span><span class="token punctuation">(</span><span class="token class-name">String</span> serviceKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// ä¼˜å…ˆä»ç¼“å­˜ä¸­è·å–</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceMetaInfo</span><span class="token punctuation">&gt;</span></span> serviceMetaInfoList <span class="token operator">=</span> registryServiceCache<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//!= null å’Œ isEmpty()å’Œ isBlank()çš„åŒºåˆ«, isBlank()æ˜¯Apache commons-lang3åŒ…ä¸­çš„æ–¹æ³•ï¼Œç”¨æ¥åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºæˆ–è€…ç©ºæ ¼</span>        <span class="token comment">//isBlank()æ–¹æ³•æ˜¯å¯¹å­—ç¬¦ä¸²è¿›è¡Œå¤„ç†åå†åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œè€ŒisEmpty()æ–¹æ³•æ˜¯ç›´æ¥åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œä¸åšä»»ä½•å¤„ç†ã€‚</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>serviceMetaInfoList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>serviceMetaInfoList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> serviceMetaInfoList<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment">// ä»zkä¸­è·å–</span>            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceMetaInfo</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> serviceDiscovery<span class="token punctuation">.</span><span class="token function">queryForInstances</span><span class="token punctuation">(</span>serviceKey<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">ServiceInstance</span><span class="token operator">::</span><span class="token function">getPayload</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// ç¼“å­˜</span>            registryServiceCache<span class="token punctuation">.</span><span class="token function">setCache</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> collect<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æœåŠ¡é”€æ¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">CuratorFramework</span> client <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>client<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> localRegisterNodeKeySet<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    client<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>key <span class="token operator">+</span> <span class="token string">"ä¸‹çº¿å¤±è´¥"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">heartbeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token class-name">String</span> serviceNodeKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">//ç›‘å¬èŠ‚ç‚¹</span>        <span class="token class-name">String</span> watchKey <span class="token operator">=</span> <span class="token constant">ZK_ROOT_PATH</span> <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> serviceNodeKey<span class="token punctuation">;</span>        <span class="token keyword">boolean</span> newWatch <span class="token operator">=</span> watchingKeySet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>watchKey<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//forDeletes()æ–¹æ³•ç”¨äºç›‘å¬èŠ‚ç‚¹çš„åˆ é™¤äº‹ä»¶ï¼Œå½“èŠ‚ç‚¹è¢«åˆ é™¤æ—¶ï¼Œä¼šè§¦å‘ç›‘å¬å™¨çš„å›è°ƒæ–¹æ³•ã€‚</span>        <span class="token comment">//forChanges()æ–¹æ³•ç”¨äºç›‘å¬èŠ‚ç‚¹çš„å˜åŒ–äº‹ä»¶ï¼Œå½“èŠ‚ç‚¹çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè§¦å‘ç›‘å¬å™¨çš„å›è°ƒæ–¹æ³•ã€‚</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>newWatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">//cacheæ˜¯Curatoræä¾›çš„ä¸€ä¸ªç±»ï¼Œç”¨äºç›‘å¬èŠ‚ç‚¹çš„å˜åŒ–ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹çš„å¢åŠ ã€åˆ é™¤ã€æ•°æ®çš„å˜åŒ–ç­‰ã€‚</span>            <span class="token class-name">CuratorCache</span> curatorCache <span class="token operator">=</span> <span class="token class-name">CuratorCache</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> watchKey<span class="token punctuation">)</span><span class="token punctuation">;</span>            curatorCache<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            curatorCache<span class="token punctuation">.</span><span class="token function">listenable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>                    <span class="token class-name">CuratorCacheListener</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token punctuation">.</span><span class="token function">forDeletes</span><span class="token punctuation">(</span>childData <span class="token operator">-&gt;</span> registryServiceCache<span class="token punctuation">.</span><span class="token function">clearCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                            <span class="token punctuation">.</span><span class="token function">forChanges</span><span class="token punctuation">(</span><span class="token punctuation">(</span>oldData<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> registryServiceCache<span class="token punctuation">.</span><span class="token function">clearCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token class-name">ServiceInstance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceMetaInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">buildServiceInstance</span><span class="token punctuation">(</span><span class="token class-name">ServiceMetaInfo</span> serviceMetaInfo<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">//ServiceInstance æ˜¯ Curator æä¾›çš„ä¸€ä¸ªç±»ï¼Œç”¨äºæè¿°ä¸€ä¸ªæœåŠ¡å®ä¾‹çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœåŠ¡åç§°ã€æœåŠ¡åœ°å€ã€æœåŠ¡ç«¯å£ç­‰ã€‚</span>        <span class="token class-name">String</span> serviceAddress <span class="token operator">=</span> serviceMetaInfo<span class="token punctuation">.</span><span class="token function">getServiceHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> serviceMetaInfo<span class="token punctuation">.</span><span class="token function">getServicePort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">ServiceInstance</span>                <span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceMetaInfo</span><span class="token punctuation">&gt;</span></span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>serviceAddress<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span>serviceMetaInfo<span class="token punctuation">.</span><span class="token function">getServiceKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span>serviceAddress<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">port</span><span class="token punctuation">(</span>serviceMetaInfo<span class="token punctuation">.</span><span class="token function">getServicePort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">payload</span><span class="token punctuation">(</span>serviceMetaInfo<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æœåŠ¡æ³¨å†Œ<br>æ„é€ ä¸€ä¸ªæœåŠ¡å®ä¾‹ï¼Œç„¶åä½¿ç”¨serviceDiscoveryæ³¨å†Œå³å¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">  <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">ServiceMetaInfo</span> serviceMetaInfo<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">//æ³¨å†Œè¿‡å»</span>        serviceDiscovery<span class="token punctuation">.</span><span class="token function">registerService</span><span class="token punctuation">(</span><span class="token function">buildServiceInstance</span><span class="token punctuation">(</span>serviceMetaInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æœåŠ¡æ³¨å†ŒæˆåŠŸ:{}"</span><span class="token punctuation">,</span> serviceMetaInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> registerKey <span class="token operator">=</span> <span class="token constant">ZK_ROOT_PATH</span> <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> serviceMetaInfo<span class="token punctuation">.</span><span class="token function">getServiceNodeKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ·»åŠ èŠ‚ç‚¹ä¿¡æ¯åˆ°æœ¬åœ°ç¼“å­˜ï¼Œæ–¹ä¾¿ç»­æœŸ</span>        localRegisterNodeKeySet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>registerKey<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">private</span> <span class="token class-name">ServiceInstance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceMetaInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">buildServiceInstance</span><span class="token punctuation">(</span><span class="token class-name">ServiceMetaInfo</span> serviceMetaInfo<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>      <span class="token comment">//ServiceInstance æ˜¯ Curator æä¾›çš„ä¸€ä¸ªç±»ï¼Œç”¨äºæè¿°ä¸€ä¸ªæœåŠ¡å®ä¾‹çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœåŠ¡åç§°ã€æœåŠ¡åœ°å€ã€æœåŠ¡ç«¯å£ç­‰ã€‚  </span>    <span class="token class-name">String</span> serviceAddress <span class="token operator">=</span> serviceMetaInfo<span class="token punctuation">.</span><span class="token function">getServiceHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> serviceMetaInfo<span class="token punctuation">.</span><span class="token function">getServicePort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token class-name">ServiceInstance</span>              <span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceMetaInfo</span><span class="token punctuation">&gt;</span></span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>serviceAddress<span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span>serviceMetaInfo<span class="token punctuation">.</span><span class="token function">getServiceKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span>serviceAddress<span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">port</span><span class="token punctuation">(</span>serviceMetaInfo<span class="token punctuation">.</span><span class="token function">getServicePort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">payload</span><span class="token punctuation">(</span>serviceMetaInfo<span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åˆå§‹åŒ–è¿æ¥å®¢æˆ·ç«¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">RegistryConfig</span> registryConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">//Client æ˜¯ Curator æä¾›çš„ä¸€ä¸ªç±»ï¼Œç”¨äºç®¡ç†ä¸ Zookeeper çš„è¿æ¥ï¼Œå®ƒæä¾›äº†ä¸€äº›æ–¹æ³•ç”¨äºåˆ›å»ºã€åˆ é™¤ã€è¯»å–èŠ‚ç‚¹ç­‰æ“ä½œã€‚</span>      client <span class="token operator">=</span> <span class="token class-name">CuratorFrameworkFactory</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">connectString</span><span class="token punctuation">(</span>registryConfig<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">retryPolicy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ExponentialBackoffRetry</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">toIntExact</span><span class="token punctuation">(</span>registryConfig<span class="token punctuation">.</span><span class="token function">getTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// æ„å»ºserviceDiscovery å®ä¾‹</span>      <span class="token comment">//Discovery æ˜¯ç”¨äºç®¡ç†æœåŠ¡çš„æ³¨å†Œå’Œå‘ç°çš„ç»„ä»¶ï¼Œå®ƒæä¾›äº†æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€æœåŠ¡çŠ¶æ€ç›‘æ§ç­‰åŠŸèƒ½ã€‚</span>      serviceDiscovery <span class="token operator">=</span> <span class="token class-name">ServiceDiscoveryBuilder</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token class-name">ServiceMetaInfo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">client</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">basePath</span><span class="token punctuation">(</span><span class="token constant">ZK_ROOT_PATH</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">serializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JsonInstanceSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">ServiceMetaInfo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">try</span> <span class="token punctuation">{</span>          client<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          serviceDiscovery<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="RPCè°ƒç”¨-ä»£ç†"><a href="#RPCè°ƒç”¨-ä»£ç†" class="headerlink" title="RPCè°ƒç”¨(ä»£ç†)"></a>RPCè°ƒç”¨(ä»£ç†)</h3><p>RPCçš„è°ƒç”¨å®é™…ä¸Šå°±æ˜¯ç”±æ¡†æ¶å»ä»£ç†è¢«æ³¨è§£çš„å¯¹è±¡å»è¿œç¨‹è°ƒç”¨æœåŠ¡ã€‚<br>ä»£ç†åˆ†ä¸ºåŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†<br>äºŒè€…åŒºåˆ«ï¼š</p><blockquote><p>é™æ€ä»£ç†å®é™…ä¸Šåœ¨ç¼–è¯‘æœŸé—´å°±å·²ç»ç”Ÿæˆå¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œéœ€è¦æ‰‹åŠ¨ç¼–å†™ï¼Œå®ç°ä¸ç›®æ ‡ç±»ç›¸åŒçš„æ¥å£ï¼Œåœ¨å†…éƒ¨è°ƒç”¨ç›®æ ‡ç±»çš„æ–¹æ³•ï¼Œå®é™…å°±æ˜¯ç”±ä»£ç†ç±»å»åŒ…è£¹å®ç°ç±»ï¼Œå¹¶åœ¨ä»£ç†ç±»å†…éƒ¨å»è°ƒç”¨è¢«ä»£ç†ç±»ã€‚</p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// ç›®æ ‡ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RealService</span> <span class="token keyword">implements</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Performing service..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// ä»£ç†ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticProxyService</span> <span class="token keyword">implements</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RealService</span> realService<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">StaticProxyService</span><span class="token punctuation">(</span><span class="token class-name">RealService</span> realService<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>realService <span class="token operator">=</span> realService<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Before performing service..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        realService<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"After performing service..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// ä½¿ç”¨é™æ€ä»£ç†</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticProxyDemo</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">RealService</span> realService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RealService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Service</span> proxyService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StaticProxyService</span><span class="token punctuation">(</span>realService<span class="token punctuation">)</span><span class="token punctuation">;</span>        proxyService<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="JDKåŠ¨æ€ä»£ç†å®ç°"><a href="#JDKåŠ¨æ€ä»£ç†å®ç°" class="headerlink" title="JDKåŠ¨æ€ä»£ç†å®ç°"></a>JDKåŠ¨æ€ä»£ç†å®ç°</h4><blockquote><p>åˆ›å»ºæ¥å£ï¼šå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œå£°æ˜éœ€è¦ä»£ç†çš„æ–¹æ³•ã€‚<br>å®ç°æ¥å£ï¼šåˆ›å»ºä¸€ä¸ªç±»å®ç°è¯¥æ¥å£ã€‚<br>åˆ›å»ºä»£ç†ç±»ï¼šå®ç°InvocationHandleræ¥å£ï¼Œé‡å†™invokeæ–¹æ³•ã€‚<br>ç”Ÿæˆä»£ç†å¯¹è±¡ï¼šä½¿ç”¨Proxy.newProxyInstanceæ–¹æ³•ç”Ÿæˆä»£ç†å¯¹è±¡</p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å®é™…interface</span><span class="token keyword">interface</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token keyword">void</span> <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//ä»£ç†ç±»</span><span class="token keyword">class</span> <span class="token class-name">AProxy</span> <span class="token keyword">implements</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token keyword">void</span> <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>system<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">//å®é™…è°ƒç”¨</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®é™…å®ç°ï¼šä½¿ç”¨å·¥å‚æ¨¡å¼æ¥è·å–å…·ä½“çš„ä»£ç†ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceProxyFactory</span> <span class="token punctuation">{</span>      <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> serviceClass<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment">// ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼šClassLoaderæŒ‡å®šä½¿ç”¨å“ªä¸ªç±»åŠ è½½å™¨æ¥åŠ è½½ä»£ç†ç±»ï¼Œä¸€èˆ¬ä½¿ç”¨åŠ è½½ç›®æ ‡ç±»çš„æ–¹å¼æ¥åŠ è½½ã€‚</span>    <span class="token comment">// new Class[]{} ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…æ‹¬ä»£ç†åˆ—è¦å®ä¹ é‚£çš„æ¥å£ï¼Œè¿™é‡Œä¼ å…¥çš„æ˜¯ç›®æ ‡ç±»å®ç°çš„æ¥å£ã€‚</span>    <span class="token comment">// new ServiceProxy() è‡ªå®šä¹‰çš„InvocationHandlerå®ç°ç±»ã€‚</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>                  serviceClass<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>serviceClass<span class="token punctuation">}</span><span class="token punctuation">,</span>                  <span class="token keyword">new</span> <span class="token class-name">ServiceProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŠ¨æ€ä»£ç†-&gt;jdkå®ç°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceProxy</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span><span class="token comment">// å‚æ•°åˆ†åˆ«æ˜¯ï¼š proxy ä»£ç†ç±»ï¼Œ method è°ƒç”¨çš„æ–¹æ³•ï¼Œ argsæ–¹æ³•çš„å‚æ•°</span>        <span class="token comment">// æ„é€ è¯·æ±‚</span>        <span class="token class-name">JDKSerializer</span> jdkSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JDKSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">RPCRequst</span> rpcRequst <span class="token operator">=</span> <span class="token class-name">RPCRequst</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">serviceName</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getDeclaringClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">methodName</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">parameterTypes</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bodyBytes <span class="token operator">=</span> jdkSerializer<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span>rpcRequst<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å‘é€è¯·æ±‚</span>            <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">HttpResponse</span> httpResponse <span class="token operator">=</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8080"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>bodyBytes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> result <span class="token operator">=</span> httpResponse<span class="token punctuation">.</span><span class="token function">bodyBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">RPCResponse</span> response <span class="token operator">=</span> jdkSerializer<span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token class-name">RPCResponse</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®é™…ä½¿ç”¨ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token class-name">ServiceProxyFactory</span><span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"zuofw"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> newUser <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>newUser <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Get user success, name: "</span> <span class="token operator">+</span> newUser<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Get user failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token class-name">RPCConfig</span> rpcConfig <span class="token operator">=</span> <span class="token class-name">ConfigUtils</span><span class="token punctuation">.</span><span class="token function">loadConfig</span><span class="token punctuation">(</span><span class="token class-name">RPCConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">"rpc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rpcConfig<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        testMock();</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>jdkåŠ¨æ€ä»£ç†çš„åŸç†ï¼šæˆ‘ä»¬é€šè¿‡å®ç° InvocationHandleræ¥å®ç°è‡ªå®šä¹‰ä»£ç†å¤„ç†å™¨ï¼Œå½“æˆ‘ä»¬è°ƒç”¨åŠ¨æ€ä»£ç†å¯¹è±¡ä»£ç†çš„å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨å°±ä¼šè¢«è½¬å‘åˆ°æˆ‘ä»¬å®ç°çš„è¿™ä¸ªæ¥å£çš„invokeæ–¹æ³•æ¥è°ƒç”¨ï¼Œä»è€Œå®ç°åŠ¨æ€è¿›è¡Œä¸€äº›æ“ä½œã€‚<br>è¡¥å……ï¼š</li></ul><h4 id="CGLIBåŠ¨æ€ä»£ç†æœºåˆ¶"><a href="#CGLIBåŠ¨æ€ä»£ç†æœºåˆ¶" class="headerlink" title="CGLIBåŠ¨æ€ä»£ç†æœºåˆ¶"></a>CGLIBåŠ¨æ€ä»£ç†æœºåˆ¶</h4><p>JDKåŠ¨æ€ä»£ç†çš„ä¸€ä¸ªç¼ºç‚¹ï¼š<br>åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»ï¼ŒSpring AOPä¸­å°±ä½¿ç”¨åˆ°äº†CGLIBæ¥è¿›è¡ŒåŠ¨æ€ä»£ç†-&gt;å¦‚æœç›®æ ‡å®ç°äº†æ¥å£ï¼Œé»˜è®¤ä½¿ç”¨JDKä»£ç†ï¼Œå¦åˆ™ä½¿ç”¨CGLIBåŠ¨æ€ä»£ç†ã€‚</p><blockquote><p>CGLIBæ˜¯ä¸€ä¸ªåŸºäºASMçš„å­—èŠ‚ç ç”Ÿæˆåº“ï¼Œå…è®¸åœ¨è¿è¡Œæ—¶å¯¹å­—èŠ‚ç è¿›è¡Œä¿®æ”¹å’ŒåŠ¨æ€ç”Ÿæˆã€‚ CGLIBåœ¨Java 9åŠæ›´é«˜ç‰ˆæœ¬ä¸­æ— æ³•è®¿é—®æŸäº›å—ä¿æŠ¤çš„JDKå†…éƒ¨APIå¯¼è‡´çš„ã€‚å…·ä½“æ¥è¯´ï¼Œjava.lang.ClassLoader.defineClassæ–¹æ³•åœ¨Java 9åŠæ›´é«˜ç‰ˆæœ¬ä¸­å˜å¾—ä¸å¯è®¿é—®ã€‚æ¨èä½¿ç”¨JDKä»£ç†æˆ–è€…å…¶ä»–ä»£ç†æ¡†æ¶</p></blockquote><p>å®ä¾‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CGServiceProxy</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Invoker</span> invoker <span class="token operator">=</span> <span class="token class-name">InvokerFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"netty"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è·å–ä»£ç†ç±»</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>        enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token comment">// æ‹¦æˆªæ–¹æ³•</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> proxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>        <span class="token comment">// æ„é€ è¯·æ±‚</span>        <span class="token class-name">RPCRequest</span> rpcRequest <span class="token operator">=</span> <span class="token class-name">RPCRequest</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">serviceName</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getDeclaringClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">methodName</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">parameterTypes</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">RPCResult</span> invoke <span class="token operator">=</span> invoker<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>rpcRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"invoke result:{}"</span><span class="token punctuation">,</span> invoke<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">RPCResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RPCResponse</span><span class="token punctuation">)</span> invoke<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åºåˆ—åŒ–å™¨å®ç°"><a href="#åºåˆ—åŒ–å™¨å®ç°" class="headerlink" title="åºåˆ—åŒ–å™¨å®ç°"></a>åºåˆ—åŒ–å™¨å®ç°</h3><ol><li>JDKåŸç”Ÿåºåˆ—åŒ–ï¼š<br>ä¼˜ç‚¹ï¼šä½¿ç”¨æ–¹ä¾¿ï¼Œæ— éœ€å¼•å…¥é¢å¤–ä¾èµ–<br>ç¼ºç‚¹ï¼šé€Ÿåº¦æ…¢ï¼Œå ç©ºé—´ã€æœ‰å®‰å…¨é—®é¢˜</li><li>JSONï¼š<br>ä¼˜ç‚¹ï¼šè·¨è¯­è¨€ï¼Œä½¿ç”¨ç®€å•ï¼Œæ˜“è¯»<br>ç¼ºç‚¹ï¼šåºåˆ—åŒ–ç»“æœè¾ƒå¤§ï¼Œæ€§èƒ½ä¸€èˆ¬ï¼Œå¯èƒ½å­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼Œä¸èƒ½å¾ˆå¥½å¤„ç†è´Ÿè½½çš„æ•°æ®ç»“æ„å’Œå¾ªç¯å¼•ç”¨ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™æˆ–è€…åºåˆ—åŒ–å¤±è´¥</li><li>Kryo<br>ä¼˜ç‚¹ï¼šé«˜æ€§èƒ½ï¼Œä½“ç§¯å°ï¼Œé€‚åˆåˆ†å¸ƒå¼<br>å»ç‚¹ï¼šä¸è·¨è¯­è¨€ï¼Œåªæœ‰Javaï¼Œåºåˆ—åŒ–æ ¼å¼å¤æ‚<br>å¦‚ä½•å®ç°ï¼Ÿ<br>ä½¿ç”¨interface æ¥å®šä¹‰ï¼Œæ–¹ä¾¿æ‰©å±•å’Œä½¿ç”¨<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Serializer</span> <span class="token punctuation">{</span>    <span class="token comment">/*     * @description: åºåˆ—åŒ–     * @author zuofw     * @date: 2024/9/6 10:28    * @param obj    * @return byte[]     */</span>    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token class-name">T</span> obj<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>    <span class="token comment">/**     * ååºåˆ—åŒ–     * @param bytes     * @param clazz     * @return     * @param &lt;T&gt;     * @throws IOException     */</span>    <span class="token comment">//&lt;T&gt;æ˜¯æ³›å‹æ–¹æ³•çš„å£°æ˜ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼ŒTæ˜¯æ³›å‹å‚æ•°ï¼Œè¡¨ç¤ºè¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼ŒTæ˜¯æ³›å‹å‚æ•°ï¼Œè¡¨ç¤ºè¿™ä¸ªæ–¹æ³•å¯ä»¥æ¥å—ä»»æ„ç±»å‹çš„å‚æ•°</span>    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><strong>å½“ä½¿ç”¨æ³›å‹è¿›è¡Œåºåˆ—åŒ–æ—¶ï¼Œä¼šå‡ºç°æ³›å‹æ“¦é™¤ï¼ŒåŸå§‹ç±»å‹ä¿¡æ¯åœ¨ç¼–è¯‘æ—¶ä¼šè¢«æ“¦é™¤æ‰ï¼Œä½¿å¾—ä½¿ç”¨æ³›å‹ä½œä¸ºæ–¹æ³•å‚æ•°å’Œè¿”å›å€¼æ—¶ï¼Œå®é™…ä¸Šç±»å‹æ˜¯Objectç±»å‹</strong></li></ol><ul><li>JDKå®ç°<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDKSerializer</span> <span class="token keyword">implements</span> <span class="token class-name">Serializer</span> <span class="token punctuation">{</span>    <span class="token comment">/*     * @description:   JDKå®ç°     * @author zuofw     * @date: 2024/9/6 11:06     * @param obj     * @return byte[]     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token class-name">T</span> obj<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">//è¿™æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„è¾“å‡ºæµï¼Œæ•°æ®ä¼šè¢«å†™åˆ°ä¸€ä¸ªå­—èŠ‚æ•°ç»„ä¸­</span>        <span class="token class-name">ByteArrayOutputStream</span> outputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å°†å¯¹è±¡å†™å…¥åˆ°å­—èŠ‚æ•°ç»„è¾“å‡ºæµä¸­</span>        <span class="token class-name">ObjectOutputStream</span> objectOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>outputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>        objectOutputStream<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>        objectOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> outputStream<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token class-name">ByteArrayInputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ObjectInputStream</span> objectInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            objectInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>JSONå®ç°<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JSONSerializer</span> <span class="token keyword">implements</span> <span class="token class-name">Serializer</span><span class="token punctuation">{</span>    <span class="token comment">//å…¨å±€å”¯ä¸€</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ObjectMapper</span> <span class="token constant">OBJECT_MAPPER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token class-name">T</span> obj<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">//å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„</span>        <span class="token keyword">return</span> <span class="token constant">OBJECT_MAPPER</span><span class="token punctuation">.</span><span class="token function">writeValueAsBytes</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token class-name">T</span> obj <span class="token operator">=</span> <span class="token constant">OBJECT_MAPPER</span><span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">RPCRequest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">RPCRequest</span><span class="token punctuation">)</span> obj<span class="token punctuation">,</span> clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">RPCResponse</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span>  <span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">RPCResponse</span><span class="token punctuation">)</span> obj<span class="token punctuation">,</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> obj<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token class-name">RPCResponse</span> rpcResponse<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">//ä¸ºä»€ä¹ˆè¦å°†dataè½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ï¼Œå†è½¬æ¢ä¸ºå¯¹è±¡ï¼Ÿ</span>        <span class="token comment">//å› ä¸ºdataæ˜¯ä¸€ä¸ªObjectç±»å‹ï¼Œæˆ‘ä»¬ä¸çŸ¥é“å®ƒçš„å…·ä½“ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†å®ƒè½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ï¼Œå†è½¬æ¢ä¸ºå…·ä½“çš„å¯¹è±¡</span>        <span class="token comment">//å°†dataè½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token constant">OBJECT_MAPPER</span><span class="token punctuation">.</span><span class="token function">writeValueAsBytes</span><span class="token punctuation">(</span>rpcResponse<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºå¯¹è±¡</span>        rpcResponse<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token constant">OBJECT_MAPPER</span><span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> rpcResponse<span class="token punctuation">.</span><span class="token function">getDataType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// é€šè¿‡åå°„åˆ›å»ºå¯¹è±¡</span>        <span class="token keyword">return</span> type<span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span>rpcResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">RPCRequest</span> rpcRequest<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">// è·å–å‚æ•°ç±»å‹</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes <span class="token operator">=</span> rpcRequest<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–å‚æ•°</span>        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> rpcRequest<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¾ªç¯å¤„ç†æ¯ä¸ªå‚æ•°çš„ç±»å‹</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parameterTypes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz <span class="token operator">=</span> parameterTypes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">// å¦‚æœç±»å‹ä¸åŒï¼Œéœ€è¦é‡æ–°è½¬æ¢</span>            <span class="token comment">//isAssignableFrom()æ–¹æ³•æ˜¯ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªç±»Class1å’Œå¦ä¸€ä¸ªç±»Class2æ˜¯å¦ç›¸åŒæˆ–æ˜¯å¦ä¸€ä¸ªç±»çš„è¶…ç±»æˆ–æ¥å£</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>clazz<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token constant">OBJECT_MAPPER</span><span class="token punctuation">.</span><span class="token function">writeValueAsBytes</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                args<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">OBJECT_MAPPER</span><span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> type<span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span>rpcRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>å®ç°æ–¹å¼ï¼š</p><ol><li>å¼•å…¥ä¾èµ–<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.jsonzou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmockdata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å®ç°ä»£ç†æ¥å£<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * Mock æœåŠ¡ä»£ç† JDKåŠ¨æ€ä»£ç† */</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MockServiceProxy</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * è°ƒç”¨ä»£ç†     *     * @throws Throwable     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>        <span class="token comment">// æ ¹æ®æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ï¼Œç”Ÿæˆç‰¹å®šçš„é»˜è®¤å€¼å¯¹è±¡</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> returnType <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getReturnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> mockData <span class="token operator">=</span> <span class="token class-name">JMockData</span><span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span>returnType<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"mockData:{}"</span><span class="token punctuation">,</span> mockData<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> mockData<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="SPIæœºåˆ¶-gt-çƒ­æ‹”æ’"><a href="#SPIæœºåˆ¶-gt-çƒ­æ‹”æ’" class="headerlink" title="SPIæœºåˆ¶->çƒ­æ‹”æ’"></a>SPIæœºåˆ¶-&gt;çƒ­æ‹”æ’</h3><p>é¢å‘å¯¹è±¡é¼“åŠ±æ¨¡å—ä¹‹é—´åŸºäºæ¥å£è€Œéå…·ä½“å®ç°å˜æˆæ¥é™ä½è€¦åˆï¼Œæ”¯æŒå¼€é—­åŸåˆ™(å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­)ï¼Œä½†æ˜¯ç›´æ¥ä¾èµ–å®ç°ï¼Œåœ¨æ›¿ä»£å®ç°æ—¶éœ€è¦ä¿®æ”¹ä»£ç ï¼Œè¿èƒŒäº†å¼€é—­åŸåˆ™ã€‚SPIå› æ­¤è¯ç”Ÿã€‚ </p><blockquote><p>SPI(Service Provider Interface æœåŠ¡æä¾›è€…çš„æ¥å£)ä¸API(åº”ç”¨æä¾›çš„æ¥å£ï¼Œä¾›å¤–éƒ¨è°ƒç”¨)ç±»ä¼¼ï¼Œæ˜¯JDKå†…ç½®çš„ä¸€ç§æœåŠ¡æä¾›å‘ç°æœºåˆ¶ï¼Œå¯ä»¥ç”¨æ¥å¯ç”¨æ¡†æ¶æ‹“å±•å’Œæ›¿æ¢ç»„ä»¶ã€‚SPI å…è®¸æ¡†æ¶æˆ–åº”ç”¨ç¨‹åºé€šè¿‡æ¥å£å®šä¹‰æœåŠ¡ï¼Œå¹¶å…è®¸ç¬¬ä¸‰æ–¹æˆ–ç”¨æˆ·æä¾›è¿™äº›æœåŠ¡çš„å®ç°ã€‚SPI çš„ä¸»è¦ç›®çš„æ˜¯æä¾›ä¸€ç§å¯æ’æ‹”çš„æ¶æ„ï¼Œä½¿å¾—æœåŠ¡çš„å®ç°å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½å’Œæ›¿æ¢ã€‚ç±»ä¼¼äºIOCï¼Œåªä¸è¿‡å°†è£…é…çš„æ§åˆ¶ç§»äº¤åˆ°äº†ç¨‹åºä¹‹å¤–</p></blockquote><p><img src="/2024/09/02/00/SPI.png"></p><h4 id="å®ç°çƒ­æ‹”æ’çš„æµç¨‹"><a href="#å®ç°çƒ­æ‹”æ’çš„æµç¨‹" class="headerlink" title="å®ç°çƒ­æ‹”æ’çš„æµç¨‹"></a>å®ç°çƒ­æ‹”æ’çš„æµç¨‹</h4><ol><li>æœåŠ¡çš„æä¾›è€…å®ç°ä¸€ç§æ¥å£çš„å®ç°ï¼Œç„¶ååœ¨classpathè·¯å¾„ä¸‹çš„META-INF/services/ç›®å½•é‡Œåˆ›å»ºä¸€ä¸ªä»¥æœåŠ¡æ¥å£å‘½åçš„æ–‡ä»¶ã€‚é‡Œé¢å¡«å†™éœ€è¦åŠ è½½çš„å®ç°ç±»çš„å…¨é™å®šç¬¦</li><li>ä½¿ç”¨è‡ªå®šä¹‰åŠ è½½ï¼ŒåŠ è½½å®ç°çš„æ¥å£<br>è‡ªå®šä¹‰åŠ è½½å®ç°ï¼š<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> calss <span class="token class-name">SPILoader</span> <span class="token punctuation">{</span><span class="token comment">// åªå±•ç¤ºæ ¸å¿ƒæ–¹æ³•ï¼Œå®Œæ•´å†…å®¹å¯ä»¥å»çœ‹æºç </span><span class="token comment">// å‚æ•°ï¼šè¦åŠ è½½çš„ç±»å‹</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> loadClass<span class="token punctuation">)</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"åŠ è½½ç±»å‹ä¸º{} çš„SPI"</span><span class="token punctuation">,</span>loadClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ‰«æè·¯å¾„ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„SPIä¼˜å…ˆçº§é«˜äºç³»ç»ŸSPI</span>        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> keyClassMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// SCANS_DIRSæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„åŠ è½½è·¯å¾„</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> dir <span class="token operator">:</span> <span class="token constant">SCANS_DIRS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ‰«æè·¯å¾„ä¸º{}"</span><span class="token punctuation">,</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//è·å–èµ„æº</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"èµ„æºä¸º{}"</span><span class="token punctuation">,</span>dir <span class="token operator">+</span> loadClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span> resources <span class="token operator">=</span> <span class="token class-name">ResourceUtil</span><span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span>dir <span class="token operator">+</span> loadClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//URLæ˜¯ä»€ä¹ˆç±»å‹ï¼Œä¸ºä»€ä¹ˆè¦ç”¨å®ƒï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼Œå¯ä»¥ç”¨æ¥å®šä½èµ„æº</span>            <span class="token comment">//url.openStream()æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæ˜¯æ‰“å¼€ä¸€ä¸ªè¾“å…¥æµï¼Œå¯ä»¥ç”¨æ¥è¯»å–èµ„æº</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token constant">URL</span> resource <span class="token operator">:</span> resources<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    <span class="token comment">//æ‰“å¼€ä¸€ä¸ªè¾“å…¥æµ</span>                    <span class="token class-name">InputStreamReader</span> inputStreamReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">openStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//ç¼“å†²è¯»å–å­—ç¬¦æµ</span>                    <span class="token class-name">BufferedReader</span> bufferedReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span>inputStreamReader<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> line<span class="token punctuation">;</span>                    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> bufferedReader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> splits <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>splits<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"SPIé…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">continue</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        <span class="token class-name">String</span> key <span class="token operator">=</span> splits<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token class-name">String</span> className <span class="token operator">=</span> splits<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token comment">//Class.forNamç”¨äºåŠ¨æ€åŠ è½½ä¸€ä¸ªç±»</span>                        keyClassMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"åŠ è½½SPIé…ç½®æ–‡ä»¶å¤±è´¥"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"éœ€è¦åŠ è½½çš„ç±»ä¸å­˜åœ¨"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        loaderMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>loadClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> keyClassMap<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> keyClassMap<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>è·å–å®ä¾‹ï¼š<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> tClass<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token comment">// è·å¾—ç±»å</span>       <span class="token class-name">String</span> tClassName <span class="token operator">=</span> tClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> keyClassMap <span class="token operator">=</span> loaderMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>tClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>keyClassMap<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"SpiLoader æœªåŠ è½½ %s ç±»å‹"</span><span class="token punctuation">,</span> tClassName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>keyClassMap<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"SpiLoader çš„ %s ä¸å­˜åœ¨ key= %s"</span><span class="token punctuation">,</span> tClassName<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span>       <span class="token comment">// é€šè¿‡ç±»åè·å¾—å®ç°ç±»</span>       <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> implClass <span class="token operator">=</span> keyClassMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// ä»ç¼“å­˜ä¸­åŠ è½½æŒ‡å®šç±»å‹çš„å®ä¾‹</span>       <span class="token class-name">String</span> implClassName <span class="token operator">=</span> implClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦æœ‰å®ä¾‹</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instanceCache<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>implClassName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token keyword">try</span> <span class="token punctuation">{</span>               instanceCache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>implClassName<span class="token punctuation">,</span>  implClass<span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InstantiationException</span> <span class="token operator">|</span> <span class="token class-name">IllegalAccessException</span> <span class="token operator">|</span> <span class="token class-name">NoSuchMethodException</span> <span class="token operator">|</span> <span class="token class-name">InvocationTargetException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>               <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"å®ä¾‹åŒ– %s å¤±è´¥"</span><span class="token punctuation">,</span> implClassName<span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span>       <span class="token punctuation">}</span>       <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> instanceCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>implClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>æ–‡ä»¶å†…å®¹ï¼š<img src="/2024/09/02/00/SPIURL.png" alt="|475"> <img src="/2024/09/02/00/URL%E5%86%85%E5%AE%B9.png"><br>æ ¸å¿ƒæµç¨‹ï¼š</li><li>é€šè¿‡URLæ¥å®šä½æ–‡ä»¶ä½ç½®</li><li>è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå°†ç±»çš„ä¿¡æ¯åŠ è½½åˆ°mapä¸­</li><li>è·å–å®ä¾‹æ—¶æ ¹æ®ç±»å‹æ¥åŠ è½½å…·ä½“çš„ç±»å‹å’Œæ˜¯å®ç°ç±»ã€‚</li><li>æ ¸å¿ƒè¿˜æ˜¯åå°„ã€‚</li></ol><h4 id="å¸¸è§çš„åå°„ä½¿ç”¨æ–¹æ³•"><a href="#å¸¸è§çš„åå°„ä½¿ç”¨æ–¹æ³•" class="headerlink" title="å¸¸è§çš„åå°„ä½¿ç”¨æ–¹æ³•"></a>å¸¸è§çš„åå°„ä½¿ç”¨æ–¹æ³•</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forNmae</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span>æ ¹æ®ä¼ å…¥çš„ç±»åï¼ŒåŠ¨æ€åŠ è½½å¹¶è¿”å›ä¸€ä¸ª<span class="token class-name">Class</span>å¯¹è±¡ï¼Œä¸ä¼šæ–°å»ºä¸€ä¸ªå¯¹è±¡<span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>æˆ–è€…é€šè¿‡æ„é€ å‡½æ•°åå°„æ¥è¿›è¡Œå®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„å¯¹è±¡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é‡‡ç”¨åŠ è½½Classå¯¹è±¡å’Œåˆ›å»ºå®ä¾‹åˆ†ç¦»çš„æ–¹å¼ï¼Œä½¿å¾—SPIåªæœ‰åœ¨éœ€è¦å®ç°ç±»çš„æ—¶å€™æ‰è§¦å‘å®ä¾‹åŒ–ï¼Œæ›´åŠ é«˜æ•ˆçµæ´»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é€šè¿‡ç±»åè·å¾—å®ç°ç±»</span>      <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> implClass <span class="token operator">=</span> keyClassMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// ä»ç¼“å­˜ä¸­åŠ è½½æŒ‡å®šç±»å‹çš„å®ä¾‹</span>      <span class="token class-name">String</span> implClassName <span class="token operator">=</span> implClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦æœ‰å®ä¾‹</span>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>instanceCache<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>implClassName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">try</span> <span class="token punctuation">{</span>              instanceCache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>implClassName<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">)</span> implClass<span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"å®ä¾‹åŒ– %s å¤±è´¥"</span><span class="token punctuation">,</span> implClassName<span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>      <span class="token punctuation">}</span>      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> instanceCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>implClassName<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è‡ªå®šä¹‰åè®®"><a href="#è‡ªå®šä¹‰åè®®" class="headerlink" title="è‡ªå®šä¹‰åè®®"></a>è‡ªå®šä¹‰åè®®</h3><p>RPCæ¡†æ¶ä½¿ç”¨Nettyé€šä¿¡æ—¶ï¼Œå®é™…ä¸Šæ˜¯å°†æ•°æ®è½¬åŒ–ä¸ºByteBufçš„æ–¹å¼æ”¾æ¾çš„ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•è½¬åŒ–ï¼Ÿå¦‚æœç›´æ¥è½¬åŒ–ä¼šå‡ºç°ç²˜åŒ…å’Œæ‹†åŒ…é—®é¢˜<br>ä»€ä¹ˆæ˜¯ç²˜åŒ…å’Œæ‹†åŒ…é—®é¢˜</p><blockquote><p>ä½¿ç”¨TCPæ—¶ï¼Œä½¿ç”¨çš„æ˜¯æ²¡æœ‰ç•Œé™çš„äºŒè¿›åˆ¶æµä¼ è¾“ï¼ŒTCPä¼šæ ¹æ®ç¼“å†²åŒºæ¥è¿›è¡Œæ•°æ®åŒ…çš„åˆ’åˆ†ï¼Œä½†æ˜¯åˆ’åˆ†ä¸ä¸€å®šå°±æ˜¯å®é™…çš„ä¸€ä¸ªä¸šåŠ¡ä¸Šçš„å®Œæ•´çš„åŒ…ï¼Œæ‰€ä»¥ä¼šå‡ºç°æ¥æ”¶ç«¯å°†å¤šä¸ªæ•°æ®åŒ…åˆå¹¶æˆä¸€ä¸ªæ•°æ®åŒ…æˆ–è€…å°†ä¸€ä¸ªæ•°æ®åŒ…æ‹†åˆ†æˆå¤šä¸ªåŒ…</p></blockquote><p>å¦‚ä½•è§£å†³ï¼Ÿ</p><ol><li>å›ºå®šé•¿åº¦çš„æ¶ˆæ¯</li><li>ä½¿ç”¨ç‰¹å®šçš„åˆ†éš”ç¬¦</li><li>æ¶ˆæ¯å¤´ï¼šåŒ…å«æ¶ˆæ¯çš„é•¿åº¦ã€‚<br>å®ç°ï¼š</li></ol><h4 id="ç»“æ„è®¾è®¡"><a href="#ç»“æ„è®¾è®¡" class="headerlink" title="ç»“æ„è®¾è®¡"></a>ç»“æ„è®¾è®¡</h4><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/chenchuxin/p/15227253.html">ä»é›¶å¼€å§‹å®ç°ç®€å• RPC æ¡†æ¶ 7ï¼šç½‘ç»œé€šä¿¡ä¹‹è‡ªå®šä¹‰åè®®(ç²˜åŒ…æ‹†åŒ…ã€ç¼–è§£ç ) - å°æ–°æ˜¯ä¹Ÿ - åšå®¢å›­ (cnblogs.com)</a><a href="https://yunfeidog.github.io/yunfei-rpc/docs/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE(%E9%87%8D%E7%82%B9).html#%E6%B6%88%E6%81%AF%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1">è‡ªå®šä¹‰åè®®(é‡ç‚¹) | æ‰‹å†™RPCæ¡†æ¶ (yunfeidog.github.io)</a><br>intå ç”¨4ä¸ªè‡ªå·±é¢ï¼Œbyteå ç”¨1ä¸ªå­—èŠ‚<br>æ¶ˆæ¯æ‰€éœ€è¦çš„ä¿¡æ¯</p><ul><li>é­”æ•°ï¼šæ ‡è¯†æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„RPCæ¶ˆæ¯ï¼ŒåŒæ—¶ç”¨æ¥æ ¡éªŒæ¶ˆæ¯æ˜¯å¦åˆæ³• 1B</li><li>ç‰ˆæœ¬å·ï¼š1B</li><li>åºåˆ—åŒ–ç±»å‹ï¼šæ ‡è¯†ä½¿ç”¨çš„åºåˆ—åŒ–æ–¹å¼ï¼Œç”¨æ¥æ–¹ä¾¿åŒæ„åºåˆ—åŒ–å’Œååºåˆ—åŒ– 1B</li><li>ç±»å‹ï¼šæ ‡è¯†æ¶ˆæ¯çš„ç±»å‹ï¼Œæ™®é€šè¯·æ±‚ï¼Œå¿ƒè·³ï¼Œå“åº” 1B</li><li>çŠ¶æ€ï¼šæ ‡è¯†æ¶ˆæ¯æ˜¯å¦æˆåŠŸæ¨é€ 1B</li><li>è¯·æ±‚idï¼šæ ‡è¯†å½“å‰æ¶ˆæ¯çš„å”¯ä¸€æ ‡è¯† 8B</li><li>å‹ç¼©ç±»å‹ï¼šå°†å­—èŠ‚æµè¿›è¡Œå‹ç¼©ï¼Œä¼ è¾“æ›´å¿«ï¼Œä½†æ˜¯ä¼šæ¶ˆè€—CPUèµ„æºã€‚ 1B</li><li>æ¶ˆæ¯é•¿åº¦ï¼šæ ‡è¯†æ¶ˆæ¯çš„é•¿åº¦ï¼Œè§£å†³ç²˜åŒ… 4B</li><li>æ¶ˆæ¯ä½“ï¼š<br>æ‰€ä»¥è¯·æ±‚å ç”¨å­—èŠ‚ä¸º 18B<br>é—®é¢˜ï¼š [[JVMå­¦ä¹ #å†…éƒ¨ç±»å¼•ç”¨å¤–éƒ¨ç±»|é™æ€å†…éƒ¨ç±»çš„å¥½å¤„]]</li></ul><h4 id="æ¶ˆæ¯å®šä¹‰"><a href="#æ¶ˆæ¯å®šä¹‰" class="headerlink" title="æ¶ˆæ¯å®šä¹‰"></a>æ¶ˆæ¯å®šä¹‰</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@Builder</span><span class="token comment">// ä½¿ç”¨Tæ³›å‹ï¼Œå¯ä»¥æ¥æ”¶ä»»æ„ç±»å‹çš„æ¶ˆæ¯ä½“</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZMessage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>    <span class="token comment">/**     * è¯·æ±‚å¤´     */</span>    <span class="token keyword">private</span> <span class="token class-name">Header</span> header<span class="token punctuation">;</span>    <span class="token comment">/**     * body     */</span>    <span class="token keyword">private</span> <span class="token class-name">T</span> body<span class="token punctuation">;</span>    <span class="token comment">/**     * ä½¿ç”¨é™æ€å†…éƒ¨ç±»ï¼Œå®šä¹‰è¯·æ±‚å¤´,ä¼˜ç‚¹æ˜¯å¯ä»¥ç›´æ¥é€šè¿‡ZMessage.Headerè®¿é—®ï¼Œæ–¹ä¾¿è§£è€¦ï¼Œå†…éƒ¨ç±»ä¹Ÿä¸ä¼šå‡ºç°å¤–éƒ¨å¼•ç”¨     */</span>    <span class="token annotation punctuation">@Data</span>    <span class="token annotation punctuation">@AllArgsConstructor</span>    <span class="token annotation punctuation">@NoArgsConstructor</span>    <span class="token annotation punctuation">@Builder</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Header</span> <span class="token punctuation">{</span>        <span class="token comment">/**         * é­”æ•°         */</span>        <span class="token keyword">private</span> <span class="token keyword">byte</span> magic<span class="token punctuation">;</span>        <span class="token comment">/**         * ç‰ˆæœ¬         */</span>        <span class="token keyword">private</span> <span class="token keyword">byte</span> version<span class="token punctuation">;</span>        <span class="token comment">/**         * åºåˆ—åŒ–å™¨         */</span>        <span class="token keyword">private</span> <span class="token keyword">byte</span> serialize<span class="token punctuation">;</span>        <span class="token comment">/**         * æ¶ˆæ¯ç±»å‹         */</span>        <span class="token keyword">private</span> <span class="token keyword">byte</span> type<span class="token punctuation">;</span>        <span class="token comment">/**         * æ¶ˆæ¯çŠ¶æ€         */</span>        <span class="token keyword">private</span> <span class="token keyword">byte</span> status<span class="token punctuation">;</span>        <span class="token comment">/**         * è¯·æ±‚id         */</span>        <span class="token keyword">private</span> <span class="token keyword">long</span> requestId<span class="token punctuation">;</span>        <span class="token comment">/**         * å‹ç¼©æ ¼å¼         */</span>        <span class="token keyword">private</span> <span class="token keyword">byte</span> compress<span class="token punctuation">;</span>        <span class="token comment">/**         * æ¶ˆæ¯ä½“é•¿åº¦         */</span>        <span class="token keyword">private</span> <span class="token keyword">int</span> bodyLength<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="è§£å‹ç¼©"><a href="#è§£å‹ç¼©" class="headerlink" title="è§£å‹ç¼©"></a>è§£å‹ç¼©</h4><ol><li>æ¥å£å®šä¹‰<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Compressor</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * å‹ç¼©     *     * @param bytes å‹ç¼©å‰çš„å­—èŠ‚æ•°ç»„     * @return å‹ç¼©åçš„å­—èŠ‚æ•°ç»„     */</span>    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">compress</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * è§£å‹     *     * @param bytes è§£å‹å‰çš„å­—èŠ‚æ•°ç»„     * @return è§£å‹åçš„å­—èŠ‚æ•°ç»„     */</span>    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decompress</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>gzipå®ç°<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GzipCompressor</span> <span class="token keyword">implements</span> <span class="token class-name">Compressor</span><span class="token punctuation">{</span>    <span class="token comment">/**     * 4k ç¼“å†²åŒº     */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">BUFFER_SIZE</span> <span class="token operator">=</span> <span class="token number">4096</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">compress</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span><span class="token string">"bytes should not null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ByteArrayOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token class-name">GZIPOutputStream</span> gzip <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GZIPOutputStream</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            gzip<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>            gzip<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            gzip<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> out<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"gzip compress error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decompress</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span><span class="token string">"bytes should not null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ByteArrayOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token class-name">GZIPInputStream</span> gunzip <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GZIPInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token constant">BUFFER_SIZE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> n<span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">=</span> gunzip<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> out<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"gzip decompress error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h4 id="è§£ç å™¨å’Œç¼–ç å™¨"><a href="#è§£ç å™¨å’Œç¼–ç å™¨" class="headerlink" title="è§£ç å™¨å’Œç¼–ç å™¨"></a>è§£ç å™¨å’Œç¼–ç å™¨</h4><p>æœ¬æ–‡ä½¿ç”¨çš„é€šä¿¡æ–¹å¼æ˜¯åŸºäºNettyå®ç°çš„<br>Nettyä¸­çš„Decoderå’ŒEncoder</p><ol><li>LengthFieldBasedFrameDecoderæ˜¯ByteToMessageDecoderçš„ä¸€ä¸ªå®ç°ç±»ï¼Œå¯ä»¥è§£å†³å­˜åœ¨å®šé•¿çš„æ¶ˆæ¯çš„è§£ç é—®é¢˜</li><li>MessageToByteEncoderå’ŒByteToMessageDecoderæ˜¯æœ€åŸºç¡€çš„ä¸¤ä¸ªç¼–ç ç±»ã€‚LengthFieldBasedFrameDecoderæ˜¯ByteToMessageDecoderçš„ä¸€ä¸ªå®ç°ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©ã€‚<br>ç¼–ç <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProtocolDecoder</span> <span class="token keyword">extends</span> <span class="token class-name">ByteToMessageDecoder</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> channelHandlerContext<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> byteBuf<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è§£ç æ¶ˆæ¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å¯è¯»å­—èŠ‚æ•°ï¼š{}"</span><span class="token punctuation">,</span> byteBuf<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ä¸€å…±18Bï¼Œä½†æ˜¯Lengthå 4Bï¼Œæ‰€ä»¥æœ€å°‘è¦14B</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>byteBuf<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">14</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        byteBuf<span class="token punctuation">.</span><span class="token function">markReaderIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è¯»æŒ‡é’ˆï¼š{}"</span><span class="token punctuation">,</span> byteBuf<span class="token punctuation">.</span><span class="token function">readerIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span> magic <span class="token operator">=</span> byteBuf<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>magic <span class="token operator">!=</span> <span class="token class-name">ProtocolConstant</span><span class="token punctuation">.</span><span class="token constant">MAGIC</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"ä¸æ”¯æŒçš„åè®®"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">byte</span> version <span class="token operator">=</span> byteBuf<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span> serialize <span class="token operator">=</span> byteBuf<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span> type <span class="token operator">=</span> byteBuf<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span> status <span class="token operator">=</span> byteBuf<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è¯»å–8ä¸ªå­—èŠ‚</span>        <span class="token keyword">long</span> requestId <span class="token operator">=</span> byteBuf<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span> compress <span class="token operator">=</span> byteBuf<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è¯»å–4ä¸ªå­—èŠ‚</span>        <span class="token keyword">int</span> bodyLength <span class="token operator">=</span> byteBuf<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span> byteBuf<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¦‚æœå¯è¯»å­—èŠ‚æ•°å°äºbodyLengthï¼Œè¯´æ˜æ•°æ®è¿˜æ²¡åˆ°é½ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è¯»å–</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>byteBuf<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> bodyLength<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// é‡ç½®è¯»æŒ‡é’ˆ</span>            byteBuf<span class="token punctuation">.</span><span class="token function">resetReaderIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>bodyLength<span class="token punctuation">]</span><span class="token punctuation">;</span>        byteBuf<span class="token punctuation">.</span><span class="token function">readBytes</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Compressor</span> compressor <span class="token operator">=</span> <span class="token class-name">CompressorFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"gzip"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> unCompressBody <span class="token operator">=</span> compressor<span class="token punctuation">.</span><span class="token function">decompress</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åºåˆ—åŒ–</span>        <span class="token class-name">SerializerEnum</span> serializerEnum <span class="token operator">=</span> <span class="token class-name">SerializerEnum</span><span class="token punctuation">.</span><span class="token function">getByKey</span><span class="token punctuation">(</span>serialize<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"serializerç§ç±»æ˜¯{}"</span><span class="token punctuation">,</span> serializerEnum<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>serializerEnum <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"ä¸æ”¯æŒçš„åºåˆ—åŒ–å™¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token class-name">Serializer</span> serializer <span class="token operator">=</span> <span class="token class-name">SerializerFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>serializerEnum<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// Class&lt;?&gt; æ˜¯ä¸€ä¸ªé€šé…ç¬¦ï¼Œè¡¨ç¤ºä»»æ„ç±»å‹</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz <span class="token operator">=</span> type <span class="token operator">==</span> <span class="token class-name">MessageType</span><span class="token punctuation">.</span><span class="token constant">REQUEST</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token class-name">RPCRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">:</span> <span class="token class-name">RPCResponse</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> bodyObj <span class="token operator">=</span> serializer<span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span>unCompressBody<span class="token punctuation">,</span> clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ZMessage<span class="token punctuation">.</span>Header</span> header <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZMessage<span class="token punctuation">.</span>Header</span><span class="token punctuation">(</span>magic<span class="token punctuation">,</span> version<span class="token punctuation">,</span> serialize<span class="token punctuation">,</span> type<span class="token punctuation">,</span> status<span class="token punctuation">,</span> requestId<span class="token punctuation">,</span> compress<span class="token punctuation">,</span> bodyLength<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ZMessage</span> zMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZMessage</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span> bodyObj<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è§£ç æ¶ˆæ¯ï¼š{}"</span><span class="token punctuation">,</span> zMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>zMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>è§£ç ï¼š<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProtocolEncoder</span> <span class="token keyword">extends</span> <span class="token class-name">MessageToByteEncoder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ZMessage</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> channelHandlerContext<span class="token punctuation">,</span> <span class="token class-name">ZMessage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> zMessage<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> byteBuf<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>zMessage <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> zMessage<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Message{}"</span><span class="token punctuation">,</span>zMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ZMessage<span class="token punctuation">.</span>Header</span> header <span class="token operator">=</span> zMessage<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        byteBuf<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span><span class="token function">getMagic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        byteBuf<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        byteBuf<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span><span class="token function">getSerialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        byteBuf<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        byteBuf<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        byteBuf<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span><span class="token function">getRequestId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        byteBuf<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span><span class="token function">getCompress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">SerializerEnum</span> serializerEnum <span class="token operator">=</span> <span class="token class-name">SerializerEnum</span><span class="token punctuation">.</span><span class="token function">getByKey</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span><span class="token function">getSerialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>serializerEnum <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"ä¸æ”¯æŒçš„åºåˆ—åŒ–å™¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"serializerçš„ç§ç±»æ˜¯{}"</span><span class="token punctuation">,</span> serializerEnum<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Serializer</span> serializer <span class="token operator">=</span> <span class="token class-name">SerializerFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>serializerEnum<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bodyBytes <span class="token operator">=</span> serializer<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span>zMessage<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> compressedBody <span class="token operator">=</span> <span class="token class-name">CompressorFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"gzip"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compress</span><span class="token punctuation">(</span>bodyBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Serialized message body length: {}"</span><span class="token punctuation">,</span> compressedBody<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ·»åŠ æ—¥å¿—ä»¥ç¡®è®¤åºåˆ—åŒ–åçš„æ¶ˆæ¯é•¿åº¦</span>        byteBuf<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>compressedBody<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>        byteBuf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>compressedBody<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>å¦‚ä½•åŠ å…¥Nettyä¸­ï¼Ÿ<br>æˆ‘ä»¬éœ€è¦åœ¨nettyçš„handlerä¸­æ·»åŠ è¿™ä¸ªå³å¯ï¼Œæ³¨æ„éœ€è¦åœ¨æˆ‘ä»¬æ¶ˆæ¯handlerå¤„ç†ç±»ä¹‹å‰æ·»åŠ <img src="/2024/09/02/00/%E7%BC%96%E7%A0%81%E5%92%8C%E8%A7%A3%E7%A0%81.png"><br>åŒæ—¶å¯¹äºä¸€ä¸ªæ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶ï¼ŒNettyä¸­çš„è·¯å¾„é¡ºåºæ˜¯ä¸ä¸€æ ·çš„ï¼Œå‘é€æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬å…ˆç»è¿‡è§£ç å™¨ï¼Œå°†è¦å‘é€çš„å†…å®¹è§£ç æˆZMessageï¼Œä¹‹åç»è¿‡ç¼–ç å™¨ï¼Œå°†å…¶è§£ç æˆå­—èŠ‚çš„å½¢å¼<br>æ¥æ”¶æ¶ˆæ¯æ—¶æˆ‘ä»¬è¦ç»å†çš„æµç¨‹æ˜¯ç›¸åçš„ï¼Œè¦å…ˆå°†byteç¼–ç æˆæˆ‘ä»¬çš„è‡ªå®šä¹‰çš„å­—èŠ‚æ ¼å¼ï¼Œä¹‹åå†è§£ç æˆæˆ‘ä»¬çš„ZMessageã€‚</li></ol><h3 id="ç½‘ç»œä¼ è¾“çš„å®ç°"><a href="#ç½‘ç»œä¼ è¾“çš„å®ç°" class="headerlink" title="ç½‘ç»œä¼ è¾“çš„å®ç°"></a>ç½‘ç»œä¼ è¾“çš„å®ç°</h3><p>Nettyå®ç°</p><blockquote><ol><li>ç½‘ç»œé€šä¿¡å±‚ï¼šæ”¯æŒå¤šç§ç½‘ç»œåè®®ï¼Œå½“ç½‘ç»œæ•°æ®è¯»å–åˆ°å†…æ ¸ç¼“å†²åŒºåï¼Œä¼šè§¦å‘å„ç§ç½‘ç»œäº‹ä»¶ï¼Œä¼šåˆ†å‘ç»™äº‹ä»¶è°ƒåº¦å±‚è¿›è¡Œå¤„ç†ã€‚æ ¸å¿ƒæ˜¯<ul><li>BootStrapï¼Œè´Ÿè´£Nettyå®¢æˆ·ç«¯çš„å¯åŠ¨ã€åˆå§‹åŒ–ã€æœåŠ¡å™¨è¿æ¥ç­‰è¿‡ç¨‹</li><li>ServerBootStrapï¼šç”¨äºæœåŠ¡ç«¯ç»‘å®šæœ¬åœ°ç«¯ç«¯å£ï¼Œä¼šç»‘å®šBosså’ŒWorkerä¸¤ä¸ªEventLoopGroup</li><li>Channle é€šé“ï¼ŒåŸºäºNIOæ›´é«˜å±‚æ¬¡çš„æŠ½è±¡å—</li></ul></li></ol></blockquote><h4 id="request-responseæ¨¡å‹"><a href="#request-responseæ¨¡å‹" class="headerlink" title="request - responseæ¨¡å‹"></a>request - responseæ¨¡å‹</h4><p>Nettyçš„é€šä¿¡æ˜¯å¼‚æ­¥é€šä¿¡ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯ä¸èƒ½å¤ŸåŒæ­¥æ¥ç¡®è®¤è¯·æ±‚å’Œå“åº”æ˜¯å¦æˆåŠŸï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæœªå¤„ç†è¯·æ±‚æ¥ç¡®å®šæˆ‘ä»¬çš„è¯·æ±‚æ˜¯å¦æˆåŠŸå¾—åˆ°å“åº”<br><img src="/2024/09/02/00/%E6%9C%AA%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82.png"><br>åœ¨Invokerä¸­ï¼Œæˆ‘ä»¬æˆåŠŸå‘é€è¯·æ±‚ä¹‹å‰å…ˆå°†è¿™ä¸ªç»“æœæ”¾å…¥mapä¸­<br><img src="/2024/09/02/00/put.png"><br>åœ¨æˆ‘ä»¬çš„ClientHandlerä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å“åº”çš„requestIdæ¥ç¡®è®¤æˆ‘ä»¬æ˜¯å¦æˆåŠŸæ”¶åˆ°äº†å›å¤<br><img src="/2024/09/02/00/complete.png"></p><h4 id="å¿ƒè·³æœºåˆ¶"><a href="#å¿ƒè·³æœºåˆ¶" class="headerlink" title="å¿ƒè·³æœºåˆ¶"></a>å¿ƒè·³æœºåˆ¶</h4><p>æ›´åŠ è¯¦ç»†çš„ä»‹ç» <a href="https://www.cnblogs.com/chenchuxin/p/15236259.html">ä»é›¶å¼€å§‹å®ç°ç®€å• RPC æ¡†æ¶ 9ï¼šç½‘ç»œé€šä¿¡ä¹‹å¿ƒè·³ä¸é‡è¿æœºåˆ¶ - å°æ–°æ˜¯ä¹Ÿ - åšå®¢å›­ (cnblogs.com)</a><br>Nettyå·²ç»å¸®æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¿ƒè·³Handler <code>IdleStateHandler</code>ï¼Œå½“è¿æ¥çš„ç©ºé—²æ—¶é—´è¿‡é•¿æ—¶ï¼Œ<code>IdleStateHandler</code>ä¼šè§¦å‘ä¸€ä¸ª <code>IdleStateEvent</code> äº‹ä»¶ï¼Œä¼ é€’çš„åˆ°ä¸‹ä¸€ä¸ªHandlerï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨è‡ªå®šä¹‰çš„Handlerä¸­é‡å†™<code>userEventTrigged</code>æ–¹æ³•æ¥å¤„ç†è¿™ä¸ªäº‹ä»¶ã€‚<strong>éœ€è¦æ³¨æ„çš„æ˜¯è‡ªå®šä¹‰çš„Handleråº”è¯¥è¿½åŠ åœ¨å¿ƒè·³Handlerä¹‹åã€‚</strong><br>1.å®Œæ•´çš„æ„é€ å‡½æ•°<img src="/2024/09/02/00/Idle%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0.png"></p><ul><li><code>observeOutput</code>ï¼šæ˜¯å¦è€ƒè™‘å‡ºç«™è¾ƒæ…¢çš„æƒ…å†µã€‚å¦‚æœä¸ºtrueå°±ä¸è§¦å‘æ­¤æ¬¡äº‹ä»¶ï¼Œå¦‚æœfalseå°±ä¼šè§¦å‘ã€‚é»˜è®¤ä¸ºfalse</li><li><code>readerIdleTime</code>ï¼šè¯»ç©ºé—²æ—¶é—´ï¼Œ0è¡¨ç¤ºç¦ç”¨è¯»ç©ºé—²æ—¶é—´äº‹ä»¶</li><li><code>writerIdleTime</code>ï¼šå†™ç©ºé—²äº‹ä»¶ï¼Œ0è¡¨ç¤ºç¦ç”¨å†™ç©ºé—²äº‹ä»¶ã€‚</li><li><code>allIdleTime</code>ï¼šè¯»æˆ–è€…å†™ç©ºé—²æ—¶é—´ï¼Œ0è¡¨ç¤ºç¦ç”¨äº‹ä»¶</li><li><code>unit</code>ï¼šå•ä½<br>2.æ ¸å¿ƒçš„äº‹ä»¶å¤„ç†æœºåˆ¶<br><code>IdleStateHandler</code>&nbsp;ç»§æ‰¿&nbsp;<code>ChannelDuplexHandler</code>ï¼Œé‡å†™äº†å‡ºç«™å’Œå…¥ç«™çš„äº‹ä»¶ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä»£ç ã€‚<br>å½“ channel æ·»åŠ ã€æ³¨å†Œã€æ´»è·ƒçš„æ—¶å€™ï¼Œä¼šåˆå§‹åŒ–&nbsp;<code>initialize(ctx)</code>ï¼Œåˆ é™¤ã€ä¸æ´»è·ƒçš„æ—¶å€™é”€æ¯&nbsp;<code>destroy()</code>ï¼Œè¯»å†™çš„æ—¶å€™è®¾ç½®&nbsp;<code>lastReadTime</code>&nbsp;å’Œ&nbsp;<code>lastWriteTime</code>&nbsp;å­—æ®µã€‚<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IdleStateHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelDuplexHandler</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerAdded</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isRegistered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">initialize</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerRemoved</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRegistered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">initialize</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">channelRegistered</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token function">initialize</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">channelActive</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelInactive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">channelInactive</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">// åˆ¤æ–­æ˜¯å¦å¼€å¯ è¯»ç©ºé—² æˆ–è€… è¯»å†™ç©ºé—² ç›‘æ§</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>readerIdleTimeNanos <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">||</span> allIdleTimeNanos <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// è®¾ç½® reading æ ‡å¿—ä½</span>            reading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            firstReaderIdleEvent <span class="token operator">=</span> firstAllIdleEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        ctx<span class="token punctuation">.</span><span class="token function">fireChannelRead</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// è¯»å®Œæˆä¹‹å</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelReadComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">// åˆ¤æ–­æ˜¯å¦å¼€å¯ è¯»ç©ºé—² æˆ–è€… è¯»å†™ç©ºé—² ç›‘æ§ï¼Œæ£€æŸ¥ reading æ ‡å¿—ä½</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>readerIdleTimeNanos <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">||</span> allIdleTimeNanos <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> reading<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// è®¾ç½® lastReadTimeï¼Œåé¢åˆ¤æ–­è¯»è¶…æ—¶æœ‰ç”¨</span>            lastReadTime <span class="token operator">=</span> <span class="token function">ticksInNanos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            reading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        ctx<span class="token punctuation">.</span><span class="token function">fireChannelReadComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">,</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">// åˆ¤æ–­æ˜¯å¦å¼€å¯ å†™ç©ºé—² æˆ–è€… è¯»å†™ç©ºé—² ç›‘æ§</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>writerIdleTimeNanos <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">||</span> allIdleTimeNanos <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// writeListener çš„æ–¹æ³•åœ¨ä¸‹é¢ï¼Œä¸»è¦æ˜¯è®¾ç½® lastWriteTime</span>            ctx<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> promise<span class="token punctuation">.</span><span class="token function">unvoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>writeListener<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            ctx<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ChannelFutureListener</span> writeListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChannelFutureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelFuture</span> future<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>            lastWriteTime <span class="token operator">=</span> <span class="token function">ticksInNanos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            firstWriterIdleEvent <span class="token operator">=</span> firstAllIdleEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>æœ€åº•å±‚çš„è°ƒç”¨ï¼Œä¹Ÿå³æ˜¯å®é™…ä¸Šå¦‚ä½•è¿›è¡Œ<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">invokeUserEventTriggered</span><span class="token punctuation">(</span><span class="token class-name">Object</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">invokeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment">// è§¦å‘äº‹ä»¶ï¼Œè¯´ç™½äº†ï¼Œå°±æ˜¯ç›´æ¥è°ƒç”¨ userEventTriggered æ–¹æ³•è€Œå·²</span>            <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ChannelInboundHandler</span><span class="token punctuation">)</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">userEventTriggered</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">notifyHandlerException</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token function">fireUserEventTriggered</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®å®é™…ä¸Šå°±æ˜¯å°†äº‹ä»¶ä¼ ç»™ä¸‹ä¸€ä¸ªHandlerï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨äº†userEventTriggeredæ–¹æ³•<br>3.å®ç°</li><li>å®¢æˆ·ç«¯Clientå®ç°<img src="/2024/09/02/00/client%E5%BF%83%E8%B7%B3.png"></li><li>æœåŠ¡ç«¯å®ç°ï¼šå¯¹äºå¿ƒè·³åŒ…æˆ‘ä»¬æ²¡å¿…è¦å»å›å¤ï¼Œæˆ‘ä»¬åªéœ€è¦å¤„ç†æ˜¯å¦æœ‰å†™äº‹ä»¶æ˜¯å¦å‘ç”Ÿå³å¯<br>4.æ–­çº¿é‡è¿çš„ç§˜å¯†<br>æ ¸å¿ƒå°±æ˜¯æˆ‘ä»¬çš„è¿™ä¸ªç¼“å­˜ï¼Œå¯¹äºæ¯ä¸€ä¸ªè¿æ¥ï¼Œæˆ‘ä»¬éƒ½é€šè¿‡è¿æ¥åœ°å€æ¥ä¿å­˜ä»–çš„Channel<img src="/2024/09/02/00/channel%E7%BC%93%E5%AD%98.png"><br>æ ¸å¿ƒå‡½æ•°æ˜¯è¿™ä¸ª<img src="/2024/09/02/00/getChannel.png"><br>å½“æˆ‘ä»¬æ£€æµ‹åˆ°è¿™ä¸ªchannelä¸å­˜åœ¨æˆ–è€…ä¸æ´»è·ƒæ—¶æˆ‘ä»¬é‡æ–°å»ºç«‹è¿æ¥å¹¶æ”¾åœ¨ç¼“å­˜ä¸­å³å¯<br>éœ€è¦ä¿è¯æˆ‘ä»¬çš„å­—èŠ‚æ•°è¦å¯¹çš„ä¸Šï¼Œå› ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰åè®®çš„å­—èŠ‚ä¸æ»¡è¶³ä¼šæ”¾åœ¨ç¼“å†²åŒºï¼Œ<br>ç„¶åå¦‚æœä¸éœ€è¦å¤„ç†å…¶ä»–åè®®æ¯”å¦‚HTTPå¯ä»¥ä¸åŠ é‚£ç§Handler</li></ul><h4 id="æ¶ˆæ¯çš„å¤„ç†Handler"><a href="#æ¶ˆæ¯çš„å¤„ç†Handler" class="headerlink" title="æ¶ˆæ¯çš„å¤„ç†Handler"></a>æ¶ˆæ¯çš„å¤„ç†Handler</h4><p>å…·ä½“å®ç°å¯ä»¥å‚è€ƒ NettyClientHandlerå’ŒNettyServerHandlerä¸¤ä¸ªç±»çš„å®ç°ï¼Œæ€è·¯å¾ˆç®€å•è¿™é‡Œå°±ä¸è´´å‡ºæºç äº†ã€‚</p><h3 id="è´Ÿè½½å‡è¡¡çš„å®ç°"><a href="#è´Ÿè½½å‡è¡¡çš„å®ç°" class="headerlink" title="è´Ÿè½½å‡è¡¡çš„å®ç°"></a>è´Ÿè½½å‡è¡¡çš„å®ç°</h3><ol><li>éšæœºï¼šéšæœºæ•°é€‰å–</li><li>è½®è¯¢ï¼šä½¿ç”¨AtomicIntegeræ¥ä¿è¯çº¿ç¨‹å®‰å…¨å’ŒåŸå­æ“ä½œï¼Œä¿è¯è½®è¯¢çš„å®ç°ã€‚</li><li>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•<br>å®ç°æ€è·¯ä»ç„¶æ˜¯æ ¹æ®SPIå®ç°ï¼Œç„¶åç¯‡å¹…åŸå› ï¼Œå…·ä½“çš„å®ç°å¯ä»¥å‚ç…§æºç ã€‚</li></ol><h3 id="é‡è¯•ä¸å®¹é”™"><a href="#é‡è¯•ä¸å®¹é”™" class="headerlink" title="é‡è¯•ä¸å®¹é”™"></a>é‡è¯•ä¸å®¹é”™</h3><p>å‡ºç°æ•…éšœæ—¶ï¼Œå¦‚ä½•å¤„ç†<br> Callableå¯¹è±¡:</p><blockquote><p>Callable æ˜¯ Java ä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œç”¨äºè¡¨ç¤ºå¯ä»¥è¿”å›ç»“æœå¹¶å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»»åŠ¡ã€‚å®ƒä¸ Runnable æ¥å£ç±»ä¼¼ï¼Œä½† Runnable ä¸èƒ½è¿”å›ç»“æœï¼Œä¹Ÿä¸èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸ã€‚<br>ä¸»è¦ç”¨é€”<br>å¼‚æ­¥ä»»åŠ¡ï¼šCallable å¸¸ç”¨äºéœ€è¦åœ¨åå°çº¿ç¨‹ä¸­æ‰§è¡Œå¹¶è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚<br>å¼‚å¸¸å¤„ç†ï¼šCallable å¯ä»¥æŠ›å‡ºå—æ£€å¼‚å¸¸ï¼Œå…è®¸æ›´çµæ´»çš„é”™è¯¯å¤„ç†ã€‚</p></blockquote><h4 id="å¸¸è§çš„é‡è¯•ç­–ç•¥"><a href="#å¸¸è§çš„é‡è¯•ç­–ç•¥" class="headerlink" title="å¸¸è§çš„é‡è¯•ç­–ç•¥"></a>å¸¸è§çš„é‡è¯•ç­–ç•¥</h4><ol><li>å›ºå®šé—´éš”é‡è¯•ï¼šå›ºå®šé—´éš”</li><li>çº¿æ€§é‡è¯•ï¼šæ—¶é—´é—´éš”çº¿æ€§å¢åŠ </li><li>æœ€å¤§é‡è¯•æ¬¡æ•°</li><li>ä¸é‡è¯•<br>å›ºå®šé—´éš”å®ç°ï¼š<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FixedIntervalRetryStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">RetryStrategy</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">RPCResponse</span> <span class="token function">doRetry</span><span class="token punctuation">(</span><span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RPCResponse</span><span class="token punctuation">&gt;</span></span> callable<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">// Retryeræ˜¯é‡è¯•çš„æ ¸å¿ƒç±»ï¼ŒRetryerBuilderæ˜¯æ„å»ºRetryerçš„å·¥å‚ç±»</span>        <span class="token class-name">Retryer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RPCResponse</span><span class="token punctuation">&gt;</span></span> retryer <span class="token operator">=</span> <span class="token class-name">RetryerBuilder</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RPCResponse</span><span class="token punctuation">&gt;</span></span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">// é‡è¯•æ¡ä»¶ï¼Œå½“å‘ç”ŸExceptionæ—¶é‡è¯•</span>                <span class="token punctuation">.</span><span class="token function">retryIfExceptionOfType</span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>                <span class="token comment">// é‡è¯•é—´éš”æ—¶é—´ç­–ç•¥ï¼Œæ¯æ¬¡é‡è¯•é—´éš”3ç§’</span>                <span class="token punctuation">.</span><span class="token function">withWaitStrategy</span><span class="token punctuation">(</span><span class="token class-name">WaitStrategies</span><span class="token punctuation">.</span><span class="token function">fixedWait</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token comment">// é‡è¯•åœæ­¢ç­–ç•¥ï¼Œé‡è¯•3æ¬¡ååœæ­¢</span>                <span class="token punctuation">.</span><span class="token function">withStopStrategy</span><span class="token punctuation">(</span><span class="token class-name">StopStrategies</span><span class="token punctuation">.</span><span class="token function">stopAfterAttempt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token comment">// é‡è¯•ç›‘å¬å™¨ï¼Œç›‘å¬é‡è¯•äº‹ä»¶</span>                <span class="token punctuation">.</span><span class="token function">withRetryListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RetryListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token annotation punctuation">@Override</span>                    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">onRetry</span><span class="token punctuation">(</span><span class="token class-name">Attempt</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> attempt<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment">// é‡è¯•æ—¥å¿—</span>                        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"é‡è¯•ç¬¬{}æ¬¡"</span><span class="token punctuation">,</span> attempt<span class="token punctuation">.</span><span class="token function">getAttemptNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> retryer<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>callable<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h4 id="å¸¸è§çš„å®¹é”™ç­–ç•¥"><a href="#å¸¸è§çš„å®¹é”™ç­–ç•¥" class="headerlink" title="å¸¸è§çš„å®¹é”™ç­–ç•¥"></a>å¸¸è§çš„å®¹é”™ç­–ç•¥</h4><blockquote><p>å®¹é”™æœºåˆ¶æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†,å®ƒçš„ç›®æ ‡æ˜¯åœ¨éƒ¨åˆ†ç»„ä»¶æˆ–èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶,ä»èƒ½ä¿è¯ç³»ç»Ÿæ•´ä½“çš„æ­£å¸¸è¿è½¬å’ŒæœåŠ¡å¯ç”¨æ€§ã€‚</p></blockquote><ol><li>å¤±è´¥è‡ªåŠ¨åˆ‡æ¢(Failover)</li><li>å¿«é€Ÿå¤±è´¥(Failfast)ï¼šç«‹åˆ»æŠ›å‡ºå¼‚å¸¸ï¼Œä¸è¿›è¡Œé‡è¯•æˆ–è€…é™çº§<br>æ•…éšœè½¬ç§»å®ç°ï¼š<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FailOverTolerantStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">TolerantStrategy</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">RPCResponse</span> <span class="token function">doTolerant</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> context<span class="token punctuation">,</span> <span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceMetaInfo</span><span class="token punctuation">&gt;</span></span> metaInfos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceMetaInfo</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">TolerantStrategyConstant</span><span class="token punctuation">.</span><span class="token constant">SERVICE_LIST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ServiceMetaInfo</span> metaInfo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServiceMetaInfo</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">TolerantStrategyConstant</span><span class="token punctuation">.</span><span class="token constant">CURRENT_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">RPCRequest</span> rpcRequest <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RPCRequest</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">TolerantStrategyConstant</span><span class="token punctuation">.</span><span class="token constant">RPC_REQUEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>metaInfos <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> metaInfos<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"æ•…éšœè½¬ç§»å¤±è´¥ï¼ŒmetaInfosä¸ºç©º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token class-name">NettyClient</span> nettyClient <span class="token operator">=</span> <span class="token class-name">NettyClient</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ZMessage</span> message <span class="token operator">=</span> <span class="token class-name">NettyInvoker</span><span class="token punctuation">.</span><span class="token function">buildMessage</span><span class="token punctuation">(</span>rpcRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">ServiceMetaInfo</span> serviceMetaInfo<span class="token operator">:</span> metaInfos<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>serviceMetaInfo<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>metaInfo<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token class-name">RetryStrategy</span> retryStrategy <span class="token operator">=</span> <span class="token class-name">RetryStrategyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"fixedinterval"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> retryStrategy<span class="token punctuation">.</span><span class="token function">doRetry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>                    <span class="token class-name">InetSocketAddress</span> socketAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span>serviceMetaInfo<span class="token punctuation">.</span><span class="token function">getServiceHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> serviceMetaInfo<span class="token punctuation">.</span><span class="token function">getServicePort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Channel</span> channel <span class="token operator">=</span> nettyClient<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span>socketAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>channel<span class="token punctuation">.</span><span class="token function">isActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RPCResponse</span><span class="token punctuation">&gt;</span></span> resultFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token class-name">UnprocessedRequests</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRequestId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> resultFuture<span class="token punctuation">)</span><span class="token punctuation">;</span>                        channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ChannelFutureListener</span><span class="token punctuation">)</span> future <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span>future<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"client send message{}"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                                future<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                resultFuture<span class="token punctuation">.</span><span class="token function">completeExceptionally</span><span class="token punctuation">(</span>future<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"send failed{}"</span><span class="token punctuation">,</span> future<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">}</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">return</span> resultFuture<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"channel is not active. address="</span> <span class="token operator">+</span> socketAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"æ•…éšœè½¬ç§»å¤±è´¥ï¼Œé‡è¯•å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"å®¹é”™å¤±è´¥,æ‰€æœ‰çš„æœåŠ¡é‡è¯•éƒ½å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>å®é™…ä½¿ç”¨ï¼š<img src="/2024/09/02/00/%E5%AE%B9%E9%94%99%E4%BD%BF%E7%94%A8.png"></li></ol><h3 id="StarteråŒ…"><a href="#StarteråŒ…" class="headerlink" title="StarteråŒ…"></a>StarteråŒ…</h3><ol><li>æœåŠ¡æ‰«æè®¾è®¡<br>ä½¿ç”¨BeanPostProcessoræ¥åŠ è½½è¢«@ZuoRpcServiceæ³¨è§£çš„ç±»<blockquote><p>BeanPostProcessor æ˜¯ Spring æ¡†æ¶ä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œå…è®¸åœ¨ Spring å®¹å™¨å®ä¾‹åŒ– bean ä¹‹åä½†åœ¨ä¾èµ–æ³¨å…¥å‘ç”Ÿä¹‹å‰å¯¹ bean è¿›è¡Œè‡ªå®šä¹‰ä¿®æ”¹ã€‚å®ƒæä¾›äº†ä¸¤ä¸ªä¸»è¦æ–¹æ³•ï¼š<br>postProcessBeforeInitialization(Object bean, String beanName)ï¼šåœ¨ bean åˆå§‹åŒ–ä¹‹å‰è¿›è¡Œå¤„ç†ã€‚<br>postProcessAfterInitialization(Object bean, String beanName)ï¼šåœ¨ bean åˆå§‹åŒ–ä¹‹åè¿›è¡Œå¤„ç†ã€‚<br>å¦‚ä½•ç¼–å†™ä¸€ä¸ªStarteråŒ…ï¼Ÿ<br>å¼•å…¥springbootå¯åŠ¨ä¾èµ–ï¼Œç¼–å†™bootstrapç±»<br>ImportBeanDefinitionRegistrar æ˜¯ Spring æ¡†æ¶ä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œç”¨äºåœ¨è¿è¡Œæ—¶åŠ¨æ€æ³¨å†Œ Bean å®šä¹‰ã€‚å®ƒå…è®¸æ‚¨åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­æ³¨å†Œé¢å¤–çš„ Bean å®šä¹‰ï¼Œè€Œæ— éœ€åœ¨ XML é…ç½®æ–‡ä»¶æˆ–æ³¨è§£ä¸­æ˜¾å¼å£°æ˜å®ƒä»¬ã€‚<br>æ³¨å†ŒæœåŠ¡åº”è¯¥åœ¨æœåŠ¡å¯åŠ¨ä¹‹å‰å°±è¿›è¡Œï¼Œå› ä¸ºNettyä¼šé˜»å¡ï¼Œå¯¼è‡´åç»­æ— æ³•æ³¨å†ŒæˆåŠŸ</p></blockquote></li></ol><p><strong>é‡åˆ°çš„é—®é¢˜</strong><br>æˆ‘ä½¿ç”¨çš„ä¾èµ–æ˜¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span> <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper<span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span> <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>zookeeper<span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span> <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">3.6</span><span class="token number">.3</span><span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span> <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span> <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span><span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span><span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>starter<span class="token operator">-</span>zookeeper<span class="token operator">-</span>discovery<span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span><span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">4.1</span><span class="token number">.2</span><span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span> <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªä¾èµ–ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨curatorï¼Œä½†æ˜¯ä»–çš„zookeeperçš„é…ç½®æ˜¯å•ç‹¬çš„ï¼Œä¼šç»‘å®šspringå¯åŠ¨ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰å†™çš„registryä¸­å¿ƒä¸èƒ½å’Œè¿™ä¸ªç»‘å®šï¼Œå°±å¯¼è‡´ä¸€ç›´æ˜¯ç»‘å®šåˆ°æœ¬åœ°zookeeperï¼Œå³ä½¿æˆ‘ä»¬å·²ç»æˆåŠŸæ³¨å†Œäº†<br>æ‰€ä»¥ä½¿ç”¨curatorçš„ä¾èµ–æ¥è§£å†³</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>curator<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>curator<span class="token operator">-</span>x<span class="token operator">-</span>discovery<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">5.6</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŸºç¡€è®¾ç½®å¯åŠ¨</p><h4 id="æ³¨è§£è®¾è®¡"><a href="#æ³¨è§£è®¾è®¡" class="headerlink" title="æ³¨è§£è®¾è®¡"></a>æ³¨è§£è®¾è®¡</h4><p>å¯åŠ¨æ³¨è§£</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">RPCInitBootStrap</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">RPCProviderBootstrap</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">RPCConsumerBootstrap</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// è‡ªåŠ¨æŒ‰ç…§é¡ºåºåŠ è½½è¿™å‡ ä¸ªç±»</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableZuofwRpc</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * éœ€è¦å¯åŠ¨server     *     * @return     */</span>    <span class="token keyword">boolean</span> <span class="token function">needServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯è°ƒç”¨ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">FIELD</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">ZuofwRPCReference</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * æœåŠ¡æ¥å£ç±»     * @return     */</span>    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">interfaceClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token keyword">void</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>    <span class="token comment">/**     * æœåŠ¡ç‰ˆæœ¬     * @return     */</span>    <span class="token class-name">String</span> <span class="token function">serviceVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">RPCConstant</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_SERVICE_VERSION</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœåŠ¡æä¾›è€…</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">ZuofwRPCService</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * æœåŠ¡æ¥å£ç±»     *     * @return     */</span>    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">interfaceClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token keyword">void</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>    <span class="token comment">/**     * æœåŠ¡ç‰ˆæœ¬     *     * @return     */</span>    <span class="token class-name">String</span> <span class="token function">serviceVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">RPCConstant</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_SERVICE_VERSION</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ‰«æç±»å®ç°"><a href="#æ‰«æç±»å®ç°" class="headerlink" title="æ‰«æç±»å®ç°"></a>æ‰«æç±»å®ç°</h4><p>åˆå§‹åŒ–ç±»åŠ è½½</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RPCInitBootStrap</span> <span class="token keyword">implements</span> <span class="token class-name">ImportBeanDefinitionRegistrar</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * Springåˆå§‹åŒ–æ‰§è¡Œæ—¶å€™ï¼Œåˆå§‹åŒ–Rpcæ¡†æ¶     *     * @param importingClassMetadata     * @param registry     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> importingClassMetadata<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// è·å–EnableRpc æ³¨è§£çš„å±æ€§å€¼</span>        <span class="token keyword">boolean</span> needServer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">boolean</span><span class="token punctuation">)</span> importingClassMetadata<span class="token punctuation">.</span><span class="token function">getAnnotationAttributes</span><span class="token punctuation">(</span><span class="token class-name">EnableZuofwRpc</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"needServer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// Rpcæ¡†æ¶åˆå§‹åŒ–ï¼ˆé…ç½®å’Œæ³¨å†Œä¸­å¿ƒï¼‰</span>        <span class="token class-name">RPCApplication</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> <span class="token class-name">RPCConfig</span> rpcConfig <span class="token operator">=</span> <span class="token class-name">RPCApplication</span><span class="token punctuation">.</span><span class="token function">getRpcConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¯åŠ¨æœåŠ¡å™¨</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>needServer<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">NettyServer</span> nettyServer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NettyServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"port:{}"</span><span class="token punctuation">,</span> rpcConfig<span class="token punctuation">.</span><span class="token function">getServerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                nettyServer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>rpcConfig<span class="token punctuation">.</span><span class="token function">getServerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Rpc server is not started"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»£ç†æ‰«æå®ç°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RPCConsumerBootstrap</span> <span class="token keyword">implements</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanClass <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// éå†å¯¹è±¡çš„æ‰€æœ‰å±æ€§</span>        <span class="token class-name">Field</span><span class="token punctuation">[</span><span class="token punctuation">]</span> declaredFields <span class="token operator">=</span> beanClass<span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Field</span> field <span class="token operator">:</span> declaredFields<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">ZuofwRPCReference</span> rpcReference <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">ZuofwRPCReference</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>rpcReference <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// ä¸ºå±æ€§ç”Ÿæˆä»£ç†å¯¹è±¡</span>                <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> interfaceClass <span class="token operator">=</span> rpcReference<span class="token punctuation">.</span><span class="token function">interfaceClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>interfaceClass <span class="token operator">==</span> <span class="token keyword">void</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    interfaceClass <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”Ÿæˆä»£ç†å¯¹è±¡:"</span> <span class="token operator">+</span> interfaceClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"  "</span><span class="token operator">+</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                field<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ç”Ÿæˆä»£ç†å¯¹è±¡:{}"</span><span class="token punctuation">,</span> interfaceClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Object</span> proxy <span class="token operator">=</span> <span class="token class-name">ServiceProxyFactory</span><span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span>interfaceClass<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//                Object proxy = ServiceProxyFactory.getCGProxy(interfaceClass);</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    field<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> proxy<span class="token punctuation">)</span><span class="token punctuation">;</span>                    field<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”Ÿæˆä»£ç†å¯¹è±¡å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token class-name">BeanPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœåŠ¡æ‰«æå’Œæ³¨å†Œå®ç°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RPCProviderBootstrap</span> <span class="token keyword">implements</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanClass <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ZuofwRPCService</span> rpcService <span class="token operator">=</span> beanClass<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">ZuofwRPCService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>rpcService <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// éœ€è¦æ³¨å†ŒæœåŠ¡</span>            <span class="token comment">// è·å–æœåŠ¡åŸºæœ¬ä¿¡æ¯</span>            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> interfaceClass <span class="token operator">=</span> rpcService<span class="token punctuation">.</span><span class="token function">interfaceClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// é»˜è®¤å€¼å¤„ç†</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>interfaceClass <span class="token operator">==</span> <span class="token keyword">void</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                interfaceClass <span class="token operator">=</span> beanClass<span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token class-name">String</span> serviceName <span class="token operator">=</span> interfaceClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> serviceVersion <span class="token operator">=</span> rpcService<span class="token punctuation">.</span><span class="token function">serviceVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// æ³¨å†ŒæœåŠ¡</span>            <span class="token comment">// æœ¬åœ°æ³¨å†Œ</span>            <span class="token class-name">LocalRegistry</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>serviceName<span class="token punctuation">,</span> beanClass<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å…¨å±€é…ç½®</span>            <span class="token keyword">final</span> <span class="token class-name">RPCConfig</span> rpcConfig <span class="token operator">=</span> <span class="token class-name">RPCApplication</span><span class="token punctuation">.</span><span class="token function">getRpcConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ</span>            <span class="token class-name">RegistryConfig</span> registryConfig <span class="token operator">=</span> rpcConfig<span class="token punctuation">.</span><span class="token function">getRegistryConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Registry</span> registry <span class="token operator">=</span> <span class="token class-name">RegistryFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>registryConfig<span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ServiceMetaInfo</span> serviceMetaInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServiceMetaInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            serviceMetaInfo<span class="token punctuation">.</span><span class="token function">setServiceName</span><span class="token punctuation">(</span>serviceName<span class="token punctuation">)</span><span class="token punctuation">;</span>            serviceMetaInfo<span class="token punctuation">.</span><span class="token function">setServiceVersion</span><span class="token punctuation">(</span>serviceVersion<span class="token punctuation">)</span><span class="token punctuation">;</span>            serviceMetaInfo<span class="token punctuation">.</span><span class="token function">setServiceHost</span><span class="token punctuation">(</span>rpcConfig<span class="token punctuation">.</span><span class="token function">getServerHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            serviceMetaInfo<span class="token punctuation">.</span><span class="token function">setServicePort</span><span class="token punctuation">(</span>rpcConfig<span class="token punctuation">.</span><span class="token function">getServerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                registry<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>serviceMetaInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token class-name">BeanPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ„Ÿè°¢è§‚çœ‹ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬åŸºæœ¬ç¼•æ¸…äº†ä¸€éRPCçš„å®ç°åŸç†ï¼Œå…·ä½“çš„å®ç°å¯ä»¥åˆ°æˆ‘çš„Githubä¸­æŸ¥çœ‹æºç ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥ç†è§£ç³»åˆ— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rpc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è„šæœ¬è¯­è¨€å­¦ä¹ </title>
      <link href="/2024/08/01/12/"/>
      <url>/2024/08/01/12/</url>
      
        <content type="html"><![CDATA[<h1 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h1><p>åŸºæœ¬è¯­æ³•</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>gitå¿«é€Ÿä½¿ç”¨</title>
      <link href="/2024/07/22/14/"/>
      <url>/2024/07/22/14/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬æ–‡ä¸æ˜¯gitå…¥é—¨ï¼Œä½†åç»­ä¼šè¡¥ä¸€äº›å…¥é—¨çŸ¥è¯†ï¼Œä¸»è¦æ˜¯å†™ç»™å·¥ä½œå®¤çš„å­¦å¼Ÿå­¦å¦¹å¿«é€Ÿæ’éšœä½¿ç”¨ã€‚<del>ä¸»è¦æ˜¯è¢«æŸäº›åŒå­¦æ•´æ— è¯­äº†æ‰æƒ³ç€è®°å½•ä¸€ä¸‹</del><br>è§‚çœ‹å‰æï¼šä¼šä¸Šgithub</p><h1 id="gitåæ‚”è¯"><a href="#gitåæ‚”è¯" class="headerlink" title="gitåæ‚”è¯"></a>gitåæ‚”è¯</h1><blockquote><p>ä¸–ä¸Šæ²¡æœ‰åæ‚”è¯</p></blockquote><p>ä½†æ˜¯gitæœ‰(ï¿£ï¸¶ï¿£*))<br>è¿˜åœ¨æ‹…å¿ƒä¸Šç­æ—¶è„‘å­ä¸€çƒ­å†™ä¸‹è‡­éª‚è€æ¿çš„è¯å¯¼è‡´ç»©æ•ˆå¥–æ²¡æœ‰å—ï¼Œè¿˜åœ¨æ‹…å¿ƒæäº¤è®°å½•å†™çš„ä¸‘å—ï¼Œè¿˜åœ¨æ‹…å¿ƒè¿œç¨‹pushçš„æ—¶å€™ä¸ä¼šæå—ï¼Œè¿™ç¯‡æ–‡ç« ç”¨æ¥è®°å½•å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ã€‚</p><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>å…ˆä»‹ç»ä¸€äº›æ¦‚å¿µï¼š</p><ol><li>å·¥ä½œåŒºï¼šå·¥ä½œåŒºå°±æ˜¯æˆ‘ä»¬ä¿®æ”¹çš„æ–‡ä»¶ä½†æ˜¯è¿˜æ²¡æœ‰è¿›è¡Œgit add</li><li>æš‚å­˜åŒºï¼šæˆ‘ä»¬ä½¿ç”¨git add ä¹‹åä½†æ˜¯è¿˜ä¹ˆæœ‰è¿›è¡Œgit commit</li><li>å·²æäº¤ï¼šè¿›è¡Œgit commit ä¹‹å</li><li>å·²ç»æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼šgit pushä¹‹å</li><li>HEADï¼šGitä¸­çš„ä¸€ä¸ªç‰¹æ®Šçš„æŒ‡é’ˆï¼ŒæŒ‡å‘äº†å½“å‰<strong>æ‰€åœ¨åˆ†æ”¯çš„æœ€æ–°æäº¤</strong>ã€‚å¯ä»¥ä½¿ç”¨ ^ æ¥å½“ä½œæŒ‡é’ˆä¿®é¥°ç¬¦ï¼ŒHEAD^ä»£è¡¨å‰ä¸€ä¸ªæäº¤ï¼Œ HEAD^^æˆ–è€…HEAD<del>2ä»£è¡¨ä¸Šä¸¤å±‚æäº¤ï¼ŒåŒç†HEAD</del>n å½“å‰æäº¤çš„ç¬¬nçº§çˆ¶æäº¤</li></ol><h2 id="å·¥ä½œåŒº"><a href="#å·¥ä½œåŒº" class="headerlink" title="å·¥ä½œåŒº"></a>å·¥ä½œåŒº</h2><p>åœ¨å·¥ä½œåŒºè¿›è¡Œä¿®æ”¹ä¹‹åï¼Œå‘ç°ä¸æƒ³è¦äº†å¯ä»¥ä½¿ç”¨<br><code>git checkout -- &lt;æ–‡ä»¶å&gt;</code>æ¥æ’¤å›ä¿®æ”¹<br>ä¸è¿‡ç°åœ¨gitæ–°ç‰ˆæœ¬æ¨èä½¿ç”¨<br><code>git restore &lt;æ–‡ä»¶å&gt;</code> æ¥æ’¤å›ä¿®æ”¹</p><h2 id="æš‚å­˜åŒº"><a href="#æš‚å­˜åŒº" class="headerlink" title="æš‚å­˜åŒº"></a>æš‚å­˜åŒº</h2><p><code>git reset HEAD &lt;æ–‡ä»¶å&gt;</code> ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å¯ä»¥å°†è¿™ä¸ªæ–‡ä»¶æ”¾å›å·¥ä½œåŒºï¼Œä¹‹åå¦‚æœä¸æƒ³è¦äº†å¯ä»¥ç»“åˆå·¥ä½œåŒºçš„å‘½ä»¤æ¥æ’¤å›ä¿®æ”¹</p><h2 id="å·²æäº¤"><a href="#å·²æäº¤" class="headerlink" title="å·²æäº¤"></a>å·²æäº¤</h2><ol><li>æ’¤å›æäº¤ä½†æ˜¯ä¿ç•™ä¿®æ”¹ï¼šä¹Ÿå°±æ˜¯å›åˆ°å·¥ä½œåŒº : <code>git reset --soft HEAD^</code></li><li>æ’¤å›æäº¤å¹¶ä¸”æ’¤å›ä¿®æ”¹ï¼šä¹Ÿå°±æ˜¯å›åˆ°æš‚å­˜åŒºï¼Œ<code>git rest --mixed HEAD^</code>å¯ä»¥ç®€å†™ä¸º <code>git rest HEAD^</code></li><li>æ’¤å›ä¿®æ”¹å¹¶ä¸”ä¸¢å¤±æ‰€æœ‰çš„ä¿®æ”¹ï¼šä¹Ÿå°±æ˜¯å°†å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¿®æ”¹éƒ½ç»™æ’¤å›ï¼š<code>git reset --hard HEAD^</code></li></ol><h2 id="å·²ç»æ¨é€åˆ°è¿œç¨‹ä»“åº“"><a href="#å·²ç»æ¨é€åˆ°è¿œç¨‹ä»“åº“" class="headerlink" title="å·²ç»æ¨é€åˆ°è¿œç¨‹ä»“åº“"></a>å·²ç»æ¨é€åˆ°è¿œç¨‹ä»“åº“</h2><p>å½“ä½ åˆ°è¾¾è¿™ä¸€æ­¥çš„æ—¶å€™ï¼Œä½ è‚¯å®šå·²ç»æ…Œäº†ï¼Œç»©æ•ˆå¥–å¤šåŠæ˜¯æ²¡äº†ï¼ˆï¼›Â´Ğ´ï½€ï¼‰ã‚<br><code>git revert HEAD</code><br>ä½¿ç”¨è¿™ä¸ªå¯ä»¥å°†ä½ ä¿®æ”¹çš„ä¸œè¥¿æ’¤å›ï¼Œç„¶åä½ å°†è¿™ä¸ªæ–°çš„æäº¤ä¸Šå»å°±èƒ½å¤Ÿè¦†ç›–æ‰ä½ åŸæ¥çš„æäº¤äº†ï¼Œä½†æ˜¯ä½ åŸæ¥çš„é‚£ä¸ªæäº¤è¿˜æ˜¯åœ¨è®°å½•ä¸­çš„ï¼Œä»ç„¶å¯ä»¥è®¿é—®çš„ã€‚</p><h1 id="gitå¼€å‘æ³¨æ„"><a href="#gitå¼€å‘æ³¨æ„" class="headerlink" title="gitå¼€å‘æ³¨æ„"></a>gitå¼€å‘æ³¨æ„</h1><h2 id="å¦‚ä½•è¿›å»github"><a href="#å¦‚ä½•è¿›å»github" class="headerlink" title="å¦‚ä½•è¿›å»github"></a>å¦‚ä½•è¿›å»github</h2><p>ç”±äºä¸å¯æŠ—åŠ›ï¼Œgithubéœ€è¦ä¸€äº›é­”æ³•æ‰èƒ½è¿›å»ã€‚ä¸è¿‡å·¥ä½œå®¤ç›®å‰ä½¿ç”¨çš„æ˜¯å·¥ä½œå®¤æœåŠ¡å™¨ä¸Šæ­å»ºçš„giteaè¿›è¡Œä»£ç çš„ç®¡ç†ï¼Œæ“ä½œå’Œgithubä¸ŠåŸºæœ¬ä¸€è‡´ã€‚ä½†æ˜¯ä»“åº“ç›®å‰ç”±äºå­¦æ ¡é”ipï¼Œå¿…é¡»ä½¿ç”¨æ ¡å›­ç½‘æ‰èƒ½è¿›å»ï¼Œæ‰€ä»¥å½“æˆå‘˜ä¸åœ¨æ ¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨githubæ¥è¿›è¡Œå¼€å‘ã€‚</p><h2 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h2><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="å¦‚ä½•æäº¤ä»£ç "><a href="#å¦‚ä½•æäº¤ä»£ç " class="headerlink" title="å¦‚ä½•æäº¤ä»£ç "></a>å¦‚ä½•æäº¤ä»£ç </h3><ol><li>åœ¨ä»“åº“ä¸Šä¸­å»ºç«‹ä¸€ä¸ªä½ è‹±æ–‡åå­—çš„åˆ†æ”¯æˆ–è€…forkedä¸€ä¸ªåˆ°è‡ªå·±ä»“åº“ä¸­(å·¥ä½œå®¤ä¸€èˆ¬é‡‡ç”¨ç¬¬ä¸€ç§)</li><li>æœ¬åœ°æ‰“å¼€terminalï¼Œè¾“å…¥<code>git push origin ä½ è¦æäº¤çš„æœ¬åœ°åˆ†æ”¯:ä½ è¦æäº¤åˆ°çš„è¿œç¨‹åˆ†æ”¯åå­—</code>ï¼Œç¤ºä¾‹ï¼š<code>git push origin main:huangzhenwei</code> </li><li>ç‚¹å¼€ä»“åº“ï¼Œæ‰¾åˆ°Pull Request (pr)</li></ol>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Github </tag>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVMå­¦ä¹ </title>
      <link href="/2024/06/24/02/"/>
      <url>/2024/06/24/02/</url>
      
        <content type="html"><![CDATA[<h1 id="é¢è¯•å¸¸é—®"><a href="#é¢è¯•å¸¸é—®" class="headerlink" title="é¢è¯•å¸¸é—®"></a>é¢è¯•å¸¸é—®</h1><p>[é»‘é©¬JVMé¢è¯•](<a href="https://lisxpq12rl7.feishu.cn/wiki/QkOzwr3gIiv8eTkKngTc6Lv6nlf">â€Œâ â€‹â€‹â€â€‹â€ï»¿â€‹ï»¿â€Œâ€‹â€‹â€‹â€‹â€‹â â€‹â€Œï»¿â€‹â€Œâ€Œâ€‹â€â€‹â€‹â€‹ï»¿â€‹â€‹â â€‹â€¬â€â€‹ï»¿â€‹ï»¿â€‹â€‹â€â€‹â€â€‹â€‹â€Œâ€Œâ€‹â€¬é¢è¯•ç¯‡ - é£ä¹¦äº‘æ–‡æ¡£ (feishu.cn)</a>)<br><a href="https://www.yuque.com/tulingzhouyu/db22bv/td5a84ty4vel22ge#f8eDZ">ğŸ‘Javaè™šæ‹Ÿæœº8-11åŒç‰ˆæœ¬ -JVMé«˜é¢‘é¢è¯•é¢˜ğŸ‘ (yuque.com)</a></p><h2 id="newçš„è¿‡ç¨‹-x2F-åˆ›å»ºå¯¹è±¡çš„æ­¥éª¤"><a href="#newçš„è¿‡ç¨‹-x2F-åˆ›å»ºå¯¹è±¡çš„æ­¥éª¤" class="headerlink" title="newçš„è¿‡ç¨‹/åˆ›å»ºå¯¹è±¡çš„æ­¥éª¤"></a>newçš„è¿‡ç¨‹/åˆ›å»ºå¯¹è±¡çš„æ­¥éª¤</h2><ol><li>ç±»åŠ è½½æ£€æŸ¥ï¼Œå…ˆå»æ£€æŸ¥æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨æ¥åˆ¤æ–­æ˜¯å¦å·²ç»åˆ›å»ºäº†</li><li>åˆ†é…å†…å­˜(æŒ‡é’ˆç¢°æ’ï¼Œç©ºé—²åˆ—è¡¨)</li><li>åˆå§‹åŒ–é›¶å€¼</li><li>è®¾ç½®å¯¹è±¡å¤´ï¼š</li><li>æ‰§è¡Œinitæ–¹æ³•</li></ol><h2 id="é™æ€å˜é‡å­˜å‚¨åœ¨å“ªé‡Œå‘¢ï¼Ÿ"><a href="#é™æ€å˜é‡å­˜å‚¨åœ¨å“ªé‡Œå‘¢ï¼Ÿ" class="headerlink" title="é™æ€å˜é‡å­˜å‚¨åœ¨å“ªé‡Œå‘¢ï¼Ÿ"></a>é™æ€å˜é‡å­˜å‚¨åœ¨å“ªé‡Œå‘¢ï¼Ÿ</h2><ul><li>JDK6åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œé™æ€å˜é‡æ˜¯å­˜æ”¾åœ¨æ–¹æ³•åŒºä¸­çš„ï¼Œä¹Ÿå°±æ˜¯æ°¸ä¹…ä»£ã€‚</li><li>JDK7åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œé™æ€å˜é‡æ˜¯å­˜æ”¾åœ¨å †ä¸­çš„Classå¯¹è±¡ä¸­ï¼Œè„±ç¦»äº†æ°¸ä¹…ä»£ã€‚</li></ul><h2 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h2><p><img src="/2024/06/24/02/JVM%E7%BB%84%E6%88%90.png" alt="|525"></p><ul><li><del>ç¼–è¯‘å™¨</del>ï¼šä¸å±äºJavaè™šæ‹Ÿæœºçš„ä¸€éƒ¨åˆ†ï¼Œè´Ÿè´£å°†æºä»£ç æ–‡ä»¶ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ã€‚</li><li>ç±»åŠ è½½å­ç³»ç»Ÿï¼Œè´Ÿè´£å°†å­—èŠ‚ç æ–‡ä»¶è¯»å–ã€è§£æå¹¶ä¿å­˜åˆ°å†…å­˜ä¸­ã€‚å…¶æ ¸å¿ƒå°±æ˜¯ç±»åŠ è½½å™¨ã€‚</li><li>è¿è¡Œæ—¶æ•°æ®åŒºï¼Œç®¡ç†JVMä½¿ç”¨åˆ°çš„å†…å­˜ã€‚</li><li>æ‰§è¡Œå¼•ç”¨ï¼Œåˆ†ä¸ºè§£é‡Šå™¨ è§£é‡Šæ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤ï¼›å³æ—¶ç¼–è¯‘å™¨ ä¼˜åŒ–ä»£ç æ‰§è¡Œæ€§èƒ½ï¼› åƒåœ¾å›æ”¶å™¨ å°†ä¸å†ä½¿ç”¨çš„å¯¹è±¡è¿›è¡Œå›æ”¶ã€‚</li><li>æœ¬åœ°æ¥å£ï¼Œä¿å­˜äº†æœ¬åœ°å·²ç»ç¼–è¯‘å¥½çš„æ–¹æ³•ï¼Œä½¿ç”¨C/C++è¯­è¨€å®ç°ã€‚</li></ul><h2 id="è¿è¡Œæ—¶æ•°æ®åŒºçš„ç»„æˆ"><a href="#è¿è¡Œæ—¶æ•°æ®åŒºçš„ç»„æˆ" class="headerlink" title="è¿è¡Œæ—¶æ•°æ®åŒºçš„ç»„æˆ"></a>è¿è¡Œæ—¶æ•°æ®åŒºçš„ç»„æˆ</h2><p><img src="/2024/06/24/02/%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E7%9A%84%E7%BB%84%E6%88%90.png" alt="|900"></p><ul><li>å †ï¼Œå¯åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œæ–°ç”Ÿä»£å¯åˆ†ä¸ºEdenï¼ŒSurviver1ï¼ŒSurviver2</li><li>æ–¹æ³•åŒºï¼šæ°¸ä¹…åŒºï¼Œå­˜å‚¨å·²ç»è¢«Javaè™šæ‹Ÿæœºæ¶å­å•Šçš„ç±»ä¿¡æ¯ç­‰ï¼Œjdk1.8ä¹‹åç§°ä¸ºå…ƒç©ºé—´ã€‚</li><li>è™šæ‹Ÿæœºæ ˆï¼šçº¿ç¨‹ç§æœ‰ï¼Œå†…æœ‰å¤šä¸ªæ ˆå¸§ï¼Œæ–¹æ³•åœ¨æ‰§è¡Œæ—¶ä¼šåˆ›å»ºæ ˆå¸§ï¼ŒåŒ…å«(å±€éƒ¨å˜é‡è¡¨ï¼Œæ“ä½œæ•°æ ˆï¼ŒåŠ¨æ€é“¾æ¥ï¼Œè¿”å›åœ°å€ç­‰)<ul><li>å±€éƒ¨å˜é‡è¡¨ï¼šå­˜æ”¾æ–¹æ³•å‚æ•°ï¼Œå±€éƒ¨å˜é‡</li><li>æ“ä½œæ•°æ ˆï¼šè®°å½•ä¸€ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå­—èŠ‚ç æŒ‡ä»¤å‘æ“ä½œæ•°æ ˆè¿›è¡Œå…¥æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ã€‚</li><li>åŠ¨æ€é“¾æ¥ï¼šå­—èŠ‚ç ä¸­çš„ç¬¦å·é“¾æ¥ï¼Œä¸€éƒ¨åˆ†åœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨(é™æ€è§£æ)ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†åœ¨è¿è¡Œæ—¶è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯åŠ¨æ€é“¾æ¥ã€‚</li><li>è¿”å›åœ°å€ï¼šå½“å‰æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“å‰æ–¹æ³•éœ€è¦è¿”å›çš„ä½ç½®ã€‚</li></ul></li><li>æœ¬åœ°æ–¹æ³•æ ˆï¼šæœåŠ¡çš„æ˜¯Nativeæ–¹æ³•</li><li>PCç¨‹åºè®¡æ•°å™¨ï¼šçº¿ç¨‹ç§æœ‰</li></ul><h2 id="Javaè™šæ‹Ÿæœºæ ˆ"><a href="#Javaè™šæ‹Ÿæœºæ ˆ" class="headerlink" title="Javaè™šæ‹Ÿæœºæ ˆ"></a>Javaè™šæ‹Ÿæœºæ ˆ</h2><p>æ¯ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨ä½¿ç”¨ä¸€ä¸ªæ ˆå¸§æ¥ä¿å­˜ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„è™šæ‹Ÿæœºæ ˆï¼Œç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ç›¸åŒ<br>ä¸»è¦åŒ…æ‹¬</p><ol><li>å±€éƒ¨å˜é‡è¡¨ï¼šæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­å­˜æ”¾æ‰€æœ‰çš„å±€éƒ¨å˜é‡</li><li>æ“ä½œæ•°æ ˆï¼šè™šæ‹Ÿæœºåœ¨æ‰§è¡ŒæŒ‡ä»¤è¿‡ç¨‹ä¸­ç”¨æ¥å­˜æ”¾ä¸´æ—¶æ•°æ®çš„ä¸€å—åŒºåŸŸ</li><li>å¸§æ•°æ®ï¼šä¸»è¦åŒ…æ‹¬åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ã€å¼‚å¸¸è¡¨ç­‰å†…å®¹ã€‚</li></ol><h2 id="æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆ"></a>æœ¬åœ°æ–¹æ³•æ ˆ</h2><p>å­˜å‚¨çš„æ˜¯nativeæœ¬åœ°æ–¹æ³•çš„æ ˆ<br>æœ¬åœ°æ–¹æ³•ï¼ˆNative Methodï¼‰æ˜¯ä½¿ç”¨é Java è¯­è¨€ï¼ˆé€šå¸¸æ˜¯ C æˆ– C++ï¼‰ç¼–å†™çš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•é€šè¿‡ Java æœ¬åœ°æ¥å£ï¼ˆJava Native Interfaceï¼ŒJNIï¼‰ä¸ Java ä»£ç è¿›è¡Œäº¤äº’ã€‚ä½¿ç”¨æœ¬åœ°æ–¹æ³•çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å®ç°ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ï¼š</p><ol><li><strong>ä¸æ“ä½œç³»ç»Ÿäº¤äº’</strong>ï¼šç›´æ¥è°ƒç”¨æ“ä½œç³»ç»Ÿçš„åº•å±‚åŠŸèƒ½ã€‚</li><li><strong>æé«˜æ€§èƒ½</strong>ï¼šåœ¨æ€§èƒ½å…³é”®çš„éƒ¨åˆ†ä½¿ç”¨æ›´é«˜æ•ˆçš„æœ¬åœ°ä»£ç ã€‚</li><li><strong>è®¿é—®ç¡¬ä»¶</strong>ï¼šä¸ç‰¹å®šç¡¬ä»¶è®¾å¤‡è¿›è¡Œäº¤äº’ã€‚</li><li><strong>å¤ç”¨ç°æœ‰åº“</strong>ï¼šè°ƒç”¨å·²æœ‰çš„ç”¨å…¶ä»–è¯­è¨€ç¼–å†™çš„åº“ã€‚</li></ol><h2 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h2><p>ç”¨æ¥å­˜æ”¾åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ï¼Œæ ˆä¸Šçš„å±€éƒ¨å˜é‡è¡¨ä¸­ï¼Œå¯ä»¥å­˜æ”¾å¯¹ä¸Šçš„å¼•ç”¨ï¼Œé™æ€å˜é‡ä¹Ÿå¯ä»¥å­˜æ”¾å †å¯¹è±¡çš„å¼•ç”¨ï¼Œå®ç°å¯¹è±¡åœ¨çº¿ç¨‹ä¹‹é—´çš„å…±äº«<br>å †æ˜¯åƒåœ¾å›æ”¶çš„æœ€ä¸»è¦éƒ¨åˆ†</p><h3 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h3><p>ClassLoaderæ˜¯Javaè™šæ‹Ÿæœºæä¾›ç»™åº”ç”¨ç¨‹åºå»å®ç°è·å–ç±»å’Œæ¥å£å­—èŠ‚ç æ•°æ®çš„æŠ€æœ¯ã€‚å»è·å¾—äºŒè¿›åˆ¶å­—èŠ‚ç ä¿¡æ¯ã€‚ç„¶åé€šè¿‡JVMè°ƒç”¨JNIä¹Ÿå°±æ˜¯æœ¬åœ°æ¥å£æ–¹æ³•åŒºåˆ›å»ºå¯¹è±¡<br><img src="/2024/06/24/02/%E4%B8%8D%E5%90%8C%E7%89%88%E6%9C%AC%E7%9A%84%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8.png"></p><h4 id="ç±»åŠ è½½å™¨çš„åˆ†ç±»"><a href="#ç±»åŠ è½½å™¨çš„åˆ†ç±»" class="headerlink" title="ç±»åŠ è½½å™¨çš„åˆ†ç±»"></a>ç±»åŠ è½½å™¨çš„åˆ†ç±»</h4><h5 id="jdk8ä»¥åŠä¹‹å‰"><a href="#jdk8ä»¥åŠä¹‹å‰" class="headerlink" title="jdk8ä»¥åŠä¹‹å‰"></a>jdk8ä»¥åŠä¹‹å‰</h5><ol><li>Javaä»£ç å®ç°çš„(æ‰©å±•ç±»åŠ è½½å™¨ï¼Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨)</li><li>Javaè™šæ‹Ÿæœºåº•å±‚ä»£ç å®ç°çš„(å¯åŠ¨ç±»åŠ è½½å™¨)<br>ä½¿ç”¨å¯åŠ¨åŠ è½½ç±»å™¨åŠ è½½å™¨å»åŠ è½½ç”¨æˆ·çš„jaråŒ…ï¼Œå¯ä»¥åœ¨è™šæ‹Ÿæœºå‚æ•°é‚£é‡Œæ·»åŠ ï¼š<br><code>-Xbootclasspath /a: jaråŒ…å</code><br>Javaä¸­çš„åŠ è½½å™¨ï¼š æ˜¯ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œç»§æ‰¿è‡ªURLClassLoaderï¼Œé€šè¿‡ç›®å½•æˆ–è€…æŒ‡å®šjaråŒ…å°†å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­<br><img src="/2024/06/24/02/Java%E4%B8%AD%E7%9A%84%E9%BB%98%E8%AE%A4%E5%8A%A0%E8%BD%BD%E5%99%A8.png"></li></ol><h5 id="åŒäº²å§”æ´¾æœºåˆ¶-jdk8ä»¥åŠä¹‹å‰é‡ç‚¹"><a href="#åŒäº²å§”æ´¾æœºåˆ¶-jdk8ä»¥åŠä¹‹å‰é‡ç‚¹" class="headerlink" title="åŒäº²å§”æ´¾æœºåˆ¶(jdk8ä»¥åŠä¹‹å‰é‡ç‚¹)"></a>åŒäº²å§”æ´¾æœºåˆ¶(jdk8ä»¥åŠä¹‹å‰é‡ç‚¹)</h5><p>å¯ä»¥è§£å†³çš„é—®é¢˜:<br>é‡å¤çš„ç±»ï¼šå¯åŠ¨ç±»ï¼Œæ ¹æ®åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå¦‚æœåŒä¸€ä¸ªç±»å‡ºç°åœ¨ä¸‰ä¸ªç±»åŠ è½½å™¨ä¸­ï¼Œä¼šç”±å¯åŠ¨ç±»åŠ è½½å™¨æ¥åŠ è½½ã€‚<br>Stringç±»èƒ½è¦†ç›–å—ï¼Ÿ ä¸èƒ½ï¼Œä¼šç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½åœ¨rt.jaråŒ…ä¸­çš„Stringç±»<br>ç±»åŠ è½½å™¨çš„å…³ç³»ï¼šåº”ç”¨ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨è¯†æ‰©å±•ç±»åŠ è½½å™¨ï¼Œæ‰©å±•ç±»åŠ è½½å™¨æ²¡æœ‰çˆ¶ç±»åŠ è½½å™¨ï¼Œä½†æ˜¯ä¼šå§”æ´¾ç»™å¯åŠ¨ç±»åŠ è½½å™¨ã€‚<br>åŒäº²å§”æ´¾æœºåˆ¶çš„ä½œç”¨ï¼š<br>ä¿è¯ç±»åŠ è½½å™¨çš„å®‰å…¨æ€§ï¼Œé¿å…é‡å¤åŠ è½½ã€‚</p><ol><li>æ¯ä¸€ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»åŠ è½½å™¨ï¼Œåœ¨ç±»åŠ è½½çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªåŠ è½½å™¨ä¼šå…ˆæ£€æŸ¥æ˜¯å¦å·²ç»åŠ è½½äº†è¯¥ç±»ï¼Œå¦‚æœå·²ç»åŠ è½½åˆ™ç›´æ¥è¿”å›å¦åˆ™å¥–å°†è½½è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨</li><li>å¦‚æœæ‰€æœ‰çš„çˆ¶ç±»åŠ è½½å™¨éƒ½æ— æ³•åŠ è½½ï¼Œå°±ç”±å½“å‰åŠ è½½å™¨å°è¯•åŠ è½½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨çš„åŠ è½½è·¯å¾„ä¸­æ²¡æœ‰è¿™ä¸ªç±»ï¼Œå°±ä¼šç”±ä»–è‡ªå·±åŠ è½½ <img src="/2024/06/24/02/%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE.png"><img src="/2024/06/24/02/%E4%B8%8A%E4%B8%8B%E5%A7%94%E6%B4%BE.png"></li></ol><h5 id="å¦‚ä½•æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶"><a href="#å¦‚ä½•æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="å¦‚ä½•æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶"></a>å¦‚ä½•æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶</h5><ol><li>è‡ªå®šä¹‰ç±»åŠ è½½å™¨å¹¶ä¸”é‡å†™loadClassæ–¹æ³•å°±å¯ä»¥å°†åŒäº²å§”æ´¾æœºåˆ¶çš„ä»£ç å»é™¤ã€‚Tomcaté€šè¿‡è¿™ç§æ–¹å¼å®ç°åº”ç”¨ä¹‹é—´ç±»éš”ç¦»ï¼Œæ¯ä¸€ä¸ªåº”ç”¨ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åŠ è½½å™¨åŠ è½½å¯¹åº”çš„ç±»</li><li>çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨åŠ è½½ç±»ï¼Œæ¯”å¦‚JDBCå’ŒJNDIç­‰,JDBCä½¿ç”¨DriverManageræ¥ç®¡ç†é¡¹ç›®ä¸­å¼•å…¥çš„ä¸åŒçš„æ•°æ®åº“é©±åŠ¨ï¼ŒDriverManagerç±»ä½äºrt.jaråŒ…ä¸­ï¼Œç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ã€‚ä¾èµ–ä¸­çš„mysqlé©±åŠ¨å¯¹åº”çš„ç±»ï¼Œç”±åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨æ¥åŠ è½½ï¼ŒDriverManagerå±äºrt.jaræ˜¯å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ã€‚è€Œç”¨æˆ·jaråŒ…ä¸­çš„é©±åŠ¨éœ€è¦ç”±åº”ç”¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œè¿™å°±è¿åäº†åŒäº²å§”æ´¾æœºåˆ¶ã€‚<img src="/2024/06/24/02/JDBC.png">å®šä¹‰æœåŠ¡æ¥å£ï¼šJDBCå®šä¹‰äº†java.sql.Driveræ¥å£ã€‚<br>æœåŠ¡æä¾›è€…ï¼šå„ä¸ªæ•°æ®åº“å‚å•†å®ç°java.sql.Driveræ¥å£ï¼Œå¹¶åœ¨META-INF/servicesç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶java.sql.Driverï¼Œæ–‡ä»¶å†…å®¹ä¸ºå®ç°ç±»çš„å…¨é™å®šåã€‚<br>åŠ è½½é©±åŠ¨ï¼šDriverManagerç±»åœ¨é™æ€ä»£ç å—ä¸­é€šè¿‡ServiceLoaderåŠ è½½æ‰€æœ‰å®ç°java.sql.Driveræ¥å£çš„ç±»ï¼Œå¹¶è°ƒç”¨Class.forNameæ–¹æ³•åŠ è½½é©±åŠ¨ç±»ã€‚<blockquote><p>å®šä¹‰æœåŠ¡æ¥å£ï¼šJDBCå®šä¹‰äº†java.sql.Driveræ¥å£ã€‚<br>æœåŠ¡æä¾›è€…ï¼šå„ä¸ªæ•°æ®åº“å‚å•†å®ç°java.sql.Driveræ¥å£ï¼Œå¹¶åœ¨META-INF/servicesç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶java.sql.Driverï¼Œæ–‡ä»¶å†…å®¹ä¸ºå®ç°ç±»çš„å…¨é™å®šåã€‚<br>åŠ è½½é©±åŠ¨ï¼šDriverManagerç±»åœ¨é™æ€ä»£ç å—ä¸­é€šè¿‡ServiceLoaderåŠ è½½æ‰€æœ‰å®ç°java.sql.Driveræ¥å£çš„ç±»ï¼Œå¹¶è°ƒç”¨Class.forNameæ–¹æ³•åŠ è½½é©±åŠ¨ç±»</p></blockquote></li><li>Osgiæ¡†æ¶çš„ç±»åŠ è½½å™¨ï¼Œå…è®¸åŒçº§ä¹‹é—´å§”æ‰˜è¿›è¡Œç±»çš„åŠ è½½<br>è‡ªå®šä¹‰ç±»åŠ è½½å™¨çˆ¶ç±»æ€ä¹ˆæ˜¯AppClassLoaderå‘¢ï¼Ÿ<br><img src="/2024/06/24/02/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8A%A0%E8%BD%BD%E5%99%A8%E7%9A%84%E7%88%B6%E7%B1%BB.png"></li></ol><h5 id="JDK9ä¹‹åçš„ç±»åŠ è½½å™¨"><a href="#JDK9ä¹‹åçš„ç±»åŠ è½½å™¨" class="headerlink" title="JDK9ä¹‹åçš„ç±»åŠ è½½å™¨"></a>JDK9ä¹‹åçš„ç±»åŠ è½½å™¨</h5><p><strong>ä¸ºä»€ä¹ˆæŠ›å¼ƒäº†æ‹“å±•ç±»åŠ è½½å™¨</strong> ï¼Ÿ<br>å› ä¸ºæ‰©å±•ç±»åŠ è½½å™¨ä¸»è¦æ˜¯å’ŒåŠ è½½jreç¯å¢ƒä¸‹libä¸‹çš„jaråŒ…ï¼Œéœ€è¦æ‹“å±•Javaçš„åŠŸèƒ½æ—¶ï¼Œéœ€è¦æŠŠjaråŒ…èƒ½å¤Ÿåœ¨extæ–‡ä»¶å¤¹ä¸‹ï¼Œä¸å®‰å…¨<br>JDK9å¼•å…¥çš„æ¨¡å—åŒ–å¼€å‘å–ä»£äº†ä»–</p><ol><li>å¯åŠ¨ç±»åŠ è½½å™¨ä½¿ç”¨Javaç¼–å†™ï¼Œä½äºjdk.internal.loader.ClassLoadersç±»ä¸­ã€‚Javaä¸­çš„BootClassLoaderç»§æ‰¿è‡ªBuiltinClassLoaderå®ç°ä»æ¨¡å—ä¸­æ‰¾åˆ°è¦åŠ è½½çš„å­—èŠ‚ç èµ„æºæ–‡ä»¶ã€‚ä½†æ˜¯è¿˜æ˜¯æ— æ³•è·å–åˆ°</li><li>æ‰©å±•ç±»åŠ è½½å™¨è¢«æ›¿æ¢æˆäº†å¹³å°ç±»åŠ è½½å™¨ï¼Œæ‰€ä»¥ç»§æ‰¿å…³ç³»ä»URLClassLoaderå˜æˆäº†BuiltinClassLoaderï¼ŒBuiltinClassLoaderå®ç°äº†ä»æ¨¡å—ä¸­åŠ è½½å­—èŠ‚ç æ–‡ä»¶ã€‚å¹³å°ç±»åŠ è½½å™¨çš„å­˜åœ¨æ›´å¤šçš„æ˜¯ä¸ºäº†ä¸è€ç‰ˆæœ¬çš„è®¾è®¡æ–¹æ¡ˆå…¼å®¹ï¼Œè‡ªèº«æ²¡æœ‰ç‰¹æ®Šçš„é€»è¾‘</li></ol><h5 id="åŒäº²å§”æ´¾æœºåˆ¶æ€»ç»“"><a href="#åŒäº²å§”æ´¾æœºåˆ¶æ€»ç»“" class="headerlink" title="åŒäº²å§”æ´¾æœºåˆ¶æ€»ç»“"></a>åŒäº²å§”æ´¾æœºåˆ¶æ€»ç»“</h5><p><img src="/2024/06/24/02/%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6%E6%80%BB%E7%BB%93.png" alt="|500"></p><h4 id="ç±»çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#ç±»çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç±»çš„ç”Ÿå‘½å‘¨æœŸ"></a>ç±»çš„ç”Ÿå‘½å‘¨æœŸ</h4><h5 id="åŠ è½½"><a href="#åŠ è½½" class="headerlink" title="åŠ è½½"></a>åŠ è½½</h5><p>ç®€å•æ¦‚æ‹¬ï¼šæ‰¾åˆ°éœ€è¦åŠ è½½çš„ç±»ï¼Œå¹¶æŠŠç±»çš„ä¿¡æ¯åŠ è½½åˆ°JVMä¸­ï¼Œç„¶ååœ¨å †ä¸­å®ä¾‹åŒ–ä¸€ä¸ªjava.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºä¸­çš„è¿™ä¸ªç±»çš„ä¿¡æ¯çš„å…¥å£</p><ol><li>åŠ è½½è¿‡ç¨‹ä¸­æ˜¯ç±»åŠ è½½å™¨æ ¹æ®ç±»çš„å…¨é™å®šåé€šè¿‡ä¸åŒçš„æ¸ é“ä»¥äºŒè¿›åˆ¶æµçš„å½¢å¼è·å–å­—èŠ‚ç ä¿¡æ¯</li><li>åŠ è½½å™¨åŠ è½½å®Œç±»ä¹‹åï¼ŒJavaè™šæ‹Ÿæœºå°†å­—èŠ‚ç ä¸­çš„ä¿¡æ¯ä¿å­˜åˆ°æ–¹æ³•åŒºä¸­ï¼Œç”Ÿæˆä¸€ä¸ªInstanceKlasså¯¹è±¡ï¼Œä¿å­˜ç±»çš„æ‰€æœ‰ä¿¡æ¯ï¼Œé‡Œé¢è¿˜åŒ…å«å®ç°ç‰¹å®šåŠŸèƒ½æ¯”å¦‚å¤šæ€çš„ä¿¡æ¯</li><li>Javaè™šæ‹Ÿæœºåœ¨å †ä¸­ç”Ÿæˆä¸€ä»½ä¸æ–¹æ³•å»ä¸­æ•°æ®ç±»ä¼¼çš„java.lang.Classå¯¹è±¡ï¼Œä½œç”¨æ˜¯åœ¨Javaä»£ç ä¸­è·å–ç±»çš„ä¿¡æ¯å’Œå­˜å‚¨é™æ€å­—æ®µçš„æ•°æ®ï¼Œjkd8ä»¥åå°†é™æ€å­—æ®µæ”¾åœ¨å †åŒºä¸­ã€‚ ä¼˜ç‚¹æ˜¯ï¼šå¯¹äºå¼€å‘è€…æ¥è¯´åªéœ€è¦è®¿é—®å †ä¸­çš„Classå¯¹è±¡è€Œä¸éœ€è¦è®¿é—®æ–¹æ³•åŒºä¸­çš„æ‰€æœ‰ä¿¡æ¯ï¼Œèƒ½å¤Ÿå¾ˆå¥½çš„æ§åˆ¶å¼€å‘è€…è®¿é—®æ•°æ®çš„èŒƒå›´</li></ol><h5 id="è¿æ¥"><a href="#è¿æ¥" class="headerlink" title="è¿æ¥"></a>è¿æ¥</h5><ol><li>éªŒè¯ï¼Œæ ¡éªŒJavaå­—èŠ‚ç æ–‡ä»¶æ˜¯éƒ½éµå¾ªäº†çº¦æŸï¼Œä¸€èˆ¬ä¸éœ€è¦ç¨‹åºå‘˜å‚ä¸</li><li>ä¸ºé™æ€å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®åˆå§‹å€¼ï¼Œå¦‚æœä½¿ç”¨äº†finalæ¥ä¿®é¥°ï¼Œå°±ä¼šç›´æ¥å°†ä»£ç ä¸­çš„å€¼èµ‹ç»™é™æ€å˜é‡</li><li>è§£æï¼Œå°†ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œç¬¦å·å¼•ç”¨æ˜¯åœ¨å­—èŠ‚ç ä¸­ä½¿ç”¨åºå·æ¥è¿›è¡Œå¼•ç”¨ï¼Œè€Œç›´æ¥å¼•ç”¨å°±æ˜¯ä½¿ç”¨å†…å­˜ä¸­çš„åœ°å€ç›´æ¥è¿›è¡Œè®¿é—®</li></ol><h5 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h5><p>å½“ç±»è¢«ç›´æ¥å¼•ç”¨çš„æ—¶å€™æ‰ä¼šå‡ºå‘ç±»çš„åˆå§‹åŒ–ã€‚ç±»è¢«ç›´æ¥å¼•ç”¨çš„æƒ…å†µæœ‰-&gt;<br>new,è¯»å–æˆ–è®¾ç½®ç±»çš„é™æ€å˜é‡ï¼Œè°ƒç”¨ç±»çš„é™æ€æ–¹æ³•ï¼Œé€šè¿‡åå°„æ¥æ‰§è¡Œå‰ä¸‰ç§ï¼Œåˆå§‹åŒ–å­ç±»æ—¶ä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–ï¼Œæ¥å£å®ç°ç±»åˆå§‹åŒ–æ—¶ï¼Œä¼šå‡ºå‘ç›´æ¥æˆ–é—´æ¥å®ç°çš„æ‰€æœ‰æ¥å£çš„åˆå§‹åŒ–<br>ç±»çš„åˆå§‹åŒ–åªä¼šè¿è¡Œé™æ€éƒ¨åˆ†ï¼Œè€Œä¸”ä¼˜å…ˆçˆ¶ç±»</p><ol><li>æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç ï¼Œä¸ºé™æ€å˜é‡èµ‹å€¼</li><li>åˆå§‹åŒ–é˜¶æ®µä¼šæ‰§è¡Œå­—èŠ‚ç ä¸­clinitéƒ¨åˆ†çš„å­—èŠ‚ç æŒ‡ä»¤</li></ol><h5 id="ç¨‹åºä¸­å¯ä»¥ç›´æ¥å¯¼è‡´åˆå§‹åŒ–çš„æ“ä½œï¼š"><a href="#ç¨‹åºä¸­å¯ä»¥ç›´æ¥å¯¼è‡´åˆå§‹åŒ–çš„æ“ä½œï¼š" class="headerlink" title="ç¨‹åºä¸­å¯ä»¥ç›´æ¥å¯¼è‡´åˆå§‹åŒ–çš„æ“ä½œï¼š"></a>ç¨‹åºä¸­å¯ä»¥ç›´æ¥å¯¼è‡´åˆå§‹åŒ–çš„æ“ä½œï¼š</h5><ol><li>è®¿é—®ä¸€ä¸ªç±»çš„é™æ€å˜é‡æˆ–è€…é™æ€æ–¹æ³•ï¼Œfinalä¿®é¥°çš„å¹¶ä¸”ç­‰å·åœ¨å³ä¾§æ˜¯å¸¸é‡çš„è¯ä¸ä¼šè§¦å‘åˆå§‹åŒ–ï¼Œå› ä¸ºåœ¨è¿æ¥é˜¶æ®µå°±å·²ç»è¿›è¡Œèµ‹å€¼äº†</li><li>è°ƒç”¨Class.forName(String className)æ—¶ä¼šè¿›è¡Œåˆå§‹åŒ–</li><li>new </li><li>æ‰§è¡ŒMainæ–¹æ³•çš„å½“å‰ç±»<br><code>&lt;clinit&gt;</code>æ˜¯Javaä¸­çš„ä¸€ä¸ªç‰¹æ®Šæ–¹æ³•ï¼Œä»£è¡¨åˆå§‹åŒ–å™¨ï¼ˆclass initializerï¼‰ã€‚è¿™ä¸ªæ–¹æ³•ä¸æ˜¯ç”±ç¨‹åºå‘˜æ˜¾å¼ç¼–å†™çš„ï¼Œè€Œæ˜¯ç”±Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰è‡ªåŠ¨ç”Ÿæˆçš„ã€‚å½“ç±»è¢«é¦–æ¬¡åŠ è½½åˆ°JVMæ—¶ï¼Œ<code>&lt;clinit&gt;</code>æ–¹æ³•è´Ÿè´£æ‰§è¡Œç±»å˜é‡çš„é™æ€åˆå§‹åŒ–å’Œé™æ€åˆå§‹åŒ–å—çš„ä»£ç <br><code>clinit</code> åœ¨ä»¥ä¸‹æƒ…å†µä¸ä¼šå‡ºç°ï¼š</li><li>æ— é™æ€ä»£ç å—</li><li>æœ‰é™æ€å˜é‡å£°æ˜ä½†æ˜¯æ²¡æœ‰èµ‹å€¼è¯­å¥</li><li>é™æ€å˜é‡çš„å®šä¹‰ä½¿ç”¨finalå­—æ®µï¼Œä¼šåœ¨å‡†å¤‡é˜¶æ®µç›´æ¥è¿›è¡Œåˆå§‹åŒ–ã€‚<br>è®¿é—®çˆ¶ç±»é™æ€å˜é‡ï¼Œåªä¼šåˆå§‹åŒ–çˆ¶ç±»<br>new å­ç±»æ—¶ä¼šå…ˆæ‰§è¡Œçˆ¶ç±»çš„clinitæ–¹æ³•<br>æ•°ç»„çš„åˆ›å»ºä¸ä¼šå¯¼è‡´æ•°ç»„ä¸­å…ƒç´ çš„ç±»çš„åˆå§‹åŒ–ã€‚<br>finalä¿®é¥°çš„å˜é‡å¦‚æœä¸æ˜¯å¸¸é‡éœ€è¦æ‰§è¡ŒæŒ‡ä»¤æ‰èƒ½å¾—å‡ºç»“æœä¼šæ‰§è¡Œclinitæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–</li></ol><h5 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><h5 id="å¸è½½"><a href="#å¸è½½" class="headerlink" title="å¸è½½"></a>å¸è½½</h5><h4 id="å­—èŠ‚ç æ–‡ä»¶"><a href="#å­—èŠ‚ç æ–‡ä»¶" class="headerlink" title="å­—èŠ‚ç æ–‡ä»¶"></a>å­—èŠ‚ç æ–‡ä»¶</h4><ol><li>å¸¸é‡æ± ï¼šé¿å…ä¿å­˜é‡å¤çš„å†…å®¹ï¼ŒèŠ‚çœç©ºé—´</li><li>å…·ä½“çš„å­—èŠ‚ç æ–‡ä»¶åˆ†æ <img src="/2024/06/24/02/%E5%AD%97%E8%8A%82%E7%A0%81.png"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æºç </span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  i <span class="token operator">=</span> i <span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">//å­—èŠ‚ç </span><span class="token number">0</span> iconst_0  å°†<span class="token number">0</span>æ”¾åœ¨æ“ä½œæ•°æ ˆä¸­<span class="token number">1</span> istore_1 å¼¹å‡ºæ“ä½œæ•°æ ˆæœ€é¡¶å±‚æ•°æ®åˆ°å±€éƒ¨å˜é‡<span class="token number">1</span>å·ä½<span class="token number">2</span> iload_1  å¤åˆ¶åˆ°æ“ä½œæ•°æ ˆé¡¶<span class="token number">3</span> iinc <span class="token number">1</span> by <span class="token number">1</span> å°†å±€éƒ¨å˜é‡<span class="token number">1</span>å·ä½çš„æ•°æ® <span class="token operator">+</span> <span class="token number">1</span><span class="token number">6</span> istore_1 å¼¹å‡ºï¼Œä¿å­˜åœ¨ä¸€å·ä½ï¼Œæ‰€ä»¥è¢«è¦†ç›–äº†<span class="token number">7</span> <span class="token keyword">return</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h5 id="ç»„æˆ-1"><a href="#ç»„æˆ-1" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h5><p>åŸºç¡€ä¿¡æ¯ï¼Œå¸¸é‡æ± (ä¿å­˜å­—ç¬¦ä¸²å¸¸é‡ã€ç±»æˆ–è€…æ¥å£åï¼Œä¸»è¦åœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­ä½¿ç”¨)ï¼Œå­—æ®µï¼Œæ–¹æ³•ï¼Œå±æ€§</p><h3 id="è¿è¡Œæ—¶æ•°æ®åŒº"><a href="#è¿è¡Œæ—¶æ•°æ®åŒº" class="headerlink" title="è¿è¡Œæ—¶æ•°æ®åŒº"></a>è¿è¡Œæ—¶æ•°æ®åŒº</h3><h4 id="æŒ‰ç…§çº¿ç¨‹å…±äº«ä¸å…±äº«åŒºåˆ†ï¼š"><a href="#æŒ‰ç…§çº¿ç¨‹å…±äº«ä¸å…±äº«åŒºåˆ†ï¼š" class="headerlink" title="æŒ‰ç…§çº¿ç¨‹å…±äº«ä¸å…±äº«åŒºåˆ†ï¼š"></a>æŒ‰ç…§çº¿ç¨‹å…±äº«ä¸å…±äº«åŒºåˆ†ï¼š</h4><ul><li>çº¿ç¨‹ä¸å…±äº«<ol><li>ç¨‹åºè®¡æ•°å™¨</li><li>Javaè™šæ‹Ÿæœºæ ˆ</li><li>æœ¬åœ°æ–¹æ³•æ ˆ</li></ol></li><li>çº¿ç¨‹å…±äº«<ol><li>æ–¹æ³•åŒº</li><li>å †</li></ol></li></ul><h5 id="ç¨‹åºè®¡æ•°å™¨"><a href="#ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h5><p>å†…å­˜æº¢å‡ºï¼šç¨‹åºåœ¨ä½¿ç”¨æŸä¸€å—å†…å­˜åŒºåŸŸæ—¶ï¼Œå­˜æ”¾çš„æ•°æ®éœ€è¦å ç”¨çš„å†…å­˜å¤§å°è¶…è¿‡äº†è™šæ‹Ÿæœºèƒ½æä¾›çš„å†…å­˜ä¸Šé™<br>æ¯ä¸ªçº¿ç¨‹åªéœ€è¦å­˜å‚¨ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å†…å­˜åœ°å€ï¼Œæ‰€ä»¥ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸ä¼šå‘ç”Ÿå†…å­˜æº¢å‡ºçš„<br>ç¨‹åºå‘˜æ— éœ€å¯¹ç¨‹åºè®¡æ•°å™¨è¿›è¡Œä»»ä½•å¤„ç†</p><h5 id="è™šæ‹Ÿæœºæ ˆ"><a href="#è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="è™šæ‹Ÿæœºæ ˆ"></a>è™šæ‹Ÿæœºæ ˆ</h5><p>Javaè™šæ‹Ÿæœºä½¿ç”¨æ ˆæ¥ç®¡ç†æ–¹æ³•è°ƒç”¨ä¸­çš„åŸºæœ¬æ•°æ®ã€‚æ¯ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨ä½¿ç”¨ä¸€ä¸ªæ ˆå¸§æ¥ä¿å­˜ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½åŒ…å«ä¸€ä¸ªè‡ªå·±çš„è™šæ‹Ÿæœºæ ˆ<br><img src="/2024/06/24/02/%E6%A0%88%E5%86%85%E5%AD%98.png"></p><h6 id="æ ˆå¸§çš„ç»„æˆ"><a href="#æ ˆå¸§çš„ç»„æˆ" class="headerlink" title="æ ˆå¸§çš„ç»„æˆ"></a>æ ˆå¸§çš„ç»„æˆ</h6><ul><li>å±€éƒ¨å˜é‡è¡¨ï¼šå­˜æ”¾è¿è¡Œä¸­çš„æ‰€æœ‰å±€éƒ¨å˜é‡ï¼ŒåŒ…æ‹¬å±€éƒ¨å˜é‡è¡¨ä¿å­˜çš„å†…å®¹æœ‰ï¼šå®ä¾‹æ–¹æ³•çš„thiså¯¹è±¡ï¼Œæ–¹æ³•çš„å‚æ•°ï¼Œæ–¹æ³•ä½“ä¸­å£°æ˜çš„å±€éƒ¨å˜é‡ã€‚<img src="/2024/06/24/02/%E5%8F%98%E9%87%8F%E8%A1%A8.png"></li><li>æ“ä½œæ•°æ ˆï¼šå­˜æ”¾ä¸´æ—¶æ•°æ®<ul><li>æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸€ä¸ªä½ç½®ç§°ä¹‹ä¸ºæ§½(slot) ï¼Œlongå’Œdoubleç±»å‹å ç”¨ä¸¤ä¸ªæ§½ï¼Œå…¶ä»–ç±»å‹å ç”¨ä¸€ä¸ªæ§½ã€‚</li><li>å®ä¾‹æ–¹æ³•ä¸­çš„åºå·ä¸º0çš„ä½ç½®å­˜æ”¾çš„æ˜¯thisï¼ŒæŒ‡çš„æ˜¯å½“å‰è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡ï¼Œè¿è¡Œæ—¶ä¼šåœ¨å†…å­˜ä¸­å­˜æ”¾å®ä¾‹å¯¹è±¡çš„åœ°å€ã€‚</li><li>ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œå±€éƒ¨å˜é‡è¡¨ä¸­çš„æ§½æ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œä¸€æ—¦æŸä¸ªå±€éƒ¨å˜é‡ä¸å†ç”Ÿæ•ˆï¼Œå½“å‰æ§½å°±å¯ä»¥å†æ¬¡è¢«ä½¿ç”¨ã€‚</li></ul></li><li>å¸§æ•°æ®ï¼šåŒ…å«åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ã€å¼‚å¸¸è¡¨çš„å¼•ç”¨<img src="/2024/06/24/02/%E6%96%B9%E6%B3%95%E5%87%BA%E5%8F%A3.png"></li></ul><h5 id="æœ¬åœ°æ–¹æ³•æ ˆï¼š"><a href="#æœ¬åœ°æ–¹æ³•æ ˆï¼š" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆï¼š"></a>æœ¬åœ°æ–¹æ³•æ ˆï¼š</h5><p>å­˜å‚¨naticeæœ¬åœ°æ–¹æ³•çš„æ ˆå¸§ï¼Œåœ¨Hotspotè™šæ‹Ÿæœºä¸­ï¼ŒJavaè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆå®ç°ä¸Šä½¿ç”¨äº†åŒä¸€ä¸ªæ ˆç©ºé—´ã€‚</p><h5 id="å †å†…å­˜"><a href="#å †å†…å­˜" class="headerlink" title="å †å†…å­˜"></a>å †å†…å­˜</h5><p><img src="/2024/06/24/02/%E6%A0%B9%E6%8D%AE%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%90%86%E8%AE%BA%E5%88%92%E5%88%86%E7%9A%84%E5%A0%86.png"><br>ä¸€èˆ¬Javaç¨‹åºä¸­å †å†…å­˜æ˜¯ç©ºé—´æœ€å¤§çš„ä¸€å—å†…å­˜åŒºåŸŸã€‚åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡éƒ½å­˜åœ¨äºå †ä¸Šã€‚æ ˆä¸Šçš„å±€éƒ¨å˜é‡è¡¨ä¸­ï¼Œå¯ä»¥å­˜æ”¾å †ä¸Šå¯¹è±¡çš„å¼•ç”¨ã€‚é™æ€å˜é‡ä¹Ÿå¯ä»¥å­˜æ”¾å †å¯¹è±¡çš„å¼•ç”¨ï¼Œé€šè¿‡é™æ€å˜é‡å°±å¯ä»¥å®ç°å¯¹è±¡åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«ã€‚<br>å †ç©ºé—´æœ‰ä¸‰ä¸ªéœ€è¦å…³æ³¨çš„å€¼ï¼Œusedã€totalã€maxã€‚usedæŒ‡çš„æ˜¯å½“å‰å·²ä½¿ç”¨çš„å †å†…å­˜ï¼Œtotalæ˜¯javaè™šæ‹Ÿæœºå·²ç»åˆ†é…çš„å¯ç”¨å †å†…å­˜ï¼Œmaxæ˜¯javaè™šæ‹Ÿæœºå¯ä»¥åˆ†é…çš„æœ€å¤§å †å†…å­˜ã€‚<br><strong>ä¸æ˜¯å½“used = max = totalçš„æ—¶å€™ï¼Œå †å†…å­˜å°±æº¢å‡º</strong></p><hr><h5 id="æ–¹æ³•åŒºï¼š"><a href="#æ–¹æ³•åŒºï¼š" class="headerlink" title="æ–¹æ³•åŒºï¼š"></a>æ–¹æ³•åŒºï¼š</h5><p>æ–¹æ³•åŒºå­˜æ”¾åŸºç¡€ä¿¡æ¯çš„ä½ç½®ï¼Œçº¿ç¨‹å…±äº«çš„ï¼Œä¸»è¦åŒ…å«ä¸‰éƒ¨åˆ†ï¼š</p><ul><li>ç±»çš„å…ƒä¿¡æ¯ï¼Œä¿å­˜æ‰€æœ‰ç±»çš„åŸºæœ¬ä¿¡æ¯</li><li>è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œä¿å­˜äº†å­—èŠ‚ç æ–‡ä»¶ä¸­å¸¸é‡æ± å†…å®¹</li><li>å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œä¿å­˜äº†å­—ç¬¦ä¸²å¸¸é‡</li></ul><h6 id="å…ƒä¿¡æ¯"><a href="#å…ƒä¿¡æ¯" class="headerlink" title="å…ƒä¿¡æ¯"></a>å…ƒä¿¡æ¯</h6><p>ä¸€èˆ¬ç§°ä¹‹ä¸ºInstanceKlasså¯¹è±¡ã€‚åœ¨ç±»çš„åŠ è½½é˜¶æ®µå®Œæˆã€‚å…¶ä¸­å°±åŒ…å«äº†ç±»çš„å­—æ®µã€æ–¹æ³•ç­‰å­—èŠ‚ç æ–‡ä»¶ä¸­çš„å†…å®¹ï¼ŒåŒæ—¶è¿˜ä¿å­˜äº†è¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨çš„è™šæ–¹æ³•è¡¨ï¼ˆå®ç°å¤šæ€çš„åŸºç¡€ï¼‰ç­‰ä¿¡æ¯ã€‚</p><h6 id="è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="è¿è¡Œæ—¶å¸¸é‡æ± "></a>è¿è¡Œæ—¶å¸¸é‡æ± </h6><p>å­—èŠ‚ç æ–‡ä»¶ä¸­é€šè¿‡ç¼–å·æŸ¥è¡¨çš„æ–¹å¼æ‰¾åˆ°å¸¸é‡ï¼Œè¿™ç§å¸¸é‡æ± ç§°ä¸ºé™æ€å¸¸é‡æ± ã€‚å½“å¸¸é‡æ± åŠ è½½åˆ°å†…å­˜ä¸­ä¹‹åï¼Œå¯ä»¥é€šè¿‡å†…å­˜åœ°å€å¿«é€Ÿçš„å®šä½åˆ°å¸¸é‡æ± ä¸­çš„å†…å®¹ï¼Œè¿™ç§å¸¸é‡æ± ç§°ä¸ºè¿è¡Œæ—¶å¸¸é‡æ± ã€‚<img src="/2024/06/24/02/%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E5%AE%9E%E7%8E%B0.png"></p><h6 id="å­—ç¬¦ä¸²å¸¸é‡æ± "><a href="#å­—ç¬¦ä¸²å¸¸é‡æ± " class="headerlink" title="å­—ç¬¦ä¸²å¸¸é‡æ± "></a>å­—ç¬¦ä¸²å¸¸é‡æ± </h6><p>å­—ç¬¦ä¸²çš„æ‹¼æ¥æ“ä½œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„ç°æœ‰å¯¹è±¡ã€‚<br>è€Œç›´æ¥ç”¨ä¸¤ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥æ˜¯æ”¾åœ¨å¸¸é‡æ± çš„ï¼Œä¸æ˜¯æ–°å»ºäº†ä¸€ä¸ªå¯¹è±¡</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>ç­”æ¡ˆæ˜¯<span class="token boolean">false</span><span class="token punctuation">,</span>å› ä¸º<span class="token string">"abc"</span>æ˜¯ç›´æ¥æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± çš„ï¼Œè€Œ<span class="token keyword">new</span> å‡ºæ¥çš„æ˜¯æ”¾åœ¨å †å†…å­˜ä¸­ï¼Œä¸¤è€…æ‰€åœ¨çš„ä½ç½®ä¸åŒã€‚<span class="token number">1.</span><span class="token comment">/** * å­—ç¬¦ä¸²å¸¸é‡æ± æ¡ˆä¾‹ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo3</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">String</span> a <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> b <span class="token operator">=</span> <span class="token string">"2"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> c <span class="token operator">=</span> <span class="token string">"12"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> d <span class="token operator">=</span> <span class="token string">"1"</span> <span class="token operator">+</span> <span class="token string">"2"</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c <span class="token operator">==</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>ç­”æ¡ˆæ˜¯<span class="token boolean">true</span><span class="token punctuation">,</span>åœ¨ç¼–è¯‘é˜¶æ®µå°±æŠŠ <span class="token string">"1"</span> <span class="token operator">+</span> <span class="token string">"2"</span>è¿æ¥åœ¨ä¸€èµ·äº†<span class="token number">2.</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">String</span> a <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> b <span class="token operator">=</span> <span class="token string">"2"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> c <span class="token operator">=</span> <span class="token string">"12"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> d <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c <span class="token operator">==</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>ç­”æ¡ˆæ˜¯<span class="token boolean">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>jdk8ä¹‹åè¿è¡Œæ—¶å¸¸é‡æ± æ”¾åœ¨å…ƒç©ºé—´ï¼Œè€Œå­—ç¬¦ä¸²å¸¸é‡æ± è¿˜åœ¨å †ä¸­ã€‚<br><strong>String.intern()æ–¹æ³•æ˜¯å¯ä»¥æ‰‹åŠ¨å°†å­—ç¬¦ä¸²æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­</strong></p><h5 id="ç›´æ¥å†…å­˜"><a href="#ç›´æ¥å†…å­˜" class="headerlink" title="ç›´æ¥å†…å­˜"></a>ç›´æ¥å†…å­˜</h5><p>ç›´æ¥å†…å­˜ä¸å±äºJavaè¿è¡Œæ—¶çš„å†…å­˜åŒºåŸŸï¼ŒNIOæœºåˆ¶ä¸­ä½¿ç”¨ç›´æ¥å†…å­˜æ¥è§£å†³</p><ol><li>Javaå †ä¸­çš„å¯¹è±¡å¦‚æœä¸å†ä½¿ç”¨è¦å›æ”¶ï¼Œå›æ”¶æ—¶ä¼šå½±å“å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨ã€‚</li><li>IOæ“ä½œæ¯”å¦‚è¯»æ–‡ä»¶ï¼Œéœ€è¦å…ˆæŠŠæ–‡ä»¶è¯»å…¥ç›´æ¥å†…å­˜ï¼ˆç¼“å†²åŒºï¼‰å†æŠŠæ•°æ®å¤åˆ¶åˆ°Javaå †ä¸­ã€‚<br>ç°åœ¨ç›´æ¥æ”¾å…¥ç›´æ¥å†…å­˜å³å¯ï¼ŒåŒæ—¶Javaå †ä¸Šç»´æŠ¤ç›´æ¥å†…å­˜çš„å¼•ç”¨ï¼Œå‡å°‘äº†æ•°æ®å¤åˆ¶çš„å¼€é”€ã€‚å†™æ–‡ä»¶ä¹Ÿæ˜¯ç±»ä¼¼çš„æ€è·¯ã€‚<img src="/2024/06/24/02/%E6%96%87%E4%BB%B6%E5%A4%8D%E5%88%B6.png"></li></ol><h3 id="æ‰§è¡Œå¼•æ“"><a href="#æ‰§è¡Œå¼•æ“" class="headerlink" title="æ‰§è¡Œå¼•æ“"></a>æ‰§è¡Œå¼•æ“</h3><h3 id="æœ¬åœ°æ¥å£"><a href="#æœ¬åœ°æ¥å£" class="headerlink" title="æœ¬åœ°æ¥å£"></a>æœ¬åœ°æ¥å£</h3><h3 id="åƒåœ¾æ”¶é›†å™¨GC"><a href="#åƒåœ¾æ”¶é›†å™¨GC" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨GC"></a>åƒåœ¾æ”¶é›†å™¨GC</h3><p>GC (Garbage Collection)ï¼Œå †æ˜¯åƒåœ¾å›æ”¶æœ€ä¸»è¦çš„åŒºåŸŸï¼Œæ‰€ä»¥ä¹Ÿè¢«ä¹˜åGCå †ã€‚<br>å¦‚ä½•æ‰‹åŠ¨è§¦å‘åƒåœ¾å›æ”¶ï¼šä½¿ç”¨<code>System.gc()</code>ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸ä¼šç«‹å³è¿›è¡Œå›æ”¶ï¼Œåªæ˜¯å‘è™šæ‹Ÿæœºå‘é€ä¸€ä¸ªåƒåœ¾å›æ”¶çš„è¯·æ±‚ã€‚</p><h4 id="ä¸ç”±GCè¿›è¡Œå›æ”¶çš„éƒ¨åˆ†"><a href="#ä¸ç”±GCè¿›è¡Œå›æ”¶çš„éƒ¨åˆ†" class="headerlink" title="ä¸ç”±GCè¿›è¡Œå›æ”¶çš„éƒ¨åˆ†"></a>ä¸ç”±GCè¿›è¡Œå›æ”¶çš„éƒ¨åˆ†</h4><p>çº¿ç¨‹ä¸å…±äº«çš„éƒ¨åˆ†ä¸éœ€è¦GCè¿›è¡Œå›æ”¶ï¼Œå› ä¸ºéšç€çº¿ç¨‹çš„é”€æ¯ï¼Œå¯¹åº”çš„æ–¹æ³•çš„æ ˆå¸§å°±ä¼šè‡ªåŠ¨å¼¹å‡ºæ ˆå¹¶ä¸”é‡Šæ”¾æ‰å¯¹åº”çš„å†…å­˜ã€‚</p><h4 id="è¿›è¡Œå›æ”¶çš„éƒ¨åˆ†"><a href="#è¿›è¡Œå›æ”¶çš„éƒ¨åˆ†" class="headerlink" title="è¿›è¡Œå›æ”¶çš„éƒ¨åˆ†"></a>è¿›è¡Œå›æ”¶çš„éƒ¨åˆ†</h4><h5 id="æ–¹æ³•åŒº"><a href="#æ–¹æ³•åŒº" class="headerlink" title="æ–¹æ³•åŒº"></a>æ–¹æ³•åŒº</h5><p>ä¸»è¦å›æ”¶ä¸å†ä½¿ç”¨çš„ç±»ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶</p><ol><li>è¿™ä¸ªç±»æ‰€æœ‰çš„å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ï¼Œåœ¨é˜Ÿä¸­ä¸å­˜åœ¨è¯¥ç±»çš„å®ä¾‹å¯¹è±¡ä»¥åŠå­ç±»å¯¹è±¡</li><li>åŠ è½½è¯¥ç±»çš„ç±»åŠ è½½å™¨å·²ç»è¢«å›æ”¶ï¼Œç±»åŠ è½½å™¨çš„ä»»åŠ¡å®Œæˆä¹‹åå¼•ç”¨è¢«å»é™¤åå°±ä¼šè¢«å›æ”¶</li><li>java.lang.Classå¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨<img src="/2024/06/24/02/Class.png"></li></ol><h5 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h5><p>Javaä¸­çš„å¯¹è±¡èƒ½å¦è¢«å›æ”¶æ˜¯æ ¹æ®å¯¹è±¡æ˜¯å¦è¢«å¼•ç”¨æ¥å†³å®šçš„ã€‚å¦‚æœå¯¹è±¡è¢«å¼•ç”¨å°±ä¸å…è®¸è¢«å›æ”¶<br>ä¸»è¦çš„ç®—æ³•ï¼š</p><h6 id="å¼•ç”¨è®¡æ•°æ³•"><a href="#å¼•ç”¨è®¡æ•°æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°æ³•"></a>å¼•ç”¨è®¡æ•°æ³•</h6><p>ä¸ºæ¯ä¸ªå¯¹è±¡ç»´æŠ¤ä¸€ä¸ªæŒ‡é’ˆï¼Œå¯¹è±¡è¢«å¼•ç”¨æ—¶+1ï¼Œå–æ¶ˆå¼•ç”¨æ—¶-dã€‚<br>ç¼ºç‚¹æ˜¯ï¼š</p><ol><li>æ¯æ¬¡å¼•ç”¨éƒ½è¦ç»´æŠ¤è®¡æ•°å™¨ï¼Œä¼šå½±å“ç³»ç»Ÿçš„æ€§èƒ½</li><li>å­˜åœ¨å¾ªç¯å¼•ç”¨é—®é¢˜ï¼ŒAå¼•ç”¨Bï¼ŒBå¼•ç”¨Aå°±æ— æ³•å›æ”¶äº†</li></ol><h6 id="å¯è¾¾æ€§åˆ†ææ³•"><a href="#å¯è¾¾æ€§åˆ†ææ³•" class="headerlink" title="å¯è¾¾æ€§åˆ†ææ³•"></a>å¯è¾¾æ€§åˆ†ææ³•</h6><p>å¯è¾¾æ€§åˆ†ææ³•å°†å¯¹è±¡åˆ†ä¸ºï¼šåƒåœ¾å›æ”¶çš„æ ¹å¯¹è±¡ (GC Root)å’Œæ™®é€šå¯¹è±¡ï¼Œå¯¹è±¡ä¹‹é—´å­˜åœ¨å¼•ç”¨å…³ç³»ã€‚<br>å¯è¾¾æ€§åˆ†æå°±æ˜¯å¦‚æœæŸä¸ªå¯¹è±¡åˆ°GC Rootæ˜¯å¯è¾¾çš„ï¼Œå°±ä¸èƒ½è¢«å›æ”¶ã€‚<br>å“ªäº›å¯¹è±¡è¢«ç§°ä¹‹ä¸ºGC Rootå¯¹è±¡å‘¢ï¼Ÿ</p><ul><li>çº¿ç¨‹Threadå¯¹è±¡ï¼Œå¼•ç”¨çº¿ç¨‹æ ˆå¸§ä¸­çš„æ–¹æ³•å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰ã€‚</li><li>ç³»ç»Ÿç±»åŠ è½½å™¨åŠ è½½çš„java.lang.Classå¯¹è±¡ï¼Œå¼•ç”¨ç±»ä¸­çš„é™æ€å˜é‡ã€‚<img src="/2024/06/24/02/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%AF%B9%E8%B1%A1.png"></li><li>ç›‘è§†å™¨å¯¹è±¡ï¼Œç”¨æ¥ä¿å­˜åŒæ­¥é”synchronizedå…³é”®å­—æŒæœ‰çš„å¯¹è±¡ã€‚<img src="/2024/06/24/02/%E7%9B%91%E8%A7%86%E5%99%A8%E5%AF%B9%E8%B1%A1.png"></li><li>æœ¬åœ°æ–¹æ³•è°ƒç”¨æ—¶ä½¿ç”¨çš„å…¨å±€å¯¹è±¡ã€‚</li></ul><h4 id="å¸¸è§çš„å¼•ç”¨å¯¹è±¡"><a href="#å¸¸è§çš„å¼•ç”¨å¯¹è±¡" class="headerlink" title="å¸¸è§çš„å¼•ç”¨å¯¹è±¡"></a>å¸¸è§çš„å¼•ç”¨å¯¹è±¡</h4><p>å¯è¾¾æ€§ç®—æ³•ä¸­æè¿°çš„å¯¹è±¡å¼•ç”¨ï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯å¼ºå¼•ç”¨ï¼ŒJavaä¸­è¿˜è®¾è®¡äº†å‡ ç§å…¶ä»–å¼•ç”¨æ–¹å¼ï¼š</p><ul><li>è½¯å¼•ç”¨</li><li>å¼±å¼•ç”¨</li><li>è™šå¼•ç”¨</li><li>ç»ˆç»“å™¨å¼•ç”¨</li></ul><h5 id="è½¯å¼•ç”¨"><a href="#è½¯å¼•ç”¨" class="headerlink" title="è½¯å¼•ç”¨"></a>è½¯å¼•ç”¨</h5><p>å¦‚æœä¸€ä¸ªå¯¹è±¡åªæœ‰è½¯å¼•ç”¨å…³è”åˆ°ä»–æ—¶ï¼Œç¨‹åºå†…å­˜ä¸è¶³æ—¶å›å°†å…¶ä¸­çš„æ•°æ®åŠé€†è¡Œå›æ”¶ï¼Œè½¯å¼•ç”¨å¸¸ç”¨äºç¼“å­˜ä¸­<br>å¥½å¤„å°±æ˜¯ç”¨ä½œç¼“å­˜å¿«é€Ÿä»å†…å­˜ä¸­è¯»å–ï¼Œå³ä½¿è¢«é‡Šæ”¾äº†ä¹Ÿå¯ä»¥é‡æ–°è·å–ï¼Œå‡å°‘å†…å­˜æº¢å‡ºçš„å¯èƒ½æ€§<br>è½¯å¼•ç”¨å¯¹è±¡æœ¬èº«ï¼Œä¹Ÿéœ€è¦è¢«å¼ºå¼•ç”¨ï¼Œå¦åˆ™è½¯å¼•ç”¨å¯¹è±¡ä¹Ÿä¼šè¢«å›æ”¶æ‰ã€‚<br>ä½¿ç”¨æ¡ˆä¾‹ï¼š</p><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">/** * è½¯å¼•ç”¨æ¡ˆä¾‹2 - åŸºæœ¬ä½¿ç”¨ */public class SoftReferenceDemo2 {    public static void main(String[] args) throws IOException {        byte[] bytes = new byte[1024 * 1024 * 100];        SoftReference&lt;byte[]&gt; softReference = new SoftReference&lt;byte[]&gt;(bytes);        bytes = null;        System.out.println(softReference.get());        byte[] bytes2 = new byte[1024 * 1024 * 100];        System.out.println(softReference.get());////        byte[] bytes3 = new byte[1024 * 1024 * 100];//        softReference = null;//        System.gc();////        System.in.read();    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœè½¯å¼•ç”¨å¯¹è±¡ä¸­çš„æ•°æ®å·²ç»è¢«å›æ”¶äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡æœ¬èº«ä¹Ÿå¯ä»¥è¢«å›æ”¶äº†<br>SoftReferenceæä¾›äº†ä¸€å¥—é˜Ÿåˆ—æœºåˆ¶ï¼š</p><ol><li>è½¯å¼•ç”¨åˆ›å»ºæ—¶ï¼Œé€šè¿‡æ„é€ å™¨ä¼ å…¥å¼•ç”¨é˜Ÿåˆ—</li><li>åœ¨è½¯å¼•ç”¨ä¸­åŒ…å«çš„å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œè¯¥è½¯å¼•ç”¨å¯¹è±¡ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—</li><li>é€šè¿‡ä»£ç éå†å¼•ç”¨é˜Ÿåˆ—ï¼Œå°†SoftReferenceçš„å¼ºå¼•ç”¨åˆ é™¤<pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">/** * è½¯å¼•ç”¨æ¡ˆä¾‹3 - å¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨ */public class SoftReferenceDemo3 {    public static void main(String[] args) throws IOException {        ArrayList&lt;SoftReference&gt; softReferences = new ArrayList&lt;&gt;();        ReferenceQueue&lt;byte[]&gt; queues = new ReferenceQueue&lt;byte[]&gt;();        for (int i = 0; i &lt; 10; i++) {            byte[] bytes = new byte[1024 * 1024 * 100];            SoftReference studentRef = new SoftReference&lt;byte[]&gt;(bytes,queues);            softReferences.add(studentRef);        }        SoftReference&lt;byte[]&gt; ref = null;        int count = 0;        while ((ref = (SoftReference&lt;byte[]&gt;) queues.poll()) != null) {            count++;        }        System.out.println(count);    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h5 id="å¼±å¼•ç”¨"><a href="#å¼±å¼•ç”¨" class="headerlink" title="å¼±å¼•ç”¨"></a>å¼±å¼•ç”¨</h5><p>å¼±å¼•ç”¨æ•´ä½“ä¸è½¯å¼•ç”¨åŸºæœ¬ä¸€è‡´ï¼Œä½†æ˜¯å¼±å¼•ç”¨ä¸ç®¡å†…å­˜å¤Ÿä¸å¤Ÿéƒ½ä¼šç›´æ¥è¢«å›æ”¶</p><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">package chapter04.weak;import java.io.IOException;import java.lang.ref.WeakReference;/** * å¼±å¼•ç”¨æ¡ˆä¾‹ - åŸºæœ¬ä½¿ç”¨ */public class WeakReferenceDemo2 {    public static void main(String[] args) throws IOException {        byte[] bytes = new byte[1024 * 1024 * 100];        WeakReference&lt;byte[]&gt; weakReference = new WeakReference&lt;byte[]&gt;(bytes);        bytes = null;        System.out.println(weakReference.get());        System.gc();        System.out.println(weakReference.get());    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="è™šå¼•ç”¨å’Œç»ˆç»“å™¨å¼•ç”¨"><a href="#è™šå¼•ç”¨å’Œç»ˆç»“å™¨å¼•ç”¨" class="headerlink" title="è™šå¼•ç”¨å’Œç»ˆç»“å™¨å¼•ç”¨"></a>è™šå¼•ç”¨å’Œç»ˆç»“å™¨å¼•ç”¨</h5><p>è¿™ä¸¤ç§å¼•ç”¨åœ¨å¸¸è§„å¼€å‘ä¸­æ˜¯ä¸ä¼šä½¿ç”¨çš„ã€‚</p><ul><li>è™šå¼•ç”¨ä¹Ÿå«å¹½çµå¼•ç”¨/å¹»å½±å¼•ç”¨ï¼Œä¸èƒ½é€šè¿‡è™šå¼•ç”¨å¯¹è±¡è·å–åˆ°åŒ…å«çš„å¯¹è±¡ã€‚è™šå¼•ç”¨å”¯ä¸€çš„ç”¨é€”æ˜¯å½“å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶æ—¶å¯ä»¥æ¥æ”¶åˆ°å¯¹åº”çš„é€šçŸ¥ã€‚Javaä¸­ä½¿ç”¨PhantomReferenceå®ç°äº†è™šå¼•ç”¨ï¼Œç›´æ¥å†…å­˜ä¸­ä¸ºäº†åŠæ—¶çŸ¥é“ç›´æ¥å†…å­˜å¯¹è±¡ä¸å†ä½¿ç”¨ï¼Œä»è€Œå›æ”¶å†…å­˜ï¼Œä½¿ç”¨äº†è™šå¼•ç”¨æ¥å®ç°ã€‚</li><li>ç»ˆç»“å™¨å¼•ç”¨æŒ‡çš„æ˜¯åœ¨å¯¹è±¡éœ€è¦è¢«å›æ”¶æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨ä¼šå…³è”å¯¹è±¡å¹¶æ”¾ç½®åœ¨Finalizerç±»ä¸­çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œåœ¨ç¨åç”±ä¸€æ¡ç”±FinalizerThreadçº¿ç¨‹ä»é˜Ÿåˆ—ä¸­è·å–å¯¹è±¡ï¼Œç„¶åæ‰§è¡Œå¯¹è±¡çš„finalizeæ–¹æ³•ï¼Œåœ¨å¯¹è±¡ç¬¬äºŒæ¬¡è¢«å›æ”¶æ—¶ï¼Œè¯¥å¯¹è±¡æ‰çœŸæ­£çš„è¢«å›æ”¶ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¯ä»¥åœ¨finalizeæ–¹æ³•ä¸­å†å°†è‡ªèº«å¯¹è±¡ä½¿ç”¨å¼ºå¼•ç”¨å…³è”ä¸Šï¼Œä½†æ˜¯ä¸å»ºè®®è¿™æ ·åšã€‚<pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">package chapter04.finalreference;/** * ç»ˆç»“å™¨å¼•ç”¨æ¡ˆä¾‹ */public class FinalizeReferenceDemo {    public static FinalizeReferenceDemo reference = null;    public void alive() {        System.out.println("å½“å‰å¯¹è±¡è¿˜å­˜æ´»");    }    @Override    protected void finalize() throws Throwable {        try{            System.out.println("finalize()æ‰§è¡Œäº†...");            //è®¾ç½®å¼ºå¼•ç”¨è‡ªæ•‘            reference = this;        }finally {            super.finalize();        }    }    public static void main(String[] args) throws Throwable {        reference = new FinalizeReferenceDemo();       test();       test();    }    private static void test() throws InterruptedException {        reference = null;        //å›æ”¶å¯¹è±¡        System.gc();        //æ‰§è¡Œfinalizeæ–¹æ³•çš„ä¼˜å…ˆçº§æ¯”è¾ƒä½ï¼Œä¼‘çœ 500msç­‰å¾…ä¸€ä¸‹        Thread.sleep(500);        if (reference != null) {            reference.alive();        } else {            System.out.println("å¯¹è±¡å·²è¢«å›æ”¶");        }    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•"></a>åƒåœ¾å›æ”¶ç®—æ³•</h4><ol><li>æ‰¾åˆ°å†…å­˜ä¸­å­˜æ´»çš„å¯¹è±¡</li><li>é‡Šæ”¾ä¸å†å­˜æ´»å¯¹è±¡çš„å†…å­˜ï¼Œä½¿å¾—ç¨‹åºèƒ½å†æ¬¡åˆ©ç”¨è¿™éƒ¨åˆ†ç©ºé—´</li></ol><h4 id="åƒåœ¾å›æ”¶ç®—æ³•çš„å†å²å’Œåˆ†ç±»"><a href="#åƒåœ¾å›æ”¶ç®—æ³•çš„å†å²å’Œåˆ†ç±»" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•çš„å†å²å’Œåˆ†ç±»"></a>åƒåœ¾å›æ”¶ç®—æ³•çš„å†å²å’Œåˆ†ç±»</h4><p>1960å¹´John McCarthyå‘å¸ƒäº†ç¬¬ä¸€ä¸ªGCç®—æ³•ï¼šæ ‡è®°-æ¸…é™¤ç®—æ³•ã€‚<br>1963å¹´Marvin L. Minsky å‘å¸ƒäº†å¤åˆ¶ç®—æ³•ã€‚</p><p>æœ¬è´¨ä¸Šåç»­æ‰€æœ‰çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œéƒ½æ˜¯åœ¨ä¸Šè¿°ä¸¤ç§ç®—æ³•çš„åŸºç¡€ä¸Šä¼˜åŒ–è€Œæ¥ã€‚</p><h5 id="æ ‡è®°æ¸…é™¤ç®—æ³•"><a href="#æ ‡è®°æ¸…é™¤ç®—æ³•" class="headerlink" title="æ ‡è®°æ¸…é™¤ç®—æ³•"></a>æ ‡è®°æ¸…é™¤ç®—æ³•</h5><p>GCRootåŒ…å«çš„å¯¹è±¡ï¼š</p><blockquote><p>â€¢ è™šæ‹Ÿæœºæ ˆ(æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨)ä¸­å¼•â½¤çš„å¯¹è±¡<br>â€¢ æœ¬åœ°â½…æ³•æ ˆ(Native â½…æ³•)ä¸­å¼•â½¤çš„å¯¹è±¡<br>â€¢ â½…æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•â½¤çš„å¯¹è±¡<br>â€¢ â½…æ³•åŒºä¸­å¸¸é‡å¼•â½¤çš„å¯¹è±¡<br>â€¢ æ‰€æœ‰è¢«åŒæ­¥é”æŒæœ‰çš„å¯¹è±¡<br>â€¢ JNIï¼ˆJava Native Interfaceï¼‰å¼•â½¤çš„å¯¹è±¡</p></blockquote><p>æ ‡è®°æ¸…é™¤ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><ol><li>æ ‡è®°é˜¶æ®µï¼Œå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡è¿›è¡Œæ ‡è®°ã€‚Javaä¸­ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•ï¼Œä»GC Rootå¼€å§‹é€šè¿‡å¼•ç”¨é“¾éå†å‡ºæ‰€æœ‰å­˜æ´»å¯¹è±¡ã€‚ä»GC Rootå¯¹è±¡å¼€å§‹æ‰«æï¼Œå°†å¯¹è±¡Aã€Bã€Cåœ¨å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡æ ‡è®°å‡ºæ¥</li><li>æ¸…é™¤é˜¶æ®µï¼Œä»å†…å­˜ä¸­åˆ é™¤æ²¡æœ‰è¢«æ ‡è®°ä¹Ÿå°±æ˜¯éå­˜æ´»å¯¹è±¡ã€‚å°†æ²¡æœ‰æ ‡è®°çš„å¯¹è±¡æ¸…ç†æ‰ï¼Œæ‰€ä»¥å¯¹è±¡Då°±è¢«æ¸…ç†æ‰äº†ã€‚<br>ç¼ºç‚¹ï¼š</li><li>ç¢ç‰‡åŒ–é—®é¢˜ç”±äºå†…å­˜æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥åœ¨å¯¹è±¡è¢«åˆ é™¤ä¹‹åï¼Œå†…å­˜ä¸­ä¼šå‡ºç°å¾ˆå¤šç»†å°çš„å¯ç”¨å†…å­˜å•å…ƒã€‚å¦‚æœæˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ç©ºé—´ï¼Œå¾ˆæœ‰å¯èƒ½è¿™äº›å†…å­˜å•å…ƒçš„å¤§å°è¿‡å°æ— æ³•è¿›è¡Œåˆ†é…</li><li>åˆ†é…é€Ÿåº¦æ…¢ã€‚ç”±äºå†…å­˜ç¢ç‰‡çš„å­˜åœ¨ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²é“¾è¡¨ï¼Œææœ‰å¯èƒ½å‘ç”Ÿæ¯æ¬¡éœ€è¦éå†åˆ°é“¾è¡¨çš„æœ€åæ‰èƒ½è·å¾—åˆé€‚çš„å†…å­˜ç©ºé—´ã€‚ æˆ‘ä»¬éœ€è¦ç”¨ä¸€ä¸ªé“¾è¡¨æ¥ç»´æŠ¤ï¼Œå“ªäº›ç©ºé—´å¯ä»¥åˆ†é…å¯¹è±¡ï¼Œå¾ˆæœ‰å¯èƒ½éœ€è¦éå†è¿™ä¸ªé“¾è¡¨åˆ°æœ€åï¼Œæ‰èƒ½å‘ç°è¿™å—ç©ºé—´è¶³å¤Ÿæˆ‘ä»¬å»åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚å¦‚ä¸‹å›¾ï¼Œéå†åˆ°æœ€åæ‰å‘ç°æœ‰è¶³å¤Ÿçš„ç©ºé—´åˆ†é…3ä¸ªå­—èŠ‚çš„å¯¹è±¡äº†ã€‚å¦‚æœé“¾è¡¨å¾ˆé•¿ï¼Œéå†ä¹Ÿä¼šèŠ±è´¹è¾ƒé•¿çš„æ—¶é—´ã€‚</li></ol><h5 id="å¤åˆ¶ç®—æ³•"><a href="#å¤åˆ¶ç®—æ³•" class="headerlink" title="å¤åˆ¶ç®—æ³•"></a>å¤åˆ¶ç®—æ³•</h5><ol><li>å‡†å¤‡ä¸¤å—ç©ºé—´Fromç©ºé—´å’ŒToç©ºé—´ï¼Œæ¯æ¬¡åœ¨å¯¹è±¡åˆ†é…é˜¶æ®µï¼Œåªèƒ½ä½¿ç”¨å…¶ä¸­ä¸€å—ç©ºé—´ï¼ˆFromç©ºé—´ï¼‰ã€‚</li><li>åœ¨åƒåœ¾å›æ”¶GCé˜¶æ®µï¼Œå°†Fromä¸­å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°Toç©ºé—´ã€‚</li><li>å°†ä¸¤å—ç©ºé—´çš„Fromå’ŒToåå­—äº’æ¢ã€‚ä¸‹æ¬¡ä¾ç„¶åœ¨Fromç©ºé—´ä¸Šåˆ›å»ºå¯¹è±¡ã€‚<br>ä¼˜ç‚¹ï¼š</li></ol><ul><li>ååé‡é«˜ï¼Œå¤åˆ¶ç®—æ³•åªéœ€è¦éå†ä¸€æ¬¡å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°Toç©ºé—´å³å¯ï¼Œæ¯”æ ‡è®°-æ•´ç†ç®—æ³•å°‘äº†ä¸€æ¬¡éå†çš„è¿‡ç¨‹ï¼Œå› è€Œæ€§èƒ½è¾ƒå¥½ï¼Œä½†æ˜¯ä¸å¦‚æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œå› ä¸ºæ ‡è®°æ¸…é™¤ç®—æ³•ä¸éœ€è¦è¿›è¡Œå¯¹è±¡çš„ç§»åŠ¨</li><li>ä¸ä¼šå‘ç”Ÿç¢ç‰‡åŒ–ï¼Œå¤åˆ¶ç®—æ³•åœ¨å¤åˆ¶ä¹‹åå°±ä¼šå°†å¯¹è±¡æŒ‰é¡ºåºæ”¾å…¥Toç©ºé—´ä¸­ï¼Œæ‰€ä»¥å¯¹è±¡ä»¥å¤–çš„åŒºåŸŸéƒ½æ˜¯å¯ç”¨ç©ºé—´ï¼Œä¸å­˜åœ¨ç¢ç‰‡åŒ–å†…å­˜ç©ºé—´ã€‚<br>ç¼ºç‚¹ï¼š<br>å†…å­˜ä½¿ç”¨æ•ˆç‡ä½ï¼Œæ¯æ¬¡åªèƒ½è®©ä¸€åŠçš„å†…å­˜ç©ºé—´æ¥ä¸ºåˆ›å»ºå¯¹è±¡ä½¿ç”¨ã€‚</li></ul><h5 id="æ ‡è®°æ•´ç†ç®—æ³•"><a href="#æ ‡è®°æ•´ç†ç®—æ³•" class="headerlink" title="æ ‡è®°æ•´ç†ç®—æ³•"></a>æ ‡è®°æ•´ç†ç®—æ³•</h5><p>æ ‡è®°æ•´ç†ç®—æ³•ä¹Ÿå«æ ‡è®°å‹ç¼©ç®—æ³•ï¼Œæ˜¯å¯¹æ ‡è®°æ¸…ç†ç®—æ³•ä¸­å®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡é—®é¢˜çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚</p><p>æ ¸å¿ƒæ€æƒ³åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><ol><li>æ ‡è®°é˜¶æ®µï¼Œå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡è¿›è¡Œæ ‡è®°ã€‚Javaä¸­ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•ï¼Œä»GC Rootå¼€å§‹é€šè¿‡å¼•ç”¨é“¾éå†å‡ºæ‰€æœ‰å­˜æ´»å¯¹è±¡ã€‚</li><li>æ•´ç†é˜¶æ®µï¼Œå°†å­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ°å †çš„ä¸€ç«¯ã€‚æ¸…ç†æ‰å­˜æ´»å¯¹è±¡çš„å†…å­˜ç©ºé—´ã€‚<br>ä¼˜ç‚¹ï¼š</li></ol><ul><li>å†…å­˜ä½¿ç”¨æ•ˆç‡é«˜ï¼Œæ•´ä¸ªå †å†…å­˜éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä¸ä¼šåƒå¤åˆ¶ç®—æ³•åªèƒ½ä½¿ç”¨åŠä¸ªå †å†…å­˜</li><li>ä¸ä¼šå‘ç”Ÿç¢ç‰‡åŒ–ï¼Œåœ¨æ•´ç†é˜¶æ®µå¯ä»¥å°†å¯¹è±¡å¾€å†…å­˜çš„ä¸€ä¾§è¿›è¡Œç§»åŠ¨ï¼Œå‰©ä¸‹çš„ç©ºé—´éƒ½æ˜¯å¯ä»¥åˆ†é…å¯¹è±¡çš„æœ‰æ•ˆç©ºé—´<br>ç¼ºç‚¹ï¼š<br>æ•´ç†é˜¶æ®µçš„æ•ˆç‡ä¸é«˜ï¼Œæ•´ç†ç®—æ³•æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚Lisp2æ•´ç†ç®—æ³•éœ€è¦å¯¹æ•´ä¸ªå †ä¸­çš„å¯¹è±¡æœç´¢3æ¬¡ï¼Œæ•´ä½“æ€§èƒ½ä¸ä½³ã€‚å¯ä»¥é€šè¿‡Two-Fingerã€è¡¨æ ¼ç®—æ³•ã€ImmixGCç­‰é«˜æ•ˆçš„æ•´ç†ç®—æ³•ä¼˜åŒ–æ­¤é˜¶æ®µçš„æ€§èƒ½</li></ul><h5 id="åˆ†ä»£åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åˆ†ä»£åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åˆ†ä»£åƒåœ¾å›æ”¶ç®—æ³•"></a>åˆ†ä»£åƒåœ¾å›æ”¶ç®—æ³•</h5><p>ç°ä»£ä¼˜ç§€çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œä¼šå°†ä¸Šè¿°æè¿°çš„åƒåœ¾å›æ”¶ç®—æ³•ç»„åˆè¿›è¡Œä½¿ç”¨ï¼Œå…¶ä¸­åº”ç”¨æœ€å¹¿çš„å°±æ˜¯åˆ†ä»£åƒåœ¾å›æ”¶ç®—æ³•(Generational GC)ã€‚<br>åˆ†ä»£åƒåœ¾å›æ”¶å°†æ•´ä¸ªå†…å­˜åŒºåŸŸåˆ’åˆ†ä¸ºå¹´è½»ä»£å’Œè€å¹´ä»£ï¼š<img src="/2024/06/24/02/%E5%88%92%E5%88%86.png"></p><ol><li>åˆ†ä»£å›æ”¶æ—¶ï¼Œåˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ï¼Œé¦–å…ˆä¼šè¢«æ”¾å…¥Edenä¼Šç”¸å›­åŒºã€‚<img src="/2024/06/24/02/Eden.png"></li><li>éšç€å¯¹è±¡åœ¨EdenåŒºè¶Šæ¥è¶Šå¤šï¼Œå¦‚æœEdenåŒºæ»¡ï¼Œæ–°åˆ›å»ºçš„å¯¹è±¡å·²ç»æ— æ³•æ”¾å…¥ï¼Œå°±ä¼šè§¦å‘å¹´è½»ä»£çš„GCï¼Œç§°ä¸ºMinor GCæˆ–è€…Young GCã€‚Minor GCä¼šæŠŠéœ€è¦edenä¸­å’ŒFroméœ€è¦å›æ”¶çš„å¯¹è±¡å›æ”¶ï¼ŒæŠŠæ²¡æœ‰å›æ”¶çš„å¯¹è±¡æ”¾å…¥ToåŒºã€‚<img src="/2024/06/24/02/MinorGC.png"></li><li>æ¥ä¸‹æ¥ï¼ŒS0ä¼šå˜æˆToåŒºï¼ŒS1å˜æˆFromåŒºã€‚å½“edenåŒºæ»¡æ—¶å†å¾€é‡Œæ”¾å…¥å¯¹è±¡ï¼Œä¾ç„¶ä¼šå‘ç”ŸMinor GCã€‚<img src="/2024/06/24/02/%E5%8F%98%E6%8D%A2.png"></li><li>å¦‚æœMinor GCåå¯¹è±¡çš„å¹´é¾„è¾¾åˆ°é˜ˆå€¼ï¼ˆæœ€å¤§15ï¼Œé»˜è®¤å€¼å’Œåƒåœ¾å›æ”¶å™¨æœ‰å…³ï¼‰ï¼Œå¯¹è±¡å°±ä¼šè¢«æ™‹å‡è‡³è€å¹´ä»£ã€‚<img src="/2024/06/24/02/%E8%BF%AD%E4%BB%A3.png"></li><li>å½“è€å¹´ä»£ä¸­ç©ºé—´ä¸è¶³ï¼Œæ— æ³•æ”¾å…¥æ–°çš„å¯¹è±¡æ—¶ï¼Œå…ˆå°è¯•minor gcå¦‚æœè¿˜æ˜¯ä¸è¶³ï¼Œå°±ä¼šè§¦å‘Full GCï¼ŒFull GCä¼šå¯¹æ•´ä¸ªå †è¿›è¡Œåƒåœ¾å›æ”¶ã€‚å¦‚æœFull GCä¾ç„¶æ— æ³•å›æ”¶æ‰è€å¹´ä»£çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå½“å¯¹è±¡ç»§ç»­æ”¾å…¥è€å¹´ä»£æ—¶ï¼Œå°±ä¼šæŠ›å‡ºOut Of Memoryå¼‚å¸¸ã€‚</li></ol><p>ä¸ºä»€ä¹ˆåˆ†ä»£GCç®—æ³•è¦æŠŠå †åˆ†æˆå¹´è½»ä»£å’Œè€å¹´ä»£ï¼Ÿé¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“å †å†…å­˜ä¸­å¯¹è±¡çš„ç‰¹æ€§ï¼š</p><ul><li>ç³»ç»Ÿä¸­çš„å¤§éƒ¨åˆ†å¯¹è±¡ï¼Œéƒ½æ˜¯åˆ›å»ºå‡ºæ¥ä¹‹åå¾ˆå¿«å°±ä¸å†ä½¿ç”¨å¯ä»¥è¢«å›æ”¶ï¼Œæ¯”å¦‚ç”¨æˆ·è·å–è®¢å•æ•°æ®ï¼Œè®¢å•æ•°æ®è¿”å›ç»™ç”¨æˆ·ä¹‹åå°±å¯ä»¥é‡Šæ”¾äº†ã€‚</li><li>è€å¹´ä»£ä¸­ä¼šå­˜æ”¾é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œæ¯”å¦‚Springçš„å¤§éƒ¨åˆ†beanå¯¹è±¡ï¼Œåœ¨ç¨‹åºå¯åŠ¨ä¹‹åå°±ä¸ä¼šè¢«å›æ”¶äº†ã€‚</li><li>åœ¨è™šæ‹Ÿæœºçš„é»˜è®¤è®¾ç½®ä¸­ï¼Œæ–°ç”Ÿä»£å¤§å°è¦è¿œå°äºè€å¹´ä»£çš„å¤§å°ã€‚</li></ul><p>åˆ†ä»£GCç®—æ³•å°†å †åˆ†æˆå¹´è½»ä»£å’Œè€å¹´ä»£ä¸»è¦åŸå› æœ‰ï¼š</p><ol><li>å¯ä»¥é€šè¿‡è°ƒæ•´å¹´è½»ä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹æ¥é€‚åº”ä¸åŒç±»å‹çš„åº”ç”¨ç¨‹åºï¼Œæé«˜å†…å­˜çš„åˆ©ç”¨ç‡å’Œæ€§èƒ½ã€‚</li><li>æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä½¿ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£ä¸€èˆ¬é€‰æ‹©å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£å¯ä»¥é€‰æ‹©æ ‡è®°-æ¸…é™¤å’Œæ ‡è®°-æ•´ç†ç®—æ³•ï¼Œç”±ç¨‹åºå‘˜æ¥é€‰æ‹©çµæ´»åº¦è¾ƒé«˜ã€‚</li><li>åˆ†ä»£çš„è®¾è®¡ä¸­å…è®¸åªå›æ”¶æ–°ç”Ÿä»£ï¼ˆminor gcï¼‰ï¼Œå¦‚æœèƒ½æ»¡è¶³å¯¹è±¡åˆ†é…çš„è¦æ±‚å°±ä¸éœ€è¦å¯¹æ•´ä¸ªå †è¿›è¡Œå›æ”¶(full gc),STWæ—¶é—´å°±ä¼šå‡å°‘ã€‚</li></ol><h4 id="åƒåœ¾å›æ”¶å™¨-é‡ç‚¹"><a href="#åƒåœ¾å›æ”¶å™¨-é‡ç‚¹" class="headerlink" title="åƒåœ¾å›æ”¶å™¨ é‡ç‚¹"></a>åƒåœ¾å›æ”¶å™¨ é‡ç‚¹</h4><h2 id="ä¸€äº›å¥½ç”¨JVMåˆ†æå·¥å…·"><a href="#ä¸€äº›å¥½ç”¨JVMåˆ†æå·¥å…·" class="headerlink" title="ä¸€äº›å¥½ç”¨JVMåˆ†æå·¥å…·"></a>ä¸€äº›å¥½ç”¨JVMåˆ†æå·¥å…·</h2><h3 id="Arthas-Arthas-Install-arthas-aliyun-com"><a href="#Arthas-Arthas-Install-arthas-aliyun-com" class="headerlink" title="[Arthas](Arthas Install | arthas (aliyun.com))"></a>[Arthas](<a href="https://arthas.aliyun.com/doc/install-detail.html">Arthas Install | arthas (aliyun.com)</a>)</h3><p><img src="/2024/06/24/02/Arthas.png"><br>é˜¿é‡Œå¼€å‘çš„å·¥å…·</p><h1 id="å†…å­˜åˆ†é…"><a href="#å†…å­˜åˆ†é…" class="headerlink" title="å†…å­˜åˆ†é…"></a>å†…å­˜åˆ†é…</h1><p><img src="/2024/06/24/02/%E5%A0%86%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.png"></p><ol><li>ä¼˜å…ˆåˆ†é…åœ¨EdenåŒºï¼Œå¦‚æœEdenåŒºæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œè™šæ‹Ÿæœºä¼šè¿›è¡Œä¸€æ¬¡MinorGCï¼Œè€Œé‚£äº›æ— éœ€å›æ”¶çš„å­˜è´§å¯¹è±¡ä¼šè¿›å…¥Survivorçš„FromåŒºï¼Œå†ä¸æ»¡è¶³å°±è¿›å…¥OldåŒº</li><li>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œé¿å…åœ¨EdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºä¹‹é—´å‘ç”Ÿå¤§é‡çš„å†…å­˜æ‹·è´</li><li>é•¿æœŸå­˜è´§çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ï¼Œè™šæ‹Ÿæœºä¸ºæ¯ä¸€ä¸ªå¯¹è±¡å®šä¹‰ä¸€ä¸ªå¹´é¾„è®¡æ•°å™¨ï¼Œç»è¿‡ä¸€æ¬¡MinorCGå°±ä¼šè¿›å…¥SurvivoråŒºï¼Œæ­¤åæ¯ç»å†ä¸€æ¬¡éƒ½ä¼šå¹´é¾„+1ï¼Œåˆ°è¾¾é˜ˆå€¼ï¼Œå¯¹è±¡è¿›å…¥è€å¹´åŒºã€‚</li><li></li></ol><h2 id="Full-GCå’ŒMinor-GCå’Œå†…å­˜å›æ”¶ç®—æ³•"><a href="#Full-GCå’ŒMinor-GCå’Œå†…å­˜å›æ”¶ç®—æ³•" class="headerlink" title="Full GCå’ŒMinor GCå’Œå†…å­˜å›æ”¶ç®—æ³•"></a>Full GCå’ŒMinor GCå’Œå†…å­˜å›æ”¶ç®—æ³•</h2><blockquote><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­EdenåŒºåˆ†é…ï¼Œå½“EdenåŒºæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜è¿›è¡Œåˆ†é…æ—¶ï¼Œå›å‘èµ·ä¸€æ¬¡Minor GCã€‚ç»è¿‡ç¬¬ä¸€æ¬¡Minor GCä»èƒ½å¤Ÿå­˜è´§ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¢«Surviorå®¹å™¨å®¹çº³çš„è¯ï¼Œä¼šè¢«ç§»åŠ¨åˆ°Survivorç©ºé—´ã€‚å¹¶ä¸”å°†å¯¹è±¡å¹´é¾„è®¾ç½®ä¸º1ï¼Œä¹‹åå¯¹è±¡æ¯ç†¬è¿‡ä¸€æ¬¡MinorGCï¼Œå¹´é¾„å°±å¢åŠ 1å²ï¼Œå½“å®ƒçš„å¹´é¾„è¾¾åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œå°±ä¼šè¢«æ™‹çº§åˆ°è€å¹´ä»£ä¸­ã€‚éƒ¨åˆ†åƒåœ¾å›æ”¶å™¨ä¼šå°†å¤§å¯¹è±¡ç›´æ¥æ”¾å…¥å°±è€ä»£ã€‚</p></blockquote><h3 id="Minor-GC-x2F-Young-GC"><a href="#Minor-GC-x2F-Young-GC" class="headerlink" title="Minor GC/ Young GC"></a>Minor GC/ Young GC</h3><p>åªå¯¹æ–°ç”Ÿä»£è¿›è¡Œåƒåœ¾æ”¶é›†</p><h3 id="Major-GC-x2F-Old-GC"><a href="#Major-GC-x2F-Old-GC" class="headerlink" title="Major GC / Old GC"></a>Major GC / Old GC</h3><p>åªå¯¹è€å¹´ä»£è¿›è¡ŒGCï¼Œæœ‰æ—¶å€™ä¹Ÿå¯ä»¥ä»£æŒ‡Full GC</p><h3 id="Full-GC"><a href="#Full-GC" class="headerlink" title="Full GC"></a>Full GC</h3><p>å›æ”¶æ•´ä¸ªJavaå †å’Œæ–¹æ³•åŒº</p><h2 id="å†…å­˜è°ƒä¼˜"><a href="#å†…å­˜è°ƒä¼˜" class="headerlink" title="å†…å­˜è°ƒä¼˜"></a>å†…å­˜è°ƒä¼˜</h2><p>å†…å­˜æ³„æ¼(memory leak)ï¼šJavaä¸­çš„å¦‚æœä¸å†ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯è¯¥å¯¹è±¡ä¾ç„¶åœ¨CG ROOTçš„å¼•ç”¨é“¾ä¸Šï¼Œè¿™ä¸ªå¯¹è±¡å°±ä¸ä¼šè¢«å›æ”¶ã€‚<br>ç»å¤§æ•°æƒ…å†µéƒ½æ˜¯ç”±å †å†…å­˜æ³„éœ²å¼•èµ·çš„<br>å¸¸è§ç”±ï¼š</p><ol><li>æ²¡æœ‰åŠæ—¶åˆ é™¤ç¼“å­˜æ•°æ®</li><li>åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿç­‰è¿›è¡Œä»»åŠ¡è°ƒåº¦ä»»åŠ¡ç»“æŸä¸­å‡ºç°äº†å†…å­˜æ³„æ¼ã€‚</li></ol><h3 id="ä»£ç ä¸­çš„å†…å­˜æ³„æ¼"><a href="#ä»£ç ä¸­çš„å†…å­˜æ³„æ¼" class="headerlink" title="ä»£ç ä¸­çš„å†…å­˜æ³„æ¼"></a>ä»£ç ä¸­çš„å†…å­˜æ³„æ¼</h3><h4 id="equalså’ŒhashCodeï¼Œä¸æ­£ç¡®ä½¿ç”¨ä¼šå¯¼è‡´æ³„æ¼"><a href="#equalså’ŒhashCodeï¼Œä¸æ­£ç¡®ä½¿ç”¨ä¼šå¯¼è‡´æ³„æ¼" class="headerlink" title="equalså’ŒhashCodeï¼Œä¸æ­£ç¡®ä½¿ç”¨ä¼šå¯¼è‡´æ³„æ¼"></a>equalså’ŒhashCodeï¼Œä¸æ­£ç¡®ä½¿ç”¨ä¼šå¯¼è‡´æ³„æ¼</h4><ol><li><strong>ä¸ä¸€è‡´çš„&nbsp;<code>equals()</code>&nbsp;å’Œ&nbsp;<code>hashCode()</code>&nbsp;å®ç°</strong>ï¼š<ul><li>å¦‚æœä¸¤ä¸ªå¯¹è±¡æ ¹æ®&nbsp;<code>equals()</code>&nbsp;æ–¹æ³•è¢«è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆå®ƒä»¬çš„&nbsp;<code>hashCode()</code>&nbsp;å€¼ä¹Ÿå¿…é¡»ç›¸ç­‰ã€‚å¦‚æœè¿™ä¸ªè§„åˆ™è¢«è¿åï¼Œå¯èƒ½ä¼šå¯¼è‡´å“ˆå¸Œè¡¨ä¸­çš„å¯¹è±¡æ— æ³•æ­£ç¡®åœ°è¢«è®¿é—®å’Œåˆ é™¤ï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</li></ul></li><li><strong>å¯¹è±¡æ— æ³•è¢«æ­£ç¡®ç§»é™¤</strong>ï¼š<ul><li>åœ¨ä½¿ç”¨å“ˆå¸Œè¡¨æ—¶ï¼Œå¦‚æœå¯¹è±¡çš„&nbsp;<code>hashCode()</code>&nbsp;å€¼åœ¨æ’å…¥åå‘ç”Ÿå˜åŒ–ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¯¹è±¡æ— æ³•è¢«æ­£ç¡®ç§»é™¤ï¼Œå› ä¸ºå“ˆå¸Œè¡¨ä¾èµ–äº&nbsp;<code>hashCode()</code>&nbsp;å€¼æ¥å®šä½å¯¹è±¡ã€‚<br>åœ¨å®šä¹‰æ–°ç±»æ—¶æ²¡æœ‰é‡å†™æ­£ç¡®çš„equals()å’ŒhashCode()æ–¹æ³•ã€‚åœ¨ä½¿ç”¨HashMapçš„åœºæ™¯ä¸‹ï¼Œå¦‚æœä½¿ç”¨è¿™ä¸ªç±»å¯¹è±¡ä½œä¸ºkeyï¼ŒHashMapåœ¨åˆ¤æ–­keyæ˜¯å¦å·²ç»å­˜åœ¨æ—¶ä¼šä½¿ç”¨è¿™äº›æ–¹æ³•ï¼Œå¦‚æœé‡å†™æ–¹å¼ä¸æ­£ç¡®ï¼Œä¼šå¯¼è‡´ç›¸åŒçš„æ•°æ®è¢«ä¿å­˜å¤šä»½ã€‚<br>æ­£å¸¸æƒ…å†µï¼š</li></ul></li><li>ä»¥JDK8ä¸ºä¾‹ï¼Œé¦–å…ˆè°ƒç”¨hashæ–¹æ³•è®¡ç®—keyçš„å“ˆå¸Œå€¼ï¼Œhashæ–¹æ³•ä¸­ä¼šä½¿ç”¨åˆ°keyçš„hashcodeæ–¹æ³•ã€‚æ ¹æ®hashæ–¹æ³•çš„ç»“æœå†³å®šå­˜æ”¾çš„æ•°ç»„ä¸­ä½ç½®ã€‚</li><li>å¦‚æœæ²¡æœ‰å…ƒç´ ï¼Œç›´æ¥æ”¾å…¥ã€‚å¦‚æœæœ‰å…ƒç´ ï¼Œå…ˆåˆ¤æ–­keyæ˜¯å¦ç›¸ç­‰ï¼Œä¼šç”¨åˆ°equalsæ–¹æ³•ï¼Œå¦‚æœkeyç›¸ç­‰ï¼Œç›´æ¥æ›¿æ¢valueï¼›keyä¸ç›¸ç­‰ï¼Œèµ°é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘æŸ¥æ‰¾é€»è¾‘ï¼Œå…¶ä¸­ä¹Ÿä¼šä½¿ç”¨equalsæ¯”å¯¹æ˜¯å¦ç›¸åŒã€‚<br>å¼‚å¸¸æƒ…å†µï¼š</li><li>hashCodeæ–¹æ³•ä¸å¯¹ï¼Œå¯¼è‡´ç›¸åŒidçš„å­¦ç”Ÿå¯¹è±¡è®¡ç®—å‡ºæ¥çš„hashå€¼ä¸åŒè¢«æ”¾åœ¨ä¸åŒçš„æ§½ä¸­</li><li>equalsæ–¹æ³•ä¸å¯¹ï¼Œå¯¼è‡´å³ä½¿idç›¸åŒï¼Œä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯ä¸åŒçš„å¯¹è±¡<br>ä¸‹åˆ—ä»£ç ä¼šé‡å¤æ·»åŠ è¿™ä¸ªå¯¹è±¡ï¼Œå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œå› ä¸ºä¸æ˜¯ç›¸åŒçš„å¯¹è±¡å®ä¾‹</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java">  <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">{</span>        <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>        <span class="token class-name">String</span> name<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> id<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> name<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            student<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            student<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>student<span class="token punctuation">,</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>åœ¨å®šä¹‰æ–°å®ä½“æ—¶ï¼Œå§‹ç»ˆé‡å†™equals()å’ŒhashCode()æ–¹æ³•ã€‚</li><li>é‡å†™æ—¶ä¸€å®šè¦ç¡®å®šä½¿ç”¨äº†å”¯ä¸€æ ‡è¯†å»åŒºåˆ†ä¸åŒçš„å¯¹è±¡ï¼Œæ¯”å¦‚ç”¨æˆ·çš„idç­‰ã€‚</li><li>hashmapä½¿ç”¨æ—¶å°½é‡ä½¿ç”¨ç¼–å·idç­‰æ•°æ®ä½œä¸ºkeyï¼Œä¸è¦å°†æ•´ä¸ªå®ä½“ç±»å¯¹è±¡ä½œä¸ºkeyå­˜æ”¾ã€‚</li></ol><h4 id="ThreadLocalçš„ä½¿ç”¨"><a href="#ThreadLocalçš„ä½¿ç”¨" class="headerlink" title="ThreadLocalçš„ä½¿ç”¨"></a>ThreadLocalçš„ä½¿ç”¨</h4><p>çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸è¢«å›æ”¶å¯¼è‡´çš„ThreadLocalå†…å­˜æ³„æ¼<br>å¦‚æœä»…ä»…ä½¿ç”¨æ‰‹åŠ¨åˆ›å»ºçš„çº¿ç¨‹ï¼Œå°±ç®—æ²¡æœ‰è°ƒç”¨ThreadLocalçš„removeæ–¹æ³•æ¸…ç†æ•°æ®ï¼Œä¹Ÿä¸ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ã€‚å› ä¸ºå½“çº¿ç¨‹è¢«å›æ”¶æ—¶ï¼ŒThreadLocalä¹ŸåŒæ ·è¢«å›æ”¶ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨çº¿ç¨‹æ± å°±ä¸ä¸€å®šäº†ã€‚<br>è§£å†³æ–¹æ¡ˆï¼š<br>çº¿ç¨‹æ–¹æ³•æ‰§è¡Œå®Œï¼Œä¸€å®šè¦è°ƒç”¨ThreadLocalä¸­çš„removeæ–¹æ³•æ¸…ç†å¯¹è±¡ã€‚</p><h4 id="å†…éƒ¨ç±»å¼•ç”¨å¤–éƒ¨ç±»"><a href="#å†…éƒ¨ç±»å¼•ç”¨å¤–éƒ¨ç±»" class="headerlink" title="å†…éƒ¨ç±»å¼•ç”¨å¤–éƒ¨ç±»"></a>å†…éƒ¨ç±»å¼•ç”¨å¤–éƒ¨ç±»</h4><p>éé™æ€çš„å†…éƒ¨ç±»å’ŒåŒ¿åå†…éƒ¨ç±»çš„é”™è¯¯ä½¿ç”¨å¯¼è‡´å†…å­˜æ³„æ¼</p><ol><li><strong>éé™æ€çš„å†…éƒ¨ç±»é»˜è®¤ä¼šæŒæœ‰å¤–éƒ¨ç±»</strong> ï¼Œå°½ç®¡ä»£ç ä¸Šä¸å†ä½¿ç”¨å¤–éƒ¨ç±»ï¼Œæ‰€ä»¥å¦‚æœæœ‰åœ°æ–¹å¼•ç”¨äº†è¿™ä¸ªéé™æ€å†…éƒ¨ç±»ï¼Œä¼šå¯¼è‡´å¤–éƒ¨ç±»ä¹Ÿè¢«å¼•ç”¨ï¼Œåƒåœ¾å›æ”¶æ—¶æ— æ³•å›æ”¶è¿™ä¸ªå¤–éƒ¨ç±»ã€‚</li><li>åŒ¿åå†…éƒ¨ç±»å¯¹è±¡å¦‚æœåœ¨éé™æ€æ–¹æ³•ä¸­è¢«åˆ›å»ºï¼Œä¼šæŒæœ‰è°ƒç”¨è€…å¯¹è±¡ï¼Œåƒåœ¾å›æ”¶æ—¶æ— æ³•å›æ”¶è°ƒç”¨è€…ã€‚</li></ol><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>ä½¿ç”¨é™æ€å†…éƒ¨ç±»ä»è€Œä¸æŒæœ‰å¤–éƒ¨å¯¹è±¡</li><li>ä½¿ç”¨é™æ€æ–¹æ³•ï¼Œé¿å…åŒ¿åå†…éƒ¨ç±»æŒæœ‰è°ƒç”¨è€…å¯¹è±¡</li></ol><h4 id="Stringçš„internæ–¹æ³•"><a href="#Stringçš„internæ–¹æ³•" class="headerlink" title="Stringçš„internæ–¹æ³•"></a>Stringçš„internæ–¹æ³•</h4><p>ç”±äºJDK6ä¸­çš„å­—ç¬¦ä¸²å¸¸é‡æ± ä½äºæ°¸ä¹…ä»£ï¼Œinternè¢«å¤§é‡è°ƒç”¨å¹¶ä¿å­˜äº§ç”Ÿçš„å†…å­˜æ³„æ¼</p><h4 id="é€šè¿‡é™æ€å­—æ®µä¿å­˜å¯¹è±¡"><a href="#é€šè¿‡é™æ€å­—æ®µä¿å­˜å¯¹è±¡" class="headerlink" title="é€šè¿‡é™æ€å­—æ®µä¿å­˜å¯¹è±¡"></a>é€šè¿‡é™æ€å­—æ®µä¿å­˜å¯¹è±¡</h4><p>å¤§é‡çš„æ•°æ®åœ¨é™æ€å˜é‡ä¸­è¢«å¼•ç”¨ï¼Œä½†æ˜¯ä¸å†ä½¿ç”¨ï¼Œæˆä¸ºäº†å†…å­˜æ³„æ¼<br>é—®é¢˜ï¼š<br>å¦‚æœå¤§é‡çš„æ•°æ®åœ¨é™æ€å˜é‡ä¸­è¢«é•¿æœŸå¼•ç”¨ï¼Œæ•°æ®å°±ä¸ä¼šè¢«é‡Šæ”¾ï¼Œå¦‚æœè¿™äº›æ•°æ®ä¸å†ä½¿ç”¨ï¼Œå°±æˆä¸ºäº†å†…å­˜æ³„æ¼ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š<br>1ã€å°½é‡å‡å°‘å°†å¯¹è±¡é•¿æ—¶é—´çš„ä¿å­˜åœ¨é™æ€å˜é‡ä¸­ï¼Œå¦‚æœä¸å†ä½¿ç”¨ï¼Œå¿…é¡»å°†å¯¹è±¡åˆ é™¤ï¼ˆæ¯”å¦‚åœ¨é›†åˆä¸­ï¼‰æˆ–è€…å°†é™æ€å˜é‡è®¾ç½®ä¸ºnullã€‚<br>2ã€ä½¿ç”¨å•ä¾‹æ¨¡å¼æ—¶ï¼Œå°½é‡ä½¿ç”¨æ‡’åŠ è½½ï¼Œè€Œä¸æ˜¯ç«‹å³åŠ è½½ã€‚</p><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">package com.itheima.jvmoptimize.leakdemo.demo7;import org.springframework.context.annotation.Lazy;import org.springframework.stereotype.Component;@Lazy //æ‡’åŠ è½½@Componentpublic class TestLazy {    private byte[] bytes = new byte[1024 * 1024 * 1024];}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="èµ„æºæ²¡æœ‰æ­£å¸¸å…³é—­"><a href="#èµ„æºæ²¡æœ‰æ­£å¸¸å…³é—­" class="headerlink" title="èµ„æºæ²¡æœ‰æ­£å¸¸å…³é—­"></a>èµ„æºæ²¡æœ‰æ­£å¸¸å…³é—­</h4><p>ç”±äºèµ„æºæ²¡æœ‰è°ƒç”¨closeæ–¹æ³•æ­£å¸¸å…³é—­ï¼Œå¯¼è‡´çš„å†…å­˜æº¢å‡º<br>è¿æ¥å’Œæµè¿™äº›èµ„æºä¼šå ç”¨å†…å­˜ï¼Œå¦‚æœä½¿ç”¨å®Œä¹‹åæ²¡æœ‰å…³é—­ï¼Œè¿™éƒ¨åˆ†å†…å­˜ä¸ä¸€å®šä¼šå‡ºç°å†…å­˜æ³„æ¼ï¼Œä½†æ˜¯ä¼šå¯¼è‡´closeæ–¹æ³•ä¸è¢«æ‰§è¡Œã€‚<br>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>ä¸ºäº†é˜²æ­¢å‡ºç°è¿™ç±»çš„èµ„æºå¯¹è±¡æ³„æ¼é—®é¢˜ï¼Œå¿…é¡»åœ¨finallyå—ä¸­å…³é—­ä¸å†ä½¿ç”¨çš„èµ„æºã€‚</li><li>ä» Java 7 å¼€å§‹ï¼Œä½¿ç”¨try-with-resourcesè¯­æ³•å¯ä»¥ç”¨äºè‡ªåŠ¨å…³é—­èµ„æºã€‚<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">(</span>    <span class="token class-name">BufferedReader</span> br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token string">"file1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">BufferedReader</span> br2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token string">"file2.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// ä½¿ç”¨èµ„æº</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h4 id="å¹¶å‘è¯·æ±‚é—®é¢˜"><a href="#å¹¶å‘è¯·æ±‚é—®é¢˜" class="headerlink" title="å¹¶å‘è¯·æ±‚é—®é¢˜"></a>å¹¶å‘è¯·æ±‚é—®é¢˜</h4><h2 id="GCè°ƒä¼˜"><a href="#GCè°ƒä¼˜" class="headerlink" title="GCè°ƒä¼˜"></a>GCè°ƒä¼˜</h2><p>GCè°ƒä¼˜æ˜¯å¯¹åƒåœ¾å›æ”¶è¿›è¡Œè°ƒä¼˜ï¼ŒGCè°ƒä¼˜çš„ä¸»è¦ç›®æ ‡æ˜¯é¿å…ç”±åƒåœ¾å›æ”¶å¼•èµ·ç¨‹åºæ€§èƒ½ä¸‹é™<br>å¯ä»¥è¿›è¡Œè°ƒä¼˜çš„å†…å®¹ï¼š</p><ol><li>é€šç”¨JVMå‚æ•°çš„è®¾ç½®</li><li>ç‰¹å®šåƒåœ¾å›æ”¶å™¨çš„JVMå‚æ•°çš„è®¾ç½®</li><li>è§£å†³ç”±é¢‘ç¹FULLGCå¼•èµ·çš„ç¨‹åºæ€§èƒ½é—®é¢˜</li></ol><h3 id="è°ƒä¼˜æŒ‡æ ‡ï¼š"><a href="#è°ƒä¼˜æŒ‡æ ‡ï¼š" class="headerlink" title="è°ƒä¼˜æŒ‡æ ‡ï¼š"></a>è°ƒä¼˜æŒ‡æ ‡ï¼š</h3><h4 id="åƒåœ¾å›æ”¶çš„ååé‡"><a href="#åƒåœ¾å›æ”¶çš„ååé‡" class="headerlink" title="åƒåœ¾å›æ”¶çš„ååé‡"></a>åƒåœ¾å›æ”¶çš„ååé‡</h4><ul><li>ååé‡ï¼Œä¸€æ®µæ—¶é—´å†…ç¨‹åºéœ€è¦å®Œæˆçš„ä¸šåŠ¡æ•°é‡ã€‚<br>ä¿è¯é«˜ååé‡çš„å¸¸è§„æ‰‹æ®µæœ‰ä¸¤æ¡ï¼š<br>1ã€ä¼˜åŒ–ä¸šåŠ¡æ‰§è¡Œæ€§èƒ½ï¼Œå‡å°‘å•æ¬¡ä¸šåŠ¡çš„æ‰§è¡Œæ—¶é—´<br>2ã€ä¼˜åŒ–åƒåœ¾å›æ”¶ååé‡</li></ul><p>åƒåœ¾å›æ”¶ååé‡æŒ‡çš„æ˜¯ CPU ç”¨äºæ‰§è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸ CPU æ€»æ‰§è¡Œæ—¶é—´çš„æ¯”å€¼ï¼Œå³ååé‡ = æ‰§è¡Œç”¨æˆ·ä»£ç æ—¶é—´ /ï¼ˆæ‰§è¡Œç”¨æˆ·ä»£ç æ—¶é—´ + GCæ—¶é—´ï¼‰ã€‚ååé‡æ•°å€¼è¶Šé«˜ï¼Œåƒåœ¾å›æ”¶çš„æ•ˆç‡å°±è¶Šé«˜ï¼Œå…è®¸æ›´å¤šçš„CPUæ—¶é—´å»å¤„ç†ç”¨æˆ·çš„ä¸šåŠ¡ï¼Œç›¸åº”çš„ä¸šåŠ¡ååé‡ä¹Ÿå°±è¶Šé«˜ã€‚</p><h4 id="å»¶è¿Ÿ"><a href="#å»¶è¿Ÿ" class="headerlink" title="å»¶è¿Ÿ"></a>å»¶è¿Ÿ</h4><p>1å»¶è¿ŸæŒ‡çš„æ˜¯ä»ç”¨æˆ·å‘èµ·ä¸€ä¸ªè¯·æ±‚åˆ°æ”¶åˆ°å“åº”è¿™å…¶ä¸­ç»å†çš„æ—¶é—´ã€‚æ¯”å¦‚ä¼ä¸šä¸­å¯¹äºå»¶è¿Ÿçš„è¦æ±‚å¯èƒ½ä¼šæ˜¯è¿™æ ·çš„ï¼š<br>æ‰€æœ‰çš„è¯·æ±‚å¿…é¡»åœ¨5ç§’å†…è¿”å›ç»™ç”¨æˆ·ç»“æœ</p><p>å»¶è¿Ÿ = GCå»¶è¿Ÿ + ä¸šåŠ¡æ‰§è¡Œæ—¶é—´ï¼Œæ‰€ä»¥å¦‚æœGCæ—¶é—´è¿‡é•¿ï¼Œä¼šå½±å“åˆ°ç”¨æˆ·çš„ä½¿ç”¨ã€‚</p><h4 id="å†…å­˜ä½¿ç”¨é‡"><a href="#å†…å­˜ä½¿ç”¨é‡" class="headerlink" title="å†…å­˜ä½¿ç”¨é‡"></a>å†…å­˜ä½¿ç”¨é‡</h4><p>å†…å­˜ä½¿ç”¨é‡æŒ‡çš„æ˜¯Javaåº”ç”¨å ç”¨ç³»ç»Ÿå†…å­˜çš„æœ€å¤§å€¼ï¼Œä¸€èˆ¬é€šè¿‡Jvmå‚æ•°è°ƒæ•´ï¼Œåœ¨æ»¡è¶³ä¸Šè¿°ä¸¤ä¸ªæŒ‡æ ‡çš„å‰æä¸‹ï¼Œè¿™ä¸ªå€¼è¶Šå°è¶Šå¥½ã€‚</p><h3 id="è°ƒä¼˜å·¥å…·"><a href="#è°ƒä¼˜å·¥å…·" class="headerlink" title="è°ƒä¼˜å·¥å…·"></a>è°ƒä¼˜å·¥å…·</h3><h4 id="jstatå·¥å…·"><a href="#jstatå·¥å…·" class="headerlink" title="jstatå·¥å…·"></a>jstatå·¥å…·</h4><p>Jstatå·¥å…·æ˜¯JDKè‡ªå¸¦çš„ä¸€æ¬¾ç›‘æ§å·¥å…·ï¼Œå¯ä»¥æä¾›å„ç§åƒåœ¾å›æ”¶ã€ç±»åŠ è½½ã€ç¼–è¯‘ä¿¡æ¯<br>ç­‰ä¸åŒçš„æ•°æ®ã€‚ä½¿ç”¨æ–¹æ³•ä¸ºï¼š<code>jstat -gc è¿›ç¨‹ID æ¯æ¬¡ç»Ÿè®¡çš„é—´éš”ï¼ˆæ¯«ç§’ï¼‰ ç»Ÿè®¡æ¬¡æ•°</code></p><p>Cä»£è¡¨Capacityå®¹é‡ï¼ŒUä»£è¡¨Usedä½¿ç”¨é‡<br>S â€“ å¹¸å­˜è€…åŒºï¼ŒE â€“ ä¼Šç”¸å›­åŒºï¼ŒO â€“ è€å¹´ä»£ï¼ŒM â€“ å…ƒç©ºé—´<br>YGCã€YGTï¼šå¹´è½»ä»£GCæ¬¡æ•°å’ŒGCè€—æ—¶ï¼ˆå•ä½ï¼šç§’ï¼‰<br>FGCã€FGCTï¼šFull GCæ¬¡æ•°å’ŒFull GCè€—æ—¶<br>GCTï¼šGCæ€»è€—æ—¶</p><h4 id="Visualvmæ’ä»¶"><a href="#Visualvmæ’ä»¶" class="headerlink" title="Visualvmæ’ä»¶"></a>Visualvmæ’ä»¶</h4><h4 id="Prometheus-Grafana"><a href="#Prometheus-Grafana" class="headerlink" title="Prometheus + Grafana"></a>Prometheus + Grafana</h4><h4 id="GCæ—¥å¿—"><a href="#GCæ—¥å¿—" class="headerlink" title="GCæ—¥å¿—"></a>GCæ—¥å¿—</h4><h5 id="åˆ†æGCæ—¥å¿—-GCViewer"><a href="#åˆ†æGCæ—¥å¿—-GCViewer" class="headerlink" title="åˆ†æGCæ—¥å¿— - GCViewer"></a>åˆ†æGCæ—¥å¿— - GCViewer</h5><hr><h2 id="GraalVM"><a href="#GraalVM" class="headerlink" title="GraalVM"></a>GraalVM</h2><p>GraalVMæ˜¯Oracleå®˜æ–¹æ¨å‡ºçš„ä¸€æ¬¾é«˜æ€§èƒ½JDKï¼Œä½¿ç”¨å®ƒäº«å—æ¯”OpenJDKæˆ–è€…OracleJDKæ›´å¥½çš„æ€§èƒ½ã€‚<br>ä¸¤ç§æ¨¡å¼ï¼š</p><ul><li>JITï¼ˆ Just-In-Time ï¼‰æ¨¡å¼ ï¼Œå³æ—¶ç¼–è¯‘æ¨¡å¼ï¼Œåœ¨è¿è¡Œæ—¶å°†çƒ­ç‚¹ä»£ç ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œä»¥æé«˜æ‰§è¡Œæ•ˆç‡ã€‚</li><li>AOTï¼ˆAhead-Of-Timeï¼‰æ¨¡å¼ ï¼Œæå‰ç¼–è¯‘æ¨¡å¼</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥æµ…å‡ºZookeeper</title>
      <link href="/2024/06/17/08/"/>
      <url>/2024/06/17/08/</url>
      
        <content type="html"><![CDATA[<p><a href="https://javaguide.cn/distributed-system/distributed-process-coordination/zookeeper/zookeeper-plus.html">https://javaguide.cn/distributed-system/distributed-process-coordination/zookeeper/zookeeper-plus.html</a></p><h2 id="ZooKeeperæ˜¯ä»€ä¹ˆ"><a href="#ZooKeeperæ˜¯ä»€ä¹ˆ" class="headerlink" title="ZooKeeperæ˜¯ä»€ä¹ˆ"></a>ZooKeeperæ˜¯ä»€ä¹ˆ</h2><p>ZooKeeperæ˜¯ä¸€ä¸ªå¼€æºçš„<strong>åˆ†å¸ƒå¼åè°ƒæœåŠ¡</strong>ï¼Œè®¾è®¡ç›®æ ‡æ˜¯å°†å“ªäº›å¤æ‚ä¸”å®¹æ˜“å‡ºé”™çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§æœåŠ¡å°è£…èµ·æ¥ï¼Œæ„æˆä¸€ä¸ªé«˜æ•ˆçš„åŸè¯­(åŸè¯­çš„æ‰§è¡Œå¿…é¡»è¿ç»­ä¸”ä¸å¯åˆ†å‰²)é›†ï¼Œå¹¶ä»¥ä¸€ç³»åˆ—ç®€å•æ˜“ç”¨çš„æ¥å£æä¾›ç»™ç”¨æˆ·æ—¶ä½¿ç”¨</p><h2 id="å¸¸ç”¨åœºæ™¯"><a href="#å¸¸ç”¨åœºæ™¯" class="headerlink" title="å¸¸ç”¨åœºæ™¯"></a>å¸¸ç”¨åœºæ™¯</h2><ol><li>å‘½åæœåŠ¡ï¼šé€šè¿‡ZooKeepeçš„é¡ºåºèŠ‚ç‚¹ç”Ÿæˆå…¨å±€å”¯ä¸€ID</li><li>æ•°æ®å‘å¸ƒ/è®¢é˜…ï¼šé€šè¿‡Watcheræœºåˆ¶å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°æ•°æ®å‘å¸ƒ/è®¢é˜…ã€‚å…¶ä»–æœºå™¨å¯ä»¥é€šè¿‡ç›‘å¬ZooKeeperä¸Šçš„èŠ‚ç‚¹å˜åŒ–æ¥å®ç°é…ç½®çš„åŠ¨æ€æ›´æ–°</li><li>åˆ†å¸ƒå¼é”ï¼šé€šè¿‡åˆ›å»ºå”¯ä¸€èŠ‚ç‚¹è·å¾—åˆ†å¸ƒå¼é”ï¼Œå½“è·å¾—é”çš„ä¹™æ–¹æ‰§è¡Œå®Œç›¸å…³çš„ä»£ç æˆ–è€…æŒ‚æ‰åå°±é‡Šæ”¾ï¼Œä¹Ÿéœ€è¦ä½¿ç”¨Watcheræœºåˆ¶</li></ol><h2 id="ä¸€äº›å¯ä»¥ä½¿ç”¨çš„åœºæ™¯"><a href="#ä¸€äº›å¯ä»¥ä½¿ç”¨çš„åœºæ™¯" class="headerlink" title="ä¸€äº›å¯ä»¥ä½¿ç”¨çš„åœºæ™¯"></a>ä¸€äº›å¯ä»¥ä½¿ç”¨çš„åœºæ™¯</h2><h3 id="æ‰‹å†™rpc-æ³¨å†Œä¸­å¿ƒ-ä½¿ç”¨ZooKeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒæ‰‹å†™RPC"><a href="#æ‰‹å†™rpc-æ³¨å†Œä¸­å¿ƒ-ä½¿ç”¨ZooKeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒæ‰‹å†™RPC" class="headerlink" title="[[æ‰‹å†™rpc#æ³¨å†Œä¸­å¿ƒ|ä½¿ç”¨ZooKeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒæ‰‹å†™RPC]]"></a>[[æ‰‹å†™rpc#æ³¨å†Œä¸­å¿ƒ|ä½¿ç”¨ZooKeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒæ‰‹å†™RPC]]</h3><h3 id="ä½¿ç”¨ZooKeeperä½œä¸ºåˆ†å¸ƒå¼é”"><a href="#ä½¿ç”¨ZooKeeperä½œä¸ºåˆ†å¸ƒå¼é”" class="headerlink" title="ä½¿ç”¨ZooKeeperä½œä¸ºåˆ†å¸ƒå¼é”"></a>ä½¿ç”¨ZooKeeperä½œä¸ºåˆ†å¸ƒå¼é”</h3><h2 id="é‡è¦æ¦‚å¿µ"><a href="#é‡è¦æ¦‚å¿µ" class="headerlink" title="é‡è¦æ¦‚å¿µ"></a>é‡è¦æ¦‚å¿µ</h2><h3 id="Data-model"><a href="#Data-model" class="headerlink" title="Data model"></a>Data model</h3><p>ZooKeeperæ•°æ®æ¨¡å‹ä½¿ç”¨å±‚æ¬¡åŒ–çš„å¤šå‰æ ‘å½¢ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½å¯ä»¥å­˜å‚¨æ•°æ®ï¼Œè€Œä¸”æ•°æ®å¯ä»¥æ˜¯æ•°å­—ã€å­—ç¬¦ä¸²ã€äºŒè¿›åˆ¶åºåˆ—ã€‚æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰Nä¸ªå­èŠ‚ç‚¹ã€‚æ¯ä¸ªæ•°æ®èŠ‚ç‚¹å«åšznodeï¼Œæ˜¯æ•°æ®çš„æœ€å°å•å…ƒï¼Œæ¯ä¸ªznodeéƒ½æœ‰å”¯ä¸€çš„è·¯å¾„æ ‡è¯†<br><strong>znodeå­˜å‚¨çš„æ•°æ®å¤§å°ä¸Šçº¿ä¸º1M</strong>ï¼Œé¿å…å°†å¤§æ•°æ®ä¿å­˜åœ¨ZooKeeperä¸­</p><h3 id="znode"><a href="#znode" class="headerlink" title="znode"></a>znode</h3><h3 id="åˆ†ç±»ï¼š"><a href="#åˆ†ç±»ï¼š" class="headerlink" title="åˆ†ç±»ï¼š"></a>åˆ†ç±»ï¼š</h3><ul><li>æŒä¹…(PERSISTENT)èŠ‚ç‚¹ï¼šä¸€æ—¦åˆ›å»ºå°±å­˜åœ¨å³ä½¿ZooKeeperé›†ç¾¤å®•æœºï¼ŒçŸ¥é“å°†å…¶åˆ é™¤</li><li>ä¸´æ—¶(<strong>EPHEMERAL</strong>)èŠ‚ç‚¹ï¼šä¸´æ—¶èŠ‚ç‚¹çš„å£°æ˜å‘¨æœŸä¸å®¢æˆ·ç«¯ä¼šè¯ç»‘å®šã€‚ä¼šè¯èŠ‚ç‚¹å°æ—¶åˆ™èŠ‚ç‚¹æ¶ˆå¤±ï¼Œä¸´æ—¶èŠ‚ç‚¹åªèƒ½ä½œä¸ºå¶å­èŠ‚ç‚¹ï¼Œä¸å¯åˆ›å»ºå±äºè‡ªå·±çš„å­èŠ‚ç‚¹ã€‚</li><li>æŒä¹…é¡ºåºèŠ‚ç‚¹ï¼šé™¤äº†å…·æœ‰æŒä¹…èŠ‚ç‚¹å¤–ï¼Œå­èŠ‚ç‚¹çš„åç§°è¿˜æœ‰é¡ºåºæ€§ã€‚</li></ul><h3 id="znodeçš„ç»„æˆï¼š"><a href="#znodeçš„ç»„æˆï¼š" class="headerlink" title="znodeçš„ç»„æˆï¼š"></a>znodeçš„ç»„æˆï¼š</h3><ul><li>statï¼šçŠ¶æ€ä¿¡æ¯<img src="/2024/06/17/08/znode%E7%8A%B6%E6%80%81%E4%BF%A1%E6%81%AF.png"></li><li>dataï¼šèŠ‚ç‚¹å­˜æ”¾æ•°æ®çš„å…·ä½“å†…å®¹</li></ul><h3 id="ç‰ˆæœ¬ï¼š"><a href="#ç‰ˆæœ¬ï¼š" class="headerlink" title="ç‰ˆæœ¬ï¼š"></a>ç‰ˆæœ¬ï¼š</h3><p>ZooKeeperä¼šä¸ºæ¯ä¸€ä¸ªznodeç»´æŠ¤ä¸€ä¸ªå«åšStatçš„æ•°æ®ç»“æ„<br>Statä¸­è®°å½•äº†ä¸‰ä¸ªznodeç›¸å…³çš„ç‰ˆæœ¬ï¼š</p><ul><li>dataVersionï¼šå½“å‰znodeèŠ‚ç‚¹çš„ç‰ˆæœ¬å·</li><li>cversionï¼šå½“å‰znodeå­èŠ‚ç‚¹çš„ç‰ˆæœ¬</li><li>aclVersionï¼šå½“å‰znodeçš„ACLçš„ç‰ˆæœ¬</li></ul><h3 id="ACLï¼šæƒé™æ§åˆ¶"><a href="#ACLï¼šæƒé™æ§åˆ¶" class="headerlink" title="ACLï¼šæƒé™æ§åˆ¶"></a>ACLï¼šæƒé™æ§åˆ¶</h3><ul><li>CREATEï¼šåˆ›å»ºå­èŠ‚ç‚¹</li><li>READï¼šè·å–èŠ‚ç‚¹æ•°æ®å’Œåˆ—å‡ºå…¶å­èŠ‚ç‚¹</li><li>WRITEï¼šè®¾ç½®/æ›´æ–°èŠ‚ç‚¹æ•°æ®</li><li>DELETEï¼šåˆ é™¤å­èŠ‚ç‚¹</li><li>ADMINï¼šè®¾ç½®èŠ‚ç‚¹ACLçš„æƒé™<br>èº«ä»½è®¤è¯æœ‰å››ç§æ–¹å¼ï¼š</li><li>worldï¼šé»˜è®¤ï¼Œä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥æ— æ¡ä»¶è®¿é—®</li><li>auth ï¼š ä¸é€‚ç”¨ä»»ä½•idï¼Œä»£è¡¨ä»»ä½•å·²ç»è®¤è¯çš„ç”¨æˆ·</li><li>digestï¼šç”¨æˆ·å:å¯†ç çš„æ–¹å¼</li><li>ipï¼šå¯¹æŒ‡å®šipè¿›è¡Œé™åˆ¶</li></ul><h2 id="Watcher-äº‹ä»¶ç›‘å¬å™¨"><a href="#Watcher-äº‹ä»¶ç›‘å¬å™¨" class="headerlink" title="Watcher(äº‹ä»¶ç›‘å¬å™¨)"></a>Watcher(äº‹ä»¶ç›‘å¬å™¨)</h2><p>ZooKeeperå…è®¸ç”¨æˆ·åœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€äº›Watcherï¼Œå¹¶ä¸”åœ¨ä¸€äº›ç‰¹å®šäº‹ä»¶è§¦å‘æ—¶ï¼ŒZooKeeperæœåŠ¡å™¨ä¼šå°†äº‹ä»¶é€šçŸ¥åˆ°æ„Ÿå…´è¶£çš„å®¢æˆ·ç«¯ä¸Šã€‚<img src="/2024/06/17/08/watcher%E7%9A%84%E4%BD%9C%E7%94%A8.png"></p><h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p>ZooKeeperæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„ä¸€ä¸ªTCPé•¿è¿æ¥ã€‚å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡å®ƒè¿›è¡Œå¿ƒè·³æ£€æµ‹ä¸æœåŠ¡å™¨ä¿æŒæœ‰æ•ˆçš„ä¼šè¯ï¼Œä¹Ÿèƒ½å¤Ÿå‘ZooKeeperæœåŠ¡å™¨å‘é€è¯·æ±‚å¹¶æ¥å—å“åº”ã€‚åŒæ—¶ä¹Ÿèƒ½æ¥æ”¶æ¥åœ¨æœåŠ¡å™¨çš„Watcheräº‹ä»¶é€šçŸ¥</p><h2 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h2><h3 id="ZooKeeperå°†é›†ç¾¤ä¸­èŠ‚ç‚¹çš„è§’è‰²åˆ†ä¸ºä¸‰ç±»ï¼š"><a href="#ZooKeeperå°†é›†ç¾¤ä¸­èŠ‚ç‚¹çš„è§’è‰²åˆ†ä¸ºä¸‰ç±»ï¼š" class="headerlink" title="ZooKeeperå°†é›†ç¾¤ä¸­èŠ‚ç‚¹çš„è§’è‰²åˆ†ä¸ºä¸‰ç±»ï¼š"></a>ZooKeeperå°†é›†ç¾¤ä¸­èŠ‚ç‚¹çš„è§’è‰²åˆ†ä¸ºä¸‰ç±»ï¼š</h3><ul><li>Leader ä¸ºå®¢æˆ·ç«¯æä¾›è¯»å†™æœåŠ¡ï¼Œè´Ÿè´£æŠ•ç¥¨çš„å‘èµ·å’Œå†³è®®ï¼Œæ›´æ–°ç³»ç»ŸçŠ¶æ€</li><li>Followerï¼š<strong>åªè¯»</strong>ï¼Œå°†å†™æœåŠ¡è½¬å‘ç»™Leaderï¼Œå‚ä¸é€‰ä¸¾è¿‡ç¨‹çš„å¤´ç¥¨</li><li>Observerï¼š<strong>åªè¯»</strong>ï¼Œå†™æœåŠ¡è½¬å‘ç»™Leaderï¼Œä¸å‚ä¸é€‰ä¸¾ä¸­çš„æŠ•ç¥¨ï¼Œä¹Ÿä¸å‚ä¸â€è¿‡åŠå†™æˆåŠŸâ€ç­–ç•¥ã€‚ åœ¨ä¸å½±å“å†™æ€§èƒ½çš„æƒ…å†µä¸‹æå‡é›†ç¾¤çš„è¯»æ€§èƒ½ã€‚</li></ul><h3 id="Leaderçš„é€‰ä¸¾è¿‡ç¨‹"><a href="#Leaderçš„é€‰ä¸¾è¿‡ç¨‹" class="headerlink" title="Leaderçš„é€‰ä¸¾è¿‡ç¨‹"></a>Leaderçš„é€‰ä¸¾è¿‡ç¨‹</h3><p>æ¡ä»¶ï¼š<br>å½“LeaderæœåŠ¡å™¨å‡ºç°ç½‘ç»œä¸­æ–­ã€å´©æºƒé€€å‡ºä¸é‡å¯ç­‰å¼‚å¸¸æƒ…å†µæ˜¯ï¼Œä¼šè¿›å»Leaderé€‰ä¸¾è¿‡ç¨‹ã€‚<br>æµç¨‹ï¼š</p><ol><li>Leader election é€‰ä¸¾é˜¶æ®µï¼šå¼€å§‹æŠ•ç¥¨ï¼Œåªè¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹è·å¾—è¿‡åŠèŠ‚ç‚¹çš„ç¥¨æ•°å³å¯ä½œä¸ºå‡†Leader</li><li>Discoveryå‘ç°é˜¶æ®µï¼šfollowersè·Ÿå‡†èŠ‚ç‚¹leaderè¿›è¡Œé€šä¿¡ï¼ŒåŒæ­¥followersæœ€è¿‘æ¥æ”¶çš„äº‹åŠ¡æè®®</li><li>Synchronization åŒæ­¥é˜¶æ®µï¼šåˆ©ç”¨leaderå‰ä¸€é˜¶æ®µè·å¾—çš„æœ€æ–°æè®®å†å²ï¼ŒåŒæ­¥é›†ç¾¤ä¸­æ‰€æœ‰çš„å‰¯æœ¬ï¼ŒåŒæ­¥ä¹‹åï¼Œå‡†leaderæˆä¸ºæ­£å¼èŠ‚ç‚¹</li><li>Broadcast å¹¿æ’­é˜¶æ®µï¼šZookeeperé›†ç¾¤æ­£å¼å¯¹å¤–æä¾›äº‹åŠ¡æœåŠ¡ï¼ŒleaderåŠé€†è¡Œæ¶ˆæ¯å¹¿æ’­ï¼Œå¦‚æœæœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥ï¼Œè¿˜éœ€è¦è¿›è¡ŒåŒæ­¥<br>èŠ‚ç‚¹çš„çŠ¶æ€ï¼š</li></ol><ul><li>LOOKINGï¼šå¯»æ‰¾Leader</li><li>LEADINGï¼šLeaderçŠ¶æ€ï¼Œå¯¹åº”çš„èŠ‚ç‚¹æˆä¸ºLeader</li><li>FOLLOWINGï¼šå¯¹åº”çš„èŠ‚ç‚¹æˆä¸ºFollower</li><li>OBSERVINGï¼šå¯¹åº”çš„èŠ‚ç‚¹æˆä¸ºOBSERVING<br>è„‘è£‚é—®é¢˜é€šè¿‡è¿‡åŠæœºåˆ¶è§£å†³</li></ul><h2 id="ZABåè®®"><a href="#ZABåè®®" class="headerlink" title="ZABåè®®"></a>ZABåè®®</h2><p>ZooKeeper Atomic Broadcastï¼ŒåŸå­å¹¿æ’­<br>###3 æ¨¡å¼</p><ul><li>å´©æºƒæ¢å¤ï¼šå¯åŠ¨æˆ–è€…å‡ºç°å¼‚å¸¸çŠ¶å†µæ—¶ï¼Œè¿›è¡Œå´©æºƒæ¢å¤çŠ¶æ€ï¼Œå½“é€‰ä¸¾å‡ºæ–°çš„LeaderèŠ‚ç‚¹ï¼Œå¹¶ä¸”å·²ç»è¿›è¡ŒçŠ¶æ€åŒæ­¥ä¹‹åï¼Œé€€å‡ºæ¢å¤çŠ¶æ€ã€‚</li><li>æ¶ˆæ¯å¹¿æ’­ï¼šå½“é›†ç¾¤ä¸­å·²ç»å®ŒæˆçŠ¶æ€é€šè¿‡ï¼Œæ•´ä¸ªæœåŠ¡æ¶æ„è¿›å…¥æ¶ˆæ¯å¹¿æ’­æ¨¡å¼ã€‚æ–°åŠ å…¥çš„èŠ‚ç‚¹ä¼šè‡ªè§‰è¿›å…¥æ•°æ®æ¢å¤çŠ¶æ€ã€‚</li></ul><h2 id="å¸¸è§çš„Java-API"><a href="#å¸¸è§çš„Java-API" class="headerlink" title="å¸¸è§çš„Java API"></a>å¸¸è§çš„Java API</h2><blockquote><p>curator-x-discoveryæ˜¯ Apache Curator åº“ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºç®€åŒ–ä¸ Apache ZooKeeper äº¤äº’æ—¶çš„æœåŠ¡å‘ç°å’Œæ³¨å†ŒåŠŸèƒ½</p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ServiceDiscovery</span> ç”¨äºç®¡ç†æœåŠ¡çš„æ³¨å†Œå’Œå‘ç°<span class="token class-name">ServiceInstance</span> æè¿°ä¸€ä¸ªæœåŠ¡çš„ä¿¡æ¯<span class="token class-name">CuratorFramework</span> zkè¿æ¥å®¢æˆ·ç«¯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zookeeper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RPC</title>
      <link href="/2024/06/17/36/"/>
      <url>/2024/06/17/36/</url>
      
        <content type="html"><![CDATA[<h1 id="RPCï¼ˆRemote-Procedure-Callï¼‰-è¿œç¨‹è°ƒç”¨"><a href="#RPCï¼ˆRemote-Procedure-Callï¼‰-è¿œç¨‹è°ƒç”¨" class="headerlink" title="RPCï¼ˆRemote Procedure Callï¼‰ è¿œç¨‹è°ƒç”¨"></a><strong>RPCï¼ˆRemote Procedure Callï¼‰</strong> è¿œç¨‹è°ƒç”¨</h1><h2 id="RPCåŸç†"><a href="#RPCåŸç†" class="headerlink" title="RPCåŸç†"></a>RPCåŸç†</h2><p>å¯ä»¥åˆ†ä¸ºäº”ä¸ªéƒ¨åˆ†å®ç°</p><ol><li>å®¢æˆ·ç«¯(æœåŠ¡æ¶ˆè´¹ç«¯)ï¼š è°ƒç”¨æ–¹æ³•çš„ä¸€ç«¯</li><li>å®¢æˆ·ç«¯Stub(æ¡©):ä»£ç†ç±»ï¼Œå°†è°ƒç”¨çš„æ–¹æ³•ã€ç±»ã€æ–¹æ³•å‚æ•°ä½œä¸ºä¿¡æ¯ä¼ é€’åˆ°æœåŠ¡ç«¯</li><li>ç½‘ç»œä¼ è¾“: å°†ä¿¡æ¯ä¼ è¾“åˆ°æœåŠ¡ç«¯ï¼Œå¹¶ä¸”å°†è¿”å›ç»“æœå‘æŒ¥ç»™è°ƒç”¨ç«¯ï¼Œæ¨èä½¿ç”¨Netty</li><li>æœåŠ¡ç«¯Stub: æ¥æ”¶ä¿¡æ¯ï¼Œå»æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ï¼Œå°†ç»“æœè¿”å›</li><li>æœåŠ¡ç«¯(æœåŠ¡æä¾›ç«¯): æä¾›æœåŠ¡çš„ä¸€ç«¯<br>è¿‡ç¨‹ï¼š</li><li>æœåŠ¡æ¶ˆè´¹ç«¯clientä»¥æœ¬åœ°è°ƒç”¨çš„æ–¹å¼å»è°ƒç”¨è¿œç¨‹æœåŠ¡</li><li>å®¢æˆ·ç«¯Stub (client stud) æ¥æ”¶è°ƒç”¨åå°†æ–¹æ³•ã€å‚æ•°ç­‰ç»„è£…è¿›èƒ½å¤Ÿè¿›è¡Œç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“(åºåˆ—åŒ–ä¹‹å) : RpcRequest</li><li>å®¢æˆ·ç«¯Stub æ‰¾åˆ°è¿œç¨‹æœåŠ¡çš„åœ°å€ï¼Œå°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡æä¾›ç«¯</li><li>æœåŠ¡ç«¯Stub æ”¶åˆ°æ¶ˆæ¯åï¼Œååºåˆ—åŒ–ä¸ºRpcRequest å¯¹è±¡</li><li>æœåŠ¡ç«¯Stub æ ¹æ®RpcRequestä¸­çš„ç±»ï¼Œæ–¹æ³•ï¼Œæ–¹æ³•å‚æ•°ç­‰ä¿¡æ¯è°ƒç”¨æœ¬åœ°æ–¹æ³•1</li><li>æœåŠ¡ç«¯Stub å°†å¾—åˆ°çš„ç»“æœå°è£…ä¸º RpcResponseåºåˆ—åŒ–åå‘é€ç»™æ¶ˆè´¹æ–¹</li><li>å®¢æˆ·ç«¯Stubæ¥æ”¶æ¶ˆæ¯å¹¶å°†å…¶ååºåˆ—åŒ–ä¸ºRpcReponse</li></ol><h2 id="Invokeræ˜¯ä»€ä¹ˆ"><a href="#Invokeræ˜¯ä»€ä¹ˆ" class="headerlink" title="Invokeræ˜¯ä»€ä¹ˆ"></a>Invokeræ˜¯ä»€ä¹ˆ</h2><p>Inboker æ˜¯Dubboå¯¹è¿œç¨‹è°ƒç”¨çš„æŠ½è±¡<img src="/2024/06/17/36/invoker.png"></p><h2 id="Dubbo-çš„SPIæœºåˆ¶"><a href="#Dubbo-çš„SPIæœºåˆ¶" class="headerlink" title="Dubbo çš„SPIæœºåˆ¶"></a>Dubbo çš„SPIæœºåˆ¶</h2><p>SPI (Service Provider Interface)ï¼šå°†æ¥å£çš„å®ç°æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œåœ¨ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ä¸­è¯»å–é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡åå°„åŠ è½½å®ç°ç±»ã€‚ä¹Ÿå°±æ˜¯æä¾›æ¥å£ï¼Œå…è®¸ç¬¬ä¸‰æ–¹å®ç°è¿™ä¸ªæ¥å£</p><h2 id="Dubbo-çš„å¾®å†…æ ¸æ¶æ„"><a href="#Dubbo-çš„å¾®å†…æ ¸æ¶æ„" class="headerlink" title="Dubbo çš„å¾®å†…æ ¸æ¶æ„"></a>Dubbo çš„å¾®å†…æ ¸æ¶æ„</h2><blockquote><p>å¾®å†…æ ¸æ¶æ„æ¨¡å¼åˆåæ’ä»¶æ¶æ„æ¨¡å¼ï¼Œæ˜¯åŸºäºäº§å“åº”ç”¨ç¨‹åºçš„ä¸€ç§è‡ªç„¶æ¨¡å¼ã€‚å…è®¸ç”¨æˆ·æ·»åŠ é¢å¤–çš„åº”ç”¨åˆ°æ ¸å¿ƒåº”ç”¨ã€‚ä¾‹å¦‚IDE</p></blockquote><h2 id="Dubboçš„è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#Dubboçš„è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="Dubboçš„è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>Dubboçš„è´Ÿè½½å‡è¡¡ç­–ç•¥</h2>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼</title>
      <link href="/2024/06/16/16/"/>
      <url>/2024/06/16/16/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h1><p>è®¾è®¡æ¨¡å¼æ˜¯â¼€å¥—è¢«åå¤ä½¿â½¤çš„ã€å¤šæ•°â¼ˆçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–â½¬çš„ã€ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ã€‚</p><h2 id="è®¾è®¡æ¨¡å¼çš„åŸåˆ™"><a href="#è®¾è®¡æ¨¡å¼çš„åŸåˆ™" class="headerlink" title="è®¾è®¡æ¨¡å¼çš„åŸåˆ™"></a>è®¾è®¡æ¨¡å¼çš„åŸåˆ™</h2><ol><li>å¼€é—­åŸåˆ™ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</li><li>å•ä¸€èŒè´£åŸï¼šä¸€ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½é¢†åŸŸä¸­çš„ç›¸åº”èŒè´£</li><li>é‡Œæ°æ›¿æ¢åŸåˆ™ï¼šæ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»å¯¹è±¡</li><li>ä¾èµ–å€’ç½®åŸåˆ™ï¼šä»¥æ¥æœˆæŠ½è±¡ï¼Œä¸èƒ½ä¾èµ–äºå…·ä½“å®ç°</li><li>æ¥å£éš”ç¦»åŸåˆ™ï¼šç±»ä¹‹é—´çš„ä¾èµ–å…³ç³»åº”è¯¥ç®€å†åœ¨æœ€å°æ¥å£ä¸Š</li><li>åˆæˆ/èšåˆå¤ç”¨åŸåˆ™ï¼šå°½é‡ä½¿ç”¨åˆæˆ/èšåˆï¼Œè€Œä¸æ˜¯é€šè¿‡ç»§æ‰¿è¾¾åˆ°å¤ç”¨çš„ç›®çš„ã€‚</li><li>è¿ªç±³ç‰¹æ³•åˆ™ï¼šä¸€ä¸ªè½¯ä»¶å®ä½“åº”è¯¥å°½é‡å°‘çš„ä¸å…¶ä»–å®ä½“å‘ç”Ÿç›¸äº’ä½œç”¨</li></ol><h2 id="è®¾è®¡æ¨¡å¼çš„åˆ†ç±»"><a href="#è®¾è®¡æ¨¡å¼çš„åˆ†ç±»" class="headerlink" title="è®¾è®¡æ¨¡å¼çš„åˆ†ç±»"></a>è®¾è®¡æ¨¡å¼çš„åˆ†ç±»</h2><ul><li>åˆ›å»ºå‹ï¼šåœ¨åˆ›å»ºå¯¹è±¡çš„åŒæ—¶éšè—åˆ›å»ºé€»è¾‘ï¼Œä¸é€‚ç”¨new ç›´æ¥å®ä¾‹åŒ–å¯¹è±¡ã€‚ ä¸»è¦æœ‰ å·¥å‚/æŠ½è±¡å·¥å‚/å•ä¾‹/åˆ›é€ è€…/åŸå‹æ¨¡å¼</li><li>ç»“æ„å‹ï¼šé€šè¿‡ç±»å’Œæ¥å£é—´çš„ç»§æ‰¿å’Œå¼•ç”¨å®ç°åˆ›å»ºè´Ÿè´£ç»“æ„çš„å¯¹è±¡ã€‚åŒ…æ‹¬é€‚é…å™¨/æ¡¥æ¥æ¨¡å¼/è¿‡æ»¤å™¨/ç»„åˆ/è£…é¥°å™¨/å¤–è§‚/äº«å…ƒ/ä»£ç†æ¨¡å¼</li><li>è¡Œä¸ºå‹ï¼šé€šè¿‡ç±»ä¹‹é—´ä¸åŒé€šä¿¡æ–¹å¼å®ç°ä¸åŒè¡Œä¸ºï¼ŒåŒ…æ‹¬è´£ä»»é“¾/å‘½å/è§£é‡Šå™¨/è¿­ä»£å™¨/ç»ˆç»“è€…/å¤‡å¿˜å½•/è§‚å¯Ÿè€…/çŠ¶æ€/ç­–ç•¥/æ¨¡æ¿/è®¿é—®è€…æ¨¡å¼<br><img src="/2024/06/16/16/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%88%86%E7%B1%BB.png"></li></ul><h3 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h3><h4 id="ç®€å•å·¥å‚"><a href="#ç®€å•å·¥å‚" class="headerlink" title="ç®€å•å·¥å‚"></a>ç®€å•å·¥å‚</h4><p>ç”±ä¸€ä¸ªå·¥å‚å¯¹è±¡æ¥åˆ›å»ºå®ä¾‹ï¼Œå®¢æˆ·ä½†ä¸éœ€è¦å…³æ³¨åˆ›å»ºé€»è¾‘ï¼Œåªéœ€è¦ä¼ é€’å·¥å‚å‚æ•°ã€‚</p><h4 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h4><p>å·¥å‚æ–¹æ³•æ¨¡å¼å°†å…·ä½“äº§å“çš„ä»»åŠ¡åˆ†å‘ç»™å…·ä½“çš„äº§å“å·¥å‚ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæŠ½è±¡å·¥å‚ï¼Œå®šä¹‰ç”Ÿäº§æ¥å£ä½†æ˜¯ä¸è´Ÿè´£å…·ä½“çš„äº§å“ã€‚</p><h4 id="æŠ½è±¡å·¥å‚"><a href="#æŠ½è±¡å·¥å‚" class="headerlink" title="æŠ½è±¡å·¥å‚"></a>æŠ½è±¡å·¥å‚</h4><p>ç®€å•å’Œæ–¹æ³•åªæ˜¯é’ˆå¯¹ä¸€ç±»äº§å“ã€‚<br>æŠ½è±¡å·¥å‚é€šè¿‡åœ¨AbstactFactoryä¸­å¢å‡åˆ›å»ºäº§å“çš„æ¥å£ï¼Œç„¶åç”±å­ç±»å·¥å‚å»å®ç°æ–°å¢äº§å“çš„åˆ›å»ºã€‚</p><h3 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h3><p>å•ä¾‹æ¨¡å¼æ˜¯åˆ›å»ºå‹æ¨¡å¼ï¼Œä»»ä½•æƒ…å†µä¸‹åªå­˜åœ¨ä¸€ä¸ªå®ä¾‹ï¼Œæ„é€ æ–¹æ³•å¿…é¡»æ˜¯ç§æœ‰ï¼Œç”±è‡ªå·±åˆ›å»ºä¸€ä¸ªé™æ€å˜é‡å­˜å‚¨å®ä¾‹ï¼Œå¯¹å¤–æä¾›ä¸€ä¸ªé™æ€å…¬æœ‰æ–¹æ³•è·å–å®ä¾‹ã€‚<br>ä¼˜ç‚¹æ˜¯åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘äº†å¼€é”€ã€‚</p><h4 id="å¸¸è§çš„å†™æ³•"><a href="#å¸¸è§çš„å†™æ³•" class="headerlink" title="å¸¸è§çš„å†™æ³•"></a>å¸¸è§çš„å†™æ³•</h4><h5 id="é¥¿æ±‰å¼"><a href="#é¥¿æ±‰å¼" class="headerlink" title="é¥¿æ±‰å¼"></a>é¥¿æ±‰å¼</h5><p>ç±»â¼€åŠ è½½å°±åˆ›å»ºå¯¹è±¡</p><p>ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œæ²¡æœ‰åŠ é”ï¼Œæ‰§â¾æ•ˆç‡è¾ƒâ¾¼<br>ç¼ºç‚¹ï¼šä¸æ˜¯æ‡’åŠ è½½ï¼Œç±»åŠ è½½æ—¶å°±åˆå§‹åŒ–ï¼Œæµªè´¹å†…å­˜ç©ºé—´</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span> <span class="token comment">// 1ã€ç§æœ‰åŒ–æ„é€ â½…æ³•</span> <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 2ã€å®šä¹‰â¼€ä¸ªé™æ€å˜é‡æŒ‡å‘â¾ƒâ¼°ç±»å‹</span> <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token keyword">new</span><span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3ã€å¯¹å¤–æä¾›â¼€ä¸ªå…¬å…±çš„â½…æ³•è·å–å®ä¾‹</span> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> instance<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="æ‡’æ±‰å¼"><a href="#æ‡’æ±‰å¼" class="headerlink" title="æ‡’æ±‰å¼"></a>æ‡’æ±‰å¼</h5><p>å•çº¿ç¨‹æ¨¡å¼ä¸‹æ²¡é—®é¢˜ï¼Œå¤šçº¿ç¨‹æ— æ³•ä¿è¯å•ä¾‹<br>ä¼˜ç‚¹æ˜¯ï¼šæ‡’åŠ è½½<br>ç¼ºç‚¹æ˜¯ï¼šçº¿ç¨‹å®‰å…¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span> <span class="token comment">// 1ã€ç§æœ‰åŒ–æ„é€ â½…æ³•</span> <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token comment">// 2ã€å®šä¹‰â¼€ä¸ªé™æ€å˜é‡æŒ‡å‘â¾ƒâ¼°ç±»å‹</span> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span> <span class="token comment">// 3ã€å¯¹å¤–æä¾›â¼€ä¸ªå…¬å…±çš„â½…æ³•è·å–å®ä¾‹</span> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// åˆ¤æ–­ä¸º null çš„æ—¶å€™å†åˆ›å»ºå¯¹è±¡</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">return</span> instance<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å¼"><a href="#çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å¼" class="headerlink" title="çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å¼"></a>çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å¼</h4><p>ä½¿ç”¨synchronizedå…³é”®å­—æ·é”ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚å¯ä»¥åŠ åœ¨æ–¹æ³•ä¸Šé¢ï¼Œä¹Ÿå¯ä»¥æ·»åŠ åœ¨ä»£ç å—ä¸Šé¢ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span> <span class="token comment">// 1ã€ç§æœ‰åŒ–æ„é€ â½…æ³•</span> <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token comment">// 2ã€å®šä¹‰â¼€ä¸ªé™æ€å˜é‡æŒ‡å‘â¾ƒâ¼°ç±»å‹</span> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span> <span class="token comment">// 3ã€å¯¹å¤–æä¾›â¼€ä¸ªå…¬å…±çš„â½…æ³•è·å–å®ä¾‹</span> <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">return</span> instance<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h3><p>é€‚é…å™¨æ¨¡å¼å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬åŒ–ä¸ºç”¨æˆ·æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œè®©åŸæœ¬ä¸¤ä¸ªä¸å…¼å®¹çš„æ¥å£èƒ½å¤Ÿæ— ç¼å®Œæˆå¯¹æ¥ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ol><li>æâ¾¼äº†ç±»çš„å¤â½¤ï¼›</li><li>ç»„åˆè‹¥â¼²å…³è”å¯¹è±¡å½¢æˆå¯¹å¤–æä¾›ç»Ÿâ¼€æœåŠ¡çš„æ¥â¼ï¼›</li><li>æ‰©å±•æ€§ã€çµæ´»æ€§å¥½ã€‚<br>ç¼ºç‚¹ï¼š</li><li>è¿‡å¤šä½¿â½¤é€‚é…æ¨¡å¼å®¹æ˜“é€ æˆä»£ç åŠŸèƒ½å’Œé€»è¾‘æ„ä¹‰çš„æ··æ·†ã€‚</li><li>éƒ¨åˆ†è¯­â¾”å¯¹ç»§æ‰¿çš„é™åˆ¶ï¼Œå¯èƒ½â¾„å¤šåªèƒ½é€‚é…â¼€ä¸ªé€‚é…è€…ç±»ï¼Œâ½½ä¸”â½¬æ ‡ç±»å¿…é¡»æ˜¯æŠ½è±¡ç±»</li></ol><h4 id="ç±»é€‚é…å™¨"><a href="#ç±»é€‚é…å™¨" class="headerlink" title="ç±»é€‚é…å™¨"></a>ç±»é€‚é…å™¨</h4><p>é€šè¿‡ç±»ç»§æ‰¿ï¼Œç»§æ‰¿Targetæ¥å£ï¼Œç»§æ‰¿Adapteeçš„å®ç°</p><h4 id="å¯¹è±¡é€‚é…å™¨"><a href="#å¯¹è±¡é€‚é…å™¨" class="headerlink" title="å¯¹è±¡é€‚é…å™¨"></a>å¯¹è±¡é€‚é…å™¨</h4><p>é€šè¿‡ç±»å¯¹è±¡ç»„åˆå®ç°é€‚é…</p><h3 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h3><p>æœ¬è´¨æ˜¯ä¸€ä¸ªä¸­é—´ä»¶ï¼Œä¸»è¦ç›®çš„æ˜¯è§£è€¦æœåŠ¡çš„æä¾›è€…å’Œä½¿ç”¨è€…ï¼Œä½¿ç”¨è€…é€šè¿‡ä»£ç†é—´æ¥çš„è®¿é—®æœåŠ¡æä¾›è€…ã€‚<br>æ˜¯ä¸€ç§ç»“æ„æ€§æ¨¡å¼</p><h4 id="åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„åŒºåˆ«"><a href="#åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„åŒºåˆ«" class="headerlink" title="åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„åŒºåˆ«"></a>åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„åŒºåˆ«</h4><p>åŠ¨æ€ä»£ç†<br>åŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºä»£ç†å¯¹è±¡çš„æœºåˆ¶ã€‚ä»£ç†å¯¹è±¡å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸå§‹å¯¹è±¡ä»£ç çš„æƒ…å†µä¸‹ï¼Œæ‹¦æˆªå¯¹ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ï¼Œå¹¶åœ¨è°ƒç”¨å‰åæ·»åŠ é¢å¤–çš„é€»è¾‘ã€‚Java ä¸­çš„åŠ¨æ€ä»£ç†ä¸»è¦æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š<br>é™æ€ä»£ç†<br>é™æ€ä»£ç†æ˜¯åœ¨ç¼–è¯‘æ—¶åˆ›å»ºä»£ç†ç±»çš„æœºåˆ¶ã€‚ä»£ç†ç±»åœ¨ç¼–è¯‘æ—¶å°±å·²ç»å­˜åœ¨ï¼Œå¹¶ä¸”å®ç°äº†ä¸ç›®æ ‡å¯¹è±¡ç›¸åŒçš„æ¥å£ã€‚é™æ€ä»£ç†é€šè¿‡åœ¨ä»£ç†ç±»ä¸­è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•æ¥å®ç°å¯¹ç›®æ ‡å¯¹è±¡çš„ä»£ç†ã€‚</p><ol><li>åŠ¨æ€ä»£ç†ä¸éœ€è¦å®ç°æ¥å£å¯ä»¥ç›´æ¥ä»£ç†å®ç°ç±»ï¼Œå¹¶ä¸”å¯ä»¥ä¸è®¸å“Ÿå•Šé’ˆå¯¹æ¯ä¸ªç›®æ ‡ç±»éƒ½åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ã€‚é™æ€ä»£ç†ä¸­æ¥å£ä¸€æ—¦è¦æ–°å¢æ–¹æ³•ï¼Œç›®æ ‡å¯¹è±¡å’Œä»£ç†å¯¹è±¡éƒ½éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚</li><li>JVMå±‚é¢ï¼šé™æ€ä»£ç†åœ¨ç¼–è¯‘æ—¶å°±å°†ã€æ¥å£ã€å®ç°ç±»ã€ä»£ç†ç±»è¿™äº›éƒ½å˜æˆä¸€ä¸ªä¸ªå®é™…çš„classæ–‡ä»¶ã€‚ åŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆç±»å­—èŠ‚ç ï¼Œå¹¶ä¸”åŠ è½½åˆ°JVMä¸­ã€‚</li></ol><h3 id="è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h3><p>è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡è¡Œä¸ºæ¨¡å¼ï¼Œä½å“Ÿå•Šå¤„ç†å¯¹è±¡ä¹‹é—´çš„ä¸€å¯¹å¤šå…³ç³»ã€‚å½“ä¸€ä¸ªå¯¹è±¡çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰€æœ‰è¯¥å¯¹è±¡çš„å…³æ³¨ç€éƒ½èƒ½æ”¶åˆ°çŠ¶æ€å˜åŒ–é€šçŸ¥è¿›è¡Œå“åº”çš„å¤„ç†</p><p>ä¼˜ç‚¹ï¼š</p><ol><li>è¢«è§‚å¯Ÿè€…å’Œè§‚å¯Ÿè€…ä¹‹é—´æ˜¯æŠ½è±¡è€¦åˆçš„ï¼›</li><li>è€¦åˆåº¦è¾ƒä½ï¼Œä¸¤è€…ä¹‹é—´çš„å…³è”ä»…ä»…åœ¨äºæ¶ˆæ¯çš„é€šçŸ¥</li><li>è¢«è§‚å¯Ÿè€…â½†éœ€å…³â¼¼ä»–çš„è§‚å¯Ÿè€…ï¼›</li><li>â½€æŒâ¼´æ’­é€šä¿¡ï¼›</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>è§‚å¯Ÿè€…åªçŸ¥é“è¢«è§‚å¯Ÿå¯¹è±¡å‘â½£äº†å˜åŒ–ï¼Œä½†ä¸çŸ¥å˜åŒ–çš„è¿‡ç¨‹å’Œç¼˜ç”±ï¼›</li><li>è§‚å¯Ÿè€…åŒæ—¶ä¹Ÿå¯èƒ½æ˜¯è¢«è§‚å¯Ÿè€…ï¼Œæ¶ˆæ¯ä¼ é€’çš„é“¾è·¯å¯èƒ½ä¼šè¿‡â»“ï¼Œå®Œæˆæ‰€æœ‰é€šçŸ¥èŠ±è´¹æ—¶é—´è¾ƒå¤šï¼›</li><li>å¦‚æœè§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ä¹‹é—´äº§â½£å¾ªç¯ä¾èµ–ï¼Œæˆ–è€…æ¶ˆæ¯ä¼ é€’é“¾è·¯å½¢æˆé—­ç¯ï¼Œä¼šå¯¼è‡´â½†é™å¾ªç¯ï¼›</li></ol><h4 id="ä½ çš„é¡¹â½¬æ˜¯æ€ä¹ˆâ½¤çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ"><a href="#ä½ çš„é¡¹â½¬æ˜¯æ€ä¹ˆâ½¤çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ" class="headerlink" title="ä½ çš„é¡¹â½¬æ˜¯æ€ä¹ˆâ½¤çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ"></a>ä½ çš„é¡¹â½¬æ˜¯æ€ä¹ˆâ½¤çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ</h4><blockquote><p>åœ¨â½€ä»˜åœºæ™¯ä¸‹ï¼Œâ½¤æˆ·è´­ä¹°â¼€ä»¶å•†å“ï¼Œå½“â½€ä»˜æˆåŠŸä¹‹åä¸‰â½…ä¼šå›è°ƒâ¾ƒèº«ï¼Œåœ¨è¿™ä¸ªæ—¶å€™ç³»ç»Ÿå¯èƒ½ä¼šæœ‰å¾ˆå¤šéœ€è¦æ‰§â¾çš„é€»è¾‘ï¼ˆå¦‚ï¼šæ›´æ–°è®¢å•çŠ¶æ€ï¼Œå‘é€é‚®<br>ä»¶é€šçŸ¥ï¼Œèµ é€ç¤¼å“â€¦ï¼‰ï¼Œè¿™äº›é€»è¾‘ä¹‹é—´å¹¶æ²¡æœ‰å¼ºè€¦åˆï¼Œå› æ­¤å¤©ç„¶é€‚åˆä½¿â½¤è§‚å¯Ÿè€…æ¨¡å¼å»å®ç°è¿™äº›åŠŸèƒ½ï¼Œå½“æœ‰æ›´å¤šçš„æ“ä½œæ—¶ï¼Œåªéœ€è¦æ·»åŠ æ–°çš„è§‚å¯Ÿè€…å°±èƒ½å®ç°ï¼Œå®Œç¾å®ç°äº†å¯¹ä¿®æ”¹å…³é—­ï¼Œå¯¹æ‰©å±•å¼€æ”¾çš„å¼€é—­åŸåˆ™ã€‚</p></blockquote><h3 id="ä¿®é¥°å™¨æ¨¡å¼"><a href="#ä¿®é¥°å™¨æ¨¡å¼" class="headerlink" title="ä¿®é¥°å™¨æ¨¡å¼"></a>ä¿®é¥°å™¨æ¨¡å¼</h3><p>ä¿®é¥°å™¨æ¨¡å¼ä½ä¸»è¦æ˜¯å¯¹ç°æœ‰çš„ç±»å¯¹è±¡è¿›è¡ŒåŒ…è£¹å’Œå°è£…ï¼Œä»¥æœŸåœ¨ä¸æ”¹å˜ç±»å¯¹è±¡åŠå…¶ç±»å®šä¹‰çš„æƒ…å†µä¸‹ä¸ºå¯¹è±¡æ·»åŠ é¢å¤–åŠŸèƒ½ã€‚æ˜¯ä¸€ç§å¯¹è±¡æ¥å£æ¨¡å¼ã€‚</p><h4 id="è®²è®²è£…é¥°å™¨æ¨¡å¼çš„åº”â½¤åœºæ™¯"><a href="#è®²è®²è£…é¥°å™¨æ¨¡å¼çš„åº”â½¤åœºæ™¯" class="headerlink" title="è®²è®²è£…é¥°å™¨æ¨¡å¼çš„åº”â½¤åœºæ™¯"></a>è®²è®²è£…é¥°å™¨æ¨¡å¼çš„åº”â½¤åœºæ™¯</h4><p>å¦‚æœä½ å¸Œæœ›åœ¨â½†éœ€ä¿®æ”¹ä»£ç çš„æƒ…å†µä¸‹å³å¯ä½¿â½¤å¯¹è±¡ï¼Œ ä¸”å¸Œæœ›åœ¨è¿â¾æ—¶ä¸ºå¯¹è±¡æ–°å¢é¢å¤–çš„â¾ä¸ºï¼Œ å¯ä»¥ä½¿â½¤è£…é¥°æ¨¡å¼ã€‚</p><p>è£…é¥°èƒ½å°†ä¸šåŠ¡é€»è¾‘ç»„ç»‡ä¸ºå±‚æ¬¡ç»“æ„ï¼Œ ä½ å¯ä¸ºå„å±‚åˆ›å»ºâ¼€ä¸ªè£…é¥°ï¼Œ åœ¨è¿â¾æ—¶<br>å°†å„ç§ä¸åŒé€»è¾‘ç»„åˆæˆå¯¹è±¡ã€‚ ç”±äºè¿™äº›å¯¹è±¡éƒ½éµå¾ªé€šâ½¤æ¥â¼ï¼Œ å®¢æˆ·ç«¯ä»£ç èƒ½ä»¥ç›¸åŒçš„â½…å¼ä½¿â½¤è¿™äº›å¯¹è±¡ã€‚</p><p>å¦‚æœâ½¤ç»§æ‰¿æ¥æ‰©å±•å¯¹è±¡â¾ä¸ºçš„â½…æ¡ˆéš¾ä»¥å®ç°æˆ–è€…æ ¹æœ¬ä¸å¯â¾ï¼Œ ä½ å¯ä»¥ä½¿â½¤è¯¥æ¨¡å¼ã€‚</p><p>è®¸å¤šç¼–ç¨‹è¯­â¾”ä½¿â½¤ final æœ€ç»ˆå…³é”®å­—æ¥é™åˆ¶å¯¹æŸä¸ªç±»çš„è¿›â¼€æ­¥æ‰©å±•ã€‚ å¤â½¤æœ€ç»ˆç±»å·²æœ‰â¾ä¸ºçš„å”¯â¼€â½…æ³•æ˜¯ä½¿â½¤è£…é¥°æ¨¡å¼ï¼š â½¤å°è£…å™¨å¯¹å…¶è¿›â¾å°è£…ã€‚</p><h3 id="è´£ä»»é“¾æ¨¡å¼"><a href="#è´£ä»»é“¾æ¨¡å¼" class="headerlink" title="è´£ä»»é“¾æ¨¡å¼"></a>è´£ä»»é“¾æ¨¡å¼</h3><p>ä¸€ä¸ªè¯·æ±‚æ²¿ç€è´£ä»»é“¾è¿›è¡Œä¼ é€’ï¼Œç›´åˆ°é“¾ä¸Šæœ‰æŸä¸ªå¤„ç†è€…å¤„ç†å®ƒä½ä¸ºæ­¢ã€‚</p><h4 id="è®²è®²è´£ä»»é“¾æ¨¡å¼çš„åº”â½¤åœºæ™¯"><a href="#è®²è®²è´£ä»»é“¾æ¨¡å¼çš„åº”â½¤åœºæ™¯" class="headerlink" title="è®²è®²è´£ä»»é“¾æ¨¡å¼çš„åº”â½¤åœºæ™¯"></a>è®²è®²è´£ä»»é“¾æ¨¡å¼çš„åº”â½¤åœºæ™¯</h4><p>å½“ç¨‹åºéœ€è¦ä½¿â½¤ä¸åŒâ½…å¼å¤„ç†ä¸åŒç§ç±»è¯·æ±‚ï¼Œ â½½ä¸”è¯·æ±‚ç±»å‹å’Œé¡ºåºé¢„</p><p>å…ˆæœªçŸ¥æ—¶ï¼Œ å¯ä»¥ä½¿â½¤è´£ä»»é“¾æ¨¡å¼ã€‚è¯¥æ¨¡å¼èƒ½å°†å¤šä¸ªå¤„ç†è€…è¿æ¥æˆâ¼€æ¡</p><p>é“¾ã€‚ æ¥æ”¶åˆ°è¯·æ±‚åï¼Œ å®ƒä¼š â€œè¯¢é—®â€ æ¯ä¸ªå¤„ç†è€…æ˜¯å¦èƒ½å¤Ÿå¯¹å…¶è¿›â¾å¤„ç†ã€‚</p><p>è¿™æ ·æ‰€æœ‰å¤„ç†è€…éƒ½æœ‰æœºä¼šæ¥å¤„ç†è¯·æ±‚ã€‚</p><p>å½“å¿…é¡»æŒ‰é¡ºåºæ‰§â¾å¤šä¸ªå¤„ç†è€…æ—¶ï¼Œ å¯ä»¥ä½¿â½¤è¯¥æ¨¡å¼ã€‚ â½†è®ºä½ ä»¥ä½•ç§é¡º</p><p>åºå°†å¤„ç†è€…è¿æ¥æˆâ¼€æ¡é“¾ï¼Œ æ‰€æœ‰è¯·æ±‚éƒ½ä¼šä¸¥æ ¼æŒ‰ç…§é¡ºåºé€šè¿‡é“¾ä¸Šçš„å¤„</p><p>ç†è€…</p><h4 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h4><p>å¯¹è±¡è¡Œä¸ºæ¨¡å¼ï¼Œé’ˆå¯¹ä¸€ç»„ç®—æ³•å°†æ¯ä¸€ä¸ªç®—æ³•å°è£…åˆ°å…·æœ‰å…±åŒè§£è€¦çš„ç‹¬ç«‹çš„ç±»ä¸­ï¼Œä»è€Œæ˜¯ä»–ä»¬èƒ½å¤Ÿç›¸äº’æ›¿æ¢ã€‚</p><h2 id="Spring-ä½¿â½¤äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"><a href="#Spring-ä½¿â½¤äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ" class="headerlink" title="Spring ä½¿â½¤äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"></a>Spring ä½¿â½¤äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ</h2><p>Spring æ¡†æ¶ä¸­â½¤åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ</p><ul><li>â¼¯â¼šè®¾è®¡æ¨¡å¼ : Spring ä½¿â½¤â¼¯â¼šæ¨¡å¼é€šè¿‡BeanFactory ã€ ApplicationContext åˆ›å»º bean å¯¹è±¡ã€‚</li><li>ä»£ç†è®¾è®¡æ¨¡å¼ : Spring AOP åŠŸèƒ½çš„å®ç°ã€‚</li><li>å•ä¾‹è®¾è®¡æ¨¡å¼ : Spring ä¸­çš„ Bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ã€‚</li><li>æ¨¡æ¿â½…æ³•æ¨¡å¼ : Spring ä¸­ jdbcTemplate ã€ hibernateTemplate ç­‰ä»¥Template ç»“å°¾çš„å¯¹æ•°æ®åº“æ“ä½œçš„ç±»ï¼Œå®ƒä»¬å°±ä½¿â½¤åˆ°äº†æ¨¡æ¿æ¨¡å¼ã€‚</li><li>åŒ…è£…å™¨è®¾è®¡æ¨¡å¼ : æˆ‘ä»¬çš„é¡¹â½¬éœ€è¦è¿æ¥å¤šä¸ªæ•°æ®åº“ï¼Œâ½½ä¸”ä¸åŒçš„å®¢æˆ·åœ¨æ¯æ¬¡è®¿é—®ä¸­æ ¹æ®éœ€è¦ä¼šå»è®¿é—®ä¸åŒçš„æ•°æ®åº“ã€‚è¿™ç§æ¨¡å¼è®©æˆ‘ä»¬å¯ä»¥æ ¹æ®å®¢æˆ·çš„éœ€æ±‚èƒ½å¤ŸåŠ¨æ€åˆ‡æ¢ä¸åŒçš„æ•°æ®æºã€‚</li><li>è§‚å¯Ÿè€…æ¨¡å¼: Spring äº‹ä»¶é©±åŠ¨æ¨¡å‹å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å¾ˆç»å…¸çš„â¼€ä¸ªåº”â½¤ã€‚</li><li>é€‚é…å™¨æ¨¡å¼ :Spring AOP çš„å¢å¼ºæˆ–é€šçŸ¥(Advice)ä½¿â½¤åˆ°äº†é€‚é…å™¨æ¨¡å¼ã€spring MVC ä¸­ä¹Ÿæ˜¯â½¤åˆ°äº†é€‚é…å™¨æ¨¡å¼é€‚é… Controller ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è½¯ä»¶å·¥ç¨‹</title>
      <link href="/2024/06/13/21/"/>
      <url>/2024/06/13/21/</url>
      
        <content type="html"><![CDATA[<h2 id="è½¯ä»¶å·¥ç¨‹ç›¸å…³"><a href="#è½¯ä»¶å·¥ç¨‹ç›¸å…³" class="headerlink" title="è½¯ä»¶å·¥ç¨‹ç›¸å…³"></a>è½¯ä»¶å·¥ç¨‹ç›¸å…³</h2><h3 id="è½¯ä»¶å¼€å‘æ¨¡å‹"><a href="#è½¯ä»¶å¼€å‘æ¨¡å‹" class="headerlink" title="è½¯ä»¶å¼€å‘æ¨¡å‹"></a>è½¯ä»¶å¼€å‘æ¨¡å‹</h3><p>ç€‘å¸ƒæ¨¡å‹ï¼ˆWaterfall Modelï¼‰ã€å¿«é€ŸåŸå‹æ¨¡å‹ï¼ˆRapid Prototype Modelï¼‰ã€V æ¨¡å‹ï¼ˆV-modelï¼‰ã€W æ¨¡å‹ï¼ˆW-modelï¼‰ã€æ•æ·å¼€å‘æ¨¡å‹ç­‰</p><h4 id="æ•æ·å¼€å‘"><a href="#æ•æ·å¼€å‘" class="headerlink" title="æ•æ·å¼€å‘"></a>æ•æ·å¼€å‘</h4><p><strong>æ•æ·å¼€å‘</strong> æ˜¯ä¸€ç§ä»¥äººä¸ºæ ¸å¿ƒã€è¿­ä»£ã€å¾ªåºæ¸è¿›çš„å¼€å‘æ–¹æ³•ã€‚åœ¨æ•æ·å¼€å‘ä¸­ï¼Œè½¯ä»¶é¡¹ç›®çš„æ„å»ºè¢«åˆ‡åˆ†æˆå¤šä¸ªå­é¡¹ç›®ï¼Œå„ä¸ªå­é¡¹ç›®çš„æˆæœéƒ½ç»è¿‡æµ‹è¯•ï¼Œå…·å¤‡é›†æˆå’Œå¯è¿è¡Œçš„ç‰¹å¾ã€‚æ¢è¨€ä¹‹ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªå¤§é¡¹ç›®åˆ†ä¸ºå¤šä¸ªç›¸äº’è”ç³»ï¼Œä½†ä¹Ÿå¯ç‹¬ç«‹è¿è¡Œçš„å°é¡¹ç›®ï¼Œå¹¶åˆ†åˆ«å®Œæˆï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­è½¯ä»¶ä¸€ç›´å¤„äºå¯ä½¿ç”¨çŠ¶æ€ã€‚</p><h3 id="è½¯ä»¶å¼€å‘çš„åŸºæœ¬ç­–ç•¥"><a href="#è½¯ä»¶å¼€å‘çš„åŸºæœ¬ç­–ç•¥" class="headerlink" title="è½¯ä»¶å¼€å‘çš„åŸºæœ¬ç­–ç•¥"></a>è½¯ä»¶å¼€å‘çš„åŸºæœ¬ç­–ç•¥</h3><h4 id="è½¯ä»¶å¤ç”¨"><a href="#è½¯ä»¶å¤ç”¨" class="headerlink" title="è½¯ä»¶å¤ç”¨"></a>è½¯ä»¶å¤ç”¨</h4><p>æ„å»ºæ–°è½¯ä»¶ä¸éœ€è¦ä»å¤´å¼€å§‹ï¼Œå¯ä»¥å¤ç”¨å·²æœ‰çš„è½®å­</p><h4 id="åˆ†è€Œæ²»ä¹‹"><a href="#åˆ†è€Œæ²»ä¹‹" class="headerlink" title="åˆ†è€Œæ²»ä¹‹"></a>åˆ†è€Œæ²»ä¹‹</h4><h4 id="é€æ­¥æ¼”è¿›"><a href="#é€æ­¥æ¼”è¿›" class="headerlink" title="é€æ­¥æ¼”è¿›"></a>é€æ­¥æ¼”è¿›</h4><p>ä¸æ–­è¿›è¡Œè¿­ä»£å¼å¢é‡å¼€å‘<br>MVP(<strong>Minimum Viable Product</strong> æœ€å°å¯è¡Œäº§å“)</p><h4 id="ä¼˜åŒ–æŠ˜ä¸­"><a href="#ä¼˜åŒ–æŠ˜ä¸­" class="headerlink" title="ä¼˜åŒ–æŠ˜ä¸­"></a>ä¼˜åŒ–æŠ˜ä¸­</h4><p>ä¸éœ€è¦å®Œå…¨ä¼˜åŒ–ï¼Œç”¨æœ‰æ•ˆçš„æŠ•å…¥å†…ä»¥æœ€æœ‰æ•ˆçš„æ–¹å¼æé«˜ç°æœ‰è½¯ä»¶çš„è´¨é‡</p><h2 id="ä»£ç è§„èŒƒ"><a href="#ä»£ç è§„èŒƒ" class="headerlink" title="ä»£ç è§„èŒƒ"></a>ä»£ç è§„èŒƒ</h2><h3 id="å‘½åè§„èŒƒ"><a href="#å‘½åè§„èŒƒ" class="headerlink" title="å‘½åè§„èŒƒ"></a>å‘½åè§„èŒƒ</h3><ul><li><strong>ç±»åéœ€è¦ä½¿ç”¨å¤§é©¼å³°å‘½åæ³•</strong></li><li><strong>æ–¹æ³•åã€å‚æ•°åã€æˆå‘˜å˜é‡ã€å±€éƒ¨å˜é‡éœ€è¦ä½¿ç”¨å°é©¼å³°å‘½åæ³•ï¼ˆlowerCamelCase</strong></li><li><strong>æµ‹è¯•æ–¹æ³•åã€å¸¸é‡ã€æšä¸¾åç§°éœ€è¦ä½¿ç”¨è›‡å½¢å‘½åæ³•ï¼ˆsnake_caseï¼‰</strong> (å„ä¸ªå•è¯ä¹‹é—´é€šè¿‡ä¸‹åˆ’çº¿â€œ_â€è¿æ¥ï¼Œæ¯”å¦‚<code>should_get_200_status_code_when_request_is_valid</code>ã€<code>CLIENT_CONNECT_SERVER_FAILURE</code>)</li><li>é¡¹ç›®æ–‡ä»¶å¤¹åç§°ä½¿ç”¨ä¸²å¼å‘½åæ³•ï¼Œåœ¨ä¸²å¼å‘½åæ³•ä¸­ï¼Œå„ä¸ªå•è¯ä¹‹é—´é€šè¿‡è¿æ¥ç¬¦â€œ-â€è¿æ¥ï¼Œæ¯”å¦‚<code>dubbo-registry</code>ã€‚</li><li><strong>æŠ½è±¡ç±»å‘½åä½¿ç”¨ Abstract</strong></li><li><strong>å¼‚å¸¸ç±»å‘½åä½¿ç”¨ Exception ç»“å°¾ã€‚</strong></li><li><strong>æµ‹è¯•ç±»å‘½åä»¥å®ƒè¦æµ‹è¯•çš„ç±»çš„åç§°å¼€å§‹ï¼Œä»¥ Test ç»“å°¾ã€‚</strong></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•è®°å½•</title>
      <link href="/2024/06/07/17/"/>
      <url>/2024/06/07/17/</url>
      
        <content type="html"><![CDATA[<p>DevOps</p><h2 id="2024-05-11-åŒä½™ä¿¡ç§‘ä¸€é¢ï¼ˆäºŒé¢å·²è¿‡ï¼Œä½†æ˜¯ä¸è¦26å±Šçš„ï¼‰"><a href="#2024-05-11-åŒä½™ä¿¡ç§‘ä¸€é¢ï¼ˆäºŒé¢å·²è¿‡ï¼Œä½†æ˜¯ä¸è¦26å±Šçš„ï¼‰" class="headerlink" title="2024-05-11 åŒä½™ä¿¡ç§‘ä¸€é¢ï¼ˆäºŒé¢å·²è¿‡ï¼Œä½†æ˜¯ä¸è¦26å±Šçš„ï¼‰"></a>2024-05-11 åŒä½™ä¿¡ç§‘ä¸€é¢ï¼ˆäºŒé¢å·²è¿‡ï¼Œä½†æ˜¯ä¸è¦26å±Šçš„ï¼‰</h2><h3 id="é¡¹ç›®ä¸­æ‰¿æ‹…çš„å¼€å‘å·¥ä½œ"><a href="#é¡¹ç›®ä¸­æ‰¿æ‹…çš„å¼€å‘å·¥ä½œ" class="headerlink" title="é¡¹ç›®ä¸­æ‰¿æ‹…çš„å¼€å‘å·¥ä½œ"></a>é¡¹ç›®ä¸­æ‰¿æ‹…çš„å¼€å‘å·¥ä½œ</h3><h3 id="å†™è¿‡å“ªäº›æ¨¡å—"><a href="#å†™è¿‡å“ªäº›æ¨¡å—" class="headerlink" title="å†™è¿‡å“ªäº›æ¨¡å—"></a>å†™è¿‡å“ªäº›æ¨¡å—</h3><h3 id="Redisé›†ç¾¤"><a href="#Redisé›†ç¾¤" class="headerlink" title="Redisé›†ç¾¤"></a>Redisé›†ç¾¤</h3><h3 id="Javaçš„å¸¸ç”¨é›†åˆç”¨è¿‡å“ªäº›"><a href="#Javaçš„å¸¸ç”¨é›†åˆç”¨è¿‡å“ªäº›" class="headerlink" title="Javaçš„å¸¸ç”¨é›†åˆç”¨è¿‡å“ªäº›"></a>Javaçš„å¸¸ç”¨é›†åˆç”¨è¿‡å“ªäº›</h3><ol><li><strong>ArrayList</strong>f</li><li>LinkedList</li><li>HashSet</li><li>TreeSet</li><li>HashMap</li></ol><h3 id="Streamæµ"><a href="#Streamæµ" class="headerlink" title="Streamæµ"></a>Streamæµ</h3><h3 id="HashMapçš„æ‰©å®¹æœºåˆ¶"><a href="#HashMapçš„æ‰©å®¹æœºåˆ¶" class="headerlink" title="HashMapçš„æ‰©å®¹æœºåˆ¶"></a>HashMapçš„æ‰©å®¹æœºåˆ¶</h3><ol><li>å½“è¶…è¿‡æœ€å¤§é•¿åº¦çš„0.75çš„æ—¶å€™å¼€å§‹æ‰©å®¹</li><li>åˆ›å»ºæ–°çš„å“ˆå¸Œè¡¨ï¼Œå®¹é‡ä¸ºåŸæ¥çš„ä¸¤å€</li><li>é‡æ–°å“ˆå¸Œï¼šéå†æ—§çš„å“ˆå¸Œè¡¨ï¼Œå°†æ¯ä¸ªå…ƒç´ é‡æ–°å“ˆå¸Œåˆ°æ–°çš„å“ˆå¸Œè¡¨ä¸­ã€‚</li><li>æ›¿æ¢æ—§çš„å“ˆå¸Œè¡¨ã€‚</li></ol><h3 id="ç±»åŠ è½½çš„è¿‡ç¨‹"><a href="#ç±»åŠ è½½çš„è¿‡ç¨‹" class="headerlink" title="ç±»åŠ è½½çš„è¿‡ç¨‹"></a>ç±»åŠ è½½çš„è¿‡ç¨‹</h3><ol><li>ç±»åŠ è½½å™¨æ‰¾åˆ°å­—èŠ‚ç æ–‡ä»¶ï¼Œä»è¿™ä¸ªæ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªåœ¨å†…å­˜ä¸­è¡¨ç¤ºçš„java.lang.Classå¯¹è±¡</li><li>é“¾æ¥ï¼š<ul><li>éªŒè¯ï¼šç¡®ä¿è¢«åŠ è½½çš„ç±»æ˜¯å¦æ»¡è¶³Javaè™šæ‹Ÿæœºçš„é™åˆ¶ï¼Œä¾‹å¦‚ï¼šå­—èŠ‚ç æ˜¯å¦æœ‰æ­£ç¡®çš„æ ¼å¼ï¼Œç¬¦å·å¼•ç”¨æ˜¯å¦å¯ä»¥æ­£ç¡®è§£æç­‰</li><li>å‡†å¤‡ï¼šåœ¨ä½å‘¢æ¯”é˜¶æ®µï¼ŒJavaè™šæ‹Ÿæœºä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶ä¸”åˆå§‹åŒ–é»˜è®¤å€¼</li><li>è§£æï¼šJavaè™šæ‹Ÿæœºå°†ç±»çš„ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨</li></ul></li><li>åˆå§‹åŒ–ï¼šæ‰§è¡Œç±»çš„åˆå§‹åŒ–æ–¹æ³•å’Œé™æ€åˆå§‹åŒ–å—å’Œé™æ€å­—æ®µçš„åˆå§‹åŒ–ã€‚</li></ol><h3 id="MySQLçš„å­˜å‚¨å¼•æ“"><a href="#MySQLçš„å­˜å‚¨å¼•æ“" class="headerlink" title="MySQLçš„å­˜å‚¨å¼•æ“"></a>MySQLçš„å­˜å‚¨å¼•æ“</h3><h4 id="InnoDBçš„åº•å±‚æ•°æ®ç»“æ„ï¼ŒB-æ ‘å’ŒBæ ‘çš„åŒºåˆ«"><a href="#InnoDBçš„åº•å±‚æ•°æ®ç»“æ„ï¼ŒB-æ ‘å’ŒBæ ‘çš„åŒºåˆ«" class="headerlink" title="InnoDBçš„åº•å±‚æ•°æ®ç»“æ„ï¼ŒB+æ ‘å’ŒBæ ‘çš„åŒºåˆ«"></a>InnoDBçš„åº•å±‚æ•°æ®ç»“æ„ï¼ŒB+æ ‘å’ŒBæ ‘çš„åŒºåˆ«</h4><p>B+æ ‘<br>åŒºåˆ«ï¼š</p><ol><li>B+æ ‘ä¸­ï¼Œæ‰€æœ‰çš„æ•°æ®å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ä¸­ï¼Œéå¶å­èŠ‚ç‚¹åªå­˜å‚¨å…³é”®å­—ä¿¡æ¯ã€‚è€Œåœ¨Bæ ‘ä¸­ï¼Œå…³é”®å­—å’Œæ•°æ®å¯ä»¥å­˜å‚¨åœ¨ä»»ä½•èŠ‚ç‚¹</li><li>å¶å­èŠ‚ç‚¹é“¾æ¥ï¼šåœ¨B+æ ‘ä¸­ï¼Œæ‰€æœ‰çš„å¶å­èŠ‚ç‚¹éƒ½é€šè¿‡æŒ‡é’ˆè¿æ¥åœ¨ä¸€æ¬¡ï¼Œå½¢æˆä¸€ä¸ªé“¾è¡¨ç»“æ„ã€‚Bæ ‘ä¸­å¶å­èŠ‚ç‚¹ä¹‹é—´æ²¡æœ‰é“¾æ¥</li><li>å…³é”®å­—é‡å¤ï¼šB+æ ‘ç§ï¼Œéå¶å­èŠ‚ç‚¹çš„å…³é”®å­—ä¼šé‡å¤å‡ºç°å¶å­èŠ‚ç‚¹ï¼Œè€Œåœ¨Bæ ‘ç§ï¼Œå…³é”®å­—åªå‡ºç°ä¸€æ¬¡ã€‚<br>ä¼˜ç‚¹ï¼š</li><li>B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¸å­˜æ•°æ®ï¼Œä»…å­˜é”®å€¼ï¼Œç›¸åŒçš„é¡µè¡¨å¤§å°çš„æƒ…å†µä¸‹ï¼ŒB+æ ‘å¯ä»¥å­˜æ›´å¤šçš„é”®å€¼ï¼Œä»è€Œä½¿å¾—æ ‘çš„é«˜åº¦æ›´çŸ®ï¼ŒæŸ¥æ‰¾æ•°æ®è¿›è¡Œç£ç›˜IOæ¬¡æ•°å°±ä¼šå‡å°‘ã€‚æ•°æ®æŸ¥è¯¢æ•ˆç‡ä¹Ÿä¼šæ›´å¿«</li><li>B+æ ‘ç´¢å¼•çš„æ•°æ®éƒ½åœ¨å¶å­èŠ‚ç‚¹ï¼Œè€Œä¸”æ˜¯æŒ‰ç…§é¡ºåºæ’åˆ—çš„ï¼ŒæŸ¥æ‰¾çš„æ—¶å€™æ›´å®¹æ˜“æŸ¥æ‰¾ï¼Œæ•ˆç‡æ›´é«˜</li></ol><h4 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h4><p>ä¸å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜</p><h3 id="æ•°æ®åº“çš„å¹¶å‘ä¸€è‡´æ€§é—®é¢˜"><a href="#æ•°æ®åº“çš„å¹¶å‘ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="æ•°æ®åº“çš„å¹¶å‘ä¸€è‡´æ€§é—®é¢˜"></a>æ•°æ®åº“çš„å¹¶å‘ä¸€è‡´æ€§é—®é¢˜</h3><ol><li><p><strong>è„è¯»ï¼ˆDirty Readï¼‰</strong>ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡çš„ä¿®æ”¹ã€‚å¦‚æœé‚£ä¸ªäº‹åŠ¡å›æ»šï¼Œé‚£ä¹ˆè¿™ä¸ªè¯»å–æ“ä½œå°±ä¼šè¯»åˆ°é”™è¯¯çš„æ•°æ®ã€‚</p></li><li><p><strong>ä¸å¯é‡å¤è¯»ï¼ˆNon-repeatable Readï¼‰</strong>ï¼šåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œä¸€ä¸ªæŸ¥è¯¢æ“ä½œå¯¹åŒä¸€è¡Œæ•°æ®è¿›è¡Œäº†å¤šæ¬¡è¯»å–ï¼Œä½†ç”±äºå…¶ä»–äº‹åŠ¡çš„ä¿®æ”¹ï¼Œå¯¼è‡´å¤šæ¬¡è¯»å–çš„ç»“æœä¸ä¸€è‡´ã€‚</p></li><li><p><strong>å¹»è¯»ï¼ˆPhantom Readï¼‰</strong>ï¼šåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œä¸€ä¸ªæŸ¥è¯¢æ“ä½œåœ¨å‰åä¸¤æ¬¡æŸ¥è¯¢ä¸­ï¼Œç”±äºå…¶ä»–äº‹åŠ¡çš„æ’å…¥æˆ–åˆ é™¤æ“ä½œï¼Œå¯¼è‡´è¯»å–åˆ°äº†é¢å¤–çš„è¡Œæˆ–è€…å°‘äº†ä¸€äº›è¡Œã€‚</p></li><li><p><strong>ä¸¢å¤±æ›´æ–°ï¼ˆLost Updateï¼‰</strong>ï¼šä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¿®æ”¹åŒä¸€è¡Œæ•°æ®ï¼Œåæäº¤çš„äº‹åŠ¡ä¼šè¦†ç›–å‰ä¸€ä¸ªäº‹åŠ¡çš„ä¿®æ”¹ï¼Œå¯¼è‡´å‰ä¸€ä¸ªäº‹åŠ¡çš„ä¿®æ”¹ä¸¢å¤±ã€‚</p></li></ol><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><h3 id="ç´¢å¼•åœ¨é¡¹ç›®ä¸­çš„å®é™…åº”ç”¨"><a href="#ç´¢å¼•åœ¨é¡¹ç›®ä¸­çš„å®é™…åº”ç”¨" class="headerlink" title="ç´¢å¼•åœ¨é¡¹ç›®ä¸­çš„å®é™…åº”ç”¨"></a>ç´¢å¼•åœ¨é¡¹ç›®ä¸­çš„å®é™…åº”ç”¨</h3><h3 id="AOPç›¸å…³"><a href="#AOPç›¸å…³" class="headerlink" title="AOPç›¸å…³"></a>AOPç›¸å…³</h3><p>ä¸šåŠ¡é€»è¾‘æˆåŠŸï¼ŒAOPæ•°æ®åº“æ’å…¥æ“ä½œå¤±è´¥ï¼Œå¦‚ä½•è§£å†³<br>æ€ä¹ˆæŠŠæ—¥å¿—å†™åˆ°æ–‡ä»¶é‡Œ</p><h3 id="å¯¹äºå¤§é‡çš„æ•°æ®åŒæ­¥ï¼Œå¦‚ä½•å¤„ç†"><a href="#å¯¹äºå¤§é‡çš„æ•°æ®åŒæ­¥ï¼Œå¦‚ä½•å¤„ç†" class="headerlink" title="å¯¹äºå¤§é‡çš„æ•°æ®åŒæ­¥ï¼Œå¦‚ä½•å¤„ç†"></a>å¯¹äºå¤§é‡çš„æ•°æ®åŒæ­¥ï¼Œå¦‚ä½•å¤„ç†</h3><h4 id="æ€ä¹ˆä»Nginxçš„è½¬å‘ä¸­è·å–å®é™…çš„IP"><a href="#æ€ä¹ˆä»Nginxçš„è½¬å‘ä¸­è·å–å®é™…çš„IP" class="headerlink" title="æ€ä¹ˆä»Nginxçš„è½¬å‘ä¸­è·å–å®é™…çš„IP"></a>æ€ä¹ˆä»Nginxçš„è½¬å‘ä¸­è·å–å®é™…çš„IP</h4><p>ä½¿ç”¨proxy_set_headeræŒ‡ä»¤å°†å®¢æˆ·ç«¯å®é™…IPåœ°å€æ·»åŠ åˆ°HTTPè¯·æ±‚ä¸­å³å¯</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span><span class="token punctuation">}</span>//Java<span class="token directive"><span class="token keyword">import</span> javax.servlet.http.HttpServletRequest</span><span class="token punctuation">;</span>@RestController<span class="token directive"><span class="token keyword">public</span> class MyController</span> <span class="token punctuation">{</span>    @RequestMapping("/")    <span class="token directive"><span class="token keyword">public</span> String index(HttpServletRequest request)</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">String</span> ipAddress = request.getHeader(<span class="token string">"X-Forwarded-For"</span>)</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">if</span> (ipAddress == null)</span> <span class="token punctuation">{</span>            <span class="token directive"><span class="token keyword">ipAddress</span> = request.getHeader(<span class="token string">"X-Real-IP"</span>)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token directive"><span class="token keyword">return</span> <span class="token string">"Client IP: "</span> + ipAddress</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Canalå¦‚ä½•ä½¿ç”¨ï¼Œæœ‰ä½•å¥½å¤„ï¼Œé¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨"><a href="#Canalå¦‚ä½•ä½¿ç”¨ï¼Œæœ‰ä½•å¥½å¤„ï¼Œé¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨" class="headerlink" title="Canalå¦‚ä½•ä½¿ç”¨ï¼Œæœ‰ä½•å¥½å¤„ï¼Œé¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨"></a>Canalå¦‚ä½•ä½¿ç”¨ï¼Œæœ‰ä½•å¥½å¤„ï¼Œé¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨</h3><h3 id="å¤šçº¿ç¨‹å¯¹é€»è¾‘ä¼˜åŒ–"><a href="#å¤šçº¿ç¨‹å¯¹é€»è¾‘ä¼˜åŒ–" class="headerlink" title="å¤šçº¿ç¨‹å¯¹é€»è¾‘ä¼˜åŒ–"></a>å¤šçº¿ç¨‹å¯¹é€»è¾‘ä¼˜åŒ–</h3><h4 id="ä½¿ç”¨å¹¶è¡ŒStreamæµæ¥å¤„ç†å¸¸ç”¨æ•°æ®"><a href="#ä½¿ç”¨å¹¶è¡ŒStreamæµæ¥å¤„ç†å¸¸ç”¨æ•°æ®" class="headerlink" title="ä½¿ç”¨å¹¶è¡ŒStreamæµæ¥å¤„ç†å¸¸ç”¨æ•°æ®"></a>ä½¿ç”¨å¹¶è¡ŒStreamæµæ¥å¤„ç†å¸¸ç”¨æ•°æ®</h4><h4 id="å¹¶è¡Œæµçš„å„ç§é—®é¢˜"><a href="#å¹¶è¡Œæµçš„å„ç§é—®é¢˜" class="headerlink" title="å¹¶è¡Œæµçš„å„ç§é—®é¢˜"></a>å¹¶è¡Œæµçš„å„ç§é—®é¢˜</h4><ol><li><p><strong>çº¿ç¨‹å®‰å…¨é—®é¢˜</strong>ï¼šå¹¶è¡Œå¤„ç†æ•°æ®æ—¶ï¼Œéœ€è¦æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚å¦‚æœå¹¶è¡Œæµä¿®æ”¹äº†å…±äº«èµ„æºï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</p></li><li><p><strong>é¡ºåºé—®é¢˜</strong>ï¼šå¹¶è¡Œæµåœ¨å¤„ç†æ•°æ®æ—¶ï¼Œä¸èƒ½ä¿è¯æ•°æ®çš„å¤„ç†é¡ºåºã€‚</p></li><li><p><strong>å¼€é”€é—®é¢˜</strong>ï¼šå¹¶è¡Œæµè™½ç„¶å¯ä»¥æé«˜å¤„ç†é€Ÿåº¦ï¼Œä½†æ˜¯å®ƒä¹Ÿä¼šå¢åŠ é¢å¤–çš„å¼€é”€ï¼Œå¦‚çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ã€‚å¯¹äºå°æ•°æ®é›†ï¼Œè¿™ç§å¼€é”€å¯èƒ½ä¼šä½¿å¹¶è¡Œæµçš„æ€§èƒ½ä½äºä¸²è¡Œæµã€‚</p></li><li><p><strong>é˜»å¡é—®é¢˜</strong>ï¼šå¦‚æœå¹¶è¡Œæµçš„ä»»åŠ¡ä¸­æœ‰é˜»å¡æ“ä½œï¼Œå¦‚ I/O æ“ä½œï¼Œé‚£ä¹ˆå¹¶è¡Œæµçš„æ€§èƒ½å¯èƒ½ä¼šå¤§å¤§é™ä½ã€‚</p></li></ol><h3 id="å¯ä»¥å¯¹è‡ªå·±çš„ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œè€ƒè™‘æ€§èƒ½ä¼˜åŒ–"><a href="#å¯ä»¥å¯¹è‡ªå·±çš„ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œè€ƒè™‘æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="å¯ä»¥å¯¹è‡ªå·±çš„ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œè€ƒè™‘æ€§èƒ½ä¼˜åŒ–"></a>å¯ä»¥å¯¹è‡ªå·±çš„ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œè€ƒè™‘æ€§èƒ½ä¼˜åŒ–</h3><h3 id="SpringSecurityç›¸å…³"><a href="#SpringSecurityç›¸å…³" class="headerlink" title="SpringSecurityç›¸å…³"></a>SpringSecurityç›¸å…³</h3><p>SecurityContextæ˜¯Spring Securityä¸­çš„ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼Œå®ƒç”¨äºå­˜å‚¨ä¸å½“å‰æ‰§è¡Œçº¿ç¨‹ç›¸å…³çš„å®‰å…¨æ€§å’Œèº«ä»½éªŒè¯ä¿¡æ¯ã€‚åœ¨ä»»ä½•åœ°æ–¹ï¼Œä½ éƒ½å¯ä»¥é€šè¿‡SecurityContextHolderæ¥è®¿é—®å½“å‰çš„SecurityContextã€‚</p><h2 id="2024-05-18-é’é¹¤ä¿¡æ¯ä¸€é¢ï¼ˆç¬”è¯•æŒ‚"><a href="#2024-05-18-é’é¹¤ä¿¡æ¯ä¸€é¢ï¼ˆç¬”è¯•æŒ‚" class="headerlink" title="2024-05-18 é’é¹¤ä¿¡æ¯ä¸€é¢ï¼ˆç¬”è¯•æŒ‚)"></a>2024-05-18 é’é¹¤ä¿¡æ¯ä¸€é¢ï¼ˆç¬”è¯•æŒ‚)</h2><h3 id="MyBatisçš„å»¶è¿ŸåŠ è½½ä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡"><a href="#MyBatisçš„å»¶è¿ŸåŠ è½½ä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡" class="headerlink" title="MyBatisçš„å»¶è¿ŸåŠ è½½ä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡"></a>MyBatisçš„å»¶è¿ŸåŠ è½½ä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡</h3><p>å½“ä½¿ç”¨ä¸€å¯¹å¤šæˆ–è€…å¤šå¯¹å¤šçš„å…³è”æŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨å»¶è¿ŸåŠ è½½å¯ä»¥åœ¨ä¸éœ€è¦è·å–å…³è”æ•°æ®æ—¶ï¼Œå¯ä»¥é¿å…æ‰§è¡Œå…³è”æŸ¥è¯¢ï¼Œä»è€Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p><h3 id="å¸ƒéš†è¿‡æ»¤å™¨"><a href="#å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨</h3><h3 id="MySQLçš„ä¸»ä»åŒæ­¥è¿‡ç¨‹"><a href="#MySQLçš„ä¸»ä»åŒæ­¥è¿‡ç¨‹" class="headerlink" title="MySQLçš„ä¸»ä»åŒæ­¥è¿‡ç¨‹"></a>MySQLçš„ä¸»ä»åŒæ­¥è¿‡ç¨‹</h3><p>ä½¿ç”¨binlog</p><ul><li>ä¸»ä»å¤åˆ¶ï¼š<ul><li>masterèŠ‚ç‚¹ä¼šä¸æ–­å°†sqlå‘½ä»¤å†™å…¥Binary Logï¼Œå­èŠ‚ç‚¹ä½¿ç”¨I/Oçº¿ç¨‹è¯»å…¥masterèŠ‚ç‚¹ä¸­çš„Bin Log</li><li>å­—èŠ‚ç‚¹ä½¿ç”¨SQLçº¿ç¨‹æ‰§è¡ŒBin Logçš„è¯­å¥</li></ul></li></ul><h3 id="ä¸»ä¸»åŒæ­¥å¦‚ä½•å®ç°ï¼Œå¦‚ä½•è§£å†³å¹¶å‘é—®é¢˜"><a href="#ä¸»ä¸»åŒæ­¥å¦‚ä½•å®ç°ï¼Œå¦‚ä½•è§£å†³å¹¶å‘é—®é¢˜" class="headerlink" title="ä¸»ä¸»åŒæ­¥å¦‚ä½•å®ç°ï¼Œå¦‚ä½•è§£å†³å¹¶å‘é—®é¢˜"></a>ä¸»ä¸»åŒæ­¥å¦‚ä½•å®ç°ï¼Œå¦‚ä½•è§£å†³å¹¶å‘é—®é¢˜</h3><h3 id="å¦‚ä½•è§£å†³IOçš„è´Ÿè½½å‡è¡¡åˆ†å¸ƒ"><a href="#å¦‚ä½•è§£å†³IOçš„è´Ÿè½½å‡è¡¡åˆ†å¸ƒ" class="headerlink" title="å¦‚ä½•è§£å†³IOçš„è´Ÿè½½å‡è¡¡åˆ†å¸ƒ"></a>å¦‚ä½•è§£å†³IOçš„è´Ÿè½½å‡è¡¡åˆ†å¸ƒ</h3><h3 id="AOPçš„ä¼˜åŠ¿"><a href="#AOPçš„ä¼˜åŠ¿" class="headerlink" title="AOPçš„ä¼˜åŠ¿"></a>AOPçš„ä¼˜åŠ¿</h3><h3 id="JDK17å’ŒJDK8çš„åŒºåˆ«"><a href="#JDK17å’ŒJDK8çš„åŒºåˆ«" class="headerlink" title="JDK17å’ŒJDK8çš„åŒºåˆ«"></a>JDK17å’ŒJDK8çš„åŒºåˆ«</h3><h2 id="2024-06-19-ä¸­å’Œå†œä¿¡ä¸€é¢ï¼ˆä¸€é¢æŒ‚ï¼‰"><a href="#2024-06-19-ä¸­å’Œå†œä¿¡ä¸€é¢ï¼ˆä¸€é¢æŒ‚ï¼‰" class="headerlink" title="2024-06-19 ä¸­å’Œå†œä¿¡ä¸€é¢ï¼ˆä¸€é¢æŒ‚ï¼‰"></a>2024-06-19 ä¸­å’Œå†œä¿¡ä¸€é¢ï¼ˆä¸€é¢æŒ‚ï¼‰</h2><h3 id="MySQLç´¢å¼•"><a href="#MySQLç´¢å¼•" class="headerlink" title="MySQLç´¢å¼•"></a>MySQLç´¢å¼•</h3><h4 id="ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯ï¼ˆé‡ç‚¹ï¼‰"><a href="#ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯ï¼ˆé‡ç‚¹ï¼‰"></a>ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯ï¼ˆé‡ç‚¹ï¼‰</h4><ol><li>LiIKEæ“ä½œç¬¦ä»¥é€šé…ç¬¦å¼€å¤´ä¾‹å¦‚ â€œ%xxâ€æˆ– â€œ%xx%â€ ï¼Œä½†æ˜¯ â€œxx%â€ å¯ä»¥ä½¿ç”¨ç´¢å¼•ã€‚</li><li>å¯¹ç´¢å¼•ä½¿ç”¨å‡½æ•°æˆ–è€…è¡¨è¾¾å¼æ“ä½œ <code>select * from t_user where length(name)=6 </code></li><li>å¯¹ç´¢å¼•éšå¼è½¬æ¢ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­çš„ç±»å‹å’Œåˆ—çš„ç±»å‹ä¸åŒ¹é…ï¼ŒMySQLå¯èƒ½ä¼šè¿›è¡Œç±»å‹è½¬æ¢ï¼Œç´¢å¼•å°±ä¼šå¤±æ•ˆ</li><li>è”åˆç´¢å¼•éæœ€å·¦åŒ¹é…ï¼Œå¤šä¸ªæ™®é€šå­—æ®µç»„åˆåœ¨ä¸€èµ·åˆ›å»ºçš„ç´¢å¼•å«åšè”åˆç´¢å¼•ï¼Œä¸éµå¾ªæœ€å·¦ä¼˜å…ˆçš„æ–¹å¼å°±ä¼šå¤±æ•ˆã€‚</li><li>whereå­å¥ä¸­ä½¿ç”¨äº†ORï¼Œå¦‚æœORåçš„æ¡ä»¶ä¸æ˜¯ç´¢å¼•åˆ—å°±ä¼šå¤±æ•ˆ</li><li>å‡ºç°NULLå€¼ï¼šå¦‚æœåˆ—ä¸­åŒ…å«NULLå€¼ï¼Œé‚£ä¹ˆä½¿ç”¨IS NULLæˆ–IS NOT NULL æŸ¥è¯¢æ—¶ç´¢å¼•å¯èƒ½ä¼šå¤±æ•ˆã€‚</li></ol><h4 id="Textå¯¹äºå­—æ®µç±»å‹ç´¢å¼•ä¼šå¤±æ•ˆå—"><a href="#Textå¯¹äºå­—æ®µç±»å‹ç´¢å¼•ä¼šå¤±æ•ˆå—" class="headerlink" title="Textå¯¹äºå­—æ®µç±»å‹ç´¢å¼•ä¼šå¤±æ•ˆå—"></a>Textå¯¹äºå­—æ®µç±»å‹ç´¢å¼•ä¼šå¤±æ•ˆå—</h4><p><code>TEXT</code>ç±»å‹çš„å­—æ®µæ˜¯å¯ä»¥è¢«ç´¢å¼•çš„ï¼Œä½†æ˜¯ç”±äº<code>TEXT</code>ç±»å‹çš„é•¿åº¦å¯èƒ½éå¸¸å¤§ï¼Œæ‰€ä»¥å¿…é¡»æŒ‡å®šå‰ç¼€é•¿åº¦ã€‚è¿™æ˜¯å› ä¸ºMySQLçš„B-Treeç´¢å¼•åªèƒ½å­˜å‚¨å›ºå®šé•¿åº¦çš„å€¼ã€‚å¦‚æœä¸æŒ‡å®šå‰ç¼€é•¿åº¦ï¼ŒMySQLä¼šæŠ¥é”™ã€‚</p><h4 id="MySQLå¦‚ä½•ä½¿ç”¨ç´¢å¼•çš„"><a href="#MySQLå¦‚ä½•ä½¿ç”¨ç´¢å¼•çš„" class="headerlink" title="MySQLå¦‚ä½•ä½¿ç”¨ç´¢å¼•çš„"></a>MySQLå¦‚ä½•ä½¿ç”¨ç´¢å¼•çš„</h4><h3 id="JavaåŸºç¡€"><a href="#JavaåŸºç¡€" class="headerlink" title="JavaåŸºç¡€"></a>JavaåŸºç¡€</h3><h4 id="Javaä¸­çš„ç±»ä»€ä¹ˆæ—¶å€™ä¼šåŠ è½½åˆ°å†…å­˜ä¸­"><a href="#Javaä¸­çš„ç±»ä»€ä¹ˆæ—¶å€™ä¼šåŠ è½½åˆ°å†…å­˜ä¸­" class="headerlink" title="Javaä¸­çš„ç±»ä»€ä¹ˆæ—¶å€™ä¼šåŠ è½½åˆ°å†…å­˜ä¸­"></a>Javaä¸­çš„ç±»ä»€ä¹ˆæ—¶å€™ä¼šåŠ è½½åˆ°å†…å­˜ä¸­</h4><ol><li>å®ä¾‹åŒ–çš„æ—¶å€™ï¼šnew </li><li>è®¿é—®é™æ€å¯¹è±¡æ—¶ï¼Œ</li><li>å­ç±»åŠ è½½æ—¶ä¼šæŠŠçˆ¶ç±»ä¹ŸåŠ è½½è¿›å†…å­˜</li><li>é€šè¿‡åå°„APIæ—¶ï¼Œä½¿ç”¨åå°„æ—¶ä¼šæŠŠå¯¹åº”çš„ç±»åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</li></ol><h4 id="Hashå†²çª-amp-HashMapå¦‚ä½•è§£å†³Hashå†²çªçš„ï¼ŒHashMapæ’å…¥æ•°æ®çš„è¿‡ç¨‹"><a href="#Hashå†²çª-amp-HashMapå¦‚ä½•è§£å†³Hashå†²çªçš„ï¼ŒHashMapæ’å…¥æ•°æ®çš„è¿‡ç¨‹" class="headerlink" title="Hashå†²çª &amp; HashMapå¦‚ä½•è§£å†³Hashå†²çªçš„ï¼ŒHashMapæ’å…¥æ•°æ®çš„è¿‡ç¨‹"></a>Hashå†²çª &amp; HashMapå¦‚ä½•è§£å†³Hashå†²çªçš„ï¼ŒHashMapæ’å…¥æ•°æ®çš„è¿‡ç¨‹</h4><p>HashMapä½¿ç”¨é“¾åœ°å€æ³•è§£å†³å“ˆå¸Œå†²çªçš„ã€‚HashMapä½¿ç”¨æ•°ç»„åŠ é“¾è¡¨çš„æ–¹å¼ï¼Œæ•°ç»„ä¸­çš„ä½ç½®å¯ä»¥çœ‹ä½œä¸€ä¸ªæ¡¶ï¼Œæ¯ä¸ªæ¡¶å®é™…å°±æ˜¯ä¸€ä¸ªé“¾è¡¨æˆ–è€…çº¢é»‘æ ‘ã€‚<br>å½“æ¡¶ä¸­çš„æ•°æ®è¶…è¿‡ä¸€å®šçš„é˜ˆå€¼æ—¶ï¼Œé»˜è®¤ä¸º8ï¼Œä¼šè½¬ä¸ºçº¢é»‘æ ‘ã€‚<br>æ’å…¥è¿‡ç¨‹ï¼š</p><ol><li>è®¡ç®—å“ˆå¸Œå€¼ï¼Œä½¿ç”¨é”®çš„hashCode()</li><li>ç¡®å®šæ¡¶çš„ä½ç½®ï¼Œä½¿ç”¨å“ˆå¸Œå€¼çš„ä¸€éƒ¨åˆ†æ¥ç¡®è®¤é”®å€¼å¯¹åº”è¯¥å­˜å‚¨åœ¨å“ªä¸ªæ¡¶ä¸­ã€‚ä¸€èˆ¬ç”¨å“ˆå¸Œå€¼çš„åœ°ä½æ¥é€‰æ‹©æ¡¶</li><li>æ£€æŸ¥å†²çªï¼š<ul><li>æ²¡æœ‰å†²çªå°±ç›´æ¥å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹</li><li>æœ‰å†²çªå°±åˆ¤æ–­é”®å€¼æ˜¯å¦ç›¸åŒï¼Œä½¿ç”¨çš„æ˜¯equalsæ–¹æ³•ï¼Œç›¸ç­‰å°±è¦†ç›–ï¼Œä¸ç›¸ç­‰å°±æ·»åŠ ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹å­˜å‚¨é”®å€¼å¯¹</li></ul></li><li>å¦‚æœHashMapçš„å¤§å°è¶…è¿‡äº†æ•°ç»„é•¿åº¦çš„0.75å°±ä¼šè¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹ä¹‹åæ˜¯åŸæ¥çš„ä¸¤å€</li></ol><h4 id="ThreadLocalçš„å®ç°åŸç†"><a href="#ThreadLocalçš„å®ç°åŸç†" class="headerlink" title="ThreadLocalçš„å®ç°åŸç†"></a>ThreadLocalçš„å®ç°åŸç†</h4><ol><li>æ¯ä¸ªThreadå¯¹è±¡å†…éƒ¨æœ‰ä¸€ä¸ªThreadLocalMapå¯¹è±¡ï¼Œç„¶åå®ƒçš„é”®æ˜¯ThreadLocalï¼Œå€¼æ˜¯æˆ‘ä»¬åƒå­˜å‚¨çš„å€¼</li><li>ThreadLocalçš„getå®é™…ä¸Šä½¿ç”¨äº†ThreadLocalMapæ¥è·å–å€¼çš„</li></ol><h3 id="å¹¶å‘é—®é¢˜"><a href="#å¹¶å‘é—®é¢˜" class="headerlink" title="å¹¶å‘é—®é¢˜"></a>å¹¶å‘é—®é¢˜</h3><h4 id="æ …æ -Barrier"><a href="#æ …æ -Barrier" class="headerlink" title="æ …æ  Barrier"></a>æ …æ  Barrier</h4><p>Barrieræ˜¯ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œå®ƒå¯ä»¥è®©ä¸€ç»„çº¿ç¨‹åœ¨æ‰€æœ‰çº¿ç¨‹åˆ°è¾¾æŸä¸ªç‚¹ä¹‹åå†ä¸€èµ·ç»§ç»­æ‰§è¡Œã€‚CountDownLatchå°±æ˜¯æ …æ çš„å®ç°ã€‚</p><h2 id="2024-06-25-æ±Ÿè‹è¿è”ç¬”è¯•ï¼ˆå·²è¿‡"><a href="#2024-06-25-æ±Ÿè‹è¿è”ç¬”è¯•ï¼ˆå·²è¿‡" class="headerlink" title="2024-06-25 æ±Ÿè‹è¿è”ç¬”è¯•ï¼ˆå·²è¿‡)"></a>2024-06-25 æ±Ÿè‹è¿è”ç¬”è¯•ï¼ˆå·²è¿‡)</h2><h3 id="å¦‚ä½•æ•æ‰ä¸€ä¸ªIOå¼‚å¸¸ï¼Œç®€å•è¯´æ˜NULLPoniterExceptionçš„ç†è§£"><a href="#å¦‚ä½•æ•æ‰ä¸€ä¸ªIOå¼‚å¸¸ï¼Œç®€å•è¯´æ˜NULLPoniterExceptionçš„ç†è§£" class="headerlink" title="å¦‚ä½•æ•æ‰ä¸€ä¸ªIOå¼‚å¸¸ï¼Œç®€å•è¯´æ˜NULLPoniterExceptionçš„ç†è§£"></a>å¦‚ä½•æ•æ‰ä¸€ä¸ªIOå¼‚å¸¸ï¼Œç®€å•è¯´æ˜NULLPoniterExceptionçš„ç†è§£</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>NullPointerExceptionæ˜¯ç¨‹åºå°è¯•ä½¿ç”¨ä¸€ä¸ªéœ€è¦å¯¹è±¡å¼•ç”¨çš„æ“¦æ¬§æ€»ï¼Œä½†æ˜¯è¿™ä¸ªå¯¹è±¡å¼•ç”¨å´æ˜¯nullï¼Œå°±ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ã€‚</p><h3 id="ä»£ç è¿è¡Œé¢˜ç›®"><a href="#ä»£ç è¿è¡Œé¢˜ç›®" class="headerlink" title="ä»£ç è¿è¡Œé¢˜ç›®"></a>ä»£ç è¿è¡Œé¢˜ç›®</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunningMan</span><span class="token punctuation">{</span><span class="token keyword">public</span> <span class="token class-name">RunningMan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>â€œ<span class="token class-name">Hi</span><span class="token punctuation">,</span>man<span class="token operator">!</span> <span class="token class-name">Just</span> run<span class="token operator">!</span>â€<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>i<span class="token operator">--</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="SQLé¢˜ç›®"><a href="#SQLé¢˜ç›®" class="headerlink" title="SQLé¢˜ç›®"></a>SQLé¢˜ç›®</h3><p>å»ºè¡¨ï¼Œå¤šè¡¨è”åˆï¼Œæ›´æ–°æ•°æ®ï¼Œæ’åºï¼Œåˆ†ç»„</p><h3 id="ç®—æ³•é¢˜"><a href="#ç®—æ³•é¢˜" class="headerlink" title="ç®—æ³•é¢˜"></a>ç®—æ³•é¢˜</h3><h3 id="MyBatisçš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼Œä»¥åŠéœ€è¦é…ç½®çš„ä¸œè¥¿"><a href="#MyBatisçš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼Œä»¥åŠéœ€è¦é…ç½®çš„ä¸œè¥¿" class="headerlink" title="MyBatisçš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼Œä»¥åŠéœ€è¦é…ç½®çš„ä¸œè¥¿"></a>MyBatisçš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼Œä»¥åŠéœ€è¦é…ç½®çš„ä¸œè¥¿</h3><h2 id="2024-06-28-æ±Ÿè‹è¿è”ä¸€é¢-å·²è¿‡"><a href="#2024-06-28-æ±Ÿè‹è¿è”ä¸€é¢-å·²è¿‡" class="headerlink" title="2024-06-28 æ±Ÿè‹è¿è”ä¸€é¢(å·²è¿‡)"></a>2024-06-28 æ±Ÿè‹è¿è”ä¸€é¢(å·²è¿‡)</h2><h3 id="é¡¹ç›®æé—®ï¼š"><a href="#é¡¹ç›®æé—®ï¼š" class="headerlink" title="é¡¹ç›®æé—®ï¼š"></a>é¡¹ç›®æé—®ï¼š</h3><p>å“ªä¸ªé¡¹ç›®å¯¹ä½ æå‡æœ€å¤§</p><h3 id="jdk17æ–°ç‰¹æ€§-ï¼ˆä¸ä¼š"><a href="#jdk17æ–°ç‰¹æ€§-ï¼ˆä¸ä¼š" class="headerlink" title="jdk17æ–°ç‰¹æ€§ ï¼ˆä¸ä¼š)"></a>jdk17æ–°ç‰¹æ€§ ï¼ˆä¸ä¼š)</h3><p>æ¨¡å¼åŒ¹é…for instanceofã€è®°å½•</p><h4 id="æ¨¡å¼åŒ¹é…çš„å¢å¼º"><a href="#æ¨¡å¼åŒ¹é…çš„å¢å¼º" class="headerlink" title="æ¨¡å¼åŒ¹é…çš„å¢å¼º"></a>æ¨¡å¼åŒ¹é…çš„å¢å¼º</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">17</span>ä¹‹å‰<span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> obj<span class="token punctuation">;</span>    <span class="token comment">// ä½¿ç”¨s</span><span class="token punctuation">}</span><span class="token number">17</span>ä¸­<span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// ç›´æ¥ä½¿ç”¨s</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å¯†å°ç±»"><a href="#å¯†å°ç±»" class="headerlink" title="å¯†å°ç±»"></a>å¯†å°ç±»</h4><p>å¯ä»¥æŒ‡å®šå“ªäº›ç±»æˆ–è€…æ¥å£å¯ä»¥ç»§æ‰¿æˆ–å®ç°å®ƒ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">Shape</span> <span class="token keyword">permits</span> <span class="token class-name">Circle</span><span class="token punctuation">,</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>    <span class="token comment">// ç±»å®šä¹‰</span><span class="token punctuation">}</span><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Circle</span> <span class="token keyword">extends</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>    <span class="token comment">// ç±»å®šä¹‰</span><span class="token punctuation">}</span><span class="token keyword">non-sealed</span> <span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token keyword">extends</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>    <span class="token comment">// ç±»å®šä¹‰</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å¼ºåŒ–çš„ç©ºæŒ‡é’ˆå¼‚å¸¸ä¿¡æ¯"><a href="#å¼ºåŒ–çš„ç©ºæŒ‡é’ˆå¼‚å¸¸ä¿¡æ¯" class="headerlink" title="å¼ºåŒ–çš„ç©ºæŒ‡é’ˆå¼‚å¸¸ä¿¡æ¯"></a>å¼ºåŒ–çš„ç©ºæŒ‡é’ˆå¼‚å¸¸ä¿¡æ¯</h4><p>ä»JDK 17å¼€å§‹ï¼Œå¼‚å¸¸ä¿¡æ¯ä¼šæ˜ç¡®æŒ‡å‡ºæ˜¯å“ªä¸ªå˜é‡æˆ–å“ªä¸ªè¡¨è¾¾å¼çš„ç»“æœä¸º<code>null</code>ï¼Œå¤§å¤§å‡å°‘äº†è°ƒè¯•æ—¶é—´ã€‚</p><h3 id="jdk8-æ–°ç‰¹æ€§"><a href="#jdk8-æ–°ç‰¹æ€§" class="headerlink" title="jdk8 æ–°ç‰¹æ€§"></a>jdk8 æ–°ç‰¹æ€§</h3><p>Lambdaï¼ŒStreamï¼Œæ–°çš„æ—¥æœŸAPIã€Optionalç±»</p><h4 id="Streamæµç›¸å…³"><a href="#Streamæµç›¸å…³" class="headerlink" title="Streamæµç›¸å…³"></a>Streamæµç›¸å…³</h4><p>Lambdaè¡¨è¾¾å¼æ˜¯Java 8å¼•å…¥çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€æ´çš„æ–¹å¼æ¥è¡¨ç¤ºåŒ¿åæ–¹æ³•ã€‚è¿™ç§è¡¨è¾¾å¼åŸºäºæ•°å­¦ä¸­çš„Î»æ¼”ç®—ï¼ˆä¸€ç§ç”¨äºæè¿°å‡½æ•°çš„ç³»ç»Ÿï¼‰ï¼Œåœ¨Javaä¸­ä¸»è¦ç”¨äºå®ç°å‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µã€‚<br>åˆ†ç»„ï¼šcollecté‡Œé¢ä½¿ç”¨Collectors.groupingByæ–¹æ³•è¿›è¡Œåˆ†ç»„</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> peopleByAge <span class="token operator">=</span> people<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token operator">::</span><span class="token function">getAge</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿‡æ»¤ï¼šfilterå’Œ limitå’Œdistinctå’Œskip</p><h4 id="lambdaè¡¨è¾¾å¼"><a href="#lambdaè¡¨è¾¾å¼" class="headerlink" title="lambdaè¡¨è¾¾å¼"></a>lambdaè¡¨è¾¾å¼</h4><p>æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä½¿ç”¨lambdaè¡¨è¾¾å¼<br>::new æ˜¯æ–¹æ³•å¼•ç”¨çš„ä¸€ç§ï¼Œç”¨äºå¼•ç”¨æ„é€ å‡½æ•°<br>å¯ä»¥æ­é…å‡½æ•°å¼æ¥å£æ¥æ›´åŠ ç®€æ´çš„åˆ›å»ºä¸€ä¸ªç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> personSupplier <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">;</span><span class="token class-name">Person</span> person <span class="token operator">=</span> personSupplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è°ƒç”¨Personçš„æ— å‚æ•°æ„é€ å‡½æ•°</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> personFunction <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">;</span><span class="token class-name">Person</span> person <span class="token operator">=</span> personFunction<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è°ƒç”¨Personçš„å¸¦æœ‰ä¸€ä¸ªStringå‚æ•°çš„æ„é€ å‡½æ•°</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æœ‰ä»€ä¹ˆç”¨"><a href="#æœ‰ä»€ä¹ˆç”¨" class="headerlink" title="::æœ‰ä»€ä¹ˆç”¨"></a>::æœ‰ä»€ä¹ˆç”¨</h4><ol><li>å¼•ç”¨é™æ€æ–¹æ³•ï¼Œä¾‹å¦‚Integer::parseInt</li><li>å¼•ç”¨å®ä¾‹æ–¹æ³•ï¼š<code>String s = "hello";</code>ï¼Œåˆ™<code>s::toUpperCase</code></li><li>å¼•ç”¨ç‰¹å®šç±»å‹çš„ä»»æ„å¯¹è±¡çš„å®ä¾‹æ–¹æ³•ï¼šString::toLowerCase</li><li>å¼•ç”¨æ„é€ å‡½æ•°ï¼šArrayList::new</li></ol><h3 id="SpringCloud-Alibaba"><a href="#SpringCloud-Alibaba" class="headerlink" title="SpringCloud Alibaba"></a>SpringCloud Alibaba</h3><h4 id="å“ªäº›ç»„ä»¶"><a href="#å“ªäº›ç»„ä»¶" class="headerlink" title="å“ªäº›ç»„ä»¶"></a>å“ªäº›ç»„ä»¶</h4><p>Nacosã€Sentinelã€Dubboã€RocketMQã€Seataã€Gateway</p><h3 id="Nacosçš„ä½œç”¨"><a href="#Nacosçš„ä½œç”¨" class="headerlink" title="Nacosçš„ä½œç”¨"></a>Nacosçš„ä½œç”¨</h3><h4 id="Nacoså¦‚ä½•åŒºåˆ†ä¸åŒçš„é…ç½®"><a href="#Nacoså¦‚ä½•åŒºåˆ†ä¸åŒçš„é…ç½®" class="headerlink" title="Nacoså¦‚ä½•åŒºåˆ†ä¸åŒçš„é…ç½®"></a>Nacoså¦‚ä½•åŒºåˆ†ä¸åŒçš„é…ç½®</h4><ol><li><strong>Data ID</strong>ï¼šé…ç½®IDï¼Œé€šå¸¸ç”¨äºå”¯ä¸€æ ‡è¯†ä¸€ä¸ªé…ç½®å†…å®¹ã€‚</li><li><strong>Group</strong>ï¼šåˆ†ç»„ï¼ŒNacoså…è®¸ç”¨æˆ·é€šè¿‡åˆ†ç»„æ¥å¯¹é…ç½®è¿›è¡Œåˆ†ç±»ï¼Œä¸€ä¸ªGroupä¸­å¯ä»¥æœ‰å¤šä¸ªData IDã€‚</li><li><strong>Namespace</strong>ï¼šå‘½åç©ºé—´ï¼Œç”¨äºè¿›ä¸€æ­¥éš”ç¦»é…ç½®ã€‚ä¸€ä¸ªå‘½åç©ºé—´ä¸‹å¯ä»¥æœ‰å¤šä¸ªGroupï¼Œä¸€ä¸ªGroupä¸‹å¯ä»¥æœ‰å¤šä¸ªData IDã€‚å‘½åç©ºé—´é€šå¸¸ç”¨äºåŒºåˆ†ä¸åŒçš„å¼€å‘ç¯å¢ƒï¼Œå¦‚å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒã€‚</li></ol><h4 id="å‘½åç©ºé—´é‡å¤äº†ä¼šæ€ä¹ˆç”¨"><a href="#å‘½åç©ºé—´é‡å¤äº†ä¼šæ€ä¹ˆç”¨" class="headerlink" title="å‘½åç©ºé—´é‡å¤äº†ä¼šæ€ä¹ˆç”¨"></a>å‘½åç©ºé—´é‡å¤äº†ä¼šæ€ä¹ˆç”¨</h4><p>å‘½åç©ºé—´æ˜¯é€šè¿‡å”¯ä¸€çš„Namespace IDæ¥æ ‡è¯†çš„ï¼Œè€Œä¸æ˜¯ä»…ä»…é€šè¿‡åç§°ã€‚å³ä½¿ä¸¤ä¸ªå‘½åç©ºé—´çš„åç§°ç›¸åŒï¼Œå®ƒä»¬çš„Namespace IDä¹Ÿæ˜¯ä¸åŒçš„ï¼Œå› æ­¤Nacosä»ç„¶èƒ½å¤ŸåŒºåˆ†å®ƒä»¬ã€‚<br>å¦‚æœæœåŠ¡åˆ†å‘åæœåŠ¡æ–­å¼€äº†ä¼šæ€ä¹ˆåŠ</p><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><h4 id="Redisson"><a href="#Redisson" class="headerlink" title="Redisson"></a>Redisson</h4><p>Redissonä¼šæ— é™å»¶é•¿ä¸€ä¸ªé”®çš„è¿‡æœŸæ—¶é—´å—ï¼Œå¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span> å°è¯•<span class="token number">10</span>så†…è·å¾—é”ï¼Œé”çš„æœ€å¤§ç”Ÿå­˜æ—¶é—´æ˜¯<span class="token number">60</span>slock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>è¿›è¡Œçœ‹é—¨ç‹—è¿™ä¸¤æ­¥æ“ä½œå®é™…ä¸Šæ˜¯è·å¾—äº†ä¸¤ä¸ªé”ï¼Œä¸èƒ½åšåˆ°å¯¹åŒä¸€ä¸ªé”è¿›è¡Œçœ‹é—¨ç‹—å’Œåˆ°è¾¾ä¸€å®šæ—¶é—´å°±æ”¾å¼ƒè¿™ä¸ªé”<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="JavaåŸºç¡€-JUC"><a href="#JavaåŸºç¡€-JUC" class="headerlink" title="JavaåŸºç¡€ JUC***"></a>JavaåŸºç¡€ JUC***</h3><p><strong>AtomicInteger</strong>ï¼šå¹¶å‘åœºæ™¯ä¸‹ä½¿ç”¨ï¼Œå®ƒæä¾›äº†ä¸€ç§åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å®‰å…¨åœ°æ“ä½œå•ä¸ªæ•´æ•°çš„æ–¹å¼ï¼Œè€Œæ— éœ€ä½¿ç”¨<code>synchronized</code>å…³é”®å­—ã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨åº•å±‚çš„éé˜»å¡ç®—æ³•å®ç°çš„ï¼Œé€šå¸¸æ˜¯åˆ©ç”¨CPUçš„åŸå­æŒ‡ä»¤ã€‚<code>AtomicInteger</code>æ”¯æŒåŸå­æ“ä½œï¼Œè¿™æ„å‘³ç€æ¯ä¸ªæ“ä½œéƒ½æ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œä¿è¯äº†åœ¨å¹¶å‘ç¯å¢ƒä¸­çš„çº¿ç¨‹å®‰å…¨ã€‚</p><h4 id="å…«å¤§æ•°æ®ç±»å‹å’Œå»¶å±•æ€§"><a href="#å…«å¤§æ•°æ®ç±»å‹å’Œå»¶å±•æ€§" class="headerlink" title="å…«å¤§æ•°æ®ç±»å‹å’Œå»¶å±•æ€§"></a>å…«å¤§æ•°æ®ç±»å‹å’Œå»¶å±•æ€§</h4><h3 id="MyBatiså¦‚ä½•åœ¨æŸ¥è¯¢çš„æ—¶å€™å°±è¿›è¡Œç»„è£…"><a href="#MyBatiså¦‚ä½•åœ¨æŸ¥è¯¢çš„æ—¶å€™å°±è¿›è¡Œç»„è£…" class="headerlink" title="MyBatiså¦‚ä½•åœ¨æŸ¥è¯¢çš„æ—¶å€™å°±è¿›è¡Œç»„è£…"></a>MyBatiså¦‚ä½•åœ¨æŸ¥è¯¢çš„æ—¶å€™å°±è¿›è¡Œç»„è£…</h3><ol><li>ä½¿ç”¨resultMapè¿›è¡Œç»“æœæ˜ å°„<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>genderResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>YourModelClass<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gender<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gender_column<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.String<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span> <span class="token attr-name">typeHandler</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>GenderTypeHandler<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!-- å…¶ä»–å­—æ®µæ˜ å°„ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span><span class="token class-name">JdbcType</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span><span class="token class-name">TypeHandler</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenderTypeHandler</span> <span class="token keyword">implements</span> <span class="token class-name">TypeHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span> ps<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token class-name">String</span> parameter<span class="token punctuation">,</span> <span class="token class-name">JdbcType</span> jdbcType<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>        <span class="token comment">// è®¾ç½®å‚æ•°æ—¶çš„é€»è¾‘ï¼ˆå¦‚æœéœ€è¦ï¼‰</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">,</span> <span class="token class-name">String</span> columnName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> gender <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>columnName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> gender <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">"ç”·"</span> <span class="token operator">:</span> <span class="token string">"å¥³"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">,</span> <span class="token keyword">int</span> columnIndex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> gender <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>columnIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> gender <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">"ç”·"</span> <span class="token operator">:</span> <span class="token string">"å¥³"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token class-name">CallableStatement</span> cs<span class="token punctuation">,</span> <span class="token keyword">int</span> columnIndex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> gender <span class="token operator">=</span> cs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>columnIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> gender <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">"ç”·"</span> <span class="token operator">:</span> <span class="token string">"å¥³"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>æœ€ååœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œæ³¨å†Œ<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeHandlers</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeHandler</span> <span class="token attr-name">handler</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yourpackage.GenderTypeHandler<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeHandlers</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="2024-06-28-æ·±åœ³åŒè¡Œè€…ç§‘æŠ€ä¸€é¢ï¼ˆä¸€é¢æŒ‚ï¼‰"><a href="#2024-06-28-æ·±åœ³åŒè¡Œè€…ç§‘æŠ€ä¸€é¢ï¼ˆä¸€é¢æŒ‚ï¼‰" class="headerlink" title="2024-06-28 æ·±åœ³åŒè¡Œè€…ç§‘æŠ€ä¸€é¢ï¼ˆä¸€é¢æŒ‚ï¼‰"></a>2024-06-28 æ·±åœ³åŒè¡Œè€…ç§‘æŠ€ä¸€é¢ï¼ˆä¸€é¢æŒ‚ï¼‰</h2><h3 id="æ‹·æ‰“ç¬”è¯•é¢˜-x2F-ç®—æ³•é¢˜"><a href="#æ‹·æ‰“ç¬”è¯•é¢˜-x2F-ç®—æ³•é¢˜" class="headerlink" title="æ‹·æ‰“ç¬”è¯•é¢˜/ç®—æ³•é¢˜"></a>æ‹·æ‰“ç¬”è¯•é¢˜/ç®—æ³•é¢˜</h3><h4 id="1000wä¸ªæ•°æ®ä¸­åªæœ‰ä¸¤ä¸ªç›¸åŒçš„æ•°æ®ï¼Œå¦‚ä½•æ‰¾å‡ºæ¥"><a href="#1000wä¸ªæ•°æ®ä¸­åªæœ‰ä¸¤ä¸ªç›¸åŒçš„æ•°æ®ï¼Œå¦‚ä½•æ‰¾å‡ºæ¥" class="headerlink" title="1000wä¸ªæ•°æ®ä¸­åªæœ‰ä¸¤ä¸ªç›¸åŒçš„æ•°æ®ï¼Œå¦‚ä½•æ‰¾å‡ºæ¥"></a>1000wä¸ªæ•°æ®ä¸­åªæœ‰ä¸¤ä¸ªç›¸åŒçš„æ•°æ®ï¼Œå¦‚ä½•æ‰¾å‡ºæ¥</h4><p>ä½¿ç”¨HashSet</p><h3 id="è§£é‡Šä¸€ä¸‹ç­¾åˆ°æ¨¡å—ä¸­çš„æ¥å£å¹‚ç­‰æ€§"><a href="#è§£é‡Šä¸€ä¸‹ç­¾åˆ°æ¨¡å—ä¸­çš„æ¥å£å¹‚ç­‰æ€§" class="headerlink" title="è§£é‡Šä¸€ä¸‹ç­¾åˆ°æ¨¡å—ä¸­çš„æ¥å£å¹‚ç­‰æ€§"></a>è§£é‡Šä¸€ä¸‹ç­¾åˆ°æ¨¡å—ä¸­çš„æ¥å£å¹‚ç­‰æ€§</h3><h3 id="è§£é‡Šä¸€ä¸‹å¦‚ä½•ä¿è¯çš„Redisçš„é«˜å¯ç”¨æ€§"><a href="#è§£é‡Šä¸€ä¸‹å¦‚ä½•ä¿è¯çš„Redisçš„é«˜å¯ç”¨æ€§" class="headerlink" title="è§£é‡Šä¸€ä¸‹å¦‚ä½•ä¿è¯çš„Redisçš„é«˜å¯ç”¨æ€§"></a>è§£é‡Šä¸€ä¸‹å¦‚ä½•ä¿è¯çš„Redisçš„é«˜å¯ç”¨æ€§</h3><h3 id="åˆ†å¸ƒå¼"><a href="#åˆ†å¸ƒå¼" class="headerlink" title="åˆ†å¸ƒå¼"></a>åˆ†å¸ƒå¼</h3><h4 id="åˆ†å¸ƒå¼æ¶æ„è¦æ³¨æ„å“ªäº›é—®é¢˜"><a href="#åˆ†å¸ƒå¼æ¶æ„è¦æ³¨æ„å“ªäº›é—®é¢˜" class="headerlink" title="åˆ†å¸ƒå¼æ¶æ„è¦æ³¨æ„å“ªäº›é—®é¢˜"></a>åˆ†å¸ƒå¼æ¶æ„è¦æ³¨æ„å“ªäº›é—®é¢˜</h4><ol><li>æ•°æ®ä¸€è‡´æ€§ï¼šè¦ä¿è¯é›†ç¾¤ä¸­çš„æ•°æ®æ˜¯ä¸€è‡´çš„</li><li>ç½‘ç»œåˆ†åŒºå®¹å¿æ€§ï¼šå‡ºç°äº†ç½‘ç»œåˆ†åŒºï¼Œæ ¹æ®CAPå®šç†ï¼Œå‡ºç°ç½‘ç»œåˆ†åŒºæ—¶éœ€è¦åœ¨ä¸šåŠ¡éœ€æ±‚çš„ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ä¹‹é—´åšå‡ºå‡è¡¡</li><li>æœåŠ¡å‘ç°ï¼šå½“æœåŠ¡å‡ºç°å¢åŠ å‡å°‘æˆ–è€…ç§»åŠ¨ï¼Œå®¢æˆ·ç«¯éœ€è¦æ‰¾åˆ°è¿™äº›æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨Nacosè§£å†³</li><li>è´Ÿè½½å‡è¡¡ï¼šåˆç†åˆ†é…è¯·æ±‚æˆ–ä»»åŠ¡åˆ°å¤šä¸ªæœåŠ¡èŠ‚ç‚¹ï¼Œæ¥ä¼˜åŒ–èµ„æºåˆ©ç”¨ç‡å’Œå“åº”æ—¶é—´</li><li>å®¹é”™å’Œæ•…éšœè½¬ç§»ï¼šå•ç‚¹æ•…éšœä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨</li><li>äº‹åŠ¡ç®¡ç†ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç®¡ç†è·¨å¤šä¸ªæœåŠ¡çš„äº‹åŠ¡ï¼Œä¿è¯æ“ä½œçš„åŸå­æ€§å’Œä¸€è‡´æ€§</li><li>å®‰å…¨æ€§ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‹‰åŠ±å¤šç§å®‰å…¨å¨èƒï¼Œæ•°æ®æ³„éœ²ï¼ŒæœåŠ¡æ‹’ç»æ”»å‡»</li><li>æ€§èƒ½ç›‘æ§å’Œè°ƒä¼˜ï¼š<br>CAPåŸç†<br><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong><br><strong>å¯ç”¨æ€§ï¼ˆAvailability</strong>ï¼‰<br><strong>åˆ†åŒºå®¹å¿æ€§ï¼ˆPartition tolerance</strong>ï¼‰<br>å½“å‡ºç°ç½‘ç»œåˆ†åŒºPæ—¶ï¼ŒCAåªèƒ½ä¿è¯ä¸€ä¸ª</li></ol><h3 id="é¡¹ç›®ä¸­é‡è§çš„æ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜ï¼Œå¦‚ä½•è§£å†³çš„"><a href="#é¡¹ç›®ä¸­é‡è§çš„æ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜ï¼Œå¦‚ä½•è§£å†³çš„" class="headerlink" title="é¡¹ç›®ä¸­é‡è§çš„æ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜ï¼Œå¦‚ä½•è§£å†³çš„"></a>é¡¹ç›®ä¸­é‡è§çš„æ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜ï¼Œå¦‚ä½•è§£å†³çš„</h3><h3 id="æ•°æ®åº“ä¸­çš„è„æ•°æ®å¦‚ä½•å¤„ç†"><a href="#æ•°æ®åº“ä¸­çš„è„æ•°æ®å¦‚ä½•å¤„ç†" class="headerlink" title="æ•°æ®åº“ä¸­çš„è„æ•°æ®å¦‚ä½•å¤„ç†"></a>æ•°æ®åº“ä¸­çš„è„æ•°æ®å¦‚ä½•å¤„ç†</h3><h2 id="2024-07-02-æ±Ÿè‹è¿è”äºŒé¢-ç­‰ç»“æœï¼Œè‡ªæˆ‘æ„Ÿè§‰è¿˜å¯ä»¥"><a href="#2024-07-02-æ±Ÿè‹è¿è”äºŒé¢-ç­‰ç»“æœï¼Œè‡ªæˆ‘æ„Ÿè§‰è¿˜å¯ä»¥" class="headerlink" title="2024-07-02 æ±Ÿè‹è¿è”äºŒé¢(ç­‰ç»“æœï¼Œè‡ªæˆ‘æ„Ÿè§‰è¿˜å¯ä»¥)"></a>2024-07-02 æ±Ÿè‹è¿è”äºŒé¢(ç­‰ç»“æœï¼Œè‡ªæˆ‘æ„Ÿè§‰è¿˜å¯ä»¥)</h2><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¸»åŠ¨æŠŠè‡ªå·±çš„äº®ç‚¹é¡¹ç›®ä»‹ç»å‡ºæ¥ï¼Œåœ¨è‡ªæˆ‘ä»‹ç»ç¯èŠ‚å°±åŠªåŠ›ä»‹ç»ã€‚æŠŠè‡ªå·±çš„ä¼˜ç‚¹ï¼ˆè‹±è¯­ã€å…­çº§ã€åšå®¢ã€é¡¹ç›®å¼€å‘ã€githubã€æƒ³ç»™å¼€æºé¡¹ç›®åšè´¡çŒ®ï¼‰</p><h3 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>æ‰¿æ‹…çš„è´£ä»»ã€å‰åç«¯éƒ½å‚ä¸å¼€å‘ï¼Œä¸»è¦æ¡†æ¶æ­å»ºï¼Œå‘¨æœŸ</li><li>ä»‹ç»é¡¹ç›®ï¼ˆè¦ä¸»åŠ¨ä»‹ç»è‡ªå·±çš„ç‰¹ç‚¹å’Œäº®ç‚¹ï¼‰</li><li>æ¡†æ¶æ­å»ºä½¿ç”¨äº†å“ªäº›æŠ€æœ¯æ ˆ</li><li>ç­¾åˆ°ç›¸å…³</li><li>éœ€æ±‚æ€ä¹ˆæ¥çš„</li><li>æœ‰è¯¾å¦ï¼Ÿå­¦åˆ†èƒ½ä¿®æ»¡å¦ï¼Ÿå¤§ä¸‰ä¸‹å­¦æœŸæœ‰å¯å¦ï¼Ÿå¤§å››è¦å¹²å˜›ï¼Ÿ</li><li>è‹±è¯­å¦‚ä½•</li><li>æ€ä¹ˆæå‡é˜…è¯»</li><li>æœŸæœ›è–ªèµ„</li><li>æœ€å¿«åˆ°å²—</li><li></li></ol><h3 id="HashMapå’ŒHashTableä»€ä¹ˆåŒºåˆ«"><a href="#HashMapå’ŒHashTableä»€ä¹ˆåŒºåˆ«" class="headerlink" title="HashMapå’ŒHashTableä»€ä¹ˆåŒºåˆ«"></a>HashMapå’ŒHashTableä»€ä¹ˆåŒºåˆ«</h3><ol><li>çº¿ç¨‹å®‰å…¨ï¼š<ul><li><strong>HashTable</strong> çº¿ç¨‹æ›´å®‰å…¨,ä»–çš„æ¯ä¸ªæ–¹æ³•éƒ½æ˜¯åŒæ­¥çš„ï¼Œå¯ä»¥ç”¨åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨ConcurrentHashMap</li></ul></li><li>æ€§èƒ½ï¼šHashMapæ€§èƒ½æ›´å¥½ï¼Œå› ä¸ºä¸éœ€è¦è¿›è¡ŒåŒæ­¥</li><li>ç©ºå€¼ï¼šHashTableä¸å…è®¸key/valueä¸ºnullï¼Œè€ŒHashMapå…è®¸ä¸€æ¡è®°å½•çš„keyä¸ºnullï¼Œå…è®¸å¤šä¸ªè®°å½•çš„valueä¸ºnull</li><li>ç»§æ‰¿çš„è·Ÿç±»ä¸åŒï¼š<ul><li><code>HashTable</code>&nbsp;ç»§æ‰¿è‡ª&nbsp;<code>Dictionary</code>&nbsp;ç±»ã€‚</li><li><code>HashMap</code>&nbsp;ç»§æ‰¿è‡ª&nbsp;<code>AbstractMap</code>&nbsp;ç±»å¹¶å®ç°äº†&nbsp;<code>Map</code>&nbsp;æ¥å£ã€‚</li></ul></li><li>è¿­ä»£å™¨<ul><li><code>HashTable</code>&nbsp;ä½¿ç”¨&nbsp;<code>Enumerator</code>&nbsp;è¿›è¡Œè¿­ä»£ã€‚</li><li><code>HashMap</code>&nbsp;ä½¿ç”¨&nbsp;<code>Iterator</code>&nbsp;è¿›è¡Œè¿­ä»£ã€‚<code>Iterator</code>&nbsp;æ˜¯fail-fastè¿­ä»£å™¨ï¼Œå¦‚æœåœ¨è¿­ä»£è¿‡ç¨‹ä¸­æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†&nbsp;<code>HashMap</code>ï¼Œåˆ™ä¼šæŠ›å‡º&nbsp;<code>ConcurrentModificationException</code>ã€‚</li></ul></li><li><strong>å†…éƒ¨ç»“æ„</strong>ï¼ˆJava 8 åŠä»¥åï¼‰ï¼š<ul><li><code>HashMap</code>&nbsp;åœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º8ï¼‰æ—¶ï¼Œé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œä»¥æé«˜æœç´¢æ•ˆç‡ã€‚</li><li><code>HashTable</code>&nbsp;ä¸å…·å¤‡è¿™ç§é“¾è¡¨åˆ°çº¢é»‘æ ‘çš„è½¬æ¢æœºåˆ¶ã€‚</li></ul></li></ol><h3 id="ConcurrentHashMapç›¸å…³"><a href="#ConcurrentHashMapç›¸å…³" class="headerlink" title="ConcurrentHashMapç›¸å…³"></a>ConcurrentHashMapç›¸å…³</h3><h3 id="MySQLç´¢å¼•-1"><a href="#MySQLç´¢å¼•-1" class="headerlink" title="MySQLç´¢å¼•"></a>MySQLç´¢å¼•</h3><h3 id="ç´¢å¼•æœ‰ä»€ä¹ˆç”¨"><a href="#ç´¢å¼•æœ‰ä»€ä¹ˆç”¨" class="headerlink" title="ç´¢å¼•æœ‰ä»€ä¹ˆç”¨"></a>ç´¢å¼•æœ‰ä»€ä¹ˆç”¨</h3><h4 id="ç´¢å¼•å¤±æ•ˆåœºæ™¯"><a href="#ç´¢å¼•å¤±æ•ˆåœºæ™¯" class="headerlink" title="ç´¢å¼•å¤±æ•ˆåœºæ™¯"></a>ç´¢å¼•å¤±æ•ˆåœºæ™¯</h4><p>å»ºè®®æ­é…è‡ªå·±é¡¹ç›®ä¸­çš„åœºæ™¯ä»‹ç»</p><h3 id="å·¥ä½œæµ"><a href="#å·¥ä½œæµ" class="headerlink" title="å·¥ä½œæµ"></a>å·¥ä½œæµ</h3><h3 id="æ‘„åƒå¤´è¯†åˆ«åˆ†ææ•°æ®ç±»çš„åœºæ™¯äº†è§£è¿‡æ²¡"><a href="#æ‘„åƒå¤´è¯†åˆ«åˆ†ææ•°æ®ç±»çš„åœºæ™¯äº†è§£è¿‡æ²¡" class="headerlink" title="æ‘„åƒå¤´è¯†åˆ«åˆ†ææ•°æ®ç±»çš„åœºæ™¯äº†è§£è¿‡æ²¡"></a>æ‘„åƒå¤´è¯†åˆ«åˆ†ææ•°æ®ç±»çš„åœºæ™¯äº†è§£è¿‡æ²¡</h3><h2 id="2024-07-03-ç¥å·çµäº‘ä¸€é¢-å·²è¿‡ï¼Œå·²å‘ofifer"><a href="#2024-07-03-ç¥å·çµäº‘ä¸€é¢-å·²è¿‡ï¼Œå·²å‘ofifer" class="headerlink" title="2024-07-03 ç¥å·çµäº‘ä¸€é¢(å·²è¿‡ï¼Œå·²å‘ofifer)"></a>2024-07-03 ç¥å·çµäº‘ä¸€é¢(å·²è¿‡ï¼Œå·²å‘ofifer)</h2><h3 id="æµç¨‹-1"><a href="#æµç¨‹-1" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>ä»‹ç»å·¥ä½œå®¤</li><li>é¡¹ç›®ä¸Šçº¿äº†orå®éªŒå®¤é¡¹ç›®</li><li>å·²ç»å­¦å®Œçš„è¯¾ç¨‹</li><li>å…³äºç¬”è¯•é¢˜çš„æé—®ï¼š<ul><li>è§£é¢˜çš„å…³é”®ç‚¹æ˜¯ä»€ä¹ˆ</li><li>æˆ–è¿ç®—å’Œï¼‹è¿ç®—æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè¿™ä¸ªé¢˜ç›®ä¸­ä¸¤ç§è¿ç®—æœ‰ä»€ä¹ˆåŒºåˆ«</li><li>æ•´å‹è½¬å­—ç¬¦ä¸²</li></ul></li><li>ä¸€å‘¨å‡ å¤©/æ—¶é—´/æœ€å¿«åˆ°å²—</li><li>é¡¹ç›®ä»£ç /å‡ äººå¼€å‘ </li><li>åé—®:<ul><li>å¤šä¹…å‡ºé¢è¯•ç»“æœ ç­”ï¼šæŠ€æœ¯é¢ï¼Œè¿˜æœ‰äºŒé¢</li><li>é¢çš„æ€ä¹ˆæ ·ï¼Œæœ‰ä»€ä¹ˆå»ºè®®ï¼Œç­”ï¼šé¢çš„è¿˜å¯ä»¥</li><li>èŒä½çš„èŒè´£ï¼Œ ç­”ï¼šæ–‡æ¡£ï¼Œç®€å•å¼€å‘ï¼Œå¯¹ç½‘ç»œè¦æ±‚è¾ƒé«˜ã€‚</li></ul></li></ol><h3 id="TCPæ¡æ‰‹è¿‡ç¨‹-å¿˜äº†ã€‚ã€‚ã€‚"><a href="#TCPæ¡æ‰‹è¿‡ç¨‹-å¿˜äº†ã€‚ã€‚ã€‚" class="headerlink" title="TCPæ¡æ‰‹è¿‡ç¨‹(å¿˜äº†ã€‚ã€‚ã€‚)"></a>TCPæ¡æ‰‹è¿‡ç¨‹(å¿˜äº†ã€‚ã€‚ã€‚)</h3><ol><li>å®¢æˆ·ç«¯å‘é€å¸¦æœ‰åŒæ­¥åºåˆ—ç¼–å·(SYN)æŠ¥æ–‡åˆ°æœåŠ¡å™¨ï¼Œç„¶åå®¢æˆ·ç«¯è¿›å…¥SYN-SENTçš„çŠ¶æ€</li><li>æœåŠ¡å™¨æ”¶åˆ°å¸¦æœ‰SYNçš„æŠ¥æ–‡ä¹‹åï¼Œå¦‚æœç»Ÿä¸€å»ºç«‹è¿æ¥ï¼Œå°±ä¼šå‘é€ä¸€ä¸ªSYN-ACKæŠ¥æ–‡ä½œæ–‡å“åº”ï¼Œè¿™ä¸ªæŠ¥æ–‡åŒ…å«æœåŠ¡å™¨è‡ªå·±çš„åˆå§‹åºåˆ—å·ï¼ŒåŒæ—¶å¯¹å®¢æˆ·ç«¯çš„SYNæŠ¥æ–‡è¿›è¡Œç¡®è®¤</li><li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„STN-ACKæŠ¥æ–‡ä¹‹åä¼šå‘é€ä¸€ä¸ªACKæŠ¥æ–‡ä½œä¸ºå“åº”ï¼Œä¹‹åå®¢æˆ·ç«¯è¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œä¹‹åæœåŠ¡å™¨æ¥æ”¶åˆ°ä¹‹åä¹Ÿè¿›å…¥è¿æ¥çŠ¶æ€ã€‚</li></ol><h3 id="JWTæ˜¯ä»€ä¹ˆï¼ŒJWTå°±æ˜¯Tokençš„ä¸€ç§æ ¼å¼"><a href="#JWTæ˜¯ä»€ä¹ˆï¼ŒJWTå°±æ˜¯Tokençš„ä¸€ç§æ ¼å¼" class="headerlink" title="JWTæ˜¯ä»€ä¹ˆï¼ŒJWTå°±æ˜¯Tokençš„ä¸€ç§æ ¼å¼"></a>JWTæ˜¯ä»€ä¹ˆï¼ŒJWTå°±æ˜¯Tokençš„ä¸€ç§æ ¼å¼</h3><h3 id="MongoDBåŸºç¡€æé—®ï¼ˆä¸ä¼š-è¿˜æœ‰ESçš„å‘½ä»¤"><a href="#MongoDBåŸºç¡€æé—®ï¼ˆä¸ä¼š-è¿˜æœ‰ESçš„å‘½ä»¤" class="headerlink" title="MongoDBåŸºç¡€æé—®ï¼ˆä¸ä¼š)è¿˜æœ‰ESçš„å‘½ä»¤"></a>MongoDBåŸºç¡€æé—®ï¼ˆä¸ä¼š)è¿˜æœ‰ESçš„å‘½ä»¤</h3><p>èƒŒèƒŒä¸»è¦çš„æŸ¥è¯¢è¯­å¥å»</p><h3 id="æƒé™ç®¡ç†çš„è®¾è®¡"><a href="#æƒé™ç®¡ç†çš„è®¾è®¡" class="headerlink" title="æƒé™ç®¡ç†çš„è®¾è®¡"></a>æƒé™ç®¡ç†çš„è®¾è®¡</h3><h4 id="RBAC-ï¼ˆRole-Based-Access-Controlï¼‰åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶"><a href="#RBAC-ï¼ˆRole-Based-Access-Controlï¼‰åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶" class="headerlink" title="RBAC ï¼ˆRole-Based Access Controlï¼‰åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶"></a>RBAC ï¼ˆ<strong>Role-Based Access Control</strong>ï¼‰åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶</h4><p><img src="/2024/06/07/17/RABC.png"><br>å°†æƒé™èµ‹äºˆè§’è‰²ï¼Œç„¶åå°†è§’è‰²èµ‹äºˆç”¨æˆ·ï¼Œè¿™æ ·çš„è®¾è®¡å°±å¯ä»¥å¾ˆæ–¹æŸéœ“çš„æ›´æ”¹è§’è‰²å†…æ‰€æœ‰ç”¨æˆ·çš„æƒé™ï¼Œä¹Ÿæ–¹ä¾¿å°†ç”¨æˆ·çš„æƒé™å˜æ›´</p><h4 id="ABAC-Attribute-Based-Access-Control-åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶"><a href="#ABAC-Attribute-Based-Access-Control-åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶" class="headerlink" title="ABAC (**Attribute-Based Access Control ) åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶"></a>ABAC (**Attribute-Based Access Control ) åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶</h4><p>é€šè¿‡å„ç§å±æ€§æ¥åŠ¨æ€åˆ¤æ–­ä¸€ä¸ªæ“ä½œæ˜¯å¦å¯ä»¥è¢«å…è®¸ã€‚<br>æ¯”å¦‚èµ‹äºˆæŸä¸ªäººå¯ä»¥æŸ¥çœ‹æŸä¸ªæ–‡æ¡£çš„æƒé™ï¼Œä½†æ˜¯ä¸å¯ä»¥ä¿®æ”¹ã€‚<br>æ˜¯åŸºäºå¯¹è±¡ã€èµ„æºã€æ“ä½œã€ç¯å¢ƒï¼ˆä¸Šä¸‹æ–‡ï¼Œæ—¶é—´å’Œä½ç½®ï¼Œåè®®ç­‰ï¼‰ï¼Œå…·ä½“çš„å®ç°</p><h4 id="æ–°æƒé™ç³»ç»Ÿ"><a href="#æ–°æƒé™ç³»ç»Ÿ" class="headerlink" title="æ–°æƒé™ç³»ç»Ÿ"></a>æ–°æƒé™ç³»ç»Ÿ</h4><p><img src="/2024/06/07/17/%E6%96%B0%E6%9D%83%E9%99%90.png"><br>ä¸»è¦å°±æ˜¯åœ¨RBACçš„åŸºç¡€ä¸Šï¼Œå…è®¸ç»•è¿‡è§’è‰²æ¥ç›´æ¥ç»™ç”¨æˆ·æ·»åŠ ä¸€äº›æƒé™</p><h3 id="é›†ç¾¤æ€ä¹ˆè®¾è®¡çš„ï¼Œæœ‰ä»€ä¹ˆç”¨ï¼Œå¦‚ä½•åº”å¯¹è„‘è£‚"><a href="#é›†ç¾¤æ€ä¹ˆè®¾è®¡çš„ï¼Œæœ‰ä»€ä¹ˆç”¨ï¼Œå¦‚ä½•åº”å¯¹è„‘è£‚" class="headerlink" title="é›†ç¾¤æ€ä¹ˆè®¾è®¡çš„ï¼Œæœ‰ä»€ä¹ˆç”¨ï¼Œå¦‚ä½•åº”å¯¹è„‘è£‚"></a>é›†ç¾¤æ€ä¹ˆè®¾è®¡çš„ï¼Œæœ‰ä»€ä¹ˆç”¨ï¼Œå¦‚ä½•åº”å¯¹è„‘è£‚</h3><h3 id="å¦‚ä½•ä¸­æ­¢SQLè¯­å¥"><a href="#å¦‚ä½•ä¸­æ­¢SQLè¯­å¥" class="headerlink" title="å¦‚ä½•ä¸­æ­¢SQLè¯­å¥"></a>å¦‚ä½•ä¸­æ­¢SQLè¯­å¥</h3><p>åœºæ™¯ï¼šæœ‰ä¸€ä¸ªè®¿é—®éœ€è¦æŸ¥è¯¢ä¸€ä¸ªå¾ˆå¤§çš„æ•°æ®åº“ï¼Œç„¶åå‰ç«¯é‚£è¾¹ç­‰ä¸åŠäº†åˆ·æ–°ï¼Œå°±ä¼šä¸æ–­å‘é€è¿™ä¸ªè¯·æ±‚ï¼Œæˆ‘æ•°æ®åº“è¯¥å¦‚ä½•å¤„ç†è¿™äº›æ— æ•ˆçš„æŸ¥è¯¢ï¼Ÿ</p><h2 id="2024-08-28-åŒ—äº¬ç”¨å‹ä¸€é¢"><a href="#2024-08-28-åŒ—äº¬ç”¨å‹ä¸€é¢" class="headerlink" title="2024-08-28 åŒ—äº¬ç”¨å‹ä¸€é¢"></a>2024-08-28 åŒ—äº¬ç”¨å‹ä¸€é¢</h2><p>è‡ªæˆ‘ä»‹ç»</p><h3 id="ä»‹ç»æ—è·¯ç¼“å­˜ï¼Œæ—è·¯ç¼“å­˜ä¸€å®šèƒ½ä¿è¯ä¸€è‡´æ€§å—"><a href="#ä»‹ç»æ—è·¯ç¼“å­˜ï¼Œæ—è·¯ç¼“å­˜ä¸€å®šèƒ½ä¿è¯ä¸€è‡´æ€§å—" class="headerlink" title="ä»‹ç»æ—è·¯ç¼“å­˜ï¼Œæ—è·¯ç¼“å­˜ä¸€å®šèƒ½ä¿è¯ä¸€è‡´æ€§å—"></a>ä»‹ç»æ—è·¯ç¼“å­˜ï¼Œæ—è·¯ç¼“å­˜ä¸€å®šèƒ½ä¿è¯ä¸€è‡´æ€§å—</h3><p>æ—è·¯ç¼“å­˜æ˜¯ç”±åº”ç”¨ç¨‹åºæ¥ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„ä¸€è‡´æ€§ï¼Œç‰¹ç‚¹æ˜¯ç›´æ¥æ›´æ–°æ•°æ®åº“ï¼Œåˆ é™¤ç¼“å­˜ã€‚<br>å¯ä»¥ä¿è¯ä¸€è‡´æ€§ï¼Œå› ä¸ºç¼“å­˜å†™å…¥çš„é€Ÿåº¦æ˜¯è¿œè¿œå¿«äºæ•°æ®åº“çš„å†™å…¥çš„ã€‚</p><h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨Redissonè€Œä¸æ˜¯ä½¿ç”¨synchronized"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨Redissonè€Œä¸æ˜¯ä½¿ç”¨synchronized" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨Redissonè€Œä¸æ˜¯ä½¿ç”¨synchronized"></a>ä¸ºä»€ä¹ˆä½¿ç”¨Redissonè€Œä¸æ˜¯ä½¿ç”¨synchronized</h3><ol><li>åˆ†å¸ƒå¼é”ï¼ŒSynchronizedåªèƒ½åœ¨å•ä¸ªJVMå†…éƒ¨å·¥ä½œ</li><li>å¯é‡å…¥æ€§ï¼ŒRedissonæä¾›äº†å¯é‡å…¥æ€§é”çš„å®ç°ï¼Œè€ŒSynchronizedéœ€è¦æ‰‹åŠ¨ç®¡ç†å¯é‡å…¥æ€§</li><li>é”è¶…æ—¶ï¼ŒRedissonæ”¯æŒè¶…æ—¶é‡Šæ”¾é˜²æ­¢æ­»é”å‘ç”Ÿ</li></ol><h3 id="HashMapã€ConcurrentHashMap-jdk1-7çš„åŒºåˆ«"><a href="#HashMapã€ConcurrentHashMap-jdk1-7çš„åŒºåˆ«" class="headerlink" title="HashMapã€ConcurrentHashMap jdk1.7çš„åŒºåˆ«"></a>HashMapã€ConcurrentHashMap jdk1.7çš„åŒºåˆ«</h3><h3 id="Sentinel-ç›¸å…³"><a href="#Sentinel-ç›¸å…³" class="headerlink" title="Sentinel ç›¸å…³"></a>Sentinel ç›¸å…³</h3><h3 id="å»ºç«‹ç´¢å¼•æœ‰å“ªäº›è€ƒé‡"><a href="#å»ºç«‹ç´¢å¼•æœ‰å“ªäº›è€ƒé‡" class="headerlink" title="å»ºç«‹ç´¢å¼•æœ‰å“ªäº›è€ƒé‡"></a>å»ºç«‹ç´¢å¼•æœ‰å“ªäº›è€ƒé‡</h3><h3 id="ç´¢å¼•å¤±æ•ˆåœºæ™¯-1"><a href="#ç´¢å¼•å¤±æ•ˆåœºæ™¯-1" class="headerlink" title="ç´¢å¼•å¤±æ•ˆåœºæ™¯"></a>ç´¢å¼•å¤±æ•ˆåœºæ™¯</h3><ol><li>æŸ¥è¯¢æ¡ä»¶ä¸ç¬¦åˆç´¢å¼•åˆ—çš„é¡ºåº</li><li>ä½¿ç”¨å‡½æ•°æˆ–è¡¨è¾¾å¼</li><li>éšå¼ç±»å‹è½¬æ¢</li><li>ä¸ç­‰äºæ“ä½œ</li><li>èŒƒå›´æŸ¥è¯¢</li></ol><h3 id="ESå’ŒMySQLåŒºåˆ«"><a href="#ESå’ŒMySQLåŒºåˆ«" class="headerlink" title="ESå’ŒMySQLåŒºåˆ«"></a>ESå’ŒMySQLåŒºåˆ«</h3><h3 id="Rediså¸¸è§æ•°æ®ç»“æ„ï¼Œstringåº•å±‚"><a href="#Rediså¸¸è§æ•°æ®ç»“æ„ï¼Œstringåº•å±‚" class="headerlink" title="Rediså¸¸è§æ•°æ®ç»“æ„ï¼Œstringåº•å±‚"></a>Rediså¸¸è§æ•°æ®ç»“æ„ï¼Œstringåº•å±‚</h3><h3 id="JVMå†…å­˜æ³„æ¼å¦‚ä½•å®šä½ã€æ’æŸ¥"><a href="#JVMå†…å­˜æ³„æ¼å¦‚ä½•å®šä½ã€æ’æŸ¥" class="headerlink" title="JVMå†…å­˜æ³„æ¼å¦‚ä½•å®šä½ã€æ’æŸ¥"></a>JVMå†…å­˜æ³„æ¼å¦‚ä½•å®šä½ã€æ’æŸ¥</h3><h3 id="dockerå¸¸è§æŒ‡ä»¤"><a href="#dockerå¸¸è§æŒ‡ä»¤" class="headerlink" title="dockerå¸¸è§æŒ‡ä»¤"></a>dockerå¸¸è§æŒ‡ä»¤</h3><h3 id="å¹¶è¡ŒStreamæµçš„åº•å±‚"><a href="#å¹¶è¡ŒStreamæµçš„åº•å±‚" class="headerlink" title="å¹¶è¡ŒStreamæµçš„åº•å±‚"></a>å¹¶è¡ŒStreamæµçš„åº•å±‚</h3><h2 id="ksæµ‹å¼€ä¸€é¢-2024-09-04"><a href="#ksæµ‹å¼€ä¸€é¢-2024-09-04" class="headerlink" title="ksæµ‹å¼€ä¸€é¢ 2024.09.04"></a>ksæµ‹å¼€ä¸€é¢ 2024.09.04</h2><p>è‡ªæˆ‘ä»‹ç»<br>å®ä¹ è´Ÿè´£çš„ä¸šåŠ¡<br> é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§ï¼Œåˆ†åˆ«ä»‹ç»ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨<br> é‡è½½</p><blockquote><p>å¤šæ€ï¼ˆPolymorphismï¼‰æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒå…è®¸å¯¹è±¡ä»¥å¤šç§å½¢å¼å‡ºç°ã€‚å¤šæ€æ€§ä½¿å¾—ç›¸åŒçš„æ“ä½œå¯ä»¥ä½œç”¨äºä¸åŒçš„å¯¹è±¡ï¼Œå¹¶ä¸”è¿™äº›å¯¹è±¡å¯ä»¥æ ¹æ®å…·ä½“çš„å®ç°è¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºã€‚å¤šæ€æ€§ä¸»è¦é€šè¿‡ç»§æ‰¿å’Œæ¥å£å®ç°ã€‚</p><ol><li><strong>ç¼–è¯‘æ—¶å¤šæ€ï¼ˆé™æ€å¤šæ€ï¼‰</strong>ï¼š<br> é€šè¿‡æ–¹æ³•é‡è½½ï¼ˆMethod Overloadingï¼‰å®ç°ã€‚åŒä¸€ä¸ªç±»ä¸­å¯ä»¥æœ‰å¤šä¸ªæ–¹æ³•ï¼Œå®ƒä»¬å…·æœ‰ç›¸åŒçš„åå­—ä½†å‚æ•°ä¸åŒã€‚<br> <strong>è¿è¡Œæ—¶å¤šæ€ï¼ˆåŠ¨æ€å¤šæ€ï¼‰</strong>ï¼š<br>  é€šè¿‡æ–¹æ³•é‡å†™ï¼ˆMethod Overridingï¼‰å®ç°ã€‚å­ç±»å¯ä»¥é‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨è¿è¡Œæ—¶å¯ä»¥æ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚</li></ol></blockquote><h3 id="åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œæ€ä¹ˆåˆ¤æ–­å“ªäº›å¯¹è±¡æ˜¯å›æ”¶å¯¹è±¡"><a href="#åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œæ€ä¹ˆåˆ¤æ–­å“ªäº›å¯¹è±¡æ˜¯å›æ”¶å¯¹è±¡" class="headerlink" title="åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œæ€ä¹ˆåˆ¤æ–­å“ªäº›å¯¹è±¡æ˜¯å›æ”¶å¯¹è±¡"></a>åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œæ€ä¹ˆåˆ¤æ–­å“ªäº›å¯¹è±¡æ˜¯å›æ”¶å¯¹è±¡</h3><ol><li>å¼•ç”¨è®¡æ•°æ³•ï¼Œæ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“æœ‰ä¸€ä¸ªæ–°çš„å¼•ç”¨æŒ‡å‘è¯¥å¯¹è±¡æ—¶ï¼Œè®¡æ•°å™¨+1ï¼Œå½“ä¸€ä¸ªå¼•ç”¨ä¸å†æŒ‡å‘è¯¥å¯¹è±¡æ—¶ï¼Œè®¡æ•°å™¨-1ã€‚å¦‚æœå¼•ç”¨è®¡æ•°å™¨ä¸º0ï¼Œåˆ™å¯ä»¥è¢«å›æ”¶ã€‚ç¼ºç‚¹æ˜¯ï¼šå¾ªç¯å¼•ç”¨ï¼Œä¸¤ä¸ªå¯¹è±¡äº’ç›¸å¼•ç”¨å¯¹æ–¹ï¼Œå¹¶ä¸”ä¸å†è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œå¼•ç”¨è®¡æ•°å™¨æ°¸è¿œä¸ä¼šä¸º0ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</li><li>å¯è¾¾æ€§ç®—æ³•ï¼šé€šè¿‡GC Rootsçš„å¯¹è±¡ä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›å¯¹è±¡å¼€å§‹ï¼Œé€šè¿‡å¼•ç”¨é“¾å¯è¾¾çš„å°±ä¸ä¼šè¢«å›æ”¶ï¼Œä¸å¯è¾¾çš„å°±ä¼šè¢«å›æ”¶ã€‚(å¸¸è§çš„GC Rootsæ˜¯è™šæ‹Ÿæœºæ ˆä¸­çš„å¼•ç”¨å¯¹è±¡ï¼Œæ–¹æ³•åŒºä¸­çš„ç±»é™æ€å±æ€§å¼•ç”¨å¯¹è±¡ï¼Œæ–¹æ³•å»ä¸­çš„å¸¸é‡å¼•ç”¨å¯¹è±¡ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„Nativeæ–¹æ³•å¼•ç”¨çš„å¯¹è±¡)</li><li>æ ‡è®°-æ¸…é™¤ç®—æ³•(Mark-Sweep) <ol><li>ä»GC Rootså¼€å§‹æ ‡è®°å¯è¾¾å¯¹è±¡</li><li>éå†å †ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œæ¸…é™¤é‚£äº›æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚</li></ol></li></ol><h3 id="å¸¸è§çš„é›†åˆçš„å®ç°ç±»ï¼Œé›†åˆçš„å¥½å¤„"><a href="#å¸¸è§çš„é›†åˆçš„å®ç°ç±»ï¼Œé›†åˆçš„å¥½å¤„" class="headerlink" title="å¸¸è§çš„é›†åˆçš„å®ç°ç±»ï¼Œé›†åˆçš„å¥½å¤„"></a>å¸¸è§çš„é›†åˆçš„å®ç°ç±»ï¼Œé›†åˆçš„å¥½å¤„</h3><ol><li>ç®€åŒ–ä»£ç ï¼Œç®€åŒ–æ•°æ®ç»“æ„çš„ä½¿ç”¨</li><li>æé«˜å¼€å‘æ•ˆç‡</li><li>æ€§èƒ½ä¼˜åŒ–</li><li>ç±»å‹å®‰å…¨ï¼Œä½¿ç”¨æ³›å‹å¯ä»¥ç¡®ä¿é›†åˆä¸­çš„å…ƒç´ ç±»å‹ä¸€è‡´é¿å…äº†ç±»å‹è½¬åŒ–é”™è¯¯</li><li>ä¸°å¯Œçš„å·¥å…·ç±»</li></ol><h3 id="MySQLå¸¸è§å‘½ä»¤"><a href="#MySQLå¸¸è§å‘½ä»¤" class="headerlink" title="MySQLå¸¸è§å‘½ä»¤"></a>MySQLå¸¸è§å‘½ä»¤</h3><ol><li>åº“ CREATE DATABEASE, DROP DATABASE,USE ,SHOW DATABASES</li><li>è¡¨ CREATE TABLE,DROP TABLE,SHOW TABLES, ALTER TABLE ADD/DROP/MODIFY</li><li>æ•°æ® INSERT INTO,UPDATE,DELETE FROM,SELECT</li></ol><p>æŸ¥ä¸€ä¸ªè¡¨çš„ç¬¬10è¡Œå’Œ20è¡Œï¼Œlimit 9,10</p><h3 id="MySQLé»˜è®¤ç´¢å¼•çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆ"><a href="#MySQLé»˜è®¤ç´¢å¼•çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆ" class="headerlink" title="MySQLé»˜è®¤ç´¢å¼•çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆ"></a>MySQLé»˜è®¤ç´¢å¼•çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆ</h3><p>é»˜è®¤æ•°æ®ç»“æ„æ˜¯Bæ ‘ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä½¿ç”¨çš„æ˜¯B+æ ‘ä½œä¸ºç´¢å¼•æ•°æ®ç»“æ„<br>Bæ ‘å’ŒB+æ ‘çš„åŒºåˆ«ï¼šå°†æ‰€æœ‰çš„å€¼å­˜åœ¨å¶å­èŠ‚ç‚¹ä¸­</p><h3 id="Rediså’ŒMySQLçš„åŒºåˆ«"><a href="#Rediså’ŒMySQLçš„åŒºåˆ«" class="headerlink" title="Rediså’ŒMySQLçš„åŒºåˆ«"></a>Rediså’ŒMySQLçš„åŒºåˆ«</h3><h3 id="Linuxå¸¸è§å‘½ä»¤"><a href="#Linuxå¸¸è§å‘½ä»¤" class="headerlink" title="Linuxå¸¸è§å‘½ä»¤"></a>Linuxå¸¸è§å‘½ä»¤</h3><h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨äº†Kafka"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨äº†Kafka" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨äº†Kafka"></a>ä¸ºä»€ä¹ˆä½¿ç”¨äº†Kafka</h3><ol><li>è§£è€¦</li><li>å¼‚æ­¥å¤„ç†</li><li>æµé‡å‰Šå³°</li><li>å¯é æ€§</li><li>å¯æ‰©å±•æ€§</li></ol><h3 id="ä»‹ç»ä¸€ä¸‹å®ä¹ é¡¹ç›®ä¹‹é—´çš„æœåŠ¡è°ƒç”¨"><a href="#ä»‹ç»ä¸€ä¸‹å®ä¹ é¡¹ç›®ä¹‹é—´çš„æœåŠ¡è°ƒç”¨" class="headerlink" title="ä»‹ç»ä¸€ä¸‹å®ä¹ é¡¹ç›®ä¹‹é—´çš„æœåŠ¡è°ƒç”¨"></a>ä»‹ç»ä¸€ä¸‹å®ä¹ é¡¹ç›®ä¹‹é—´çš„æœåŠ¡è°ƒç”¨</h3><h3 id="æœ‰ç”¨è¿‡æµ‹è¯•å—"><a href="#æœ‰ç”¨è¿‡æµ‹è¯•å—" class="headerlink" title="æœ‰ç”¨è¿‡æµ‹è¯•å—"></a>æœ‰ç”¨è¿‡æµ‹è¯•å—</h3><p>å¦‚ä½•è¿›è¡Œå‹æµ‹</p><h3 id="åˆ†å¸ƒå¼é”å¦‚ä½•å®ç°çš„ï¼Œæœ‰å“ªäº›å®ç°æ–¹å¼"><a href="#åˆ†å¸ƒå¼é”å¦‚ä½•å®ç°çš„ï¼Œæœ‰å“ªäº›å®ç°æ–¹å¼" class="headerlink" title="åˆ†å¸ƒå¼é”å¦‚ä½•å®ç°çš„ï¼Œæœ‰å“ªäº›å®ç°æ–¹å¼"></a>åˆ†å¸ƒå¼é”å¦‚ä½•å®ç°çš„ï¼Œæœ‰å“ªäº›å®ç°æ–¹å¼</h3><ol><li>åŸºäºRediså®ç°çš„åˆ†å¸ƒå¼é”ï¼Œ</li><li>åŸºäºZooKeeperå®ç°</li></ol><h4 id="ZooKeeperå®ç°"><a href="#ZooKeeperå®ç°" class="headerlink" title="ZooKeeperå®ç°"></a>ZooKeeperå®ç°</h4><p>æœ‰æ›´é«˜çš„å¯é æ€§ä¹‹å¤–ï¼ŒåŠŸèƒ½å¤–å±‚è¿˜æœ‰ä¸€ä¸ªåˆ†å‚æœ‰ç”¨çš„ç‰¹æ€§ï¼šWatchæœºåˆ¶ã€‚è¿™ä¸ªæœºåˆ¶å¯ä»¥ç”¨æ¥å®ç°å…¬å¹³çš„åˆ†å¸ƒå¼é”ã€‚æ€§èƒ½æ–¹é¢è¾ƒå·®</p><h5 id="å¦‚ä½•å®ç°"><a href="#å¦‚ä½•å®ç°" class="headerlink" title="å¦‚ä½•å®ç°"></a>å¦‚ä½•å®ç°</h5><p><img src="/2024/06/07/17/ZooKeeper%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.png" alt="|525"><br>ZooKeeperåˆ†å¸ƒå¼é”æ˜¯åŸºäºä¸´æ—¶é¡ºåºèŠ‚ç‚¹å’ŒWatcher(äº‹ä»¶ç›‘å¬å™¨)å®ç°çš„</p><ol><li>é¦–å…ˆè¦æœ‰ä¸€ä¸ªæŒä¹…èŠ‚ç‚¹/locksï¼Œå®¢æˆ·ç«¯è·å–é”å°±æ˜¯åœ¨locksä¸‹åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹</li><li>åˆ›å»º/locks/lock1èŠ‚ç‚¹ä¹‹åï¼Œä¼šåˆ¤æ–­lock1æ˜¯å¦æ˜¯/locksä¸‹æœ€å°çš„å­èŠ‚ç‚¹</li><li>å¦‚æœæ˜¯æœ€å°çš„å­èŠ‚ç‚¹ï¼Œåˆ™è·å–é”æˆåŠŸï¼Œå¦åˆ™è·å–å¤±è´¥ã€‚</li><li>å¦‚æœè·å–å¤±è´¥ï¼Œå®¢æˆ·ç«¯ä¼šåœ¨/locks/lock0ä¸Šæ³¨å†Œä¸€ä¸ªæ—¶é—´ç›‘å¬å™¨ï¼Œè¿™ä¸ªç›‘å¬å™¨çš„ä½œä¸šç”¨æ˜¯å½“å‰ä¸€ä¸ªèŠ‚ç‚¹é‡Šæ”¾é”ä¹‹åé€šçŸ¥å®¢æˆ·ç«¯1ï¼Œé¿å…æ— æ•ˆè‡ªæ—‹<br>é‡Šæ”¾é”ï¼š</li><li>æˆåŠŸè·å–é”çš„å®¢æˆ·ç«¯åœ¨æ‰§è¡Œå®Œä»»åŠ¡æµç¨‹ä¹‹åï¼Œä¼šå°†å¯¹åº”çš„å­èŠ‚ç‚¹åˆ é™¤</li><li>æˆåŠŸè·å–é”çš„å®¢æˆ·ç«¯å‡ºç°æ•…éšœä¹‹åï¼Œå¯¹åº”çš„å­èŠ‚ç‚¹æ˜¯ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼Œä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œé¿å…äº†é”æ— æ³•è¢«é‡Šæ”¾</li><li>äº‹ä»¶ç›‘å¬å™¨å°±æ˜¯ç›‘å¬è¿™ä¸ªå­èŠ‚ç‚¹åˆ é™¤äº‹ä»¶</li></ol><h5 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸´æ—¶é¡ºåºèŠ‚ç‚¹"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸´æ—¶é¡ºåºèŠ‚ç‚¹" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸´æ—¶é¡ºåºèŠ‚ç‚¹"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸´æ—¶é¡ºåºèŠ‚ç‚¹</h5><p>znodeæ˜¯ZooKeeperä¸­æ•°æ®çš„æœ€å°å•å…ƒ<br>znodeæœ‰4å¤§åˆ†ç±»</p><ol><li>æŒä¹…èŠ‚ç‚¹ï¼šä¸€æ—¦åˆ›å»ºå°±ä¸€ç›´å­˜åœ¨ï¼Œå³ä½¿ZooKeeperé›†ç¾¤å®•æœº</li><li>ä¸´æ—¶èŠ‚ç‚¹ï¼šä¸å®¢æˆ·ç«¯ä¼šè¯ç»‘å®šï¼Œä¼šè¯å°æ—¶åˆ™èŠ‚ç‚¹æ¶ˆå¤±ï¼Œä¸´æ—¶èŠ‚ç‚¹åªèƒ½ä½œä¸ºå¶å­èŠ‚ç‚¹ï¼Œä¸èƒ½å†åˆ›å»ºå­èŠ‚ç‚¹</li><li>æŒä¹…é¡ºåºèŠ‚ç‚¹ï¼šæŒä¹…+é¡ºåºæ€§</li><li>ä¸´æ—¶é¡ºå¯»èŠ‚ç‚¹ï¼šä¸´æ—¶+é¡ºåºæ€§</li></ol><h5 id="ä¸ºä»€ä¹ˆè¦å¯¹å‰ä¸€ä¸ªèŠ‚ç‚¹ç›‘å¬"><a href="#ä¸ºä»€ä¹ˆè¦å¯¹å‰ä¸€ä¸ªèŠ‚ç‚¹ç›‘å¬" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å¯¹å‰ä¸€ä¸ªèŠ‚ç‚¹ç›‘å¬"></a>ä¸ºä»€ä¹ˆè¦å¯¹å‰ä¸€ä¸ªèŠ‚ç‚¹ç›‘å¬</h5><blockquote><p>å½“å‰ä¸€ä¸ªèŠ‚ç‚¹å¯¹åº”çš„å®¢æˆ·ç«¯é‡Šæ”¾é”ä¹‹åï¼ˆä¹Ÿå°±æ˜¯å‰ä¸€ä¸ªèŠ‚ç‚¹è¢«åˆ é™¤ä¹‹åï¼Œç›‘å¬çš„æ˜¯åˆ é™¤äº‹ä»¶ï¼‰ï¼Œé€šçŸ¥è·å–é”å¤±è´¥çš„å®¢æˆ·ç«¯ï¼ˆå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ï¼ŒJava ä¸­çš„ <code>wait/notifyAll</code> ï¼‰ï¼Œè®©å®ƒå°è¯•å»è·å–é”ï¼Œç„¶åå°±æˆåŠŸè·å–é”äº†ã€‚</p></blockquote><h3 id="åé—®"><a href="#åé—®" class="headerlink" title="åé—®"></a>åé—®</h3><ol><li>å®ä¹ ç”Ÿè¯¥åšä»€ä¹ˆï¼šç»™å•¥åšå•¥</li><li>æµ‹è¯•å¼€å‘æ¯”ä¾‹å¤šå°‘ï¼šè‡³å°‘7ï¼š3</li><li>é¢è¯•ç»“æœå¦‚ä½•ï¼Œè¡¨ç°å¦‚ä½•ï¼šä»£ç èƒ½åŠ›å¯ä»¥ï¼Œå¯¹æµ‹è¯•çš„äº†è§£ä¸å¤ªè¡Œï¼Œå¯¹æµ‹è¯•æ˜¯å¦æ„Ÿå…´è¶£</li><li>æµ‹è¯•æŒ‚äº†å¯¹å…¶ä»–å²—ä½æœ‰ä»€ä¹ˆå½±å“ï¼šåªæœ‰ä¸æ¥ä¼šå½±å“</li></ol><h2 id="ç®—æ³•é¢˜-1"><a href="#ç®—æ³•é¢˜-1" class="headerlink" title="ç®—æ³•é¢˜"></a>ç®—æ³•é¢˜</h2><p>æœ€å¤§è·¯å¾„å’Œ(æœ€å°è·¯å¾„å’Œå˜ä½“) midéš¾åº¦<br>å¦‚ä½•éªŒè¯ç®—æ³•é¢˜æ˜¯å¯¹çš„</p><h2 id="å…¶ä»–äººé¢è¯•é‡åˆ°çš„é—®é¢˜"><a href="#å…¶ä»–äººé¢è¯•é‡åˆ°çš„é—®é¢˜" class="headerlink" title="å…¶ä»–äººé¢è¯•é‡åˆ°çš„é—®é¢˜"></a>å…¶ä»–äººé¢è¯•é‡åˆ°çš„é—®é¢˜</h2><h3 id="ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†-x2F-é™æ€ä»£ç†"><a href="#ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†-x2F-é™æ€ä»£ç†" class="headerlink" title="ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†/é™æ€ä»£ç†"></a>ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†/é™æ€ä»£ç†</h3><p>åŠ¨æ€ä»£ç†<br>åŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºä»£ç†å¯¹è±¡çš„æœºåˆ¶ã€‚ä»£ç†å¯¹è±¡å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸå§‹å¯¹è±¡ä»£ç çš„æƒ…å†µä¸‹ï¼Œæ‹¦æˆªå¯¹ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ï¼Œå¹¶åœ¨è°ƒç”¨å‰åæ·»åŠ é¢å¤–çš„é€»è¾‘ã€‚Java ä¸­çš„åŠ¨æ€ä»£ç†ä¸»è¦æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š<br>é™æ€ä»£ç†<br>é™æ€ä»£ç†æ˜¯åœ¨ç¼–è¯‘æ—¶åˆ›å»ºä»£ç†ç±»çš„æœºåˆ¶ã€‚ä»£ç†ç±»åœ¨ç¼–è¯‘æ—¶å°±å·²ç»å­˜åœ¨ï¼Œå¹¶ä¸”å®ç°äº†ä¸ç›®æ ‡å¯¹è±¡ç›¸åŒçš„æ¥å£ã€‚é™æ€ä»£ç†é€šè¿‡åœ¨ä»£ç†ç±»ä¸­è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•æ¥å®ç°å¯¹ç›®æ ‡å¯¹è±¡çš„ä»£ç†ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯äº‹åŠ¡ä¼ æ’­"><a href="#ä»€ä¹ˆæ˜¯äº‹åŠ¡ä¼ æ’­" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‹åŠ¡ä¼ æ’­"></a>ä»€ä¹ˆæ˜¯äº‹åŠ¡ä¼ æ’­</h3><p>äº‹åŠ¡ä¼ æ’­ Transaction Propagation æ˜¯æŒ‡Springæ¡†æ¶ä¸­å®šä¹‰äº‹åŠ¡åœ¨æ–¹æ³•è°ƒç”¨çš„è¿‡ç¨‹ä¸­å¦‚ä½•ä¼ æ’­çš„æœºåˆ¶ã€‚å†³å®šäº†ä¸€ä¸ªæ–¹æ³•åœ¨è°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œäº‹åŠ¡åº”è¯¥å¦‚ä½•è¿›è¡Œç®¡ç†ã€‚</p><ul><li>REQUIREDï¼šé»˜è®¤æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ã€‚è¿™æ˜¯é»˜è®¤çš„<img src="/2024/06/07/17/REQUIRED.png"></li><li>REQUIRED_NEWï¼šæ€»æ˜¯åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå½“å‰å­˜åœ¨äº‹åŠ¡å°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·<img src="/2024/06/07/17/REQUIRED_NEW.png"></li><li>SUPPORTSï¼šå¦‚æœå­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä»¥éäº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œ</li><li>NOT_SUPPORTEDï¼šå³ä½¿å½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œä¹Ÿä¸è¿›è¡Œäº‹åŠ¡æ“ä½œã€‚</li><li>MANDATORYï¼šå­˜åœ¨å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±æŠ›å‡ºå¼‚å¸¸</li><li>NEVERï¼šæ€»æ˜¯ä»¥éäº‹åŠ¡çš„æ–¹å¼è¿è¡Œï¼Œå­˜åœ¨äº‹åŠ¡å°±æŠ›å‡ºå¼‚å¸¸</li><li>NESTEDï¼šå­˜åœ¨äº‹åŠ¡å°±åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œï¼Œæ²¡æœ‰äº‹åŠ¡å°±åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ã€‚å¯ä»¥è¯»åˆ°åµŒå¥—äº‹åŠ¡</li></ul><h3 id="g1-full-gcé€€åŒ–è¿‡ç¨‹"><a href="#g1-full-gcé€€åŒ–è¿‡ç¨‹" class="headerlink" title="g1 full gcé€€åŒ–è¿‡ç¨‹"></a>g1 full gcé€€åŒ–è¿‡ç¨‹</h3><h4 id="G1çš„å·¥ä½œåŸç†"><a href="#G1çš„å·¥ä½œåŸç†" class="headerlink" title="G1çš„å·¥ä½œåŸç†"></a>G1çš„å·¥ä½œåŸç†</h4><ol><li>åˆ†ä»£æ”¶é›†:G1å°†å †å†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„åŒºåŸŸï¼ŒYong GC ä¸»è¦æ”¶é›†EdenåŒºå’ŒSurvivoråŒºçš„åƒåœ¾å¯¹è±¡</li><li>æ··åˆæ”¶é›†Mixed GCï¼šä¸ä»…å¹´è½»ä»£ï¼Œè¿˜æ”¶é›†éƒ¨åˆ†è€å¹´ä»£çš„åƒåœ¾å¯¹è±¡</li><li>å¹¶å‘æ ‡è®°å‘¨æœŸï¼šå¹¶å‘æ ‡è®°ï¼Œåƒåœ¾æ”¶é›†å¯ä»¥ä¸åº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œå‡å°‘åƒåœ¾æ”¶é›†å¯¹åº”ç”¨ç¨‹åºçš„å½±å“æ ‡è®°è€å¹´ä»£ä¸­å­˜æ´»å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨æ··åˆæ”¶é›†ä¸­å›æ”¶ã€‚</li></ol><h4 id="é€€åŒ–çš„åŸå› "><a href="#é€€åŒ–çš„åŸå› " class="headerlink" title="é€€åŒ–çš„åŸå› "></a>é€€åŒ–çš„åŸå› </h4><ol><li>å†…å­˜ä¸è¶³ï¼šå½“å†…å­˜ä¸è¶³ä»¥åˆ†é…æ–°çš„å¯¹è±¡æˆ–æ— æ³•é€šè¿‡Yong GCå’ŒMixed GCä¼šæœç‹ï¼Œè¶³å¤Ÿçš„å†…å­˜æ—¶ï¼Œä¼šè§¦å‘Full GC</li><li>å¹¶å‘å¤±è´¥ï¼šåœ¨å¹¶å‘æ ‡è®°å‘¨æœŸä¸­ï¼Œå¦‚æœæ— æ³•å³ä½¿å®Œæˆæ ‡è®°æˆ–è€…å›æ”¶ï¼Œå¯èƒ½ä¼šé€€åŒ–ä¸ºFull GC</li><li>æ™‹å‡å¤±è´¥ï¼šå½“å¯¹è±¡ä»å¹´è½»ä»£æ™‹å‡åˆ°è€å¹´ä»£æ—¶ï¼Œå¦‚æœè€å¹´ä»£æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´</li><li>å…ƒæ•°æ®ç©ºé—´ä¸è¶³</li></ol><h4 id="é€€åŒ–è¿‡ç¨‹"><a href="#é€€åŒ–è¿‡ç¨‹" class="headerlink" title="é€€åŒ–è¿‡ç¨‹"></a>é€€åŒ–è¿‡ç¨‹</h4><ol><li>å†…å­˜åˆ†é…å¤±è´¥ï¼Œå°è¯•è§¦å‘Yong GC</li><li>Yong GCå¤±è´¥ï¼Œè§¦å‘Mixed GC</li><li>Mixed GCå¤±è´¥ï¼ŒJVMè¿›å…¥Full GC</li><li>Full GCä¼šæš‚åœæ‰€æœ‰åº”ç”¨çº¿ç¨‹ï¼Œè¿›è¡Œå…¨ç«™æ‰«æå’Œå‹ç¼©ï¼Œä»¥ä¼šæœå°½å¯èƒ½å¤šçš„å†…å­˜ã€‚</li></ol><h3 id="gRPCä¸ºä»€ä¹ˆå¯ä»¥æé«˜æ•ˆç‡"><a href="#gRPCä¸ºä»€ä¹ˆå¯ä»¥æé«˜æ•ˆç‡" class="headerlink" title="gRPCä¸ºä»€ä¹ˆå¯ä»¥æé«˜æ•ˆç‡"></a>gRPCä¸ºä»€ä¹ˆå¯ä»¥æé«˜æ•ˆç‡</h3><ol><li>é«˜æ•ˆçš„åè®® Protocol Buffers</li><li>åŸºäºHTTP/2çš„ä¼ è¾“åè®®ï¼š<ul><li>å¤šè·¯å¤ç”¨ï¼šHTTP/2å…è®¸åœ¨å•ä¸ªTCPè¿æ¥ä¸Šå¹¶è¡Œå‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”ï¼Œå‡å°‘äº†è¿æ¥å»ºç«‹çš„å¼€é”€</li><li>å¤´éƒ¨å‹ç¼©ï¼šä½¿ç”¨HPACKç®—æ³•å¯¹å¤´éƒ¨è¿›è¡Œå‹ç¼©</li><li>æœåŠ¡å™¨æ¨é€ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯è¯·æ±‚ä¹‹å‰å‘é€æ•°æ®ï¼Œå‡å°‘å»¶è¿Ÿ</li><li>æµæ§åˆ¶ï¼šæ›´ç»†åŠ›åº¦çš„æµæ§åˆ¶ï¼Œä¼˜åŒ–äº†å¸¦å®½åˆ©ç”¨ç‡</li></ul></li><li>åŒå‘æµå’Œæµæ§åˆ¶ï¼šå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å•ä¸ªè¿æ¥ä¸ŠåŒæ—¶æ¥æ”¶å’Œå‘é€æ•°æ®ã€‚</li><li>è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘ç°ï¼Œæ”¯æŒå¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥</li><li>é«˜æ•ˆçš„å¼‚æ­¥é€šä¿¡ï¼š</li><li>å®‰å…¨æ€§ï¼šå†…ç½®å¯¹TLSçš„æ”¯æŒ<br><img src="/2024/06/07/17/grpc%E5%8E%9F%E7%90%86.png"></li></ol><h3 id="synchronizedä»‹ç»ä¸‹ï¼Ÿåº•å±‚åŸç†ï¼Ÿå’ŒLOCKçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå…·ä½“ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#synchronizedä»‹ç»ä¸‹ï¼Ÿåº•å±‚åŸç†ï¼Ÿå’ŒLOCKçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå…·ä½“ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="synchronizedä»‹ç»ä¸‹ï¼Ÿåº•å±‚åŸç†ï¼Ÿå’ŒLOCKçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå…·ä½“ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"></a>synchronizedä»‹ç»ä¸‹ï¼Ÿåº•å±‚åŸç†ï¼Ÿå’ŒLOCKçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå…·ä½“ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ç”¨æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„äº’æ–¥è®¿é—®ï¼Œç¡®ä¿åŒä¸€æ—¶åˆ»åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œè¢«ä¿®é¥°çš„ä»£ç ã€‚</p><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>é€šè¿‡å¯¹è±¡å¤´ä¸­çš„ç›‘è§†å™¨é”Monitorå®ç°ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥ä»£ç å—æˆ–è€…æ–¹æ³•æ—¶ï¼Œä¼šå°è¯•è·å–è¯¥å¯¹è±¡çš„ç›‘è§†å™¨é”ã€‚<br>ç›‘è§†å™¨é”çš„ç»„æˆ:</p><ol><li>å¯¹è±¡å¤´ï¼šæ¯ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­éƒ½ä¸€ä¸ªå¯¹è±¡å¤´ï¼ŒåŒ…å«å¯¹è±¡çš„å…ƒæ•°æ®å’Œé”ä¿¡æ¯</li><li>Mark Wordï¼šå¯¹è±¡å¤´ä¸­çš„Mark Wordå­˜å‚¨äº†é”è£…å¡«ã€å“ˆå¸Œç ã€GCä¿¡æ¯ç­‰</li><li>Monitorï¼šæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå…³è”çš„ç›‘è§†å™¨ï¼Œç”¨äºæ˜¯å®ç°åŒæ­¥ã€‚<br>å’ŒLockçš„åŒºåˆ«<br>synchroniedæ˜¯Javaè¯­è¨€çº§åˆ«çš„å…³é”®å­—ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œè€Œä¸”ç”±JVMç®¡ç†ï¼Œæ˜¯éšå¼é”ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹è·å–é”å¤±è´¥ä¼šè¢«é˜»å¡ï¼Œä¸å¯ä¸­æ–­ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…é”æ—¶æ— æ³•è¢«ä¸­æ–­ã€‚<br>Lockæ—¶æ˜¾ç¤ºé”ï¼Œéœ€è¦æ˜¾ç¤ºè·å–å’Œé‡Šæ”¾ï¼Œæ”¯æŒå¯é‡å…¥é”ï¼Œå…¬å¹³é”ç­‰ï¼Œéé˜»å¡ï¼Œå¯ä¸­æ–­</li></ol><h3 id="Kafkaæ˜¯å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§çš„ï¼Ÿä½ äº†è§£åº•å±‚çš„åŸç†å—ï¼Ÿ"><a href="#Kafkaæ˜¯å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§çš„ï¼Ÿä½ äº†è§£åº•å±‚çš„åŸç†å—ï¼Ÿ" class="headerlink" title="Kafkaæ˜¯å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§çš„ï¼Ÿä½ äº†è§£åº•å±‚çš„åŸç†å—ï¼Ÿ"></a>Kafkaæ˜¯å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§çš„ï¼Ÿä½ äº†è§£åº•å±‚çš„åŸç†å—ï¼Ÿ</h3><h3 id="ä¿éšœæœåŠ¡ç¨³å®šæ€§æœ€é‡è¦çš„ä¸€ä¸ªç¯èŠ‚æ˜¯"><a href="#ä¿éšœæœåŠ¡ç¨³å®šæ€§æœ€é‡è¦çš„ä¸€ä¸ªç¯èŠ‚æ˜¯" class="headerlink" title="ä¿éšœæœåŠ¡ç¨³å®šæ€§æœ€é‡è¦çš„ä¸€ä¸ªç¯èŠ‚æ˜¯"></a>ä¿éšœæœåŠ¡ç¨³å®šæ€§æœ€é‡è¦çš„ä¸€ä¸ªç¯èŠ‚æ˜¯</h3><p>ç›‘æ§å’Œé¢„è­¦</p><h4 id="å¦‚ä½•æå‰é¢„ä¼°æ¥å£çš„QPS"><a href="#å¦‚ä½•æå‰é¢„ä¼°æ¥å£çš„QPS" class="headerlink" title="å¦‚ä½•æå‰é¢„ä¼°æ¥å£çš„QPS"></a>å¦‚ä½•æå‰é¢„ä¼°æ¥å£çš„QPS</h4><ol><li>å†å²æ•°æ®åˆ†æï¼šåˆ†æå†å²æ—¥å¿—å’Œç›‘æ§æ•°æ®ï¼Œäº†è§£ä¸åŒæ—¶é—´æ®µçš„QPS</li><li>ä¸šåŠ¡éœ€æ±‚åˆ†æï¼š</li><li>æ¨¡æ‹Ÿæµ‹è¯•ï¼šå‹æµ‹æ¨¡æ‹Ÿ</li></ol><h3 id="HTTP1-0-x2F-1-1-x2F-2-0çš„åŒºåˆ«"><a href="#HTTP1-0-x2F-1-1-x2F-2-0çš„åŒºåˆ«" class="headerlink" title="HTTP1.0/1.1/2.0çš„åŒºåˆ«"></a>HTTP1.0/1.1/2.0çš„åŒºåˆ«</h3><p>HTTP1.0 é»˜è®¤çŸ­é“¾æ¥ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦å»ºç«‹ä¸€æ¬¡è¿æ¥<br>1.1 é»˜è®¤é•¿è¿æ¥ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªTCPè¿æ¥ä¸Šä¼ é€å¤šä¸ªHTTPè¯·æ±‚å’Œå“åº”<br>2.0 å¢åŠ å¤šè·¯å¤ç”¨ï¼ŒæŠ¥æ–‡å¤´å‹ç¼©ï¼Œå…è®¸æœåŠ¡ç«¯æ¨é€èµ„æºç»™å®¢æˆ·ç«¯ã€‚</p><h3 id="é˜Ÿå¤´é˜»å¡"><a href="#é˜Ÿå¤´é˜»å¡" class="headerlink" title="é˜Ÿå¤´é˜»å¡"></a>é˜Ÿå¤´é˜»å¡</h3><h3 id="Redisç›¸å…³"><a href="#Redisç›¸å…³" class="headerlink" title="Redisç›¸å…³"></a>Redisç›¸å…³</h3><h4 id="å¤§keyé—®é¢˜"><a href="#å¤§keyé—®é¢˜" class="headerlink" title="å¤§keyé—®é¢˜"></a>å¤§keyé—®é¢˜</h4><p>è§£å†³ï¼šä½¿ç”¨å‹ç¼©gzipç­‰ï¼Œå®šæ—¶æ¸…ç†</p><h4 id="çƒ­key"><a href="#çƒ­key" class="headerlink" title="çƒ­key"></a>çƒ­key</h4><p>Redisä¸­ï¼Œé¢‘ç¹è¢«è®¿é—®çš„é”®ï¼Œå¯èƒ½ä¼šå¯¼è‡´Redisæ€§èƒ½ç“¶é¢ˆã€‚<br>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>åœ¨Redisä¹‹å‰å¢åŠ ä¸€ä¸ªç¼“å­˜å±‚</li><li>æ•°æ®åˆ†ç‰‡ï¼Œå°†çƒ­keyçš„æ•°æ®åˆ†ç‰‡å­˜å‚¨åˆ°å¤šä¸ªRediså®ä¾‹ä¸­</li><li>è¯·æ±‚åˆ†æ‘Š</li></ol><h3 id="æ•°æ®åº“ç›¸å…³"><a href="#æ•°æ®åº“ç›¸å…³" class="headerlink" title="æ•°æ®åº“ç›¸å…³"></a>æ•°æ®åº“ç›¸å…³</h3><h4 id="åœ¨æœ‰å¤šä¸ªç´¢å¼•æ—¶ï¼Œæ•°æ®åº“ä¼šå¦‚ä½•é€‰æ‹©ä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼Ÿ"><a href="#åœ¨æœ‰å¤šä¸ªç´¢å¼•æ—¶ï¼Œæ•°æ®åº“ä¼šå¦‚ä½•é€‰æ‹©ä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼Ÿ" class="headerlink" title="åœ¨æœ‰å¤šä¸ªç´¢å¼•æ—¶ï¼Œæ•°æ®åº“ä¼šå¦‚ä½•é€‰æ‹©ä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼Ÿ"></a>åœ¨æœ‰å¤šä¸ªç´¢å¼•æ—¶ï¼Œæ•°æ®åº“ä¼šå¦‚ä½•é€‰æ‹©ä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼Ÿ</h4><p>ä¼šä½¿ç”¨é€‰æ‹©æ€§é«˜(ç´¢å¼•åˆ—ä¸­çš„ä¸é€šçŸ¥çš„æ•°é‡ä¸æ€»è¡Œæ•°çš„æ¯”ç‡)ã€ç´¢å¼•è¦†ç›–(å¯ä»¥é¿å…å›è¡¨æ“ä½œçš„)ã€ç´¢å¼•ç±»å‹()ã€æŸ¥è¯¢æ¡ä»¶(ä¾‹å¦‚æœ€å·¦åŒ¹é…ï¼Œå¤åˆç´¢å¼•(A,B)ä¸å¯å•ç‹¬ä½œç”¨äºB)</p><h3 id="åˆ†å¸ƒå¼ç›¸å…³"><a href="#åˆ†å¸ƒå¼ç›¸å…³" class="headerlink" title="åˆ†å¸ƒå¼ç›¸å…³"></a>åˆ†å¸ƒå¼ç›¸å…³</h3><h4 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h4><p><a href="https://xiaomi-info.github.io/2020/01/02/distributed-transaction/">https://xiaomi-info.github.io/2020/01/02/distributed-transaction/</a></p><h3 id="ä¸šåŠ¡ç›¸å…³"><a href="#ä¸šåŠ¡ç›¸å…³" class="headerlink" title="ä¸šåŠ¡ç›¸å…³"></a>ä¸šåŠ¡ç›¸å…³</h3><h4 id="å¦‚ä½•å®ç°å»¶è¿Ÿé˜Ÿåˆ—"><a href="#å¦‚ä½•å®ç°å»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="å¦‚ä½•å®ç°å»¶è¿Ÿé˜Ÿåˆ—"></a>å¦‚ä½•å®ç°å»¶è¿Ÿé˜Ÿåˆ—</h4><ol><li>ä½¿ç”¨DelayQueue,<code>DelayQueue</code>çš„<code>put</code>æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸º<code>put</code>æ–¹æ³•å†…éƒ¨ä½¿ç”¨äº†<code>ReentrantLock</code>é”è¿›è¡Œçº¿ç¨‹åŒæ­¥ã€‚<code>DelayQueue</code>è¿˜æä¾›äº†ä¸¤ç§å‡ºé˜Ÿçš„æ–¹æ³• <code>poll()</code> å’Œ <code>take()</code> ï¼Œ <code>poll()</code> ä¸ºéé˜»å¡è·å–ï¼Œæ²¡æœ‰åˆ°æœŸçš„å…ƒç´ ç›´æ¥è¿”å›nullï¼›<code>take()</code> é˜»å¡æ–¹å¼è·å–ï¼Œæ²¡æœ‰åˆ°æœŸçš„å…ƒç´ çº¿ç¨‹å°†ä¼šç­‰å¾…ã€‚</li><li>åŸºäºå®šæ—¶ä»»åŠ¡</li><li>åŸºäºRedisè¿‡æœŸé”®çš„å›è°ƒå‡½æ•°</li></ol><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><h4 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h4><p>åå°„çš„åŸç†åŸºäºJavaçš„å…ƒæ•°æ®ï¼ˆmetadataï¼‰ï¼Œè¿™äº›å…ƒæ•°æ®åœ¨ç¼–è¯‘æ—¶è¢«åµŒå…¥åˆ°ç±»æ–‡ä»¶ä¸­ï¼Œå¹¶åœ¨è¿è¡Œæ—¶é€šè¿‡Javaåå°„APIè¿›è¡Œè®¿é—®ã€‚</p><h3 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h3><h4 id="Spring-AOP"><a href="#Spring-AOP" class="headerlink" title="Spring AOP"></a>Spring AOP</h4><blockquote><p>AOPåŸºäºåŠ¨æ€ä»£ç†ï¼Œå¦‚æœè¦ä»£ç†çš„å¯¹è±¡å®ç°äº†æŸä¸ªæ¥å£ï¼Œé‚£é¢ä¼šä½¿ç”¨JDKProxyï¼Œå¦‚æœæ²¡å®ç°æ¥å£ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨åŸºäºasmæ¡†æ¶å­—èŠ‚æµçš„CglibåŠ¨æ€ä»£ç†æ¥ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡çš„å­ç±»æ¥ä½œä¸ºä»£ç†ã€‚</p></blockquote><h3 id="åˆ›å»ºå¯¹è±¡çš„å‡ ç§æ–¹å¼"><a href="#åˆ›å»ºå¯¹è±¡çš„å‡ ç§æ–¹å¼" class="headerlink" title="åˆ›å»ºå¯¹è±¡çš„å‡ ç§æ–¹å¼"></a>åˆ›å»ºå¯¹è±¡çš„å‡ ç§æ–¹å¼</h3><ol><li>new</li><li>Class.newInstanceï¼šéœ€è¦æœ‰publicæ— å‚æ„é€ å™¨</li><li>Contructor.newInstanceï¼šè°ƒç”¨æœ‰å‚æ•°å’Œç§æœ‰çš„æ„é€ å‡½æ•°</li><li>ä½¿ç”¨Clone</li><li>ååºåˆ—åŒ–</li><li></li></ol><h4 id="Bean"><a href="#Bean" class="headerlink" title="Bean"></a>Bean</h4><h5 id="åˆ›å»ºæµç¨‹"><a href="#åˆ›å»ºæµç¨‹" class="headerlink" title="åˆ›å»ºæµç¨‹"></a>åˆ›å»ºæµç¨‹</h5><ol><li>å®ä¾‹åŒ–ï¼šä¹Ÿå°±æ˜¯new</li><li>IOCæ³¨å…¥</li></ol><h4 id="å¾ªç¯ä¾èµ–"><a href="#å¾ªç¯ä¾èµ–" class="headerlink" title="å¾ªç¯ä¾èµ–"></a>å¾ªç¯ä¾èµ–</h4><blockquote><p>ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„Beanäº’ç›¸æŒæœ‰å¯¹æ–¹ï¼Œå½¢æˆç›¸äº’æŒæœ‰å¯¹æ–¹ï¼Œæœ€ç»ˆå½¢æˆé—­ç¯ã€‚</p></blockquote><h5 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h5><p>ä¸‰çº§ç¼“å­˜</p><ol><li>Springå®¹å™¨é€šè¿‡æ„é€ å™¨åˆå§‹åŒ–å¯¹è±¡ä¹‹åæå‰æš´æ¼åˆ°Springå®¹å™¨çš„singletonFactorys(ä¸‰çº§ç¼“å­˜)</li><li>è°ƒç”¨å¦ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå°è¯•ä»å®¹å™¨ä¸­è·å–ï¼Œå¦‚æœä¸å­˜åœ¨å°±åˆå§‹åŒ–ï¼Œç°å°†è‡ªå·±æ”¾åœ¨ä¸‰çº§ç¼“å­˜ä¸­ï¼Œä¹‹åä»ä¸€çº§ã€äºŒçº§ã€ä¸‰çº§ç¼“å­˜ä¸­ä¸€æ¬¡è·å–ç¬¬ä¸€ä¸ªå¯¹è±¡</li><li>è·å–ä¹‹åå°†è‡ªå·±æ”¾åœ¨å•ä¾‹æ± ä¸­ï¼Œä¾›ç¬¬ä¸€ä¸ªå®ä¾‹å®Œæˆåˆå§‹åŒ–ã€‚</li></ol><h2 id="åŒå­¦çš„æ»´æ»´ç ”å‘ä¸€é¢é¢ç»"><a href="#åŒå­¦çš„æ»´æ»´ç ”å‘ä¸€é¢é¢ç»" class="headerlink" title="åŒå­¦çš„æ»´æ»´ç ”å‘ä¸€é¢é¢ç»"></a>åŒå­¦çš„æ»´æ»´ç ”å‘ä¸€é¢é¢ç»</h2><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é¡¹ç›®ä»‹ç»ï¼šé¡¹ç›®æ˜¯å¦ä¸ºç½‘ç»œä¸Šæ‰¾çš„demo</li><li>ä¸ªäººèŒè´£</li><li>ä¸€äº›å…·ä½“çš„åŠŸèƒ½å®ç°é€»è¾‘</li><li>ä½¿ç”¨Redisè¿›è¡Œä¼˜åŒ–çš„æ€è·¯</li><li>HashMapçš„å¸¸è§å…«è‚¡ï¼Œå¦‚ä½•è¿›è¡Œæ‰©å®¹çš„(*)</li></ol><h3 id="å¦‚ä½•ä¿è¯å¤šæ¬¡è¯·æ±‚-x2F-åˆ·æ–°çš„å¹‚ç­‰æ€§"><a href="#å¦‚ä½•ä¿è¯å¤šæ¬¡è¯·æ±‚-x2F-åˆ·æ–°çš„å¹‚ç­‰æ€§" class="headerlink" title="å¦‚ä½•ä¿è¯å¤šæ¬¡è¯·æ±‚/åˆ·æ–°çš„å¹‚ç­‰æ€§"></a>å¦‚ä½•ä¿è¯å¤šæ¬¡è¯·æ±‚/åˆ·æ–°çš„å¹‚ç­‰æ€§</h3><ol><li>ä½¿ç”¨PRG(POST/Redirect/GET)ï¼šç”¨æˆ·å¡«å†™è¡¨å•ï¼Œä¹‹åæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ä¹‹åè¿›è¡Œå¤„ç†ï¼Œç„¶åé€šè¿‡è¿”å›é‡å®šå‘ï¼Œåç»­ç”¨æˆ·é€šè¿‡GETè¿›è¡Œè¯·æ±‚</li><li>Tokenæœºåˆ¶ï¼šæœåŠ¡ç«¯é€šè¿‡ç”Ÿæˆå”¯ä¸€æœ‰æ—¶æ•ˆæ€§çš„Tokenï¼Œä¹‹åå®¢æˆ·ç«¯æºå¸¦è¿™ä¸ªTokenå‘é€è¯·æ±‚ï¼Œå¦‚æœTokenå¤±æ•ˆåˆ™æ‹’ç»æ‰§è¡Œã€‚å¹¶å‘åœºæ™¯ä¸‹å¯ä»¥ä½¿ç”¨SETNXæ¥ä¿è¯æœ‰æ•ˆï¼ŒåŒæ—¶é¿å…å¤šä¸ªè¯·æ±‚åŒæ—¶é€šè¿‡éªŒè¯</li></ol><p>#todo </p><ul><li><input disabled="" type="checkbox"> leetcodeæ‰‹å†™LRU</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥æµ…å‡ºSpring</title>
      <link href="/2024/06/07/04/"/>
      <url>/2024/06/07/04/</url>
      
        <content type="html"><![CDATA[<h1 id="é¢è¯•å¸¸é—®"><a href="#é¢è¯•å¸¸é—®" class="headerlink" title="é¢è¯•å¸¸é—®"></a>é¢è¯•å¸¸é—®</h1><h3 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h3><ul><li>@Nullable æ³¨è§£çš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºå¼€å‘è€…å’Œé™æ€åˆ†æå·¥å…·æä¾›ä¿¡æ¯ï¼ŒæŒ‡ç¤ºæŸä¸ªå­—æ®µã€æ–¹æ³•è¿”å›å€¼æˆ–å‚æ•°å¯ä»¥ä¸º nullã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒä¼šï¼š  å¸®åŠ©é™æ€åˆ†æå·¥å…·ï¼šé™æ€åˆ†æå·¥å…·å¯ä»¥åˆ©ç”¨ @Nullable æ³¨è§£æ¥æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦æ­£ç¡®å¤„ç†äº†å¯èƒ½ä¸º null çš„æƒ…å†µï¼Œå¹¶åœ¨å‘ç°æ½œåœ¨é—®é¢˜æ—¶å‘å‡ºè­¦å‘Šã€‚å¢å¼ºä»£ç å¯è¯»æ€§ï¼šå¼€å‘è€…å¯ä»¥é€šè¿‡æŸ¥çœ‹æ³¨è§£æ¥äº†è§£å“ªäº›å˜é‡æˆ–è¿”å›å€¼å¯èƒ½ä¸º nullï¼Œä»è€Œåœ¨ä½¿ç”¨è¿™äº›å˜é‡æ—¶è¿›è¡Œé€‚å½“çš„ç©ºå€¼æ£€æŸ¥ã€‚æ–‡æ¡£ç”Ÿæˆï¼šåœ¨ç”Ÿæˆæ–‡æ¡£æ—¶ï¼Œ@Nullable æ³¨è§£å¯ä»¥å¸®åŠ©å…¶ä»–å¼€å‘è€…ç†è§£å“ªäº›å­—æ®µã€æ–¹æ³•è¿”å›å€¼æˆ–å‚æ•°å¯ä»¥ä¸º nullã€‚å®ƒä¸ä¼šç›´æ¥é˜»æ­¢ NullPointerException çš„å‘ç”Ÿï¼Œä½†èƒ½å¸®åŠ©å¼€å‘è€…åœ¨ç¼–å†™å’Œç»´æŠ¤ä»£ç æ—¶è¿›è¡Œé€‚å½“çš„ç©ºå€¼æ£€æŸ¥ï¼Œä»è€Œå‡å°‘ç©ºæŒ‡é’ˆå¼‚å¸¸çš„å‘ç”Ÿ</li><li>Beanç›¸å…³<ul><li>@Autowiredå’Œ@Resource<br>  @Autowiredé»˜è®¤æ³¨å…¥æ–¹å¼æ˜¯byTypeï¼Œä¹Ÿå°±æ˜¯ä¼˜å…ˆæ ¹æ®æ¥å£ç±»å‹å»åŒ¹é…å¹¶æ³¨å…¥Bean<br>  @Resourceé»˜è®¤æ˜¯byNameæ³¨å…¥çš„ï¼Œå¦‚æœä¸èƒ½é€šè¿‡nameåŒ¹é…ä¼šå˜ä¸ºbyTypeï¼Œå¯ä»¥ä½¿ç”¨åªå½“ä»¥ä¸‹ä¸¤ä¸ªå±æ€§å…¶ä¸­ä¹‹ä¸€æ¥ç¡®å®šï¼Œä¸å»ºè®®åŒæ—¶æŒ‡å®šä¸¤ä¸ªå±æ€§</li></ul></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Resource</span> <span class="token punctuation">{</span>    <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>@RestController</code>æ³¨è§£æ˜¯<code>@Controller</code>å’Œ<code>@ResponseBody</code>,ä¼šå°†å‡½æ•°çš„è¿”å›å€¼ç›´æ¥å¡«å…¥HTTPå“åº”ä½“ä¸­ï¼Œæ˜¯RESTé£æ ¼çš„æ§åˆ¶å™¨</li><li>@Scope(â€œâ€œ)ç”Ÿå‘½ä½œç”¨åŸŸï¼š<ul><li>singletonå•ä¾‹ä½œç”¨åŸŸï¼Œé»˜è®¤å…¨æ˜¯å•ä¾‹</li><li>prototype æ¯æ¬¡è¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹</li><li>request æ¯æ¬¡HTTPè¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªbeanï¼Œåœ¨å½“å‰HTTP requestæœ‰æ•ˆ</li><li>session åœ¨å½“å‰çš„HTTP sessionä¸­æœ‰æ•ˆ</li></ul></li><li><code>@SpringBootApplication</code> æ˜¯<code>@Configuration</code>ã€<code>@EnableAutoConfiguration</code>ã€<code>@ComponentScan</code>&nbsp;æ³¨è§£çš„é›†åˆã€‚<ul><li><code>@EnableAutoConfiguration</code> å¯åŠ¨è‡ªåŠ¨è£…é…</li><li><code>@ComponentScan</code>ï¼šæ‰«ææ³¨è§£æ ‡è®°çš„ç»„ä»¶ï¼Œé»˜è®¤é€å¥¥å¦™è¯¥ç±»æ‰€åœ¨çš„åŒ…ä¸‹çš„æ‰€æœ‰çš„ç±»</li><li><code>@Configuration</code> å…è®¸åœ¨ Spring ä¸Šä¸‹æ–‡ä¸­æ³¨å†Œé¢å¤–çš„ bean æˆ–å¯¼å…¥å…¶ä»–é…ç½®ç±»</li></ul></li><li>è¯»å–é…ç½®ä¿¡æ¯å¹¶ä¸”ä¸beanç»‘å®š<ul><li><code>@Value("${property}")</code>&nbsp;è¯»å–æ¯”è¾ƒç®€å•çš„é…ç½®ä¿¡æ¯</li><li><code>@ConfigurationProperties</code>è¯»å–é…ç½®ä¿¡æ¯å¹¶ä¸ bean ç»‘å®šã€‚<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"library"</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">LibraryProperties</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@NotEmpty</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> location<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> books<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Setter</span>    <span class="token annotation punctuation">@Getter</span>    <span class="token annotation punctuation">@ToString</span>    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token punctuation">{</span>        <span class="token class-name">String</span> name<span class="token punctuation">;</span>        <span class="token class-name">String</span> description<span class="token punctuation">;</span>    <span class="token punctuation">}</span>  çœç•¥getter<span class="token operator">/</span>setter  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><h3 id="Bean"><a href="#Bean" class="headerlink" title="Bean"></a>Bean</h3><ul><li>Beançš„ä½œç”¨åŸŸ<ol><li>singletonå•ä¾‹ï¼šSpringä¸­çš„beané»˜è®¤éƒ½æ˜¯å•ä¾‹çš„</li><li>prototypeï¼šæ¯æ¬¡è·å–éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Beanï¼Œä¹Ÿå°±æ˜¯è¿ç»­ä¸¤æ¬¡è·å–Beanéƒ½ä¼šæ˜¯ä¸åŒçš„Beanå®ä¾‹</li><li>requestï¼šæ¯ä¸€æ¬¡HTTPè¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„beanï¼Œbeanåœ¨å½“å‰HTTP requestå†…ç”Ÿæ•ˆ</li><li>sessonï¼šåœ¨HTTPçš„sessionä¸­æœ‰æ•ˆï¼Œsessionæ˜¯å¤šä¸ªHTTPä¹‹é—´ä½¿ç”¨çš„è¿ç»­ä¼šè¯</li><li><strong>application/global-session</strong>&nbsp;ï¼ˆä»… Web åº”ç”¨å¯ç”¨ï¼‰ï¼šæ¯ä¸ª Web åº”ç”¨åœ¨å¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ª Beanï¼ˆåº”ç”¨ Beanï¼‰ï¼Œè¯¥ bean ä»…åœ¨å½“å‰åº”ç”¨å¯åŠ¨æ—¶é—´å†…æœ‰æ•ˆã€‚</li><li>websocketï¼šæ¯ä¸€æ¬¡WebSocketéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„bean<br>é…ç½®æ–¹å¼ï¼š<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Bean</span><span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">ConfigurableBeanFactory</span><span class="token punctuation">.</span><span class="token constant">SCOPE_PROTOTYPE</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">personPrototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol></li><li>Beançš„ç”Ÿå‘½å‘¨æœŸ<ol><li>åˆ›å»ºBeançš„å®ä¾‹ï¼šBeanå®¹å™¨ä¼šå…ˆæ‰¾åˆ°Beançš„å®šä¹‰ï¼Œç„¶åé€šè¿‡Javaåå°„APIæ¥åˆ›å»ºBeançš„å®ä¾‹</li><li>Beanå±æ€§èµ‹å€¼/å¡«å……ï¼šä¸ºBeanè®¾ç½®ç›¸å…³å±æ€§å’Œä¾èµ–ï¼Œä¾‹å¦‚å¡«å…¥@Autowiredç­‰æ³¨è§£æ³¨å…¥çš„å¯¹è±¡ï¼Œsetteræ–¹æ³•å’Œæ„é€ å‡½æ•°</li><li>Beanåˆå§‹åŒ–:ï¼š<img src="/2024/06/07/04/Bean%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96.png" alt="Beançš„åˆå§‹åŒ–"></li><li>é”€æ¯Beanï¼šæŠŠBeançš„é”€æ¯æ–¹æ³•è®°å½•ä¸‹æ¥ï¼Œå°†çˆ±éœ€è¦é”€æ¯Beanæˆ–è€…é”€æ¯å®¹å™¨æ—¶ï¼Œè°ƒç”¨è¿™äº›æ–¹æ³•å»é‡Šæ”¾Beanæ‰€æŒæœ‰çš„èµ„æº<ul><li>å¦‚æœ Bean å®ç°äº† <code>DisposableBean</code> æ¥å£ï¼Œæ‰§è¡Œ <code>destroy()</code> æ–¹æ³•ã€‚</li><li>å¦‚æœ Bean åœ¨é…ç½®æ–‡ä»¶ä¸­çš„å®šä¹‰åŒ…å« <code>destroy-method</code> å±æ€§ï¼Œæ‰§è¡ŒæŒ‡å®šçš„ Bean é”€æ¯æ–¹æ³•ã€‚æˆ–è€…ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡<code>@PreDestroy</code> æ³¨è§£æ ‡è®° Bean é”€æ¯ä¹‹å‰æ‰§è¡Œçš„æ–¹æ³•ã€‚</li></ul></li></ol></li></ul><p><img src="/2024/06/07/04/Bean%E7%9A%84%E5%91%A8%E6%9C%9F.png" alt="|475"></p><hr><h3 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h3><h4 id="å¸¸è§å®ç°"><a href="#å¸¸è§å®ç°" class="headerlink" title="å¸¸è§å®ç°"></a>å¸¸è§å®ç°</h4><p>Spring AOPå®ç°æ–¹å¼æœ‰åŠ¨æ€ä»£ç†ã€å­—èŠ‚ç ç­‰æ“ä½œæ–¹å¼</p><h4 id="å¸¸è§æœ¯è¯­ï¼š"><a href="#å¸¸è§æœ¯è¯­ï¼š" class="headerlink" title="å¸¸è§æœ¯è¯­ï¼š"></a>å¸¸è§æœ¯è¯­ï¼š<img src="/2024/06/07/04/AOP%E5%B8%B8%E8%A7%81%E6%9C%AF%E8%AF%AD.png"></h4><h4 id="AspectJå®šä¹‰çš„é€šçŸ¥ç±»å‹"><a href="#AspectJå®šä¹‰çš„é€šçŸ¥ç±»å‹" class="headerlink" title="AspectJå®šä¹‰çš„é€šçŸ¥ç±»å‹"></a>AspectJå®šä¹‰çš„é€šçŸ¥ç±»å‹</h4><ul><li>Before å‰ç½®é€šçŸ¥ï¼šåœ¨ç›®æ ‡æ–¹æ³•è°ƒç”¨ä¹‹å‰ï¼Œæ‰€ä»¥è·å¾—ä¸åˆ°ç›®æ ‡æ–¹æ³•çš„å…·ä½“ä¸œè¥¿</li><li>After åç½®é€šçŸ¥ï¼šç›®æ ‡æ–¹æ³•è°ƒç”¨ä¹‹åï¼Œç±»ä¼¼äºfinallyï¼Œæ— è®ºæ–¹æ³•æ˜¯å¦æˆåŠŸéƒ½ä¼šè°ƒç”¨</li><li>AfterReturingï¼šç›®æ ‡æ–¹æ³•è°ƒç”¨ä¹‹åï¼Œè¿”å›ç»“æœä¹‹åè§¦å‘ï¼Œåªæœ‰æ–¹æ³•å®ŒæˆæˆåŠŸä¼šè°ƒç”¨</li><li>AfterThrowingï¼šå¼‚å¸¸é€šçŸ¥ï¼Œå‡ºç°å¼‚å¸¸æ—¶è§¦å‘ï¼Œç±»ä¼¼catch</li><li>Aroundç¯ç»•é€šçŸ¥ï¼šå¯ä»¥æ‹¿åˆ°ç›®æ ‡å¯¹è±¡<br>å¯¹äºå¤šä¸ªåˆ‡é¢çš„æ‰§è¡Œé¡ºåºå¯ä»¥é€šè¿‡@Order(æ•°å­—) æ¥æŒ‡å®š</li></ul><h3 id="Spring-MVC"><a href="#Spring-MVC" class="headerlink" title="Spring MVC"></a>Spring MVC</h3><p>MVC æ˜¯æ¨¡å‹(Model)ã€è§†å›¾(View)ã€æ§åˆ¶å™¨(Controller)çš„ç®€å†™ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å°†ä¸šåŠ¡é€»è¾‘ã€æ•°æ®ã€æ˜¾ç¤ºåˆ†ç¦»æ¥ç»„ç»‡ä»£ç ã€‚<img src="/2024/06/07/04/MVC.png"><br>æ ¸å¿ƒç»„ä»¶ï¼š</p><ul><li>**<code>DispatcherServlet</code>**â€œï¼šæ ¸å¿ƒä¸­å¤®å¤„ç†å™¨ï¼Œç”¨æ±‰è¯­æ¥å—è¯·æ±‚ã€åˆ†å‘è¯·æ±‚ï¼Œç»™äºˆå®¢æˆ·ç«¯å“åº”</li><li>HandlerMappingï¼šå¤„ç†å™¨æ˜ å°„å™¨ï¼Œæ ¹æ®URLå»åŒ¹é…æŸ¥æ‰¾èƒ½å¤„ç†çš„Handlerï¼Œå¹¶å°†æ¶‰åŠçš„æ‹¦æˆªå™¨å’ŒHandlerä¸€èµ·å°è£…</li><li>HandlerAdapterï¼šå¤„ç†å™¨é€‚é…å™¨ï¼Œæ ¹æ®HandlerMappingæ‰¾åˆ°çš„Handlerï¼Œè®¾é…ç½®å‹å¯¹åº”çš„Handler</li><li>Handlerï¼šè¯·æ±‚å¤„ç†å™¨</li><li>ViewResolverï¼šè§†å›¾è§£æå™¨ï¼Œæ ¹æ®Handlerè¿”å›çš„é€»è¾‘è§†å›¾/è¯•å›¾ï¼Œè§£æå¹¶æ¸²æŸ“çœŸæ­£çš„è¯•å›¾ï¼Œä¼ é€’ç»™DispatcherServletå“åº”å®¢æˆ·ç«¯ã€‚<br><img src="/2024/06/07/04/MVC%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B.png"><br><strong>æµç¨‹è¯´æ˜ï¼ˆé‡è¦ï¼‰ï¼š</strong></li></ul><ol><li>å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚ï¼Œ <code>DispatcherServlet</code>æ‹¦æˆªè¯·æ±‚ã€‚</li><li><code>DispatcherServlet</code> æ ¹æ®è¯·æ±‚ä¿¡æ¯è°ƒç”¨ <code>HandlerMapping</code> ã€‚<code>HandlerMapping</code> æ ¹æ® URL å»åŒ¹é…æŸ¥æ‰¾èƒ½å¤„ç†çš„ <code>Handler</code>ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³å¸¸è¯´çš„ <code>Controller</code> æ§åˆ¶å™¨ï¼‰ ï¼Œå¹¶ä¼šå°†è¯·æ±‚æ¶‰åŠåˆ°çš„æ‹¦æˆªå™¨å’Œ <code>Handler</code> ä¸€èµ·å°è£…ã€‚</li><li><code>DispatcherServlet</code> è°ƒç”¨ <code>HandlerAdapter</code>é€‚é…å™¨æ‰§è¡Œ <code>Handler</code> ã€‚</li><li><code>Handler</code> å®Œæˆå¯¹ç”¨æˆ·è¯·æ±‚çš„å¤„ç†åï¼Œä¼šè¿”å›ä¸€ä¸ª <code>ModelAndView</code> å¯¹è±¡ç»™<code>DispatcherServlet</code>ï¼Œ<code>ModelAndView</code> é¡¾åæ€ä¹‰ï¼ŒåŒ…å«äº†æ•°æ®æ¨¡å‹ä»¥åŠç›¸åº”çš„è§†å›¾çš„ä¿¡æ¯ã€‚<code>Model</code> æ˜¯è¿”å›çš„æ•°æ®å¯¹è±¡ï¼Œ<code>View</code> æ˜¯ä¸ªé€»è¾‘ä¸Šçš„ <code>View</code>ã€‚</li><li><code>ViewResolver</code> ä¼šæ ¹æ®é€»è¾‘ <code>View</code> æŸ¥æ‰¾å®é™…çš„ <code>View</code>ã€‚</li><li><code>DispaterServlet</code> æŠŠè¿”å›çš„ <code>Model</code> ä¼ ç»™ <code>View</code>ï¼ˆè§†å›¾æ¸²æŸ“ï¼‰ã€‚</li><li>æŠŠ <code>View</code> è¿”å›ç»™è¯·æ±‚è€…ï¼ˆæµè§ˆå™¨ï¼‰</li></ol><hr><p><a href="https://javaguide.cn/system-design/framework/spring/spring-design-patterns-summary.html">Springä½¿ç”¨çš„è®¾è®¡æ¨¡å¼ï¼š</a><br><img src="/2024/06/07/04/Spring%E4%BD%BF%E7%94%A8%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.png"></p><h3 id="Springäº‹åŠ¡"><a href="#Springäº‹åŠ¡" class="headerlink" title="Springäº‹åŠ¡"></a>Springäº‹åŠ¡</h3><p>ACID AIDæ˜¯æ‰‹æ®µï¼Œæœ€ç»ˆç›®çš„æ˜¯ä¿è¯C</p><h5 id="ç›¸å…³æ¥å£"><a href="#ç›¸å…³æ¥å£" class="headerlink" title="ç›¸å…³æ¥å£"></a>ç›¸å…³æ¥å£</h5><ul><li><p>**<code>PlatformTransactionManager</code>**ï¼šï¼ˆå¹³å°ï¼‰äº‹åŠ¡ç®¡ç†å™¨ï¼ŒSpring äº‹åŠ¡ç­–ç•¥çš„æ ¸å¿ƒã€‚</p></li><li><p>**<code>TransactionDefinition</code>**ï¼šäº‹åŠ¡å®šä¹‰ä¿¡æ¯(äº‹åŠ¡éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºã€è¶…æ—¶ã€åªè¯»ã€å›æ»šè§„åˆ™)ã€‚</p></li><li><p>**<code>TransactionStatus</code>**ï¼šäº‹åŠ¡è¿è¡ŒçŠ¶æ€ã€‚</p><ul><li>ç¼–ç¨‹å¼äº‹åŠ¡ (æ¨èåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä½¿ç”¨)é€šè¿‡æ‰‹åŠ¨ä½¿ç”¨TransactionTemplateæˆ–è€…TranctionManageræ‰‹åŠ¨ç®¡ç†äº‹åŠ¡ï¼Œäº‹åŠ¡èŒƒå›´è¿‡å¤§ä¼šå‡ºç°äº‹åŠ¡æœªæäº¤å¯¼è‡´è¶…æ—¶ï¼Œå› æ­¤äº‹åŠ¡è¦æ¯”é”çš„é¢—ç²’åº¦æ›´å°</li></ul></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token class-name">TransactionTemplate</span> transactionTemplate<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">UserService</span><span class="token punctuation">(</span><span class="token class-name">TransactionTemplate</span> transactionTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>transactionTemplate <span class="token operator">=</span> transactionTemplate<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> transactionTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TransactionCallback</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">doInTransaction</span><span class="token punctuation">(</span><span class="token class-name">TransactionStatus</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    <span class="token comment">// è¿™é‡Œæ˜¯ä½ çš„ä¸šåŠ¡ä»£ç </span>                    <span class="token comment">// å¦‚æœåœ¨è¿™é‡ŒæŠ›å‡ºäº†å¼‚å¸¸ï¼ŒTransactionTemplateä¼šæ•è·è¿™ä¸ªå¼‚å¸¸å¹¶å›æ»šäº‹åŠ¡</span>                    <span class="token comment">// å¦‚æœè¿™é‡Œæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼ŒTransactionTemplateä¼šæäº¤äº‹åŠ¡</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    status<span class="token punctuation">.</span><span class="token function">setRollbackOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">throw</span> e<span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å£°æ˜å¼äº‹åŠ¡ï¼šé€šè¿‡ä½¿ç”¨@Tranctionalå…¨æ³¨è§£<br>äº‹åŠ¡<br>Springäº‹åŠ¡ä¸­æœ‰å“ªå‡ ç§ä¼ æ’­è¡Œä¸º</li></ul><ol><li>**<code>TransactionDefinition.PROPAGATION_REQUIRED</code>**ï¼Œé»˜è®¤ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ äº‹åŠ¡</li><li><strong><code>TransactionDefinition.PROPAGATION_REQUIRES_NEW</code></strong> åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå½“å‰å­˜åœ¨äº‹åŠ¡å°±æŠŠ</li><li><strong><code>TransactionDefinition.PROPAGATION_NESTED</code></strong> æ²¡æœ‰äº‹åŠ¡å°±åˆ›å»ºä¸€ä¸ªäº‹åŠ¡å·¦ä¼Ÿå½“å‰äº‹åŠ¡çš„åµŒå¥—äº‹åŠ¡ï¼Œå­˜åœ¨äº‹åŠ¡å°±å’Œ 1 ç›¸åŒ</li><li><strong><code>TransactionDefinition.PROPAGATION_MANDATORY</code></strong> å¦‚æœå­˜åœ¨äº‹åŠ¡å°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œä¸å­˜åœ¨äº‹åŠ¡å°±æŠ¥é”™</li></ol><ul><li><strong><code>TransactionDefinition.PROPAGATION_SUPPORTS</code></strong>: å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚</li><li><strong><code>TransactionDefinition.PROPAGATION_NOT_SUPPORTED</code></strong>: ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</li><li><strong><code>TransactionDefinition.PROPAGATION_NEVER</code></strong>: ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><hr><p>Springäº‹åŠ¡éš”ç¦»çº§åˆ«</p><ol><li>**<code>TransactionDefinition.ISOLATION_DEFAULT</code>**ï¼šä½¿ç”¨åç«¯æ•°æ®åº“çš„é»˜è®¤éš”ç¦»ç­‰çº§ï¼ŒMySQLé‡‡ç”¨å¯é‡å¤è¯»ï¼ŒOracleé»˜è®¤é‡‡ç”¨è¯»å·²æäº¤</li><li>**<code>TransactionDefinition.ISOLATION_READ_UNCOMMITTED</code>**ï¼šæœ€ä½çš„éš”ç¦»ç­‰çº§ï¼Œå…è®¸è¯»å·²æäº¤ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ï¼Œå¹»è¯»å’Œä¸å¯é‡å¤è¯»</li><li>**<code>TransactionDefinition.ISOLATION_READ_COMMITTED</code>**ï¼šå…è®¸è¯»å¹¶å‘äº‹åŠ¡å·²æäº¤çš„äº‹åŠ¡ï¼Œå¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»å’Œä¸å¯é‡å¤ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚</li><li>**<code>TransactionDefinition.ISOLATION_REPEATABLE_READ</code>**ï¼šå¯¹åŒæ„å­—æ®µå¤šæ¬¡è¯»éƒ½æ˜¯ç›¸åŒçš„ï¼Œå¯ä»¥ç»„ç»‡è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†æ˜¯å¹»è¯»ä»ç„¶ä¼šå‘ç”Ÿ</li><li>**<code>TransactionDefinition.ISOLATION_SERIALIZABLE</code>**ï¼š åºåˆ—åŒ–ï¼Œæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå½±å“ç¨‹åºæ€§èƒ½</li></ol><hr><h2 id="Transactional-rollbackFor-x3D-Exception-class-é»˜è®¤å›æ»šæ˜¯åªæœ‰é‡åˆ°RuntimeExceptionè¿è¡Œæ—¶å¼‚å¸¸æˆ–è€…Erroræ‰è¿›è¡Œå›æ»šï¼Œè€Œä¸ä¼šå›æ»šï¼ŒChecked-Exception-Checked-Exceptionæ˜¯é‚£äº›åœ¨ç¼–è¯‘æ—¶æœŸå°±éœ€è¦è¢«å¤„ç†çš„å¼‚å¸¸-ï¼Œ"><a href="#Transactional-rollbackFor-x3D-Exception-class-é»˜è®¤å›æ»šæ˜¯åªæœ‰é‡åˆ°RuntimeExceptionè¿è¡Œæ—¶å¼‚å¸¸æˆ–è€…Erroræ‰è¿›è¡Œå›æ»šï¼Œè€Œä¸ä¼šå›æ»šï¼ŒChecked-Exception-Checked-Exceptionæ˜¯é‚£äº›åœ¨ç¼–è¯‘æ—¶æœŸå°±éœ€è¦è¢«å¤„ç†çš„å¼‚å¸¸-ï¼Œ" class="headerlink" title="Transactional(rollbackFor = Exception.class)    é»˜è®¤å›æ»šæ˜¯åªæœ‰é‡åˆ°RuntimeExceptionè¿è¡Œæ—¶å¼‚å¸¸æˆ–è€…Erroræ‰è¿›è¡Œå›æ»šï¼Œè€Œä¸ä¼šå›æ»šï¼ŒChecked Exception(Checked Exceptionæ˜¯é‚£äº›åœ¨ç¼–è¯‘æ—¶æœŸå°±éœ€è¦è¢«å¤„ç†çš„å¼‚å¸¸)ï¼Œ"></a>Transactional(rollbackFor = Exception.class)<br>    é»˜è®¤å›æ»šæ˜¯åªæœ‰é‡åˆ°RuntimeExceptionè¿è¡Œæ—¶å¼‚å¸¸æˆ–è€…Erroræ‰è¿›è¡Œå›æ»šï¼Œè€Œä¸ä¼šå›æ»šï¼ŒChecked Exception(Checked Exceptionæ˜¯é‚£äº›åœ¨ç¼–è¯‘æ—¶æœŸå°±éœ€è¦è¢«å¤„ç†çš„å¼‚å¸¸)ï¼Œ<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// some business logic</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></h2><h3 id="Spirng-Data-JPA-Java-Persistence-API"><a href="#Spirng-Data-JPA-Java-Persistence-API" class="headerlink" title="Spirng Data JPA (Java Persistence API)"></a>Spirng Data JPA (Java Persistence API)</h3><p>æ˜¯Javaå¹³å°ä¸Šçš„ä¸€ä¸ªè§„èŒƒï¼Œç”¨äºå°†å¯¹è±¡æ˜ å°„åˆ°å…³ç³»æ•°æ®åº“</p><h4 id="å¦‚ä½•ä½¿ç”¨JPAåœ¨æ•°æ®åº“ä¸­éæŒä¹…åŒ–ä¸€ä¸ªå­—æ®µ"><a href="#å¦‚ä½•ä½¿ç”¨JPAåœ¨æ•°æ®åº“ä¸­éæŒä¹…åŒ–ä¸€ä¸ªå­—æ®µ" class="headerlink" title="å¦‚ä½•ä½¿ç”¨JPAåœ¨æ•°æ®åº“ä¸­éæŒä¹…åŒ–ä¸€ä¸ªå­—æ®µ"></a>å¦‚ä½•ä½¿ç”¨JPAåœ¨æ•°æ®åº“ä¸­éæŒä¹…åŒ–ä¸€ä¸ªå­—æ®µ</h4><p>éæŒä¹…åŒ–ï¼šä¹Ÿå°±æ˜¯ä¸è¢«æ•°æ®åº“å­˜å‚¨<br>å¯ä»¥ä½¿ç”¨æ³¨è§£çš„æ–¹å¼ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"student"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Id</span>    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy<span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">AUTO</span><span class="token punctuation">)</span> <span class="token comment">// è‡ªå¢</span>    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"name"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"age"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>        <span class="token annotation punctuation">@Transient</span> <span class="token comment">// ä¸æ˜ å°„åˆ°æ•°æ®åº“</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> secrect<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="JPAå®¡è®¡åŠŸèƒ½"><a href="#JPAå®¡è®¡åŠŸèƒ½" class="headerlink" title="JPAå®¡è®¡åŠŸèƒ½"></a>JPAå®¡è®¡åŠŸèƒ½</h4><p>  å®¡è®¡åŠŸèƒ½ä¸»è¦æ˜¯å¸®åŠ©æˆ‘ä»¬è®°å½•æ•°æ®åº“æ“ä½œçš„å…·ä½“è¡Œä¸ºæ¯”å¦‚æŸæ¡è®°å½•æ˜¯è°åˆ›å»ºçš„ã€ä»€ä¹ˆæ—¶é—´åˆ›å»ºçš„ã€æœ€åä¿®æ”¹äººæ˜¯è°ã€æœ€åä¿®æ”¹æ—¶é—´æ˜¯ä»€ä¹ˆæ—¶å€™ã€‚<br>  ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@MappedSuperclass</span><span class="token annotation punctuation">@EntityListeners</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">AuditingEntityListener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractAuditBase</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@CreatedDate</span> <span class="token comment">//è¯¥å­—æ®µä¸ºåˆ›å»ºæ—¶é—´å­—æ®µï¼Œåœ¨insertæ—¶ä¼šæ’å…¥</span>    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>updatable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@JsonIgnore</span> <span class="token comment">//ä¸è¿›è¡Œåºåˆ—åŒ–</span>    <span class="token keyword">private</span> <span class="token class-name">Instant</span> createdAt<span class="token punctuation">;</span>    <span class="token annotation punctuation">@LastModifiedDate</span> <span class="token comment">//æœ€åä¸€æ¬¡æ›´æ–°æ—¶é—´</span>    <span class="token annotation punctuation">@JsonIgnore</span>    <span class="token keyword">private</span> <span class="token class-name">Instant</span> updatedAt<span class="token punctuation">;</span>    <span class="token annotation punctuation">@CreatedBy</span> <span class="token comment">//æ ‡è®°åˆ›å»ºäºº</span>    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>updatable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">//ä¸å…è®¸æ›´æ–°</span>    <span class="token annotation punctuation">@JsonIgnore</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> createdBy<span class="token punctuation">;</span>    <span class="token annotation punctuation">@LastModifiedBy</span> <span class="token comment">//æœ€åä¸€æ¬¡æ›´æ–°äºº</span>    <span class="token annotation punctuation">@JsonIgnore</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> updatedBy<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h3><h4 id="æ§åˆ¶è®¿é—®æƒé™çš„æ–¹æ³•ï¼š"><a href="#æ§åˆ¶è®¿é—®æƒé™çš„æ–¹æ³•ï¼š" class="headerlink" title="æ§åˆ¶è®¿é—®æƒé™çš„æ–¹æ³•ï¼š"></a>æ§åˆ¶è®¿é—®æƒé™çš„æ–¹æ³•ï¼š</h4><ul><li><code>permitAll()</code>ï¼šæ— æ¡ä»¶å…è®¸ä»»ä½•å½¢å¼è®¿é—®ï¼Œä¸ç®¡ä½ ç™»å½•è¿˜æ˜¯æ²¡æœ‰ç™»å½•ã€‚</li><li><code>anonymous()</code>ï¼šå…è®¸åŒ¿åè®¿é—®ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ç™»å½•æ‰å¯ä»¥è®¿é—®ã€‚</li><li><code>denyAll()</code>ï¼šæ— æ¡ä»¶å†³ç»ä»»ä½•å½¢å¼çš„è®¿é—®ã€‚</li><li><code>authenticated()</code>ï¼šåªå…è®¸å·²è®¤è¯çš„ç”¨æˆ·è®¿é—®ã€‚</li><li><code>fullyAuthenticated()</code>ï¼šåªå…è®¸å·²ç»ç™»å½•æˆ–è€…é€šè¿‡ remember-me ç™»å½•çš„ç”¨æˆ·è®¿é—®ã€‚</li><li><code>hasRole(String)</code> : åªå…è®¸æŒ‡å®šçš„è§’è‰²è®¿é—®ã€‚</li><li><code>hasAnyRole(String)</code> : æŒ‡å®šä¸€ä¸ªæˆ–è€…å¤šä¸ªè§’è‰²ï¼Œæ»¡è¶³å…¶ä¸€çš„ç”¨æˆ·å³å¯è®¿é—®ã€‚</li><li><code>hasAuthority(String)</code>ï¼šåªå…è®¸å…·æœ‰æŒ‡å®šæƒé™çš„ç”¨æˆ·è®¿é—®</li><li><code>hasAnyAuthority(String)</code>ï¼šæŒ‡å®šä¸€ä¸ªæˆ–è€…å¤šä¸ªæƒé™ï¼Œæ»¡è¶³å…¶ä¸€çš„ç”¨æˆ·å³å¯è®¿é—®ã€‚</li><li><code>hasIpAddress(String)</code> : åªå…è®¸æŒ‡å®š ip çš„ç”¨æˆ·è®¿é—®ã€‚</li></ul><hr><h1 id="å‚æ•°æ ¡éªŒ"><a href="#å‚æ•°æ ¡éªŒ" class="headerlink" title="å‚æ•°æ ¡éªŒ"></a>å‚æ•°æ ¡éªŒ</h1><h4 id="Hibernate-Validator"><a href="#Hibernate-Validator" class="headerlink" title="Hibernate Validator"></a>Hibernate Validator</h4><p>ä½¿ç”¨æ—¶å»ºè®®ä½¿ç”¨**<code>javax.validation.constraints</code>**ä¸­çš„æ³¨è§£<br>å¸¸è§çš„æ³¨è§£ï¼š</p><ul><li><code>@NotEmpty</code> è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„ä¸èƒ½ä¸º null ä¹Ÿä¸èƒ½ä¸ºç©º</li><li><code>@NotBlank</code> è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²é nullï¼Œå¹¶ä¸”å¿…é¡»åŒ…å«ä¸€ä¸ªéç©ºç™½å­—ç¬¦</li><li><code>@Null</code> è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º null</li><li><code>@NotNull</code> è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸ä¸º null</li><li><code>@AssertTrue</code> è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º true</li><li><code>@AssertFalse</code> è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º false</li><li><code>@Pattern(regex=,flag=)</code>è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼</li><li><code>@Email</code> è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ Email æ ¼å¼ã€‚</li><li><code>@Min(value)</code>è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼</li><li><code>@Max(value)</code>è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼</li><li><code>@DecimalMin(value)</code>è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼</li><li><code>@DecimalMax(value)</code> è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼</li><li><code>@Size(max=, min=)</code>è¢«æ³¨é‡Šçš„å…ƒç´ çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…</li><li><code>@Digits(integer, fraction)</code>è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»åœ¨å¯æ¥å—çš„èŒƒå›´å†…</li><li><code>@Past</code>è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¥æœŸ</li><li><code>@Future</code> è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªå°†æ¥çš„æ—¥æœŸ</li><li><code>@Positive</code>å’Œ<code>@PositiveOrZero</code>éªŒè¯æ•°å­—å¿…é¡»ä¸ºæ­£æ•°/åŒ…æ‹¬0ï¼ŒåŒç† <code>@Negative</code>ä¸ºè´Ÿæ•°</li></ul><hr><p>ç¤ºä¾‹1ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"classId ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> classId<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>max <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"name ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Pattern</span><span class="token punctuation">(</span>regexp <span class="token operator">=</span> <span class="token string">"((^Man$|^Woman$|^UGM$))"</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"sex å€¼ä¸åœ¨å¯é€‰èŒƒå›´"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"sex ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Email</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"email æ ¼å¼ä¸æ­£ç¡®"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"email ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//åœ¨éœ€è¦æ ¡éªŒçš„å‚æ•°ä¸Šä½¿ç”¨@Validï¼Œå¦‚æœéªŒè¯å¤±è´¥ï¼Œä¼šæŠ›å‡ºæˆ‘ä»¬åœ¨éœ€è¦éªŒè¯çš„å‚æ•°ä¸ŠåŠ ä¸Šäº†`@Valid`æ³¨è§£ï¼Œå¦‚æœéªŒè¯å¤±è´¥ï¼Œå®ƒå°†æŠ›å‡ºMethodArgumentNotValidException</span><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PersonController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/person"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPerson</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token annotation punctuation">@Valid</span> <span class="token class-name">Person</span> person<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¤ºä¾‹2ï¼šéªŒè¯è¯·æ±‚å‚æ•°ï¼Œè¦æ±‚åœ¨ç±»ä¸ŠåŠ @Validatedæ³¨è§£</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Validated</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PersonController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/person/{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPersonByID</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token annotation punctuation">@Max</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>message <span class="token operator">=</span> <span class="token string">"è¶…è¿‡ id çš„èŒƒå›´äº†"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ä½¿ç”¨-Validatedæ¥æŒ‡å®šä¸åŒçš„ç»„åˆ«æ¡ä»¶ä¸‹ä½¿ç”¨ä¸åŒçš„æ ¡éªŒæ–¹æ³•"><a href="#ä½¿ç”¨-Validatedæ¥æŒ‡å®šä¸åŒçš„ç»„åˆ«æ¡ä»¶ä¸‹ä½¿ç”¨ä¸åŒçš„æ ¡éªŒæ–¹æ³•" class="headerlink" title="ä½¿ç”¨@Validatedæ¥æŒ‡å®šä¸åŒçš„ç»„åˆ«æ¡ä»¶ä¸‹ä½¿ç”¨ä¸åŒçš„æ ¡éªŒæ–¹æ³•"></a>ä½¿ç”¨@Validatedæ¥æŒ‡å®šä¸åŒçš„ç»„åˆ«æ¡ä»¶ä¸‹ä½¿ç”¨ä¸åŒçš„æ ¡éªŒæ–¹æ³•</h4><ol><li>å®šä¹‰ç»„åˆ«æ¥å£ï¼Œä¸ºç©ºå³å¯<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>groups <span class="token operator">=</span> <span class="token class-name">CreateGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// åˆ›å»ºæ—¶éœ€è¦æ ¡éªŒ</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">,</span> groups <span class="token operator">=</span> <span class="token class-name">UpdateGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// æ›´æ–°æ—¶éœ€è¦æ ¡éªŒ</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>    <span class="token comment">// getters and setters</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å®šä¹‰ç±»çš„æ ¡éªŒè§„åˆ™ï¼Œæ ¹æ®ç»„åˆ«æ¥å†™<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>groups <span class="token operator">=</span> <span class="token class-name">CreateGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// åˆ›å»ºæ—¶éœ€è¦æ ¡éªŒ</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">,</span> groups <span class="token operator">=</span> <span class="token class-name">UpdateGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// æ›´æ–°æ—¶éœ€è¦æ ¡éªŒ</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>    <span class="token comment">// getters and setters</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>ä¸åŒçš„æ–¹æ³•ä¸Šçš„ä¼ å‚ä½¿ç”¨ä¸åŒçš„ç»„åˆ«æ¥è¿›è¡Œæ ¡éªŒ<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>groups <span class="token operator">=</span> <span class="token class-name">CreateGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// åˆ›å»ºæ—¶éœ€è¦æ ¡éªŒ</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">,</span> groups <span class="token operator">=</span> <span class="token class-name">UpdateGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// æ›´æ–°æ—¶éœ€è¦æ ¡éªŒ</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>    <span class="token comment">// getters and setters</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h4 id="å…¨å±€å¤„ç†Controllerå±‚å¼‚å¸¸"><a href="#å…¨å±€å¤„ç†Controllerå±‚å¼‚å¸¸" class="headerlink" title="å…¨å±€å¤„ç†Controllerå±‚å¼‚å¸¸"></a>å…¨å±€å¤„ç†Controllerå±‚å¼‚å¸¸</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ControllerAdvice</span><span class="token annotation punctuation">@ResponseBody</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * è¯·æ±‚å‚æ•°å¼‚å¸¸å¤„ç†     */</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">MethodArgumentNotValidException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleMethodArgumentNotValidException</span><span class="token punctuation">(</span><span class="token class-name">MethodArgumentNotValidException</span> ex<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="JPA"><a href="#JPA" class="headerlink" title="JPA"></a>JPA</h3><ul><li><code>@Entity</code>å£°æ˜ä¸€ä¸ªç±»å¯¹åº”ä¸€ä¸ªæ•°æ®åº“å®ä½“ã€‚</li><li><code>@Table</code>&nbsp;è®¾ç½®è¡¨å</li><li><code>@Id</code>å£°æ˜ä¸»é”®</li><li><code>GeneratedValue</code> ä¸»é”®å¡«å……ç­–ç•¥<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">GenerationType</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * ä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„æ•°æ®åº“è¡¨æ ¼æ¥ä¿å­˜ä¸»é”®     * æŒä¹…åŒ–å¼•æ“é€šè¿‡å…³ç³»æ•°æ®åº“çš„ä¸€å¼ ç‰¹å®šçš„è¡¨æ ¼æ¥ç”Ÿæˆä¸»é”®,     */</span>    <span class="token constant">TABLE</span><span class="token punctuation">,</span>    <span class="token comment">/**     *åœ¨æŸäº›æ•°æ®åº“ä¸­,ä¸æ”¯æŒä¸»é”®è‡ªå¢é•¿,æ¯”å¦‚Oracleã€PostgreSQLå…¶æä¾›äº†ä¸€ç§å«åš"åºåˆ—(sequence)"çš„æœºåˆ¶ç”Ÿæˆä¸»é”®     */</span>    <span class="token constant">SEQUENCE</span><span class="token punctuation">,</span>    <span class="token comment">/**     * ä¸»é”®è‡ªå¢é•¿     */</span>    <span class="token constant">IDENTITY</span><span class="token punctuation">,</span>    <span class="token comment">/**     *æŠŠä¸»é”®ç”Ÿæˆç­–ç•¥äº¤ç»™æŒä¹…åŒ–å¼•æ“(persistence engine),     *æŒä¹…åŒ–å¼•æ“ä¼šæ ¹æ®æ•°æ®åº“åœ¨ä»¥ä¸Šä¸‰ç§ä¸»é”®ç”Ÿæˆ ç­–ç•¥ä¸­é€‰æ‹©å…¶ä¸­ä¸€ç§     */</span>    <span class="token constant">AUTO</span> <span class="token comment">//é»˜è®¤</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><code>@Column</code> è®¾ç½®å­—æ®µ<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//è®¾ç½®å­—æ®µç±»å‹ï¼Œå¹¶ä¸”å¢åŠ ä¸€ä¸ªé»˜è®¤å€¼</span><span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>columnDefinition <span class="token operator">=</span> <span class="token string">"tinyint(1) default 1"</span><span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">Boolean</span> enabled<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><code>@Transient</code> å£°æ˜ä¸éœ€è¦æŒä¹…åŒ–çš„å­—æ®µï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦ä¿å­˜è¿›æ•°æ®åº“</li><li>å£°æ˜å¤§å­—æ®µ:<ul><li>TEXTï¼šç”¨äºå­˜å‚¨å¤§é‡çš„éäºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆå­—ç¬¦æ•°æ®ï¼‰ã€‚å®ƒå¯ä»¥å­˜å‚¨æœ€å¤š 2^16 - 1 å­—ç¬¦ã€‚  </li><li>BLOBï¼šç”¨äºå­˜å‚¨å¤§é‡çš„äºŒè¿›åˆ¶æ•°æ®ã€‚å®ƒå¯ä»¥å­˜å‚¨æœ€å¤š 2^16 - 1 å­—èŠ‚çš„æ•°æ®ã€‚  </li><li>MEDIUMTEXT å’Œ MEDIUMBLOBï¼šè¿™ä¸¤ç§ç±»å‹å¯ä»¥å­˜å‚¨æ›´å¤šçš„æ•°æ®ï¼Œæœ€å¤š 2^24 - 1 å­—ç¬¦æˆ–å­—èŠ‚ã€‚  </li><li>LONGTEXT å’Œ LONGBLOBï¼šè¿™ä¸¤ç§ç±»å‹å¯ä»¥å­˜å‚¨æœ€å¤š 2^32 - 1 å­—ç¬¦æˆ–å­—èŠ‚çš„æ•°æ®ï¼Œé€‚ç”¨äºéå¸¸å¤§çš„æ•°æ®ã€‚<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Lob</span><span class="token comment">//æŒ‡å®š Lob ç±»å‹æ•°æ®çš„è·å–ç­–ç•¥ï¼Œ FetchType.EAGER è¡¨ç¤ºéå»¶è¿ŸåŠ è½½ï¼Œè€Œ FetchType.LAZY è¡¨ç¤ºå»¶è¿ŸåŠ è½½ ï¼›</span><span class="token annotation punctuation">@Basic</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span><span class="token constant">EAGER</span><span class="token punctuation">)</span><span class="token comment">//columnDefinition å±æ€§æŒ‡å®šæ•°æ®è¡¨å¯¹åº”çš„ Lob å­—æ®µç±»å‹</span><span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"content"</span><span class="token punctuation">,</span> columnDefinition <span class="token operator">=</span> <span class="token string">"LONGTEXT NOT NULL"</span><span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li>åˆ›å»ºæšä¸¾å­—æ®µï¼šè‡ªå·±åˆ›å»ºæšä¸¾ç±»ï¼Œç„¶ååœ¨æšä¸¾å­—æ®µä¸ŠåŠ ä¸Š@Enumeratedæ³¨è§£å³å¯<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Gender</span> <span class="token punctuation">{</span>    <span class="token function">MALE</span><span class="token punctuation">(</span><span class="token string">"ç”·æ€§"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">FEMALE</span><span class="token punctuation">(</span><span class="token string">"å¥³æ€§"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> value<span class="token punctuation">;</span>    <span class="token class-name">Gender</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">{</span>        value<span class="token operator">=</span>str<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Entity</span><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"role"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Role</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Id</span>    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Enumerated</span><span class="token punctuation">(</span><span class="token class-name">EnumType</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Gender</span> gender<span class="token punctuation">;</span>    çœç•¥getter<span class="token operator">/</span>setter<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å®¡è®¡: <del>å¾…è¡¥</del></li><li>åˆ é™¤/ä¿®æ”¹æ•°æ®:<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Repository</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Modifying</span>    <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">void</span> <span class="token function">deleteByUserName</span><span class="token punctuation">(</span><span class="token class-name">String</span> userName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å…³è”å…³ç³»ï¼š<ul><li><code>@OneToOne</code>&nbsp;å£°æ˜ä¸€å¯¹ä¸€å…³ç³»</li><li><code>@OneToMany</code>&nbsp;å£°æ˜ä¸€å¯¹å¤šå…³ç³»</li><li><code>@ManyToOne</code>&nbsp;å£°æ˜å¤šå¯¹ä¸€å…³ç³»</li><li><code>@ManyToMany</code>&nbsp;å£°æ˜å¤šå¯¹å¤šå…³ç³»</li></ul></li></ul><h3 id="JSONå¤„ç†"><a href="#JSONå¤„ç†" class="headerlink" title="JSONå¤„ç†"></a>JSONå¤„ç†</h3><ul><li><code>@JsonIgnoreProperties</code> ç”¨äºç±»ä¸Š</li><li><code>JsonIgnore</code> ç”¨äºå±æ€§ä¸Š<br>è¿›è¡Œåºåˆ—åŒ–æ—¶ï¼Œä¼šå¿½ç•¥æ ‡è®°çš„å€¼ï¼Œç¤ºä¾‹ï¼š<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">{</span>    <span class="token string">"from"</span><span class="token operator">:</span> <span class="token string">"user1"</span><span class="token punctuation">,</span>    <span class="token string">"to"</span><span class="token operator">:</span> <span class="token string">"user2"</span><span class="token punctuation">,</span>    <span class="token string">"content"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">"text"</span><span class="token operator">:</span> <span class="token string">"Hello"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token string">"image"</span><span class="token operator">:</span> <span class="token string">"image_url"</span><span class="token punctuation">,</span>    <span class="token string">"readed"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token string">"date"</span><span class="token operator">:</span> <span class="token string">"2023-01-01 12:00:00"</span><span class="token punctuation">}</span><span class="token comment">//åœ¨ç±»ä¸Šçš„imageå­—æ®µä¸Šæ ‡è®° @Ignore</span>é‚£ä¹ˆåºåˆ—åŒ–ä¹‹åçš„ç»“æœæ˜¯<span class="token punctuation">{</span>    <span class="token string">"from"</span><span class="token operator">:</span> <span class="token string">"user1"</span><span class="token punctuation">,</span>    <span class="token string">"to"</span><span class="token operator">:</span> <span class="token string">"user2"</span><span class="token punctuation">,</span>    <span class="token string">"content"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">"text"</span><span class="token operator">:</span> <span class="token string">"Hello"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token string">"readed"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token string">"date"</span><span class="token operator">:</span> <span class="token string">"2023-01-01 12:00:00"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>JSONæ‰å¹³åŒ–ï¼š<code>@JsonUnwrapped</code>.</li></ul><h3 id="æµ‹è¯•ç›¸å…³"><a href="#æµ‹è¯•ç›¸å…³" class="headerlink" title="æµ‹è¯•ç›¸å…³"></a>æµ‹è¯•ç›¸å…³</h3><ul><li>@ActiveProfiles(â€œprodâ€) ä½œç”¨äºç±»ä¸Šï¼Œç”¨äºç”Ÿå‘½ç”Ÿæ•ˆçš„Springé…ç½®æ–‡ä»¶<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token constant">RANDOM_PORT</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ActiveProfiles</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">TestBase</span> <span class="token punctuation">{</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><code>@Test</code> å£°æ˜ä¸ºä¸€ä¸ªæµ‹è¯•æ–¹æ³•ï¼Œ<code>@Transactional</code>ç”¨äºå›æ»šæµ‹è¯•æ•°æ®ï¼Œ <strong>æ³¨æ„ï¼š</strong> @Transactionalæ— æ³•å›æ»šMongoDBç­‰NoSQLæ•°æ®åº“ï¼ŒMongoDBæ”¯æŒå‰¯æœ¬é›†å›æ»šäº‹åŠ¡</li></ul><h3 id="IOC"><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h3><p>æ§åˆ¶åè½¬ï¼Œå°†new äº¤ç”±Springæ¡†æ¶ç®¡ç†ï¼ŒBeançš„ç”Ÿå‘½å‘¨æœŸéƒ½ç”±Springè°ƒç”¨<br>ä¼˜ç‚¹ï¼š</p><ol><li>èµ„æºå˜å¾—å®¹æ˜“ç®¡ç†ï¼š</li><li>é™ä½å¯¹è±¡ä¹‹é—´çš„è€¦åˆå’Œä¾èµ–</li></ol><h1 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h1><h3 id="è‡ªåŠ¨è£…é…"><a href="#è‡ªåŠ¨è£…é…" class="headerlink" title="è‡ªåŠ¨è£…é…"></a>è‡ªåŠ¨è£…é…</h3><h5 id="EnableAutoConfigurationï¼šå®ç°è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒ"><a href="#EnableAutoConfigurationï¼šå®ç°è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒ" class="headerlink" title="@EnableAutoConfigurationï¼šå®ç°è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒ"></a>@EnableAutoConfigurationï¼šå®ç°è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒ</h5><h1 id="Springæºç é˜…è¯»"><a href="#Springæºç é˜…è¯»" class="headerlink" title="Springæºç é˜…è¯»"></a>Springæºç é˜…è¯»</h1><p>æ¨èæ–‡ç« ï¼š<a href="https://github.com/xuchengsheng/spring-reading/tree/master">xuchengsheng/spring-reading(github.com)</a></p><h2 id="Resource"><a href="#Resource" class="headerlink" title="Resource"></a>Resource</h2><p><code>Resource</code> æ˜¯Springæ¡†æ¶ä¸­ç”¨äºç®€åŒ–å’Œç»Ÿä¸€å¯¹åº•å±‚èµ„æºï¼ˆå¦‚æ–‡ä»¶ã€classpath èµ„æºã€URL ç­‰ï¼‰çš„è®¿é—®çš„ä¸€ä¸ªæ ¸å¿ƒæ¥å£ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><p>classpath æ˜¯ Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰å’Œ Java ç¼–è¯‘å™¨ç”¨æ¥æŸ¥æ‰¾ç±»æ–‡ä»¶å’Œèµ„æºæ–‡ä»¶çš„è·¯å¾„ã€‚å®ƒæŒ‡å®šäº† Java åº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶æˆ–ç¼–è¯‘æ—¶éœ€è¦çš„ç±»å’Œèµ„æºçš„ä½ç½®ã€‚classpath å¯ä»¥åŒ…å«ç›®å½•ã€JAR æ–‡ä»¶æˆ– ZIP æ–‡ä»¶ã€‚</p><h3 id="ä¸»è¦åŠŸèƒ½"><a href="#ä¸»è¦åŠŸèƒ½" class="headerlink" title="ä¸»è¦åŠŸèƒ½"></a>ä¸»è¦åŠŸèƒ½</h3><ol><li>ç»Ÿä¸€çš„èµ„æºæŠ½è±¡ï¼Œæ— è®ºèµ„æºæ¥è‡ªæ–‡ä»¶ç³»ç»Ÿã€classpathã€URLè¿˜æ˜¯å…¶ä»–ï¼ŒResourceæä¾›ç»Ÿä¸€çš„æŠ½è±¡</li><li>èµ„æºæè¿°é€šè¿‡getDescriptionæ¥è·å¾—åº•å±‚èµ„æºæä¾›çš„æè¿°æ€§ä¿¡æ¯</li><li>è¯»å–èƒ½åŠ›ï¼šResourceæä¾›äº†getInputStreamæ–¹æ³•ï¼Œå…è®¸ç›´æ¥è¯»å–èµ„æºå†…å®¹è€Œæ— éœ€å…³å¿ƒèµ„æºçš„å®é™…æ¥æºã€‚</li><li>å­˜åœ¨ä¸å¯è¯»æ€§ï¼šResourceæä¾›äº†ä¸¤ä¸ªæ–¹æ³•æ¥ç¡®å®šèµ„æºæ˜¯å¦å­˜åœ¨ä»¥åŠæ˜¯å¦å¯è¯»ã€‚</li><li>å¼€æ”¾æ€§æ£€æŸ¥ï¼šisOpen()ç”¨æ¥æ£€æŸ¥èµ„æºæ˜¯å¦æ ‡è¯†ä¸€ä¸ªå·²ç»æ‰“å¼€çš„æµï¼Œæœ‰åŠ©äºé¿å…é‡å¤è¯»å–æµèµ„æºã€‚</li><li>æ–‡ä»¶è®¿é—®ï¼šå½“èµ„æºä»£è¡¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶æ—¶ï¼Œå¯ä»¥é€šè¿‡getFile()ç›´æ¥è®¿é—®è¯¥æ–‡ä»¶</li><li>Springæä¾›äº†å¤šç§Resourceçš„å®ç°</li></ol><h3 id="æºç ï¼š"><a href="#æºç ï¼š" class="headerlink" title="æºç ï¼š"></a>æºç ï¼š</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * è¡¨ç¤ºå¯ä»¥æä¾›è¾“å…¥æµçš„èµ„æºæˆ–å¯¹è±¡çš„æ¥å£ã€‚ */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">InputStreamSource</span> <span class="token punctuation">{</span><span class="token comment">/** * è¿”å›åŸºç¡€èµ„æºå†…å®¹çš„ InputStreamã€‚ * æœŸæœ›æ¯æ¬¡è°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æµã€‚ * å½“æˆ‘ä»¬è€ƒè™‘åˆ°åƒ JavaMail è¿™æ ·çš„APIæ—¶ï¼Œè¿™ä¸ªè¦æ±‚å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºåœ¨åˆ›å»ºé‚®ä»¶é™„ä»¶æ—¶ï¼ŒJavaMailéœ€è¦èƒ½å¤Ÿå¤šæ¬¡è¯»å–æµã€‚å¯¹äºè¿™æ ·çš„ç”¨ä¾‹ï¼Œè¦æ±‚æ¯ä¸ª getInputStream() è°ƒç”¨éƒ½è¿”å›ä¸€ä¸ªæ–°çš„æµã€‚ * @return åŸºç¡€èµ„æºçš„è¾“å…¥æµï¼ˆä¸èƒ½ä¸º nullï¼‰ * @throws java.io.FileNotFoundException å¦‚æœåŸºç¡€èµ„æºä¸å­˜åœ¨ * @throws IOException å¦‚æœæ— æ³•æ‰“å¼€å†…å®¹æµ */</span><span class="token class-name">InputStream</span> <span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ResourceLoader"><a href="#ResourceLoader" class="headerlink" title="ResourceLoader"></a>ResourceLoader</h2><p>Spring æ¡†æ¶ä¸­çš„ä¸€ä¸ªå…³é”®æ¥å£ï¼Œå®ƒå®šä¹‰äº†å¦‚ä½•è·å–èµ„æºï¼ˆä¾‹å¦‚ç±»è·¯å¾„èµ„æºã€æ–‡ä»¶ç³»ç»Ÿèµ„æºæˆ–ç½‘é¡µèµ„æºï¼‰çš„ç­–ç•¥ã€‚è¿™ä¸ªæ¥å£æ˜¯ Spring èµ„æºåŠ è½½æŠ½è±¡çš„æ ¸å¿ƒï¼Œä½¿å¾—åº”ç”¨ç¨‹åºå¯ä»¥ä»ä¸åŒçš„èµ„æºä½ç½®ä»¥ç»Ÿä¸€çš„æ–¹å¼åŠ è½½èµ„æºã€‚<br>ç”¨äºè·å–Resourceå¯¹è±¡çš„å·¥å‚ã€‚</p><h3 id="ä¸»è¦åŠŸèƒ½-1"><a href="#ä¸»è¦åŠŸèƒ½-1" class="headerlink" title="ä¸»è¦åŠŸèƒ½"></a>ä¸»è¦åŠŸèƒ½</h3><ol><li>ç»Ÿä¸€çš„èµ„æºåŠ è½½ï¼Œæä¾›äº†ä¸€ä¸ªæ ‡å‡†åŒ–çš„æ–¹æ³•æ¥åŠ è½½èµ„æºï¼Œä¸è®ºèµ„æºæ˜¯å­˜æ”¾åœ¨ç±»è·¯å¾„ã€æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œURLè¿˜æ˜¯å…¶ä»–ä½ç½®</li><li>èµ„æºä½ç½®è§£æï¼šæ ¹æ®æä¾›çš„èµ„æºå­—ç¬¦ä¸²ä½ç½®ï¼Œå¯ä»¥ç¡®å®šèµ„æºçš„ç±»å‹ï¼Œå¹¶ä¸”ä¸ºå…¶åˆ›å»ºå“åº”çš„Resourceå®ä¾‹</li><li>è¿”å›Resourceå®ä¾‹ï¼šgetResource(String location)æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªResourceå¯¹è±¡ï¼Œä»£è¡¨äº†æŒ‡å®šä½ç½®çš„èµ„æºã€‚</li><li>ä¸ClassLoaderäº¤äº’ï¼šé€šè¿‡getClassLoader()æ–¹æ³•è¿”å›å…¶å…³è”çš„ClassLoader</li><li>æ‰©å±•æ€§ï¼š<code>ResourceLoader</code>&nbsp;æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å®ç°è‡ªå·±çš„èµ„æºåŠ è½½ç­–ç•¥ï¼Œæˆ–è€…æ‰©å±•é»˜è®¤çš„ç­–ç•¥ä»¥æ»¡è¶³ç‰¹å®šéœ€æ±‚ã€‚</li><li>å†…ç½®å®ç°ä¸æ•´åˆï¼šSpring æä¾›äº†é»˜è®¤çš„&nbsp;<code>ResourceLoader</code>&nbsp;å®ç°ï¼Œå¦‚&nbsp;<code>DefaultResourceLoader</code>ã€‚ä½†æ›´é‡è¦çš„æ˜¯ï¼Œ<code>org.springframework.context.ApplicationContext</code>&nbsp;ä¹Ÿå®ç°äº†&nbsp;<code>ResourceLoader</code>ï¼Œè¿™æ„å‘³ç€ Spring ä¸Šä¸‹æ–‡æœ¬èº«å°±æ˜¯ä¸€ä¸ªèµ„æºåŠ è½½å™¨ã€‚</li></ol><h3 id="æºç ï¼š-1"><a href="#æºç ï¼š-1" class="headerlink" title="æºç ï¼š"></a>æºç ï¼š</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ResourceLoader</span> <span class="token punctuation">{</span><span class="token comment">//é»˜è®¤çš„classpathè·¯å¾„</span>    <span class="token class-name">String</span> <span class="token constant">CLASSPATH_URL_PREFIX</span> <span class="token operator">=</span> <span class="token string">"classpath:"</span><span class="token punctuation">;</span>    <span class="token class-name">Resource</span> <span class="token function">getResource</span><span class="token punctuation">(</span><span class="token class-name">String</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Nullable</span>    <span class="token class-name">ClassLoader</span> <span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é»˜è®¤å®ç°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultResourceLoader</span> <span class="token keyword">implements</span> <span class="token class-name">ResourceLoader</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Nullable</span>    <span class="token keyword">private</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">;</span>    <span class="token comment">//è‡ªå®šä¹‰çš„åè®®</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProtocolResolver</span><span class="token punctuation">&gt;</span></span> protocolResolvers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç¼“å­˜</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">Resource</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> resourceCaches <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* çœç•¥æ„é€ æ–¹æ³•å’Œä¸€äº›ä¸é‡è¦çš„æ–¹æ³•*/</span>    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Resource</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getResourceCache</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> valueType<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceCaches<span class="token punctuation">.</span><span class="token function">computeIfAbsent</span><span class="token punctuation">(</span>valueType<span class="token punctuation">,</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token comment">// æ ¹æ®ä¸åŒçš„è·¯å¾„å‚æ•°æ¥è¿”å›å¯¹åº”çš„Resource</span>    <span class="token keyword">public</span> <span class="token class-name">Resource</span> <span class="token function">getResource</span><span class="token punctuation">(</span><span class="token class-name">String</span> location<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> <span class="token string">"Location must not be null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Iterator</span> var2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getProtocolResolvers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Resource</span> resource<span class="token punctuation">;</span>        <span class="token keyword">do</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>var2<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>location<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getResourceByPath</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>location<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"classpath:"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token string">"classpath:"</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    <span class="token class-name">URL</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Resource</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">ResourceUtils</span><span class="token punctuation">.</span><span class="token function">isFileURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">FileUrlResource</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">UrlResource</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MalformedURLException</span> var5<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getResourceByPath</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token class-name">ProtocolResolver</span> protocolResolver <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ProtocolResolver</span><span class="token punctuation">)</span>var2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            resource <span class="token operator">=</span> protocolResolver<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span>resource <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> resource<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">protected</span> <span class="token class-name">Resource</span> <span class="token function">getResourceByPath</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathContextResource</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ClassPathContextResource</span> <span class="token keyword">extends</span> <span class="token class-name">ClassPathResource</span> <span class="token keyword">implements</span> <span class="token class-name">ContextResource</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token class-name">ClassPathContextResource</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">super</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPathWithinContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token class-name">Resource</span> <span class="token function">createRelative</span><span class="token punctuation">(</span><span class="token class-name">String</span> relativePath<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">String</span> pathToUse <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">applyRelativePath</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> relativePath<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathContextResource</span><span class="token punctuation">(</span>pathToUse<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>computeIfAbsent æ˜¯ Java 8 å¼•å…¥çš„ Map æ¥å£ä¸­çš„ä¸€ä¸ªé»˜è®¤æ–¹æ³•ã€‚å®ƒç”¨äºåœ¨ Map ä¸­æŸ¥æ‰¾æŒ‡å®šé”®çš„å€¼ï¼Œå¦‚æœè¯¥é”®ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨æä¾›çš„æ˜ å°„å‡½æ•°è®¡ç®—è¯¥é”®çš„å€¼ï¼Œå¹¶å°†å…¶æ’å…¥åˆ° Map ä¸­ï¼Œç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ä¼ å…¥lambda</p><h2 id="ResourcePatternResolver"><a href="#ResourcePatternResolver" class="headerlink" title="ResourcePatternResolver"></a>ResourcePatternResolver</h2><p>ç”¨äºè§£æèµ„æºæ¨¡å¼ï¼Œæ”¯æŒé€šè¿‡æ¨¡å¼åŒ¹é…æ£€ç´¢å¤šä¸ªèµ„æºï¼Œæ”¯æŒé€šè¿‡æ¨¡å¼åŒ¹é…æ£€ç´¢å¤šä¸ªèµ„æºã€‚</p><h3 id="ä¸»è¦åŠŸèƒ½-2"><a href="#ä¸»è¦åŠŸèƒ½-2" class="headerlink" title="ä¸»è¦åŠŸèƒ½"></a>ä¸»è¦åŠŸèƒ½</h3><ol><li><p><strong>èµ„æºæ¨¡å¼è§£æ</strong></p><ul><li>é€šè¿‡<code>getResources(String locationPattern)</code>æ–¹æ³•ï¼Œæ”¯æŒä½¿ç”¨é€šé…ç¬¦çš„èµ„æºæ¨¡å¼ï¼Œå¦‚<code>classpath*:com/example/**/*.xml</code>ï¼Œç”¨äºæ£€ç´¢åŒ¹é…ç‰¹å®šæ¨¡å¼çš„å¤šä¸ªèµ„æºã€‚</li></ul></li><li><p><strong>èµ„æºè·å–</strong></p><ul><li>é€šè¿‡<code>getResources(Resource location)</code>æ–¹æ³•ï¼Œæ ¹æ®ç»™å®šçš„èµ„æºå¯¹è±¡ï¼Œè¿”å›åŒ¹é…çš„èµ„æºæ•°ç»„ã€‚è¿™ä½¿å¾—å¯ä»¥è·å–ä¸ç‰¹å®šèµ„æºç›¸å…³è”çš„å…¶ä»–èµ„æºï¼Œä¾‹å¦‚è·å–ä¸ç»™å®šç±»è·¯å¾„ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶ç›¸å…³çš„æ‰€æœ‰èµ„æºã€‚</li></ul></li><li><p><strong>å¤šç§èµ„æºä½ç½®æ”¯æŒ</strong></p><ul><li>å¯ä»¥å¤„ç†ä¸åŒçš„èµ„æºä½ç½®ï¼ŒåŒ…æ‹¬ç±»è·¯å¾„ï¼ˆclasspathï¼‰ã€æ–‡ä»¶ç³»ç»Ÿã€URLç­‰ã€‚è¿™ä½¿å¾—åº”ç”¨ç¨‹åºèƒ½å¤Ÿä»¥ä¸åŒçš„æ–¹å¼ç»„ç»‡å’Œå­˜å‚¨èµ„æºï¼Œè€Œä¸å½±å“èµ„æºçš„æ£€ç´¢å’ŒåŠ è½½ã€‚</li></ul></li><li><p><strong>çµæ´»çš„èµ„æºåŠ è½½</strong></p><ul><li>ç»“åˆ<code>ResourceLoader</code>çš„èƒ½åŠ›ï¼Œ<code>ResourcePatternResolver</code>å…è®¸åœ¨åº”ç”¨ç¨‹åºä¸­ä»¥ç»Ÿä¸€çš„æ–¹å¼åŠ è½½å„ç§èµ„æºï¼Œè€Œæ— éœ€å…³å¿ƒåº•å±‚èµ„æºçš„å­˜å‚¨ä½ç½®æˆ–å½¢å¼ã€‚</li></ul></li><li><p><strong>é€šç”¨èµ„æºæ“ä½œ</strong></p><ul><li>é€šè¿‡<code>Resource</code>æ¥å£ï¼Œæä¾›äº†å¯¹èµ„æºçš„é€šç”¨æ“ä½œï¼Œä¾‹å¦‚è·å–èµ„æºçš„URLã€è¾“å…¥æµã€æ–‡ä»¶å¥æŸ„ç­‰ã€‚</li></ul></li></ol><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ResourcePatternResolver</span> <span class="token keyword">extends</span> <span class="token class-name">ResourceLoader</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * ç±»è·¯å¾„åŒ¹é…æ‰€æœ‰èµ„æºçš„ä¼ª URL å‰ç¼€ï¼š"classpath*:"     * è¿™ä¸ ResourceLoader çš„ç±»è·¯å¾„ URL å‰ç¼€ä¸åŒï¼Œå®ƒæ£€ç´¢ç»™å®šåç§°ï¼ˆä¾‹å¦‚ "/beans.xml"ï¼‰çš„     * æ‰€æœ‰åŒ¹é…èµ„æºï¼Œä¾‹å¦‚åœ¨æ‰€æœ‰éƒ¨ç½²çš„ JAR æ–‡ä»¶çš„æ ¹ç›®å½•ä¸­ã€‚     * è¯¦è§ org.springframework.core.io.ResourceLoader#CLASSPATH_URL_PREFIX     */</span>    <span class="token class-name">String</span> <span class="token constant">CLASSPATH_ALL_URL_PREFIX</span> <span class="token operator">=</span> <span class="token string">"classpath*:"</span><span class="token punctuation">;</span>    <span class="token comment">/**     * å°†ç»™å®šçš„ä½ç½®æ¨¡å¼è§£æä¸º Resource å¯¹è±¡ã€‚     * åº”å°½å¯èƒ½é¿å…æŒ‡å‘ç›¸åŒç‰©ç†èµ„æºçš„é‡å èµ„æºæ¡ç›®ã€‚ç»“æœåº”å…·æœ‰é›†åˆè¯­ä¹‰ã€‚     * @param locationPattern è¦è§£æçš„ä½ç½®æ¨¡å¼     * @return ç›¸åº”çš„ Resource å¯¹è±¡æ•°ç»„     * @throws IOException å¦‚æœå‘ç”Ÿ I/O é”™è¯¯     */</span>    <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token class-name">String</span> locationPattern<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="DocumentLoader"><a href="#DocumentLoader" class="headerlink" title="DocumentLoader"></a>DocumentLoader</h2><p>ç”¨äºåŠ è½½å’Œè§£æ XML æ–‡æ¡£</p><h3 id="ä¸»è¦åŠŸèƒ½-3"><a href="#ä¸»è¦åŠŸèƒ½-3" class="headerlink" title="ä¸»è¦åŠŸèƒ½"></a>ä¸»è¦åŠŸèƒ½</h3><ol><li>åŠ è½½XMLæ–‡æ¡£</li><li>è§£æXMLæ–‡æ¡£</li><li>æ”¯æŒéªŒè¯ï¼šé€šè¿‡æŒ‡å®šéªŒè¯æ¨¡å¼ï¼ˆå¦‚ DTD æˆ– XML Schema éªŒè¯ï¼‰ï¼Œå¯ä»¥ç¡®ä¿æ–‡æ¡£çš„ç»“æ„å’Œå†…å®¹ç¬¦åˆè§„å®šçš„æ ‡å‡†ã€‚</li><li>å¤„ç†å®ä½“å¼•ç”¨</li><li>é”™è¯¯å¤„ç†</li></ol><h2 id="MetadataReader"><a href="#MetadataReader" class="headerlink" title="MetadataReader"></a>MetadataReader</h2><h3 id="ä¸€äº›é‡è¦æ¦‚å¿µ"><a href="#ä¸€äº›é‡è¦æ¦‚å¿µ" class="headerlink" title="ä¸€äº›é‡è¦æ¦‚å¿µ"></a>ä¸€äº›é‡è¦æ¦‚å¿µ</h3><p>å†…éƒ¨ç±»åœ¨ç¼–è¯‘åï¼Œå…¶æ–‡ä»¶åæ ¼å¼ä¸º OuterClass$InnerClass.classã€‚</p><h3 id="ä¸»è¦åŠŸèƒ½-4"><a href="#ä¸»è¦åŠŸèƒ½-4" class="headerlink" title="ä¸»è¦åŠŸèƒ½"></a>ä¸»è¦åŠŸèƒ½</h3><ol><li>è·å–ç±»çš„åŸºæœ¬ä¿¡æ¯</li><li>è·å–ç±»ä¸Šçš„æ³¨è§£ä¿¡æ¯</li><li>è·å–æ–¹æ³•ä¸Šçš„æ³¨è§£ä¿¡æ¯</li><li>è·å–ç±»çš„æˆå‘˜ç±»ä¿¡æ¯</li><li>è·å–ç±»çš„èµ„æºä¿¡æ¯</li><li>è·å–ç±»çš„è¶…ç±»ä¿¡æ¯</li></ol><h3 id="æºç -1"><a href="#æºç -1" class="headerlink" title="æºç "></a>æºç </h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MetadataReaderFactory</span> <span class="token punctuation">{</span>    <span class="token class-name">MetadataReader</span> <span class="token function">getMetadataReader</span><span class="token punctuation">(</span><span class="token class-name">String</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>    <span class="token class-name">MetadataReader</span> <span class="token function">getMetadataReader</span><span class="token punctuation">(</span><span class="token class-name">Resource</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿ç»´</title>
      <link href="/2024/05/23/22/"/>
      <url>/2024/05/23/22/</url>
      
        <content type="html"><![CDATA[<h2 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h2><p>ç¼–å†™docker-compose.ymlè„šæœ¬ï¼Œé…åˆdockerfileå’Œshè„šæœ¬è¿›è¡Œæ­å»º</p><ul><li>ç¤ºä¾‹ä¸€ï¼šæ­å»ºä¸€ä¸»äºŒä»ä¸‰å“¨å…µçš„redisé›†ç¾¤ ^220b94<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token property">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span> #dockercomposeç‰ˆæœ¬<span class="token property">services</span><span class="token punctuation">:</span> #å®šä¹‰åº”ç”¨çš„çš„æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡è¿è¡Œä¸€ä¸ªé•œåƒ  <span class="token property">redis-master</span><span class="token punctuation">:</span> #æœåŠ¡åç§°    <span class="token property">image</span><span class="token punctuation">:</span> <span class="token property">redis</span><span class="token punctuation">:</span>latest #é•œåƒ    <span class="token property">command</span><span class="token punctuation">:</span> redis-server --appendonly yes --requirepass bronya #å¯åŠ¨å®¹å™¨æ—¶è¦æ‰§è¡Œå‘½ä»¤    <span class="token property">volumes</span><span class="token punctuation">:</span> #æŒ‚è½½æ•°æ®å·ï¼Œä¸å­˜åœ¨çš„ç›®å½•ä¼šè‡ªåŠ¨åˆ›å»º      - ./data/<span class="token property">master</span><span class="token punctuation">:</span>/data    <span class="token property">ports</span><span class="token punctuation">:</span> #å®šä¹‰ç«¯å£æ˜ å°„      - <span class="token string">"6379:6379"</span>  <span class="token property">redis-slave1</span><span class="token punctuation">:</span>    <span class="token property">image</span><span class="token punctuation">:</span> <span class="token property">redis</span><span class="token punctuation">:</span>latest    <span class="token property">command</span><span class="token punctuation">:</span> redis-server --slaveof redis-master 6379 --appendonly yes    <span class="token property">depends_on</span><span class="token punctuation">:</span>      - redis-master    <span class="token property">volumes</span><span class="token punctuation">:</span>      - ./data/<span class="token property">slave1</span><span class="token punctuation">:</span>/data  <span class="token property">redis-slave2</span><span class="token punctuation">:</span>    <span class="token property">image</span><span class="token punctuation">:</span> <span class="token property">redis</span><span class="token punctuation">:</span>latest    <span class="token property">command</span><span class="token punctuation">:</span> redis-server --slaveof redis-master 6379 --appendonly yes    <span class="token property">depends_on</span><span class="token punctuation">:</span>      - redis-master    <span class="token property">volumes</span><span class="token punctuation">:</span>      - ./data/<span class="token property">slave2</span><span class="token punctuation">:</span>/data  <span class="token property">redis-sentinel1</span><span class="token punctuation">:</span>    <span class="token property">image</span><span class="token punctuation">:</span> <span class="token property">redis</span><span class="token punctuation">:</span>latest    <span class="token property">command</span><span class="token punctuation">:</span> redis-sentinel /etc/redis/sentinel.conf    <span class="token property">depends_on</span><span class="token punctuation">:</span>      - redis-master    <span class="token property">volumes</span><span class="token punctuation">:</span>      - ./sentinel1.<span class="token property">conf</span><span class="token punctuation">:</span>/etc/redis/sentinel.conf  <span class="token property">redis-sentinel2</span><span class="token punctuation">:</span>    <span class="token property">image</span><span class="token punctuation">:</span> <span class="token property">redis</span><span class="token punctuation">:</span>latest    <span class="token property">command</span><span class="token punctuation">:</span> redis-sentinel /etc/redis/sentinel.conf    <span class="token property">depends_on</span><span class="token punctuation">:</span>      - redis-master    <span class="token property">volumes</span><span class="token punctuation">:</span>      - ./sentinel2.<span class="token property">conf</span><span class="token punctuation">:</span>/etc/redis/sentinel.conf  <span class="token property">redis-sentinel3</span><span class="token punctuation">:</span>    <span class="token property">image</span><span class="token punctuation">:</span> <span class="token property">redis</span><span class="token punctuation">:</span>latest    <span class="token property">command</span><span class="token punctuation">:</span> redis-sentinel /etc/redis/sentinel.conf    <span class="token property">depends_on</span><span class="token punctuation">:</span>      - redis-master    <span class="token property">volumes</span><span class="token punctuation">:</span>      - ./sentinel3.<span class="token property">conf</span><span class="token punctuation">:</span>/etc/redis/sentinel.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token function">docker-compose</span> up <span class="token parameter variable">--build</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li>ç¤ºä¾‹äºŒï¼šåŸºäºdockerfile<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token property">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span><span class="token property">services</span><span class="token punctuation">:</span>  <span class="token property">app</span><span class="token punctuation">:</span>    <span class="token property">build</span><span class="token punctuation">:</span>       <span class="token property">context</span><span class="token punctuation">:</span> .      <span class="token property">dockerfile</span><span class="token punctuation">:</span> Dockerfile    <span class="token property">ports</span><span class="token punctuation">:</span>      - <span class="token string">"8080:8080"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>Dockerfileæ–‡ä»¶<pre class="line-numbers language-css" data-language="css"><code class="language-css"># ä½¿ç”¨å®˜æ–¹çš„javaé•œåƒä½œä¸ºåŸºç¡€é•œåƒFROM <span class="token property">openjdk</span><span class="token punctuation">:</span>8-jdk-alpine# è®¾ç½®å·¥ä½œç›®å½•WORKDIR /app# å°†æœ¬åœ°çš„jaråŒ…å¤åˆ¶åˆ°Dockeré•œåƒä¸­COPY ./your-app.jar /app# è®¾ç½®å¯åŠ¨å‘½ä»¤ENTRYPOINT [<span class="token string">"java"</span><span class="token punctuation">,</span> <span class="token string">"-jar"</span><span class="token punctuation">,</span> <span class="token string">"/app/your-app.jar"</span>]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><h3 id="å¸¸è§å‘½ä»¤"><a href="#å¸¸è§å‘½ä»¤" class="headerlink" title="å¸¸è§å‘½ä»¤"></a>å¸¸è§å‘½ä»¤</h3><ul><li>ä¹‹é—´çš„å…³ç³»ï¼š<br><img src="/2024/05/23/22/docker%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4%E7%9A%84%E5%85%B3%E7%B3%BB.png" alt="å¸¸è§å‘½ä»¤ä¸ä»–ä»¬ä¹‹é—´çš„å…³ç³»"></li><li>ä½¿ç”¨formatå¯¹psçš„ç»“æœè¿›è¡Œæ ¼å¼åŒ–ï¼Œæ›´å®¹æ˜“è§‚å¯Ÿ<pre class="line-numbers language-css" data-language="css"><code class="language-css">docker ps -a --format <span class="token selector">"table</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>.ID<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token selector">\t</span><span class="token punctuation">{</span><span class="token punctuation">{</span>.Image<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token selector">\t</span><span class="token punctuation">{</span><span class="token punctuation">{</span>.Ports<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token selector">\t</span><span class="token punctuation">{</span><span class="token punctuation">{</span>.Status<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token selector">\t</span><span class="token punctuation">{</span><span class="token punctuation">{</span>.Names<span class="token punctuation">}</span><span class="token punctuation">}</span>"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>å¯ä»¥é€šè¿‡ç¼–è¾‘/root/.bashrcæ–‡ä»¶å»ç»™å¸¸ç”¨çš„å‘½ä»¤èµ·åˆ«å<pre class="line-numbers language-css" data-language="css"><code class="language-css"># ä¿®æ”¹/root/.bashrcæ–‡ä»¶vi /root/.bashrcå†…å®¹å¦‚ä¸‹ï¼š# .bashrc# User specific aliases and functionsalias rm=<span class="token string">'rm -i'</span>alias cp=<span class="token string">'cp -i'</span>alias mv=<span class="token string">'mv -i'</span>alias dps=<span class="token string">'docker ps --format "table {{.ID}}\t{{.Image}}\t{{.Ports}}\t{{.Status}}\t{{.Names}}"'</span>alias dis=<span class="token string">'docker images'</span># Source global definitionsif [ -f /etc/bashrc ]<span class="token punctuation">;</span> then        . /etc/bashrcfi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><h2 id="ç½‘ç»œé—®é¢˜ï¼š-å®¹å™¨çš„ipæ˜¯ä¸€ä¸ªè™šæ‹Ÿipï¼Œå…¶å€¼å¹¶ä¸ä¸å®¹å™¨ç»‘å®š-å¯ä»¥ä½¿ç”¨dockerçš„ç½‘ç»œåŠŸèƒ½å®ç°å®¹å™¨çš„äº’è”"><a href="#ç½‘ç»œé—®é¢˜ï¼š-å®¹å™¨çš„ipæ˜¯ä¸€ä¸ªè™šæ‹Ÿipï¼Œå…¶å€¼å¹¶ä¸ä¸å®¹å™¨ç»‘å®š-å¯ä»¥ä½¿ç”¨dockerçš„ç½‘ç»œåŠŸèƒ½å®ç°å®¹å™¨çš„äº’è”" class="headerlink" title="ç½‘ç»œé—®é¢˜ï¼š  - å®¹å™¨çš„ipæ˜¯ä¸€ä¸ªè™šæ‹Ÿipï¼Œå…¶å€¼å¹¶ä¸ä¸å®¹å™¨ç»‘å®š  - å¯ä»¥ä½¿ç”¨dockerçš„ç½‘ç»œåŠŸèƒ½å®ç°å®¹å™¨çš„äº’è”"></a>ç½‘ç»œé—®é¢˜ï¼š<br>  - å®¹å™¨çš„ipæ˜¯ä¸€ä¸ªè™šæ‹Ÿipï¼Œå…¶å€¼å¹¶ä¸ä¸å®¹å™¨ç»‘å®š<br>  - å¯ä»¥ä½¿ç”¨dockerçš„ç½‘ç»œåŠŸèƒ½å®ç°å®¹å™¨çš„äº’è”</h2></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaæ–°ç‰¹æ€§</title>
      <link href="/2024/05/16/42/"/>
      <url>/2024/05/16/42/</url>
      
        <content type="html"><![CDATA[<h1 id="Javaæ–°ç‰¹æ€§é¢è¯•"><a href="#Javaæ–°ç‰¹æ€§é¢è¯•" class="headerlink" title="Javaæ–°ç‰¹æ€§é¢è¯•"></a>Javaæ–°ç‰¹æ€§é¢è¯•</h1><h2 id="Java8"><a href="#Java8" class="headerlink" title="Java8"></a>Java8</h2><ul><li>æ¥å£ï¼šinterface ä¸­å¯ä»¥æœ‰é»˜è®¤æ–¹æ³•ï¼Œæ— éœ€è¢«å­ç±»å®ç°ï¼Œé€šè¿‡Interfaceå®ç°è°ƒç”¨</li><li><strong>â€œå‡½æ•°å¼æ¥å£â€æ˜¯æŒ‡ä»…ä»…åªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•,ä½†æ˜¯å¯ä»¥æœ‰å¤šä¸ªéæŠ½è±¡æ–¹æ³•(ä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„é»˜è®¤æ–¹æ³•)çš„æ¥å£ã€‚</strong><ol><li>defaultå®ç°,å¯ä»¥è¢«å­ç±»ç»§æ‰¿é‡å†™ï¼Œä½¿ç”¨thisè°ƒç”¨</li><li>staticå®ç°ä½¿ç”¨æ–¹æ³•å’Œé™æ€æ–¹æ³•ä¸€æ ·ï¼Œä½†æ˜¯ä¸èƒ½è¢«å­ç±»ç»§æ‰¿</li><li>interfaceå’Œabstract classçš„åŒºåˆ«ï¼šinterfaceæ˜¯ä¸ºäº†å¿«é€Ÿæ‰©å±•åŠŸèƒ½ï¼Œè€Œabstract classæ˜¯ä¸ºäº†è¢«ç»§æ‰¿å®ç°çš„ã€‚<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token keyword">implements</span> <span class="token class-name">InterfaceNew</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">InterfaceNew</span><span class="token punctuation">.</span><span class="token function">sm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è°ƒç”¨dfæ–¹æ³•</span>        <span class="token class-name">Main</span> main <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        main<span class="token punctuation">.</span><span class="token function">df</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">/** * InnerMain */</span><span class="token keyword">interface</span> <span class="token class-name">InterfaceNew</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">sm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"interfaceä¸­çš„små®ç°"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token keyword">default</span> <span class="token keyword">void</span>  <span class="token function">df</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"interfaceæä¾›çš„dfå®ç°"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol></li><li>Lambda</li><li>Streamï¼šä¸å­˜å‚¨æ•°æ®ï¼Œåªæ˜¯å¯¹æ•°æ®è¿›è¡Œä¸€ç³»åˆ—çš„å¤„ç†<ul><li>ä¸²è¡Œæµï¼š<ul><li>.stream() ä¸ºé›†åˆåˆ›å»ºä¸²è¡Œæµ</li></ul></li><li>å¹¶è¡Œæµï¼šå¯ä»¥å¤šçº¿ç¨‹æ‰§è¡Œ<ul><li>parallelStream()è·å¾—å¹¶è¡Œæµ</li></ul></li><li>APIï¼š<ul><li>forEach() è¿­ä»£æ¯ä¸ªæ•°æ®</li><li>map()ä¼ å…¥å‡½æ•°ä½œä¸ºå˜é‡ï¼Œå¯¹æ¯ä¸ªæ•°æ®è¿›è¡Œæ˜ å°„(å¤„ç†)</li><li>limit() è·å–æŒ‡å®šæ•°é‡çš„æµ</li><li>sorted() å¯¹æµè¿›è¡Œæ’åº</li><li>Collectors æä¾›å¾ˆå¤šå½’çº¦æ“ä½œï¼Œå¯ä»¥è®²å°†æµè½¬åŒ–ä¸ºé›†åˆæˆ–è€…èšåˆå…ƒç´ ï¼Œè¦é…åˆcollect()æ¥å®ç°</li><li>count()è¿”å›æµçš„çš„æ•°æ®</li><li>distinct() è¿”å›ä¸€ä¸ªå»é™¤é‡å¤å…ƒç´ çš„æµ</li><li>anyMathch() æ£€æŸ¥æ˜¯å¦æœ‰æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ï¼Œè¿”å›å€¼ä¸ºboolean</li><li>allMatch() æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å…ƒç´ éƒ½æ»¡è¶³åŒ¹é…çš„æ¡ä»¶</li><li>noneMathc()éƒ½ä¸ç¬¦åˆåŒ¹é…æ¡ä»¶</li><li>findFirst() è¿”å›æµä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </li><li>findAny()è¿”å›æµä¸­çš„ä»»æ„å…ƒç´ ï¼Œè¿™ä¸ªä»»æ„å…ƒç´ åªæœ‰åœ¨å¤šçº¿ç¨‹ä¸­å¯ä»¥çœ‹å‡ºä¸åŒï¼Œä»–ä¼šä»»ä½•çº¿ç¨‹ä¸­é€‰æ‹©ä¸€ä¸ªå…ƒç´ è¿”å›</li><li>reduce() å°†æµä¸­å…ƒç´ åˆå¹¶æˆä¸€ä¸ªå…ƒç´  <code>numbers.stream().reduce((n1, n2) -&gt; n1 + n2);</code></li><li>filter()è¿‡æ»¤</li></ul></li></ul></li><li>Optionalï¼šç”¨äºé¿å…ç©ºæŒ‡é’ˆ<ul><li>Optional .ofNullable()è¿”å›ä¸€ä¸ªåŒ…å«æŒ‡å®šå€¼Optionalå¯¹è±¡ï¼Œå¦‚æœå€¼ä¸ºnullï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºçš„Optionalå¯¹è±¡</li><li>isPresent() Optionalä¸ä¸ºç©ºï¼Œè¿”å›true</li><li>get()è¿”å›å€¼</li><li>ifPresent() å¦‚æœä¸ä¸ºç©ºï¼Œå¯ä»¥ä»¥è°ƒç”¨æŒ‡å®šçš„æ–¹æ³•</li><li>orElse(é»˜è®¤å€¼) å¦‚æœä¸ºç©ºè¿”å›è¿™ä¸ªé»˜è®¤å€¼ </li><li>orElseGet() å¦‚æœä¸ºç©ºè°ƒç”¨æŒ‡å®šçš„å‡½æ•°</li><li>filter() è¿‡æ»¤ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œè¿”å›ä¸€ä¸ªç©ºçš„Optional</li><li>map() å¦‚æœå¯¹è±¡æ˜¯Optionalï¼Œé‚£ä¹ˆå°±æ‰§è¡Œç»™å®šçš„å‡½æ•°</li><li>flatMap()å°†Optionalå±•å¼€ï¼Œä¸å†åŒ…è£…æˆåµŒå¥—çš„Optional</li></ul></li></ul><h2 id="Java9"><a href="#Java9" class="headerlink" title="Java9"></a>Java9</h2><ul><li>JShell ç±»ä¼¼äºpythonå®æ—¶å‘½ä»¤è¡Œäº¤äº’å·¥å…·</li><li>G1æˆä¸ºé»˜è®¤çš„åƒåœ¾å›æ”¶å™¨</li><li>Stringä½¿ç”¨byte[ ]ä½œä¸ºåº•å±‚ï¼ŒèŠ‚çœç©ºé—´</li></ul><h2 id="Java10"><a href="#Java10" class="headerlink" title="Java10"></a>Java10</h2><ul><li>varå…³é”®å­—å±€éƒ¨å˜é‡ ï¼Œä¸»è¦ä½œç”¨æ˜¯ï¼Œå½“ç±»å‹ç‰¹åˆ«é•¿æ—¶ï¼Œå¯ä»¥ä½¿ç”¨varæ›¿ä»£</li><li>Optionalå¢åŠ äº†orElseThrowæ¥åœ¨æ²¡æœ‰å€¼æ—¶æŠ›å‡ºæŒ‡å®šçš„å¼‚å¸¸</li></ul><h2 id="Java17"><a href="#Java17" class="headerlink" title="Java17"></a>Java17</h2><p>- </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å¤šçº¿ç¨‹</title>
      <link href="/2024/05/13/08/"/>
      <url>/2024/05/13/08/</url>
      
        <content type="html"><![CDATA[<h1 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h1><p>#todo </p><ul><li><input disabled="" type="checkbox"> <a href="https://www.yuque.com/tulingzhouyu/db22bv/gd98aqe6nn6e73qq">é‡‘ä¸‰é“¶å››ç²¾é€‰é¢è¯•é¢˜ç³»åˆ—-å¾åº¶ (yuque.com)</a>ä¸“é—¨å†™ä¸€ä¸ªçº¿ç¨‹æ± ç›¸å…³çš„æ–‡ç« </li><li><input disabled="" type="checkbox"> æ³›å‹ç›¸å…³çš„<a href="https://www.yuque.com/tulingzhouyu/db22bv/avpxs3qirk1w4qod">ğŸ‘ 2024é‡‘ä¸‰é“¶å››100é“é¢è¯•é¢˜ç¬”è®°èµ„æ–™ (yuque.com)</a></li></ul><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><ol><li>CAS (Compare-And-Swapï¼Œæ¯”è¾ƒå¹¶äº¤æ¢)ï¼Œæ˜¯ä¸€ç§ç”¨äºå®ç°å¤šçº¿ç¨‹åŒæ­¥çš„åŸå­æ“ä½œã€‚ä¸»è¦åŸç†ï¼š1.æ¯”è¾ƒå†…å­˜ä¸­çš„æŸä¸ªä½ç½®çš„å½“å‰å€¼å’Œé¢„æœŸå€¼ 2.äº¤æ¢å¦‚æœå½“å‰å€¼ä¸é¢„æœŸå€¼ç›¸ç­‰ï¼Œåˆ™å°†è¯¥ä½ç½®çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ï¼Œå¦åˆ™ä¸è¿›è¡Œä»»ä½•æ“ä½œã€‚<ul><li>å› ä¸ºæ˜¯åŸå­æ“ä½œæ‰€ä»¥åœ¨å¤šçº¿ç¨‹ä¸­å¾ˆé«˜æ•ˆã€‚å¯ä»¥å®ç°æ— é”ç¼–ç¨‹ï¼Œé¿å…äº†ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚</li><li>ç¼ºç‚¹æ˜¯å¦‚æœCASæ“ä½œå¤±è´¥åï¼Œé€šå¸¸ä¼šè¿›è¡Œè‡ªæ—‹ï¼Œæ¶ˆè€—CPUèµ„æºã€‚</li></ul></li><li>è‡ªæ—‹ï¼šå½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–é”ä½†æ˜¯æ‰€ä»¥ç»è¢«å…¶ä»–çº¿ç¨‹è·å–æ—¶ï¼Œè¯¥çº¿ç¨‹ä¸ä¼šè¿›å…¥ç¡çœ æ¨¡å¼ï¼Œè€Œæ˜¯ä¼šåœ¨ä¸€ä¸ªå¾ªç¯ä¸­ä¸æ–­çš„æ£€æŸ¥é”çš„çŠ¶æ€ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ï¼Œè¿™ç§æ–¹å¼å«åšè‡ªæ—‹ã€‚<ul><li>ä¼˜ç‚¹æ˜¯ï¼šä½å¼€é”€ï¼Œå¯ä»¥é¿å…çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼Œå› ä¸ºçº¿ç¨‹ä¸ä¼šè¿›å…¥ç¡çœ çŠ¶æ€ã€‚é€‚ç”¨äºçŸ­æ—¶é—´çš„é”å®šï¼Œå› ä¸ºæ—¶é—´æ®µï¼Œè‡ªæ—‹ç­‰å¾…çš„å¼€é”€å¯èƒ½æ¯”çº¿ç¨‹åˆ‡æ¢å¼€é”€æ›´ä½ã€‚</li><li>ç¼ºç‚¹æ˜¯ï¼šCPUæ¶ˆè€—æï¼Œè‡ªæ—‹ä¸æ–­ç­‰å¾…å ç”¨CPUï¼Œä¹Ÿä¸é€‚åˆé•¿æ—¶é—´é”å®šï¼Œå› ä¸ºçº¿ç¨‹ä¼šé•¿æ—¶é—´å ç”¨CPUèµ„æºè¿›è¡Œæ— æ•ˆçš„æ£€æŸ¥ã€‚</li></ul></li><li>å¹¶å‘ï¼šä¸€æ®µæ—¶é—´å†…è¿›è¡Œ  å¹¶è¡Œï¼šåŒä¸€æ—¶åˆ»åŒæ—¶è¿›è¡Œ</li></ol><h2 id="åŸå­æ“ä½œ"><a href="#åŸå­æ“ä½œ" class="headerlink" title="åŸå­æ“ä½œ"></a>åŸå­æ“ä½œ</h2><p><img src="/2024/05/13/08/CPU%E6%A6%82%E5%BF%B5.png"></p><h3 id="å¤„ç†å™¨å¦‚ä½•å®ç°åŸå­æ“ä½œçš„"><a href="#å¤„ç†å™¨å¦‚ä½•å®ç°åŸå­æ“ä½œçš„" class="headerlink" title="å¤„ç†å™¨å¦‚ä½•å®ç°åŸå­æ“ä½œçš„"></a>å¤„ç†å™¨å¦‚ä½•å®ç°åŸå­æ“ä½œçš„</h3><ol><li>ä½¿ç”¨æ€»çº¿é”æ¥ä¿è¯åŸå­æ€§ï¼šå¦‚æœå¤šä¸ªå¤„ç†å™¨åŒæ—¶å¯¹å…±äº«å˜é‡è¿›è¡Œè¯»æ”¹å†™æ“ä½œ(ä¾‹å¦‚i++)ï¼Œå…±äº«ä¼šè¢«å¤šä¸ªå¤„ç†å™¨åŒæ—¶è¿›è¡Œæ“ä½œï¼Œå¯¼è‡´å…±äº«å˜é‡çš„å€¼ä¸æœŸæœ›ä¸åŒã€‚<img src="/2024/05/13/08/i++.png">å› ä¸ºä»–ä»¬ä¼šä»è‡ªå·±çš„ç¼“å­˜ä¸­è¯»å–å˜é‡iï¼Œç„¶ååˆ†åˆ«è¿›è¡Œ+1ï¼Œä¹‹ååˆ†åˆ«å†™å…¥ç³»ç»Ÿå†…å­˜ä¸­<ul><li>å¤„ç†å™¨æ€»çº¿é”ï¼šä½¿ç”¨äº†å¤„ç†å™¨æä¾›çš„LOCK#ä¿¡å·ï¼Œå½“ä¸€ä¸ªå¤„ç†å™¨åœ¨æ€»çº¿ä¸Šå‘å‡ºè¿™ä¸ªä¿¡å·ï¼Œå…¶ä»–å¤„ç†å™¨çš„è¯·æ±‚å°†è¢«é˜»å¡ä½ã€‚ä»è€Œå®ç°ç‹¬å å…±äº«å†…å­˜ã€‚</li></ul></li><li>ä½¿ç”¨ç¼“å­˜é”ï¼šæ€»çº¿é”ä¼šå¯¼è‡´å…¶ä»–å¤„ç†å™¨ä¸èƒ½å¤„ç†å…¶ä»–å†…å­˜åœ°å€çš„æ•°æ®ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿è¯å¯¹æŸä¸ªå†…å­˜åœ°å€çš„æ“ä½œæ˜¯åŸå­çš„å°±è¡Œã€‚<ul><li>é¢‘ç¹ä½¿ç”¨çš„å†…å­˜ä¼šç¼“å­˜åœ¨å¤„ç†å™¨çš„L1ã€L2ã€L3é«˜é€Ÿç¼“å­˜ä¸­ã€‚</li><li>ç¼“å­˜é”å®šï¼šç¼“å­˜é”å®šæ˜¯æŸä¸ªCPUå¯¹ç¼“å­˜æ•°æ®è¿›è¡Œæ›´æ”¹æ—¶ï¼Œä¼šé€šçŸ¥ç¼“å­˜äº†è¯¥æ•°æ®çš„è¯¥æ•°æ®çš„CPUæŠ›å¼ƒç¼“å­˜çš„æ•°æ®æˆ–è€…ä»å†…å­˜é‡æ–°è¯»å–ã€‚</li></ul></li></ol><h2 id="å¤šçº¿ç¨‹å°±ä¸€å®šå¿«å—ï¼Ÿ"><a href="#å¤šçº¿ç¨‹å°±ä¸€å®šå¿«å—ï¼Ÿ" class="headerlink" title="å¤šçº¿ç¨‹å°±ä¸€å®šå¿«å—ï¼Ÿ"></a>å¤šçº¿ç¨‹å°±ä¸€å®šå¿«å—ï¼Ÿ</h2><p>ä¸ä¸€å®šï¼Œå› ä¸ºçº¿ç¨‹åˆ‡æ¢æ¶‰åŠåˆ°ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œçº¿ç¨‹åˆ›å»ºçš„å¼€é”€</p><h2 id="å¦‚ä½•å‡å°‘ä¸Šä¸‹æ–‡çš„åˆ‡æ¢æ¬¡æ•°"><a href="#å¦‚ä½•å‡å°‘ä¸Šä¸‹æ–‡çš„åˆ‡æ¢æ¬¡æ•°" class="headerlink" title="å¦‚ä½•å‡å°‘ä¸Šä¸‹æ–‡çš„åˆ‡æ¢æ¬¡æ•°"></a>å¦‚ä½•å‡å°‘ä¸Šä¸‹æ–‡çš„åˆ‡æ¢æ¬¡æ•°</h2><ol><li>æ— é”å¹¶å‘ç¼–ç¨‹ï¼šé¿å…ä½¿ç”¨é”ï¼Œåˆ©ç”¨å°†æ•°æ®çš„IDæŒ‰ç…§Hashç®—æ³•å–æ¨¡è¿ç®—ï¼Œä¸åŒçº¿ç¨‹å¤„ç†ä¸åŒæ®µçš„æ•°æ®</li><li>CASç®—æ³•ï¼šä¸éœ€è¦åŠ é”</li><li>ä½¿ç”¨æœ€å°‘çº¿ç¨‹ï¼šé¿å…åˆ›å»ºä¸éœ€è¦çš„çº¿ç¨‹</li><li>åç¨‹ï¼šå•çº¿ç¨‹ä¸­å®ç°å¤šä»»åŠ¡çš„è°ƒåº¦ï¼Œå¹¶ä¸”å†å•çº¿ç¨‹ä¸­ç»´æŒå¤šä¸ªä»»åŠ¡é—´çš„åˆ‡</li></ol><h2 id="èµ„æºé™åˆ¶"><a href="#èµ„æºé™åˆ¶" class="headerlink" title="èµ„æºé™åˆ¶"></a>èµ„æºé™åˆ¶</h2><p>å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œå¦‚æœå¤šçº¿ç¨‹å ç”¨çš„èµ„æºè¶…è¿‡ç³»ç»Ÿèµ„æºçš„é™åˆ¶ï¼Œå®é™…ä¸Šä»ç„¶æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼Œè€Œä¸”å› ä¸ºæœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å½±å“ï¼Œåè€Œä¼šæ›´æ…¢</p><h2 id="å¦‚ä½•é¿å…æ­»é”"><a href="#å¦‚ä½•é¿å…æ­»é”" class="headerlink" title="å¦‚ä½•é¿å…æ­»é”"></a>å¦‚ä½•é¿å…æ­»é”</h2><ol><li>é¿å…ä¸€ä¸ªçº¿ç¨‹åŒæ—¶è·å¾—å¤šä¸ªé”</li><li>é¿å…ä¸€ä¸ªçº¿ç¨‹åœ¨é”å†…åŒäº‹å ç”¨å¤šä¸ªèµ„æºï¼Œå°½é‡ä¿è¯æ¯ä¸ªé”åªå ç”¨ä¸€ä¸ªèµ„æº</li><li>å°è¯•ä½¿ç”¨å®šæ—¶é” <code>lock.tryLock(timeout)</code>æ¥æ›¿ä»£å†…éƒ¨é”æœºåˆ¶</li><li>å¯¹äºæ•°æ®åº“é”ï¼Œæ·é”å’Œè§£é”å¿…é¡»åœ¨ä¸€ä¸ªæ•°æ®åº“è¿æ¥é‡Œï¼Œå¦åˆ™ä¼šå‡ºç°è§£é”å¤±è´¥çš„æƒ…å†µ</li></ol><h2 id="å¸¸ç”¨çš„çº¿ç¨‹åˆ†æå·¥å…·"><a href="#å¸¸ç”¨çš„çº¿ç¨‹åˆ†æå·¥å…·" class="headerlink" title="å¸¸ç”¨çš„çº¿ç¨‹åˆ†æå·¥å…·"></a>å¸¸ç”¨çš„çº¿ç¨‹åˆ†æå·¥å…·</h2><h3 id="vmstat"><a href="#vmstat" class="headerlink" title="vmstat"></a>vmstat</h3><p>å¸¸ç”¨æŒ‡ä»¤ï¼Œå…·ä½“çš„å‚æ•°è‡ªå·±å»æœï¼Œè¿™é‡Œä¸»è¦çœ‹çš„æ˜¯csæŒ‡æ ‡ï¼Œä»£è¡¨æ¯ç§’ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">vmstat [delay] [count] åé¢å‚æ•°å¯é€‰æ¯éš”delayç§’è¾“å‡ºä¸€æ¬¡ç»Ÿè®¡ä¿¡æ¯ï¼Œæ€»å…±è¾“å‡ºcountæ¬¡vmstat -s æ˜¾ç¤ºç³»ç»Ÿçš„ç´¯è®¡ç»Ÿè®¡ä¿¡æ¯   -d æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯   -p +æŒ‡å®šåˆ†åŒº æ˜¾ç¤ºæŒ‡å®šåˆ†åŒºçš„ç»Ÿè®¡ä¿¡æ¯   -a æ˜¾ç¤ºæ´»åŠ¨å†…å­˜å’Œéæ´»åŠ¨å†…å­˜çš„ä¿¡æ¯   -m æ˜¾ç¤ºslabinfoä¿¡æ¯<span class="token punctuation">(</span>`slabinfo` æ˜¯ Linux å†…æ ¸ä¸­ç”¨äºæ˜¾ç¤º slab åˆ†é…å™¨ï¼ˆslab allocatorï¼‰ä¿¡æ¯çš„å·¥å…·<span class="token punctuation">)</span>   -t åœ¨è¾“å‡ºä¸­æ·»åŠ æ—¶é—´æˆ³<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Javaä¸­çš„å¤šçº¿ç¨‹"><a href="#Javaä¸­çš„å¤šçº¿ç¨‹" class="headerlink" title="Javaä¸­çš„å¤šçº¿ç¨‹"></a>Javaä¸­çš„å¤šçº¿ç¨‹</h2><p>å½“åœ¨ä¸€ä¸ªJVMè¿›ç¨‹é‡Œé¢å¼€å¤šä¸ªçº¿ç¨‹æ—¶ï¼Œè¿™äº›çº¿ç¨‹è¢«åˆ†æˆä¸¤ç±»ï¼šå®ˆæŠ¤çº¿ç¨‹å’Œéå®ˆæŠ¤çº¿ç¨‹ã€‚é»˜è®¤å¼€çš„éƒ½æ˜¯éå®ˆæŠ¤çº¿ç¨‹ã€‚åœ¨Javaä¸­æœ‰ä¸€ä¸ªè§„å®šï¼šå½“æ‰€æœ‰çš„éå®ˆæŠ¤çº¿ç¨‹é€€å‡ºåï¼Œæ•´ä¸ªJVMè¿›ç¨‹å°±ä¼šé€€å‡ºã€‚æ„æ€å°±æ˜¯å®ˆæŠ¤çº¿ç¨‹â€œä¸ç®—ä½œæ•°â€ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¸å½±å“æ•´ä¸ª JVM è¿›ç¨‹çš„é€€å‡ºã€‚ä¾‹å¦‚ï¼Œåƒåœ¾å›æ”¶çº¿ç¨‹å°±æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œå®ƒä»¬åœ¨åå°é»˜é»˜å·¥ä½œï¼Œå½“å¼€å‘è€…çš„æ‰€æœ‰å‰å°çº¿ç¨‹ï¼ˆéå®ˆæŠ¤çº¿ç¨‹ï¼‰éƒ½é€€å‡ºä¹‹åï¼Œæ•´ä¸ªJVMè¿›ç¨‹å°±é€€å‡ºäº†ã€‚</p><h2 id="Waitæ–¹æ³•ä¸ºä»€ä¹ˆä¸å®šä¹‰åœ¨Threadä¸­ï¼Ÿ"><a href="#Waitæ–¹æ³•ä¸ºä»€ä¹ˆä¸å®šä¹‰åœ¨Threadä¸­ï¼Ÿ" class="headerlink" title="Waitæ–¹æ³•ä¸ºä»€ä¹ˆä¸å®šä¹‰åœ¨Threadä¸­ï¼Ÿ"></a>Waitæ–¹æ³•ä¸ºä»€ä¹ˆä¸å®šä¹‰åœ¨Threadä¸­ï¼Ÿ</h2><p>Waité‡Šæ”¾çš„é”æ˜¯å†™åœ¨Javaå¯¹è±¡å¤´ä¸­ï¼Œæ‰€ä»¥æ˜¯å†™åœ¨Objectä¸­è€Œéå½“å‰çº¿ç¨‹</p><h3 id="é”çš„åˆ†ç±»å’Œå¯¹æ¯”"><a href="#é”çš„åˆ†ç±»å’Œå¯¹æ¯”" class="headerlink" title="é”çš„åˆ†ç±»å’Œå¯¹æ¯”"></a>é”çš„åˆ†ç±»å’Œå¯¹æ¯”</h3><p>Javaä¸­é”å­˜åœ¨å››ç§çŠ¶æ€</p><ol><li>æ— é”çŠ¶æ€</li><li>åå‘é”çŠ¶æ€</li><li>è½»é‡çº§é”çŠ¶æ€</li><li>é‡é‡çº§é”çŠ¶æ€<br>é”å¯ä»¥å‡çº§ä½†æ˜¯ä¸èƒ½é™çº§ï¼Œè¿™ç§è®¾å®šèƒ½å¤Ÿæé«˜è·å¾—é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡<br><img src="/2024/05/13/08/%E9%94%81%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9.png"></li></ol><h4 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="åå‘é”"></a>åå‘é”</h4><p>å¤§å¤šæ•°æƒ…å†µä¸‹é”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒæ„çº¿ç¨‹å¤šæ¬¡è·å¾—ã€‚<br>å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—å¹¶ä¸”è·å¾—é”æ—¶ï¼Œä¼šåœ¨å¯¹è±¡å¤´å’Œæ ˆå¸§ä¸­çš„é”è®°å½•é‡Œé¢å­˜é”åå‘çš„çº¿ç¨‹IDï¼Œä»¥åè¯¥çº¿ç¨‹è¿›å…¥/æ¨å‡ºé¢åŒæ­¥å—å—æ—¶ï¼Œä¸éœ€è¦è¿›è¡ŒCASæ¥è¿›è¡Œæ·é”å’Œè§£é”ï¼Œåªéœ€è¦æµ‹è¯•å¯¹è±¡å¤´Mark Wordé‡Œæ˜¯å¦å­˜å‚¨ç€è¿™é¡¹å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚<br>å¦‚æœæµ‹è¯•å¤±è´¥å°±çœ‹åå‘é”çš„æ ‡è¯†æ˜¯å¦ä¸º1ï¼Œ1æ˜¯åå‘é”ï¼Œå¦‚æœä¸æ˜¯å°±ç”¨CASç«äº‰é”ï¼Œå¦åˆ™å°è¯•ä½¿ç”¨CASå°†åå‘é”è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹</p><h5 id="åå‘é”çš„æ’¤é”€"><a href="#åå‘é”çš„æ’¤é”€" class="headerlink" title="åå‘é”çš„æ’¤é”€"></a>åå‘é”çš„æ’¤é”€</h5><ol><li>åå‘é”åªæœ‰å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶æŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ã€‚</li><li>åå‘é”çš„æ’¤é”€ï¼Œéœ€è¦åœ¨å…¨å±€å®‰å…¨ç‚¹(åœ¨è¿™ä¸ªäº‹ä»¶ç”µå•†æ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç )ï¼Œä¼šå…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œç„¶åæ£€æŸ¥æŒæœ‰åå‘é”çš„çº¿ç¨‹æ˜¯å¦æˆ–è€…ï¼Œå¦‚æœçº¿ç¨‹å¤„äºä¸æ´»è·ƒçŠ¶æ€ï¼Œåˆ™å°†å¯¹è±¡å¤´è®¾ç½®æˆæ— é”çŠ¶æ€ï¼›å¦‚æœçº¿ç¨‹ä»ç„¶å­˜æ´»ï¼Œåˆ™æ‹¥æœ‰åå‘é”çš„æ ˆä¼šè¢«æ‰§è¡Œï¼Œä¾¿åˆ©åå‘å¯¹è±¡çš„é”è®°å½•ï¼Œè¦ä¹ˆé‡æ–°åå‘å…¶ä»–çº¿ç¨‹ï¼Œè¦ä¹ˆæ¢å¤åˆ°æ— é”æˆ–è€…æ ‡è®°ç‹¬äº«ä¸é€‚åˆä½œä¸ºåå‘é”ï¼Œæœ€åå”¤é†’æš‚åœçš„çº¿ç¨‹ã€‚</li></ol><h4 id="è½»é‡çº§é”"><a href="#è½»é‡çº§é”" class="headerlink" title="è½»é‡çº§é”"></a>è½»é‡çº§é”</h4><h5 id="åŠ é”"><a href="#åŠ é”" class="headerlink" title="åŠ é”"></a>åŠ é”</h5><blockquote><p>çº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥å—ä¹‹å‰ï¼ŒJVMä¼šåœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­åˆ›å»ºç”¨äºå­˜å‚¨é”è®°å½•çš„ç©ºé—´ï¼Œå¹¶ä¸”å°†å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­(Displaced Mark Wordæ›¿)ã€‚ç„¶åçº¿ç¨‹å°è¯•ä½¿ç”¨CASå°†å¯¹è±¡å¤´ä¸­çš„Mark Wordæ›¿æ¢ä¸ºåªæƒ³æ‰€è®°å½•çš„æŒ‡é’ˆã€‚å¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—é”ï¼Œå¦‚æœå¤±è´¥ï¼Œå°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å¾—é”ã€‚</p></blockquote><h5 id="è§£é”"><a href="#è§£é”" class="headerlink" title="è§£é”"></a>è§£é”</h5><blockquote><p>ä¼šä½¿ç”¨åŸå­çš„CASæ“ä½œå°†Displaced Mark Wordæ›¿æ¢å›å¯¹è±¡å¤´ã€‚å¦‚æœæˆåŠŸåˆ™è¯´æ˜æ²¡æœ‰ç«äº‰å‘ç”Ÿï¼Œå¦‚æœå¤±è´¥ï¼Œæ ‡è¯†å½“å‰é”å­˜åœ¨ç«äº‰ã€‚é”ä¼šå‡çº§æˆé‡é‡çº§é”ã€‚</p></blockquote><h3 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h3><p>volatileæ˜¯è½»é‡çº§çš„synchronizedï¼Œä¿è¯äº†å…±äº«å˜é‡çš„å¯è§æ€§ï¼ŒåŒæ—¶ä¸ä¼šå¼•èµ·ä¸Šä¸‹æ–‡çš„åˆ‡æ¢å’Œè°ƒåº¦ã€‚<br>ä½†æ˜¯i++ä¸èƒ½ä¿è¯åŸå­æ€§çš„ï¼Œå› ä¸ºi++æ˜¯è¯»å†™ä¸¤æ¬¡æ“ä½œã€‚<br>JVMä¸­å¹¶æ²¡æœ‰è¦æ±‚64ä½long/doubleå†™å…¥æ˜¯åŸå­çš„ã€‚æ‰€ä»¥å¤šçº¿ç¨‹è¯»å–æ—¶åˆå¯ä»¥è¯»åˆ°çš„æ˜¯â€ä¸€åŠâ€çš„å€¼ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨volatileäº†</p><h4 id="ä¸»è¦åŠŸèƒ½"><a href="#ä¸»è¦åŠŸèƒ½" class="headerlink" title="ä¸»è¦åŠŸèƒ½"></a>ä¸»è¦åŠŸèƒ½</h4><ol><li>ä¿è¯å•è¯å†™å…¥/è¯»å…¥åŸå­æ€§</li><li>å†…å­˜å¯è§æ€§</li><li>ç¦æ­¢é‡æ’åº</li></ol><h4 id="å‰ç½®æ¦‚å¿µ"><a href="#å‰ç½®æ¦‚å¿µ" class="headerlink" title="å‰ç½®æ¦‚å¿µ"></a>å‰ç½®æ¦‚å¿µ</h4><p><img src="/2024/05/13/08/%E5%89%8D%E7%BD%AE%E6%A6%82%E5%BF%B5.png"></p><h4 id="volatileæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"><a href="#volatileæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ" class="headerlink" title="volatileæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"></a>volatileæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h4><ol><li>è½¬å˜æˆæ±‡ç¼–è¯­è¨€ä¹‹åä¼šå¤šä¸€ä¸ªLockå‰ç¼€ï¼Œè¿™ä¸ªå‰ç¼€ä¼šå°†å½“å‰å¤„ç†å™¨ç¼“å­˜è¡Œçš„æ•°æ®å†™å›ç³»ç»Ÿå†…å­˜ï¼ŒåŒæ—¶å…¶ä»–CPUä¸­ç¼“å­˜äº†è¯¥å†…å­˜åœ°å€çš„æ•°æ®æ— æ•ˆã€‚ä¿®æ”¹volatileå˜é‡ä¼šå¼ºåˆ¶å°†ä¿®æ”¹ä¹‹åçš„å€¼åˆ·æ–°åˆ°å†…å­˜ä¸­åŒæ—¶å¯¼è‡´å…¶ä»–çº¿ç¨‹ä¸­çš„è¯¥å˜é‡å€¼å¤±æ•ˆã€‚</li><li>å¤„ç†å™¨ä¼šæ ¹æ®MESI(ä¿®æ”¹ã€ç‹¬å ã€å…±äº«ã€æ— æ•ˆ)æ§åˆ¶åè®®å»ç»´æŠ¤å†…éƒ¨ç¼“å­˜ã€‚å¤„ç†å™¨ä½¿ç”¨å—…æ¢æŠ€æœ¯ä¿è¯å®ƒçš„å†…éƒ¨ç¼“å­˜ã€ç³»ç»Ÿå†…å­˜å’Œå…¶ä»–å¤„ç†å™¨çš„ç¼“å­˜çš„æ•°æ®åœ¨æ€»çº¿ä¸Šä¿æŒä¸€è‡´ã€‚</li></ol><p>å¯è§æ€§ï¼š<br>ä¿®æ”¹volatileå˜é‡ä¼šå¼ºåˆ¶å°†ä¿®æ”¹ä¹‹åçš„å€¼åˆ·æ–°åˆ°å†…å­˜ä¸­<br>åŒæ—¶å¯¼è‡´å…¶ä»–çº¿ç¨‹ä¸­çš„è¯¥å˜é‡å€¼å¤±æ•ˆã€‚<br>æœ‰åºæ€§ï¼šéµå¾ªhappen-before<br>å†…å­˜å±éšœï¼šJVMé€šè¿‡å†…å­˜å±éšœæ¥å®ç°çš„</p><h4 id="å†…å­˜å±éšœ"><a href="#å†…å­˜å±éšœ" class="headerlink" title="å†…å­˜å±éšœ"></a>å†…å­˜å±éšœ</h4><p>CPUé˜²æ­¢ä»£ç è¿›è¡Œé‡æ’åºè€Œæä¾›çš„æŒ‡ä»¤ã€‚<br>Unsafeæä¾›äº†ä»¥ä¸‹çš„å†…å­˜å±éšœæ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å†…å­˜å±éšœï¼Œç¦æ­¢loadæ“ä½œé‡æ’åºã€‚å±éšœå‰çš„loadæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœåï¼Œå±éšœåçš„loadæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœå‰</span><span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">loadFence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å†…å­˜å±éšœï¼Œç¦æ­¢storeæ“ä½œé‡æ’åºã€‚å±éšœå‰çš„storeæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœåï¼Œå±éšœåçš„storeæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœå‰</span><span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">storeFence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å†…å­˜å±éšœï¼Œç¦æ­¢loadã€storeæ“ä½œé‡æ’åº</span><span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">fullFence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é‡æ’åºé—®é¢˜"><a href="#é‡æ’åºé—®é¢˜" class="headerlink" title="é‡æ’åºé—®é¢˜"></a>é‡æ’åºé—®é¢˜</h4><blockquote><p>æ‰§è¡Œç¨‹åºæ—¶ï¼Œä¸ºäº†æé«˜æ€§èƒ½ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æ‰§è¡Œè¿›è¡Œé‡æ’åºã€‚</p><ol><li>ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æ’åºï¼šä¸æ”¹å˜å•çº¿ç¨‹è¯­ä¹‰çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é‡æ–°å®‰æ’è¯­å¥çš„æ‰§è¡Œé¡ºåº</li><li>æŒ‡ä»¤çº§å¹¶è¡Œçš„é‡æ’åºï¼šç°ä»£å¤„ç†å™¨é‡‡ç”¨äº†æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯æ¥è®²å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œã€‚å¦‚æœä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜è¯­å¥å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚</li><li>å†…å­˜ç³»ç»Ÿçš„é‡æ’åºï¼šç”±äºå¤„ç†å™¨ä½¿ç”¨ç¼“å­˜å’Œè¯»/å†™ç¼“å†²åŒºï¼Œæ˜¯çš„åŠ è½½å’Œå­˜å‚¨æ“ä½œçœ‹ä¸Šå»å¯èƒ½æ—¶å†ä¹±åºæ‰§è¡Œ</li></ol></blockquote><p><img src="/2024/05/13/08/%E9%87%8D%E6%8E%92%E5%BA%8F.png"></p><h5 id="as-if-serial"><a href="#as-if-serial" class="headerlink" title="as-if-serial"></a>as-if-serial</h5><p>å¤šçº¿ç¨‹ç¨‹åºä¸­çš„é‡æ’åºï¼Œç¼–è¯‘å™¨å’ŒCPUåªèƒ½ä¿è¯æ¯ä¸ªçº¿ç¨‹çš„çº¿ç¨‹å†…éƒ¨ä¹‹é—´éƒ½æ˜¯â€œçœ‹ä¼¼å®Œå…¨ä¸²è¡Œçš„â€ï¼Œä½†æ˜¯å¤šä¸ªçº¿ç¨‹ä¼šç›¸äº’è¯»å–å’Œå†™å…¥å…±äº«çš„å˜é‡ä¸ä¼šè¿›è¡Œè€ƒè™‘ã€‚</p><h5 id="happen-before"><a href="#happen-before" class="headerlink" title="happen-before"></a>happen-before</h5><p>ä¿è¯ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œç»“æœå¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚</p><h3 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h3><h4 id="æ˜¯å¯é‡å…¥çš„å—"><a href="#æ˜¯å¯é‡å…¥çš„å—" class="headerlink" title="æ˜¯å¯é‡å…¥çš„å—"></a>æ˜¯å¯é‡å…¥çš„å—</h4><blockquote><p>å¯é‡å…¥ï¼ˆReentrantï¼‰æ˜¯æŒ‡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªå‡½æ•°å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨è€Œä¸ä¼šå¼•èµ·ä»»ä½•é—®é¢˜ã€‚</p></blockquote><p>æ˜¯å¯é‡å…¥çš„ï¼Œå› ä¸ºsynchronizedå…³é”®å­—æ˜¯åŸºäºJVMå†…éƒ¨çš„ç›‘è§†å™¨é”ï¼Œè¿™ç§é”æ˜¯ä¾èµ–äºå¯¹è±¡å¤´ä¸­çš„æ ‡è®°å­—æ®µæ¥ç®¡ç†é”çš„çŠ¶æ€ã€‚<br>å½“çº¿ç¨‹ç¬¬ä¸€æ¬¡è·å¾—é”æ—¶ï¼Œä»–çš„çº¿ç¨‹IDä¼šè¢«è®°å½•åœ¨å¯¹è±¡å¤´çš„æ ‡è®°å­—æ®µä¸­ï¼Œå¹¶ä¸”è®¡æ•°å™¨è®¾ç½®ä¸º1ï¼Œå¦‚æœåŒä¸€çº¿ç¨‹éœ€è¦å†æ¬¡è¿›å…¥ç”±è‡ªå·±æŒæœ‰é”çš„synchronizedå—æ—¶ï¼Œè®¡æ•°å™¨å°±ä¼š+1ï¼Œå½“synchronizedå—æ—¶ï¼Œè®¡æ•°å™¨-1ã€‚å½“è®¡æ•°å™¨å›åˆ°0æ—¶ï¼Œé”æ‰çœŸæ­£è¢«é‡Šæ”¾ï¼Œæ­¤æ—¶å…¶ä»–çº¿ç¨‹å¯ä»¥å°è¯•è·å–è¿™ä¸ªé”ã€‚</p><h4 id="synchronizedå¯ä»¥é”çš„ç±»å‹"><a href="#synchronizedå¯ä»¥é”çš„ç±»å‹" class="headerlink" title="synchronizedå¯ä»¥é”çš„ç±»å‹"></a>synchronizedå¯ä»¥é”çš„ç±»å‹</h4><ol><li>å¯¹äºæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”çš„æ˜¯å®ä¾‹å¯¹è±¡</li><li>å¯¹äºé™æ€åŒæ­¥æ–¹æ³•ï¼Œé”çš„æ˜¯å½“å‰ç±»çš„Classå¯¹è±¡ï¼ŒåŒ…æ‹¬è¿™ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡</li><li>å¯¹äºåŒæ­¥æ–¹æ³•å—ï¼Œé”çš„æ˜¯Synchornizedæ‹¬å·é‡Œçš„å¯¹è±¡</li></ol><h4 id="å®ç°å’ŒåŸç†"><a href="#å®ç°å’ŒåŸç†" class="headerlink" title="å®ç°å’ŒåŸç†"></a>å®ç°å’ŒåŸç†</h4><ol><li>synchronizedç”¨çš„é”æ˜¯å­˜åœ¨Javaå¯¹è±¡å¤´é‡Œçš„ï¼Œå¦‚æœå¯¹è±¡æ˜¯æ•°ç»„ç±»å‹ï¼Œåˆ™è™šæ‹Ÿæœºç”¨ä¸‰ä¸ªå­—å®½å­˜å‚¨å¯¹è±¡å¤´ã€‚<img src="/2024/05/13/08/Java%E5%AF%B9%E8%B1%A1%E5%A4%B4.png"></li><li>å¯¹è±¡å¤´ä¼šéšç€é”æ ‡å¿—ä½çš„å˜åŒ–è€Œå˜åŒ– <img src="/2024/05/13/08/%E5%AF%B9%E8%B1%A1%E5%A4%B4%E4%BC%9A%E9%9A%8F%E7%9D%80%E9%94%81%E6%A0%87%E5%BF%97%E4%BD%8D%E7%9A%84%E5%8F%98%E5%8C%96%E8%80%8C%E5%8F%98%E5%8C%96.png" alt="å¯¹è±¡å¤´ä¼šéšç€é”æ ‡å¿—ä½çš„å˜åŒ–è€Œå˜åŒ–"></li></ol><h3 id="Javaå†…å­˜æ¨¡å‹çš„åŸºç¡€"><a href="#Javaå†…å­˜æ¨¡å‹çš„åŸºç¡€" class="headerlink" title="Javaå†…å­˜æ¨¡å‹çš„åŸºç¡€"></a>Javaå†…å­˜æ¨¡å‹çš„åŸºç¡€</h3><p>å¹¶å‘ç¼–ç¨‹ä¸­å¸¸å¸¸éœ€è¦è§£å†³çº¿ç¨‹ä¹‹é—´å¦‚ä½•è¿›è¡Œé€šä¿¡å’Œå¦‚ä½•è¿›è¡ŒåŒæ­¥ã€‚<br>åœ¨å‘½ä»¤å¼ç¼–ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æœºåˆ¶æœ‰ä¸¤ç§ï¼šå…±äº«å†…å­˜å’Œæ¶ˆæ¯ä¼ é€’ã€‚</p><blockquote><p>å…±äº«å†…å­˜æ˜¯çº¿ç¨‹å…±äº«ç¨‹åºçš„å…¬å…±çŠ¶æ€ï¼Œé€šè¿‡è¯»å†™å†…å­˜çš„å…¬å…±çŠ¶æ€æ¥è¿›è¡Œé€šä¿¡ã€‚æ¶ˆæ¯ä¼ é€’åˆ™æ˜¯çº¿ç¨‹ä¹‹é—´å¿…é¡»é€šè¿‡å‘é€æ¶ˆæ¯æ¥æ˜¾ç¤ºçš„è¿›è¡Œé€šä¿¡ã€‚</p></blockquote><p>Javaä¸­ä½¿ç”¨çš„æ˜¯å…±äº«å†…å­˜æ¨¡å‹ã€‚<img src="/2024/05/13/08/Java%E7%BA%BF%E7%A8%8B%E5%86%85%E5%AD%98%E5%85%B1%E4%BA%AB.png"><br>ä»–ä»¬ä¹‹é—´çš„é€šä¿¡éœ€è¦ä¿®æ”¹å…±äº«å˜é‡ï¼Œç„¶åç”±å¦ä¸€ä¸ªå»è¯»å–å…±äº«å˜é‡æ¥å®ç°ã€‚<br>JDK5 å¼€å§‹ï¼ŒJavaä½¿ç”¨JSP-133å†…å­˜æ¨¡å‹ï¼Œä½¿ç”¨happens-beforeï¼šå‰ä¸€ä¸ªæ“ä½œçš„ç»“æœå¯¹åä¸€ä¸ªæ“ä½œå¯è§ </p><h3 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h3><h4 id="ä»€ä¹ˆæ˜¯CountDownLatchï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯CountDownLatchï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯CountDownLatchï¼Ÿ"></a>ä»€ä¹ˆæ˜¯CountDownLatchï¼Ÿ</h4><p>CountDownLatch æ˜¯é€šè¿‡ä¸€ä¸ªè®¡æ•°å™¨æ¥å®ç°çš„ï¼Œè®¡æ•°å™¨çš„åˆå§‹å€¼å°±æ˜¯çº¿ç¨‹çš„æ•°é‡ï¼Œæ¯å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œè®¡æ•°å™¨çš„å€¼å°±-1ï¼Œç„¶ååœ¨é—­é”ä¸Šç­‰å¾…çš„çº¿ç¨‹å°±å¯ä»¥æ¢å¤å·¥ä½œäº†ã€‚<br>ä¸»è¦ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>ç”¨äºç­‰å¾…å¤šä¸ªçº¿ç¨‹å®Œæˆä¸€ä¸ªæ•´ä½“çš„å‰æä»»åŠ¡<br>å®ä¾‹ï¼šåœ¨è¿›è¡Œä¸šåŠ¡ä¹‹å‰å°†ä¸¤ä¸ªæ•°æ®åº“ä¸­çš„æ•°æ®è¿›è¡ŒåŒæ­¥(éé›†ç¾¤çš„æ•°æ®åº“)<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DatabaseSync</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">syncDatabase1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// è¿™é‡Œæ˜¯åŒæ­¥æ•°æ®åº“1çš„ä»£ç </span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">syncDatabase2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// è¿™é‡Œæ˜¯åŒæ­¥æ•°æ®åº“2çš„ä»£ç </span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>        <span class="token class-name">CountDownLatch</span> latch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token function">syncDatabase1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            latch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token function">syncDatabase2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            latch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç­‰å¾…ä¸¤ä¸ªæ•°æ®åº“åŒæ­¥æ“ä½œå®Œæˆ</span>        latch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Both databases have been synchronized."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>        <span class="token keyword">new</span> <span class="token class-name">DatabaseSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="JUCåŒ…"><a href="#JUCåŒ…" class="headerlink" title="JUCåŒ…"></a>JUCåŒ…</h3><h4 id="CompletableFuture"><a href="#CompletableFuture" class="headerlink" title="CompletableFuture"></a>CompletableFuture</h4><p>Futureçš„ç¼ºç‚¹ï¼šä¸æ”¯æŒå¼‚æ­¥ä»»åŠ¡çš„ç¼–æ’ï¼ŒåŒæ—¶getæ–¹æ³•æ˜¯é˜»å¡è°ƒç”¨<br>å®Œå…¨å¯æ§çš„Fututure<br>ä½¿â½¤çº¿ç¨‹æ± æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡é¿å…å°†è€—æ—¶ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ä¸­æ‰§â¾ã€‚å¯¹äºâ¼€äº›â½è¾ƒè€—æ—¶çš„æ“ä½œï¼Œå¦‚<br>â½¹ç»œè¯·æ±‚ã€â½‚ä»¶è¯»å†™ç­‰ï¼Œå¯ä»¥é‡‡â½¤ CompletableFuture ç­‰å…¶ä»–å¼‚æ­¥æ“ä½œçš„â½…å¼æ¥å¤„ç†ï¼Œä»¥é¿<br>å…é˜»å¡çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹<br>ç¤ºä¾‹ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> adminClient<span class="token punctuation">.</span><span class="token function">distributedInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="CompletableFutureæºç åˆ†æ"><a href="#CompletableFutureæºç åˆ†æ" class="headerlink" title="CompletableFutureæºç åˆ†æ"></a>CompletableFutureæºç åˆ†æ</h4><ul><li>runAsyncä¸å…è®¸è¿”å›å€¼ï¼Œé€‚åˆéœ€è¦ä¸€æ­¥æ“ä½œä½†æ˜¯ä¸å…³å¿ƒè¿”å›ç»“æœ </li><li>supplyAsyncéœ€è¦è¿”å›å€¼ï¼Œé€‚åˆéœ€è¦è¿”å›å€¼çš„å¼‚æ­¥æ“ä½œ</li><li>thenApplyã€thenAcceptã€thenRunã€whenComplete å¯ä»¥å¯¹ç»“æœè¿›è¡Œè¿›ä¸€æ­¥å¤„ç†</li><li>å¼‚å¸¸å¤„ç†ä½¿ç”¨handle</li><li>åˆå¹¶futureç»“æœï¼ŒthenComposeæ˜¯é“¾æ¥ä¸¤ä¸ªCompletabelFutureï¼Œå¹¶å°†å‰ä¸€ä¸ªç»“æœä½œä¸ºä¸‹ä¸€ä¸ªä»»åŠ¡å‚æ•°ï¼ŒthenCombineä¼šå°†ä¸¤ä¸ªä»»åŠ¡éƒ½ç»“æŸä¹‹åï¼Œå°†ä¸¤ä¸ªä»»åŠ¡çš„ç»“æœåˆå¹¶ï¼Œå¹¶è¡Œæ‰§è¡Œ</li><li>allOfç­‰å¾…æ‰€æœ‰çš„æ‰§è¡Œå®Œæˆä¹‹åå†è°ƒç”¨<br>é»˜è®¤ä½¿ç”¨çš„æ˜¯ForkJoinPool.commonPoolä½œä¸ºæ‰§è¡Œå™¨ï¼Œè¿™ä¸ªçº¿ç¨‹æ± å…¨å±€å…±äº«ï¼Œå¯èƒ½ä¼šè¢«å…¶ä»–ä»»åŠ¡å ç”¨</li></ul><h4 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h4><p>çº¿ç¨‹å®‰å…¨çš„HashMapï¼Œå¤šçº¿ç¨‹æƒ…å†µä¸‹HashMapè¿›è¡Œputæ“ä½œä¼šè¿›å…¥æ­»å¾ªç¯ã€‚è€Œä½¿ç”¨HashTableæ•ˆç‡åˆå¾ˆä½ï¼Œå› ä¸ºå½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®HashTableçš„åŒæ­¥æ–¹æ³•ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿè®¿é—®æ—¶ï¼Œä¼šè¿›å…¥é˜»å¡æˆ–è½®è¯¢çŠ¶æ€ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½å¿…é¡»ç«äº‰åŒä¸€æŠŠé”ã€‚è€Œæˆ‘ä»¬åªéœ€è¦æœ‰å¤šæŠŠé”ï¼Œæ¯ä¸€æŠŠé”éƒ½åªé”ä½æŸä¸€éƒ¨åˆ†æ•°æ®å³å¯ã€‚è¿™å°±æ˜¯ConcurrentHashMapä½¿ç”¨çš„é”åˆ†æ®µæŠ€æœ¯ã€‚<br>JDK1.7ä½¿ç”¨çš„æ˜¯åˆ†æ®µçš„æ•°æ®+é“¾è¡¨å®ç°çš„ï¼ŒJDK1.8ä½¿ç”¨çš„æ•°æ®ç»“æ„è·ŸHashMapä¸€èŒï¼Œæ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘ã€‚ä½¿ç”¨çš„æ˜¯Nodeæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼Œé€šè¿‡synchronizedå’ŒCASæ“ä½œæ¥å¸®æ­£çº¿ç¨‹å®‰å…¨</p><h4 id="å®ç°åŸç†-å…·ä½“çœ‹æºç "><a href="#å®ç°åŸç†-å…·ä½“çœ‹æºç " class="headerlink" title="å®ç°åŸç† å…·ä½“çœ‹æºç "></a>å®ç°åŸç† å…·ä½“çœ‹æºç </h4><h5 id="1-7"><a href="#1-7" class="headerlink" title="1.7"></a>1.7</h5><p>Segmentæ•°ç»„(ä¸å¯æ‰©å®¹) ä½œä¸ºåˆ†æ®µé”ï¼Œæ˜¯å¯é‡å…¥é”ï¼Œå¯¹å…¶ä¸­çš„ä¸€éƒ¨åˆ†åŠ é”<img src="/2024/05/13/08/JDK1.67%E5%AE%9E%E7%8E%B0.png"></p><h4 id="1-8"><a href="#1-8" class="headerlink" title="1.8"></a>1.8</h4><p>ä½¿ç”¨çš„æ˜¯Nodeæ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘ï¼ŒNodeåªé€‚ç”¨äºé“¾è¡¨çš„æƒ…å†µï¼Œè€Œçº¢é»‘æ ‘éœ€è¦TreeNodeã€‚ä½¿ç”¨Node+CAS+synchronizedæ¥ä¿è¯çº¿ç¨‹å®‰å…¨<img src="/2024/05/13/08/JDK1.8%E5%AE%9E%E7%8E%B0.png"></p><h5 id="å¸¸ç”¨çš„api"><a href="#å¸¸ç”¨çš„api" class="headerlink" title="å¸¸ç”¨çš„api"></a>å¸¸ç”¨çš„api</h5><h6 id="get"><a href="#get" class="headerlink" title="get"></a>get</h6><p>å…ˆè¿›æ€§ä¸€æ¬¡æ•£åˆ—ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªæ•£åˆ—å€¼å®šä½åˆ°Segmentï¼Œå†è¿›è¡Œæ•£åˆ—å®šä½åˆ°å…ƒç´ ã€‚<br>getä¸éœ€è¦åŠ é”ï¼Œå› ä¸ºgetæ–¹æ³•ä¸­ä½¿ç”¨çš„å…±äº«å˜é‡éƒ½é¡¶iæˆvolatileç±»å‹ï¼Œé¢èƒ½å¤Ÿåœ¨çº¿ç¨‹ä¹‹é—´ä¿æŒå¯è§æ€§ã€‚ä¿è¯ä¸ä¼šè¯»åˆ°è¿‡æœŸçš„å€¼ï¼Œä½†æ˜¯åªèƒ½è¢«å•çº¿ç¨‹å†™(å¦‚æœå†™å…¥çš„å€¼ä¾èµ–åŸå€¼)<br>æ ¹æ®happen beforeåŸåˆ™ï¼Œå¯¹volatileå­—æ®µçš„å†™æ˜¯ä¼˜å…ˆäºè¯»çš„ã€‚</p><h6 id="put"><a href="#put" class="headerlink" title="put"></a>put</h6><p>å¯¹å…±äº«å˜é‡è¿›è¡Œå†™å…¥æ“ä½œï¼Œä¸ºäº†çº¿ç¨‹å®‰å…¨å¿…é¡»åŠ é”ã€‚<br>å…ˆå®šä½åˆ°Segmentï¼Œä¹‹åå†Segmenté‡Œè¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥åªéœ€è¦é”ä½ä¸€ä¸ªSegmentå³å¯<br>æ‰©å®¹æœºåˆ¶ï¼šåªä¼šå¯¹æŸä¸ªsegmentè¿›è¡Œæ‰©å®¹ã€‚</p><h6 id="count"><a href="#count" class="headerlink" title="count"></a>count</h6><p>å…ˆå°è¯•ä¸åŠ é”æ¥ç»Ÿè®¡å„ä¸ªSegmentçš„å¤§å°ï¼Œå¦‚æœä¸¤æ¬¡ä¸­å‡ºç°äº†ä¸åŒçš„æ•°å€¼ï¼Œå°±é‡‡ç”¨åŠ é”çš„æ–¹å¼æ¥ç»Ÿè®¡æ‰€æœ‰Segmentå¤§å°ã€‚<br>åŸç†æ˜¯æ ¼å±€modCountå˜é‡ï¼Œputã€removeã€cleanæ–¹æ³•éƒ½ä¼šæŠŠmodCount+1</p><h4 id="CopyOnWriteArrayList"><a href="#CopyOnWriteArrayList" class="headerlink" title="CopyOnWriteArrayList"></a>CopyOnWriteArrayList</h4><p>çº¿ç¨‹å®‰å…¨çš„&nbsp;Listï¼Œç”¨æ¥æ›¿ä»£Vector<br>Vectorçš„æ ¸å¿ƒæ€æƒ³æ˜¯æ¯æ¬¡è®¿é—®éƒ½ä¸Šé”ï¼Œä½¿ç”¨synchronizedè¿›è¡ŒåŠ é”ï¼Œä¼šå¯¼è‡´æ€§èƒ½å¾ˆå·®<br>è€ŒCopyOnWriteArrayListåˆ™æ˜¯ä½¿ç”¨äº†è·Ÿè¯»å†™é”ç›¸ä¼¼çš„æ€æƒ³ï¼Œè¯»è¯»ä¸äº’æ–¥ã€‚å†™ä¸ä¼šå µå¡è¯»å–æ“ä½œï¼Œåªæœ‰å†™å†™æ‰ä¼šå‡ºç°äº’æ–¥ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯å†™æ—¶å¤åˆ¶ï¼šä¸ä¼šç›´æ¥ä¿®æ”¹åŸæ•°ç»„ï¼Œè€Œæ˜¯å…ˆåˆ›å»ºåº•å±‚æ•°ç»„çš„å‰¯æœ¬ï¼Œå¯¹å‰¯æœ¬è¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹å®Œä¹‹åå†å°†ä¿®æ”¹åçš„æ•°æ®èµ‹å€¼å›å»ã€‚</p><h4 id="ConcurrentLinkedQueue"><a href="#ConcurrentLinkedQueue" class="headerlink" title="ConcurrentLinkedQueue"></a>ConcurrentLinkedQueue</h4><p>çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—ï¼Œæ˜¯éé˜»å¡å®ç°çš„</p><h5 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h5><p>å…¥é˜Ÿ<br>ä½¿ç”¨CASç®—æ³•å®ç°çš„</p><ol><li>å®šä½å°¾èŠ‚ç‚¹</li><li>ä½¿ç”¨CASç®—æ³•æ¥ä¸æ–­å°è¯•å°†èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—ï¼šå¦‚æœå°¾èŠ‚ç‚¹çš„nextæ˜¯nullè¡¨ç¤ºå·²ç»æ˜¯å°¾èŠ‚ç‚¹äº†ï¼Œå¦‚æœä¸æ˜¯è¯´æ˜å…¶ä»–å¿åŸæ›´æ–°äº†å°¾èŠ‚ç‚¹ï¼Œéœ€è¦é‡æ–°æˆ–å¦‚å½“å‰é˜Ÿåˆ—çš„å°¾èŠ‚ç‚¹ã€‚<br>å‡ºé˜Ÿ<br>å…ˆè·å¾—å¤´èŠ‚ç‚¹çš„å…ƒç´ ï¼Œåˆ¤æ–­å¤´èŠ‚ç‚¹å…ƒç´ æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºå°±æ˜¯å·²ç»è¢«åˆ«çš„çº¿ç¨‹å–èµ°ï¼Œå¦‚æœä¸ä¸ºç©ºå°±ç”¨CASå°è¯•å‡ºé˜Ÿ</li></ol><h4 id="BlockingQueue"><a href="#BlockingQueue" class="headerlink" title="BlockingQueue"></a>BlockingQueue</h4><p>æœ‰å¤šç§å®ç°<br>å€¼å¾—æ³¨æ„çš„æ—¶Pirorityå’ŒDelay<br>é˜»å¡é˜Ÿåˆ—ï¼Œå½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œé˜Ÿåˆ—ä¼šé˜»å¡æ’å…¥å…ƒç´ çš„çº¿ç¨‹ï¼Œä¹‹é“é˜Ÿåˆ—å¸ƒæ»¡ã€‚<br>å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œè·å–å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å˜æˆéç©º<br>å¸¸ç”¨äºæˆç¼ ç€æ¶ˆè´¹è€…é—®é¢˜</p><h5 id="å®ç°åŸç†-1"><a href="#å®ç°åŸç†-1" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h5><p>é€šçŸ¥æ¨¡å¼å®ç°</p><blockquote><p>é€šçŸ¥æ¨¡å¼æ˜¯ç”Ÿäº§è€…å¾€æ»¡çš„é˜Ÿåˆ—ä¸­æ·»åŠ é˜Ÿåˆ—æ—¶ä¼šé˜»å¡ä½ç”Ÿäº§è€…ã€‚å½“æ¶ˆè´¹è€…æ¶ˆè´¹äº†ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„å…ƒç´ åï¼Œä¼šé€šçŸ¥ç”Ÿäº§è€…å½“å‰çš„é˜Ÿåˆ—å¯ç”¨</p></blockquote><h4 id="CountDownLatch-1"><a href="#CountDownLatch-1" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h4><p>ç¤ºä¾‹ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h4><p>åŒæ­¥å±éšœ<br>åŠŸèƒ½æ˜¯è®©ä¸€ç»„çº¿ç¨‹åˆ°è¾¾ä¸€ä¸ªå±éšœ(åŒæ­¥ç‚¹)æ—¶è¢«é˜»å¡ï¼Œç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœæ—¶æ‰å¼€é—¨ï¼Œæ‰€æœ‰è¢«é˜»å¡çš„çº¿ç¨‹æ‰ä¼šç»§ç»­è¿è¡Œã€‚<br>ä¸CountDownLatchçš„åŒºåˆ«ï¼šcountdownlatchåªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œè®¡æ•°å™¨æ— æ³•é‡ç½®ã€‚cyclicbarrierå¯ä»¥å¤šæ¬¡é‡å¤ä½¿ç”¨ï¼Œå½“æ‰€æœ‰çš„çº¿ç¨‹åˆ°è¾¾åŒæ­¥ç‚¹ä¹‹åå±éšœä¼šé‡ç½®ã€‚</p><p><strong>CyclicBarrierï¼šç”¨äºè®©ä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾æŸä¸ªå±éšœç‚¹ï¼Œç„¶åæ‰€æœ‰çº¿ç¨‹å†ç»§ç»­æ‰§è¡Œã€‚å¯ä»¥é‡ç”¨ã€‚<br>CountDownLatchï¼šç”¨äºä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®ŒæˆæŸäº›æ“ä½œã€‚ä¸èƒ½é‡ç”¨ã€‚</strong> </p><p>äºŒè€…ä½¿ç”¨æ–¹æ³•ç›¸ä¼¼<br>å¦‚ä½•é€‰æ‹©ï¼š<br>ç®€å•çš„ä¸€æ¬¡æ€§åŒæ­¥ä»»åŠ¡å¯ä»¥ä½¿ç”¨countdownlatchï¼Œä¾‹å¦‚åˆå§‹åŒ–ä¸€äº›é…ç½®<br>å¤šé˜¶æ®µåå¤åŒæ­¥çº¿ç¨‹æˆ–è€…å¹¶å‘ä»»åŠ¡éœ€è¦åˆ†é˜¶æ®µæ‰§è¡Œï¼Œæ¯ä¸ªé˜¶æ®µéƒ½éœ€è¦ç­‰å¾…æ‰€æœ‰çš„çº¿ç¨‹å®Œæˆï¼Œé€‰æ‹©cyclicbarrier</p><h4 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h4><p>ä¿¡å·é‡ï¼Œæ§åˆ¶åŒæ—¶è®¿é—®ç‰¹å®šèµ„æºçš„çº¿ç¨‹æ•°é‡ã€‚</p><h4 id="Exchanger"><a href="#Exchanger" class="headerlink" title="Exchanger"></a>Exchanger</h4><p>è¿›è¡Œçº¿ç¨‹ä¹‹é—´åä½œçš„å·¥å…·ç±»ã€‚æä¾›ä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œä¸¤ä¸ªçº¿ç¨‹å¯ä»¥åœ¨è¿™ä¸ªåŒæ­¥ç‚¹äº¤æ¢å½¼æ­¤çš„æ•°æ®ã€‚</p><h3 id="åŸå­ç±»"><a href="#åŸå­ç±»" class="headerlink" title="åŸå­ç±»"></a>åŸå­ç±»</h3><p>AtomicåŒ…</p><h3 id="Javaä¸­çš„çº¿ç¨‹æ± "><a href="#Javaä¸­çš„çº¿ç¨‹æ± " class="headerlink" title="Javaä¸­çš„çº¿ç¨‹æ± "></a>Javaä¸­çš„çº¿ç¨‹æ± </h3><h4 id="å®ç°åŸç†-2"><a href="#å®ç°åŸç†-2" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h4><ol><li>åˆ¤æ–­æ ¸å¿ƒçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹æ˜¯å¦éƒ½åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœä¸æ˜¯åˆ™æ–°å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼›å¦‚æœéƒ½åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€ä¸ªæµç¨‹</li><li>åˆ¤æ–­å·¥ä½œ é˜Ÿåˆ—æ˜¯å¦å·²ç»æ»¡ï¼Œå¦‚æœæ²¡æ»¡ï¼Œå°†æ–°æäº¤çš„ä»»åŠ¡å­˜å‚¨åœ¨è¿™ä¸ªå·¥ä½œé˜Ÿåˆ—é‡Œï¼Œå¦‚æœæ»¡äº†ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªæµç¨‹</li><li>åˆ¤æ–­çº¿ç¨‹æ± ä¸­ å½“çº¿ç¨‹æ˜¯å¦éƒ½åœ¨å·¥ä½œä¸­ï¼Œå¦‚æœæ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœå·²ç»æ»¡äº†ï¼Œåˆ™äº¤ç»™é¥±å’Œç­–ç•¥æ¥å¤„ç†è¿™ä¸ªä»»åŠ¡<br><img src="/2024/05/13/08/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%89%A7%E8%A1%8C%E7%A4%BA%E6%84%8F%E5%9B%BE.png"><br><img src="/2024/05/13/08/jdk%E7%BA%BF%E7%A8%8B%E6%B1%A0.png"></li></ol><h4 id="æ ¸å¿ƒå‚æ•°"><a href="#æ ¸å¿ƒå‚æ•°" class="headerlink" title="æ ¸å¿ƒå‚æ•°"></a>æ ¸å¿ƒå‚æ•°</h4><ol><li>æ ¸å¿ƒçº¿ç¨‹æ•°ï¼šä»»åŠ¡é˜Ÿåˆ—æ²¡æ»¡æ—¶å¯ä»¥åŒæ—¶æ‰§è¡Œçš„æœ€å¤§çº¿ç¨‹æ•°</li><li>æœ€å¤§çº¿ç¨‹æ•°ï¼šä»»åŠ¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œå¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°</li><li>çº¿ç¨‹ç©ºé—²æ—¶é—´ï¼šçº¿ç¨‹æ•°é‡è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹å†ä¸­æ­¢å‰ç­‰å¾…æ–°ä»»åŠ¡çš„æœ€é•¿æ—¶é—´</li><li>æ—¶é—´å•ä½</li><li>ä»»åŠ¡é˜Ÿåˆ—ï¼š</li><li>çº¿ç¨‹å·¥å‚</li><li>æ‹’ç»ç­–ç•¥ï¼šå½“ä»»åŠ¡æ— æ³•æäº¤åˆ°çº¿ç¨‹æ± æ—¶çš„å¤„ç†ç­–ç•¥ã€‚<ul><li><code>AbortPolicy</code>ï¼šæŠ›å‡º&nbsp;<code>RejectedExecutionException</code>&nbsp;å¼‚å¸¸ï¼ˆé»˜è®¤ç­–ç•¥ï¼‰ã€‚</li><li><code>CallerRunsPolicy</code>ï¼šç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡ã€‚</li><li><code>DiscardPolicy</code>ï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡ã€‚</li><li><code>DiscardOldestPolicy</code>ï¼šä¸¢å¼ƒé˜Ÿåˆ—ä¸­æœ€æ—§çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°æäº¤æ–°ä»»åŠ¡ã€‚<br><img src="/2024/05/13/08/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F.png"></li></ul></li></ol><h4 id="ä»»åŠ¡æ‰§è¡Œé¡ºåº"><a href="#ä»»åŠ¡æ‰§è¡Œé¡ºåº" class="headerlink" title="ä»»åŠ¡æ‰§è¡Œé¡ºåº"></a>ä»»åŠ¡æ‰§è¡Œé¡ºåº</h4><ol><li>å½“å‰è¿è¡Œä¸­çš„çº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå°±æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå³ä½¿çº¿ç¨‹æ± ä¸­å­˜åœ¨ç©ºé—²çº¿ç¨‹</li><li>å¦‚æœå¤§äºç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œä½†æ˜¯å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œå°±æŠŠä»»åŠ¡åŠ å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­</li><li>å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œä½†æ˜¯çº¿ç¨‹æ•°å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œå°±æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡</li><li>å¦‚æœæ–°åˆ›å»ºçº¿ç¨‹ä¼šå¯¼è‡´å½“å‰è¿è¡Œä¸­çš„çº¿ç¨‹æ•°å¤§äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œå°±ä¼šè°ƒç”¨æ‹’ç»ç­–ç•¥</li></ol><h3 id="ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼š"><a href="#ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼š" class="headerlink" title="ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼š"></a>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼š</h3><p>ä¸€ä¸ªå†…å­˜é˜Ÿåˆ—ï¼Œå¤šä¸ªç”Ÿäº§çº¿ç¨‹å¾€å†…å­˜é˜Ÿåˆ—ä¸­æ”¾æ•°æ®ï¼Œå¤šä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ä»å†…å­˜å¯¹ä¿„ä¸­å–æ•°æ®ã€‚</p><ol><li>å†…å­˜é˜Ÿåˆ—æœ¬èº«éœ€è¦æ·é”ï¼Œæ‰èƒ½å®ç°çº¿ç¨‹å®‰å…¨</li><li>é˜»å¡ã€‚å½“å†…å­˜é˜Ÿåˆ—æ»¡äº†ï¼Œç”Ÿäº§è€…è¢«é˜»å¡ï¼Œå†…å­˜é˜Ÿåˆ—ä¸ºç©ºæ—¶æ¶ˆè´¹è€…è¢«é˜»å¡ã€‚</li><li>åŒå‘é€šçŸ¥ï¼šæ¶ˆè´¹è€…è¢«é˜»å¡ä¹‹åï¼Œç”Ÿäº§è€…æ”¾å…¥æ–°æ•°æ®ï¼Œè¦é€šçŸ¥æ¶ˆè´¹è€…ï¼Œåä¹‹è¦é€šçŸ¥ç”Ÿäº§è€…ã€‚</li></ol><h1 id="Unsafe"><a href="#Unsafe" class="headerlink" title="Unsafe"></a>Unsafe</h1><p>ä¸»è¦åŠŸèƒ½</p><ol><li>å†…å­˜å±éšœ</li></ol><h1 id="ReenTrantLock"><a href="#ReenTrantLock" class="headerlink" title="ReenTrantLock"></a>ReenTrantLock</h1><h2 id="å®ç°åŸç†-3"><a href="#å®ç°åŸç†-3" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h2><p>å®ç°æ˜¯ä¸€ç§è‡ªæ—‹é”ï¼Œä½¿ç”¨å¾ªç¯è°ƒç”¨CASæ“ä½œæ¥è¿›è¡ŒåŠ é”ã€‚</p><h1 id="çº¿ç¨‹åŒæ­¥çš„æ–¹æ³•"><a href="#çº¿ç¨‹åŒæ­¥çš„æ–¹æ³•" class="headerlink" title="çº¿ç¨‹åŒæ­¥çš„æ–¹æ³•"></a>çº¿ç¨‹åŒæ­¥çš„æ–¹æ³•</h1><ol><li>Synchronized</li><li>ReentrantLock</li><li>CountDownLatch</li><li>CyclicBarrier</li><li>Semaphore</li><li>Waitå’ŒNo</li></ol>]]></content>
      
      
      <categories>
          
          <category> å¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring å¾ªç¯ä¾èµ–ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼Ÿ å¦‚ä½•è§£å†³?</title>
      <link href="/2024/05/13/00/"/>
      <url>/2024/05/13/00/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–?"></a>ä¸€ã€ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–?</h2><p>åœ¨Springé¡¹ç›®ä¸­æˆ‘ä»¬ç»å¸¸ä½¿ç”¨ @Autowiredæˆ–è€…@Resourceå»æ³¨å…¥Beanï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºä¾èµ–ã€‚<br>å½“å¤šä¸ªBeanä¹‹é—´å­˜åœ¨äº’ç›¸ä¾èµ–çš„å…³ç³»ï¼Œå¹¶ä¸”å‡ºç°äº†å¾ªç¯è°ƒç”¨æ—¶ï¼ŒSpringå°±ä¼šæ‰¾ä¸åˆ°ä¾èµ–çš„ä¸ƒç‚¹ï¼Œå°±ä¼šæ­»å¾ªç¯ç›´åˆ°æŠ›å‡ºå¼‚å¸¸ã€‚<br>ä¾‹å¦‚ï¼šAä¾èµ–B,Bä¾èµ–C,Cä¾èµ–Aï¼Œä¸‰è€…å¿…é¡»åœ¨ä¾èµ–çš„ç±»åˆå§‹åŒ–ä¹‹åæ‰ä¼šåˆå§‹åŒ–è‡ªå·±ï¼Œä»è€Œå‡ºç°æ­»å¾ªç¯ã€‚</p><h2 id="äºŒã€å®æˆ˜åœºæ™¯"><a href="#äºŒã€å®æˆ˜åœºæ™¯" class="headerlink" title="äºŒã€å®æˆ˜åœºæ™¯"></a>äºŒã€å®æˆ˜åœºæ™¯</h2><p>ç¬”è€…æ˜¯åœ¨ä½¿ç”¨Spring Security ç¼–å†™ç™»å½•å’Œæƒé™éªŒè¯ä»£ç æ—¶å‡ºç°äº†å¾ªç¯ä¾èµ–çš„åœºæ™¯ã€‚</p><h2 id="ä¸‰ã€è§£å†³æ–¹æ³•"><a href="#ä¸‰ã€è§£å†³æ–¹æ³•" class="headerlink" title="ä¸‰ã€è§£å†³æ–¹æ³•"></a>ä¸‰ã€è§£å†³æ–¹æ³•</h2><p>çœæµï¼š ç¬”è€…ä½¿ç”¨çš„æ–¹æ³•</p><ol><li>ä½¿ç”¨@Lazyå»¶è¿Ÿåˆ›å»ºå¯¹è±¡</li><li>å°†@Resourceæ›¿æ¢ä¸º@Autowired</li><li>æ–°å»ºä¸€ä¸ªç©ºBeanï¼Œæ¥è§£å†³ä¾èµ–é—®é¢˜ï¼š ä¾‹å¦‚ Aä¾èµ–B,Bä¾èµ–A,æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªCï¼Œç„¶åè®©Aä¾èµ–Cï¼ŒBå®ç°Cå³å¯å°†ç›´æ¥ä¾èµ–è½¬åŒ–ä¸ºé—´æ¥ä¾èµ–å…³ç³» ä¸­ä»‹æ–¹å¼æ‰“ç ´å¾ªç¯é“¾<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æ–°çš„æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">C</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// Bå®ç°C</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">implements</span> <span class="token class-name">C</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// ...</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// Aä¾èµ–Cï¼Œè€Œä¸æ˜¯ç›´æ¥ä¾èµ–B</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token class-name">C</span> c<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token class-name">C</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>c <span class="token operator">=</span> c<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        c<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="å››ã€æ‰©å±•ï¼š-Autowiredæ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„çš„é—®é¢˜çš„"><a href="#å››ã€æ‰©å±•ï¼š-Autowiredæ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„çš„é—®é¢˜çš„" class="headerlink" title="å››ã€æ‰©å±•ï¼š@Autowiredæ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„çš„é—®é¢˜çš„"></a>å››ã€æ‰©å±•ï¼š@Autowiredæ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„çš„é—®é¢˜çš„</h2><p>è§£å†³çš„æ ¸å¿ƒæ˜¯ä½¿ç”¨äº†Springçš„ä¸‰çº§ç¼“å­˜ï¼š</p><ul><li>ç¬¬ä¸€çº§ç¼“å­˜ï¼šsingletonObjectsï¼Œç”¨äºå­˜æ”¾å®Œå…¨åˆå§‹åŒ–å¥½çš„beanï¼Œé¿å…é‡å¤åˆ›å»ºï¼Œå•ä¾‹æ± </li><li>äºŒçº§ç¼“å­˜ï¼šearlySingletonObjects å­˜æ”¾åŸå§‹çš„beanå¯¹è±¡ï¼Œå°šæœªå¡«å……å±æ€§ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰è¿›è¡Œå®Œæˆä¾èµ–æ³¨å…¥çš„ç±» (<strong>æ ¸å¿ƒ</strong>)</li><li>ä¸‰çº§ç¼“å­˜ï¼šsingletonFactories ç”¨äºå­˜æ”¾beanå·¥å‚å¯¹è±¡ä¸­çš„getObjectæ–¹æ³•ï¼Œç”¨äºäº§ç”ŸåŸå§‹çš„beanæˆ–è€…ä»£ç†å¯¹è±¡(å¦‚æœBeanè¢«AOPåˆ‡é¢ä»£ç†)æ¥æ”¾å…¥äºŒçº§ç¼“å­˜<br>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼Œå®ä¾‹åŒ– â‰  å®Œå…¨åˆå§‹åŒ–ï¼Œå½“Springå®¹å™¨åˆ›å»ºbeanæ—¶ï¼Œä¼šä»ä¸€çº§ç¼“å­˜ä¸­å¯»æ‰¾ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œä¼šæœç´¢äºŒçº§ç¼“å­˜ï¼Œå¦‚æœå­˜åœ¨å°±ä¼šæŠŠå®ƒæ³¨å…¥ï¼Œå¦‚æœæ²¡æœ‰ä¼šæ‰¾ä¸‰çº§ç¼“å­˜ã€‚å½“beanåˆå§‹åŒ–æ—¶ï¼Œå¦‚æœå‘ç°ä¾èµ–çš„ç±»æ²¡æœ‰å®Œæˆå®Œå…¨åˆå§‹åŒ–ï¼Œå°±ä¼šå…ˆä½¿ç”¨äºŒçº§ç¼“å­˜ä¸­çš„beanå®ä¾‹ï¼Œå½“æ‰€æœ‰çš„beanéƒ½åˆå§‹åŒ–ä¹‹åå†ä»ä¸€çº§ç¼“å­˜ä¸­è·å–å®Œå…¨åˆå§‹åŒ–çš„bean<br>è€Œæˆ‘ä»¬ä½¿ç”¨çš„@Resourceå¹¶ä¸å­˜åœ¨è¿™ç§æœºåˆ¶ï¼Œä¼šç›´æ¥æŠ›å‡ºBeanCurrentlyInCreationException<br><strong>åªç”¨ä¸¤çº§ç¼“å­˜å¯ä»¥å—ï¼Ÿ</strong><br>å¦‚æœæ²¡æœ‰AOPçš„æƒ…å†µä¸‹åªæ˜¯ç”¨ä¸€çº§å’Œä¸‰çº§ç¼“å­˜å°±èƒ½è§£å†³ï¼Œä½†æ˜¯æ¶‰åŠåˆ°AOPæ—¶ï¼Œå¿…é¡»ä½¿ç”¨äº†<br>å¦‚æœå‘ç”Ÿå¾ªç¯ä¾èµ–çš„è¯ï¼Œå°±å» <strong>ä¸‰çº§ç¼“å­˜ <code>singletonFactories</code></strong> ä¸­æ‹¿åˆ°ä¸‰çº§ç¼“å­˜ä¸­å­˜å‚¨çš„ <code>ObjectFactory</code> å¹¶è°ƒç”¨å®ƒçš„ <code>getObject()</code> æ–¹æ³•æ¥è·å–è¿™ä¸ªå¾ªç¯ä¾èµ–å¯¹è±¡çš„å‰æœŸæš´éœ²å¯¹è±¡ï¼ˆè™½ç„¶è¿˜æ²¡åˆå§‹åŒ–å®Œæˆï¼Œä½†æ˜¯å¯ä»¥æ‹¿åˆ°è¯¥å¯¹è±¡åœ¨å †ä¸­çš„å­˜å‚¨åœ°å€äº†ï¼‰ï¼Œå¹¶ä¸”å°†è¿™ä¸ªå‰æœŸæš´éœ²å¯¹è±¡æ”¾åˆ°äºŒçº§ç¼“å­˜ä¸­ï¼Œè¿™æ ·åœ¨å¾ªç¯ä¾èµ–æ—¶ï¼Œå°±ä¸ä¼šé‡å¤åˆå§‹åŒ–äº†ï¼</li></ul><hr>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>train</title>
      <link href="/2024/04/23/25/"/>
      <url>/2024/04/23/25/</url>
      
        <content type="html"><![CDATA[<p>Tigs:</p><ol><li>ç›¸åŒçš„applicationæ–‡ä»¶ä¼˜å…ˆä½¿ç”¨å…¬å…±çš„é…ç½®</li></ol><h2 id="ä¸€äº›æ²¡ä»€ä¹ˆç”¨çš„å°æ¦‚å¿µ"><a href="#ä¸€äº›æ²¡ä»€ä¹ˆç”¨çš„å°æ¦‚å¿µ" class="headerlink" title="ä¸€äº›æ²¡ä»€ä¹ˆç”¨çš„å°æ¦‚å¿µ"></a>ä¸€äº›æ²¡ä»€ä¹ˆç”¨çš„å°æ¦‚å¿µ</h2><ul><li>å¹¶å‘é‡ï¼šåŒä¸€æ—¶é—´å†…ï¼Œç³»ç»Ÿä¸­åŒæ—¶å¤„ç†çš„ç”¨æˆ·è¯·æ±‚æ•°</li><li>å“åº”æ—¶é—´ï¼šç³»ç»Ÿå¤„ç†ä¸€ä¸ªè¯·æ±‚æ‰€éœ€çš„æ—¶é—´</li><li>ååé‡ï¼šç³»ç»Ÿåœ¨ç»™å®šæ—¶é—´å†…å¤„ç†å¤„ç†çš„ä¸šåŠ¡è¯·æ±‚æ•°é‡</li><li>QPS(Queries Per Second) è¡¨ç¤ºç³»ç»Ÿæ¯ç§’é’Ÿå¤„ç†çš„è¯·æ±‚æ•°é‡</li><li>TPS(Transactions Per Second ) è¡¨ç¤ºç³»ç»Ÿæ¯ç§’é’Ÿå®Œæˆçš„äº‹åŠ¡æ•°é‡</li></ul><h2 id="Gateway-ç½‘å…³è´Ÿè´£åˆ†å‘å‰ç«¯è¯·æ±‚"><a href="#Gateway-ç½‘å…³è´Ÿè´£åˆ†å‘å‰ç«¯è¯·æ±‚" class="headerlink" title="Gateway ç½‘å…³è´Ÿè´£åˆ†å‘å‰ç«¯è¯·æ±‚"></a>Gateway ç½‘å…³è´Ÿè´£åˆ†å‘å‰ç«¯è¯·æ±‚</h2><p>ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥è§£å†³ç¼“å­˜å‡»ç©¿</p><ul><li><strong>ä»¥ä¸‹æ˜¯è¦è‡ªå·±å®Œæˆçš„ï¼š</strong><ol><li>ä½¿ç”¨Spring Securityå’ŒGateWayå®Œæˆè·¯ç”±è½¬å‘å’Œè®¤è¯</li><li>ä½¿ç”¨kafkaæˆ–rocketmq<br>Redisä½œä¸ºç¼“å­˜</li></ol></li><li>ç¼“å­˜é—®é¢˜ï¼š<ol><li>æ¯å¤©çš„ç”¨æˆ·å¾ˆå¤šä½†æ˜¯ç”¨æˆ·æ¯å¤©ä½¿ç”¨çš„æ¬¡æ•°å¾ˆå°‘ï¼ŒåŒæ—¶ä¼šå‘˜çš„ä¿¡æ¯æ¶‰åŠçš„è¡¨å¾ˆå¤š<ul><li>è§£å†³ï¼šä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œå› ä¸ºæ¯ä¸ªä¼šå‘˜ä½¿ç”¨æ¬¡æ•°å¾ˆå°‘ï¼Œä¸€åˆ†é’Ÿæœ‰æ•ˆï¼Œ</li><li>é—®é¢˜:fullgcé¢‘ç¹ï¼Œå¯¼è‡´çŸ­æ—¶é—´å†…å¤§é‡è¯·æ±‚å¤±è´¥ï¼Œå› ä¸ºç¼“å­˜æ—¶é—´å¾ˆçŸ­ï¼Œæ‰€ä»¥å¤§é‡çš„æ–°ç”Ÿä»£å‡ºç°ï¼Œå¼•èµ·é¢‘ç¹çš„gcï¼Œç„¶åå¤§é‡æ”¾å…¥è€å¹´ä»£å¼•èµ·fullgc ï¼Œ è§£å†³ï¼šä¸ç”¨æœ¬åœ°ç¼“å­˜ï¼Œè€Œæ˜¯ç”¨çº¿ç¨‹æœ¬åœ°å˜é‡ï¼Œæ”¾åœ¨å†…å­˜ä¸­ã€‚</li></ul></li></ol></li></ul><h2 id="Senta"><a href="#Senta" class="headerlink" title="Senta"></a>Senta</h2><ul><li>åŸç†ï¼šç”Ÿæˆåå‘sql</li><li>æ¨¡å¼ï¼š<ol><li>ATæ¨¡å¼ï¼šé»˜è®¤ï¼Œæ·»åŠ undo_log,åå‘ç”Ÿæˆsqlï¼Œå›æ»šä¹‹ååŸæ¥æ²¡æ•°æ®çš„ä¾ç„¶æ²¡æœ‰æ•°æ®<ul><li>ä½¿ç”¨æ–¹æ³•ï¼š<ol><li>å»ºç«‹undo_logè¡¨</li></ol></li></ul></li><li>TCCæ¨¡å¼ï¼š try confirm/cancel ä¸‰ä¸ªé˜¶æ®µçš„ä»£ç è‡ªå·±å®ç°ï¼ŒSeataè´Ÿè´£è°ƒåº¦</li><li>SAGAæ¨¡å¼ï¼šé•¿äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œéœ€è¦ç¼–å†™ä¸¤ä¸ªé˜¶æ®µçš„ä»£ç ï¼Œéœ€è¦ä¸€ä¸ªJSONæ–‡ä»¶ï¼Œå¯ä»¥å¼‚æ­¥æ‰§è¡Œ</li><li>XAæ¨¡å¼ï¼šé€‚ç”¨äºé“¶è¡Œå’Œé‡‘èï¼Œéœ€è¦æ•°æ®åº“æ”¯æŒXAåè®®<br>  try ä¹‹å‰çš„ä»£ç å‡ºç°å¼‚å¸¸ä¼šç›´æ¥ç»“æŸï¼Œä¸ä¼šèµ°finally</li></ol></li></ul><h2 id="å¦‚ä½•å¤„ç†å¤šå¹¶å‘çš„ä¹°ç¥¨"><a href="#å¦‚ä½•å¤„ç†å¤šå¹¶å‘çš„ä¹°ç¥¨" class="headerlink" title="å¦‚ä½•å¤„ç†å¤šå¹¶å‘çš„ä¹°ç¥¨"></a>å¦‚ä½•å¤„ç†å¤šå¹¶å‘çš„ä¹°ç¥¨</h2><ol><li>ä½¿ç”¨synchronized ï¼Œç¼ºç‚¹ï¼šä¼šå¯¼è‡´å¡ä½ï¼Œåªé€‚åˆå•æœº</li><li>ä½¿ç”¨Redisåˆ†å¸ƒå¼é”ï¼Œä½¿ç”¨æ—¥æœŸ+è½¦æ¬¡æ¥ä½œä¸ºé”keyï¼Œç„¶åæ”¾å…¥Redisä¸­ï¼Œå¦‚æœæ‹¿åˆ°é”åˆ™ç»§ç»­æ‰§è¡Œï¼Œä½¿ç”¨çš„ä½¿setIfAbsent(key,value,timeout),å¦‚æœè¿™ä¸ªé”ä¸å­˜åœ¨åˆ™è®¾ç½®å¹¶ä¸”è¿”å›trueï¼Œä¹°åˆ°ç¥¨ä¹‹ååˆ é™¤key ç¼ºç‚¹ï¼šå¦‚æœçº¿ç¨‹æ‰§è¡Œæ—¶é—´è¶…è¿‡äº†è¶…æ—¶æ—¶é—´ï¼Œä¹Ÿä¼šå¯¼è‡´è¶…å–    <strong>å¯¹åº”Redisçš„å‘½ä»¤æ˜¯setnx</strong></li><li>ä½¿ç”¨Redissonçœ‹é—¨ç‹—ï¼Œä½¿ç”¨ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹æ¥å…³æ³¨è¶…æ—¶é—´æ˜¯ï¼Œå¦‚æœäº‹åŠ¡æœªå®Œæˆä½†æ˜¯é”å³å°†è¿‡æœŸåˆ™é‡ç½®æ—¶é—´ï¼Œå¦‚æœäº‹åŠ¡ç»“æŸåˆ™å®ˆæŠ¤çº¿ç¨‹ç»“æŸï¼Œlock.isHeldByCurrentThreadæ¥åˆ¤æ–­æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹çš„é”ï¼Œç¼ºç‚¹ï¼šRedisé›†ç¾¤ä¸­Rediså®•æœºï¼Œä¼šå¯¼è‡´è·å¾—å¾—ä¸åˆ°é”ï¼Œç„¶åæ–°çš„çº¿ç¨‹å‘æ–°çš„Redisä¸»èŠ‚ç‚¹ä¸­è·å¾—é”ï¼Œä»ç„¶å¯ä»¥è·å¾—é” ï¼Œ <strong>æœ€å¸¸ç”¨</strong> ï¼ŒRedissonä¸­çš„é”åœ¨é‡Šæ”¾äº†ä¹‹åRediså°±æŸ¥ä¸åˆ°äº†ï¼ï¼ï¼</li><li>ä½¿ç”¨çº¢é”ï¼šåªæœ‰æ‹¿åˆ°åŠæ•°ä»¥ä¸Šçš„åŒç­‰åœ°ä½çš„Redisçš„é”æ‰ç®—æ‹¿åˆ°é”ï¼ŒRedissonä¸­ä¹Ÿæœ‰è‡ªå¸¦çš„çº¢é”ï¼Œä¸å¸¸ç”¨ï¼Œ ç¼ºç‚¹ï¼šæ€§èƒ½é—®é¢˜ï¼Œå¹¶ä¸”å¦‚æœéƒ½å¾—ä¸åˆ°é”å°±éƒ½ä¼šç­‰å¾…äº†ï¼Œå°½é‡å»å°è¯•è·å¾—æ›´å¤šçš„é”æ¥è§£å†³å•æœºå®•æœºé—®é¢˜</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">RedissonClient</span> redissonClient<span class="token punctuation">;</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/buy"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">String</span> ticket<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>        <span class="token comment">//å½“å‰æ—¥æœŸ</span>        <span class="token class-name">String</span> key <span class="token operator">=</span> ticket <span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"key:{}"</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">RLock</span> lock <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token comment">//è·å–é”</span>            lock <span class="token operator">=</span> redissonClient<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//å°è¯•åŠ é”ï¼Œæœ€å¤šç­‰å¾…100ç§’ï¼Œä¸Šé”ä»¥å10ç§’è‡ªåŠ¨è§£é”</span>            <span class="token keyword">boolean</span> tryLock <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç­‰å¾…100ç§’ï¼Œä¸Šé”ä»¥å10ç§’è‡ªåŠ¨è§£é”</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"tryLock:{}"</span><span class="token punctuation">,</span> tryLock<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>tryLock<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å•ä½æ˜¯æ¯«ç§’</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è´­ä¹°æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> lock <span class="token operator">&amp;&amp;</span> lock<span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">return</span> <span class="token string">"è´­ä¹°æˆåŠŸ"</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ²¡æ‹¿åˆ°é”"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token string">"è´­ä¹°å¤±è´¥"</span><span class="token punctuation">;</span><span class="token comment">//                throw new RuntimeException("æ²¡æ‹¿åˆ°é”");</span>            <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä½¿ç”¨Sentinalè¿›è¡Œé™æµå’Œé™çº§"><a href="#ä½¿ç”¨Sentinalè¿›è¡Œé™æµå’Œé™çº§" class="headerlink" title="ä½¿ç”¨Sentinalè¿›è¡Œé™æµå’Œé™çº§"></a>ä½¿ç”¨Sentinalè¿›è¡Œé™æµå’Œé™çº§</h3><ul><li>å¸¸è§çš„é™æµç®—æ³•ï¼š<ol><li>é™æ€çª—å£é™æµï¼šæ¯ç§’é™åˆ¶å¤šå°‘ä¸ªè¯·æ±‚ï¼Œä¾‹å¦‚ï¼šç¬¬2.5ä¼šç»Ÿè®¡ç¬¬2ç§’åˆ°ç°åœ¨çš„æµé‡</li><li>åŠ¨æ€çª—å£é™æµï¼šæ»‘åŠ¨çª—å£ï¼Œå¾€å‰å–1ç§’,ä¾‹å¦‚ï¼šç¬¬2.5ç§’ä¼šç»Ÿè®¡ç¬¬1.5ç§’åˆ°ç°åœ¨çš„è¯·æ±‚æ•°</li><li>æ¼æ¡¶é™æµï¼šé˜Ÿåˆ—ï¼Œè¯·æ±‚å…¨åœ¨é˜Ÿåˆ—ä¸­ï¼Œå‡ºé˜Ÿæ˜¯åŒ€é€Ÿçš„</li><li>ä»¤ç‰Œæ¡¶é™æµï¼šæ”¾çš„æ˜¯ä»¤ç‰Œï¼Œä»¤ç‰Œå°±æ˜¯è®¡æ•°ï¼Œä¼šæœ‰ä¸€ä¸ªè®¡æ•°å™¨åŒ€é€Ÿäº§ç”Ÿä»¤ç‰Œ,å‡ºé˜Ÿä¸æ˜¯åŒ€é€Ÿçš„å¯ä»¥é€‚åº”çŸ­æ—¶é—´å†…å¤§é‡è¯·æ±‚</li><li>ä»¤ç‰Œå¤§é—¸ï¼šå½“ä»¤ç‰Œåˆ°è¾¾ä¸€å®šæ•°é‡å°±ä¸å†äº§ç”Ÿæ–°çš„ä»¤ç‰Œ</li></ol></li></ul><h2 id="å¦‚ä½•åº”å¯¹åˆ·ç¥¨"><a href="#å¦‚ä½•åº”å¯¹åˆ·ç¥¨" class="headerlink" title="å¦‚ä½•åº”å¯¹åˆ·ç¥¨"></a>å¦‚ä½•åº”å¯¹åˆ·ç¥¨</h2><p>ä½¿ç”¨ä»¤ç‰Œå¤§é—¸ï¼šä»¤ç‰ŒæŒ‰ç…§åŒ€é€Ÿç”Ÿæˆï¼Œå³ä½¿æœ‰å†å¤šçš„æœºå™¨äººåˆ·ç¥¨ä¹Ÿä¼šè¢«é¢†ç¥¨çš„æ•°é‡é™åˆ¶ï¼Œåˆ¤æ–­ä»¤ç‰Œè‚¯å®šæ¯”æ›´æ–°åº“å­˜æ›´å¿«</p><ol><li>ä½¿ç”¨ä»¤ç‰Œé”ï¼ŒæŒæœ‰ä»¤ç‰Œé”çš„äººæ‰èƒ½å¯¹ä»¤ç‰Œè¿›è¡Œæ“ä½œ</li><li>æ£€æµ‹ä»¤ç‰Œæ•°é‡ï¼Œå¦‚æœæœ‰å°±æ‰§è¡Œï¼Œæ²¡æœ‰å°±ä¸èƒ½æ‰§è¡Œ</li><li>ä¸è¦ç«‹åˆ»é‡Šæ”¾ä»¤ç‰Œé”ï¼Œä½¿ç”¨å›ºå®šçš„æ—¶é—´æ¥é‡Šæ”¾ä»¤ç‰Œé”ï¼Œè¿™æ ·å³ä½¿æœ‰æœºå™¨äººä¹Ÿå¾—ç­‰å¾…ä»¤ç‰Œé”çš„é‡Šæ”¾</li></ol><ul><li>åŒæ—¶ä¹Ÿå¯ä»¥åŠ å…¥éªŒè¯ç æ¥é˜²æ­¢æœºå™¨äººåˆ·ç¥¨<br>ä¼˜åŒ–ï¼šä½¿ç”¨ç¼“å­˜åŠ é€Ÿä»¤ç‰Œé”<br>å°†æ•°æ®åº“æŸ¥å‡ºæ¥çš„ä»¤ç‰Œå­˜åœ¨Redisä¸­ï¼Œæ¯æ¬¡å¯¹Redisä¸­çš„ä»¤ç‰Œæ•°é‡-1ï¼Œåªæœ‰å½“æ•°é‡ç­‰äºæˆ‘ä»¬è®¾å®šçš„é˜ˆå€¼æ—¶å†å»æ›´æ”¹æ•°æ®åº“çš„ä»¤ç‰Œæ•°é‡ï¼Œæ‰€ä»¥éœ€è¦åœ¨Redisä¸­é•¿æœŸä¿æŒè¿™ä¸ªkey</li></ul><h2 id="ä½¿ç”¨RocketMQ"><a href="#ä½¿ç”¨RocketMQ" class="headerlink" title="ä½¿ç”¨RocketMQ"></a>ä½¿ç”¨RocketMQ</h2><p>ä½¿ç”¨RocketMQæ¥å®Œæˆ<br>è´­ç¥¨ä¹‹åï¼Œå°†è¯·æ±‚å‘é€ç»™RocketMQï¼Œç„¶åå¦ä¸€è¾¹å»æ¶ˆè´¹è¿™ä¸ªæ¶ˆæ¯ï¼Œå¹¶ä¸”è¿›è¡Œæ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥ï¼Œå¯ä»¥å°†è¯·æ±‚ç›´æ¥è½¬ä¸ºString å‘é€ï¼Œä¹‹åå¦ä¸€ç«¯pullç„¶åè½¬ä¸ºéœ€è¦çš„ç±»ï¼Œä¹‹åæ‰§è¡Œå…·ä½“å…·ä½“çš„é€»è¾‘</p><h2 id="çº¯æ‰‹å†™"><a href="#çº¯æ‰‹å†™" class="headerlink" title="çº¯æ‰‹å†™"></a>çº¯æ‰‹å†™</h2><ol><li>ç™»å½•ï¼š<ul><li>ä½¿ç”¨gateway + SpringSecurity + JWT + Rediså®ç°å¾®æœåŠ¡ç™»å½•</li><li>Mybatis+Mybatis-plus</li></ul></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>es</title>
      <link href="/2024/04/14/28/"/>
      <url>/2024/04/14/28/</url>
      
        <content type="html"><![CDATA[<h1 id="Elasticsearchå­¦ä¹ ç¬”è®°"><a href="#Elasticsearchå­¦ä¹ ç¬”è®°" class="headerlink" title="Elasticsearchå­¦ä¹ ç¬”è®°"></a>Elasticsearchå­¦ä¹ ç¬”è®°</h1><ul><li>é¢è¯•é—®é¢˜ï¼š<ol><li>ç´¢å¼•æ–‡æ¡£çš„è¿‡ç¨‹ï¼š<ol><li>åè°ƒèŠ‚ç‚¹é»˜è®¤ä½¿ç”¨æ–‡æ¡£IDå‚ä¸è®¡ç®—ï¼Œä¸ºè·¯ç”±æä¾›åˆé€‚çš„åˆ†ç‰‡ï¼Œè½¬å‘è¯·æ±‚</li><li>åˆ†ç‰‡æ‰€åœ¨èŠ‚ç‚¹æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œå°†è¯·æ±‚å†™å…¥å†…å­˜ç¼“å†²åŒºï¼Œå®šæ—¶refreshåˆ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼Œç»è¿‡è¿™ä¸€æ­¥æ—¢å¯ä»¥è¢«æœç´¢åˆ°äº†ï¼Œå½“Filesystem cacheä¸­çš„æ•°æ®å†™å…¥åˆ°ç£ç›˜ä¸­æ—¶ï¼Œæ‰ä¼šæ¸…é™¤æ‰translogï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšflushï¼›</li></ol></li><li>esçš„åˆ é™¤ï¼šesä¸­çš„æ–‡ä»¶å¹¶æ²¡æœ‰åˆ é™¤ï¼Œæ¯ä¸ªæ®µéƒ½æœ‰ä¸€ä¸ª.delæ–‡ä»¶ï¼Œåˆ é™¤æ˜¯åœ¨è¿™é‡Œè¿›è¡Œæ ‡å¿—ï¼Œè¯¥æ–‡æ¡£ä»ç„¶èƒ½å¤ŸåŒ¹é…åˆ°ï¼Œä½†æ˜¯ä¼šåœ¨ç»“æœä¸­è¢«è¿‡æ»¤æ‰ï¼Œåç»­åœ¨æ‰§è¡Œmerge(å‘¨æœŸæ€§çš„å°†è¾ƒå°çš„æ®µåˆå¹¶ä¸ºä¸€ä¸ªè¾ƒå¤§çš„æ®µ)æ“ä½œæ—¶ï¼Œä¼šè¢«å½»åº•æ¸…é™¤æ‰</li><li>æ›´æ–°ï¼šæ¯æ¬¡æ›´æ–°éƒ½æ˜¯å…ˆæ ‡è®°æ—§çš„æ–‡æ¡£ä¸ºå·²åˆ é™¤ï¼Œé‡æ–°å»ºç«‹ä¸€ä¸ªæ–‡æ¡£ï¼Œå¹¶é€šè¿‡ç‰ˆæœ¬å·æ¥åŒºåˆ†</li><li>æœç´¢è¿‡ç¨‹ï¼š<ul><li>Query Then Fetch</li></ul><ol><li>æŸ¥è¯¢å¹¿æ’­åˆ°æ¯ä¸€ä¸ªåˆ†ç‰‡ï¼Œåˆ†ç‰‡æœ¬åœ°æ‰§è¡Œæœç´¢ï¼Œå»ºç«‹ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ï¼Œæœç´¢åªèƒ½æœåˆ°æ–‡ä»¶ç¼“å­˜çš„å†…å®¹ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯å®Œå…¨å®æ—¶çš„</li><li>åˆ†ç‰‡è¿”å›ä¼˜å…ˆé˜Ÿåˆ—ä¸­æ–‡æ¡£çš„IDå’Œæ’åºå€¼ç»™åè°ƒèŠ‚ç‚¹ï¼Œåè°ƒèŠ‚ç‚¹åˆå¹¶ç»“æœå¹¶æ’åº</li><li>åè°ƒèŠ‚ç‚¹ç¡®å®šè¦å–å›çš„æ–‡æ¡£ï¼Œç„¶åå‘å¯¹åº”åˆ†ç‰‡å‘é€è¯·æ±‚ï¼Œæœ€ååè°ƒèŠ‚ç‚¹è¿”å›ç»™å®¢æˆ·ç«¯</li></ol></li><li>å†™è¿‡ç¨‹ï¼šå®¢æˆ·ç«¯é€‰æ‹©ä¸€ä¸ªnode(ä½œä¸ºåè°ƒèŠ‚ç‚¹ï¼‰å‘è¯·æ±‚ï¼Œåè°ƒèŠ‚ç‚¹å¯¹æ–‡æ¡£è¿›è¡Œè·¯ç”±ï¼Œå°†è¯·æ±‚è½¬å‘ç»™æœ‰è¿™ä¸ªæ–‡æ¡£çš„ä¸»åˆ†ç‰‡çš„èŠ‚ç‚¹ï¼Œä¸»åˆ†ç‰‡å¤„ç†è¯·æ±‚ï¼Œå¹¶å°†å°†æ•°æ®åŒæ­¥åˆ°å‰¯æœ¬ä¸­ï¼Œä¹‹ååè°ƒèŠ‚ç‚¹æ ¹æ®å®ŒæˆçŠ¶æ€ï¼Œç›¸åº”ç»™å®¢æˆ·ç«¯</li><li>è¯»è¿‡ç¨‹ï¼šåè°ƒèŠ‚ç‚¹æ ¹æ®doc idæ¥æŸ¥è¯¢ï¼Œç„¶åå¯¹doc idè¿›è¡Œhashæ¥ç¡®è®¤åˆ°äº†å“ªä¸ªåˆ†ç‰‡ä¸Šï¼Œç„¶åè½¬å‘è¯·æ±‚åˆ°å¯¹åº”çš„èŠ‚ç‚¹ï¼Œä½¿ç”¨è´Ÿè½½å‡è¡¡ æ¥é€‰å–ä¸€ä¸ªåˆ†ç‰‡æ¥å¤„ç†ï¼Œå¹¶è½¬å‘ç»™å®ƒï¼Œä¹‹åç”±è¿™ä¸ªèŠ‚ç‚¹æ¥è¯»å–å¹¶è¿”å›ç»™åè°ƒèŠ‚ç‚¹ï¼Œåè°ƒèŠ‚ç‚¹è¿”å›ç»™å®¢æˆ·ç«¯</li><li>esç›¸å¯¹äºmongodbï¼Œmysqlçš„ä¼˜åŠ¿ï¼š1.å…¨æ–‡æ£€ç´¢ï¼Œç›¸å…³æ€§æ’å 2.è¿‘å®æ—¶æ€§3.åˆ†å¸ƒå¼å¤„ç†4.æ•°æ®åˆ†æ ç¼ºç‚¹ï¼šä¸æ”¯æŒäº‹åŠ¡</li></ol></li><li>DSLæŸ¥è¯¢ï¼šç”±esæä¾›çš„åŸºäºJSONçš„DSLè¯­å¥<ul><li>å¶å­æŸ¥è¯¢ï¼šåœ¨ç‰¹å®šå­—æ®µä¸­æŸ¥è¯¢ç‰¹å®šå€¼</li><li>ç¬¦åˆæŸ¥è¯¢ï¼šä»¥é€»è¾‘æ–¹å¼ç»„åˆå¤šä¸ªå¶å­æŸ¥è¯¢æˆ–è€…æ›´æ”¹å¶å­æŸ¥è¯¢çš„è¡Œä¸ºæ–¹å¼</li><li>æŒ‡å®šé«˜äº®å­—æ®µï¼š<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">GET /</span><span class="token punctuation">{</span>ç´¢å¼•åº“å<span class="token punctuation">}</span><span class="token selector">/_search</span><span class="token punctuation">{</span>  <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token string">"match"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token string">"æœç´¢å­—æ®µ"</span><span class="token punctuation">:</span> <span class="token string">"æœç´¢å…³é”®å­—"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token selector">,  "highlight":</span> <span class="token punctuation">{</span>    <span class="token string">"fields"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token string">"é«˜äº®å­—æ®µåç§°"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token string">"pre_tags"</span><span class="token punctuation">:</span> <span class="token string">"&lt;em&gt;"</span><span class="token punctuation">,</span>        <span class="token string">"post_tags"</span><span class="token punctuation">:</span> <span class="token string">"&lt;/em&gt;"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li>ç´¢å¼• :<img src="/2024/04/14/28/%E4%B8%8Emysql%E5%AF%B9%E6%AF%94.png" alt="|725"><ul><li>å€’æ’ç´¢å¼•å’Œæ­£æ’ç´¢å¼•çš„åŒºåˆ«ï¼š<ul><li>æ­£æ’ç´¢å¼•æ˜¯è¯æ¡åˆ†åˆ°æ–‡æ¡£ä¸­</li><li>å€’æ’ç´¢å¼•æ˜¯ç»™è¯æ¡ç»Ÿè®¡æ–‡æ¡£</li><li><img src="/2024/04/14/28/%E4%BA%8C%E8%80%85%E5%8C%BA%E5%88%AB.png" alt="|275"></li></ul></li><li>ä½¿ç”¨ç´¢å¼•æ¨¡æ¿æ¥åŠ å¿«ç´¢å¼•çš„åˆ›å»ºä¸å±æ€§è®¾ç½®</li><li>ç´¢å¼•ç»“æ„ï¼šå€’æ’ç´¢å¼•ï¼Œä½¿ç”¨åˆ†è¯ï¼Œè®°å½•æ¯ä¸€ä¸ªåˆ†è¯å‡ºç°çš„æ–‡æ¡£ç¼–å·å’Œåœ¨æ–‡æ¡£ä¸­å‡ºç°çš„ä½ç½®<ul><li><img src="/2024/04/14/28/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95.jpg"></li><li>æœç´¢æ¨¡å—ï¼Œè·¯ç”±å€¼æ—¶ï¼Œ</li></ul></li><li>ç´¢å¼•æœç´¢ï¼š<ul><li>å½“æœç´¢è¯·æ±‚ä¸å¸¦è·¯ç”±å€¼æ—¶ï¼Œæ¥æ”¶åˆ°è¯·æ±‚çš„èŠ‚ç‚¹æˆä¸ºåè°ƒèŠ‚ç‚¹ï¼Œä¹‹åä¼šé€‰æ‹©ä½¿ç”¨çš„åˆ†ç‰‡ï¼Œä¹‹åä¼šè½¬å‘è¯·æ±‚åˆ°æ‹¥æœ‰è¿™äº›åˆ†ç‰‡çš„èŠ‚ç‚¹ä¸Šï¼Œæ¯ä¸ªåˆ†ç‰‡äº§ç”Ÿä¸€éƒ¨åˆ†çš„å±€éƒ¨ç»“æœæ±‡æ€»ç»™åè°ƒèŠ‚ç‚¹ï¼Œç”±åè°ƒèŠ‚ç‚¹æ±‡æ€»å¹¶æ’åºä¹‹åè¿”å›ã€‚</li><li>ä½¿ç”¨è·¯ç”±æ¡ä»¶è¿›è¡Œæœç´¢æ—¶ï¼Œä¼šå°†è¯·æ±‚è½¬å‘ï¼Œä¹‹åç›´æ¥ç”±é€‰ä¸­çš„èŠ‚ç‚¹è¿›è¡Œè¿”å›</li></ul></li><li>ç´¢å¼•æ˜ å°„ï¼š<ul><li>ç›¸å½“äºæŒ‡å®šäº†ç´¢å¼•å­—æ®µçš„åå­—å’Œèƒ½å¤Ÿå­˜å‚¨çš„ç±»å‹</li><li>å¸¸ç”¨çš„æ•°æ®ç±»å‹ï¼šlong , integer,short,byte,double,date(dateå¯ä»¥åœ¨åé¢åŠ ä¸€ä¸ªformatå­—æ®µæ¥æ‰§è¡Œæ—¶é—´çš„æ ¼å¼è½¬æ¢),keyword(ç”¨äºä¿å­˜åŸå§‹æ–‡æœ¬ï¼Œä¸ä¼šè¿›è¡Œåˆ†è¯å¤„ç†ï¼Œç”¨äºç²¾ç¡®åŒ¹é…)ï¼Œboolean,geo_poinstç»çº¬åº¦ç±»å‹ï¼Œjsonæ ¼å¼(éœ€è¦ä½¿ç”¨propertiesæ¥æŒ‡å®šå†…éƒ¨å¯¹è±¡çš„å±æ€§ï¼Œå®é™…å­˜å‚¨æ—¶ä¼šä½¿ç”¨ . æ¥è¡¨ç¤ºå±‚æ¬¡ç»“æ„)ï¼Œlists(æ•°ç»„)</li><li>**<em>å¦‚ä½•æ—¢èƒ½å¿«é€ŸåŒ¹é…ï¼Œåˆèƒ½ç²¾ç¡®åŒ¹é…?</em>**ï¼Œç»™å­—æ®µæ·»åŠ ä¸€ä¸ªfieldså‚æ•°ï¼Œç„¶ååœ¨é‡Œé¢æ”¾ä¸€ä¸ªkeywordå­—æ®µ</li><li>åœ¨æ¯ä¸€ä¸ªå­—æ®µçš„åé¢ä½¿ç”¨ï¼šâ€copy_toâ€:â€å¤åˆ¶å‡ºæ¥çš„æ–°å­—æ®µåå­—â€ å¯ä»¥åšåˆ°å¤åˆ¶è¿™äº›å­—æ®µçš„å†…å®¹</li></ul></li></ul></li></ul><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">PUT mysougoulog/_mapping</span> <span class="token punctuation">{</span>  <span class="token string">"properties"</span><span class="token punctuation">:</span><span class="token punctuation">{</span>      <span class="token string">"visitTime"</span><span class="token punctuation">:</span><span class="token punctuation">{</span>        <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"date"</span><span class="token punctuation">,</span>        <span class="token string">"format"</span><span class="token punctuation">:</span><span class="token string">"yyyy-MM-dd HH:mm:ss || epoch_millis"</span><span class="token punctuation">,</span>        <span class="token string">"ignore_malformed"</span><span class="token punctuation">:</span>true # è¿™ä¸ªå­—æ®µç±»å‹ä¸å¯¹æ—¶ï¼Œä¸å†™å…¥ï¼Œä½†æ˜¯ä¸å½±å“å…¶ä»–å­—æ®µçš„å†™å…¥      <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token selector"># äºŒè€…å…¼å¾—PUT mysougoulog/_mapping</span> <span class="token punctuation">{</span>    <span class="token string">"properties"</span><span class="token punctuation">:</span><span class="token punctuation">{</span>        <span class="token string">"key"</span><span class="token punctuation">:</span><span class="token punctuation">{</span>          <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"text"</span><span class="token punctuation">,</span>          <span class="token string">"fields"</span><span class="token punctuation">:</span><span class="token punctuation">{</span>            <span class="token string">"keyword"</span><span class="token punctuation">:</span><span class="token punctuation">{</span>              <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"keyword"</span><span class="token punctuation">,</span>              <span class="token string">"ignore_above"</span><span class="token punctuation">:</span>256 # è¡¨ç¤º256ä¸ªå­—ç¬¦åé¢çš„å†…å®¹è¢«å¿½ç•¥ï¼Œç”¨æ¥èŠ‚çœå­—æ®µ            <span class="token punctuation">}</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ–‡æ¡£ï¼š<ul><li>CRUDæ—¶å¦‚ä½•æ§åˆ¶å¹¶å‘ï¼š<ul><li>ä¿®æ”¹æ—¶ï¼ŒåŠ ä¸Š?if_seq_no = xx&amp;if_primary_term=xxæ¥ä½¿ç”¨ä¹è§‚é”æ¥æ§åˆ¶ï¼Œè¿™ä¸¤ä¸ªå­—æ®µæ˜¯å¯ä»¥æŸ¥åˆ°çš„ï¼ŒElastisearchä¸æ”¯æŒäº‹åŠ¡ç®¡ç†</li></ul></li><li>æ–‡æœ¬åˆ†æï¼š<ul><li>æ–‡æœ¬åˆ†æéœ€è¦ç»è¿‡&gt;=0ä¸ªå­—ç¬¦è¿‡æ»¤å™¨ä¸€ä¸ªåˆ†è¯å™¨ï¼Œ&gt;=0 ä¸ªåˆ†è¯è¿‡æ»¤å™¨<ul><li>å­—ç¬¦è¿‡æ»¤å™¨ï¼šå¯¹åŸå§‹æ–‡æ¡£æœ¬è¿›è¡Œè½¬æ¢ï¼Œå¦‚å»æ‰htmlæ ‡ç­¾</li><li>åˆ†è¯å™¨ï¼šæŒ‰ç…§è§„åˆ™åˆ‡åˆ†ä¸ºå•è¯ï¼Œ</li><li>åˆ†è¯è¿‡æ»¤å™¨ï¼šè¿‡æ»¤æ‰ä¸€äº›æ²¡æœ‰ç”¨çš„è¯æ¯”å¦‚ï¼Œçš„ï¼Œåˆ é™¤åœç”¨è¯,ä¹Ÿå¯è¿›è¡Œåˆ†è¯çš„å¤„ç†ï¼Œå¦‚å¤§å°å†™è½¬åŒ–ï¼Œæ·»åŠ åŒä¹‰è¯</li></ul></li></ul></li></ul></li><li>åˆ†è¯å™¨ï¼š<ul><li>åˆ›å»ºå€’æ’ç´¢å¼•æ—¶å¯¹æ–‡æ¡£è¿›è¡Œåˆ†è¯ï¼Œç”¨æˆ·æœç´¢æ—¶ï¼Œå¯¹è¾“å…¥çš„å†…å®¹è¿›è¡Œåˆ†è¯</li><li>IKåˆ†è¯å™¨ï¼š<ul><li>ik_smart æ™ºèƒ½åˆ‡åˆ†æ¨¡å¼ï¼Œç²—ç²’åº¦</li><li>ik_max_wordï¼šæœ€ç»†åˆ‡åˆ†ï¼Œç»†ç²’åº¦</li></ul></li></ul></li><li><h2 id="æ•°æ®ï¼š-æœç´¢æ•°æ®ï¼š-1-ç²¾ç¡®æœç´¢ï¼šæœç´¢å†…å®¹ä¸ç»è¿‡æ–‡æœ¬åˆ†æç›´æ¥è¿›è¡Œæ–‡æœ¬åŒ¹é…ï¼Œé€‚ç”¨äºétextç±»ï¼Œä¸€èˆ¬ç”¨äºkeywordå­—æ®µ-2-å…¨æ–‡æ£€ç´¢ï¼šå¯¹æ£€ç´¢å†…å®¹å’Œå­—æ®µéƒ½ä¼šè¿›è¡Œæ–‡æœ¬åˆ†æ-3-ç»çº¬åº¦æœç´¢ï¼Œå¯ä»¥æŒ‡å®šæŸä¸ªåŒºåŸŸï¼Œä¾‹å¦‚âšª-4-å¤åˆæœç´¢ï¼š-å¸ƒå°”æœç´¢ï¼šé€šè¿‡æŒ‡å®šå¸ƒå°”é€»è¾‘æ¡ä»¶æ¥ç»„ç»‡å¤šæ¡æŸ¥è¯¢è¯­å¥ï¼ŒåŒæ—¶æ»¡è¶³æ•´ä¸ªå¸ƒå°”æ¡ä»¶çš„æ‰ä¼šè¢«æœç´¢å‡ºæ¥-ç­‰ç­‰-çˆ¶å­å…³è”-å› ä¸ºesä¼šæŠŠæ•°æ®æŠ˜å èµ·æ¥ï¼Œä½¿ç”¨ç‚¹ï¼Œæ‰€ä»¥å½“ä¸€ä¸ªå¯¹è±¡æœ‰å¤šä¸ªç›¸åŒçš„keyæ—¶ï¼Œä¸èƒ½è¿›è¡Œæœç´¢äº†ï¼Œä¾‹å¦‚goodså•†å“ï¼Œé‡Œé¢å­˜æ”¾å•†å“idå’Œç”Ÿäº§æ—¶é—´ï¼Œå°±ä¼šè¢«æŠ˜å -è­¦å‘Šï¼š-é¿å…ä½¿ç”¨å¯¹è±¡æ•°ç»„-è§£å†³æ–¹æ³•ï¼šä½¿ç”¨åµŒå¥—å¯¹è±¡-ä½¿ç”¨joinå­—æ®µæ¥æ˜ç¡®çˆ¶å­å…³ç³»-èšé›†ç»Ÿè®¡ï¼šç”¨äºåˆ†æç´¢å¼•å’Œæ–‡æ¡£ï¼Œç±»ä¼¼äºmysqlä¸­çš„èšé›†æ“ä½œ"><a href="#æ•°æ®ï¼š-æœç´¢æ•°æ®ï¼š-1-ç²¾ç¡®æœç´¢ï¼šæœç´¢å†…å®¹ä¸ç»è¿‡æ–‡æœ¬åˆ†æç›´æ¥è¿›è¡Œæ–‡æœ¬åŒ¹é…ï¼Œé€‚ç”¨äºétextç±»ï¼Œä¸€èˆ¬ç”¨äºkeywordå­—æ®µ-2-å…¨æ–‡æ£€ç´¢ï¼šå¯¹æ£€ç´¢å†…å®¹å’Œå­—æ®µéƒ½ä¼šè¿›è¡Œæ–‡æœ¬åˆ†æ-3-ç»çº¬åº¦æœç´¢ï¼Œå¯ä»¥æŒ‡å®šæŸä¸ªåŒºåŸŸï¼Œä¾‹å¦‚âšª-4-å¤åˆæœç´¢ï¼š-å¸ƒå°”æœç´¢ï¼šé€šè¿‡æŒ‡å®šå¸ƒå°”é€»è¾‘æ¡ä»¶æ¥ç»„ç»‡å¤šæ¡æŸ¥è¯¢è¯­å¥ï¼ŒåŒæ—¶æ»¡è¶³æ•´ä¸ªå¸ƒå°”æ¡ä»¶çš„æ‰ä¼šè¢«æœç´¢å‡ºæ¥-ç­‰ç­‰-çˆ¶å­å…³è”-å› ä¸ºesä¼šæŠŠæ•°æ®æŠ˜å èµ·æ¥ï¼Œä½¿ç”¨ç‚¹ï¼Œæ‰€ä»¥å½“ä¸€ä¸ªå¯¹è±¡æœ‰å¤šä¸ªç›¸åŒçš„keyæ—¶ï¼Œä¸èƒ½è¿›è¡Œæœç´¢äº†ï¼Œä¾‹å¦‚goodså•†å“ï¼Œé‡Œé¢å­˜æ”¾å•†å“idå’Œç”Ÿäº§æ—¶é—´ï¼Œå°±ä¼šè¢«æŠ˜å -è­¦å‘Šï¼š-é¿å…ä½¿ç”¨å¯¹è±¡æ•°ç»„-è§£å†³æ–¹æ³•ï¼šä½¿ç”¨åµŒå¥—å¯¹è±¡-ä½¿ç”¨joinå­—æ®µæ¥æ˜ç¡®çˆ¶å­å…³ç³»-èšé›†ç»Ÿè®¡ï¼šç”¨äºåˆ†æç´¢å¼•å’Œæ–‡æ¡£ï¼Œç±»ä¼¼äºmysqlä¸­çš„èšé›†æ“ä½œ" class="headerlink" title="æ•°æ®ï¼š  - æœç´¢æ•°æ®ï¼š      1. ç²¾ç¡®æœç´¢ï¼šæœç´¢å†…å®¹ä¸ç»è¿‡æ–‡æœ¬åˆ†æç›´æ¥è¿›è¡Œæ–‡æœ¬åŒ¹é…ï¼Œé€‚ç”¨äºétextç±»ï¼Œä¸€èˆ¬ç”¨äºkeywordå­—æ®µ      2. å…¨æ–‡æ£€ç´¢ï¼šå¯¹æ£€ç´¢å†…å®¹å’Œå­—æ®µéƒ½ä¼šè¿›è¡Œæ–‡æœ¬åˆ†æ      3. ç»çº¬åº¦æœç´¢ï¼Œå¯ä»¥æŒ‡å®šæŸä¸ªåŒºåŸŸï¼Œä¾‹å¦‚âšª      4. å¤åˆæœç´¢ï¼š          - å¸ƒå°”æœç´¢ï¼šé€šè¿‡æŒ‡å®šå¸ƒå°”é€»è¾‘æ¡ä»¶æ¥ç»„ç»‡å¤šæ¡æŸ¥è¯¢è¯­å¥ï¼ŒåŒæ—¶æ»¡è¶³æ•´ä¸ªå¸ƒå°”æ¡ä»¶çš„æ‰ä¼šè¢«æœç´¢å‡ºæ¥          - ç­‰ç­‰  - çˆ¶å­å…³è”:      - å› ä¸ºesä¼šæŠŠæ•°æ®æŠ˜å èµ·æ¥ï¼Œä½¿ç”¨ç‚¹ï¼Œæ‰€ä»¥å½“ä¸€ä¸ªå¯¹è±¡æœ‰å¤šä¸ªç›¸åŒçš„keyæ—¶ï¼Œä¸èƒ½è¿›è¡Œæœç´¢äº†ï¼Œä¾‹å¦‚goodså•†å“ï¼Œé‡Œé¢å­˜æ”¾å•†å“idå’Œç”Ÿäº§æ—¶é—´ï¼Œå°±ä¼šè¢«æŠ˜å  è­¦å‘Šï¼š é¿å…ä½¿ç”¨å¯¹è±¡æ•°ç»„      - è§£å†³æ–¹æ³•ï¼šä½¿ç”¨åµŒå¥—å¯¹è±¡      - ä½¿ç”¨joinå­—æ®µæ¥æ˜ç¡®çˆ¶å­å…³ç³»  - èšé›†ç»Ÿè®¡ï¼šç”¨äºåˆ†æç´¢å¼•å’Œæ–‡æ¡£ï¼Œç±»ä¼¼äºmysqlä¸­çš„èšé›†æ“ä½œ"></a>æ•°æ®ï¼š<br>  - æœç´¢æ•°æ®ï¼š<br>      1. ç²¾ç¡®æœç´¢ï¼šæœç´¢å†…å®¹ä¸ç»è¿‡æ–‡æœ¬åˆ†æç›´æ¥è¿›è¡Œæ–‡æœ¬åŒ¹é…ï¼Œé€‚ç”¨äºétextç±»ï¼Œä¸€èˆ¬ç”¨äºkeywordå­—æ®µ<br>      2. å…¨æ–‡æ£€ç´¢ï¼šå¯¹æ£€ç´¢å†…å®¹å’Œå­—æ®µéƒ½ä¼šè¿›è¡Œæ–‡æœ¬åˆ†æ<br>      3. ç»çº¬åº¦æœç´¢ï¼Œå¯ä»¥æŒ‡å®šæŸä¸ªåŒºåŸŸï¼Œä¾‹å¦‚âšª<br>      4. å¤åˆæœç´¢ï¼š<br>          - å¸ƒå°”æœç´¢ï¼šé€šè¿‡æŒ‡å®šå¸ƒå°”é€»è¾‘æ¡ä»¶æ¥ç»„ç»‡å¤šæ¡æŸ¥è¯¢è¯­å¥ï¼ŒåŒæ—¶æ»¡è¶³æ•´ä¸ªå¸ƒå°”æ¡ä»¶çš„æ‰ä¼šè¢«æœç´¢å‡ºæ¥<br>          - ç­‰ç­‰<br>  - çˆ¶å­å…³è”:<br>      - å› ä¸ºesä¼šæŠŠæ•°æ®æŠ˜å èµ·æ¥ï¼Œä½¿ç”¨ç‚¹ï¼Œæ‰€ä»¥å½“ä¸€ä¸ªå¯¹è±¡æœ‰å¤šä¸ªç›¸åŒçš„keyæ—¶ï¼Œä¸èƒ½è¿›è¡Œæœç´¢äº†ï¼Œä¾‹å¦‚goodså•†å“ï¼Œé‡Œé¢å­˜æ”¾å•†å“idå’Œç”Ÿäº§æ—¶é—´ï¼Œå°±ä¼šè¢«æŠ˜å  <strong>è­¦å‘Šï¼š</strong> é¿å…ä½¿ç”¨å¯¹è±¡æ•°ç»„<br>      - è§£å†³æ–¹æ³•ï¼šä½¿ç”¨åµŒå¥—å¯¹è±¡<br>      - ä½¿ç”¨joinå­—æ®µæ¥æ˜ç¡®çˆ¶å­å…³ç³»<br>  - èšé›†ç»Ÿè®¡ï¼šç”¨äºåˆ†æç´¢å¼•å’Œæ–‡æ¡£ï¼Œç±»ä¼¼äºmysqlä¸­çš„èšé›†æ“ä½œ</h2></li><li>é›†ç¾¤ï¼š<ol><li>æ–°é›†ç¾¤çš„äº§ç”Ÿï¼šmasterèŠ‚ç‚¹çš„èŒè´£ä¸»è¦åŒ…æ‹¬é›†ç¾¤ã€èŠ‚ç‚¹å’Œç´¢å¼•çš„ç®¡ç†ï¼Œä¸è´Ÿè´£æ–‡æ¡£çº§åˆ«çš„ç®¡ç†ï¼Œä¸»èŠ‚ç‚¹å’Œæ•°æ®èŠ‚ç‚¹ä¸æ˜¯ä¸€ä¸ª<ul><li>åˆå§‹åŒ–æŠ•ç¥¨é…ç½®ï¼šå°†é…ç½®æ–‡ä»¶ä¸­çš„å€™é€‰èŠ‚ç‚¹å†™å…¥æŠ•ç¥¨é…ç½®ï¼Œæ‰€æœ‰èŠ‚ç‚¹å‡å¯å‚ä¸æŠ•ç¥¨</li><li>é€‰ä¸¾ä¸»èŠ‚ç‚¹ï¼šè¶…è¿‡åŠæ•°å°±å¯æˆä¸ºä¸»èŠ‚ç‚¹</li><li>å‘ç°é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹å°è¯•è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¿æ¥ä¸Šä¹‹åä¸»èŠ‚ç‚¹æŠŠæœ€æ–°çš„çŠ¶æ€å‘å¸ƒåˆ°è¿™äº›èŠ‚ç‚¹ä¸­</li><li>é›†ç¾¤å®Œæˆï¼Œå¯¹å¤–å¯åŠ¨ç»Ÿä¸€çš„æœåŠ¡</li></ul></li><li>é›†ç¾¤çŠ¶æ€çš„å‘å¸ƒè¿‡ç¨‹:  <strong>åˆ é™¤æˆ–è€…æ–°å¢èŠ‚ç‚¹æ—¶è§¦å‘</strong><ul><li>ä¸»èŠ‚ç‚¹æŠŠæœ€æ–°çš„é›†ç¾¤çŠ¶æ€å‘é€åˆ°æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹å°†æ•°æ®ä¿å­˜å¹¶å‘ä¸»èŠ‚ç‚¹å‘é€ç¡®è®¤å“åº”</li><li>ä¸»èŠ‚ç‚¹æ¥æ”¶åˆ°åŠæ•°ä»¥ä¸Šçš„ç¡®è®¤æ¶ˆæ¯ï¼Œå¼€å§‹æäº¤ï¼Œå‘é€ç»™æ¯ä¸ªèŠ‚ç‚¹é€šçŸ¥ä½¿ç”¨æœ€æ–°çš„é›†ç¾¤çŠ¶æ€ï¼Œå­èŠ‚ç‚¹æ¥æ”¶åå‘é€ç¡®è®¤å“åº”ï¼Œæ‰€æœ‰çš„éƒ½ç¡®è®¤å³å¯å®Œæˆå‘å¸ƒ</li><li>å“åº”è¶…è¿‡æ—¶é—´é™åˆ¶ï¼Œåˆ™åˆ é™¤è¿™ä¸ªå­èŠ‚ç‚¹</li></ul></li></ol></li><li>å¦‚ä½•å®ç°masteré€‰ä¸¾ï¼Ÿ<ul><li>å¯¹äºæ‰€æœ‰å¯ä»¥æˆä¸ºmasterçš„èŠ‚ç‚¹ï¼Œæ ¹æ®nodeIdæ¥æ’åºï¼Œæ¯ä¸ªèŠ‚ç‚¹æŠŠè‡ªå·±ç›´åˆ°çš„èŠ‚ç‚¹æ’ä¸€æ¬¡åºï¼Œç„¶åé€‰å‡ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè®¤ä¸ºä»–æ˜¯masterèŠ‚ç‚¹ï¼Œå…¥è‚¡æŸä¸ªèŠ‚ç‚¹åˆ°è¾¾å¯ä»¥æˆä¸ºè¶…è¿‡masterèŠ‚ç‚¹çš„ä¸€åŠï¼Œé‚£å°±æˆä¸ºäº†masterèŠ‚ç‚¹</li></ul></li><li>è„‘è£‚é—®é¢˜ï¼š<ul><li>è®¾ç½®æœ€å°ä¸»èŠ‚ç‚¹è®¾ç½®ï¼Œè®¾ç½®çš„å€¼åº”è¯¥æ˜¯é›†ç¾¤ä¸­èŠ‚ç‚¹æ€»æ•°çš„ä¸€åŠ + 1</li></ul></li><li>è¯»å†™ä¸€è‡´ï¼š<ul><li>ç‰ˆæœ¬æ§åˆ¶ï¼šæ¯ä¸ªæ–‡æ¡£åœ¨ESä¸­éƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡è¢«ä¿®æ”¹åï¼Œç‰ˆæœ¬å·ä¼šå¢åŠ ï¼Œè·å–æ–‡æ¡£æ—¶ï¼Œä¼šåŒæ—¶æˆ–è€…å®ƒçš„ç‰ˆæœ¬å·ï¼Œæ›´æ–°æ—¶å¯ä»¥æŒ‡å®šè¿™ä¸ªç‰ˆæœ¬å·ï¼Œå¦‚æœç‰ˆæœ¬å·ä¸åŒ¹é…ï¼Œæ›´æ–°æ“ä½œå°±ä¼šè¢«æ‹’ç»</li><li>åˆ·æ–°ä¸åŒæ­¥ï¼šå‘ESä¸­å†™å…¥æ•°æ®æ—¶ï¼Œæ•°æ®å…ˆè¢«å†™å…¥å†…å­˜ç¼“å†²åŒºï¼Œç„¶åæ¯éš”ä¸€æ®µæ—¶é—´åˆ·æ–°ä¸€æ¬¡æˆ–è€…ç¼“å†²åŒºæ»¡æ—¶è¢«åˆ·æ–°åˆ°ç£ç›˜åå°±å¯ä»¥è¢«æœç´¢åˆ°äº†ï¼Œä½†æ˜¯æ²¡æœ‰è¢«å†™å…¥ç£ç›˜ï¼Œä¹‹åå®šæœŸåŒæ­¥åˆ°ç£ç›˜ä¸­ï¼ŒåŒæ­¥åå°±æ˜¯æŒä¹…åŒ–å­˜å‚¨äº†</li><li>å‰¯æœ¬å’Œåˆ†ç‰‡:åªæœ‰ä¸»èŠ‚ç‚¹å¯ä»¥å†™å…¥æ•°æ®ï¼Œç„¶åè¢«å¤åˆ¶åˆ°å‰¯æœ¬åˆ†ç‰‡ä¸­ï¼Œè¯»å–æ•°æ®æ—¶å¯ä»¥ä»ä»»ä½•ä¸€ä¸ªåŒ…å«è¯¥æ•°æ®çš„åˆ†ç‰‡ä¸­è·å–</li><li>è®¾ç½®å†™å…¥ç¡®è®¤çº§åˆ«</li></ul></li><li>ä»£ç ä¸­ä½¿ç”¨:<img src="/2024/04/14/28/%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%811.png" alt="|575"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">void</span> <span class="token function">testMatchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>    <span class="token comment">// 1.åˆ›å»ºRequest</span>    <span class="token class-name">SearchRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token string">"items"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 2.ç»„ç»‡è¯·æ±‚å‚æ•°</span>    request<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchAllQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 3.å‘é€è¯·æ±‚</span>    <span class="token class-name">SearchResponse</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 4.è§£æå“åº”</span>    <span class="token function">handleResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token class-name">SearchResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">SearchHits</span> searchHits <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 1.è·å–æ€»æ¡æ•°</span>    <span class="token keyword">long</span> total <span class="token operator">=</span> searchHits<span class="token punctuation">.</span><span class="token function">getTotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…±æœç´¢åˆ°"</span> <span class="token operator">+</span> total <span class="token operator">+</span> <span class="token string">"æ¡æ•°æ®"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 2.éå†ç»“æœæ•°ç»„</span>    <span class="token class-name">SearchHit</span><span class="token punctuation">[</span><span class="token punctuation">]</span> hits <span class="token operator">=</span> searchHits<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> hits<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 3.å¾—åˆ°_sourceï¼Œä¹Ÿå°±æ˜¯åŸå§‹jsonæ–‡æ¡£</span>        <span class="token class-name">String</span> source <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 4.ååºåˆ—åŒ–å¹¶æ‰“å°</span>        <span class="token class-name">ItemDoc</span> item <span class="token operator">=</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token class-name">ItemDoc</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> es </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k8s</title>
      <link href="/2024/04/11/19/"/>
      <url>/2024/04/11/19/</url>
      
        <content type="html"><![CDATA[<p>æ‰§è¡Œkubeadm æ—¶æŠ¥é”™ï¼Œ</p>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MQ</title>
      <link href="/2024/04/07/18/"/>
      <url>/2024/04/07/18/</url>
      
        <content type="html"><![CDATA[<h1 id="é¢è¯•å¸¸é—®ï¼š"><a href="#é¢è¯•å¸¸é—®ï¼š" class="headerlink" title="é¢è¯•å¸¸é—®ï¼š"></a>é¢è¯•å¸¸é—®ï¼š</h1><h2 id="ç”Ÿäº§è€…å‡ºç°å †ç§¯å¦‚ä½•è§£å†³"><a href="#ç”Ÿäº§è€…å‡ºç°å †ç§¯å¦‚ä½•è§£å†³" class="headerlink" title="ç”Ÿäº§è€…å‡ºç°å †ç§¯å¦‚ä½•è§£å†³"></a>ç”Ÿäº§è€…å‡ºç°å †ç§¯å¦‚ä½•è§£å†³</h2><ol><li>å¢åŠ æ¶ˆè´¹è€…</li><li>ä¼˜åŒ–æ¶ˆè´¹è€…çš„å¤„ç†é€Ÿåº¦</li><li>ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼Œä¼˜å…ˆå¤„ç†ä¼˜å…ˆçº§é«˜çš„æ¶ˆæ¯</li><li>æ¶ˆæ¯å‹ç¼©ï¼šå¦‚æœç½‘ç»œå¸¦å®½æ˜¯ç“¶é¢ˆ</li><li>å‡çº§è®¾å¤‡</li><li>æ¶ˆæ¯è¿‡æ»¤ï¼šç”Ÿäº§è€…ç«¯å‘é€çœŸæ­£éœ€è¦å¤„ç†çš„æ¶ˆæ¯</li><li>è°ƒæ•´ç”Ÿäº§è€…çš„é€Ÿåº¦</li></ol><h2 id="ç”Ÿäº§æ¶ˆè´¹è¿‡ç¨‹ä¸­å¦‚æœæœåŠ¡å‡ºç°å¼‚å¸¸ï¼Œå¦‚ä½•æ¢å¤"><a href="#ç”Ÿäº§æ¶ˆè´¹è¿‡ç¨‹ä¸­å¦‚æœæœåŠ¡å‡ºç°å¼‚å¸¸ï¼Œå¦‚ä½•æ¢å¤" class="headerlink" title="ç”Ÿäº§æ¶ˆè´¹è¿‡ç¨‹ä¸­å¦‚æœæœåŠ¡å‡ºç°å¼‚å¸¸ï¼Œå¦‚ä½•æ¢å¤"></a>ç”Ÿäº§æ¶ˆè´¹è¿‡ç¨‹ä¸­å¦‚æœæœåŠ¡å‡ºç°å¼‚å¸¸ï¼Œå¦‚ä½•æ¢å¤</h2><ol><li>é‡è¯•æœºåˆ¶ï¼š</li><li>æ­»ä¿¡é˜Ÿåˆ—ï¼šå°†æ— æ³•å¤„ç†çš„æ¶ˆæ¯æ”¾åœ¨ä¸€ä¸ªç‰¹æ®Šçš„é˜Ÿåˆ—ä¸­ï¼Œç”±äººå·¥å»å¤„ç†æˆ–è€…ç‰¹æ®Šå¤„ç†</li><li>å¤‡ä»½å’Œæ¢å¤ï¼šå¯¹äºé‡è¦æ•°æ®åº”è¯¥å®šæœŸè¿›è¡Œå¤‡ä»½ï¼Œå½“æœåŠ¡å‡ºç°å¼‚å¸¸æ—¶ï¼Œä»å¤‡ä»½ä¸­æ¢å¤æ•°æ®ã€‚</li><li>æœåŠ¡é™çº§</li><li>å®¹é”™å’Œå†—ä½™è®¾è®¡</li></ol><h2 id="AMQPåè®®"><a href="#AMQPåè®®" class="headerlink" title="AMQPåè®®"></a>AMQPåè®®</h2><ul><li>AMQ Modelç»„ä»¶ï¼š<ol><li>Producer </li><li>Exchange äº¤æ¢å™¨ï¼Œä»Producerä¸­æ”¶é›†æ¶ˆæ¯å¹¶æ ¹æ®è·¯ç”±è§„åˆ™å‘é€åˆ°å¯¹åº”çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­</li><li>Queue æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯ï¼Œç›´åˆ°æ¶ˆæ¯è¢«å®‰å…¨çš„æŠ•é€’åˆ°äº†æ¶ˆè´¹è€…</li><li>Binding å®šä¹‰äº† mq å’Œ exchangeä¹‹é—´çš„å…³ç³»ï¼Œæ˜¯è·¯ç”±è¡¨</li><li>Consumer</li></ol></li></ul><h2 id="RocketMQ"><a href="#RocketMQ" class="headerlink" title="RocketMQ"></a>RocketMQ</h2><p><a href="https://javaguide.cn/high-performance/message-queue/rocketmq-questions.html">å¸¸è§é—®é¢˜</a></p><p><img src="/2024/04/07/18/%E8%A7%92%E8%89%B2.png"></p><ol><li>ç”Ÿäº§è€…ç»„-&gt;å‘é€æ¶ˆæ¯çš„ä¸€æ–¹<ul><li>æ¶ˆæ¯çš„ç±»å‹ï¼š<ol><li>æ™®é€šæ¶ˆæ¯ï¼šå¹¶å‘æ¶ˆæ¯ï¼Œå¹¶å‘æ¶ˆæ¯æ²¡æœ‰é¡ºåº</li><li>åˆ†åŒºæœ‰åºæ¶ˆæ¯:æŠŠä¸€ä¸ªTopicæ¶ˆæ¯åˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼Œä¿æŠ¤å’Œæ¶ˆè´¹ï¼Œåˆ†åŒºå†…çš„æ¶ˆæ¯å°±æ˜¯é˜Ÿåˆ—ï¼ŒFIFO</li><li>å…¨å±€æœ‰åºï¼šæŠŠä¸€ä¸ªTopicåˆ†åŒºæ•°è®¾ä¸º1ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯éƒ½æ”¯æŒFIFO</li><li>å»¶è¿Ÿæ¶ˆæ¯ï¼šæ¶ˆæ¯å‘é€åï¼Œæ¶ˆè´¹è€…ä¸èƒ½ç«‹åˆ»æ¶ˆè´¹ï¼Œéœ€è¦ç­‰å¾…</li><li>äº‹åŠ¡æ¶ˆæ¯ï¼šæ¶‰åŠåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä¿è¯å¤šä¸ªæ“ä½œåŒæ—¶æˆåŠŸæˆ–è€…å¤±è´¥ï¼Œæ¶ˆè´¹è€…æ‰èƒ½ä½¿ç”¨</li><li><img src="/2024/04/07/18/%E4%B8%8D%E5%90%8C%E6%B6%88%E6%81%AF%E7%89%B9%E7%82%B9.png"></li></ol></li><li>æ¶ˆæ¯ä¿è¯æœºåˆ¶ï¼š<ol><li>å®¢æˆ·ç«¯ä¿è¯ï¼šé‡è¯•æœºåˆ¶å’Œå®¢æˆ·ç«¯å®¹é”™(é€‰æ‹©å»¶è¿Ÿè¾ƒä½çš„Brokeræ¥å‘é€æ¶ˆæ¯)</li><li>Brokerä¿è¯</li></ol></li><li>æ¶ˆæ¯å‘é€æµç¨‹:<ol><li>ä¸šåŠ¡å±‚è°ƒç”¨Client å‘é€APIä¸šåŠ¡ä»£ç </li><li>æ¶ˆæ¯å¤„ç†å±‚ï¼šClientè·å–æ¶ˆæ¯å¯¹è±¡åè¿›è¡Œå‚æ•°æ£€æŸ¥ï¼Œå‡†å¤‡å’Œå°è£…</li><li>é€šä¿¡å±‚ï¼šåŸºäºNettyå°è£…çš„RPCé€šä¿¡</li></ol></li></ul></li><li>Topicï¼š</li><li>æ¶ˆè´¹è€…ç»„ï¼š <ul><li>è®¢é˜…å…³ç³»ï¼šä¸€ä¸ªæ¶ˆè´¹è€…ç»„è®¢é˜…ä¸€ä¸ªTopicä¸­çš„æŸä¸€ä¸ªTag</li><li>æ¶ˆè´¹æ¨¡å¼ï¼š<ul><li>é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ï¼šåŒä¸€ä¸ªç»„ä¸­çš„æ¶ˆè´¹è€…å®ä¾‹è´Ÿè½½å‡è¡¡çš„æ¶ˆè´¹Topicä¸­çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹è¿›åº¦ä¿å­˜åœ¨Brokerç«¯ï¼Œå³ä½¿åº”ç”¨å´©æºƒï¼Œæ¶ˆè´¹è¿›åº¦ä¹Ÿä¸ä¼šå‡ºé”™</li><li>å¹¿æ’­æ¶ˆè´¹ï¼šæ‰€æœ‰æ¶ˆæ¯å¹¿æ’­åˆ†å‘ï¼Œå…¨éƒ¨çš„æ¶ˆè´¹è€…å®ä¾‹å¯ä»¥æ¶ˆè´¹æ•´ä¸ªTopicä¸­çš„æ‰€æœ‰æ¶ˆæ¯ï¼Œæ¶ˆè´¹è¿›åº¦ä¿å­˜å­å•Šå®¢æˆ·ç«¯æ–‡ä»¶ä¸­ï¼Œé€‚ç”¨äºé€šçŸ¥å…¶ä»–æœåŠ¡åˆ·æ–°ç¼“å­˜</li></ul></li><li>å¯é æ¶ˆè´¹ä¿è¯ï¼š<ol><li>é‡è¯•-æ­»ä¿¡æœºåˆ¶ï¼šæ­£å¸¸Topicé­é‡æ¶ˆè´¹å¤±è´¥å-&gt;æ¶ˆæ¯è¢«ä¿å­˜åœ¨é‡è¯•Topicä¸­-&gt;å¤šæ¬¡é—´éš”æ—¶é—´è¿›è¡Œé‡æ–°æ¶ˆè´¹åä»ç„¶å¤±è´¥-&gt;è¿›å…¥æ­»ä¿¡Topicï¼Œç»ç”±äººå·¥å¤„ç†ï¼Œä¸ä¼šå†è¢«æ¶ˆè´¹è€…æ¶ˆè´¹</li><li>Rebalanceæœºåˆ¶ï¼šé‡å¹³è¡¡ï¼Œ ç”¨äºåœ¨å‘ç”ŸBrokeræ‰çº¿ã€Topicæ‰©å®¹å’Œç¼©å®¹ã€æ¶ˆè´¹è€…æ‰©å®¹å’Œç¼©å®¹ç­‰å˜åŒ–æ—¶ï¼Œè‡ªåŠ¨æ„ŸçŸ¥å¹¶è°ƒæ•´è‡ªèº«æ¶ˆè´¹ï¼Œä»¥å°½é‡å‡å°‘ç”šè‡³é¿å…æ¶ˆæ¯æ²¡æœ‰è¢«æ¶ˆè´¹ã€‚</li></ol></li><li>æ¶ˆè´¹æ–¹å¼ï¼š<ol><li>pull ç”¨æˆ·ä¸»åŠ¨pullæ¶ˆæ¯ï¼Œè‡ªä¸»ç®¡ç†ä½ç‚¹ï¼Œç”±ç”¨æˆ·ä»£ç æ¥è¿›è¡Œç®¡ç†</li><li>push è‡ªåŠ¨pullæ¶ˆæ¯ï¼Œç”¨æˆ·å¯ç›´æ¥ä½¿ç”¨ï¼Œ</li></ol></li><li>æ¶ˆè´¹è¿‡æ»¤ï¼ŒBrokerç«¯å¯ä»¥æ ¹æ®tagè¿›è¡Œæ¶ˆè´¹è¿‡æ»¤ï¼Œåªè¿”å›æ»¡è¶³çš„tag,brokerç«¯ä½¿ç”¨Hashè¿‡æ»¤ï¼Œå®¢æˆ·ç«¯å†è¿›è¡Œä¸€æ¬¡Tagå­—ç¬¦ä¸²è¿‡æ»¤ï¼Œ å› ä¸ºHashè¿‡æ¥å§å¯ä»¥å¿«é€Ÿè¿‡æ»¤å¤§é‡æ•°æ®ï¼Œä½†æ˜¯å­˜åœ¨Hashç¢°æ’</li></ul></li></ol><ul><li>Namesrvé›†ç¾¤ï¼šä¸€ä¸ªæ— çŠ¶æ€çš„å…ƒæ•°æ®ç®¡ç†ï¼ŒNamesrvä¹‹äºRocketMQç­‰ä»·äºZookeeperä¹‹äºKafkaã€‚Topicè·¯ç”±æ³¨å†Œå’Œç®¡ç†ã€Brokeræ³¨å†Œå’Œå‘ç°çš„ç®¡ç†è€…</li></ul><h1 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h1><p><a href="https://javaguide.cn/high-performance/message-queue/rabbitmq-questions.html">å¸¸è§é—®é¢˜</a></p><h2 id="RabbitMQä¸»è¦æ¶æ„"><a href="#RabbitMQä¸»è¦æ¶æ„" class="headerlink" title="RabbitMQä¸»è¦æ¶æ„"></a>RabbitMQä¸»è¦æ¶æ„</h2><p><img src="/2024/04/07/18/RabbitMQ%E6%9E%B6%E6%9E%84.png" alt="RabbitMQæ¶æ„"></p><ul><li><p>**<code>publisher</code>**ï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯å‘é€æ¶ˆæ¯çš„ä¸€æ–¹</p></li><li><p>**<code>consumer</code>**ï¼šæ¶ˆè´¹è€…ï¼Œä¹Ÿå°±æ˜¯æ¶ˆè´¹æ¶ˆæ¯çš„ä¸€æ–¹</p></li><li><p>**<code>queue</code>**ï¼šé˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯ã€‚ç”Ÿäº§è€…æŠ•é€’çš„æ¶ˆæ¯ä¼šæš‚å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ¶ˆè´¹è€…å¤„ç†</p></li><li><p>**<code>exchange</code>**ï¼šäº¤æ¢æœºï¼Œè´Ÿè´£æ¶ˆæ¯è·¯ç”±ã€‚ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ç”±äº¤æ¢æœºå†³å®šæŠ•é€’åˆ°å“ªä¸ªé˜Ÿåˆ—ã€‚ä¸ä¼šæŒä¹…åŒ–æ•°æ®</p></li><li><p>**<code>virtual host</code>**ï¼šè™šæ‹Ÿä¸»æœºï¼Œèµ·åˆ°æ•°æ®éš”ç¦»çš„ä½œç”¨ã€‚æ¯ä¸ªè™šæ‹Ÿä¸»æœºç›¸äº’ç‹¬ç«‹ï¼Œæœ‰å„è‡ªçš„exchangeã€queueï¼Œä¹Ÿå°±æ˜¯å°†exchangeå’Œqueueè¿›è¡Œåˆ†ç»„</p></li></ul><h2 id="Springä¸­ä½¿ç”¨"><a href="#Springä¸­ä½¿ç”¨" class="headerlink" title="Springä¸­ä½¿ç”¨"></a>Springä¸­ä½¿ç”¨</h2><p>ä½¿ç”¨Spring AMQPæ¥å®ç°</p><h3 id="publisher"><a href="#publisher" class="headerlink" title="publisher"></a>publisher</h3><p>ä½¿ç”¨RabbitTemplateæ¥å‘é€æ¶ˆæ¯</p><h3 id="consumer"><a href="#consumer" class="headerlink" title="consumer"></a>consumer</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringRabbitListener</span> <span class="token punctuation">{</span>        <span class="token comment">// åˆ©ç”¨RabbitListeneræ¥å£°æ˜è¦ç›‘å¬çš„é˜Ÿåˆ—ä¿¡æ¯</span>    <span class="token comment">// å°†æ¥ä¸€æ—¦ç›‘å¬çš„é˜Ÿåˆ—ä¸­æœ‰äº†æ¶ˆæ¯ï¼Œå°±ä¼šæ¨é€ç»™å½“å‰æœåŠ¡ï¼Œè°ƒç”¨å½“å‰æ–¹æ³•ï¼Œå¤„ç†æ¶ˆæ¯ã€‚</span>    <span class="token comment">// å¯ä»¥çœ‹åˆ°æ–¹æ³•ä½“ä¸­æ¥æ”¶çš„å°±æ˜¯æ¶ˆæ¯ä½“çš„å†…å®¹</span>    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">"simple.queue"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenSimpleQueueMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"spring æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€"</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">"ã€‘"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äº¤æ¢æœºçš„ç±»å‹ï¼š"><a href="#äº¤æ¢æœºçš„ç±»å‹ï¼š" class="headerlink" title="äº¤æ¢æœºçš„ç±»å‹ï¼š"></a>äº¤æ¢æœºçš„ç±»å‹ï¼š</h2><h3 id="Fanout"><a href="#Fanout" class="headerlink" title="Fanout"></a><strong>Fanout</strong></h3><p>å¹¿æ’­ï¼Œå°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ—ã€‚æˆ‘ä»¬æœ€æ—©åœ¨æ§åˆ¶å°ä½¿ç”¨çš„æ­£æ˜¯Fanoutäº¤æ¢æœº<br>ç‰¹ç‚¹ï¼š</p><ol><li>å¯ä»¥æœ‰å¤šä¸ªé˜Ÿåˆ—</li><li>æ¯ä¸ªé˜Ÿåˆ—éƒ½è¦ç»‘å®šåˆ°Exchange</li><li>ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯åªèƒ½å‘é€åˆ°äº¤æ¢æœº</li><li>äº¤æ¢æœºæŠŠæ¶ˆæ¯å‘é€ç»™ç»‘å®šè¿‡çš„æ‰€æœ‰é˜Ÿåˆ—</li><li>è®¢é˜…é˜Ÿåˆ—çš„æ¶ˆè´¹è€…éƒ½èƒ½æ‹¿åˆ°æ¶ˆæ¯</li></ol><h3 id="Direct"><a href="#Direct" class="headerlink" title="Direct"></a><strong>Direct</strong></h3><p>è®¢é˜…ï¼ŒåŸºäºRoutingKeyï¼ˆè·¯ç”±keyï¼‰å‘é€ç»™è®¢é˜…äº†æ¶ˆæ¯çš„é˜Ÿåˆ—<br>ç‰¹ç‚¹ï¼š</p><ol><li>é˜Ÿåˆ—éœ€è¦ä¸äº¤æ¢æœºç»‘å®šï¼ŒæŒ‡å®šä¸€ä¸ªRountingKey</li><li>æ¶ˆæ¯å‘é€æ–¹å‘é€æ—¶ä¹Ÿéœ€è¦æŒ‡å®šRountingKey</li><li>ExchangeæŠŠæ¶ˆæ¯å‘é€ç»™RountingKeyå¯¹åº”çš„é˜Ÿåˆ—</li></ol><h3 id="Topic"><a href="#Topic" class="headerlink" title="Topic"></a><strong>Topic</strong></h3><p>é€šé…ç¬¦è®¢é˜…ï¼Œä¸Directç±»ä¼¼ï¼Œåªä¸è¿‡RoutingKeyå¯ä»¥ä½¿ç”¨é€šé…ç¬¦</p><ul><li><p><code>#</code>ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯</p></li><li><p><code>*</code>ï¼šåŒ¹é…ä¸å¤šä¸å°‘æ°å¥½1ä¸ªè¯<br>ä¸¾ä¾‹ï¼š</p></li><li><p><code>item.#</code>ï¼šèƒ½å¤ŸåŒ¹é…<code>item.spu.insert</code> æˆ–è€… <code>item.spu</code></p></li><li><p><code>item.*</code>ï¼šåªèƒ½åŒ¹é…<code>item.spu</code><br>ä¸DIrectç±»ä¼¼ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨é€šé…ç¬¦æ¥è¿›è¡Œé˜Ÿåˆ—ç»‘å®š</p></li><li><p><strong>Headers</strong>ï¼šå¤´åŒ¹é…ï¼ŒåŸºäºMQçš„æ¶ˆæ¯å¤´åŒ¹é…ï¼Œç”¨çš„è¾ƒå°‘ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mq </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Netty</title>
      <link href="/2024/03/30/44/"/>
      <url>/2024/03/30/44/</url>
      
        <content type="html"><![CDATA[<p>#todo </p><ul><li><input disabled="" type="checkbox"> ä½¿ç”¨Nettyæ›¿ä»£springbootçš„tomcatä½œä¸ºæœåŠ¡å™¨</li><li><input disabled="" type="checkbox"> ä½¿ç”¨Nettyæ›¿ä»£websocketæ¥é€šä¿¡</li><li><input disabled="" type="checkbox"> æ›´æ–°ä¸€ä¸‹ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œå¦‚ä½•æ›´é«˜æ•ˆï¼Œé¡ºä¾¿åŠ ä¸Šè§£é‡Š</li></ul><h1 id="åŸºæœ¬ä»‹ç»å’Œä½¿ç”¨ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»å’Œä½¿ç”¨ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»å’Œä½¿ç”¨ä»‹ç»"></a>åŸºæœ¬ä»‹ç»å’Œä½¿ç”¨ä»‹ç»</h1><h2 id="I-x2F-Oæ¨¡å‹ï¼š"><a href="#I-x2F-Oæ¨¡å‹ï¼š" class="headerlink" title="I/Oæ¨¡å‹ï¼š"></a>I/Oæ¨¡å‹ï¼š</h2><ol><li>é˜»å¡I/O BIOï¼šç¨‹åºå‘å†…æ ¸å‘èµ·I/Oè°ƒç”¨ï¼Œå‘èµ·è°ƒç”¨çš„çº¿ç¨‹å°±ä¸€ç›´ç­‰å¾…å†…æ ¸è¿”å›ç»“æœã€‚å¦‚æœä½¿ç”¨BIOå®ç°å¼‚æ­¥ï¼Œåªèƒ½ä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å‹ï¼Œä¼šå¯¼è‡´å¢åŠ çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ã€‚</li><li>åŒæ­¥éé˜»å¡IO NIOï¼šåº”ç”¨ç¨‹åºé€šè¿‡è½®è¯¢çš„æ–¹å¼è·å–è¯·æ±‚ç»“æœã€‚</li><li>å¤šè·¯å¤ç”¨I/Oï¼šå¤šä¸ªè¿›ç¨‹çš„I/Oå¯ä»¥æ³¨å†Œåˆ°ä¸€ä¸ªå¤ç”¨å™¨ä¸Š(Selector)ï¼Œå¦‚æœSelectorç›‘å¬çš„æ‰€æœ‰çš„I/Oå†…æ ¸ç¼“å†²åŒºéƒ½æ²¡æœ‰å¯è¯»æ•°æ®ï¼Œselectè°ƒç”¨ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°ä»»æ„I/Oåœ¨å†…æ ¸ç¼“å†²åŒºä¸­æœ‰åˆ»åº¦æ•°æ®æ—¶ï¼Œä¼šç«‹åˆ»è¿”å›ã€‚å¹¶é€šçŸ¥å…¶ä»–è¿›ç¨‹å†æ¬¡å‘èµ·I/Oï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ç›‘æ§å¤šä¸ªIOæ“ä½œã€‚ </li><li>ä¿¡å·é©±åŠ¨I/Oï¼šè¿›ç¨‹é¢„å…ˆå‘ŠçŸ¥å†…æ ¸ï¼Œå‘å†…æ ¸æ³¨å†Œä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œä¹‹åè¿›ç¨‹è¿”å›ä¸é˜»å¡ï¼Œè¿›ç¨‹é€šè¿‡ä¿¡å·å¤„ç†å‡½æ•°ç»§ç»­è°ƒç”¨I/Oè¯»å–æ•°æ®ã€‚IOæ“ä½œå°±ç»ªåï¼Œæ“ä½œç³»ç»Ÿä¼šå‘é€ä¿¡å·é€šçŸ¥åº”ç”¨ç¨‹åºã€‚ é€šçŸ¥ä½•æ—¶å¯ä»¥å¼€å§‹ä¸€ä¸ªI/Oæ“ä½œ</li><li>å¼‚æ­¥I/O AIOï¼šåº”ç”¨ç¨‹åºå‘èµ·IOæ“ä½œä¹‹åï¼Œç«‹åˆ»è¿”å›ï¼Œæ“ä½œç³»ç»Ÿåœ¨IOæ“ä½œæ‰§è¡Œåï¼Œä¼šé€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºæ— éœ€è½®è¯¢IOçŠ¶æ€ã€‚ é€šçŸ¥I/Oæ“ä½œä½•æ—¶ç»“æŸ</li></ol><ul><li>BIOå’ŒNIOçš„åŒºåˆ«: <img src="/2024/03/30/44/BIOandNIO.png"></li><li>AIO-&gt;å¼‚æ­¥I/O</li></ul><h3 id="Reactor-æ¨¡å‹"><a href="#Reactor-æ¨¡å‹" class="headerlink" title="Reactor æ¨¡å‹"></a>Reactor æ¨¡å‹</h3><blockquote><p>æ˜¯ä¸€ç§å¤„ç†å¹¶å‘I/Oæ“ä½œçš„è®¾è®¡æ¨¡å¼ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å®è·µå¤šè·¯å¤ç”¨æœºåˆ¶æ¥ç®¡ç†å¤šä¸ªI/Oäº‹ä»¶ã€‚<br>ä¸»è¦çš„ç»„ä»¶ï¼š1. äº‹ä»¶å¤šè·¯åˆ†å‘å™¨(è´Ÿè´£ç›‘å¬å¤šä¸ªI/Oäº‹ä»¶ï¼Œå°†è¿™äº›äº‹ä»¶åˆ†å‘ç»™ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨)<br>2.äº‹ä»¶å¤„ç†å™¨ 3.äº‹ä»¶åˆ†å‘å™¨ï¼šå°†äº‹ä»¶ä»å¤šè·¯åˆ†å‘å™¨ä¸­åˆ†å‘åˆ°å“åº”çš„å¤„ç†å™¨ã€‚</p></blockquote><h3 id="selectã€pollã€epollçš„åŒºåˆ«"><a href="#selectã€pollã€epollçš„åŒºåˆ«" class="headerlink" title="selectã€pollã€epollçš„åŒºåˆ«"></a>selectã€pollã€epollçš„åŒºåˆ«</h3><ol><li>selectï¼šå°†å·²è¿æ¥çš„Socketéƒ½æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆä¸­ï¼Œç„¶åè°ƒç”¨selectå‡½æ•°å°†æ–‡ä»¶æè¿°é›†åˆæ‹·è´åˆ°å†…æ ¸ä¸­ï¼Œè®©å†…æ ¸æ¥æ£€æŸ¥æ˜¯å¦æœ‰ç½‘ç»œäº‹ä»¶å‘ç”Ÿï¼Œæ£€æŸ¥æ–¹å¼å°±æ˜¯éå†æ–‡ä»¶æè¿°ç¬¦é›†åˆã€‚</li><li>pollï¼šä¸selectåŒºåˆ«æ˜¯ï¼Œä¸å†ä½¿ç”¨BitMapæ¥å­˜å‚¨æ–‡ä»¶æè¿°ç¬¦ï¼Œçªç ´äº†ä¸ªæ•°ä¸Šé™</li><li>epollï¼šå†…æ ¸ä½¿ç”¨çº¢é»‘æ ‘æ¥å…³æ³¨å¾…æ£€æµ‹çš„Socketé«˜æ•ˆï¼Œä½¿ç”¨äº‹ä»¶é©±åŠ¨ï¼Œå†…æ ¸ç»´æŠ¤äº†ä¸€ä¸ªé“¾è¡¨æ¥è®°å½•å°±ç»ªäº‹ä»¶ï¼Œåªä¼šå°†äº‹ä»¶å‘ç”Ÿçš„Socketé›†åˆä¼ é€’ç»™åº”ç”¨ç¨‹åºå—ï¼Œè€Œä¸æ˜¯è½®è¯¢æ•´ä¸ªé›†åˆ</li></ol><h2 id="å¦‚ä½•è§£å†³å¯¹è±¡åˆ›å»ºå’Œé”€æ¯é—®é¢˜"><a href="#å¦‚ä½•è§£å†³å¯¹è±¡åˆ›å»ºå’Œé”€æ¯é—®é¢˜" class="headerlink" title="å¦‚ä½•è§£å†³å¯¹è±¡åˆ›å»ºå’Œé”€æ¯é—®é¢˜"></a>å¦‚ä½•è§£å†³å¯¹è±¡åˆ›å»ºå’Œé”€æ¯é—®é¢˜</h2><ol><li>å¯¹è±¡æ± æœç”¨æŠ€æœ¯</li><li>é›¶æ‹·è´æŠ€æœ¯ï¼šNettyåœ¨è¿›è¡ŒI/Oè¯»å†™æ—¶ï¼Œç›´æ¥ä½¿ç”¨DirectBufferï¼Œä»è€Œç›´æ¥é¿å…äº†æ•°æ®åœ¨å †å†…å­˜å’Œå †å¤–å†…å­˜ä¹‹é—´çš„æ‹·è´</li></ol><h3 id="é›¶æ‹·è´"><a href="#é›¶æ‹·è´" class="headerlink" title="é›¶æ‹·è´"></a>é›¶æ‹·è´</h3><blockquote><p>æ•°æ®ä»è¯»å–åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œç„¶åç›´æ¥ç”±å†…æ ¸ç¼“å†²åŒºå‘é€åˆ°ç½‘ç»œã€‚è€Œä¸æ˜¯æ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºåŸŸå†æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºè¿›è¡Œå‘é€ã€‚</p></blockquote><p>Nettyé›¶æ‹·è´å®ç°</p><ul><li>ä½¿ç”¨å †å¤–å†…å­˜ï¼Œé¿å…JVMå †å†…å­˜åˆ°å †å¤–å†…å­˜çš„æ•°æ®æ‹·è´</li><li>CompositeByteBuf ç±»ï¼Œå¯ä»¥ç»„åˆå¤šä¸ª Buffer å¯¹è±¡åˆå¹¶æˆä¸€ä¸ªé€»è¾‘ä¸Šçš„å¯¹è±¡ï¼Œé¿å…é€šè¿‡ä¼ ç»Ÿå†…å­˜æ‹·è´çš„æ–¹å¼å°†å‡ ä¸ª Buffer åˆå¹¶æˆä¸€ä¸ªå¤§çš„ Bufferã€‚</li><li>é€šè¿‡ Unpooled.wrappedBuffer å¯ä»¥å°† byte æ•°ç»„åŒ…è£…æˆ ByteBuf å¯¹è±¡ï¼ŒåŒ…è£…è¿‡ç¨‹ä¸­ä¸ä¼šäº§ç”Ÿå†…å­˜æ‹·è´ã€‚</li><li>ByteBuf.slice ï¼Œslice æ“ä½œå¯ä»¥å°†ä¸€ä¸ª ByteBuf å¯¹è±¡åˆ‡åˆ†æˆå¤šä¸ª ByteBuf å¯¹è±¡ï¼Œåˆ‡åˆ†è¿‡ç¨‹ä¸­ä¸ä¼šäº§ç”Ÿå†…å­˜æ‹·è´ï¼Œåº•å±‚å…±äº«ä¸€ä¸ª byte æ•°ç»„çš„å­˜å‚¨ç©ºé—´ã€‚</li><li>Netty ä½¿ç”¨ å°è£…äº†transferTo() æ–¹æ³• FileRegionï¼Œå¯ä»¥å°†æ–‡ä»¶ç¼“å†²åŒºçš„æ•°æ®ç›´æ¥ä¼ è¾“åˆ°ç›®æ ‡ Channelï¼Œé¿å…å†…æ ¸ç¼“å†²åŒºå’Œç”¨æˆ·æ€ç¼“å†²åŒºä¹‹é—´çš„æ•°æ®æ‹·è´</li></ul><h3 id="Javaä¸­çš„IOæ¨¡å‹"><a href="#Javaä¸­çš„IOæ¨¡å‹" class="headerlink" title="Javaä¸­çš„IOæ¨¡å‹"></a>Javaä¸­çš„IOæ¨¡å‹</h3><ol><li>BIO java.ioæ˜¯BIO</li><li>NIO java.nioåŒ…æ˜¯NIOçš„å®ç°ï¼Œå®è´¨ä¸Šä»ç„¶æ˜¯åŒæ­¥çš„ï¼Œè¯»å†™æ“ä½œæ—¶éåŒæ­¥çš„ï¼Œä½†æ˜¯è¿™äº›æ“ä½œæ˜¯ç”±åº”ç”¨ç¨‹åºä¸»åŠ¨å‘èµ·å’Œå¤„ç†çš„ï¼Œæ‰€ä»¥ä»ç„¶æ˜¯åŒæ­¥çš„ã€‚</li><li>AIO java.nio.channelsæ˜¯NIOçš„å®ç°</li></ol><h2 id="æŒ‰ç…§å®šä¹‰æ¥è¯´ï¼ŒNettyæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€äº‹ä»¶é©±åŠ¨çš„ã€ç”¨æ¥åšé«˜æ€§èƒ½é«˜å¯é æ€§çš„ç½‘ç»œåº”ç”¨çš„æ¡†æ¶"><a href="#æŒ‰ç…§å®šä¹‰æ¥è¯´ï¼ŒNettyæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€äº‹ä»¶é©±åŠ¨çš„ã€ç”¨æ¥åšé«˜æ€§èƒ½é«˜å¯é æ€§çš„ç½‘ç»œåº”ç”¨çš„æ¡†æ¶" class="headerlink" title="æŒ‰ç…§å®šä¹‰æ¥è¯´ï¼ŒNettyæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€äº‹ä»¶é©±åŠ¨çš„ã€ç”¨æ¥åšé«˜æ€§èƒ½é«˜å¯é æ€§çš„ç½‘ç»œåº”ç”¨çš„æ¡†æ¶"></a>æŒ‰ç…§å®šä¹‰æ¥è¯´ï¼ŒNettyæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€äº‹ä»¶é©±åŠ¨çš„ã€ç”¨æ¥åšé«˜æ€§èƒ½é«˜å¯é æ€§çš„ç½‘ç»œåº”ç”¨çš„æ¡†æ¶</h2><p>Nettyç›¸æ¯”äºTomcatï¼Œä¸éœ€è¦éµå¾ªSerletè§„èŒƒï¼Œå¯ä»¥æœ€å¤§åŒ–çš„å‘æŒ¥NIOçš„ç‰¹æ€§ã€‚<br>å¦‚æœéœ€è¦é¢å‘TCPçš„ç½‘ç»œåº”ç”¨å¼€å‘ï¼Œé‚£ä¹ˆNettyæ‰æ˜¯æœ€ä½³é€‰æ‹©</p><h3 id="ä¸‰å¤§ç»„ä»¶"><a href="#ä¸‰å¤§ç»„ä»¶" class="headerlink" title="ä¸‰å¤§ç»„ä»¶"></a>ä¸‰å¤§ç»„ä»¶</h3><ol><li>Channel &amp; Buffer</li><li>Selector</li><li>Bootstrap</li></ol><h4 id="é€»è¾‘æ¶æ„"><a href="#é€»è¾‘æ¶æ„" class="headerlink" title="é€»è¾‘æ¶æ„"></a>é€»è¾‘æ¶æ„</h4><p><img src="/2024/03/30/44/Netty%E6%95%B4%E4%BD%93%E9%80%BB%E8%BE%91.png"></p><ol><li>ç½‘ç»œé€šä¿¡å±‚ï¼šæ”¯æŒå¤šç§ç½‘ç»œåè®®ï¼Œå½“ç½‘ç»œæ•°æ®è¯»å–åˆ°å†…æ ¸ç¼“å†²åŒºåï¼Œä¼šè§¦å‘å„ç§ç½‘ç»œäº‹ä»¶ï¼Œä¼šåˆ†å‘ç»™äº‹ä»¶è°ƒåº¦å±‚è¿›è¡Œå¤„ç†ã€‚æ ¸å¿ƒæ˜¯<ul><li>BootStrapï¼Œè´Ÿè´£Nettyå®¢æˆ·ç«¯çš„å¯åŠ¨ã€åˆå§‹åŒ–ã€æœåŠ¡å™¨è¿æ¥ç­‰è¿‡ç¨‹</li><li>ServerBootStrapï¼šç”¨äºæœåŠ¡ç«¯ç»‘å®šæœ¬åœ°ç«¯ç«¯å£ï¼Œä¼šç»‘å®šBosså’ŒWorkerä¸¤ä¸ªEventLoopGroup</li><li>Channle é€šé“ï¼ŒåŸºäºNIOæ›´é«˜å±‚æ¬¡çš„æŠ½è±¡å—</li></ul></li><li>äº‹ä»¶è°ƒåº¦å±‚ï¼šé€šè¿‡Reactorçº¿ç¨‹æ¨¡å‹å¯¹å„ç§äº‹ä»¶è¿›è¡Œèšåˆå¤„ç†ã€‚é€šè¿‡Selectorä¸»å¾ªç¯çº¿ç¨‹ç»§æ‰¿uæ´ä¸­æ—¶é—´ï¼Œå®é™…ä¸šåŠ¡å¤„ç†é€»è¾‘æ˜¯äº¤ç”±æœåŠ¡ç¼–æ’æ›¾ä¸­çš„Handlerè§£å†³çš„ã€‚<ul><li>EventLoopGroupï¼ˆæ ¸å¿ƒï¼‰ï¼šæœ¬è´¨æ˜¯ä¸€ä¸ª<strong>çº¿ç¨‹æ± </strong>ï¼Œä¸»è¦è´Ÿè´£æ¥æ”¶I/Oè¯·æ±‚ï¼Œå¹¶åˆ†é…çº¿ç¨‹æ‰§è¡Œå¤„ç†è¯·æ±‚ã€‚é€šè¿‡åˆ›å»ºä¸åŒçš„EventLoopGroupå‚æ•°å¯ä»¥æ”¯æŒReactorä¸‰ç§çº¿ç¨‹æ¨¡å‹ï¼š<ul><li>å•çº¿ç¨‹æ¨¡å‹ï¼šGroupä¸­åªåŒ…å«ä¸€ä¸ªEventLoopï¼ŒBosså’ŒWorkerä½¿ç”¨åŒä¸€ä¸ªGroup</li><li>å¤šçº¿ç¨‹ï¼šå¤šä¸ªEventLoopï¼ŒBå’ŒWä½¿ç”¨åŒä¸€ä¸ª</li><li>ä¸»ä»å¤šçº¿ç¨‹ï¼šå¤šä¸ªEventLoopï¼ŒBå’ŒWä½¿ç”¨ä¸åŒçš„Group</li></ul></li><li>EventLoopè´Ÿè´£å¤„ç†Channelç”Ÿå‘½å‘¨æœŸä¸­æ‰€æœ‰çš„I/Oäº‹ä»¶ï¼Œä¸€ä¸ªEventLoopGroupåŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªEventLoopï¼Œä¸€ä¸ªEventLoopåŒä¸€æ—¶é—´åªä¼šç»‘å®šä¸€ä¸ªChannelï¼ŒChannelç”Ÿå‘½å‘¨æœŸå†…å¯ä»¥å’Œå¤šä¸ªEventLoopè¿›è¡Œå¤šæ¬¡ç»‘å®šå’Œè§£ç»‘<img src="/2024/03/30/44/EventLoop.png"></li></ul></li><li>æœåŠ¡ç¼–æ’å±‚ï¼šè´Ÿè´£ç»„è£…å„ç§æœåŠ¡ï¼Œæ˜¯æ ¸å¿ƒå¤„ç†é“¾ã€‚<ul><li>ChannelPipelineæ ¸å¿ƒç¼–æ’ç»„ä»¶ï¼Œè´Ÿè´£ç»„è£…å„ç§ChannelHandlerï¼ŒI/Oè¯»å†™è§¦å‘æ—¶ï¼Œä¼šä¾æ¬¡è°ƒç”¨Handlerè¿›è¡Œæ‹¦æˆªå’Œå¤„ç†ã€‚</li><li>ChannelHandlerå®Œæˆå…·ä½“çš„æ ‘decodeå’Œencodeå·¥ä½œå’Œå¤„ç†å…¬å›½ã€‚</li><li>ChannelHandlerContextï¼šç”¨äºä¿å­˜ä¸Šä¸‹æ–‡ï¼Œé€šè¿‡HandlerContextå¯ä»¥çŸ¥é“Pipelineå’ŒHandlerçš„å…³è”å…³ç³»ï¼ŒåŒ…å«Handlerç”Ÿå‘½å‘¨æœŸçš„æ‰€æœ‰äº‹ä»¶ã€‚</li></ul></li></ol><h2 id="Bootstrap"><a href="#Bootstrap" class="headerlink" title="Bootstrap"></a>Bootstrap</h2><blockquote><p>Nettyå®¢æˆ·ç«¯çš„å¯åŠ¨</p></blockquote><h2 id="ServerBootStrap"><a href="#ServerBootStrap" class="headerlink" title="ServerBootStrap"></a>ServerBootStrap</h2><blockquote><p>æœåŠ¡ç«¯å¯åŠ¨ï¼Œä¼šç»‘å®šBosså’Œ Workerä¸¤ä¸ªEventLoopGroup</p></blockquote><p>Bossçº¿ç¨‹ä¼šä¸æ–­æ¥å—æ–°çš„è¿æ¥ï¼Œç„¶åå°†è¿æ¥åˆ†ç»™Workerå»å¤„ç†</p><h2 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h2><h3 id="å¸¸ç”¨çš„Channelå®ç°ç±»"><a href="#å¸¸ç”¨çš„Channelå®ç°ç±»" class="headerlink" title="å¸¸ç”¨çš„Channelå®ç°ç±»"></a>å¸¸ç”¨çš„Channelå®ç°ç±»</h3><ul><li>NioServerSocketChannel å¼‚æ­¥ TCP æœåŠ¡ç«¯ã€‚</li><li>NioSocketChannel å¼‚æ­¥ TCP å®¢æˆ·ç«¯ã€‚</li><li>OioServerSocketChannel åŒæ­¥ TCP æœåŠ¡ç«¯ã€‚</li><li>OioSocketChannel åŒæ­¥ TCP å®¢æˆ·ç«¯ã€‚</li><li>NioDatagramChannel å¼‚æ­¥ UDP è¿æ¥ã€‚</li><li>OioDatagramChannel åŒæ­¥ UDP è¿æ¥ã€‚</li></ul><h3 id="Channelä¸äº‹ä»¶"><a href="#Channelä¸äº‹ä»¶" class="headerlink" title="Channelä¸äº‹ä»¶"></a>Channelä¸äº‹ä»¶</h3><ul><li>channelRegisteredï¼šChannelåˆ›å»ºåè¢«æ³¨å†Œåè¢«æ³¨å†Œ</li><li>channelUnregisteredï¼šChannelåˆ›å»ºåæœªæ³¨å†Œæˆ–è€…ä»EventLoopå–æ¶ˆæ³¨å†Œ</li><li>channelActiveï¼šChannelå¤„äºå°±ç»ªçŠ¶æ€ï¼Œå¯ä»¥è¢«è¯»å†™</li><li>channelInactiveï¼šå¤„äºéå°±ç»ªçŠ¶æ€</li><li>channelReadï¼šChannelå¯ä»¥ä»è¿œç«¯è¯»å–æ•°æ®</li><li>channelReadCompleteï¼šChannelè¯»å–æ•°æ®å®Œæˆ</li></ul><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><ul><li>ChannelFuture<ul><li>å…¶ addListener()æ–¹æ³•ä¼šæ³¨å†Œä¸€ä¸ªChannelFutureListeneræ¥ç­‰å¾…é€šçŸ¥</li></ul></li><li>ChannelHandlerï¼šäº‹ä»¶å¤„ç†çš„å…·ä½“é€»è¾‘<ol><li>ç”Ÿå­˜å‘¨æœŸï¼šhandlerAddedChannelHandlerè¢«æ·»åŠ åˆ°ChannelPipelineä¸­æ—¶è¢«è°ƒç”¨ï¼ŒhandlerRemovedè¢«è¢«ç§»é™¤ï¼ŒexceptionCaughtå¤„ç†è¿‡ç¨‹ä¸­åœ¨ChannelPipelineä¸­æœ‰é”™è¯¯äº§ç”Ÿæ—¶ã€‚</li><li>ChannelInboundHandler-&gt;å¤„ç†å…¥ç«™æ•°æ®åŠçŠ¶æ€å˜åŒ–ã€‚<ul><li>æ–¹æ³•ï¼š<img src="/2024/03/30/44/ChannelInboundHandler.png"></li><li>SimpleChannelInboundHandlerä¼šè‡ªåŠ¨é‡Šæ”¾èµ„æº</li><li><img src="/2024/03/30/44/ChannelOutboundHandler.png"></li></ul></li></ol></li><li>ChannelPipeline<ul><li>æ¯å»ºç«‹ä¸€ä¸ªæ–°çš„Channeléƒ½ä¼šåˆ†é…ä¸€ä¸ªChannelPipelineï¼Œä¸å¯ä¿®æ”¹</li><li>æä¾›äº† ChannelHandler é“¾çš„å®¹å™¨ï¼Œchannelè¢«åˆ›å»ºæ—¶ä¼šè¢«åˆ†é…åˆ°ChannelPipelineä¸­ï¼ŒChannelHandlerä¼šè¢«å®‰è£…åˆ°å…¶ä¸­</li><li>æµç¨‹ï¼š ChannelInitializerçš„å®ç°è¢«æ³¨å†Œè¿›ServerBootstrapyä¸­</li><li>è°ƒç”¨initChannel()æ–¹æ³•ï¼Œ ChannelInitializerä¼šåœ¨ChannelPipelineä¸­å®‰è£…ä¸€ç»„è‡ªå®šä¹‰çš„ChannelHandler</li><li>ChannelInitializerå°†è‡ªå·±ä» ChannelPipelineä¸­ç§»é™¤<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                       <span class="token comment">//æ·»åŠ ä¸€ä¸ªEchoServerHandleåˆ°å­Channelçš„ChannelPipeline</span>                        <span class="token comment">//ChannelInitializeræ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¤„ç†ç¨‹åºï¼Œç”¨äºå¸®åŠ©ç”¨æˆ·é…ç½®æ–°çš„Channel</span>                        <span class="token annotation punctuation">@Override</span>                        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> socketChannel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>                            <span class="token comment">//EchoServerHandleè¢«æ ‡æ³¨ä¸º@Shareableï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ€»æ˜¯ä½¿ç”¨åŒæ ·çš„å®ä¾‹</span>                            <span class="token comment">//@Shareableè¡¨ç¤ºä¸€ä¸ªChannelHandlerå¯ä»¥è¢«å¤šä¸ªChannelå®‰å…¨åœ°å…±äº«</span>                            <span class="token comment">//åœ¨å“ªæ ‡æ³¨çš„å‘¢ï¼Ÿåœ¨EchoServerHandleç±»ä¸Š</span>                            socketChannel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>serverHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li>ChannerlHandlerContextæ¥å£<ol><li>ç”¨äºç®¡ç†å…³è”çš„ChannelHandlerå’ŒåŒä¸€ä¸ªpipelineä¸­å…¶ä»–çš„Handler</li><li></li></ol></li><li>äºŒè€…çš„è”ç³»å’ŒåŒºåˆ«ï¼š<img src="/2024/03/30/44/PipeLine%E5%92%8CHandler%E7%9A%84%E5%8C%BA%E5%88%AB.png"><br>  é€šè¿‡ä½¿ç”¨ä½œä¸ºå‚æ•°ä¼ é€’åˆ°æ¯ä¸ªæ–¹æ³•çš„ ChannelHandlerContextï¼Œäº‹ä»¶å¯ä»¥è¢«ä¼ é€’ç»™å½“å‰ChannelHandler é“¾ä¸­çš„ä¸‹ä¸€ä¸ª ChannelHandlerã€‚<ul><li>ChannelInboundHandler </li><li>SimpleChannelInboundHandler&lt; T &gt; Tæ˜¯è¦å¤„ç†æ¶ˆæ¯çš„Javaç±»å‹ï¼Œé€‚ç”¨äºåªéœ€è¦è§£ç æ¶ˆæ¯å¹¶å¤„ç†é€»è¾‘<ul><li>channelRead0(ChannelHandlerContext,T)</li></ul></li></ul></li><li>BootStrap å¼•å¯¼ç±»ï¼Œç”¨äºä¸ºåº”ç”¨ç¨‹åºçš„ç½‘ç»œå±‚é…ç½®æä¾›äº†å®¹å™¨<ol><li>Bootstrap ç”¨äºå®¢æˆ·ç«¯ ï¼Œå¯ä»¥ç›´æ¥.connectæ¥è¿æ¥æœåŠ¡å™¨ï¼Œ</li><li>ServerBootstrap ç”¨äºå®¢æˆ·ç«¯ï¼Œéœ€è¦.connect(new  InetSocketAddress) æ‰èƒ½ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥</li></ol></li><li>Channelæ¥å£ï¼š<ul><li>æ–¹æ³•ï¼š</li><li><img src="/2024/03/30/44/Channel%E6%96%B9%E6%B3%95.png"></li><li>Channelçš„ç”Ÿå‘½å‘¨æœŸï¼šChannelUnregisteredå·²åˆ›å»ºä½†æ˜¯æ²¡æœ‰æ³¨å†Œåˆ°EventLoopä¸­ï¼›å·²æ³¨å†ŒChannelRegisteredï¼›ChannelActiveå¤„äºæ´»è·ƒçŠ¶æ€ï¼Œå·²ç»è¿æ¥åˆ°è¿œç¨‹èŠ‚ç‚¹ï¼Œ ChannelInactive æ²¡æœ‰è¿æ¥åˆ°è¿œç¨‹ç»™èŠ‚ç‚¹ã€‚</li></ul></li><li>å†…ç½®çš„ä¼ è¾“<ol><li>NIO éé˜»å¡-&gt;åŸºäºé€‰æ‹©å™¨ <img src="/2024/03/30/44/Selector.png"><ul><li><img src="/2024/03/30/44/Selector%E6%B5%81%E7%A8%8B.png"></li></ul></li><li>Epoll -&gt; åŸºäºJNIé©±åŠ¨çš„ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œå®Œå…¨éé˜»å¡çš„<ul><li>ä½¿ç”¨ï¼šEpollEventLoopGroup å’ŒEpollServerSocketChannel.class</li></ul></li><li>OIO -&gt;é˜»å¡æµ</li><li>Local-&gt;åœ¨VMå†…éƒ¨é€šè¿‡ç®¡é“è¿›è¡Œæœ¬åœ°ä¼ è¾“</li><li>Embedded æµ‹è¯•ChannelHandlerä½¿ç”¨</li></ol></li><li>ByteBuf<ol><li>ä½¿ç”¨ä¸¤ä¸ªç´¢å¼•ï¼šreadIndexå’ŒwriterIndexï¼Œå¼€å§‹æ—¶ï¼Œä¸¤ä¸ªéƒ½ä½äºå¼€å¤´ã€‚ä¹Ÿå°±æ˜¯é˜Ÿåˆ—</li><li>ByteBufHolderæ¥å£ç”¨æ¥å­˜å‚¨å„ç§å±æ€§å€¼ã€‚</li><li>Nettyæä¾›äº†ä¸¤ç§ByteBufAllocatorçš„å®ç°ï¼šPooledByteBufAllocatorå’ŒUnpooledByteBufAllocatorã€‚å‰è€…æ± åŒ–äº†ByteBufçš„å®ä¾‹ä»¥æé«˜æ€§èƒ½å¹¶æœ€å¤§é™åº¦åœ°å‡å°‘å†…å­˜ç¢ç‰‡ã€‚åè€…ä¸æ± åŒ–ã€‚</li><li>Unpooledç¼“å†²åŒºï¼šé™æ€å·¥å…·ç±»æ¥åˆ›å»ºæœªæ± åŒ–çš„ByteBufå®ä¾‹<img src="/2024/03/30/44/Unpooled.png"></li><li></li></ol></li><li>RPCæ¡†æ¶çš„è°ƒç”¨æµç¨‹<br><img src="/2024/03/30/44/RPC%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B.png"></li><li>è§£ç å™¨ï¼šByteToMessageDecoder ç¼–ç å™¨ï¼šMessageToByteEncoderå®é™…ä¸Šè¿™ä¸¤ä¸ªå®ç°äº†Handler</li><li>åè®®çš„æ”¯æŒï¼Œè‡ªå·±å»çœ‹æ•°ï¼ŒNettyå®æˆ˜</li></ul><h3 id="EventLoopGroup-äº‹ä»¶è°ƒåº¦å±‚"><a href="#EventLoopGroup-äº‹ä»¶è°ƒåº¦å±‚" class="headerlink" title="EventLoopGroup äº‹ä»¶è°ƒåº¦å±‚"></a>EventLoopGroup äº‹ä»¶è°ƒåº¦å±‚</h3><ul><li><input disabled="" type="checkbox"> å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œå¦‚ä½•ç¡®å®šçº¿ç¨‹æ± çš„å‚æ•°<br>EventLoopGroupæ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè´Ÿè´£æ¥å—I/Oè¯·æ±‚å¹¶åˆ†é…çº¿ç¨‹æ‰§è¡Œå¤„ç†è¯·æ±‚ã€‚<br><img src="/2024/03/30/44/EventLoop%E5%92%8CChannel.png"></li></ul><ol><li>EventLoopGroupåŒ…å«å¤šä¸ªEventLoop</li><li>EventLoopç”¨äºå¤„ç†Channelç”Ÿå‘½å‘¨æœŸå†…çš„æ‰€æœ‰I/Oäº‹ä»¶</li><li>EventLoopåŒä¸€æ—¶é—´åªä¼šä¸ä¸€ä¸ªçº¿ç¨‹ç»‘å®šï¼Œæ¯ä¸ªEventLoopå¤„ç†å¤šä¸ªChannel</li><li>Channelåœ¨ç”Ÿå‘½å‘¨æœŸå†…å¯ä»¥å¯¹EventLoopè¿›è¡Œå¤šæ¬¡ç»‘å®šå’Œè§£ç»‘</li></ol><h3 id="æœåŠ¡ç¼–æ’å±‚"><a href="#æœåŠ¡ç¼–æ’å±‚" class="headerlink" title="æœåŠ¡ç¼–æ’å±‚"></a>æœåŠ¡ç¼–æ’å±‚</h3><ul><li>ChannelPipeline<br>è´Ÿè´£ç»„è£…å„ç§ChannelHandlerï¼Œå†…éƒ¨é€šè¿‡åŒå‘é“¾è¡¨å°†ä¸åŒçš„ChannelHandleré“¾æ¥èµ·æ¥ï¼Œä¾æ¬¡è°ƒç”¨ï¼Œå¯¹Channelä¸­çš„æ•°æ®è¿›è¡Œæ‹¦æˆªå’Œå¤„ç†ã€‚<br>ChannelPipelineæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºä¸€ä¸ªæ–°çš„Channeléƒ½ä¼šç»‘å®šä¸€ä¸ªæ–°çš„ChannelPipelineï¼Œä¸€ä¸ªChannelPipelineå…³è”ä¸€ä¸ªEventLoopï¼Œç„¶åä¸€ä¸ªEventLoopç»‘å®šä¸€ä¸ªçº¿ç¨‹<img src="/2024/03/30/44/%E8%BF%9B%E5%87%BA%E7%AB%99.png"></li><li>ChannelHandler &amp; ChannelHandlerContext<br><img src="/2024/03/30/44/ChannelHandler.png"><br>ChannelHandlerContextç”¨äºä¿å­˜ChannelHanlerçš„ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥å®ç°ChannelHandlerä¹‹é—´çš„äº¤äº’ã€‚<br>åŒæ—¶åŒ…å«äº†ChannelHandlerç”Ÿå‘½å‘¨æœŸçš„æ‰€æœ‰äº‹ä»¶ã€‚<br>ä½¿ç”¨æ–¹å¼ï¼š</li></ul><p>#todo </p><ul><li><input disabled="" type="checkbox"> å¦‚ä½•åšï¼Œæœæœ<br>å¦‚æœChannelHandleræœ‰ä¸€äº›é€šç”¨çš„é€»è¾‘éœ€è¦å®ç°ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ”¾åœ¨è¿™é‡Œã€‚</li></ul><h3 id="Selector"><a href="#Selector" class="headerlink" title="Selector"></a>Selector</h3><h2 id="Nettyå®ç°çš„ä¸€äº›æœ‰ç‰¹è‰²"><a href="#Nettyå®ç°çš„ä¸€äº›æœ‰ç‰¹è‰²" class="headerlink" title="Nettyå®ç°çš„ä¸€äº›æœ‰ç‰¹è‰²"></a>Nettyå®ç°çš„ä¸€äº›æœ‰ç‰¹è‰²</h2><h3 id="FastThreadLocal"><a href="#FastThreadLocal" class="headerlink" title="FastThreadLocal"></a>FastThreadLocal</h3><p>ä½¿ç”¨Objectæ•°ç»„æ›¿ä»£Entryæ•°æ®ï¼Œ<code>Object[0]</code>å­˜å‚¨çš„æ˜¯ä¸€ä¸ª<code>Set&lt;FastThreadLocal&lt;?&gt;&gt;</code>é›†åˆï¼Œ1ä»¥åéƒ½æ˜¯å­˜valueçš„æ•°æ®ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é”®å€¼å¯¹çš„æ–¹å¼å®ç°ã€‚<br>setæ–¹æ³•ï¼š</p><ol><li>æ‰¾åˆ°indexä½ç½®ï¼Œè®¾ç½®æ–°çš„value</li><li>å°†<strong>FastThreadLocalå¯¹è±¡ä¿å­˜åˆ°å¾…æ¸…ç†çš„Setä¸­</strong><br>ä¼˜ç‚¹ï¼š</li><li>é«˜æ•ˆæŸ¥æ‰¾ï¼šå¯ä»¥ç›´æ¥é€šè¿‡æ•°ç»„ä¸‹æ ‡è·å–ï¼Œè€Œä¸”æ‰©å®¹ä¸éœ€è¦è¿›è¡Œrehash</li><li>å®‰å…¨æ€§æ›´é«˜ï¼šThreadLocalæœ‰å¯èƒ½ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œåªèƒ½ç­‰å¾…çº¿ç¨‹é”€æ¯ï¼Œä½†æ˜¯çš„çº¿ç¨‹æ± ä¸‹åªèƒ½ä¸»åŠ¨æ£€æµ‹ï¼Œè€ŒFastThreadLocalåˆ™å°è£…äº†FastThreadLocalRunnableï¼Œä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åä¸€å®šä¼šæ‰§è¡Œ<code>FastThreadLocal.removeAll()</code>ï¼Œä»è€Œå°†Setä¸­æ‰€æœ‰çš„å¯¹è±¡éƒ½é”€æ¯ã€‚</li></ol><p>#todo </p><ul><li><input disabled="" type="checkbox"> ä»¥ä¸‹å†…å®¹æ˜¯æ–°å¼€çš„æ–‡ç« ã€Šæ·±å…¥æµ…å‡ºNettyï¼šåŸç†ä¸æºç è§£è¯»ã€‹è®°å¾—æ–°å¼€ä¸€ç¯‡æ–‡ç« </li><li><input disabled="" type="checkbox"> çœ‹çœ‹èƒ½ä¸èƒ½å†™ä¸ªçˆ¬è™«æŠŠè¿™ä¸ªæ–‡ç« çˆ¬ä¸‹æ¥ï¼Œæˆ–è€…è‡ªå·±å¤åˆ¶ä¸‹æ¥<br><a href="https://www.cnblogs.com/grey-wolf/p/12017818.html">æ›¹å·¥æ‚è°ˆï¼šSpring bootåº”ç”¨ï¼Œè‡ªå·±åŠ¨æ‰‹ç”¨Nettyæ›¿æ¢åº•å±‚Tomcatå®¹å™¨ - ä¸‰å›½æ¢¦å› - åšå®¢å›­ (cnblogs.com)</a><br><a href="https://learn.lianglianglee.com/%e4%b8%93%e6%a0%8f/Netty%20%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e5%89%96%e6%9e%90%e4%b8%8e%20RPC%20%e5%ae%9e%e8%b7%b5-%e5%ae%8c/00%20%e5%ad%a6%e5%a5%bd%20Netty%ef%bc%8c%e6%98%af%e4%bd%a0%e4%bf%ae%e7%82%bc%20Java%20%e5%86%85%e5%8a%9f%e7%9a%84%e5%bf%85%e7%bb%8f%e4%b9%8b%e8%b7%af.md">00 å­¦å¥½ Nettyï¼Œæ˜¯ä½ ä¿®ç‚¼ Java å†…åŠŸçš„å¿…ç»ä¹‹è·¯ (lianglianglee.com)</a></li></ul><h1 id="æ·±å…¥å’Œæºç è§£è¯»"><a href="#æ·±å…¥å’Œæºç è§£è¯»" class="headerlink" title="æ·±å…¥å’Œæºç è§£è¯»"></a>æ·±å…¥å’Œæºç è§£è¯»</h1><h2 id="Nettyå†…éƒ¨çš„é€»è¾‘æµç¨‹"><a href="#Nettyå†…éƒ¨çš„é€»è¾‘æµç¨‹" class="headerlink" title="Nettyå†…éƒ¨çš„é€»è¾‘æµç¨‹"></a>Nettyå†…éƒ¨çš„é€»è¾‘æµç¨‹</h2><p><img src="/2024/03/30/44/%E9%80%BB%E8%BE%91%E6%B5%81%E7%A8%8B.png"><br>#todo </p><ul><li><input disabled="" type="checkbox"> æºç è§£è¯»<a href="https://learn.lianglianglee.com/%e4%b8%93%e6%a0%8f/Netty%20%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e5%89%96%e6%9e%90%e4%b8%8e%20RPC%20%e5%ae%9e%e8%b7%b5-%e5%ae%8c/02%20%20%e7%ba%b5%e8%a7%88%e5%85%a8%e5%b1%80%ef%bc%9a%e6%8a%8a%e6%8f%a1%20Netty%20%e6%95%b4%e4%bd%93%e6%9e%b6%e6%9e%84%e8%84%89%e7%bb%9c.md">02 çºµè§ˆå…¨å±€ï¼šæŠŠæ¡ Netty æ•´ä½“æ¶æ„è„‰ç»œ (lianglianglee.com)</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>mybatis</title>
      <link href="/2024/03/30/46/"/>
      <url>/2024/03/30/46/</url>
      
        <content type="html"><![CDATA[<h2 id="é¢è¯•å¸¸é—®"><a href="#é¢è¯•å¸¸é—®" class="headerlink" title="é¢è¯•å¸¸é—®:"></a>é¢è¯•å¸¸é—®:</h2><ul><li>å»¶è¿ŸåŠ è½½æé«˜åŠ è½½æ•ˆç‡ï¼š</li></ul><h3 id="Mybatisçš„ç¼“å­˜"><a href="#Mybatisçš„ç¼“å­˜" class="headerlink" title="Mybatisçš„ç¼“å­˜"></a>Mybatisçš„ç¼“å­˜</h3><ul><li>ä¸€çº§ç¼“å­˜ï¼šä¹Ÿå³æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œæ˜¯SqlSessionçº§åˆ«çš„,è¯»ä¸ªsqlè¯­å¥ä¹‹é—´ä¸ä¼šå…±äº«ç¼“å­˜ï¼Œä½¿ç”¨@Transactionalæ¥ç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ä¸€æ¬¡äº‹åŠ¡ä¸­å¤šæ¬¡æŸ¥è¯¢ä¼šä½¿ç”¨åˆ°ä¸€çº§ç¼“å­˜<ul><li>é»˜è®¤å¼€å¯ï¼Œå¯ä»¥åœ¨é…ç½®ä¸­å…³é—­<ol><li>å½“æˆ‘ä»¬æ‰§è¡ŒæŸ¥è¯¢æ“ä½œæ—¶ï¼ŒMyBatisä¼šå…ˆå»ä¸€çº§ç¼“å­˜ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰ä¹‹å‰æŸ¥è¯¢è¿‡çš„æ•°æ®ã€‚å¦‚æœæœ‰ï¼Œç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„æ•°æ®ï¼›å¦‚æœæ²¡æœ‰ï¼Œå»æ•°æ®åº“æŸ¥è¯¢æ•°æ®ï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœæ”¾å…¥ä¸€çº§ç¼“å­˜ä¸­ã€‚  </li><li>å½“æˆ‘ä»¬æ‰§è¡Œæ›´æ–°æ“ä½œï¼ˆåŒ…æ‹¬insertã€updateã€deleteï¼‰æ—¶ï¼ŒMyBatisä¼šæ¸…ç©ºä¸€çº§ç¼“å­˜ã€‚è¿™æ˜¯ä¸ºäº†ä¿è¯ç¼“å­˜ä¸­çš„æ•°æ®å’Œæ•°æ®åº“ä¸­çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚  </li><li>å½“SqlSessionç»“æŸæˆ–å…³é—­æ—¶ï¼Œä¸€çº§ç¼“å­˜ä¹Ÿå°±æ¸…ç©ºäº†ã€‚</li></ol></li><li>äºŒçº§ç¼“å­˜:<ul><li>åœ¨mapper.xmlä¸Šæ–¹åŠ ä¸Š<code>&lt;Cache&gt;&lt;/Cache&gt;</code> å³å¯</li><li>æ ¹æ®mapper.xmlä¸­å‘½åç©ºé—´æ¥åŒºåˆ†ï¼Œæ˜¯mapperçº§åˆ«çš„ï¼Œåªç”¨å½“æ‰§è¡ŒåŒä¸€ä¸ªmapperä¸­çš„å¢æ”¹åˆ è¯­å¥æ—¶æ‰ä¼šå¤±æ•ˆï¼Œå¢åˆ æ”¹é¢‘ç¹æ—¶äºŒçº§ç¼“å­˜åŸºæœ¬å¤±æ•ˆï¼Œå¹¶ä¸”ï¼Œå¾®æœåŠ¡ä¸­å¤šå°æœåŠ¡ä¸­åªæœ‰è¢«è°ƒç”¨çš„é‚£ä¸€å°çš„äºŒçº§ç¼“å­˜æ‰ä¼šåˆ é™¤ï¼Œå…¶ä½™çš„ä¸åˆ é™¤ï¼Œé€ æˆä¸ä¸€è‡´ã€‚</li></ul></li></ul></li><li>Springboot Cacheï¼Œä¼šç¼“å­˜æ–¹æ³•çš„è¿”å›å€¼ï¼Œä½†æ˜¯åŒæ ·ä¹Ÿåªèƒ½åœ¨ä¸€ä¸ªèŠ‚ç‚¹ç”Ÿæ•ˆï¼Œå¹¶ä¸”ï¼Œ@Cacheableä¸ä¼šä¸»åŠ¨åˆ·æ–°ç¼“å­˜ï¼Œä½†æ˜¯@CachePutä¼šå¼ºåˆ¶åˆ·æ–°ç¼“å­˜ï¼Œå¹¶æŠŠæ–°çš„ç¼“å­˜æ”¾å…¥</li><li>å…±äº«çš„ç¼“å­˜ï¼Redis å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­å°†springbootçš„ç¼“å­˜ç±»å‹è®¾ç½®ä¸ºRedis</li></ul><h3 id="å’Œ-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å’Œ-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="#{} å’Œ ${} çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>#{} å’Œ ${} çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li><code>#{}</code> æ˜¯Propetiesæ–‡ä»¶ä¸­çš„å˜é‡å ä½ç¬¦ï¼Œä¼šè¢«åŸæ ·æ›¿æ¢</li><li><code>${}</code>æ˜¯sqlçš„å‚æ•°å ä½ç¬¦ï¼ŒMybatisä¼šæŠŠä»–æ›¿æ¢æˆ <code>?</code> åç»­é€šè¿‡åå°„è¿›è¡Œæ›¿æ¢æ•°æ®</li></ul><h3 id="xml-æ˜ å°„æ–‡ä»¶ä¸­ï¼Œé™¤äº†å¸¸è§çš„-selectã€insertã€updateã€delete-æ ‡ç­¾ä¹‹å¤–ï¼Œè¿˜æœ‰å“ªäº›æ ‡ç­¾ï¼Ÿ"><a href="#xml-æ˜ å°„æ–‡ä»¶ä¸­ï¼Œé™¤äº†å¸¸è§çš„-selectã€insertã€updateã€delete-æ ‡ç­¾ä¹‹å¤–ï¼Œè¿˜æœ‰å“ªäº›æ ‡ç­¾ï¼Ÿ" class="headerlink" title="xml æ˜ å°„æ–‡ä»¶ä¸­ï¼Œé™¤äº†å¸¸è§çš„ selectã€insertã€updateã€delete æ ‡ç­¾ä¹‹å¤–ï¼Œè¿˜æœ‰å“ªäº›æ ‡ç­¾ï¼Ÿ"></a>xml æ˜ å°„æ–‡ä»¶ä¸­ï¼Œé™¤äº†å¸¸è§çš„ selectã€insertã€updateã€delete æ ‡ç­¾ä¹‹å¤–ï¼Œè¿˜æœ‰å“ªäº›æ ‡ç­¾ï¼Ÿ</h3><h4 id="resultMap-å®šä¹‰æŸ¥è¯¢ç»“æœçš„æ˜ å°„è§„åˆ™"><a href="#resultMap-å®šä¹‰æŸ¥è¯¢ç»“æœçš„æ˜ å°„è§„åˆ™" class="headerlink" title="resultMap å®šä¹‰æŸ¥è¯¢ç»“æœçš„æ˜ å°„è§„åˆ™"></a>resultMap å®šä¹‰æŸ¥è¯¢ç»“æœçš„æ˜ å°„è§„åˆ™</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_id<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_name<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_password<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_email<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bio<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_bio<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="sqlï¼šå®šä¹‰å¯å¤ç”¨çš„SQLä»£ç æ®µ"><a href="#sqlï¼šå®šä¹‰å¯å¤ç”¨çš„SQLä»£ç æ®µ" class="headerlink" title="sqlï¼šå®šä¹‰å¯å¤ç”¨çš„SQLä»£ç æ®µ"></a>sqlï¼šå®šä¹‰å¯å¤ç”¨çš„SQLä»£ç æ®µ</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sql</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userColumns<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> ${alias}.id, ${alias}.username, ${alias}.password, ${alias}.email, ${alias}.bio <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sql</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUsers<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userResultMap<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>  select    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">refid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userColumns<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alias<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>  from some_table user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="parameterType-å®šä¹‰SQLè¯­å¥çš„è¾“å…¥å‚æ•°ç±»å‹"><a href="#parameterType-å®šä¹‰SQLè¯­å¥çš„è¾“å…¥å‚æ•°ç±»å‹" class="headerlink" title="parameterType å®šä¹‰SQLè¯­å¥çš„è¾“å…¥å‚æ•°ç±»å‹"></a>parameterType å®šä¹‰SQLè¯­å¥çš„è¾“å…¥å‚æ•°ç±»å‹</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insertUser<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  insert into users (username, password, email, bio)  values (#{username}, #{password}, #{email}, #{bio})<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="resultTypeï¼šå®šä¹‰-SQL-è¯­å¥çš„è¾“å‡ºç»“æœç±»å‹ã€‚"><a href="#resultTypeï¼šå®šä¹‰-SQL-è¯­å¥çš„è¾“å‡ºç»“æœç±»å‹ã€‚" class="headerlink" title="resultTypeï¼šå®šä¹‰ SQL è¯­å¥çš„è¾“å‡ºç»“æœç±»å‹ã€‚"></a><code>resultType</code>ï¼šå®šä¹‰ SQL è¯­å¥çš„è¾“å‡ºç»“æœç±»å‹ã€‚</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUsernames<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  select username from users<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="associationï¼šå®šä¹‰ä¸€å¯¹ä¸€çš„å…³è”å…³ç³»ã€‚"><a href="#associationï¼šå®šä¹‰ä¸€å¯¹ä¸€çš„å…³è”å…³ç³»ã€‚" class="headerlink" title="associationï¼šå®šä¹‰ä¸€å¯¹ä¸€çš„å…³è”å…³ç³»ã€‚"></a><code>association</code>ï¼šå®šä¹‰ä¸€å¯¹ä¸€çš„å…³è”å…³ç³»ã€‚</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!-- ... --&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>address<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Address<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>address_id<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>street<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>address_street<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>city<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>address_city<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>state<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>address_state<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zip<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>address_zip<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>country<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>address_country<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="collectionï¼šå®šä¹‰ä¸€å¯¹å¤šçš„å…³è”å…³ç³»ã€‚"><a href="#collectionï¼šå®šä¹‰ä¸€å¯¹å¤šçš„å…³è”å…³ç³»ã€‚" class="headerlink" title="collectionï¼šå®šä¹‰ä¸€å¯¹å¤šçš„å…³è”å…³ç³»ã€‚"></a><code>collection</code>ï¼šå®šä¹‰ä¸€å¯¹å¤šçš„å…³è”å…³ç³»ã€‚</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!-- ... --&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>posts<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_id<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subject<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_subject<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_body<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="dynamic-æ ‡ç­¾å¦‚-ifã€chooseã€whenã€otherwiseã€trimã€whereã€setï¼šç”¨äºæ„å»ºåŠ¨æ€-SQLã€‚"><a href="#dynamic-æ ‡ç­¾å¦‚-ifã€chooseã€whenã€otherwiseã€trimã€whereã€setï¼šç”¨äºæ„å»ºåŠ¨æ€-SQLã€‚" class="headerlink" title="dynamic&nbsp;æ ‡ç­¾å¦‚&nbsp;ifã€chooseã€whenã€otherwiseã€trimã€whereã€setï¼šç”¨äºæ„å»ºåŠ¨æ€ SQLã€‚"></a><code>dynamic</code>&nbsp;æ ‡ç­¾å¦‚&nbsp;<code>if</code>ã€<code>choose</code>ã€<code>when</code>ã€<code>otherwise</code>ã€<code>trim</code>ã€<code>where</code>ã€<code>set</code>ï¼šç”¨äºæ„å»ºåŠ¨æ€ SQLã€‚</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findActiveBlogLike<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  SELECT * FROM BLOG WHERE state = 'ACTIVE'   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    AND title like #{title}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ‰§è¡Œè¿‡ç¨‹<ul><li>javaç¨‹åºåŠ è½½configæ–‡ä»¶ï¼Œåˆ›å»ºSqlSessionFactoryå¯¹è±¡ï¼Œä¹‹åé€šè¿‡SqlSessionFactoryåˆ›å»ºSqlSessionå¯¹è±¡ï¼Œä¹‹åé€šè¿‡SqlSessionå¯¹è±¡æ‰§è¡Œæ˜ å°„é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„SQLè¯­å¥ï¼Œæœ€åé€šè¿‡SqlSessionå¯¹è±¡æäº¤äº‹åŠ¡ï¼Œå…³é—­SqlSessionå¯¹è±¡</li><li><img src="/2024/03/30/46/%E5%88%86%E5%B1%82.png"></li></ul></li></ul><h3 id="Daoæ¥å£-Mapperæ¥å£-çš„åŸç†"><a href="#Daoæ¥å£-Mapperæ¥å£-çš„åŸç†" class="headerlink" title="Daoæ¥å£(Mapperæ¥å£)çš„åŸç†"></a>Daoæ¥å£(Mapperæ¥å£)çš„åŸç†</h3><h4 id="Daoä¸­çš„æ–¹æ³•ï¼Œå‚æ•°ä¸åŒæ—¶ï¼Œå¯ä»¥é‡è½½å—"><a href="#Daoä¸­çš„æ–¹æ³•ï¼Œå‚æ•°ä¸åŒæ—¶ï¼Œå¯ä»¥é‡è½½å—" class="headerlink" title="Daoä¸­çš„æ–¹æ³•ï¼Œå‚æ•°ä¸åŒæ—¶ï¼Œå¯ä»¥é‡è½½å—"></a>Daoä¸­çš„æ–¹æ³•ï¼Œå‚æ•°ä¸åŒæ—¶ï¼Œå¯ä»¥é‡è½½å—</h4><p>  Mapperä¸­çš„æ–¹æ³•<strong>å¯ä»¥</strong> é‡è½½ï¼Œä½¿ç”¨çš„æ˜¯å…¨é™å®šå + æ–¹æ³•å æ‹¼æ¥çš„å­—ç¬¦ä¸²ä½œä¸ºkeyå»åŒ¹é…ã€‚ ä½†æ˜¯xmlæ–‡ä»¶ä¸­çš„idåªèƒ½æŒ‡å®šä¸€ä¸ªï¼Œä¹Ÿå³æ˜¯é‡è½½çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯ç”¨ä¸€ä¸ªsqlè¯­å¥ï¼Œè€Œè¿™ä¸ªsqlè¯­å¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŠ¨æ€sqlæ¥å®ç°</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getAllStu<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.pojo.Student<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  select * from student  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      id = #{id}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Daoæ¥å£çš„åŸç†ï¼š<br>MyBatisè¿è¡Œæ—¶ä¼šä½¿ç”¨JDKåŠ¨æ€ä»£ç†æ¥ä¸ºDaoç”Ÿæˆä»£ç†proxyå¯¹è±¡ï¼Œä»£ç†å¯¹è±¡ä¼šæ‹¦æˆªæ¥å£æ–¹æ³•ï¼Œè½¬è€Œæ‰§è¡ŒMappedStatementä¸­çš„sql</p><h3 id="MyBatisçš„åˆ†é¡µ"><a href="#MyBatisçš„åˆ†é¡µ" class="headerlink" title="MyBatisçš„åˆ†é¡µ"></a>MyBatisçš„åˆ†é¡µ</h3><p>nihao</p><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>ç­”ï¼š**(1)** MyBatis ä½¿ç”¨ RowBounds å¯¹è±¡è¿›è¡Œåˆ†é¡µï¼Œå®ƒæ˜¯é’ˆå¯¹ ResultSet ç»“æœé›†æ‰§è¡Œçš„å†…å­˜åˆ†é¡µï¼Œè€Œéç‰©ç†åˆ†é¡µï¼›**(2)** å¯ä»¥åœ¨ sql å†…ç›´æ¥ä¹¦å†™å¸¦æœ‰ç‰©ç†åˆ†é¡µçš„å‚æ•°æ¥å®Œæˆç‰©ç†åˆ†é¡µåŠŸèƒ½ï¼Œ**(3)** ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ†é¡µæ’ä»¶æ¥å®Œæˆç‰©ç†åˆ†é¡µã€‚</p><h4 id="åˆ†é¡µæ’ä»¶çš„åŸç†"><a href="#åˆ†é¡µæ’ä»¶çš„åŸç†" class="headerlink" title="åˆ†é¡µæ’ä»¶çš„åŸç†"></a>åˆ†é¡µæ’ä»¶çš„åŸç†</h4><ol><li>æ’ä»¶è®¾ç½®ä¸€ä¸ªThreadLocalå˜é‡æ¥å­˜å‚¨åˆ†é¡µå‚æ•°</li><li>å½“æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼ŒMyBatisä¼šè°ƒç”¨æ‰€æœ‰æ³¨å†Œçš„æ‹¦æˆªå™¨ã€‚</li><li>PageHelper é¦–å…ˆä¼šä¿å­˜åŸå§‹çš„æŸ¥è¯¢SQLï¼Œç„¶åç”Ÿæˆä¸€ä¸ªæ–°çš„SQLï¼Œè¿™ä¸ªæ–°çš„SQLåœ¨åŸå§‹çš„SQLåŸºç¡€ä¸Šæ·»åŠ äº†LIMITå’ŒOFFSET</li><li>PageHelper å°†æ–°çš„SQLæ›¿æ¢æˆåŸå§‹çš„SQLç„¶åæ‰§è¡Œ</li><li>æœ€åPageHelperä¼šæ¸…é™¤ThreadLocalä¸­å˜é‡ï¼Œé¿å…å†…å­˜æ³„æ¼</li></ol><h3 id="MyBatisåŠ¨æ€sqlæ˜¯ä»€ä¹ˆçš„ï¼Œæœ‰å“ªäº›ï¼ŒåŸç†"><a href="#MyBatisåŠ¨æ€sqlæ˜¯ä»€ä¹ˆçš„ï¼Œæœ‰å“ªäº›ï¼ŒåŸç†" class="headerlink" title="MyBatisåŠ¨æ€sqlæ˜¯ä»€ä¹ˆçš„ï¼Œæœ‰å“ªäº›ï¼ŒåŸç†"></a>MyBatisåŠ¨æ€sqlæ˜¯ä»€ä¹ˆçš„ï¼Œæœ‰å“ªäº›ï¼ŒåŸç†</h3><h4 id="å¸¸ç”¨çš„åŠ¨æ€sqlæ ‡ç­¾"><a href="#å¸¸ç”¨çš„åŠ¨æ€sqlæ ‡ç­¾" class="headerlink" title="å¸¸ç”¨çš„åŠ¨æ€sqlæ ‡ç­¾"></a>å¸¸ç”¨çš„åŠ¨æ€sqlæ ‡ç­¾</h4><ul><li><code>&lt;if&gt;&lt;/if&gt;</code></li><li><code>&lt;where&gt;&lt;/where&gt;(trim,set)</code></li><li><code>&lt;choose&gt;&lt;/choose&gt;ï¼ˆwhen, otherwiseï¼‰</code></li><li><code>&lt;foreach&gt;&lt;/foreach&gt;</code></li><li><code>&lt;bind/&gt;</code></li></ul><h4 id="æ‰§è¡ŒåŸç†"><a href="#æ‰§è¡ŒåŸç†" class="headerlink" title="æ‰§è¡ŒåŸç†"></a>æ‰§è¡ŒåŸç†</h4><p><strong>OGNL</strong> (Object-Graph Navigation Language)è¡¨è¾¾å¼ï¼Œé€šè¿‡ä»–å¯ä»¥åœ¨XMLé…ç½®æ–‡ä»¶ä¸­å¼•ç”¨Javaå¯¹è±¡å’Œæ–¹æ³•ï¼Œåœ¨åŠ¨æ€SQLä¸­ï¼Œå¸¸å¸¸ä½¿ç”¨å…¶è¿›è¡Œåˆ¤æ–­æ¡ä»¶</p><ul><li>å¸¸è§çš„OGNLè¯­æ³•ï¼š<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">person.name #è®¿é—®å¯¹è±¡çš„å±æ€§person.getName() # è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•persons.</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span> # è·å–personså¯¹è±¡çš„nameå±æ€§person.age &gt; 18 ? <span class="token string">'adult'</span> <span class="token punctuation">:</span> <span class="token string">'child'</span> # æ¡ä»¶è¡¨è¾¾å¼person.agge + 1 # ç®—æœ¯è¡¨è¾¾å¼person.age &gt; 18 &amp;&amp; person.gender == <span class="token string">'male'</span> # é€»è¾‘è¡¨è¾¾å¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="MyBatiså¦‚ä½•å°†sqlæ‰§è¡Œç»“æœå°è£…ä¸ºç›®æ ‡å¯¹è±¡å¹¶è¿”å›"><a href="#MyBatiså¦‚ä½•å°†sqlæ‰§è¡Œç»“æœå°è£…ä¸ºç›®æ ‡å¯¹è±¡å¹¶è¿”å›" class="headerlink" title="MyBatiså¦‚ä½•å°†sqlæ‰§è¡Œç»“æœå°è£…ä¸ºç›®æ ‡å¯¹è±¡å¹¶è¿”å›"></a>MyBatiså¦‚ä½•å°†sqlæ‰§è¡Œç»“æœå°è£…ä¸ºç›®æ ‡å¯¹è±¡å¹¶è¿”å›</h4><ol><li>ä½¿ç”¨<code>&lt;resultMap&gt;</code> æ ‡ç­¾å»æ˜ å°„åˆ—è¡¨åå’Œå¯¹è±¡å±æ€§åä¹‹é—´çš„æ˜ å°„å…³ç³»</li><li>ä½¿ç”¨sqlåˆ—åˆ«åæ–¹å¼ï¼Œå°†åˆ—åä¹¦å†™ä¸ºå¯¹è±¡å±æ€§åï¼Œä¾‹å¦‚ï¼šT_NAME AS NAME å¯¹åº”çš„å±æ€§åæ˜¯nameï¼Œä¼šå¿½ç•¥å¤§å°å†™<br>å½“æ˜ å°„å…³ç³»å»ºç«‹ä¹‹åï¼ŒMyBatisä¼šé€šè¿‡åå°„åˆ›å»ºå¯¹è±¡ï¼Œç„¶åç»™å¯¹è±¡çš„å±æ€§ä¸€ä¸€èµ‹å€¼</li></ol><h3 id="MyBatiså»¶è¿ŸåŠ è½½çš„åŸç†-å¾…å†™"><a href="#MyBatiså»¶è¿ŸåŠ è½½çš„åŸç†-å¾…å†™" class="headerlink" title="MyBatiså»¶è¿ŸåŠ è½½çš„åŸç† å¾…å†™"></a>MyBatiså»¶è¿ŸåŠ è½½çš„åŸç† å¾…å†™</h3><p>MyBatisä»…æ”¯æŒassociationå…³è”å¯¹è±¡å’Œcollectionå…³è”é›†åˆå¯¹è±¡çš„å»¶è¿ŸåŠ è½½ï¼ŒassociationæŒ‡çš„æ˜¯1v1ï¼Œcollectionæ˜¯1vå¤š</p><h4 id="Executoræ‰§è¡Œå™¨"><a href="#Executoræ‰§è¡Œå™¨" class="headerlink" title="Executoræ‰§è¡Œå™¨"></a>Executoræ‰§è¡Œå™¨</h4><ul><li>SimpleExecutor æ¯æ‰§è¡Œä¸€æ¬¡ updateæˆ–selectï¼Œå°±å¼€å¯ä¸€ä¸ªStatementå¯¹è±¡ï¼Œç”¨å®Œç«‹åˆ»å…³é—­Statementå¯¹è±¡</li><li>ReuseExecutor æ‰§è¡Œupdate/select ä»¥sqlä¸ºkeyæŸ¥æ‰¾Statementå¯¹è±¡ï¼Œä¸å­˜åœ¨å°±åˆ›å»ºï¼Œä½¿ç”¨åæ”¾åœ¨Mapä¸­ï¼Œä¾›ä¸‹ä¸€æ¬¡ä½¿ç”¨</li><li>BatchExecutor æ‰§è¡Œupdate æ—¶ï¼Œå°†æ‰€æœ‰çš„sqléƒ½æ·»åŠ åˆ°æ‰¹å¤„ç†ä¸­ï¼Œä¹‹åç»Ÿä¸€æ‰§è¡Œï¼Œç¼“å­˜å¤šä¸ªStatementå¯¹è±¡ï¼Œæ¯ä¸ªStatementå¯¹è±¡éƒ½æ˜¯ç­‰å¾…sqlæ·»åŠ ä¹‹åï¼Œç­‰å¾…é€ä¸€æ‰§è¡Œ</li></ul><h2 id="æ·±å…¥è§£è¯»"><a href="#æ·±å…¥è§£è¯»" class="headerlink" title="æ·±å…¥è§£è¯»"></a>æ·±å…¥è§£è¯»</h2><h3 id="åŸºç¡€æ”¯æŒå±‚"><a href="#åŸºç¡€æ”¯æŒå±‚" class="headerlink" title="åŸºç¡€æ”¯æŒå±‚"></a>åŸºç¡€æ”¯æŒå±‚</h3><ul><li>è§£æå™¨æ¨¡å—<ol><li>DOMè§£æå°†xmlçš„æ ‡ç­¾ç»„ç»‡æˆä¸€é¢—DOMæ ‘ï¼Œå°†æ•´ä¸ªxmlæ–‡æ¡£åŠ è½½è¿›å†…å­˜</li><li>SAXåŸºäºæ—¶é—´æ¨¡å‹çš„xmlè§£ææ–¹å¼ã€‚åŠ è½½ä¸€éƒ¨åˆ†åˆ°å†…å­˜ä¸­ï¼Œå¹¶ä¸”å½“ç¨‹åºå¤„ç†è¿‡ç¨‹ä¸­æ»¡è¶³æ¡ä»¶æ—¶ï¼Œä¼šç»“æŸè§£æï¼Œä¸å¿…è§£æå‰©ä½™çš„xmlå†…å®¹ã€‚ä½†æ˜¯ä¸æ”¯æŒå±‚æ¬¡å…³ç³»å’Œçˆ¶å­å…³ç³»çš„ä¿å­˜</li></ol><ul><li>XPathParserï¼šMyBatisæä¾›çš„XPathParserç±»å°è£…äº†XPathã€Documentã€EntityResolver</li></ul></li></ul><h1 id="MyBatis-Plus"><a href="#MyBatis-Plus" class="headerlink" title="MyBatis Plus"></a><a href="https://baomidou.com/introduce/">MyBatis Plus</a></h1><h2 id="ä¸€äº›æ’ä»¶"><a href="#ä¸€äº›æ’ä»¶" class="headerlink" title="ä¸€äº›æ’ä»¶"></a>ä¸€äº›æ’ä»¶</h2><h3 id="è‡ªå®šä¹‰å¡«å……å­—æ®µ"><a href="#è‡ªå®šä¹‰å¡«å……å­—æ®µ" class="headerlink" title="è‡ªå®šä¹‰å¡«å……å­—æ®µ"></a>è‡ªå®šä¹‰å¡«å……å­—æ®µ</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBatisPlusDateHandler</span> <span class="token keyword">implements</span> <span class="token class-name">MetaObjectHandler</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertFill</span><span class="token punctuation">(</span><span class="token class-name">MetaObject</span> metaObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"createTime"</span><span class="token punctuation">,</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"updateTime"</span><span class="token punctuation">,</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateFill</span><span class="token punctuation">(</span><span class="token class-name">MetaObject</span> metaObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"updateTime"</span><span class="token punctuation">,</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ†é¡µæ’ä»¶"><a href="#åˆ†é¡µæ’ä»¶" class="headerlink" title="åˆ†é¡µæ’ä»¶"></a>åˆ†é¡µæ’ä»¶</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"dataBaseConfigurationByAdmin"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataBaseConfiguration</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * åˆ†é¡µæ’ä»¶     */</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token annotation punctuation">@ConditionalOnMissingBean</span>    <span class="token keyword">public</span> <span class="token class-name">MybatisPlusInterceptor</span> <span class="token function">mybatisPlusInterceptorByAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">MybatisPlusInterceptor</span> interceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MybatisPlusInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        interceptor<span class="token punctuation">.</span><span class="token function">addInnerInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PaginationInnerInterceptor</span><span class="token punctuation">(</span><span class="token class-name">DbType</span><span class="token punctuation">.</span><span class="token constant">MYSQL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> interceptor<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨æ—¶ï¼Œåªéœ€è¦åœ¨è‡ªå·±å®šä¹‰çš„æ–¹æ³•ä¸ŠåŠ ä¸Šä¸€ä¸ªPageç±»å‹çš„å˜é‡å°±å¯ä»¥è¿›è¡Œåˆ†é¡µæŸ¥è¯¢äº†</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¬¬1é¡µï¼Œæ¯é¡µ10æ¡è®°å½•</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">selectUsers</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SpringSecurityå’Œå…¶ä»–çš„è®¤è¯ç›¸å…³</title>
      <link href="/2024/03/30/39/"/>
      <url>/2024/03/30/39/</url>
      
        <content type="html"><![CDATA[<h1 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h1><blockquote><p>RBACæ¨¡å‹ï¼š Role-Based Access Control åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶è®¿é—®æ§åˆ¶ï¼Œè§’è‰²å…³è”æƒé™ï¼Œè§’è‰²åˆå…³è”ç”¨æˆ·çš„æˆæƒæ–¹å¼<br>ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªè§’è‰²ï¼Œæ¯ä¸€ä¸ªè§’è‰²åˆå¯ä»¥åˆ†é…å¤šä¸ªæƒé™</p></blockquote><p>AuthenticationProvideræ˜¯AuthenticationManagerçš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå®ƒè´Ÿè´£å¤„ç†ç‰¹å®šç±»å‹çš„Authenticationå¯¹è±¡ã€‚AuthenticationManagerå¯èƒ½ä¼šæœ‰å¤šä¸ªAuthenticationProviderï¼Œæ¯ä¸ªAuthenticationProvideréƒ½ä¼šå°è¯•éªŒè¯ä¼ å…¥çš„Authenticationå¯¹è±¡ã€‚</p><h4 id="ä½¿ç”¨æµç¨‹ï¼š"><a href="#ä½¿ç”¨æµç¨‹ï¼š" class="headerlink" title="ä½¿ç”¨æµç¨‹ï¼š"></a>ä½¿ç”¨æµç¨‹ï¼š</h4><p><a href="https://shusheng007.top/2023/02/15/springsecurity/">å‚è€ƒ</a></p><ol><li>controller</li><li>é…ç½®æ‹¦æˆªå™¨/Filterï¼Œç»§æ‰¿OncePerRequestFilterï¼ŒéªŒè¯token</li><li>é…ç½®securityï¼Œåœ¨è¿™é‡Œå¯ä»¥æŒ‡å®šè‡ªå®šä¹‰çš„provider<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableWebSecurity</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">AuthenticationManager</span> <span class="token function">authenticationManager</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationConfiguration</span> authConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> authConfig<span class="token punctuation">.</span><span class="token function">getAuthenticationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">//æˆ‘ä»¬è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">JwtAuthenticationTokenFilter</span> <span class="token function">jwtAuthenticationTokenFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JwtAuthenticationTokenFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">filterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">//åŸºäºtokenï¼Œæ‰€ä»¥ä¸éœ€è¦csrfé˜²æŠ¤</span>        httpSecurity<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">//åŸºäºtokenï¼Œæ‰€ä»¥ä¸éœ€è¦session</span>                <span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sessionCreationPolicy</span><span class="token punctuation">(</span><span class="token class-name">SessionCreationPolicy</span><span class="token punctuation">.</span><span class="token constant">STATELESS</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">//ç™»å½•æ³¨å†Œä¸éœ€è¦è®¤è¯</span>                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/user/login"</span><span class="token punctuation">,</span> <span class="token string">"/user/register"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">//é™¤ä¸Šé¢çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯</span>                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ç¦ç”¨ç¼“å­˜</span>        httpSecurity<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cacheControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å°†æˆ‘ä»¬çš„JWT filteræ·»åŠ åˆ°UsernamePasswordAuthenticationFilterå‰é¢ï¼Œå› ä¸ºè¿™ä¸ªFilteræ˜¯authenticationå¼€å§‹çš„filterï¼Œæˆ‘ä»¬è¦æ—©äºå®ƒ</span>        httpSecurity<span class="token punctuation">.</span><span class="token function">addFilterBefore</span><span class="token punctuation">(</span><span class="token function">jwtAuthenticationTokenFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">UsernamePasswordAuthenticationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> httpSecurity<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h1 id="è®¤è¯ç›¸å…³çš„æ¦‚å¿µå’ŒåŸç†"><a href="#è®¤è¯ç›¸å…³çš„æ¦‚å¿µå’ŒåŸç†" class="headerlink" title="è®¤è¯ç›¸å…³çš„æ¦‚å¿µå’ŒåŸç†"></a>è®¤è¯ç›¸å…³çš„æ¦‚å¿µå’ŒåŸç†</h1><h3 id="Cookieè¢«ç¦ç”¨äº†Sessionè¿˜èƒ½ä½¿ç”¨å—"><a href="#Cookieè¢«ç¦ç”¨äº†Sessionè¿˜èƒ½ä½¿ç”¨å—" class="headerlink" title="Cookieè¢«ç¦ç”¨äº†Sessionè¿˜èƒ½ä½¿ç”¨å—"></a>Cookieè¢«ç¦ç”¨äº†Sessionè¿˜èƒ½ä½¿ç”¨å—</h3><p>å¯ä»¥ä½¿ç”¨ï¼Œå¯ä»¥æŠŠSessionIDæ”¾åœ¨è¯·æ±‚è·¯å¾„ä¸­ï¼ŒåŒæ—¶å¯ä»¥å¯¹SessionIDè¿›è¡ŒåŠ å¯†</p><h2 id="ä¸ºä»€ä¹ˆCookieæ— æ³•é˜²æ­¢CSRFæ”»å‡»ï¼Œè€ŒTokenå¯ä»¥"><a href="#ä¸ºä»€ä¹ˆCookieæ— æ³•é˜²æ­¢CSRFæ”»å‡»ï¼Œè€ŒTokenå¯ä»¥" class="headerlink" title="ä¸ºä»€ä¹ˆCookieæ— æ³•é˜²æ­¢CSRFæ”»å‡»ï¼Œè€ŒTokenå¯ä»¥"></a>ä¸ºä»€ä¹ˆCookieæ— æ³•é˜²æ­¢CSRFæ”»å‡»ï¼Œè€ŒTokenå¯ä»¥</h2><p>CSRF(<strong>Cross Site Request Forgery</strong>) è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ŒTokenå­˜åœ¨localStorageæµè§ˆå™¨æœ¬åœ°ç¼“å­˜ï¼Œç„¶åæ¯æ¬¡å‘é€è¯·æ±‚æºå¸¦è¿™ä¸ªå³å¯ã€‚è€ŒCookieæ˜¯å¯ä»¥è¢«åˆ«çš„è·å–çš„<br>XSS è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆCross Site Scriptingï¼‰</p><h2 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h2><h3 id="æ ¼å¼"><a href="#æ ¼å¼" class="headerlink" title="æ ¼å¼"></a>æ ¼å¼</h3><p>xxxxx.yyyyy.zzzz</p><h4 id="HEADER"><a href="#HEADER" class="headerlink" title="HEADER"></a>HEADER</h4><p>æè¿°JWTçš„å…ƒæ•°æ®ï¼Œå®šä¹‰äº†ç”Ÿæˆç­¾åçš„ç®—æ³•ä»¥åŠTokençš„ç±»å‹</p><ul><li>typ(Type) ï¼šä»¤ç‰Œç±»å‹ï¼Œä¹Ÿå°±æ˜¯JWT</li><li>alg(Algorithm) ï¼šç­¾åç®—æ³•</li></ul><h4 id="PAYLOAD"><a href="#PAYLOAD" class="headerlink" title="PAYLOAD"></a>PAYLOAD</h4><p>å­˜æ”¾å®é™…è¦ä¼ è¾“çš„æ•°æ®ï¼ŒåŒ…å«Claims(å£°æ˜ï¼ŒåŒ…å«JWTçš„ç›¸å…³ä¿¡æ¯)</p><ul><li>æ³¨å†Œå£°æ˜ï¼šé¢„å®šä¹‰çš„ä¸€äº›å£°æ˜</li><li>å…¬æœ‰å£°æ˜ï¼šJWTç­¾å‘æ–¹å¯ä»¥è‡ªå®šä¹‰çš„å£°æ˜</li><li>ç§æœ‰å£°æ˜ï¼šç­¾å‘æ–¹å› ä¸ºé¡¹ç›®ä¸­éœ€è¦è€Œè‡ªå®šä¹‰çš„å£°æ˜</li></ul><h4 id="SIGNATURE-ç­¾å"><a href="#SIGNATURE-ç­¾å" class="headerlink" title="SIGNATURE (ç­¾å)"></a>SIGNATURE (ç­¾å)</h4><p>é€šè¿‡Payloadå’ŒHeaderå’ŒSecretæ˜¯å“Ÿä¸ªHeaderä¸­æŒ‡å®šçš„ç­¾åç®—æ³•<br>ç”¨äºé˜²æ­¢JWTè¢«ç¯¡æ”¹<br>è¿™ä¸ªç­¾åçš„ç”Ÿæˆéœ€è¦ç”¨åˆ°ï¼š</p><ul><li>Header + Payloadã€‚</li><li>å­˜æ”¾åœ¨æœåŠ¡ç«¯çš„å¯†é’¥(ä¸€å®šä¸è¦æ³„éœ²å‡ºå»)ã€‚</li><li>ç­¾åç®—æ³•ã€‚</li></ul><h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><h2 id="SSO-å•ç‚¹ç™»å½•"><a href="#SSO-å•ç‚¹ç™»å½•" class="headerlink" title="SSO å•ç‚¹ç™»å½•"></a>SSO å•ç‚¹ç™»å½•</h2><h2 id="OAuth-2-0"><a href="#OAuth-2-0" class="headerlink" title="OAuth 2.0"></a>OAuth 2.0</h2><h2 id="æƒé™è®¾è®¡"><a href="#æƒé™è®¾è®¡" class="headerlink" title="æƒé™è®¾è®¡"></a>æƒé™è®¾è®¡</h2><h3 id="RBAC"><a href="#RBAC" class="headerlink" title="RBAC"></a>RBAC</h3><p>åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶</p><h3 id="ABAC"><a href="#ABAC" class="headerlink" title="ABAC"></a>ABAC</h3><p>åŸºäºå±æ€§çš„æ§åˆ¶è®¿é—®</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>TVM</title>
      <link href="/2024/03/17/19/"/>
      <url>/2024/03/17/19/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¦‚å¿µï¼š"><a href="#æ¦‚å¿µï¼š" class="headerlink" title="æ¦‚å¿µï¼š"></a>æ¦‚å¿µï¼š</h2><p>TVMï¼ˆTensor Virtual Machineï¼Œå¼ é‡è™šæ‹Ÿæœºï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„ã€ç«¯åˆ°ç«¯çš„æœºå™¨å­¦ä¹ ç¼–è¯‘å™¨æ¡†æ¶ï¼Œæ—¨åœ¨å°†æœºå™¨å­¦ä¹ ç®—æ³•è‡ªåŠ¨ç¼–è¯‘æˆå¯ä¾›ä¸‹å±‚ç¡¬ä»¶æ‰§è¡Œçš„æœºå™¨è¯­è¨€ï¼Œä»è€Œåˆ©ç”¨å¤šç§ç±»å‹çš„ç®—åŠ›ã€‚ä¹Ÿå°±æ˜¯å°†æ·±åº¦å­¦ä¹ æ¨¡å‹è¿›è¡Œé«˜æ•ˆæ¨ç†ã€å†…å­˜ç®¡ç†ä¸çº¿ç¨‹è°ƒåº¦ä¼˜åŒ–åï¼Œå†é€šè¿‡LLVMéƒ¨ç½²åœ¨CPUã€GPUã€FPGAã€ARMç­‰ç¡¬ä»¶è®¾å¤‡ä¸Šã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>6.S081</title>
      <link href="/2024/03/06/23/"/>
      <url>/2024/03/06/23/</url>
      
        <content type="html"><![CDATA[<h1 id="OS"><a href="#OS" class="headerlink" title="OS"></a>OS</h1><ol><li><p>ç³»ç»Ÿè°ƒç”¨è·³åˆ°å†…æ ¸ä¸æ ‡å‡†çš„å‡½æ•°è°ƒç”¨è·³åˆ°å¦ä¸€ä¸ªå‡½æ•°ç›¸æ¯”ï¼ŒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p><p> Kernelçš„ä»£ç æ€»æ˜¯æœ‰ç‰¹æ®Šçš„æƒé™ã€‚å½“æœºå™¨å¯åŠ¨Kernelæ—¶ï¼ŒKernelä¼šæœ‰ç‰¹æ®Šçš„æƒé™èƒ½ç›´æ¥è®¿é—®å„ç§å„æ ·çš„ç¡¬ä»¶ï¼Œä¾‹å¦‚ç£ç›˜ã€‚è€Œæ™®é€šçš„ç”¨æˆ·ç¨‹åºæ˜¯æ²¡æœ‰åŠæ³•ç›´æ¥è®¿é—®è¿™äº›ç¡¬ä»¶çš„ã€‚æ‰€ä»¥ï¼Œå½“ä½ æ‰§è¡Œä¸€ä¸ªæ™®é€šçš„å‡½æ•°è°ƒç”¨æ—¶ï¼Œä½ æ‰€è°ƒç”¨çš„å‡½æ•°å¹¶æ²¡æœ‰å¯¹äºç¡¬ä»¶çš„ç‰¹æ®Šæƒé™ã€‚ç„¶è€Œï¼Œå¦‚æœä½ è§¦å‘ç³»ç»Ÿè°ƒç”¨åˆ°å†…æ ¸ä¸­ï¼Œå†…æ ¸ä¸­çš„å…·ä½“å®ç°ä¼šå…·æœ‰è¿™äº›ç‰¹æ®Šçš„æƒé™ï¼Œè¿™æ ·å°±èƒ½ä¿®æ”¹æ•æ„Ÿçš„å’Œè¢«ä¿æŠ¤çš„ç¡¬ä»¶èµ„æºï¼Œæ¯”å¦‚è®¿é—®ç¡¬ä»¶ç£ç›˜ã€‚æˆ‘ä»¬ä¹‹åä¼šä»‹ç»æ›´å¤šæœ‰å…³çš„ç»†èŠ‚ã€‚</p></li><li><p>Kernel<br> å†…æ ¸ä½¿ç”¨CPUæä¾›çš„ç¡¬ä»¶ä¿æŠ¤æœºåˆ¶æ¥ç¡®ä¿æ¯ä¸ªåœ¨ç”¨æˆ·ç©ºé—´æ‰§è¡Œçš„è¿›ç¨‹åªèƒ½è®¿é—®å®ƒè‡ªå·±çš„å†…å­˜ã€‚å†…æ ¸ç¨‹åºçš„æ‰§è¡Œæ‹¥æœ‰æ“æ§ç¡¬ä»¶çš„æƒé™ï¼Œå®ƒéœ€è¦å®ç°è¿™äº›ä¿æŠ¤ï¼›è€Œç”¨æˆ·ç¨‹åºæ‰§è¡Œæ—¶æ²¡æœ‰è¿™äº›ç‰¹æƒã€‚å½“ç”¨æˆ·ç¨‹åºè°ƒç”¨ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œç¡¬ä»¶ä¼šæå‡æƒé™çº§åˆ«ï¼Œå¹¶å¼€å§‹æ‰§è¡Œå†…æ ¸ä¸­é¢„å…ˆå®‰æ’å¥½çš„å‡½æ•°ã€‚<br> <img src="/2024/03/06/23/Kernel.png" alt="Kernel"></p></li><li><p>xv6æä¾›çš„ç³»ç»Ÿè°ƒç”¨<br> <a href="https://xv6.dgs.zone/tranlate_books/book-riscv-rev1/c1/s0.html">çœ‹æ–‡æ¡£</a></p></li><li><p>Shell æ˜¯ä¸€ä¸ªæ™®é€šçš„è¿›ç¨‹ï¼Œæ˜¯ä¸€ä¸ªç”¨æˆ·ç¨‹åºï¼Œç”¨æˆ·ä½¿ç”¨Shellæ¥ä¸ç³»ç»Ÿè°ƒç”¨è¿›è¡Œäº¤äº’</p></li></ol><h3 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h3><ol><li>è¿›ç¨‹ç”± ç”¨æˆ·ç©ºé—´å†…å­˜(æŒ‡ä»¤ã€æ•°æ®å’Œå †æ ˆ)å’Œå¯¹å†…æ ¸ç§æœ‰çš„æ¯ä¸ªè¿›ç¨‹çŠ¶æ€ç»„æˆ</li><li>Xv6 é‡‡ç”¨åˆ†æ—¶è¿›ç¨‹ï¼Œç­‰å¾…æ‰§è¡Œä¸­çš„è¿›ç¨‹é›†åˆåˆ‡æ¢å¯ç”¨çš„CPUï¼Œå½“è¿›ç¨‹æ²¡æœ‰æ‰§è¡Œæ—¶ï¼Œxv6ä¼šä¿å­˜ä»–çš„CPUå¯„å­˜å™¨ï¼Œå¹¶åœ¨ä¸‹ä¸€æ¬¡è¿è¡Œæ—¶æ¢å¤ï¼Œä½¿ç”¨è¿›ç¨‹idæˆ–PIDæ ‡ç¤ºè¿›ç¨‹ã€</li></ol><h3 id="I-x2F-O"><a href="#I-x2F-O" class="headerlink" title="I/O"></a>I/O</h3><ol><li>æ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸€ä¸ªå°æ•´æ•°(small integer)ï¼Œè¡¨ç¤ºè¿›ç¨‹å¯ä»¥è¯»å–æˆ–å†™å…¥çš„ç”±å†…æ ¸ç®¡ç†çš„å¯¹è±¡</li><li>è¿›ç¨‹ä»æ–‡ä»¶æè¿°ç¬¦0è¯»å–ï¼ˆæ ‡å‡†è¾“å…¥ï¼‰ï¼Œå°†è¾“å‡ºå†™å…¥æ–‡ä»¶æè¿°ç¬¦1ï¼ˆæ ‡å‡†è¾“å‡ºï¼‰ï¼Œå¹¶å°†é”™è¯¯æ¶ˆæ¯å†™å…¥æ–‡ä»¶æè¿°ç¬¦2ï¼ˆæ ‡å‡†é”™è¯¯ï¼‰ã€‚</li><li>ç®¡é“ï¼šä½œä¸ºä¸€å¯¹æ–‡ä»¶æè¿°ç¬¦å…¬å¼€ç»™è¿›ç¨‹çš„å°å‹å†…æ ¸ç¼“å†²åŒºï¼Œä¸€ä¸ªç”¨äºè¯»å–ï¼Œä¸€ä¸ªç”¨äºå†™å…¥ã€‚å°†æ•°æ®å†™å…¥ç®¡é“çš„ä¸€ç«¯ä½¿å¾—è¿™äº›æ•°æ®å¯ä»¥ä»ç®¡é“çš„å¦ä¸€ç«¯è¯»å–ã€‚ç®¡é“ä¸ºè¿›ç¨‹æä¾›äº†ä¸€ç§é€šä¿¡æ–¹å¼ã€‚</li></ol><ul><li><p>é¦–å…ˆï¼Œç®¡é“ä¼šè‡ªåŠ¨æ¸…ç†è‡ªå·±ï¼›åœ¨æ–‡ä»¶é‡å®šå‘æ—¶ï¼Œshellä½¿ç”¨å®Œ<code>/tmp/xyz</code>åå¿…é¡»å°å¿ƒåˆ é™¤</p></li><li><p>å…¶æ¬¡ï¼Œç®¡é“å¯ä»¥ä»»æ„ä¼ é€’é•¿çš„æ•°æ®æµï¼Œè€Œæ–‡ä»¶é‡å®šå‘éœ€è¦ç£ç›˜ä¸Šè¶³å¤Ÿçš„ç©ºé—²ç©ºé—´æ¥å­˜å‚¨æ‰€æœ‰çš„æ•°æ®ã€‚</p></li><li><p>ç¬¬ä¸‰ï¼Œç®¡é“å…è®¸å¹¶è¡Œæ‰§è¡Œç®¡é“é˜¶æ®µï¼Œè€Œæ–‡ä»¶æ–¹æ³•è¦æ±‚ç¬¬ä¸€ä¸ªç¨‹åºåœ¨ç¬¬äºŒä¸ªç¨‹åºå¯åŠ¨ä¹‹å‰å®Œæˆã€‚</p></li><li><p>ç¬¬å››ï¼Œå¦‚æœå®ç°è¿›ç¨‹é—´é€šè®¯ï¼Œç®¡é“çš„<strong>é˜»å¡</strong>å¼è¯»å†™æ¯”æ–‡ä»¶çš„éé˜»å¡è¯­ä¹‰æ›´é«˜æ•ˆã€‚</p></li></ul><h3 id="æ“ä½œç³»ç»Ÿæ¶æ„"><a href="#æ“ä½œç³»ç»Ÿæ¶æ„" class="headerlink" title="æ“ä½œç³»ç»Ÿæ¶æ„"></a>æ“ä½œç³»ç»Ÿæ¶æ„</h3><p>æ“ä½œç³»ç»Ÿå¿…é¡»æ»¡è¶³ä¸‰ä¸ªè¦æ±‚ï¼šå¤šè·¯å¤ç”¨ã€éš”ç¦»å’Œäº¤äº’ã€‚</p><ol><li>éš”ç¦»ï¼šç¦æ­¢åº”ç”¨ç¨‹åºç›´æ¥è®¿é—®æ•æ„Ÿçš„ç¡¬ä»¶èµ„æºï¼Œå°†èµ„æºæŠ½è±¡æˆæœåŠ¡ã€‚æä¾›ç³»ç»Ÿè°ƒç”¨</li><li>ç”¨æˆ·æƒ³è¦æ‰§è¡Œå†…æ ¸å‡½æ•°å¿…é¡»ç”±ç”¨æˆ·æ¨¡å¼è¿‡æ¸¡åˆ°ç®¡ç†æ¨¡å¼</li></ol><ul><li>æ•´ä¸ªæ“ä½œç³»ç»Ÿéƒ½é©»ç•™åœ¨å†…æ ¸ä¸­ï¼Œè¿™æ ·æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨çš„å®ç°éƒ½ä»¥ç®¡ç†æ¨¡å¼è¿è¡Œã€‚è¿™ç§ç»„ç»‡è¢«ç§°ä¸º<strong>å®å†…æ ¸ï¼ˆmonolithic kernelï¼‰</strong>ã€‚<ul><li>ç¼ºç‚¹æ˜¯æ“ä½œç³»ç»Ÿä¸åŒéƒ¨åˆ†ä¹‹é—´çš„æ¥å£é€šå¸¸å¾ˆå¤æ‚ï¼ˆæ­£å¦‚æˆ‘ä»¬å°†åœ¨æœ¬æ–‡çš„å…¶ä½™éƒ¨åˆ†ä¸­çœ‹åˆ°çš„ï¼‰ï¼Œå› æ­¤æ“ä½œç³»ç»Ÿå¼€å‘äººå‘˜å¾ˆå®¹æ˜“çŠ¯é”™è¯¯ã€‚åœ¨å®å†…æ ¸ä¸­ï¼Œä¸€ä¸ªé”™è¯¯å°±å¯èƒ½æ˜¯è‡´å‘½çš„ï¼Œå› ä¸ºç®¡ç†æ¨¡å¼ä¸­çš„é”™è¯¯ç»å¸¸ä¼šå¯¼è‡´å†…æ ¸å¤±è´¥ã€‚å¦‚æœå†…æ ¸å¤±è´¥ï¼Œè®¡ç®—æœºåœæ­¢å·¥ä½œï¼Œå› æ­¤æ‰€æœ‰åº”ç”¨ç¨‹åºä¹Ÿä¼šå¤±è´¥ã€‚è®¡ç®—æœºå¿…é¡»é‡å¯æ‰èƒ½å†æ¬¡ä½¿ç”¨ã€‚</li></ul></li><li>å¾®å†…æ ¸<ul><li>æ“ä½œç³»ç»Ÿè®¾è®¡è€…å¯ä»¥æœ€å¤§é™åº¦åœ°å‡å°‘åœ¨ç®¡ç†æ¨¡å¼ä¸‹è¿è¡Œçš„æ“ä½œç³»ç»Ÿä»£ç é‡ï¼Œå¹¶åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹æ‰§è¡Œå¤§éƒ¨åˆ†æ“ä½œç³»ç»Ÿã€‚è¿™ç§å†…æ ¸ç»„ç»‡è¢«ç§°ä¸º<strong>å¾®å†…æ ¸ï¼ˆmicrokernelï¼‰</strong></li><li>æ–‡ä»¶ç³»ç»Ÿä½œä¸ºç”¨æˆ·çº§è¿›ç¨‹è¿è¡Œã€‚ä½œä¸ºè¿›ç¨‹è¿è¡Œçš„æ“ä½œç³»ç»ŸæœåŠ¡è¢«ç§°ä¸ºæœåŠ¡å™¨ã€‚ä¸ºäº†å…è®¸åº”ç”¨ç¨‹åºä¸æ–‡ä»¶æœåŠ¡å™¨äº¤äº’ï¼Œå†…æ ¸æä¾›äº†å…è®¸ä»ä¸€ä¸ªç”¨æˆ·æ€è¿›ç¨‹å‘å¦ä¸€ä¸ªç”¨æˆ·æ€è¿›ç¨‹å‘é€æ¶ˆæ¯çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ã€‚</li></ul></li><li>è¿›ç¨‹<ul><li>è¿›ç¨‹æŠ½è±¡ç»™ç¨‹åºæä¾›äº†ä¸€ç§é”™è§‰ï¼Œå³å®ƒæœ‰è‡ªå·±çš„ä¸“ç”¨æœºå™¨ã€‚è¿›ç¨‹ä¸ºç¨‹åºæä¾›äº†ä¸€ä¸ªçœ‹èµ·æ¥åƒæ˜¯ç§æœ‰å†…å­˜ç³»ç»Ÿæˆ–åœ°å€ç©ºé—´çš„ä¸œè¥¿ï¼Œå…¶ä»–è¿›ç¨‹ä¸èƒ½è¯»å–æˆ–å†™å…¥ã€‚</li></ul></li><li>å¯åŠ¨è¿‡ç¨‹ï¼š åˆå§‹åŒ–è‡ªå·±å¹¶è¿è¡Œä¸€ä¸ªå­˜å‚¨åœ¨åªè¯»å†…å­˜ä¸­çš„å¼•å¯¼åŠ è½½ç¨‹åºã€‚å¼•å¯¼åŠ è½½ç¨‹åºå°†xv6å†…æ ¸åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ç„¶åï¼Œåœ¨æœºå™¨æ¨¡å¼ä¸‹ï¼Œä¸­å¤®å¤„ç†å™¨ä»<code>_entry</code>&nbsp;(<strong><em>kernel/entry.S</em></strong>:6)å¼€å§‹è¿è¡Œxv6ã€‚Xv6å¯åŠ¨æ—¶é¡µå¼ç¡¬ä»¶ï¼ˆpaging hardwareï¼‰å¤„äºç¦ç”¨æ¨¡å¼ï¼šä¹Ÿå°±æ˜¯è¯´è™šæ‹Ÿåœ°å€å°†ç›´æ¥æ˜ å°„åˆ°ç‰©ç†åœ°å€ã€‚</li></ul><h3 id="é¡µè¡¨"><a href="#é¡µè¡¨" class="headerlink" title="é¡µè¡¨"></a>é¡µè¡¨</h3><p>é¡µè¡¨æ˜¯æ“ä½œç³»ç»Ÿä¸ºæ¯ä¸ªè¿›ç¨‹æä¾›ç§æœ‰åœ°å€ç©ºé—´å’Œå†…å­˜çš„æœºåˆ¶ã€‚é¡µè¡¨å†³å®šäº†å†…å­˜åœ°å€çš„å«ä¹‰ï¼Œä»¥åŠç‰©ç†å†…å­˜çš„å“ªäº›éƒ¨åˆ†å¯ä»¥è®¿é—®ã€‚</p><h2 id="Lab"><a href="#Lab" class="headerlink" title="Lab"></a>Lab</h2><h3 id="lab1"><a href="#lab1" class="headerlink" title="lab1"></a>lab1</h3><p>æ¨èä½¿ç”¨2021ç‰ˆçš„å®˜æ–¹æ•™ç¨‹ï¼Œ2020çš„æˆ‘æ‰“å¼€ä¸äº†<br>ä¸å»ºè®®åœ¨rootç”¨æˆ·ä¸‹è¿›è¡Œ</p><h4 id="sleep-easy"><a href="#sleep-easy" class="headerlink" title="sleep (easy)"></a>sleep (easy)</h4><p><strong>å®ç°xv6çš„UNIXç¨‹åº</strong><code>sleep</code><strong>ï¼šæ‚¨çš„</strong><code>sleep</code><strong>åº”è¯¥æš‚åœåˆ°ç”¨æˆ·æŒ‡å®šçš„è®¡æ—¶æ•°ã€‚ä¸€ä¸ªæ»´ç­”(tick)æ˜¯ç”±xv6å†…æ ¸å®šä¹‰çš„æ—¶é—´æ¦‚å¿µï¼Œå³æ¥è‡ªå®šæ—¶å™¨èŠ¯ç‰‡çš„ä¸¤ä¸ªä¸­æ–­ä¹‹é—´çš„æ—¶é—´ã€‚æ‚¨çš„è§£å†³æ–¹æ¡ˆåº”è¯¥åœ¨æ–‡ä»¶user/sleep.cä¸­</strong></p><p>æ€è·¯ï¼š<strong>å…ˆæŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨çš„ä»£ç </strong></p><ol><li>å¼•å…¥å¤´æ–‡ä»¶ï¼Œå³&nbsp;<code>kernel/types.h</code>&nbsp;å£°æ˜ç±»å‹çš„å¤´æ–‡ä»¶å’Œ&nbsp;<code>user/user.h</code>&nbsp;å£°æ˜ç³»ç»Ÿè°ƒç”¨å‡½æ•°å’Œ&nbsp;<code>ulib.c</code>&nbsp;ä¸­å‡½æ•°çš„å¤´æ–‡ä»¶ã€‚</li><li>ç¼–å†™&nbsp;<code>main(int argc,char* argv[])</code>&nbsp;å‡½æ•°ã€‚å…¶ä¸­ï¼Œå‚æ•°&nbsp;<code>argc</code>&nbsp;æ˜¯å‘½ä»¤è¡Œæ€»å‚æ•°çš„ä¸ªæ•°ï¼Œå‚æ•°&nbsp;<code>argv[]</code>&nbsp;æ˜¯&nbsp;<code>argc</code>&nbsp;ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬ 0 ä¸ªå‚æ•°æ˜¯ç¨‹åºçš„å…¨åï¼Œå…¶ä»–çš„å‚æ•°æ˜¯å‘½ä»¤è¡Œåé¢è·Ÿçš„ç”¨æˆ·è¾“å…¥çš„å‚æ•°ã€‚</li><li>åœ¨Makefileä¸­åŠ å…¥$U/_sleep<br>å‚è€ƒç­”æ¡ˆ:<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">//å¼•å…¥typeå®šä¹‰å’Œç³»ç»Ÿè°ƒç”¨æ–‡ä»¶#include "kernel/types.h"#include "user/user.h"//ç¼–å†™mainå‡½æ•°//argc æ˜¯shellæ¥å—çš„å‚æ•°ä¸ªæ•°ï¼ŒargvæŒ‡å‘å¯¹åº”çš„å‚æ•°//argv[0] å§‹ç»ˆæŒ‡å‘å‡½æ•°çš„å…¨åint main(int argc, char **argv)</span> <span class="token punctuation">{</span>    <span class="token selector">//shell ä¸­åº”è¯¥è¾“å…¥ sleep +å‚æ•°ï¼Œæ‰€ä»¥åªæ¥å—ä¸€ä¸ªå‚æ•°, argc åº”ä¸º 2    if(argc != 2)</span> <span class="token punctuation">{</span>        //writeï¼ˆint fd <span class="token punctuation">,</span>char *buf<span class="token punctuation">,</span> int n<span class="token punctuation">)</span>        // fdæ˜¯æ–‡ä»¶æè¿°ç¬¦ 0 æ˜¯æ ‡å‡†è¾“å…¥ï¼Œ1æ ‡å‡†è¾“å‡º<span class="token punctuation">,</span>2æ˜¯æ ‡å‡†é”™è¯¯        //buf å­˜æ”¾è¦å†™å…¥å†™å‡ºçš„å­—ç¬¦æ•°ç»„        // n æ˜¯è¦ä¼ è¾“çš„å­—èŠ‚æ•°        <span class="token function">write</span><span class="token punctuation">(</span>2<span class="token punctuation">,</span><span class="token string">"Usage: sleep time\n"</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">"Usage: sleep time\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        //<span class="token function">exit</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span> 0 æ ‡ç¤ºæ­£å¸¸é€€å‡ºï¼Œé0è—è§†é”™è¯¯é€€å‡º        <span class="token function">exit</span><span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    //ä½¿ç”¨atoiæ¥è½¬ä¸ºintå‹    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token function">atoi</span><span class="token punctuation">(</span>argv[1]<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">exit</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>Makefile:<pre class="line-numbers language-css" data-language="css"><code class="language-css">UPROGS=\$U/_cat\$U/_echo\$U/_forktest\$U/_grep\$U/_init\$U/_kill\$U/_ln\$U/_ls\$U/_mkdir\$U/_rm\$U/_sh\$U/_stressfs\$U/_usertests\$U/_grind\$U/_wc\$U/_zombie\$U/_sleep\ # è¿™æ˜¯æˆ‘ä»¬è¦å†™çš„<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>å•å…ƒæµ‹è¯•:</li><li>make qemu ä¹‹ååœ¨shellä¸­ sleep 100 çœ‹çœ‹æ˜¯å¦åœé¡¿ï¼Œ å¦‚æœmake qemu æŠ¥é”™ï¼Œå¯èƒ½æ˜¯æ²¡æœ‰ è‡ªåŠ¨ç¼–è¯‘ï¼Œå»ºè®®é‡æ–°å¯åŠ¨</li><li>ä¸å¯åŠ¨xv6,åœ¨xv6-labs-2021 è·¯å¾„ä¸‹ä½¿ç”¨ï¼š ./grade-lab-util sleep              â€”-sleepå¯æ›¿æ¢ä¸ºå…¶ä»–å¾…æµ‹çš„ï¼Œä¹Ÿå¯ä»¥ä¸åŠ ï¼Œç›´æ¥æŠŠå…¨éƒ¨å®éªŒä»£ç éƒ½è¿›è¡Œæµ‹ï¼Œæƒé™ä¸å¤Ÿè‡ªå·±sudo, æŠ¥é”™äº†å¯èƒ½æ²¡å®‰è£…python3</li></ol><h4 id="pingpong-Easy"><a href="#pingpong-Easy" class="headerlink" title="pingpong (Easy)"></a>pingpong (Easy)</h4><blockquote><p><strong>ç¼–å†™ä¸€ä¸ªä½¿ç”¨UNIXç³»ç»Ÿè°ƒç”¨çš„ç¨‹åºæ¥åœ¨ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´â€œping-pongâ€ä¸€ä¸ªå­—èŠ‚ï¼Œè¯·ä½¿ç”¨ä¸¤ä¸ªç®¡é“ï¼Œæ¯ä¸ªæ–¹å‘ä¸€ä¸ªã€‚çˆ¶è¿›ç¨‹åº”è¯¥å‘å­è¿›ç¨‹å‘é€ä¸€ä¸ªå­—èŠ‚;å­è¿›ç¨‹åº”è¯¥æ‰“å°â€œ<code>&lt;pid&gt;: received ping</code>â€ï¼Œå…¶ä¸­<code>&lt;pid&gt;</code>æ˜¯è¿›ç¨‹IDï¼Œå¹¶åœ¨ç®¡é“ä¸­å†™å…¥å­—èŠ‚å‘é€ç»™çˆ¶è¿›ç¨‹ï¼Œç„¶åé€€å‡º;çˆ¶çº§åº”è¯¥ä»è¯»å–ä»å­è¿›ç¨‹è€Œæ¥çš„å­—èŠ‚ï¼Œæ‰“å°â€œ<code>&lt;pid&gt;: received pong</code>â€ï¼Œç„¶åé€€å‡ºã€‚æ‚¨çš„è§£å†³æ–¹æ¡ˆåº”è¯¥åœ¨æ–‡ä»¶_user/pingpong.c_ä¸­ã€‚</strong></p></blockquote><p>æ€è·¯ï¼š</p><ol><li>ä½¿ç”¨pipeæ¥å»ºç«‹ç®¡é“</li><li>forkæ¥å»ºç«‹å­è¿›ç¨‹å¹¶ç”¨æ¥åŒºåˆ†çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹</li><li>getpidæ¥è·å–è¿›ç¨‹pid</li><li>read å’Œ writeæ¥è¿›è¡Œè¯»å†™</li><li>Makefile <pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">// pingpong.c #include "kernel/types.h"#include "user/user.h"#include "stddef.h"//int main(int argc, char **argv)</span> <span class="token punctuation">{</span> // argcæ˜¯è¾“å…¥çš„å‚æ•°ä¸ªæ•°ï¼ŒargvæŒ‡å‘å¯¹åº”çš„å‚æ•°    //å®šä¹‰ä¸¤ä¸ªpipe    int pp2c[2]<span class="token punctuation">,</span>pc2p[2]<span class="token punctuation">;</span> // p parent to child    //p[0] æ˜¯æ–‡ä»¶æè¿°ç¬¦0<span class="token punctuation">,</span> 0 æ˜¯è¾“å…¥ç«¯ï¼Œ1æ˜¯è¾“å‡ºç«¯    <span class="token function">pipe</span><span class="token punctuation">(</span>pp2c<span class="token punctuation">)</span><span class="token punctuation">;</span> //çˆ¶è¿›ç¨‹ -&gt; å­è¿›ç¨‹    <span class="token function">pipe</span><span class="token punctuation">(</span>pc2p<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token selector">//ä½¿ç”¨forkæ¥åˆ¤æ–­å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹    if(fork() != 0 )</span> <span class="token punctuation">{</span> //çˆ¶è¿›ç¨‹        //<span class="token function">write</span><span class="token punctuation">(</span>æ–‡ä»¶æè¿°ç¬¦<span class="token punctuation">,</span>æŒ‡é’ˆï¼Œå­—èŠ‚æ•°<span class="token punctuation">)</span>        <span class="token function">write</span><span class="token punctuation">(</span>pp2c[1]<span class="token punctuation">,</span><span class="token string">"!"</span><span class="token punctuation">,</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span> //çˆ¶è¿›ç¨‹å‘å­è¿›ç¨‹å‘å‡ºä¸€ä¸ªå­—èŠ‚        char buf <span class="token punctuation">;</span> //å¾…è¯»å…¥ç¼“å†²åŒº<span class="token punctuation">,</span>ç”¨äºå­˜å‚¨        <span class="token function">read</span><span class="token punctuation">(</span>pc2p[0]<span class="token punctuation">,</span>&amp;buf<span class="token punctuation">,</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d: received pong\n"</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">wait</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token selector">else</span> <span class="token punctuation">{</span>        char buf<span class="token punctuation">;</span>        //ä»çˆ¶è¿›ç¨‹è¯»å…¥        <span class="token function">read</span><span class="token punctuation">(</span>pp2c[0]<span class="token punctuation">,</span>&amp;buf<span class="token punctuation">,</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d: received ping\n"</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        //å­è¿›ç¨‹é‡æ–°å‘é€ç»™çˆ¶è¿›ç¨‹        <span class="token function">write</span><span class="token punctuation">(</span>pc2p[1]<span class="token punctuation">,</span>&amp;buf<span class="token punctuation">,</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">exit</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h4 id="prime"><a href="#prime" class="headerlink" title="prime"></a>prime</h4><p>æ€è·¯ï¼šä½¿ç”¨ç­›æ³•ï¼Œæ¯æ¬¡è¾“å‡ºä¸€ä¸ªç´ æ•°ä¹‹åï¼ŒæŠŠè¿™ä¸ªç´ æ•°çš„å€æ•°åˆ é™¤ï¼Œä¹‹åå†é‡æ–°å†™å…¥pipeä¸­ä¾›ä¸‹ä¸€ä¸ªå­è¿›ç¨‹ä½¿ç”¨å³å¯ã€‚æ³¨æ„å›æ”¶æ–‡ä»¶æè¿°ç¬¦å³å¯<br>æ³¨æ„: <strong>ä¸€å®šè¦ä½¿ç”¨å­è¿›ç¨‹</strong> ï¼Œä¸ä½¿ç”¨å­è¿›ç¨‹ä¼šå¯¼è‡´é˜»å¡è‡´æ­»</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">#include "kernel/types.h"#include "user/user.h"#include "stddef.h" // ä¸ºäº†å¾—åˆ°NULL//å°†æè¿°ç¬¦é‡æ–°å®šå‘void mapping(int n , int pd[])</span> <span class="token punctuation">{</span>    <span class="token function">close</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>    //dupä¼šè¿”å›ä¸€ä¸ªæœ€å°çš„æœªä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åæˆ‘ä»¬close    //äº†nï¼Œä¹Ÿå°±æ˜¯ä¼šè¿”å›n<span class="token punctuation">,</span>ä¹‹åä¼šå°†è¿™ä¸ªæè¿°ç¬¦æŒ‡å‘pd[n]æ‰€æŒ‡å‘çš„æ–‡ä»¶    <span class="token function">dup</span><span class="token punctuation">(</span>pd[n]<span class="token punctuation">)</span><span class="token punctuation">;</span>    //å†å…³é—­pd å°±å®ç°äº†å°†pd[n] é‡å®šå‘åˆ°nçš„æ“ä½œ    <span class="token function">close</span><span class="token punctuation">(</span>pd[0]<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">close</span><span class="token punctuation">(</span>pd[1]<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">void primes()</span> <span class="token punctuation">{</span>    //å¼€å§‹è¯»å…¥æ•°æ®    int current<span class="token punctuation">,</span>next<span class="token punctuation">;</span> //currentæ¥ä¿å­˜ç°åœ¨çš„æ•°    int fd[2]<span class="token punctuation">;</span>    <span class="token selector">// ä»0ä¸­è¯»å–æ•°æ®ï¼Œå¹¶å†™å…¥current,è¯»å–å­—èŠ‚é•¿åº¦ä¸ºsizeof(int)    if(read(0,&amp;current,sizeof(int)))</span> <span class="token punctuation">{</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"prime %d\n"</span><span class="token punctuation">,</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">pipe</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token selector">//å¼€å§‹ç­›é€‰ï¼Œæ¯ç»å†ä¸€ä¸ªå­è¿›ç¨‹å°±dropä¸€äº›æ•°æ®        if(fork() == 0)</span> <span class="token punctuation">{</span>            <span class="token function">mapping</span><span class="token punctuation">(</span>1<span class="token punctuation">,</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>//å®šå‘åˆ°å†™å…¥ç«¯            <span class="token selector">//é‡å¤ä»1ä¸­è¯»å…¥ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯currentçš„å€æ•°            while(read(0,&amp;next,sizeof(int)))</span> <span class="token punctuation">{</span>                <span class="token selector">if(next % current != 0)</span> <span class="token punctuation">{</span>                    <span class="token function">write</span><span class="token punctuation">(</span>1<span class="token punctuation">,</span>&amp;next<span class="token punctuation">,</span><span class="token function">sizeof</span><span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token selector">else</span> <span class="token punctuation">{</span>            <span class="token function">wait</span><span class="token punctuation">(</span>NULL<span class="token punctuation">)</span><span class="token punctuation">;</span> //ç­‰å¾…å­è¿›ç¨‹ç»“æŸ            //åå¤è°ƒç”¨å³å¯            <span class="token function">mapping</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">primes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token selector">//0ç”¨æ¥è¯»å–ï¼Œ 1ç”¨æ¥å†™å…¥int main(int argc, char **argv)</span> <span class="token punctuation">{</span>    int fd[2]<span class="token punctuation">;</span> //æ–‡ä»¶æè¿°ç¬¦    //fdæ˜¯å…±ç”¨çš„    <span class="token function">pipe</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token selector">//fd[0]æ˜¯è¯»å…¥ç«¯ï¼Œä¹Ÿå°±æ˜¯ä»pipeä¸­è¯»å–å­—èŠ‚ï¼Œfd[1]æ˜¯å†™å…¥ç«¯ï¼Œå¯ä»¥å‘pipeä¸­å†™å…¥    if(fork() == 0)</span> <span class="token punctuation">{</span>    //å­è¿›ç¨‹å†™å…¥ 2 - 35        <span class="token function">mapping</span><span class="token punctuation">(</span>1<span class="token punctuation">,</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>//å°†æ ‡å‡†è¾“å‡ºæŒ‡å‘fdçš„å†™å…¥ç«¯ï¼Œä¹Ÿå°±æ˜¯å°†è¾“æŒ‡å‘å†™å…¥ç«¯        <span class="token function">for</span><span class="token punctuation">(</span>int i = 2<span class="token punctuation">;</span> i &lt;= 35<span class="token punctuation">;</span> <span class="token selector">i ++)</span> <span class="token punctuation">{</span>            //write æ˜¯å‘æ ‡å‡†è¾“å‡ºå†™å…¥ä¸œè¥¿ï¼Œæ ‡å‡†è¾“å‡ºå·²ç»æŒ‡å‘fd[1]äº†ï¼Œä¹Ÿå°±æ˜¯å‘fdå†™å…¥æ•°æ®                <span class="token function">write</span><span class="token punctuation">(</span>1<span class="token punctuation">,</span>&amp;i<span class="token punctuation">,</span><span class="token function">sizeof</span><span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token selector">else</span> <span class="token punctuation">{</span>        <span class="token function">wait</span><span class="token punctuation">(</span>NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>//ç­‰å¾…å­è¿›ç¨‹å†™å®Œ        <span class="token comment">/**         * å½“è°ƒç”¨ wait(NULL) æ—¶ï¼Œçˆ¶è¿›ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°ä»»æ„ä¸€ä¸ªå­è¿›ç¨‹ç»ˆæ­¢ã€‚ä¸€æ—¦å­è¿›ç¨‹ç»ˆæ­¢ï¼Œwait(NULL) å‡½æ•°ä¼šè¿”å›è¢«ç»ˆæ­¢çš„å­è¿›ç¨‹çš„è¿›ç¨‹ IDï¼ˆPIDï¼‰ï¼Œå¹¶ä¸”å¦‚æœæä¾›äº† status å‚æ•°ï¼Œ         * å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ä¼šå­˜å‚¨åœ¨ status ä¸­ã€‚        */</span>      <span class="token function">mapping</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>//å°†æ ‡å‡†è¾“å…¥æŒ‡å‘fdæ¥è¿›è¡Œè¯»å…¥      <span class="token function">primes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">exit</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>os</title>
      <link href="/2024/03/06/38/"/>
      <url>/2024/03/06/38/</url>
      
        <content type="html"><![CDATA[<h2 id="OSé¢è¯•å¸¸é—®"><a href="#OSé¢è¯•å¸¸é—®" class="headerlink" title="OSé¢è¯•å¸¸é—®"></a>OSé¢è¯•å¸¸é—®</h2><h3 id="ç¼–ç é—®é¢˜"><a href="#ç¼–ç é—®é¢˜" class="headerlink" title="ç¼–ç é—®é¢˜"></a>ç¼–ç é—®é¢˜</h3><p>ASCIIç è§„å®šäº†128ä¸ªå­—ç¬¦çš„ç¼–ç <br>Unicode æ˜¯â¼€ä¸ªå¾ˆâ¼¤çš„é›†åˆï¼Œå°†ä¸–ç•Œä¸Šæ‰€æœ‰çš„ç¬¦å·éƒ½çº³â¼Šå…¶ä¸­ï¼Œæ¯â¼€ä¸ªç¬¦å·éƒ½ç»™äºˆâ¼€ä¸ªç‹¬â¼€â½†â¼†çš„ç¼–<br>ç ã€‚å¯ä»¥å®¹çº³100å¤šä¸‡ä¸ªç¬¦å·ï¼›ä½†æ˜¯å­˜å‚¨â½…å¼ä¸ç¡®å®šï¼Œè¿˜å¯èƒ½æµªè´¹å­—èŠ‚ç©ºé—´</p><p>Unicode æ˜¯â¼€ä¸ªå¾ˆâ¼¤çš„é›†åˆï¼Œå°†ä¸–ç•Œä¸Šæ‰€æœ‰çš„ç¬¦å·éƒ½çº³â¼Šå…¶ä¸­ï¼Œæ¯â¼€ä¸ªç¬¦å·éƒ½ç»™äºˆâ¼€ä¸ªç‹¬â¼€â½†â¼†çš„ç¼–</p><p>ç ã€‚å¯ä»¥å®¹çº³100å¤šä¸‡ä¸ªç¬¦å·ï¼›ä½†æ˜¯å­˜å‚¨â½…å¼ä¸ç¡®å®šï¼Œè¿˜å¯èƒ½æµªè´¹å­—èŠ‚ç©ºé—´</p><h4 id="utf-8ä¸­ä¸­æ–‡å å‡ ä¸ªå­—èŠ‚"><a href="#utf-8ä¸­ä¸­æ–‡å å‡ ä¸ªå­—èŠ‚" class="headerlink" title="utf-8ä¸­ä¸­æ–‡å å‡ ä¸ªå­—èŠ‚"></a>utf-8ä¸­ä¸­æ–‡å å‡ ä¸ªå­—èŠ‚</h4><ol><li>å¯¹äºå•å­—èŠ‚ï¼Œå­—èŠ‚çš„ç¬¬ä¸€ä½è®¾ä¸º0ï¼Œåé¢7ä½ä½Unicodeç ï¼Œè‹±è¯­å­—æ¯ï¼ŒUTF-8ä¸ASCIIæ˜¯ä¸€æ ·çš„</li><li>å¯¹äºnå­—èŠ‚çš„ç¬¦å·ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚å‰nä½å…¨æ˜¯1ï¼Œç¬¬n+1ä½ä¸º0ï¼Œåé¢å­—èŠ‚çš„å‰ä¸¤ä½ä¸º10ï¼Œå‰©ä¸‹çš„ä¸ºUnicodeç ã€‚ä¸­æ–‡å ç”¨ä¸‰ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ã€‚</li></ol><h3 id="è¿›ç¨‹ä¸çº¿ç¨‹"><a href="#è¿›ç¨‹ä¸çº¿ç¨‹" class="headerlink" title="è¿›ç¨‹ä¸çº¿ç¨‹"></a>è¿›ç¨‹ä¸çº¿ç¨‹</h3><p>ä¸åŒè¿›ç¨‹çš„çº¿ç¨‹é—´è¦è¿›è¡Œé€šä¿¡éœ€è¦ä½¿ç”¨æ¶ˆæ¯é€šä¿¡çš„æ–¹æ³•æ¥å®ç°åŒæ­¥ã€‚</p><h4 id="çº¿ç¨‹åŒæ­¥æœºåˆ¶"><a href="#çº¿ç¨‹åŒæ­¥æœºåˆ¶" class="headerlink" title="çº¿ç¨‹åŒæ­¥æœºåˆ¶"></a>çº¿ç¨‹åŒæ­¥æœºåˆ¶</h4><ol><li>äº’æ–¥é”Mutexï¼šä¿è¯åŒæ„æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®å…±äº«èµ„æºã€‚</li><li>ä¿¡å·é‡Semaphoreï¼šä¸€ç§è®¡æ•°å™¨ï¼Œæ§åˆ¶åŒæ—¶è®¿é—®æŸä¸ªå…±äº«èµ„æºçš„çº¿ç¨‹æ•°é‡ã€‚</li><li>æ¡ä»¶å˜é‡Confition Variableï¼šä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç­‰å¾…æŸä¸ªæ¡ä»¶çš„å‘ç”Ÿï¼Œå¦ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åœ¨æ»¡è¶³æ¡ä»¶æ—¶ï¼Œé€šçŸ¥ç­‰å¾…çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚</li><li>è¯»å†™Read-Write Lockï¼šå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–å…±äº«èµ„æºï¼Œä½†åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å†™å…¥å…±äº«èµ„æºã€‚</li><li>åŸå­æ“ä½œï¼š</li><li>å±éšœBarrierï¼šè®©ä¸€ç»„ä¸‹ç§°åœ¨æŸä¸ªç‚¹ä¸Šç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰è¿›ç¨‹éƒ½åˆ°è¾¾è¿™ä¸ªç‚¹ä¹‹åå†ç»§ç»­æ‰§è¡Œã€‚</li></ol><h4 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="æ­»é”"></a>æ­»é”</h4><p>å››ä¸ªæ¡ä»¶ï¼šäº’æ–¥ã€è¯·æ±‚å’Œä¿æŒã€ä¸å‰¥å¤ºã€ç¯è·¯ç­‰å¾…<br>æ­»é”é¢„é˜²ï¼šç ´åä»»ä¸€æ¡ä»¶<br>æ­»é”é¿å…ï¼šé“¶è¡Œå®¶ç®—æ³•ã€ä¸€æ¬¡å°é”æ³•ã€é¡ºåºå°é”æ³•</p><p>ä¸€æ¬¡å°é”æ³•æ˜¯ä¸€ç§ç®€å•çš„é”å®šç­–ç•¥ï¼Œäº‹åŠ¡åœ¨å¼€å§‹æ—¶ä¸€æ¬¡æ€§è·å–æ‰€æœ‰éœ€è¦çš„é”ï¼Œå¹¶åœ¨äº‹åŠ¡ç»“æŸæ—¶ä¸€æ¬¡æ€§é‡Šæ”¾æ‰€æœ‰é”ã€‚è¿™ç§æ–¹æ³•å¯ä»¥é¿å…æ­»é”ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´é”çš„æŒæœ‰æ—¶é—´è¿‡é•¿ï¼Œä»è€Œé™ä½ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚</p><p>é¡ºåºå°é”æ³•æ˜¯ä¸€ç§æ›´å¤æ‚ä½†æ›´æœ‰æ•ˆçš„é”å®šç­–ç•¥ï¼Œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šæ‰©å±•é˜¶æ®µå’Œæ”¶ç¼©é˜¶æ®µã€‚</p><ol><li><strong>æ‰©å±•é˜¶æ®µï¼ˆGrowing Phaseï¼‰</strong>ï¼šäº‹åŠ¡å¯ä»¥è·å–é”ï¼Œä½†ä¸èƒ½é‡Šæ”¾é”ã€‚</li><li><strong>æ”¶ç¼©é˜¶æ®µï¼ˆShrinking Phaseï¼‰</strong>ï¼šäº‹åŠ¡å¯ä»¥é‡Šæ”¾é”ï¼Œä½†ä¸èƒ½è·å–æ–°çš„é”ã€‚</li></ol><p>è¿™ç§æ–¹æ³•å¯ä»¥ç¡®ä¿äº‹åŠ¡çš„å¯ä¸²è¡ŒåŒ–ï¼Œä»è€Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><h4 id="åŸå­æ“ä½œ"><a href="#åŸå­æ“ä½œ" class="headerlink" title="åŸå­æ“ä½œ"></a>åŸå­æ“ä½œ</h4><h5 id="å¦‚ä½•å®ç°"><a href="#å¦‚ä½•å®ç°" class="headerlink" title="å¦‚ä½•å®ç°"></a>å¦‚ä½•å®ç°</h5><p>åŸºäºç¼“å­˜åŠ é”å’Œæ€»çº¿åŠ é”ã€‚<br>æ€»çº¿é”æ˜¯ä½¿ç”¨å¤„ç†å™¨æä¾›çš„ä¸€ä¸ªlock#ä¿¡å·ï¼Œå½“ä¸€ä¸ªå¤„ç†å™¨åœ¨æ€»çº¿ä¸Šè¾“å‡ºè¿™ä¸ªä¿¡å·ï¼Œå…¶ä»–å¤„ç†å™¨çš„è¯·æ±‚è¢«é˜»å¡ã€‚æ€»çº¿å§cpuè´ºå†…å­˜ä¹‹é—´çš„é€šä¿¡é”ä½äº†ï¼Œå…¶ä»–å¤„ç†å™¨ä¸èƒ½æ“ä½œå…¶ä»–å†…å­˜åœ°å€çš„æ•°æ®ï¼Œæ‰€ä»¥å¼€é”€å¾ˆå¤§<br>ç¼“å­˜é”ï¼šé¢‘ç¹ä½¿ç”¨çš„å†…å­˜ä¼šåœ¨L1ã€L2ã€L3é«˜é€Ÿç¼“å­˜ä¸­ï¼Œæ‰€ä»¥åŸå­æ“ä½œåªéœ€è¦å¯¹å†…éƒ¨ç¼“å­˜ä¸­è¿›è¡Œï¼Œå…è®¸ä½¿ç”¨MESIç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶æ¥ä¿è¯åŸå­æ€§ã€‚<br>ä½†æ˜¯ä»¥ä¸‹æƒ…å†µä¸èƒ½ä½¿ç”¨ç¼“å­˜é”ï¼š</p><ol><li>æ“ä½œçš„æ•°æ®ä¸èƒ½è¢«ç¼“å­˜åœ¨å¤„ç†å™¨å†…éƒ¨æˆ–è€…æ“ä½œçš„æ•°æ®è·¨å¤šä¸ªç¼“å­˜è¡Œ</li><li>æœ‰äº›å¤„ç†å™¨ä¸æ”¯æŒç¼“å­˜é”å®š</li></ol><h4 id="é”çš„åŒºåˆ«å’Œä½¿ç”¨åœºæ™¯"><a href="#é”çš„åŒºåˆ«å’Œä½¿ç”¨åœºæ™¯" class="headerlink" title="é”çš„åŒºåˆ«å’Œä½¿ç”¨åœºæ™¯"></a>é”çš„åŒºåˆ«å’Œä½¿ç”¨åœºæ™¯</h4><h5 id="äº’æ–¥é”mutex"><a href="#äº’æ–¥é”mutex" class="headerlink" title="äº’æ–¥é”mutex"></a>äº’æ–¥é”mutex</h5><p>ç‰¹ç‚¹æ˜¯ä»»ä½•æ—¶åˆ»éƒ½åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®æŸä¸ªèµ„æºæˆ–è€…ä¸´ç•ŒåŒº<br>ä½¿ç”¨åœºæ™¯ï¼šå…±äº«èµ„æºä¸èƒ½è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹ï¼Œæ›´æ–°å…¨å±€å˜é‡ã€ä¿®æ”¹æ•°æ®åº“è®°å½•</p><h5 id="ä¿¡å·é‡-Semaphore"><a href="#ä¿¡å·é‡-Semaphore" class="headerlink" title="ä¿¡å·é‡ Semaphore"></a>ä¿¡å·é‡ Semaphore</h5><p>æ§åˆ¶ç‰¹å®šèµ„æºçš„è®¿é—®çº¿ç¨‹æ•°<br>åœºæ™¯ï¼šé™åˆ¶é“¾æ¥æ± å¤§å°ï¼Œæ§åˆ¶åŒæ—¶è®¿é—®æ–‡ä»¶çš„çº¿ç¨‹æ•°</p><h5 id="ä¸´ç•ŒåŒº-Critical-Section"><a href="#ä¸´ç•ŒåŒº-Critical-Section" class="headerlink" title="ä¸´ç•ŒåŒº Critical Section"></a>ä¸´ç•ŒåŒº Critical Section</h5><p>ä»£ç ä¸­è®¿é—®å…±äº«èµ„æºçš„éƒ¨åˆ†ï¼Œä¿è¯åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œè¿™æ®µä»£ç <br>åœºæ™¯ï¼šæ‰§è¡Œå¤šæ­¥éª¤çš„äº‹åŠ¡</p><h5 id="å¾ªç¯é”-Spinlock"><a href="#å¾ªç¯é”-Spinlock" class="headerlink" title="å¾ªç¯é” Spinlock"></a>å¾ªç¯é” Spinlock</h5><p>ä¸€ç§å¿™ç­‰å¾…é”ï¼Œåå¤æ£€æŸ¥é”çš„çŠ¶æ€ï¼Œä¸ä¼šè®©å‡ºCPUèµ„æº<br>åœºæ™¯ï¼šæ—¶é—´å¾ˆçŸ­ï¼ŒæŒæœ‰é”æ—¶é—´å¾ˆçŸ­ã€‚</p><h5 id="è¯»å†™é”"><a href="#è¯»å†™é”" class="headerlink" title="è¯»å†™é”"></a>è¯»å†™é”</h5><ol><li>è¯»è€…ä¼˜å…ˆï¼šè¯»çº¿ç¨‹å¯ä»¥ä¸€ç›´ï¼Œæ‰€æœ‰çš„è¯»çº¿ç¨‹éƒ½é‡Šæ”¾é”åï¼Œå†™çº¿ç¨‹æ‰èƒ½è·å¾—å†™é”ã€‚</li><li>å†™ç€ä¼˜å…ˆï¼šç¬¬ä¸€ä¸ªè¯»çº¿ç¨‹è·å¾—é”ä¹‹åï¼Œå½“å†™çº¿ç¨‹åˆ°è¾¾ä¼šè¢«é˜»å¡ï¼Œä½†æ˜¯é˜»å¡è¿‡ç¨‹ä¸­æ–°çš„è¯»çº¿ç¨‹è¦æ’åœ¨å†™çº¿ç¨‹ä¹‹åã€‚</li><li>å…¬å¹³ç­–ç•¥ï¼šä½¿ç”¨é˜Ÿåˆ—ï¼Œè¯»å†™æŒ‰ç…§å…ˆè¿›å…ˆå‡ºåŸåˆ™åŠ é”ã€‚</li></ol><h4 id="å†…å­˜ç®¡ç†"><a href="#å†…å­˜ç®¡ç†" class="headerlink" title="å†…å­˜ç®¡ç†"></a>å†…å­˜ç®¡ç†</h4><ol><li>æ ˆï¼šç”±æ“ä½œç³»ç»Ÿè‡ªåŠ¨åˆ†é…é‡Šæ”¾ï¼Œå­˜æ”¾å‡½æ•°çš„å‚æ•°å€¼ï¼Œå±€éƒ¨å˜é‡ç­‰ </li><li>å †ï¼šä¸€èˆ¬ç”±ç¨‹åºå‘˜åˆ†é…é‡Šæ”¾ï¼Œç¨‹åºå‘˜ä¸é‡Šæ”¾ï¼Œç¨‹åºç»“æŸæ—¶å¯èƒ½ç”±OSå›æ”¶ï¼Œåˆ†é…æ–¹å¼ç±»ä¼¼é“¾è¡¨</li></ol><h5 id="è™šæ‹Ÿå†…å­˜-Virt"><a href="#è™šæ‹Ÿå†…å­˜-Virt" class="headerlink" title="è™šæ‹Ÿå†…å­˜ Virt"></a>è™šæ‹Ÿå†…å­˜ Virt</h5><p>æŠ½è±¡å±‚ï¼Œå…è®¸æ“ä½œç³»ç»Ÿå°†ç¡¬ä»¶å†…å­˜æŠ½è±¡åŒ–ï¼Œä½¿å¾—æ¯ä¸ªç¨‹åºéƒ½è®¤ä¸ºè‡ªå·±æœ‰ä¸€ä¸ªè¿ç»­çš„ã€ç§æœ‰çš„å†…å­˜åŒºåŸŸã€‚å†…å­˜æ»¡äº†ä¹Ÿå¯ä»¥é€šè¿‡swapæ–‡ä»¶æˆ–è€…åˆ†é¡µå°†éƒ¨åˆ†æ•°æ®æš‚å­˜åˆ°ç¡¬ç›˜ä¸Šï¼Œä»è€Œä½¿å¾—ç¨‹åºå¯ä»¥è¿è¡Œåœ¨è¶…è¿‡ç‰©ç†å†…å­˜å¤§å°çš„å†…å­˜ç©ºé—´ä¸­ã€‚å¤§å° = ç¨‹åºæ­£åœ¨ä½¿ç”¨çš„ç‰©ç†å†…å­˜ + äº¤æ¢ç©ºé—´ + æœªä½¿ç”¨ä½†å·²é¢„ç•™çš„å†…å­˜ã€‚</p><h5 id="å¸¸é©»å†…å­˜RES"><a href="#å¸¸é©»å†…å­˜RES" class="headerlink" title="å¸¸é©»å†…å­˜RES"></a>å¸¸é©»å†…å­˜RES</h5><p>å®é™…è¢«åŠ è½½åˆ°ç‰©ç†å†…å­˜ä¸­çš„éƒ¨åˆ†</p><h5 id="å…±äº«å†…å­˜-SHR"><a href="#å…±äº«å†…å­˜-SHR" class="headerlink" title="å…±äº«å†…å­˜ SHR"></a>å…±äº«å†…å­˜ SHR</h5><p>å¤šä¸ªè¿›ç¨‹å…±åŒä½¿ç”¨çš„å†…å­˜éƒ¨åˆ†ï¼Œå…è®¸ä¸åŒè¿›ç¨‹è®¿é—®åŒä¸€å—ç‰©ç†åœ°å€ï¼Œä»è€ŒèŠ‚çœå†…å­˜å°å·å¹¶æé«˜æ•°æ®äº¤æ¢æ•ˆç‡ã€‚å…±äº«å†…å­˜å¸¸ç”¨äºè¿›ç¨‹é—´é€šä¿¡IPC</p><h6 id="Free-å†…å­˜"><a href="#Free-å†…å­˜" class="headerlink" title="Free å†…å­˜"></a>Free å†…å­˜</h6><p>ç³»ç»Ÿä¸­å®Œå…¨æœªä½¿ç”¨çš„å†…å­˜æ•°é‡ï¼Œæ˜¯ç³»ç»Ÿä¸­çœŸæ­£å¯ç”¨çš„ï¼Œæ²¡æœ‰è¢«å…¶ä»–è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜ã€‚</p><h6 id="Availableå†…å­˜"><a href="#Availableå†…å­˜" class="headerlink" title="Availableå†…å­˜"></a>Availableå†…å­˜</h6><p>ç³»ç»Ÿä¸­ç«‹åˆ»å¯ä»¥åˆ†é…ç»™è¿›ç¨‹çš„å†…å­˜æ•°é‡ï¼ŒåŒ…æ‹¬freeå†…å­˜å’Œä¸€éƒ¨åˆ†è¢«ç¼“å­˜çš„å†…å­˜ã€‚available = free + buff/chche</p><h5 id="Buffer"><a href="#Buffer" class="headerlink" title="Buffer"></a>Buffer</h5><p>ç¼“å†²åŒºé€‚ç”¨äºå­˜å‚¨æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®çš„å†…å­˜ã€‚è¯»å–/å†™å…¥æ–‡ä»¶æ—¶ï¼Œæ•°æ®é¦–å…ˆæš‚å­˜åœ¨Buffersä¸­ï¼Œæ¥æé«˜è¯»å–å’Œå†™å…¥çš„æ•ˆç‡ã€‚</p><h5 id="Cached"><a href="#Cached" class="headerlink" title="Cached"></a>Cached</h5><p>ç¼“å­˜ï¼šç”¨äºå­˜å‚¨å·²ç»ä»ç£ç›˜è¯»å–çš„æ–‡ä»¶çš„å‰¯æœ¬ï¼Œè¿™äº›æ–‡ä»¶å¯èƒ½æ˜¯ç³»ç»Ÿé¢‘ç¹ä½¿ç”¨çš„æ–‡ä»¶ã€‚ç”±Linuxå†…æ ¸è‡ªåŠ¨ç®¡ç†ï¼Œç”¨äºæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚ç³»ç»Ÿæœ‰è¶³å¤Ÿçš„ç©ºé—²å†…å­˜æ—¶ï¼Œä¼šå°†ä¸€äº›æ–‡ä»¶çš„å‰¯æœ¬ä¿ç•™åœ¨Cachedä¸­ã€‚</p><h5 id="å†…å­˜å›æ”¶"><a href="#å†…å­˜å›æ”¶" class="headerlink" title="å†…å­˜å›æ”¶"></a>å†…å­˜å›æ”¶</h5><p><img src="/2024/03/06/38/%E5%86%85%E5%AD%98%E5%9B%9E%E6%94%B6.png"><br>å½“å†…å­˜å¤§äºpages_highæ˜¯ï¼Œç³»ç»Ÿå†…å­˜å……è¶³ä¸ä¼šè¿›è¡Œå†…å­˜å›æ”¶<br>å½“å†…å­˜å°äºpages_lowæ—¶ï¼Œæ ‡è¯†å†…å­˜å­˜åœ¨å‹åŠ›ï¼Œä¼šè§¦å‘kswapd0ï¼Œè¿›è¡Œåå°å†…å­˜å›æ”¶ã€‚ç›´åˆ°pages_highä½ç½®<br>å½“å†…å­˜â¼©äº pages_min æ—¶ï¼Œè¡¨â½°æ­¤æ—¶â½¤â¼¾å†…å­˜è€—å°½ï¼Œä¼šè§¦å‘ç›´æ¥å†…å­˜å›æ”¶ï¼Œè¿›ç¨‹è¢«é˜»å¡</p><p>OOMâ¸ºOut of Memory å¦‚æœç›´æ¥å†…å­˜å›æ”¶ä¹‹åï¼Œç³»ç»Ÿçš„å‰©ä½™ç©ºé—²å†…å­˜è¿˜ä¸â¾œä»¥è¿›â¾å†…å­˜åˆ†é…ï¼Œåˆ™ä¼š<br>è¿›â¼€æ­¥è§¦å‘OOMæœºåˆ¶ã€‚ OOM Killer æœºåˆ¶ä¼šæ ¹æ®ç®—æ³•é€‰æ‹©å¹¶killæ‰â¼€ä¸ªå â½¤ç‰©ç†å†…å­˜è¾ƒâ¾¼çš„è¿›ç¨‹ï¼Œä»¥ä¾¿<br>é‡Šæ”¾å†…å­˜èµ„æºï¼Œå¦‚æœç‰©ç†å†…å­˜ä¾ç„¶ä¸â¾œï¼ŒOOM Killer ä¼šç»§ç»­æ€æ­»å â½¤ç‰©ç†å†…å­˜è¾ƒâ¾¼çš„è¿›ç¨‹ï¼Œç›´åˆ°é‡Šæ”¾<br>â¾œå¤Ÿçš„å†…å­˜ä½ç½®ã€‚</p><h5 id="MMUå’ŒTLB"><a href="#MMUå’ŒTLB" class="headerlink" title="MMUå’ŒTLB"></a>MMUå’ŒTLB</h5><p>MMU ï¼ˆMemory Management Unitï¼Œå†…å­˜ç®¡ç†å•å…ƒï¼‰<br>ç”¨äºåœ¨CPUå’Œå†…å­˜ä¹‹é—´å®ç°è™šæ‹Ÿå†…å­˜ç®¡ç†ã€‚å°†è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼ŒåŒæ—¶æä¾›è®¿é—®æƒé™çš„æ§åˆ¶å’Œç¼“å­˜ç®¡ç†ç­‰åŠŸèƒ½ã€‚<br>TLB æ˜¯é«˜æ‰€ç¼“å­˜ï¼Œå“Ÿå…³äºç¼“å­˜é¡µè¡¨è½¬æ¢çš„ç»“æœã€‚å­˜åœ¨TLBæ—¶ï¼Œè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢è¿‡ç¨‹å‘ç”Ÿäº†å˜åŒ–ï¼Œè™šæ‹Ÿåœ°å€é¦–å…ˆå‘å¾€TLBç¡®è®¤æ˜¯å¦å‘½ä¸­Cache</p><h5 id="Drop-Cache"><a href="#Drop-Cache" class="headerlink" title="Drop Cache"></a>Drop Cache</h5><p>â€œDrop Cacheâ€ æ˜¯ä¸€ç§æ¸…ç†ç³»ç»Ÿç¼“å­˜çš„æ–¹æ³•ã€‚ç³»ç»Ÿç¼“å­˜åŒ…æ‹¬é¡µé¢ç¼“å­˜ã€ç›®å½•é¡¹ç¼“å­˜ï¼ˆdentry cacheï¼‰å’Œinodeç¼“å­˜ã€‚<br>â€¢ dirty pagesä¸èƒ½å›æ”¶ï¼›</p><p>â€¢ å…±äº«å†…å­˜å’Œtmpfsï¼ˆä¸´æ—¶â½‚ä»¶ç³»ç»Ÿï¼ŒæŒ‡ä½äºå†…å­˜å’Œ/æˆ–äº¤æ¢åˆ†åŒºä¸­çš„â½‚ä»¶ç³»ç»Ÿï¼‰ä¸èƒ½å›æ”¶(æ³¨æ„è§‚å¯Ÿ<br>freeå‘½ä»¤æ˜¾â½°çš„sharedå€¼)ï¼›</p><h5 id="Buddyåˆ†é…å™¨-amp-Slabåˆ†é…å™¨"><a href="#Buddyåˆ†é…å™¨-amp-Slabåˆ†é…å™¨" class="headerlink" title="Buddyåˆ†é…å™¨ &amp; Slabåˆ†é…å™¨"></a>Buddyåˆ†é…å™¨ &amp; Slabåˆ†é…å™¨</h5><p>Buddyç³»ç»Ÿæ˜¯â¼€ç§â¾¼æ•ˆçš„å†…å­˜åˆ†é…æŠ€æœ¯ï¼Œå› ä¸ºå®ƒé¿å…äº†å†…å­˜ç©ºé—´çš„ç¢â½šã€‚ä¼™ä¼´ç³»ç»Ÿç¡®ä¿æ‰€æœ‰åˆ†é…çš„å—</p><p>å…·æœ‰ç›¸åŒçš„â¼¤â¼©ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥è½»æ¾åœ°ä¸å…¶ä¼™ä¼´å—åˆå¹¶åœ¨â¼€èµ·ã€‚ä¼™ä¼´ç³»ç»Ÿçš„å¦â¼€ä¸ªä¸»è¦ä¼˜ç‚¹æ˜¯å®ƒå…è®¸</p><p>å¿«é€Ÿåˆ†é…å’Œé‡Šæ”¾å†…å­˜å—ï¼Œè¿™æ˜¯å®æ—¶ç³»ç»Ÿä¸­æä¾›å¢å¼ºæ€§èƒ½çš„é‡è¦è¦æ±‚ã€‚Linuxå†…æ ¸ä¸­ä½¿â½¤ä¼™ä¼´ç³»ç»Ÿ</p><p>ï¼ˆbuddy systemï¼‰ç®—æ³•ä»¥â»šä¸ºå•ä½ç®¡ç†å†…å­˜ï¼Œè¿›â¾å†…å­˜åˆ†é…ã€‚æ—¨åœ¨å‡å°‘å¤–éƒ¨ç¢â½š</p><p>Slab ç³»ç»Ÿ æ˜¯å¦â¼€ç§â½¤äºåˆ†é…å†…æ ¸å†…å­˜çš„æŠ€æœ¯ã€‚ slabå†…å­˜åˆ†é…ç³»ç»Ÿçš„ä¸»è¦ä¼˜ç‚¹æ˜¯å®ƒæ¶ˆé™¤äº†ç”±äºå†…å­˜åˆ†é…</p><p>å’Œé‡Šæ”¾â½½äº§â½£çš„ç¢â½šã€‚æ¢å¥è¯è¯´ï¼Œslabåˆ†é…ç³»ç»Ÿæ˜¯æ“ä½œç³»ç»Ÿä¸­â½¤æ¥ç®¡ç†å†…æ ¸å†…å­˜çš„â¼€ç§å†…å­˜åˆ†é…ç­–</p><p>ç•¥ã€‚åŸºæœ¬åŸç†æ˜¯ä»ä¼™ä¼´ç³»ç»Ÿä¸­ç”³è¯·â¼€æ•´â»šå†…å­˜ï¼Œç„¶ååˆ’åˆ†æˆå¤šä¸ªâ¼¤â¼©ç›¸ç­‰çš„â¼©å—å†…å­˜è¢« slab æ‰€ç®¡ç†ã€‚</p><p>æ—¨åœ¨å‡å°‘å†…éƒ¨ç¢â½š</p><h5 id="å†…å­˜ç¢â½š-amp-å†…å­˜æ•´ç†"><a href="#å†…å­˜ç¢â½š-amp-å†…å­˜æ•´ç†" class="headerlink" title="å†…å­˜ç¢â½š &amp; å†…å­˜æ•´ç†"></a>å†…å­˜ç¢â½š &amp; å†…å­˜æ•´ç†</h5><p>å†…å­˜ç¢â½šï¼ˆMemory Fragmentationï¼‰æ˜¯æŒ‡å†…å­˜çš„ä½¿â½¤æ•ˆç‡é™ä½çš„ç°è±¡ï¼Œå®ƒåˆ†ä¸ºä¸¤ç§å½¢å¼ï¼šå†…éƒ¨ç¢â½š</p><p>ï¼ˆInternal Fragmentationï¼‰å’Œå¤–éƒ¨ç¢â½šï¼ˆExternal Fragmentationï¼‰ã€‚å†…éƒ¨ç¢â½šå‘â½£åœ¨å†…å­˜å—è¢«åˆ†é…</p><p>å‡ºå»åï¼Œå‰©ä½™çš„æœªä½¿â½¤ç©ºé—´â½†æ³•è¢«å…¶ä»–è¯·æ±‚åˆ©â½¤ã€‚å¤–éƒ¨ç¢â½šåˆ™æ˜¯æŒ‡å¤šæ¬¡å†…å­˜åˆ†é…å’Œé‡Šæ”¾åï¼Œå†…å­˜ä¸­ç•™</p><p>ä¸‹è®¸å¤šâ¼©çš„ã€ä¸è¿ç»­çš„ç©ºé—²åŒºåŸŸï¼Œè¿™äº›åŒºåŸŸå¤ªâ¼©ï¼Œâ½†æ³•æ»¡â¾œæ–°çš„å†…å­˜è¯·æ±‚ï¼Œå°½ç®¡æ€»çš„ç©ºé—²å†…å­˜é‡å¯èƒ½</p><p>â¾œå¤Ÿã€‚</p><p>Linuxå†…å­˜å¯¹ç¢â½šåŒ–çš„æ•´ç†ç®—æ³•ä¸»è¦åº”â½¤äº†å†…æ ¸çš„â»šâ¾¯è¿ç§»æœºåˆ¶ï¼Œæ˜¯â¼€ç§å°†å¯ç§»åŠ¨â»šâ¾¯è¿›â¾è¿ç§»åè…¾å‡º</p><p>è¿ç»­ç‰©ç†å†…å­˜çš„â½…æ³•ã€‚åœ¨å†…å­˜ç¢â½šæ•´ç†å¼€å§‹å‰ï¼Œä¼šåœ¨å†…å­˜åŒºçš„å¤´å’Œå°¾å„è®¾ç½®â¼€ä¸ªæŒ‡é’ˆï¼Œå¤´æŒ‡é’ˆä»å¤´å‘</p><p>å°¾æ‰«æå¯ç§»åŠ¨çš„â»šï¼Œâ½½å°¾æŒ‡é’ˆä»å°¾å‘å¤´æ‰«æç©ºé—²çš„â»šï¼Œå½“ä»–ä»¬ç›¸é‡æ—¶ç»ˆâ½Œæ•´ç†ã€‚</p><h2 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h2><blockquote><p>&nbsp;<strong>OOM</strong> OOM Killer æœºåˆ¶ä¼šæ ¹æ®ç®—æ³•é€‰æ‹©ä¸€ä¸ªå ç”¨ç‰©ç†å†…å­˜è¾ƒé«˜çš„è¿›ç¨‹ï¼Œç„¶åå°†å…¶æ€æ­»ï¼Œä»¥ä¾¿é‡Šæ”¾å†…å­˜èµ„æºï¼Œå¦‚æœç‰©ç†å†…å­˜ä¾ç„¶ä¸è¶³ï¼ŒOOM Killer ä¼šç»§ç»­æ€æ­»å ç”¨ç‰©ç†å†…å­˜è¾ƒé«˜çš„è¿›ç¨‹ï¼Œç›´åˆ°é‡Šæ”¾è¶³å¤Ÿçš„å†…å­˜ä½ç½®ã€‚<br>å¸¦å®½ï¼šåˆå«é¢‘å®½ï¼Œæ˜¯æŒ‡åœ¨å›ºå®šçš„çš„æ—¶é—´å¯ä¼ è¾“çš„èµ„æ–™æ•°é‡ï¼Œäº¦å³åœ¨ä¼ è¾“ç®¡é“ä¸­å¯ä»¥ä¼ é€’æ•°æ®çš„èƒ½åŠ›ã€‚<br>å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰<br>ä½å®½ ï¼šä½å®½å°±æ˜¯å†…å­˜æˆ–æ˜¾å­˜ä¸€æ¬¡èƒ½ä¼ è¾“çš„æ•°æ®é‡ã€‚ç®€å•åœ°è®²å°±æ˜¯ä¸€æ¬¡èƒ½ä¼ é€’çš„æ•°æ®å®½åº¦ï¼Œå°±åƒå…¬è·¯çš„è½¦é“å®½åº¦ï¼ŒåŒå‘å››è½¦é“ã€åŒå‘å…­è½¦é“ï¼Œå½“ç„¶è½¦é“è¶Šå¤šä¸€æ¬¡èƒ½é€šè¿‡çš„æ±½è½¦å°±è¶Šå¤§ï¼Œæ‰€ä»¥ä½å®½è¶Šå¤§ï¼Œä¸€æ¬¡æ€§èƒ½èˆ†çš„æ•°æ®å°±è¶Šå¤š,å¯¹æ˜¾å¡æ¥è¯´å¯¹æ€§èƒ½çš„æé«˜å¾ˆæ˜æ˜¾ã€‚<br>PSWï¼š**<em>åŒ…å«ä¸­æ–­æ˜¯å¦å¼€æ”¾ï¼Œå¤„ç†æœºæ‰§è¡Œæ€ç­‰çŠ¶æ€çš„å¯„å­˜å™¨ï¼Œå«åšå¤„ç†æœºçŠ¶æ€å­— PSW</em>**<br>PCB: è¿›ç¨‹æ§åˆ¶å—<br>TCB: çº¿ç¨‹æ§åˆ¶æ¨¡å—<br>å¯„å­˜å™¨åˆ†ç±»ï¼šCS ä»£ç æ®µå¯„å­˜å™¨ï¼Œ IP æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨,<br>PC ç¨‹åºè®¡æ•°å™¨å¯„å­˜å™¨ï¼Œ PSæè¿°CPUæ‰§è¡ŒçŠ¶æ€ï¼Œä¸»è¦åŒ…å«ç†æœºå½“å‰è¿è¡Œæ€ï¼Œå¤„ç†åŠä¼˜å…ˆçº§ï¼Œå±è”½å¤–ä¸­æ–­ç­‰çŠ¶æ€<br>shellä¸æ˜¯æ“ä½œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ç»ˆç«¯ä¸æ“ä½œç³»ç»Ÿçš„æ¥å£<br>ç¡¬ä»¶é©±åŠ¨ï¼šæ˜¯ä¸€ä¸ªè½¯ä»¶ï¼Œç”¨äºé©±åŠ¨ç¡¬ä»¶<br>ç£é“:æ¯ä¸ªç£å¤´å¯ä»¥è¯»å–ä¸€æ®µå”¤é†’åŒºåŸŸï¼Œå°±æ˜¯ç£é“<br>æŸ±é¢ï¼š æ‰€æœ‰çš„ç£é“åˆå¹¶å°±æ˜¯ä¸€ä¸ªæŸ±é¢<br>ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šç”±ä¸€ä¸ªç¨‹åºåˆ‡æ¢åˆ°å¦ä¸€ä¸ªç¨‹åº<br>I/Oè®¾å¤‡ï¼šåŒ…æ‹¬è®¾å¤‡æ§åˆ¶å™¨å’Œè®¾å¤‡æœ¬èº«ï¼Œ<br>æ–‡ä»¶ï¼šæŠ½è±¡ç£ç›˜ç©ºé—´<br>æ–‡ä»¶æè¿°ç¬¦ï¼šå¦‚æœè®¿é—®æ–‡ä»¶æƒé™è®¸å¯ï¼Œåˆ™è¿”å›ä¸€ä¸ªå°æ•´æ•°ï¼Œè‹¥ç¦æ­¢è®¿é—®ï¼Œç³»ç»Ÿå°†è¿”å›ä¸€ä¸ªé”™è¯¯ç <br>ç®¡é“ï¼šä¸€ç§éœ€æ–‡ä»¶ï¼Œå¯ä»¥é“¾æ¥ä¸¤ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹Aè¦ç»™è¿›ç¨‹B å‘é€æ•°æ®æ—¶ï¼Œè¦å…ˆæŠŠå®ƒå†™åœ¨ç®¡é“ä¸Šï¼Œç›¸å½“äºä¸€ä¸ªè¾“å‡ºæ–‡ä»¶ï¼Œä¹‹åè¿›ç¨‹Bä»ä¸Šé¢è¯»å…¥å¹¶å¤„ç†<br>PID è¿›ç¨‹è¯†åˆ«ç¬¦<br>çº¿ç¨‹åˆ‡æ¢è¦åˆ‡æ¢æ ˆï¼Œå¦åˆ™ä¼šå¼¹æ ˆé”™è¯¯<br><strong>åˆ‡æ¢æ ˆå®è´¨å°±æ˜¯åˆ‡æ¢å¯„å­˜å™¨</strong><br>åŸºæœ¬è¾“å…¥è¾“å‡ºç³»ç»Ÿ <strong>BIOS</strong>(Basic Input Output System)</p><ol><li><p>æ¯å°è®¡ç®—æœºä¸Šæœ‰ä¸€å—åŒäº²æ¿ï¼Œä¸Šé¢æœ‰ä¸€ä¸ªå«åš åŸºæœ¬è¾“å…¥è¾“å‡ºç³»ç»Ÿ <strong>BIOS</strong>(Basic Input Output System),åœ¨BIOSé‡Œé¢æœ‰åº•å±‚I/Oè½¯ä»¶</p></li><li><p>è®¾å¤‡å¯åŠ¨ï¼ŒBIOSå¯åŠ¨ï¼Œæ£€æµ‹RAM çš„æ•°é‡å’ŒåŸºæœ¬ç¡¬ä»¶çš„æ˜¯å¦å·²ç»å®‰è£…å¹¶ä¸”å“åº”ï¼Œ</p></li><li><p>ä¹‹åé€šè¿‡å‚¨å­˜åœ¨CMOSå­˜å‚¨å™¨ä¸­çš„è®¾å¤‡æ¸…å•å†³å®šå¯åŠ¨è®¾å¤‡</p></li><li><p>ä¹‹åæ“ä½œç³»ç»Ÿæ¥è¯¢é—®BIOS ï¼Œä»¥è·å¾—é…ç½®ä¿¡æ¯<br><strong>å¤šè·¯å¤ç”¨ï¼šå®ç°æ—¶é—´å’Œç©ºé—´çš„å¤ç”¨</strong></p></li></ol></blockquote><h1 id="é¢è¯•"><a href="#é¢è¯•" class="headerlink" title="é¢è¯•"></a>é¢è¯•</h1><h2 id="ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿ"></a>ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿ</h2><ul><li><p>æ“ä½œç³»ç»Ÿæ˜¯ä¸€ç§ç³»ç»Ÿè½¯ä»¶ï¼Œæ˜¯è½¯ã€ç¡¬ä»¶èµ„æºçš„æ§åˆ¶ä¸­å¿ƒï¼Œ</p></li><li><p>æ“ä½œç³»ç»Ÿæä¾›ä¸€ä¸ªèµ„æºé›†çš„æŠ½è±¡ï¼Œå¹¶ç®¡ç†è¿™äº›ç¡¬ä»¶èµ„æº</p></li><li><p><strong>ä¸»è¦ä»»åŠ¡æ˜¯éšè—ç¡¬ä»¶ï¼Œå‘ˆç°ç»™ç¨‹åºçš„æŠ½è±¡</strong></p></li><li><p>è®°å½•å“ªä¸ªç¨‹åºåœ¨ä½¿ç”¨ä»€ä¹ˆèµ„æºï¼Œå¯¹èµ„æºè¯·æ±‚è¿›è¡Œè¯„ä¼°ä»£ä»·ï¼Œå¹¶ä¸”ä¸ºä¸åŒçš„ç¨‹åºå’Œç”¨æˆ·è°ƒè§£äº’ç›¸å†²çªçš„èµ„æºå†²çª</p></li></ul><h4 id="åŠŸèƒ½-ï¼š"><a href="#åŠŸèƒ½-ï¼š" class="headerlink" title="åŠŸèƒ½ ï¼š"></a>åŠŸèƒ½ ï¼š</h4><ol><li>è¿›ç¨‹å’Œçº¿ç¨‹çš„åˆ›å»ºä»¥åŠç®¡ç†:åˆ›å»ºï¼Œæ’¤é”€ï¼Œé˜»å¡ï¼Œå”¤é†’ï¼Œé€šä¿¡</li><li>å­˜å‚¨ç®¡ç†ï¼šå†…å­˜å’Œå¤–å­˜çš„åˆ†é…ç®¡ç†</li><li>æ–‡ä»¶ç®¡ç†ï¼šè¯»å†™ï¼Œåˆ›å»ºåˆ é™¤</li><li>è®¾å¤‡ç®¡ç†ï¼šå®Œæˆè®¾å¤‡è¯·æ±‚å’Œé‡Šæ”¾ï¼Œè¿˜æœ‰å¯åŠ¨</li><li>ç½‘ç»œç®¡ç†ï¼š</li><li>å®‰å…¨ç®¡ç†ï¼šç”¨æˆ·è®¤è¯ï¼Œæ§åˆ¶è®¿é—®ï¼Œæ–‡ä»¶åŠ å¯†ç­‰</li></ol><h3 id="ã€‚ã€‚"><a href="#ã€‚ã€‚" class="headerlink" title="ã€‚ã€‚"></a>ã€‚ã€‚</h3><p>çº¿ç¨‹ï¼š<br>jvmä¸­çº¿ç¨‹å´©æºƒä¸ä¼šå¯¼è‡´è¿›ç¨‹å´©æºƒï¼ŒåŸå› æ˜¯ä»€ä¹ˆ<br><em><strong>å› ä¸ºJVMè‡ªå®šä¹‰äº†è‡ªå·±çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œæ‹¦æˆªäº†SIGSEGVä¿¡å·</strong></em></p><ul><li>ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„è½¬æ¢ï¼š<ol><li>ç³»ç»Ÿè°ƒç”¨</li><li>ä¸­æ–­</li><li>å¼‚å¸¸</li></ol></li><li>æ­»é”çš„è§£é™¤ï¼š<ol><li>ç«‹åˆ»ç»“æŸæ‰€æœ‰è¿›ç¨‹</li><li>ç»“æŸæ¶‰åŠæ­»é”çš„æ‰€æœ‰è¿›ç¨‹</li><li>é€ä¸ªæ’¤é”€æ¶‰åŠæ­»é”çš„è¿›ç¨‹</li><li>æŠ¢å èµ„æº</li></ol></li><li>å†…å­˜ç®¡ç†ï¼š<ol><li>åˆ†é…å›æ”¶</li><li>åœ°å€è½¬æ¢</li><li>æ‰©å……</li><li>æ˜ å°„</li><li>ä¼˜åŒ–</li><li>å®‰å…¨</li></ol></li><li>inodeï¼šç´¢å¼•èŠ‚ç‚¹ï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶è¢«åˆ†ä¸ºå‡ å—ï¼Œæƒé™ï¼Œæ‰€æœ‰è€…ç­‰ï¼Œæ¯ä¸ªæ–‡ä»¶æ‹¥æœ‰å”¯ä¸€çš„inodeã€‚inodeçš„æ•°é‡æ˜¯å›ºå®šçš„</li><li>PCBé€šè¿‡åˆ—è¡¨çš„æ–¹å¼ç»„ç»‡ï¼Œç›¸åŒçŠ¶æ€çš„è¿›ç¨‹é“¾æ¥åœ¨ä¸€èµ·</li><li>è¿›ç¨‹å’Œçº¿ç¨‹çš„å¯¹æ¯”ï¼š<ol><li>è¿›ç¨‹æ—¶èµ„æºåˆ†é…çš„å•ä½å’ŒCPUè°ƒåº¦çš„å•ä½</li><li>çº¿ç¨‹åªäº«æœ‰éƒ¨åˆ†èµ„æºï¼Œå¦‚å¯„å­˜å™¨å’Œæ ˆ</li><li>çº¿ç¨‹å¯ä»¥äº«å—è¿›ç¨‹çš„å…¬å…±èµ„æº</li><li>çº¿ç¨‹åˆ‡æ¢å¼€é”€å°‘ï¼š<ul><li>çº¿ç¨‹ä¸æ¶‰åŠèµ„æºç®¡ç†ä¿¡æ¯</li><li>çº¿ç¨‹é‡Šæ”¾çš„èµ„æºæ¯”è¿›ç¨‹å°‘</li><li>åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹åˆ‡æ¢æ¯”è¿›ç¨‹å¿«ï¼Œå› ä¸ºçº¿ç¨‹å…±äº«æƒ³ç”¨çš„åœ°å€ç©ºé—´ï¼Œåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­çš„æ‰€ä»¥åçº¿ç¨‹éƒ½æ„æƒ³ä¸€ä¸ªé¡µè¡¨ã€‚åˆ‡æ¢æ—¶ä¸éœ€è¦åˆ‡æ¢è¡¨ã€‚</li></ul></li></ol></li><li>TCPçº¿ç¨‹æ§åˆ¶å—</li><li>çº¿ç¨‹åˆ†ç±»ï¼š <ol><li>ç”¨æˆ·çº¿ç¨‹ï¼šåœ¨ç”¨æˆ·ç©ºé—´å®ç°çš„çº¿ç¨‹,ç”±ç”¨æˆ·æ€çš„çº¿ç¨‹åº“æ¥ç®¡ç†</li><li>å†…æ ¸çº¿ç¨‹ï¼šåœ¨å†…æ ¸ä¸­å®ç°çš„çº¿ç¨‹ï¼Œç”±å†…æ ¸ç®¡ç†</li><li>è½»é‡çº§çº¿ç¨‹ï¼šåœ¨å†…æ ¸ä¸­æ¥æ”¯æŒç”¨æˆ·çº¿ç¨‹</li></ol></li><li>è¿›ç¨‹è°ƒåº¦ï¼š<ul><li>è°ƒåº¦æ—¶æœº: å°±ç»ªæ€-&gt;è¿è¡Œæ€ï¼Œè¿è¡Œæ€-&gt;é˜»å¡æ€,è¿è¡Œæ€-&gt;ç»“æŸæ€</li><li>è°ƒåº¦ç®—æ³•ï¼š<ul><li>éæŠ¢å å¼è°ƒåº¦ç®—æ³• : è¿›ç¨‹é˜»å¡æˆ–è€…ç»“æŸæ—¶æ‰ä¼šè°ƒç”¨å¦ä¸€ä¸ªè¿›ç¨‹</li><li>æŠ¢å å¼è°ƒåº¦ç®—æ³•ï¼šå¯¹äºä¸€ä¸ªè¿›ç¨‹ï¼Œç»™äºˆä¸€æ®µæ—¶é—´å»è¿è¡Œï¼Œæ—¶é—´ç»“æŸåä»ç„¶åœ¨è¿è¡Œæ—¶ï¼Œå°†å…¶æŒ‚èµ·ï¼Œä¼šå‘ç”Ÿæ—¶é’Ÿä¸­æ–­</li></ul><ol><li>FCFS å…ˆæ¥å…ˆæœåŠ¡</li><li>SJF æœ€çŸ­ä½œä¸šä¼˜å…ˆ</li><li>é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•</li><li>æ—¶é—´ç‰‡è½®è½¬</li></ol></li></ul></li><li>è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ–¹å¼ï¼š<ol><li>pipe    linuxä¸­ | ä¼šåˆ›å»ºä¸¤ä¸ªå­è¿›ç¨‹å…±åŒä½¿ç”¨ä¸€ä¸ªpipe</li><li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šè¿›ç¨‹å‘é€æ¶ˆæ¯åå°±å¯ä»¥ç»§ç»­åšå·¥ä½œï¼Œå¦ä¸€ä¸ªè¿›ç¨‹è¯»å–åˆ°æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¿å­˜åœ¨å†…æ ¸ä¸­çš„æ¶ˆæ¯é“¾è¡¨ï¼Œç¼ºç‚¹æ˜¯ï¼šé€šä¿¡ä¸åŠæ—¶ï¼Œé™„ä»¶å¤§å°æœ‰é™åˆ¶</li><li>å…±äº«å†…å­˜:æ‹¿å‡ºä¸€å—è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå°†å…¶æ˜ å°„åˆ°ç›¸åŒçš„ç‰©ç†å†…å­˜ä¸­ï¼Œå³å¯åšåˆ°æ¶ˆé™¤æ‹·è´è¿‡ç¨‹ã€<ul><li>ç¼ºç‚¹ï¼šå¤šä¸ªè¿›ç¨‹å…±åŒä¿®æ”¹å…±äº«åœ°å€ä¼šå‡ºç°å†²çª</li><li><img src="/2024/03/06/38/%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98.png"></li></ul></li><li>ä¿¡å·é‡ï¼šP V æ“ä½œ åˆå§‹é‡ä¸º1æ—¶ï¼Œæ˜¯äº’æ–¥æ“ä½œï¼Œ ä¸º0æ—¶æ˜¯åŒæ­¥æ“ä½œ</li><li>ä¿¡å·ï¼š ä¿¡å· â‰  ä¿¡å·é‡ï¼Œç”¨äºå¤„ç†å¼‚å¸¸çŠ¶æ€ä¸‹çš„å·¥ä½œçŠ¶æ€</li><li>é”ï¼š<ul><li>å¿™ç­‰å¾…é”(è‡ªæ—‹é”)ï¼šå½“è·å–ä¸åˆ°é”æ—¶ï¼Œçº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ï¼Œä¸åšåˆ«çš„äº‹æƒ…ï¼Œç›´è‡³å¾—åˆ°é”ã€‚</li><li>äº’æ–¥é”ï¼šåŠ é”å¤±è´¥åä¼šé‡Šæ”¾cpud</li></ul></li></ol></li></ul><h3 id="DMA"><a href="#DMA" class="headerlink" title="DMA"></a>DMA</h3><ul><li>ç”¨æˆ·è¿›ç¨‹è°ƒç”¨ read æ–¹æ³•ï¼Œå‘æ“ä½œç³»ç»Ÿå‘å‡º I/O è¯·æ±‚ï¼Œè¯·æ±‚è¯»å–æ•°æ®åˆ°è‡ªå·±çš„å†…å­˜ç¼“å†²åŒºä¸­ï¼Œè¿›ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼›</li><li>æ“ä½œç³»ç»Ÿæ”¶åˆ°è¯·æ±‚åï¼Œè¿›ä¸€æ­¥å°† I/O è¯·æ±‚å‘é€ DMAï¼Œç„¶åè®© CPU æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼›</li><li>DMA è¿›ä¸€æ­¥å°† I/O è¯·æ±‚å‘é€ç»™ç£ç›˜ï¼›</li><li>ç£ç›˜æ”¶åˆ° DMA çš„ I/O è¯·æ±‚ï¼ŒæŠŠæ•°æ®ä»ç£ç›˜è¯»å–åˆ°ç£ç›˜æ§åˆ¶å™¨çš„ç¼“å†²åŒºä¸­ï¼Œå½“ç£ç›˜æ§åˆ¶å™¨çš„ç¼“å†²åŒºè¢«è¯»æ»¡åï¼Œå‘ DMA å‘èµ·ä¸­æ–­ä¿¡å·ï¼Œå‘ŠçŸ¥è‡ªå·±ç¼“å†²åŒºå·²æ»¡ï¼›</li><li><strong>DMA æ”¶åˆ°ç£ç›˜çš„ä¿¡å·ï¼Œå°†ç£ç›˜æ§åˆ¶å™¨ç¼“å†²åŒºä¸­çš„æ•°æ®æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºä¸­ï¼Œæ­¤æ—¶ä¸å ç”¨ CPUï¼ŒCPU å¯ä»¥æ‰§è¡Œå…¶ä»–ä»»åŠ¡</strong>ï¼›</li><li>å½“ DMA è¯»å–äº†è¶³å¤Ÿå¤šçš„æ•°æ®ï¼Œå°±ä¼šå‘é€ä¸­æ–­ä¿¡å·ç»™ CPUï¼›</li><li>CPU æ”¶åˆ° DMA çš„ä¿¡å·ï¼ŒçŸ¥é“æ•°æ®å·²ç»å‡†å¤‡å¥½ï¼Œäºæ˜¯å°†æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œç³»ç»Ÿè°ƒç”¨è¿”å›ï¼›</li><li>ä¸€è‡´å“ˆå¸Œç®—æ³•ä¹Ÿç”¨äº†å–æ¨¡è¿ç®—ï¼Œä½†ä¸å“ˆå¸Œç®—æ³•ä¸åŒçš„æ˜¯ï¼Œå“ˆå¸Œç®—æ³•æ˜¯å¯¹èŠ‚ç‚¹çš„æ•°é‡è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œè€Œ<strong>ä¸€è‡´å“ˆå¸Œç®—æ³•æ˜¯å¯¹ 2^32 è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œæ˜¯ä¸€ä¸ªå›ºå®šçš„å€¼</strong>ã€‚</li></ul><p>æˆ‘ä»¬å¯ä»¥æŠŠä¸€è‡´å“ˆå¸Œç®—æ³•æ˜¯å¯¹ 2^32 è¿›è¡Œå–æ¨¡è¿ç®—çš„ç»“æœå€¼ç»„ç»‡æˆä¸€ä¸ªåœ†ç¯ï¼Œå°±åƒé’Ÿè¡¨ä¸€æ ·ï¼Œé’Ÿè¡¨çš„åœ†å¯ä»¥ç†è§£æˆç”± 60 ä¸ªç‚¹ç»„æˆçš„åœ†ï¼Œè€Œæ­¤å¤„æˆ‘ä»¬æŠŠè¿™ä¸ªåœ†æƒ³è±¡æˆç”± 2^32 ä¸ªç‚¹ç»„æˆçš„åœ†ï¼Œè¿™ä¸ªåœ†ç¯è¢«ç§°ä¸º<strong>å“ˆå¸Œç¯</strong>ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://cdn.xiaolincoding.com//mysql/other/0ea3960fef48d4cbaeb4bec4345301e7.png"></p><h3 id="å†…æ ¸"><a href="#å†…æ ¸" class="headerlink" title="å†…æ ¸"></a>å†…æ ¸</h3><p>ç°ä»£æ“ä½œç³»ç»Ÿï¼Œå†…æ ¸ä¸€èˆ¬ä¼šæä¾› 4 ä¸ªåŸºæœ¬èƒ½åŠ›ï¼š</p><ul><li>ç®¡ç†è¿›ç¨‹ã€çº¿ç¨‹ï¼Œå†³å®šå“ªä¸ªè¿›ç¨‹ã€çº¿ç¨‹ä½¿ç”¨ CPUï¼Œä¹Ÿå°±æ˜¯è¿›ç¨‹è°ƒåº¦çš„èƒ½åŠ›ï¼›</li><li>ç®¡ç†å†…å­˜ï¼Œå†³å®šå†…å­˜çš„åˆ†é…å’Œå›æ”¶ï¼Œä¹Ÿå°±æ˜¯å†…å­˜ç®¡ç†çš„èƒ½åŠ›ï¼›</li><li>ç®¡ç†ç¡¬ä»¶è®¾å¤‡ï¼Œä¸ºè¿›ç¨‹ä¸ç¡¬ä»¶è®¾å¤‡ä¹‹é—´æä¾›é€šä¿¡èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯ç¡¬ä»¶é€šä¿¡èƒ½åŠ›ï¼›</li><li>æä¾›ç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚æœåº”ç”¨ç¨‹åºè¦è¿è¡Œæ›´é«˜æƒé™è¿è¡Œçš„æœåŠ¡ï¼Œé‚£ä¹ˆå°±éœ€è¦æœ‰ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒæ˜¯ç”¨æˆ·ç¨‹åºä¸æ“ä½œç³»ç»Ÿä¹‹é—´çš„æ¥å£ã€‚<br><em>å®å†…æ ¸</em> ï¼š å†…æ ¸çš„æ‰€æœ‰æ¨¡å—éƒ½åœ¨å†…æ ¸æ€<br>å¾®å†…æ ¸ï¼šå†…æ ¸åªä¿ç•™åŸºæœ¬èƒ½åŠ›ï¼Œè¿›ç¨‹è°ƒåº¦ï¼Œä¸­æ–­ç­‰ï¼Œå‰©ä¸‹çš„æ”¾åœ¨ç”¨æˆ·ç©ºé—´<br>æ··åˆå†…æ ¸ï¼Œæ˜¯å®å†…æ ¸å’Œå¾®å†…æ ¸çš„ç»“åˆä½“ï¼Œå†…æ ¸ä¸­æŠ½è±¡å‡ºäº†å¾®å†…æ ¸çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯å†…æ ¸ä¸­ä¼šæœ‰ä¸€ä¸ªå°å‹çš„å†…æ ¸ï¼Œå…¶ä»–æ¨¡å—å°±åœ¨è¿™ä¸ªåŸºç¡€ä¸Šæ­å»ºï¼Œæ•´ä¸ªå†…æ ¸æ˜¯ä¸ªå®Œæ•´çš„ç¨‹åºï¼›</li></ul><h2 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h2><h3 id="å¯„å­˜å™¨ï¼š"><a href="#å¯„å­˜å™¨ï¼š" class="headerlink" title="å¯„å­˜å™¨ï¼š"></a>å¯„å­˜å™¨ï¼š</h3><ul><li>é€šç”¨å¯„å­˜å™¨ï¼šå­˜æ”¾è¦è¿ç®—çš„æ•°æ®</li><li>ç¨‹åºå¯„å­˜å™¨ï¼š æ¥å­˜å‚¨ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤æ‰€åœ¨çš„å†…å­˜ç¬¬</li><li>æŒ‡ä»¤å¯„å­˜å™¨ï¼šå­˜æ”¾æŒ‡ä»¤æœ¬èº«</li></ul><h3 id="æ€»çº¿ï¼š"><a href="#æ€»çº¿ï¼š" class="headerlink" title="æ€»çº¿ï¼š"></a>æ€»çº¿ï¼š</h3><ul><li>åœ°å€æ€»çº¿ï¼š æŒ‡å®šCPUè¦æ“ä½œçš„å†…å­˜åœ°å€</li><li>æ•°æ®æ€»çº¿ï¼šè¯»å†™å†…å­˜çš„æ•°æ®</li><li>æ§åˆ¶æ€»çº¿ ï¼š å‘é€å’Œæ¥å—ä¿¡å·ï¼Œä¸­æ–­ï¼Œè®¾å¤‡å¤ä½ç­‰ï¼ŒCPUå“åº”ä¹Ÿéœ€è¦æ§åˆ¶æ€»çº¿</li></ul><h3 id="è°ƒåº¦"><a href="#è°ƒåº¦" class="headerlink" title="è°ƒåº¦"></a><a href="https://xiaolincoding.com/os/1_hardware/how_cpu_deal_task.html#%E5%AE%8C%E5%85%A8%E5%85%AC%E5%B9%B3%E8%B0%83%E5%BA%A6">è°ƒåº¦</a></h3><h2 id="å­˜å‚¨"><a href="#å­˜å‚¨" class="headerlink" title="å­˜å‚¨"></a>å­˜å‚¨</h2><ul><li>å¯„å­˜å™¨ï¼›</li><li>CPU Cacheï¼šä½¿ç”¨SRAM é™æ€å­˜å‚¨å™¨ï¼Œæ–­ç”µä¸¢å¤±æ•°æ®</li><li><img src="/2024/03/06/38/Cache%E5%88%86%E7%B1%BB.png"><ol><li>L1-Cacheï¼›&nbsp;L1 é«˜é€Ÿç¼“å­˜é€šå¸¸åˆ†æˆ<strong>æŒ‡ä»¤ç¼“å­˜</strong>å’Œ<strong>æ•°æ®ç¼“å­˜</strong>ã€‚é€Ÿåº¦å‡ ä¹å’Œå¯„å­˜å™¨ä¸€æ ·å¿«ã€‚æ¯ä¸ªæ ¸å¿ƒéƒ½æ‹¥æœ‰ä¸€ä¸ª</li><li>L2-Cacheï¼›æ¯”L2ç¦»CPUè¿œï¼Œå¤§å°æ›´å¤§ï¼Œæ¯ä¸€ä¸ªæ ¸å¿ƒéƒ½æœ‰</li><li>L3-Cahceï¼›å¤šæ ¸å¿ƒå…¬ç”¨</li><li>å†™å…¥ç­–ç•¥ï¼š<ul><li>å†™ç›´è¾¾ï¼ˆ_Write Through_ï¼‰</li><li>å†™å›ï¼ˆ_Write Back_ï¼‰åªæœ‰å½“Cache ä¸­çš„æ•°æ®è¢«æ›¿æ¢æ—¶ï¼Œå†™å…¥å†…å­˜</li></ul></li><li><h2 id="Cacheä¸€è‡´æ€§-ç¬¬ä¸€ç‚¹ï¼ŒæŸä¸ª-CPU-æ ¸å¿ƒé‡Œçš„-Cache-æ•°æ®æ›´æ–°æ—¶ï¼Œå¿…é¡»è¦ä¼ æ’­åˆ°å…¶ä»–æ ¸å¿ƒçš„-Cacheï¼Œè¿™ä¸ªç§°ä¸ºå†™ä¼ æ’­ï¼ˆ-Write-Propagation-ï¼‰ï¼›ä½¿ç”¨é”-ç¬¬äºŒç‚¹ï¼ŒæŸä¸ª-CPU-æ ¸å¿ƒé‡Œå¯¹æ•°æ®çš„æ“ä½œé¡ºåºï¼Œå¿…é¡»åœ¨å…¶ä»–æ ¸å¿ƒçœ‹èµ·æ¥é¡ºåºæ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¸ªç§°ä¸ºäº‹åŠ¡çš„ä¸²è¡ŒåŒ–ï¼ˆ-Transaction-Serialization-ï¼‰ã€‚-ä½¿ç”¨åŸºäºæ€»çº¿å—…æ¢çš„MESIæ¨¡å‹-ä¼ªå…±äº«ï¼š-å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™åŒä¸€ä¸ª-Cache-Line-çš„ä¸åŒå˜é‡æ—¶ï¼Œè€Œå¯¼è‡´-CPU-Cache-å¤±æ•ˆçš„ç°è±¡ç§°ä¸ºä¼ªå…±äº«ï¼ˆ-False-Sharing-ï¼‰-è§£å†³ï¼šå°½é‡é¿å…è¿™äº›æ•°æ®åˆšå¥½åœ¨åŒä¸€ä¸ªCache-Line-å°†ä»–ä»¬å˜æˆå¯¹é½çš„æƒ…å†µã€‚-åº”ç”¨å±‚é¢è§£å†³ï¼š"><a href="#Cacheä¸€è‡´æ€§-ç¬¬ä¸€ç‚¹ï¼ŒæŸä¸ª-CPU-æ ¸å¿ƒé‡Œçš„-Cache-æ•°æ®æ›´æ–°æ—¶ï¼Œå¿…é¡»è¦ä¼ æ’­åˆ°å…¶ä»–æ ¸å¿ƒçš„-Cacheï¼Œè¿™ä¸ªç§°ä¸ºå†™ä¼ æ’­ï¼ˆ-Write-Propagation-ï¼‰ï¼›ä½¿ç”¨é”-ç¬¬äºŒç‚¹ï¼ŒæŸä¸ª-CPU-æ ¸å¿ƒé‡Œå¯¹æ•°æ®çš„æ“ä½œé¡ºåºï¼Œå¿…é¡»åœ¨å…¶ä»–æ ¸å¿ƒçœ‹èµ·æ¥é¡ºåºæ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¸ªç§°ä¸ºäº‹åŠ¡çš„ä¸²è¡ŒåŒ–ï¼ˆ-Transaction-Serialization-ï¼‰ã€‚-ä½¿ç”¨åŸºäºæ€»çº¿å—…æ¢çš„MESIæ¨¡å‹-ä¼ªå…±äº«ï¼š-å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™åŒä¸€ä¸ª-Cache-Line-çš„ä¸åŒå˜é‡æ—¶ï¼Œè€Œå¯¼è‡´-CPU-Cache-å¤±æ•ˆçš„ç°è±¡ç§°ä¸ºä¼ªå…±äº«ï¼ˆ-False-Sharing-ï¼‰-è§£å†³ï¼šå°½é‡é¿å…è¿™äº›æ•°æ®åˆšå¥½åœ¨åŒä¸€ä¸ªCache-Line-å°†ä»–ä»¬å˜æˆå¯¹é½çš„æƒ…å†µã€‚-åº”ç”¨å±‚é¢è§£å†³ï¼š" class="headerlink" title="Cacheä¸€è‡´æ€§- - ç¬¬ä¸€ç‚¹ï¼ŒæŸä¸ª CPU æ ¸å¿ƒé‡Œçš„ Cache æ•°æ®æ›´æ–°æ—¶ï¼Œå¿…é¡»è¦ä¼ æ’­åˆ°å…¶ä»–æ ¸å¿ƒçš„ Cacheï¼Œè¿™ä¸ªç§°ä¸ºå†™ä¼ æ’­ï¼ˆ_Write Propagation_ï¼‰ï¼›ä½¿ç”¨é” - ç¬¬äºŒç‚¹ï¼ŒæŸä¸ª CPU æ ¸å¿ƒé‡Œå¯¹æ•°æ®çš„æ“ä½œé¡ºåºï¼Œå¿…é¡»åœ¨å…¶ä»–æ ¸å¿ƒçœ‹èµ·æ¥é¡ºåºæ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¸ªç§°ä¸ºäº‹åŠ¡çš„ä¸²è¡ŒåŒ–ï¼ˆ_Transaction Serialization_ï¼‰ã€‚ - ä½¿ç”¨åŸºäºæ€»çº¿å—…æ¢çš„MESIæ¨¡å‹ -  -  - ä¼ªå…±äº«ï¼š å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™åŒä¸€ä¸ª Cache Line çš„ä¸åŒå˜é‡æ—¶ï¼Œè€Œå¯¼è‡´ CPU Cache å¤±æ•ˆçš„ç°è±¡ç§°ä¸ºä¼ªå…±äº«ï¼ˆ_False Sharing_ï¼‰ - è§£å†³ï¼šå°½é‡é¿å…è¿™äº›æ•°æ®åˆšå¥½åœ¨åŒä¸€ä¸ªCache Line,å°†ä»–ä»¬å˜æˆå¯¹é½çš„æƒ…å†µã€‚ - åº”ç”¨å±‚é¢è§£å†³ï¼š"></a>Cacheä¸€è‡´æ€§-<br> - ç¬¬ä¸€ç‚¹ï¼ŒæŸä¸ª CPU æ ¸å¿ƒé‡Œçš„ Cache æ•°æ®æ›´æ–°æ—¶ï¼Œå¿…é¡»è¦ä¼ æ’­åˆ°å…¶ä»–æ ¸å¿ƒçš„ Cacheï¼Œè¿™ä¸ªç§°ä¸º<strong>å†™ä¼ æ’­ï¼ˆ_Write Propagation_ï¼‰</strong>ï¼›ä½¿ç”¨é”<br> - ç¬¬äºŒç‚¹ï¼ŒæŸä¸ª CPU æ ¸å¿ƒé‡Œå¯¹æ•°æ®çš„æ“ä½œé¡ºåºï¼Œå¿…é¡»åœ¨å…¶ä»–æ ¸å¿ƒçœ‹èµ·æ¥é¡ºåºæ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¸ªç§°ä¸º<strong>äº‹åŠ¡çš„ä¸²è¡ŒåŒ–ï¼ˆ_Transaction Serialization_ï¼‰</strong>ã€‚<br> - ä½¿ç”¨åŸºäºæ€»çº¿å—…æ¢çš„MESIæ¨¡å‹<br> - <img src="/2024/03/06/38/%E7%8A%B6%E6%80%81%E5%9B%BE.png"><br> - <img src="/2024/03/06/38/MESI.png"><br> - ä¼ªå…±äº«ï¼š å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™åŒä¸€ä¸ª Cache Line çš„ä¸åŒå˜é‡æ—¶ï¼Œè€Œå¯¼è‡´ CPU Cache å¤±æ•ˆçš„ç°è±¡ç§°ä¸º<strong>ä¼ªå…±äº«ï¼ˆ_False Sharing_ï¼‰</strong><br> - è§£å†³ï¼šå°½é‡é¿å…è¿™äº›æ•°æ®åˆšå¥½åœ¨åŒä¸€ä¸ªCache Line,å°†ä»–ä»¬å˜æˆå¯¹é½çš„æƒ…å†µã€‚<br> - åº”ç”¨å±‚é¢è§£å†³ï¼š<img src="/2024/03/06/38/%E5%BA%94%E7%94%A8%E5%B1%82%E9%9D%A2%E8%A7%A3%E5%86%B3.png"></h2></li></ol></li><li>å†…å­˜ï¼›DRAM ä¸æ–­åˆ·æ–°ï¼Œæ•°æ®æ‰èƒ½è¢«å­˜å‚¨èµ·æ¥ã€‚</li><li>SSD/HDD ç¡¬ç›˜ï¼š SSD:å›ºæ€ç¡¬ç›˜ï¼ŒHDDæœºæ¢°ç¡¬ç›˜</li></ul><h3 id="ä¼™ä¼´ç³»ç»Ÿï¼š"><a href="#ä¼™ä¼´ç³»ç»Ÿï¼š" class="headerlink" title="ä¼™ä¼´ç³»ç»Ÿï¼š"></a>ä¼™ä¼´ç³»ç»Ÿï¼š</h3><p>å½“å¯åˆ†é…å†…å­˜æ¯”æ‰€éœ€è¦å†…å­˜çš„äºŒå€è¿˜å¤§ï¼Œé‚£ä¹ˆå°±å°†å…¶åˆ’åˆ†ä¸ºä¸¤ä¸ªå¤§å°ä¸ºä¸€åŠä¸€åŠçš„ç©ºé—²åˆ†åŒºï¼Œé‡å¤åˆ’åˆ†ï¼Œ<strong>ç›´åˆ°æ¯”äºŒå€å°å°±åˆ†é…ç»™ä»–</strong></p><h3 id="åˆ†é¡µï¼Œåˆ†æ®µ"><a href="#åˆ†é¡µï¼Œåˆ†æ®µ" class="headerlink" title="åˆ†é¡µï¼Œåˆ†æ®µ"></a>åˆ†é¡µï¼Œåˆ†æ®µ</h3><ol><li><p><strong>åˆ†æ®µï¼ˆSegmentationï¼‰</strong>ï¼š ä¸è¿ç»­ï¼Œä¸ç­‰é•¿ï¼Œç›¸å½“äºæ˜¯ä¸€å°æ®µé€»è¾‘çš„ç¨‹åº</p><ul><li>åˆ†æ®µå°†å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²æ®µï¼ˆsegmentsï¼‰ï¼Œæ¯ä¸ªæ®µå…·æœ‰ä¸åŒçš„å¤§å°å’Œå«ä¹‰ã€‚</li><li>æ¯ä¸ªæ®µéƒ½æœ‰è‡ªå·±çš„åŸºåœ°å€å’Œé•¿åº¦ã€‚æ®µå¯ä»¥åŒ…å«ä»£ç ã€æ•°æ®ã€å †æ ˆç­‰ä¸åŒç±»å‹çš„ä¿¡æ¯ã€‚</li><li>åˆ†æ®µå…è®¸ç¨‹åºå‘˜ä»¥é€»è¾‘ä¸Šç‹¬ç«‹çš„æ–¹å¼ç¼–å†™ç¨‹åºï¼Œå¹¶ä¸”ä½¿å¾—ç¨‹åºçš„ç»“æ„æ›´æ¸…æ™°ã€‚</li><li>åˆ†æ®µçš„ç¼ºç‚¹æ˜¯ä¼šå¯¼è‡´å†…å­˜ç¢ç‰‡åŒ–ï¼Œéš¾ä»¥ç®¡ç†ã€‚</li></ul></li><li><p><strong>åˆ†é¡µï¼ˆPagingï¼‰</strong>ï¼š è¿ç»­ç­‰é•¿</p><ul><li>åˆ†é¡µå°†å†…å­˜åˆ’åˆ†ä¸ºå›ºå®šå¤§å°çš„é¡µé¢ï¼ˆpagesï¼‰ï¼Œé€šå¸¸ä¸º4KBæˆ–è€…æ›´å¤§ã€‚</li><li>æ“ä½œç³»ç»Ÿå°†è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´åˆ’åˆ†ä¸ºä¸é¡µé¢å¤§å°ç›¸åŒçš„å—ï¼Œç§°ä¸ºè™šæ‹Ÿé¡µé¢ï¼ˆvirtual pagesï¼‰ã€‚</li><li>è™šæ‹Ÿé¡µé¢å’Œç‰©ç†é¡µé¢ï¼ˆphysical pagesï¼‰ä¹‹é—´å»ºç«‹æ˜ å°„å…³ç³»ï¼Œæ“ä½œç³»ç»Ÿè´Ÿè´£ç®¡ç†è¿™äº›æ˜ å°„ã€‚</li><li>åˆ†é¡µçš„ä¼˜ç‚¹æ˜¯å¯ä»¥æ›´æœ‰æ•ˆåœ°åˆ©ç”¨å†…å­˜ç©ºé—´ï¼Œå‡å°‘å†…å­˜ç¢ç‰‡åŒ–ï¼Œå¹¶ä¸”å®ç°äº†æ›´å¥½çš„å†…å­˜ä¿æŠ¤å’Œå…±äº«ã€‚</li><li>è§£å†³äº†å¤–éƒ¨ç¢ç‰‡ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨å†…éƒ¨ç¢ç‰‡</li></ul></li></ol><ul><li>é¡µå¸§ï¼šæŠŠ**ç‰©ç†åœ°å€é—´_**åˆ’åˆ†ä¸ºå¤§å°ç›¸åŒçš„åŸºæœ¬åˆ†é…å•å…ƒ</li><li>é¡µé¢ï¼šæŠŠ<strong>é€»è¾‘åœ°å€ç©ºé—´</strong>ä¹Ÿåˆ’åˆ†ä¸ºç›¸åŒå¤§å°ï¼ŒåŸºæœ¬åˆ†é…å•å…ƒ</li><li>é¡µé¢ç½®æ¢ç®—æ³•ï¼š</li><li><strong>æœ€ä½³é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆOPTï¼ŒOptimalï¼‰</strong>ï¼šä¼˜å…ˆé€‰æ‹©æ·˜æ±°çš„é¡µé¢æ˜¯ä»¥åæ°¸ä¸ä½¿ç”¨çš„ï¼Œæˆ–è€…æ˜¯åœ¨æœ€é•¿æ—¶é—´å†…ä¸å†è¢«è®¿é—®çš„é¡µé¢ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è·å¾—æœ€ä½çš„ç¼ºé¡µç‡ã€‚ä½†ç”±äºäººä»¬ç›®å‰æ— æ³•é¢„çŸ¥è¿›ç¨‹åœ¨å†…å­˜ä¸‹çš„è‹¥å¹²é¡µé¢ä¸­å“ªä¸ªæ˜¯æœªæ¥æœ€é•¿æ—¶é—´å†…ä¸å†è¢«è®¿é—®çš„ï¼Œå› è€Œè¯¥ç®—æ³•æ— æ³•å®ç°ï¼Œåªæ˜¯ç†è®ºæœ€ä¼˜çš„é¡µé¢ç½®æ¢ç®—æ³•ï¼Œå¯ä»¥ä½œä¸ºè¡¡é‡å…¶ä»–ç½®æ¢ç®—æ³•ä¼˜åŠ£çš„æ ‡å‡†ã€‚</li><li><strong>å…ˆè¿›å…ˆå‡ºé¡µé¢ç½®æ¢ç®—æ³•ï¼ˆFIFOï¼ŒFirst In First Outï¼‰</strong> : æœ€ç®€å•çš„ä¸€ç§é¡µé¢ç½®æ¢ç®—æ³•ï¼Œæ€»æ˜¯æ·˜æ±°æœ€å…ˆè¿›å…¥å†…å­˜çš„é¡µé¢ï¼Œå³é€‰æ‹©åœ¨å†…å­˜ä¸­é©»ç•™æ—¶é—´æœ€ä¹…çš„é¡µé¢è¿›è¡Œæ·˜æ±°ã€‚è¯¥ç®—æ³•æ˜“äºå®ç°å’Œç†è§£ï¼Œä¸€èˆ¬åªéœ€è¦é€šè¿‡ä¸€ä¸ª FIFO é˜Ÿåˆ—å³å¯éœ€æ±‚ã€‚ä¸è¿‡ï¼Œå®ƒçš„æ€§èƒ½å¹¶ä¸æ˜¯å¾ˆå¥½ã€‚</li><li><strong>æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆLRU ï¼ŒLeast Recently Usedï¼‰</strong>ï¼šLRU ç®—æ³•èµ‹äºˆæ¯ä¸ªé¡µé¢ä¸€ä¸ªè®¿é—®å­—æ®µï¼Œç”¨æ¥è®°å½•ä¸€ä¸ªé¡µé¢è‡ªä¸Šæ¬¡è¢«è®¿é—®ä»¥æ¥æ‰€ç»å†çš„æ—¶é—´ Tï¼Œå½“é¡»æ·˜æ±°ä¸€ä¸ªé¡µé¢æ—¶ï¼Œé€‰æ‹©ç°æœ‰é¡µé¢ä¸­å…¶ T å€¼æœ€å¤§çš„ï¼Œå³æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢äºˆä»¥æ·˜æ±°ã€‚LRU ç®—æ³•æ˜¯æ ¹æ®å„é¡µä¹‹å‰çš„è®¿é—®æƒ…å†µæ¥å®ç°ï¼Œå› æ­¤æ˜¯æ˜“äºå®ç°çš„ã€‚OPT ç®—æ³•æ˜¯æ ¹æ®å„é¡µæœªæ¥çš„è®¿é—®æƒ…å†µæ¥å®ç°ï¼Œå› æ­¤æ˜¯ä¸å¯å®ç°çš„ã€‚</li></ul><h5 id="LRUç®—æ³•çš„å¼Šç«¯ï¼š"><a href="#LRUç®—æ³•çš„å¼Šç«¯ï¼š" class="headerlink" title="LRUç®—æ³•çš„å¼Šç«¯ï¼š"></a><em>LRUç®—æ³•çš„å¼Šç«¯ï¼š</em></h5><p>ä½¿ç”¨é“¾è¡¨ï¼šæœ€è¿‘ä½¿ç”¨çš„æ•°æ®å¦‚æœå­˜åœ¨ï¼Œå°±å°†å…¶æ”¾åœ¨å¤´éƒ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±è¯»å–æ•°æ®å¹¶æ”¾å…¥å¤´éƒ¨ï¼Œå¹¶åˆ é™¤å°¾éƒ¨æ•°æ®ã€‚<br>é¢„è¯»æœºåˆ¶ï¼šè¯»å…¥æ•°æ®æ—¶ï¼Œä¼šæŠŠç›¸é‚»çš„æ•°æ®ä¸€èµ·è¯»å…¥(ç©ºé—´å±€é™æ€§)</p><ol><li>ç¼“å­˜å¤±æ•ˆï¼šè¢«é¢„è¯»çš„æ•°æ®æ²¡æœ‰è®¿é—®ï¼Œè€Œä¸”æŠŠå°¾éƒ¨çš„æ•°æ®åˆ é™¤ï¼Œé™ä½äº†å‘½ä¸­ç‡ã€‚ è§£å†³ï¼šå®ç°ä¸¤ä¸ªé“¾è¡¨ï¼Œåˆ†åˆ«å­˜å‚¨çƒ­æ•°æ®å’Œå†·æ•°æ®ï¼Œåˆ†åˆ«è¿›è¡ŒLRUç®—æ³•ã€‚é¢„è¯»éƒ¨åˆ†æ”¾å…¥å†·æ•°æ®é“¾è¡¨ï¼Œå½“çœŸæ­£è®¿é—®æ—¶ï¼Œæ”¾å…¥çƒ­æ•°æ®é“¾è¡¨</li><li>ç¼“å­˜æ±¡æŸ“ï¼šå½“æ‰¹é‡è¯»å–æ•°æ®æ—¶ï¼Œå¤§é‡æ•°æ®è¢«æ”¾å…¥çƒ­æ•°æ®LRUé“¾è¡¨ï¼Œä¼šå¯¼è‡´ä¹‹å‰çš„çƒ­ç‚¹æ•°æ®å¤±æ•ˆã€‚è§£å†³ï¼šæé«˜è¿›å…¥æ´»è·ƒLRUé“¾è¡¨çš„é—¨æ§›</li></ol><ul><li><p><strong>æœ€å°‘ä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆLFUï¼ŒLeast Frequently Usedï¼‰</strong> : å’Œ LRU ç®—æ³•æ¯”è¾ƒåƒï¼Œä¸è¿‡è¯¥ç½®æ¢ç®—æ³•é€‰æ‹©çš„æ˜¯ä¹‹å‰ä¸€æ®µæ—¶é—´å†…ä½¿ç”¨æœ€å°‘çš„é¡µé¢ä½œä¸ºæ·˜æ±°é¡µã€‚</p></li><li><p><strong>æ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³•ï¼ˆClockï¼‰</strong>ï¼šå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§æœ€è¿‘æœªä½¿ç”¨ç®—æ³•ï¼Œå³é€å‡ºçš„é¡µé¢éƒ½æ˜¯æœ€è¿‘æ²¡æœ‰ä½¿ç”¨çš„é‚£ä¸ªã€‚</p><p><strong>å±€éƒ¨æ€§åŸç†</strong>æ˜¯æŒ‡åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ•°æ®å’ŒæŒ‡ä»¤çš„è®¿é—®å­˜åœ¨ä¸€å®šçš„ç©ºé—´å’Œæ—¶é—´ä¸Šçš„å±€éƒ¨æ€§ç‰¹ç‚¹ã€‚å…¶ä¸­ï¼Œæ—¶é—´å±€éƒ¨æ€§æ˜¯æŒ‡ä¸€ä¸ªæ•°æ®é¡¹æˆ–æŒ‡ä»¤åœ¨ä¸€æ®µæ—¶é—´å†…è¢«åå¤ä½¿ç”¨çš„ç‰¹ç‚¹ï¼Œç©ºé—´å±€éƒ¨æ€§æ˜¯æŒ‡ä¸€ä¸ªæ•°æ®é¡¹æˆ–æŒ‡ä»¤åœ¨ä¸€æ®µæ—¶é—´å†…ä¸å…¶ç›¸é‚»çš„æ•°æ®é¡¹æˆ–æŒ‡ä»¤è¢«åå¤ä½¿ç”¨çš„ç‰¹ç‚¹ã€‚</p></li></ul><h3 id="è™šæ‹Ÿå†…å­˜çš„ä½œç”¨"><a href="#è™šæ‹Ÿå†…å­˜çš„ä½œç”¨" class="headerlink" title="è™šæ‹Ÿå†…å­˜çš„ä½œç”¨"></a>è™šæ‹Ÿå†…å­˜çš„ä½œç”¨</h3><ol><li>ä½¿å¾—è¿›ç¨‹å¯¹äº‘ç¿”å†…å­˜è¶…è¿‡ç‰©ç†å†…å­˜å¤§å°ï¼Œå¯ä»¥æŠŠä¸ç»å¸¸ä½¿ç”¨çš„å†…å­˜æ¢åˆ°ç‰©ç†å†…å­˜ä¹‹å¤–</li><li>æ¯ä¸€ä¸ªè¿›ç¨‹æœ‰è‡ªå·±çš„é¡µè¡¨ï¼Œæ‰€ä»¥æ¯ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ç©ºé—´æ—¶ç›¸äº’ç‹¬ç«‹ çš„ï¼Œè§£å†³äº†å¤šè¿›ç¨‹ä¹‹é—´çš„åœ°å€å†²çª</li><li>é¡µè¡¨ä¸­è¿˜å­˜åœ¨ç€ä¸€äº›æ ‡è®°å±æ€§çš„bitï¼Œå¦‚æ§åˆ¶ä¸€ä¸ªé¡µçš„è¯»å†™æƒé™ï¼Œä¸ºæ“ä½œç³»ç»Ÿæä¾›æ›´å¥½çš„å®‰å…¨æ€§<br><em>å¦‚æœæ²¡æœ‰ç©ºé—²çš„ç‰©ç†å†…å­˜ï¼Œé‚£ä¹ˆå†…æ ¸å°±ä¼šå¼€å§‹è¿›è¡Œ<strong>å›æ”¶å†…å­˜</strong>çš„å·¥ä½œï¼Œå›æ”¶çš„æ–¹å¼ä¸»è¦æ˜¯ä¸¤ç§ï¼šç›´æ¥å†…å­˜å›æ”¶å’Œåå°å†…å­˜å›æ”¶ã€‚</em></li></ol><ul><li><strong>åå°å†…å­˜å›æ”¶</strong>ï¼ˆkswapdï¼‰ï¼šåœ¨ç‰©ç†å†…å­˜ç´§å¼ çš„æ—¶å€™ï¼Œä¼šå”¤é†’ kswapd å†…æ ¸çº¿ç¨‹æ¥å›æ”¶å†…å­˜ï¼Œè¿™ä¸ªå›æ”¶å†…å­˜çš„è¿‡ç¨‹<strong>å¼‚æ­¥</strong>çš„ï¼Œä¸ä¼šé˜»å¡è¿›ç¨‹çš„æ‰§è¡Œã€‚</li><li><strong>ç›´æ¥å†…å­˜å›æ”¶</strong>ï¼ˆdirect reclaimï¼‰ï¼šå¦‚æœåå°å¼‚æ­¥å›æ”¶è·Ÿä¸ä¸Šè¿›ç¨‹å†…å­˜ç”³è¯·çš„é€Ÿåº¦ï¼Œå°±ä¼šå¼€å§‹ç›´æ¥å›æ”¶ï¼Œè¿™ä¸ªå›æ”¶å†…å­˜çš„è¿‡ç¨‹æ˜¯<strong>åŒæ­¥</strong>çš„ï¼Œä¼šé˜»å¡è¿›ç¨‹çš„æ‰§è¡Œã€‚</li><li>OOM é€‰æ‹©ä¸€ä¸ªå ç”¨ç‰©ç†å†…å­˜é«˜çš„è¿›ç¨‹ï¼Œå°†å…¶æ€æ­»ï¼Œå¦‚æœä¸å¤Ÿï¼Œé‡å¤æ€æ­»<ol><li>æ–‡ä»¶é¡µï¼šè„é¡µå°†å…¶å†™å›ç£ç›˜ä¸­ï¼Œå†é‡Šæ”¾ï¼Œ å¹²å‡€é¡µç›´æ¥å›æ”¶å†…å­˜</li><li>åŒ¿åé¡µï¼šæ²¡æœ‰å®é™…è½½ä½“çš„æ–‡ä»¶ï¼Œå°†å…¶ä¸å¸¸è®¿é—®å†™å›ç£ç›˜</li></ol></li></ul><h2 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h2><p>è¿›ç¨‹æ§åˆ¶å— PCB Process Control Block</p><p>æè¿°äº†è¿›ç¨‹çš„æ ‡è¯†ï¼Œç©ºé—´è¿è¡ŒçŠ¶æ€ï¼Œèµ„æºä½¿ç”¨ç­‰ä¿¡æ¯</p><p>PCBæ˜¯è¿›ç¨‹å­˜åœ¨çš„å”¯ä¸€æ ‡å¿—</p><p>æ¯ä¸ªè¿›ç¨‹éƒ½åœ¨æ“ä½œç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªå¯¹åº”çš„PCB</p><p>æ“ä½œç³»ç»Ÿå»ºç«‹ä¸€ä¸ªè¡¨æ ¼ç”¨äºæè¿°è¯¥è¿›ç¨‹çš„å­˜åœ¨å’ŒçŠ¶æ€ï¼Œè¿™ä¸ªè¡¨æ ¼å°±å«åšè¿›ç¨‹æ§åˆ¶å—</p><ul><li>PCB ä½¿ç”¨é“¾è¡¨å’Œç´¢å¼•è¡¨</li><li>åŒä¸€ä¸ªçŠ¶æ€çš„è¿›ç¨‹è¿›å…¥ä¸€ä¸ªé“¾è¡¨</li><li>ç´¢å¼•è¡¨æŒ‡å‘PCB</li></ul><h4 id="PCBçš„ä½¿ç”¨"><a href="#PCBçš„ä½¿ç”¨" class="headerlink" title="PCBçš„ä½¿ç”¨"></a>PCBçš„ä½¿ç”¨</h4><p>è¿›ç¨‹åˆ›å»ºï¼šç”Ÿæˆè¯¥è¿›ç¨‹çš„PCB<br>è¿›ç¨‹ç»ˆæ­¢ï¼šå›æ”¶å®ƒçš„PCB</p><h3 id="è¿›ç¨‹çš„çŠ¶æ€ï¼š"><a href="#è¿›ç¨‹çš„çŠ¶æ€ï¼š" class="headerlink" title="è¿›ç¨‹çš„çŠ¶æ€ï¼š"></a>è¿›ç¨‹çš„çŠ¶æ€ï¼š</h3><p>åˆ›å»ºçŠ¶æ€ã€è¿è¡Œæ€ã€å°±ç»ªæ€ã€é˜»å¡æ€ã€ç»“æŸçŠ¶æ€<br><img src="/2024/03/06/38/%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2.png" alt="è¿›ç¨‹çŠ¶æ€è½¬æ¢"><br>éœ€è¦ä¸€ä¸ªæ–°çš„çŠ¶æ€ï¼Œæ¥<strong>æè¿°è¿›ç¨‹æ²¡æœ‰å ç”¨å®é™…çš„ç‰©ç†å†…å­˜ç©ºé—´çš„æƒ…å†µï¼Œè¿™ä¸ªçŠ¶æ€å°±æ˜¯æŒ‚èµ·çŠ¶æ€</strong>ã€‚</p><ul><li>é˜»å¡æŒ‚èµ·çŠ¶æ€ï¼šè¿›ç¨‹åœ¨å¤–å­˜ï¼ˆç¡¬ç›˜ï¼‰å¹¶ç­‰å¾…æŸä¸ªäº‹ä»¶çš„å‡ºç°ï¼›</li><li>å°±ç»ªæŒ‚èµ·çŠ¶æ€ï¼šè¿›ç¨‹åœ¨å¤–å­˜ï¼ˆç¡¬ç›˜ï¼‰ï¼Œä½†åªè¦è¿›å…¥å†…å­˜ï¼Œå³åˆ»ç«‹åˆ»è¿è¡Œï¼›<br><img src="/2024/03/06/38/%E6%8C%82%E8%B5%B7.png"></li></ul><h4 id="è¿›ç¨‹åˆ›å»º"><a href="#è¿›ç¨‹åˆ›å»º" class="headerlink" title="è¿›ç¨‹åˆ›å»º"></a>è¿›ç¨‹åˆ›å»º</h4><h3 id="ä¸»è¦çš„äº‹ä»¶ï¼šç³»ç»Ÿåˆå§‹åŒ–ï¼Œæ­£åœ¨è¿è¡Œçš„ç¨‹åºæ‰§è¡Œäº†åˆ›å»ºè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨æˆ·è¯·æ±‚åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªæ‰¹å¤„ç†ä½œä¸šçš„åˆå§‹åŒ–"><a href="#ä¸»è¦çš„äº‹ä»¶ï¼šç³»ç»Ÿåˆå§‹åŒ–ï¼Œæ­£åœ¨è¿è¡Œçš„ç¨‹åºæ‰§è¡Œäº†åˆ›å»ºè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨æˆ·è¯·æ±‚åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªæ‰¹å¤„ç†ä½œä¸šçš„åˆå§‹åŒ–" class="headerlink" title="ä¸»è¦çš„äº‹ä»¶ï¼šç³»ç»Ÿåˆå§‹åŒ–ï¼Œæ­£åœ¨è¿è¡Œçš„ç¨‹åºæ‰§è¡Œäº†åˆ›å»ºè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨æˆ·è¯·æ±‚åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªæ‰¹å¤„ç†ä½œä¸šçš„åˆå§‹åŒ–"></a>ä¸»è¦çš„äº‹ä»¶ï¼šç³»ç»Ÿåˆå§‹åŒ–ï¼Œæ­£åœ¨è¿è¡Œçš„ç¨‹åºæ‰§è¡Œäº†åˆ›å»ºè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨æˆ·è¯·æ±‚åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªæ‰¹å¤„ç†ä½œä¸šçš„åˆå§‹åŒ–</h3><p>è¿›ç¨‹æ‰§è¡Œ</p><p>è¿›ç¨‹ç­‰å¾…</p><p>è¿›ç¨‹æŠ¢å </p><p>è¿›ç¨‹å”¤é†’</p><p>è¿›ç¨‹ç»“æŸ</p><p>æ ¸å¿ƒçŠ¶æ€ï¼šè¿è¡ŒçŠ¶æ€ï¼Œå°±ç»ªçŠ¶æ€ï¼Œç­‰å¾…çŠ¶æ€ï¼Œåˆ›å»ºçŠ¶æ€ï¼Œç»“æŸçŠ¶æ€<br>è¿›ç¨‹æŒ‚èµ·ï¼š</p><ol><li><p>å¤„äºæŒ‚èµ·çŠ¶æ€çš„è¿›ç¨‹æ˜ å°„åœ¨ç£ç›˜ä¸Šï¼Œç›®çš„æ˜¯å‡å°‘è¿›ç¨‹å ç”¨å†…å­˜</p></li><li><p>ç­‰å¾…æŒ‚èµ·çŠ¶æ€ç­‰å¾…æŒ‚èµ·çŠ¶æ€</p></li><li><p>å°±ç»ªæŒ‚èµ·çŠ¶æ€ è¿›ç¨‹åœ¨å¤–å­˜ï¼Œä½†åªè¦è¿›å…¥å†…å­˜å³å¯è¿è¡Œ</p></li></ol><h3 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h3><p>æ¦‚å¿µï¼šçº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œæè¿°æŒ‡ä»¤æµæ‰§è¡ŒçŠ¶æ€ã€‚æ˜¯è¿›ç¨‹ä¸­æŒ‡ä»¤æ‰§è¡Œæµçš„æœ€å°å•å…ƒï¼Œæ˜¯CPU è°ƒåº¦çš„åŸºæœ¬å•ä½<br>çº¿ç¨‹ = è¿›ç¨‹ - å…±äº«èµ„æº<br>è¿›ç¨‹ = èµ„æº+å¤šç»„çº¿ç¨‹</p><ul><li>ä¼˜ç‚¹ï¼š 1. ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹2.å„ä¸ªçº¿ç¨‹ä¹‹é—´ 2.çº¿ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘ã€‚3. çº¿ç¨‹ä¹‹é—´å¯ä»¥å…±äº«åœ°å€å’Œæ–‡ä»¶èµ„æº</li><li>ç¼ºç‚¹ï¼šä¸€ä¸ªçº¿ç¨‹å´©æºƒ ä¼šå¯¼è‡´æ‰€å±çš„è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹å´©æºƒ</li></ul><h4 id="ä¸­æ–­"><a href="#ä¸­æ–­" class="headerlink" title="ä¸­æ–­"></a>ä¸­æ–­</h4><p>ä¸ºäº†é¿å…ç”±äºä¸­æ–­å¤„ç†ç¨‹åºæ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œè€Œå½±å“æ­£å¸¸è¿›ç¨‹çš„è°ƒåº¦ï¼ŒLinux å°†ä¸­æ–­å¤„ç†ç¨‹åºåˆ†ä¸ºä¸ŠåŠéƒ¨å’Œä¸‹åŠéƒ¨ï¼š</p><ul><li>ä¸ŠåŠéƒ¨ï¼Œå¯¹åº”ç¡¬ä¸­æ–­ï¼Œç”±ç¡¬ä»¶è§¦å‘ä¸­æ–­ï¼Œç”¨æ¥å¿«é€Ÿå¤„ç†ä¸­æ–­ï¼›</li><li>ä¸‹åŠéƒ¨ï¼Œå¯¹åº”è½¯ä¸­æ–­ï¼Œç”±å†…æ ¸è§¦å‘ä¸­æ–­ï¼Œç”¨æ¥å¼‚æ­¥å¤„ç†ä¸ŠåŠéƒ¨æœªå®Œæˆçš„å·¥ä½œï¼›<br>ä¼˜ç‚¹ï¼š</li></ul><ol><li>æé«˜CPUæ•ˆç‡</li><li>å®æ—¶å¤„ç†</li><li>æ•…éšœå¤„ç†</li><li>å®ç°åˆ†æ—¶æ“¦æ¬§æ€»<br>ä¸­æ–­çš„æ¥æºæ˜¯å¤–è®¾ï¼Œå¼‚å¸¸æ˜¯åº”ç”¨ç¨‹åºè¯·æ±‚çš„ï¼Œå±äºç³»ç»Ÿè°ƒç”¨</li></ol><h3 id="ç³»ç»Ÿè°ƒç”¨"><a href="#ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨"></a>ç³»ç»Ÿè°ƒç”¨</h3><p>æ¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨éƒ½éœ€è¦åˆ‡æ¢å †æ ˆï¼Œç³»ç»Ÿè°ƒç”¨æ˜¯æ“ä½œç³»ç»Ÿæä¾›ç»™ç”¨æˆ·æ€ç¨‹åºçš„æ¥å£ï¼Œç”¨äºè°ƒç”¨å†…æ ¸ã€‚<br>è‡ªé™·æŒ‡ä»¤ï¼š èƒ½å¤Ÿäº§ç”Ÿå¼‚å¸¸çš„æŒ‡ä»¤</p><h4 id="å¹¶å‘ä¸å¹¶è¡Œ"><a href="#å¹¶å‘ä¸å¹¶è¡Œ" class="headerlink" title="å¹¶å‘ä¸å¹¶è¡Œ:"></a>å¹¶å‘ä¸å¹¶è¡Œ:</h4><p>å¹¶è¡Œï¼šä¸¤ä¸ªè¿›ç¨‹ä¸€èµ·è¿›è¡Œï¼Œå•æ ¸å¤„ç†å™¨ä¸­ä¸èƒ½å¤Ÿå¹¶è¡Œï¼Œå¤šæ ¸æ‰å¯ä»¥</p><p>å¹¶å‘ï¼šå•æ ¸å¤„ç†å™¨åˆç†çš„å¤„ç†ä»»åŠ¡çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯å¤šçº¿ç¨‹ï¼Œå¹¶ä¸èƒ½åŒæ—¶è¿›è¡Œå¤šä¸ªä»»åŠ¡</p><p>è¿›ç¨‹ä¹‹é—´çš„å…³ç³»ï¼šç›¸äº’ç‹¬ç«‹å’Œç›¸äº’åˆ¶çº¦<br>åˆ¶çº¦ï¼š åŒæ­¥å’Œäº’æ–¥</p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> os </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¾®æœåŠ¡</title>
      <link href="/2024/03/05/33/"/>
      <url>/2024/03/05/33/</url>
      
        <content type="html"><![CDATA[<h2 id="Quarkus"><a href="#Quarkus" class="headerlink" title="Quarkus"></a>Quarkus</h2><ul><li>GreetingResourceTestæ˜¯åœ¨jvmä¸­æµ‹è¯•</li></ul><h2 id="é¢è¯•å¸¸é—®"><a href="#é¢è¯•å¸¸é—®" class="headerlink" title="é¢è¯•å¸¸é—®"></a>é¢è¯•å¸¸é—®</h2><p><a href="https://ticknet-studio.feishu.cn/docx/TNCGdBx2vodggwxqLcCcK3hTnpc">å¾®æœåŠ¡é¢è¯•</a></p><ul><li><p>CAPç†è®ºï¼šä»»ä½•ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿéƒ½æ— æ³•åšåˆ°ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰å’Œåˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰å…¨éƒ¨æ»¡è¶³ã€‚</p><ul><li>Cæ•°æ®ä¸€è‡´</li><li>Aè¯»å†™æ“ä½œå¿…é¡»éƒ½èƒ½æˆåŠŸ</li><li>Påˆ†åŒºå®¹é”™ï¼Œå½“åˆ†å¸ƒå¼ç³»ç»ŸèŠ‚ç‚¹ä¹‹é—´å‡ºç°ç½‘ç»œæ•…éšœå¯¼è‡´èŠ‚ç‚¹ä¹‹é—´æ— æ³•é€šä¿¡ï¼Œå¯¼è‡´å‡ºç°äº†åˆ†åŒº å¿…é¡»è¦æ»¡è¶³çš„</li></ul></li><li><p>BASEç†è®ºï¼š<img src="/2024/03/05/33/BASE.png"></p><ul><li>åŸºäºBASEç†è®ºçš„æŸ”æ€§äº‹åŠ¡ï¼Œä¸åŒäºACIDçš„åˆšæ€§äº‹åŠ¡ï¼Œé€šè¿‡ä¸€äº›æ–°çš„æ–¹æ¡ˆï¼Œåªè¦ä¿è¯æœ€ç»ˆä¸€è‡´æ€§å³å¯</li></ul></li><li><p>APï¼šæ— éœ€é”å®šæ•°æ®ï¼Œå®ç°æœ€ç»ˆä¸€è‡´å³å¯</p></li><li><p>CPï¼šå„ä¸ªå­äº‹åŠ¡æ‰§è¡Œåä¸è¦æäº¤ï¼Œé”å®šèµ„æºï¼Œä¸å…è®¸å…¶ä»–äººè®¿é—®ã€‚</p></li><li><p>SpringCloud </p></li><li><p>åˆ†å¸ƒå¼äº‹åŠ¡ï¼š</p><ul><li>æ¥å£å¹‚ç­‰æ€§ï¼šæ¥å£çš„å¹‚ç­‰æ€§æ˜¯æŒ‡ä¸€æ¬¡å’Œå¤šæ¬¡è¯·æ±‚æŸä¸€ä¸ªèµ„æºåº”è¯¥å…·æœ‰åŒæ ·çš„å‰¯ä½œç”¨ã€‚</li><li>XA/ä¸¤é˜¶æ®µæäº¤ï¼š<ul><li>ç¬¬ä¸€é˜¶æ®µï¼šå­˜åœ¨ä¸€ä¸ªè´Ÿè´£åè°ƒå„ä¸ªæœ¬åœ°èµ„æºç®¡ç†çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œäº‹åŠ¡ç®¡ç†å™¨åœ¨ç¬¬ä¸€é˜¶æ®µè¯¢é—®å„ä¸ªèµ„æºç®¡ç†å™¨æ˜¯å¦å°±ç»ªï¼Œå¦‚æœæ”¶åˆ°çš„æ²¡è¾™èµ„æºçš„å›å¤éƒ½æ˜¯yesï¼Œåœ¨åœ¨ç¬¬äºŒé˜¶æ®µæäº¤äº‹åŠ¡æ—¶ï¼Œä»»æ„ä¸€ä¸ªå›å¤noå°±å›æ»šäº‹åŠ¡</li><li>ç¬¬äºŒé˜¶æ®µï¼šäº‹åŠ¡ç®¡ç†å™¨æ ¹æ®æ‰€æœ‰æœ¬åœ°èµ„æºç®¡ç†å™¨çš„è¿”å›ï¼Œé€šçŸ¥æ‰€æœ‰æœ¬åœ°èµ„æºç®¡ç†å™¨ï¼Œæ­¥è°ƒä¸€è‡´çš„åœ¨æ‰€æœ‰åˆ†æ”¯ä¸Šæäº¤æˆ–è€…å›æ»šäº‹åŠ¡</li><li>ç¼ºç‚¹ï¼š<ul><li>åŒæ­¥é˜»å¡ï¼šå½“å‚ä¸äº‹åŠ¡è€…å­˜åœ¨å ç”¨å…¬å…±èµ„æºçš„æƒ…å†µï¼Œé½æ€»ä¸€ä¸ªå ç”¨äº†èµ„æºï¼Œå…¶ä»–å‚ä¸è€…åªèƒ½ç­‰å¾…èµ„æºé‡Šæ”¾ï¼Œå¤„äºé˜»å¡è£…å¡«ã€‚</li><li>å•ç‚¹æ•…éšœï¼šä¸€æ—¦äº‹åŠ¡ç®¡ç†å™¨æ•…éšœï¼Œæ•´ä¸ªç³»ç»Ÿéƒ½ä¸å¯ç”¨äº†</li><li>æ•°æ®ä¸ä¸€è‡´ï¼šåœ¨é˜¶æ®µäºŒå¦‚æœäº‹åŠ¡ç®¡ç†å™¨åªå‘é€äº†éƒ¨åˆ†commitæ¶ˆæ¯ï¼Œå¦‚æœå‡ºç°ç½‘ç»œå¼‚å¸¸ï¼Œé‚£ä¹ˆåªæœ‰éƒ¨åˆ†å‚ä¸è€…ä¼šæäº¤äº‹åŠ¡</li><li>ä¸ç¡®å®šæ€§ï¼šå½“åäº‹åŠ¡ç®¡ç†å™¨å‘é€ commit ä¹‹åï¼Œå¹¶ä¸”æ­¤æ—¶åªæœ‰ä¸€ä¸ªå‚ä¸è€…æ”¶åˆ°äº† commitï¼Œé‚£ä¹ˆå½“è¯¥å‚ä¸è€…ä¸äº‹åŠ¡ç®¡ç†å™¨åŒæ—¶å®•æœºä¹‹åï¼Œé‡æ–°é€‰ä¸¾çš„äº‹åŠ¡ç®¡ç†å™¨æ— æ³•ç¡®å®šè¯¥æ¡æ¶ˆæ¯æ˜¯å¦æäº¤æˆåŠŸã€‚</li></ul></li></ul></li><li>TCC Try-Confirm-Cancel <img src="/2024/03/05/33/TCC%E4%BC%98%E7%82%B9.png"><ol><li>Try é˜¶æ®µï¼šå°è¯•æ‰§è¡Œï¼Œå®Œæˆæ‰€æœ‰ä¸šåŠ¡æ£€æŸ¥ï¼ˆä¸€è‡´æ€§ï¼‰, é¢„ç•™å¿…é¡»ä¸šåŠ¡èµ„æºï¼ˆå‡†éš”ç¦»æ€§ï¼‰  </li><li>Confirm é˜¶æ®µï¼šç¡®è®¤æ‰§è¡ŒçœŸæ­£æ‰§è¡Œä¸šåŠ¡ï¼Œä¸ä½œä»»ä½•ä¸šåŠ¡æ£€æŸ¥ï¼Œåªä½¿ç”¨ Try é˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºï¼ŒConfirm æ“ä½œæ»¡è¶³å¹‚ç­‰æ€§ã€‚è¦æ±‚å…·å¤‡å¹‚ç­‰è®¾è®¡ï¼ŒConfirm å¤±è´¥åéœ€è¦è¿›è¡Œé‡è¯•ã€‚  </li><li>Cancel é˜¶æ®µï¼šå–æ¶ˆæ‰§è¡Œï¼Œé‡Šæ”¾ Try é˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æº Cancel æ“ä½œæ»¡è¶³å¹‚ç­‰æ€§ Cancel é˜¶æ®µçš„å¼‚å¸¸å’Œ Confirm é˜¶æ®µå¼‚å¸¸å¤„ç†æ–¹æ¡ˆåŸºæœ¬ä¸Šä¸€è‡´ã€‚</li></ol></li><li>æœ¬åœ°æ¶ˆæ¯è¡¨ï¼šä¾é MQå®ç°<img src="/2024/03/05/33/%E6%9C%AC%E5%9C%B0%E6%B6%88%E6%81%AF%E8%A1%A8.png"> <img src="/2024/03/05/33/%E6%B6%88%E6%81%AF%E7%9A%84%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7.png" alt="|500"></li></ul></li><li><p>è·¯ç”±ï¼š</p><ul><li>gateway<ul><li>é…ç½®<ul><li><code>id</code>ï¼šè·¯ç”±çš„å”¯ä¸€æ ‡ç¤º</li><li><code>predicates</code>ï¼šè·¯ç”±æ–­è¨€ï¼Œå…¶å®å°±æ˜¯åŒ¹é…æ¡ä»¶</li><li><code>filters</code>ï¼šè·¯ç”±è¿‡æ»¤æ¡ä»¶ï¼Œåé¢è®²</li><li><code>uri</code>ï¼šè·¯ç”±ç›®æ ‡åœ°å€ï¼Œ<code>lb://</code>ä»£è¡¨è´Ÿè½½å‡è¡¡ï¼Œä»æ³¨å†Œä¸­å¿ƒè·å–ç›®æ ‡å¾®æœåŠ¡çš„å®ä¾‹åˆ—è¡¨ï¼Œå¹¶ä¸”è´Ÿè½½å‡è¡¡é€‰æ‹©ä¸€ä¸ªè®¿é—®ã€‚</li></ul></li></ul></li></ul></li><li><p>Nacos:</p><ul><li>namespaceï¼šç”¨äºç¯å¢ƒéš”ç¦» <img src="/2024/03/05/33/namespace.png" alt="|500"></li><li>åˆ†çº§æ¨¡å‹ï¼š<img src="/2024/03/05/33/Nacos%E5%88%86%E7%BA%A7%E6%A8%A1%E5%9E%8B.png"><img src="/2024/03/05/33/Nacos%E5%88%86%E7%BA%A7%E6%A8%A1%E5%9E%8B%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86.png"><ul><li>namespace å‘½åç©ºé—´<ul><li>groupåˆ†ç»„<ul><li>æœåŠ¡service<ul><li>é›†ç¾¤cluster å¯¹åº”ä¸åŒçš„æœºæˆ¿/ip<ul><li>å®ä¾‹instanceï¼š</li></ul></li></ul></li></ul></li></ul></li></ul></li><li>NacosæŒ‚äº†èƒ½ä¸èƒ½æ­£å¸¸è®¿é—®ï¼šç­”æ¡ˆæ˜¯èƒ½ï¼ŒNacosä¼šæŠŠæ³¨å†Œçš„æœåŠ¡çš„åœ°å€æ¨é€ç»™ä»–ä»¬ï¼Œä»–ä»¬å„è‡ªç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œæ‰€ä»¥NacosæŒ‚äº†ä¹Ÿä¸å½±å“è°ƒç”¨</li><li>nacoså’Œeurekaçš„åŒºåˆ«ï¼š<ul><li>Nacosæ”¯æŒæœåŠ¡ç«¯ä¸»åŠ¨æ£€æµ‹æä¾›è€…çŠ¶æ€ï¼šä¸´æ—¶å®ä¾‹é‡‡ç”¨å¿ƒè·³æ¨¡å¼ï¼Œéä¸´æ—¶å®ä¾‹é‡‡ç”¨ä¸»åŠ¨æ£€æµ‹æ¨¡å¼</li><li>ä¸´æ—¶å®ä¾‹å¿ƒè·³ä¸æ­£å¸¸ä¼šè¢«åˆ é™¤ï¼Œéä¸´æ—¶å®ä¾‹ä¸ä¼šå‘—åˆ é™¤</li><li>Nacosæ”¯æŒæœåŠ¡åˆ—è¡¨å˜æ›´çš„æ¶ˆæ¯æ¨é€æ¨¡å¼ï¼ŒæœåŠ¡åˆ—è¡¨æ›´æ–°æ›´åŠæ—¶</li><li>Nacosé»˜è®¤ä½¿ç”¨APæ–¹å¼ï¼Œ</li></ul></li><li>nacosè¯»å–é…ç½®çš„æµç¨‹<img src="/2024/03/05/33/nacos%E8%AF%BB%E5%85%A5%E9%85%8D%E7%BD%AE%E7%9A%84%E6%B5%81%E7%A8%8B.png"></li><li>é…ç½®çƒ­æ›´æ–°ï¼š<ul><li><h2 id="åŠ¨æ€è·¯ç”±ï¼š-éœ€è¦å®ç°NacosåŠ¨æ€ç›‘å¬é…ç½®æ¥å£-å¼•å…¥é…ç½®"><a href="#åŠ¨æ€è·¯ç”±ï¼š-éœ€è¦å®ç°NacosåŠ¨æ€ç›‘å¬é…ç½®æ¥å£-å¼•å…¥é…ç½®" class="headerlink" title="åŠ¨æ€è·¯ç”±ï¼š  - éœ€è¦å®ç°NacosåŠ¨æ€ç›‘å¬é…ç½®æ¥å£  - å¼•å…¥é…ç½®"></a>åŠ¨æ€è·¯ç”±ï¼š<br>  - éœ€è¦å®ç°NacosåŠ¨æ€ç›‘å¬é…ç½®æ¥å£<br>  - å¼•å…¥é…ç½®</h2></li></ul></li></ul></li><li><p>OpenFeignï¼š</p><ul><li>æ‰§è¡Œè¿‡ç¨‹ï¼š<img src="/2024/03/05/33/OpenFeign%E6%89%A7%E8%A1%8C%E9%80%BB%E8%BE%91.png"><ol><li>è·å–è¯·æ±‚ä¸­çš„serviceId</li><li>æ ¹æ®serviceIdè´Ÿè½½å‡è¡¡ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„æœåŠ¡å®ä¾‹</li><li>åˆ©ç”¨æœåŠ¡å®ä¾‹ipå’Œportä¿¡æ¯é‡æ„url</li><li>å‘çœŸæ­£çš„urlå‘èµ·è¯·æ±‚</li></ol></li></ul></li><li><p>è´Ÿè½½å‡è¡¡ï¼š</p><ul><li>ä½¿ç”¨LoadBalancerå®ç°è´Ÿè½½å‡è¡¡</li><li>ä½¿ç”¨Ribbonç»„ä»¶å®ç°ï¼šå‘èµ·è¿œç¨‹è°ƒç”¨æ—¶ï¼Œribbonå…ˆä»æ³¨å†Œä¸­å¿ƒæ‹‰å–æœåŠ¡åœ°å€åˆ—è¡¨ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„è·¯ç”±ç­–ç•¥é€‰æ‹©ä¸€ä¸ªå‘èµ·è¿œç¨‹è°ƒç”¨ï¼Œ</li><li>Ribbonå‘è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼š å·²ç»è¢«é›†æˆåˆ°Eureka-clientå’ŒNacos-Discoveryä¸­ï¼Œåæ¥è¢«åºŸå¼ƒï¼Œä½¿ç”¨LoadBalanceräº†ï¼ŒOpenFeignä¹Ÿæ•´åˆäº†LoadBalancer<ul><li>è½®è¯¢ï¼Œæ ¹æ®æƒé‡é€‰æ‹©ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„ï¼Œ</li><li>åŒºåŸŸæ•æ„Ÿç­–ç•¥ï¼Œä»¥åŒºåŸŸå¯ç”¨çš„æœåŠ¡å™¨ä¸ºåŸºç¡€è¿›è¡ŒæœåŠ¡å™¨çš„é€‰æ‹©ã€‚ä½¿ç”¨Zoneå¯¹æœåŠ¡å™¨è¿›è¡Œåˆ†ç±»ï¼Œè¿™ä¸ªZoneå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæœºæˆ¿ã€ä¸€ä¸ªæœºæ¶ç­‰ã€‚è€Œåå†å¯¹Zoneå†…çš„å¤šä¸ªæœåŠ¡åšè½®è¯¢(é»˜è®¤)</li></ul></li></ul></li><li><p>æœåŠ¡ä¿æŠ¤</p><ul><li>Sentinelï¼š<ul><li>çº¿ç¨‹éš”ç¦»ï¼š<ol><li>çº¿ç¨‹æ± éš”ç¦»ï¼šç»™æ¯ä¸ªæœåŠ¡è°ƒç”¨ä¸šåŠ¡åˆ†é…ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œåˆ©ç”¨çº¿ç¨‹æ± æœ¬èº«è¿›è¡Œéš”ç¦»<ul><li>æ”¯æŒä¸»åŠ¨è¶…æ—¶ï¼Œæ”¯æŒå¼‚æ­¥è°ƒç”¨</li><li>ç¼ºç‚¹æ˜¯çº¿ç¨‹çš„é¢å¤–å¼€é”€è¾ƒå¤§</li><li>ä½¿ç”¨åœºæ™¯ä½æ‰‡å‡º</li></ul></li><li>ä¿¡å·é‡éš”ç¦»ï¼šä¸åˆ›å»ºçº¿ç¨‹æ± è€Œæ˜¯ä½¿ç”¨è®¡æ•°å™¨æ¨¡å¼ï¼Œè®°å½•ä¸šåŠ¡ä½¿ç”¨çš„çº¿ç¨‹æ•°é‡ï¼Œæ‰“åˆ°ä¿¡å·é‡ä¸Šé™æ—¶ï¼Œç¦æ­¢æ–°çš„è¯·æ±‚<ul><li>ä¼˜ç‚¹ï¼šè½»é‡çº§ï¼Œæ— é¢å¤–å¼€é”€</li><li>ç¼ºç‚¹ï¼šä¸æ”¯æŒä¸»åŠ¨è¶…æ—¶ï¼Œä¸æ”¯æŒå¼‚æ­¥è°ƒç”¨</li><li>é€‚åˆé«˜é¢‘è°ƒç”¨é«˜æ‰‡å‡º(ä¸€ä¸ªæœåŠ¡éœ€è¦è°ƒç”¨å…¶ä»–è®¸å¤šæœåŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è¯´è¿™ä¸ªæœåŠ¡æœ‰é«˜æ‰‡å‡º)</li></ul></li></ol></li><li>é™æµï¼š<ul><li>æ»‘åŠ¨çª—å£ç®—æ³•ï¼š</li><li>ä»¤ç‰Œæ¡¶ç®—æ³•ï¼š<ul><li>å›ºå®šé€Ÿç‡ç”Ÿæˆä»¤ç‰Œï¼Œæ¡¶æ»¡äº†å°±èˆå¼ƒï¼Œæ¯ä¸ªè¯·æ±‚å¿…é¡»å‘æ¡¶ä¸­è·å–ä»¤ç‰Œæ‰èƒ½è¢«å¤„ç†ï¼Œæ²¡æœ‰è·å¾—ä»¤ç‰Œçš„è¯·æ±‚ç­‰å¾…æˆ–è€…ä¸¢å¼ƒ</li><li>ä¸€èˆ¬æƒ…å†µä¸‹æ¯ç§’äº§ç”Ÿçš„ä»¤ç‰Œæ•°é‡å°±æ˜¯QPSä¸Šé™ï¼Œä½†æ˜¯å½“å‰è¿™ä¸€ç§’æ²¡æœ‰è¯·æ±‚è¿›å…¥ï¼Œä¸‹ä¸€åŠç§’æ¶Œå…¥äº†è¶…è¿‡2Nä¸ªè¯·æ±‚ï¼Œç„¶åè¿™ä¸€ç§’ç”Ÿæˆäº†Nä¸ªä»¤ç‰Œï¼Œæ‰€ä»¥æ”¾è¡Œäº†2Nä¸ªè¯·æ±‚ï¼Œè¶…è¿‡äº†é˜ˆå€¼ï¼Œæ‰€ä»¥è¦é¢„ç•™ä¸€å®šçš„æ³¢åŠ¨ç©ºé—´</li></ul></li><li>æ¼æ¡¶ç®—æ³•ï¼šè¯·æ±‚æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œä»¥å›ºå®šçš„é€Ÿç‡å»å–å‡ºå¹¶å¤„ç†è¯·æ±‚ã€‚</li></ul></li></ul></li><li>é™æµï¼š<ul><li>ä½¿ç”¨nginxåŸºäºæ¼æ¡¶å®ç°é™æµ</li><li>ä½¿ç”¨gateway çš„ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œæ ¹æ®ipæˆ–è€…è·¯å¾„è¿›è¡Œé™æµ</li><li>Feignæ•´åˆsentinelï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯å³å¯</li></ul></li><li>ç†”æ–­ï¼šå¯¹äºè¶…è¿‡QPSä¸Šé™çš„è¯·æ±‚æˆ–è€…å»¶è¿Ÿè¾ƒé«˜çš„è¯·æ±‚ï¼Œå¯¹å…¶è¿›è¡Œç†”æ–­ï¼ŒåŒæ—¶è®¾ç½®ä¸€ä¸ªé™çº§å¤„ç†é€»è¾‘ã€‚<ul><li><img src="/2024/03/05/33/%E6%96%AD%E8%B7%AF%E5%99%A8%E7%8A%B6%E6%80%81%E6%9C%BA.png" alt="æ–­è·¯å™¨çš„å·¥ä½œçŠ¶æ€æœº|475"><ol><li>closedå…³é—­è£…å¡«ï¼Œæ”¾è¡Œæ‰€æœ‰è¯·æ±‚ï¼Œå¹¶å¼€å§‹ç»Ÿè®¡å¼‚å¸¸æ¯”ä¾‹ã€æ»¡è¯·æ±‚æ¯”ä¾‹ï¼Œè¶…è¿‡é˜ˆå€¼åˆ‡æ¢åˆ°open</li><li>openæœåŠ¡è°ƒç”¨è¢«ç†”æ–­ï¼Œè®¿é—®è¿™ä¸ªè¢«ç†”æ–­çš„è¯·æ±‚ä¼šè¢«æ‹’ç»ï¼Œå¿«é€Ÿå¤±è´¥ï¼Œèµ°é™çº§é€»è¾‘ã€‚æŒç»­ä¸€æ®µæ—¶é—´ä¹‹åè½¬åˆ°half-open</li><li>half-open åŠå¼€æ¨¡å¼ï¼Œæ”¾è¡Œä¸€æ¬¡è¯·æ±‚ï¼Œæ ¹æ®æ‰§è¡Œç»“æœæ¥åˆ¤æ–­æ¥ä¸‹æ¥çš„æ“ä½œ<ul><li>è¯·æ±‚æˆåŠŸï¼šåˆ‡æ¢åˆ°closedçŠ¶æ€</li><li>è¯·æ±‚å¤±è´¥ï¼šåˆ‡æ¢åˆ°opençŠ¶æ€</li></ul></li></ol></li></ul></li></ul></li><li><p>åˆ†å¸ƒå¼äº‹åŠ¡ï¼š</p><ul><li>ä½¿ç”¨seataè§£å†³åˆ†å¸ƒå¼äº‹åŠ¡ï¼š<ul><li>seataæœ‰ä¸‰ä¸ªé‡è¦è§’è‰²ï¼š<img src="/2024/03/05/33/seata%E6%9E%B6%E6%9E%84.png" alt="|500"><ul><li>TC äº‹åŠ¡åè°ƒè€…ï¼šç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯å¤±ç‰©çš„çŠ¶æ€ï¼Œåè°ƒå…¨å±€äº‹åŠ¡çš„</li><li>TM äº‹åŠ¡ç®¡ç†å™¨ï¼šå®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼Œå¼€å§‹å…¨å±€äº‹åŠ¡ï¼Œæäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡</li><li>RM èµ„æºç®¡ç†å™¨ï¼šç®¡ç†åˆ†æ”¯äº‹åŠ¡ï¼Œä¸TCäº¤è°ˆä»¥æ³¨å†Œåˆ†ä¹‹åäº”å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡çš„æäº¤å’Œå›æ»š</li></ul></li><li>xaæ¨¡å¼ï¼š<ul><li>RMä¸€é˜¶æ®µå·¥ä½œï¼š<ol><li>æ³¨å†Œåˆ†æ”¯äº‹åŠ¡åˆ°TC</li><li>æ‰§è¡Œåˆ†æ”¯äº‹åŠ¡sqlä½†ä¸æäº¤</li><li>æŠ¥å‘Šæ‰§è¡ŒçŠ¶æ€åˆ°TC</li></ol></li><li>TCäºŒé˜¶æ®µå·¥ä½œï¼š<ul><li>TCæ£€æµ‹å„åˆ†æ”¯äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€<ul><li>å¦‚æœéƒ½æˆåŠŸåˆ™é€šçŸ¥æ‰€æœ‰RMæäº¤äº‹åŠ¡</li><li>å¦‚æœéƒ½å¤±è´¥åˆ™é€šçŸ¥æ‰€æœ‰RMå›æ»šäº‹åŠ¡</li></ul></li></ul></li><li>RMäºŒé˜¶æ®µå·¥ä½œï¼š<ul><li>æ¥æ”¶TCæŒ‡ä»¤ï¼Œæäº¤æˆ–å›æ»šäº‹åŠ¡</li></ul></li><li>ä¼˜ç‚¹ï¼šå¼ºä¸€è‡´æ€§ï¼Œæ²¡æœ‰ä»£ç ä¾µå…¥</li><li>ç¼ºç‚¹ï¼šä¸€é˜¶æ®µéœ€è¦é”å®šæ•°æ®åº“èµ„æºï¼Œç­‰å¾…äºŒé˜¶æ®µç»“æŸæ‰é‡Šæ”¾ï¼Œæ€§èƒ½å·®</li><li>ä¾èµ–å…³ç³»å‹æ•°æ®åº“å®ç°äº‹åŠ¡</li></ul></li><li>atæ¨¡å¼ï¼š<ol><li>é˜¶æ®µä¸€RMï¼š<img src="/2024/03/05/33/AT%E4%B8%80%E9%98%B6%E6%AE%B5.png" alt="|525"><ul><li>æ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œ</li><li>è®°å½•undo-log å¿«ç…§æ•°æ®</li><li>æ‰§è¡Œä¸šåŠ¡sqlå¹¶æäº¤</li><li>æŠ¥å‘Šäº‹åŠ¡çŠ¶æ€</li></ul></li></ol><ul><li>äºŒé˜¶æ®µ<img src="/2024/03/05/33/AT%E4%BA%8C%E9%98%B6%E6%AE%B5.png" alt="|500"><ol><li>é˜¶æ®µè€Œæäº¤æ—¶RMå·¥ä½œï¼šåˆ é™¤undo-log</li><li>å›æ»šæ—¶ï¼ŒRMå·¥ä½œï¼šæ ¹æ®undo-logæ¢å¤æ•°æ®åˆ°æ›´æ–°å‰</li></ol></li></ul></li><li>ä¸¤è€…åŒºåˆ«ï¼š<ul><li>XAä¸€é˜¶æ®µä¸æäº¤äº‹åŠ¡ï¼Œé”å®šèµ„æºï¼ŒATä¸€é˜¶æ®µæäº¤äº‹åŠ¡ï¼Œä¸é”å®šèµ„æº</li><li>XAæ¨¡å¼ä¼Šåˆ©æ•°æ®åº“å®ç°å›æ»šï¼ŒATæ¨¡å¼åˆ©ç”¨æ•°æ®å¿«ç…§å®ç°æ•°æ®å›æ»š</li><li>XAæ¨¡å¼å¼ºä¸€è‡´æ€§ï¼ŒATæ¨¡å¼æœ€ç»ˆä¸€è‡´</li></ul></li><li>TCCæ¨¡å¼ï¼šTCCæ¨¡å¼ä¸ATæ¨¡å¼éå¸¸ç›¸ä¼¼ï¼Œæ¯é˜¶æ®µéƒ½æ˜¯ç‹¬ç«‹äº‹åŠ¡ï¼Œä¸åŒçš„æ˜¯TCCé€šè¿‡äººå·¥ç¼–ç æ¥å®ç°æ•°æ®æ¢å¤ã€‚éœ€è¦å®ç°ä¸‰ä¸ªæ–¹æ³•ï¼š<img src="/2024/03/05/33/TCC%E6%A8%A1%E5%BC%8F.png"><ul><li><code>try</code>ï¼šèµ„æºçš„æ£€æµ‹å’Œé¢„ç•™ï¼›</li><li><code>confirm</code>ï¼šå®Œæˆèµ„æºæ“ä½œä¸šåŠ¡ï¼›è¦æ±‚ <code>try</code> æˆåŠŸ <code>confirm</code> ä¸€å®šè¦èƒ½æˆåŠŸã€‚</li><li><code>cancel</code>ï¼šé¢„ç•™èµ„æºé‡Šæ”¾ï¼Œå¯ä»¥ç†è§£ä¸ºtryçš„åå‘æ“ä½œã€‚</li><li>ä¼˜ç‚¹ï¼šä¸€é˜¶æ®µå®Œæˆç›´æ¥æäº¤äº‹åŠ¡ï¼Œé‡Šæ”¾èµ„æºï¼Œæ— éœ€å¿«ç…§ï¼Œæ— éœ€ä¾èµ–æ•°æ®åº“äº‹åŠ¡ï¼Œå¯ç”¨äºå…³ç³»å‹æ•°æ®åº“</li><li>ç¼ºç‚¹ï¼šä»£ç ä¾µå…¥ä¸¥é‡ï¼Œè½¯çŠ¶æ€ï¼Œäº‹åŠ¡æœ€ç»ˆä¸€è‡´</li></ul></li></ul></li></ul></li><li><p>æ¥å£å¹‚ç­‰æ€§ï¼š</p><ul><li>ä½¿ç”¨token+rediså®ç°æ¥å£å¹‚ç­‰æ€§ï¼Œç¬¬äºŒæ¬¡è¯·æ±‚ä¹‹åæ¯æ¬¡è¯·æ±‚éƒ½ä¼šæºå¸¦ä¹‹å‰çš„tokenï¼Œåå°å…ˆå¯¹redisè¿›è¡ŒéªŒè¯ï¼Œå¦‚æœå­˜åœ¨tokenåˆ™æ‰§è¡Œä¸šåŠ¡ï¼ŒåŒæ—¶åˆ é™¤tokenï¼Œå¦‚æœä¸å­˜å†åˆ™ç›´æ¥è¿”å›ï¼Œä¿è¯äº†å¹‚ç­‰æ€§ï¼Œä¿è¯äº†åŒä¸€ä¸ªtokenåªå¤„ç†ä¸€æ¬¡ä¸šåŠ¡</li></ul></li><li><h2 id="MQï¼š-ç»„æˆ-produceræ¶ˆæ¯çš„ç”Ÿäº§è€…-broker-æ¶ˆæ¯çš„ä¿å­˜-consumer-æ¶ˆæ¯çš„æ¶ˆè´¹è€…-é€‰æ‹©ï¼š"><a href="#MQï¼š-ç»„æˆ-produceræ¶ˆæ¯çš„ç”Ÿäº§è€…-broker-æ¶ˆæ¯çš„ä¿å­˜-consumer-æ¶ˆæ¯çš„æ¶ˆè´¹è€…-é€‰æ‹©ï¼š" class="headerlink" title="MQï¼š  - ç»„æˆ      - produceræ¶ˆæ¯çš„ç”Ÿäº§è€…      - broker æ¶ˆæ¯çš„ä¿å­˜      - consumer æ¶ˆæ¯çš„æ¶ˆè´¹è€…  - é€‰æ‹©ï¼š"></a>MQï¼š<br>  - ç»„æˆ<br>      - produceræ¶ˆæ¯çš„ç”Ÿäº§è€…<br>      - broker æ¶ˆæ¯çš„ä¿å­˜<br>      - consumer æ¶ˆæ¯çš„æ¶ˆè´¹è€…<br>  - é€‰æ‹©ï¼š<img src="/2024/03/05/33/MQ%E7%9A%84%E9%80%89%E6%8B%A9.png"></h2></li></ul><h3 id="Kafkaé¢è¯•é¢˜"><a href="#Kafkaé¢è¯•é¢˜" class="headerlink" title="Kafkaé¢è¯•é¢˜"></a>Kafkaé¢è¯•é¢˜</h3><ul><li>å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼š<ol><li>produceræ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æ­¥å›è°ƒå‘é€ï¼Œå¦‚æœæ¶ˆæ¯å‘é€å¤±è´¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å›è°ƒè·å–å¤±è´¥åçš„æ¶ˆæ¯ä¿¡æ¯ï¼Œå¯ä»¥é‡è¯•æˆ–è€…è®°å½•æ—¥å¿—ï¼Œä¹Ÿå¯ä»¥åç»­è¿›è¡Œä¸æˆ</li><li>brokerä¸­æ¶ˆæ¯ä¸¢å¤±ï¼Œé€šè¿‡kafkaçš„å¤åˆ¶æœºåˆ¶æ¥ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œåœ¨ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªacksçš„å‚æ•°ä½allï¼Œè¿™æ ·å°±ä¼šåœ¨brokerçš„leaderå’Œfolleråˆ†åŒºéƒ½ä¿å­˜ç¡®è®¤ï¼Œåªæœ‰æ‰€æœ‰çš„å‰¯æœ¬éƒ½ç¡®è®¤ä¹‹åæ‰ç®—æ˜¯æˆåŠŸè¿‡å‘é€äº†æ¶ˆæ¯</li></ol></li><li>consumeræ—¶ä½¿ç”¨pullï¼Œè¿˜æ˜¯pushï¼š<ul><li>Kafkaä½¿ç”¨äº†pullæ¨¡å¼ï¼Œconsumerå¯ä»¥è‡ªä¸»å†³å®šæ˜¯å¦æ‰¹é‡ä»brokeræ‹‰å–æ•°æ®ã€‚pushä¸ºäº†é¿å…consumerå´©æºƒè€Œé‡‡ç”¨è¾ƒä½çš„æ¨é€é€Ÿç‡ï¼Œåˆ°ä¸€æ¬¡åªæ¨é€è¾ƒå°‘çš„æ¶ˆæ¯é€ æˆæµªè´¹ï¼Œpullæ¨¡å¼ä¸‹ï¼Œconsumerå¯ä»¥æ ¹æ®è‡ªå·±çš„æ¶ˆè´¹èƒ½åŠ›è€Œå»å†³å®šå¦‚ä½•æ‹‰å–æ¶ˆæ¯</li><li>ç¼ºç‚¹ï¼šå¦‚æœbrokeræ²¡æœ‰æä¾›å¯æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œå°†å¯¼è‡´consumerä¸æ–­å¾ªç¯ä¸­è½®è¯¢ï¼Œç›´åˆ°æœ€æ–°æ¶ˆæ¯åˆ°è¾¾ã€‚</li><li>Kafkaå¯ä»¥æœ‰ä¸ªå‚æ•°å¯ä»¥è®©consumeré˜»å¡çŸ¥é“æ–°æ¶ˆæ¯çš„åˆ°è¾¾ï¼Œæˆ–è€…é˜»å¡ç›´åˆ°æ¶ˆæ¯çš„æ•°é‡åˆ°è¾¾æŸä¸ªç‰¹å®šçš„é‡å°±å¯ä»¥æ‰¹é‡å‘é€ã€‚</li></ul></li><li>Kafkaå°†Topicåˆ†æˆäº†è‹¥å¹²åˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºåŒä¸€æ—¶é—´åªèƒ½è¢«æœ‰ä¸€ä¸ªconsumeræ¶ˆè´¹ï¼Œæ„å‘³ç€æ¯ä¸ªåˆ†åŒºè¢«æ¶ˆè´¹çš„æ¶ˆæ¯åœ¨æ—¥å¿—ä¸­çš„ä½ç½®ä»…ä»…æ˜¯æœ‰ä¸€ä¸ªç®€å•çš„æ•´æ•°ï¼šoffset ï¼Œconsumerå¯ä»¥æŠŠoffsetè°ƒæˆä¸€ä¸ªè¾ƒè€çš„å€¼ï¼Œä»è€Œé‡æ–°æ¶ˆè´¹è€æ¶ˆæ¯</li><li>ä¸»ä»å¤åˆ¶ï¼šä¸€ä¸ªtopicå¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬<ul><li>ä¸»èŠ‚ç‚¹å°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ—¥å¿—ï¼Œä»èŠ‚ç‚¹ä»ä¸»èŠ‚ç‚¹æ‹‰å–ä¿¡æ¯ï¼Œå†™å…¥æœ¬åœ°æ—¥å¿—ï¼Œä¹‹åå‘ä¸»èŠ‚ç‚¹å‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœä¸»èŠ‚ç‚¹æ”¶åˆ°æ‰€æœ‰ä»èŠ‚ç‚¹çš„ç¡®è®¤æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯å°±ä¼šè¢«è®¤ä¸ºæ˜¯å·²æäº¤çš„ï¼Œä¸»èŠ‚ç‚¹ä¼šæ›´æ–°è‡ªå·±çš„é«˜æ°´ä½ï¼Œæ¶ˆè´¹è€…åªèƒ½æ¶ˆè´¹å·²æäº¤çš„æ¶ˆæ¯</li><li>ä¼˜ç‚¹ï¼šä¿è¯äº†ä¸»èŠ‚ç‚¹å´©æºƒæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢å¤±</li></ul></li><li>è„‘è£‚é—®é¢˜ï¼š<ul><li>åªæœ‰é¢†å¯¼è€…è´Ÿè´£å¤„ç†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„è¯»å†™è¯·æ±‚ï¼Œè¿½éšè€…åªèƒ½ä»é¢†å¯¼è€…é‚£é‡Œå¤åˆ¶æ•°æ®</li><li>Kafkaçš„é€‰ä¸¾æ˜¯ç”±ZooKeeperåè°ƒçš„ï¼ŒZooKeeperå¯ä»¥ä¿è¯åœ¨ä»»ä½•æ—¶å€™åªæœ‰ä¸€ä¸ªé¢†å¯¼è€…è¢«é€‰ä¸¾å‡ºæ¥</li><li>Zookeeperæ˜¯å¦‚ä½•åšåˆ°çš„ï¼Ÿ<ul><li>å½“Zookeeperå¯åŠ¨æˆ–è€…é¢†å¯¼è€…å´©æºƒæ—¶ï¼Œæ‰€æœ‰çš„ZookeeperèŠ‚ç‚¹éƒ½ä¼šè¿›å…¥é€‰ä¸¾çŠ¶æ€</li><li>æŠ•ç¥¨é˜¶æ®µï¼šæ¯ä¸ªèŠ‚ç‚¹ä¼šå°†è‡ªå·±ä½œä¸ºé¢†å¯¼è€…åç«¯ï¼Œç„¶åå‘é€æŠ•ç¥¨ä¿¡æ¯ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹æ”¶åˆ°å…¶ä»–èŠ‚ç‚¹çš„æŠ•ç¥¨ä¿¡æ¯æ˜¯ï¼Œå¦‚æœZXIDæ›´å¤§ï¼Œä¹Ÿå°±æ˜¯æ”¶åˆ°çš„æ¶ˆæ¯æ›´ï¼Œä¼šæ›´æ–°è‡ªå·±çš„æŠ•ç¥¨ä¿¡æ¯ï¼Œå¹¶å°†æ–°çš„æŠ•ç¥¨ä¿¡æ¯å‘é€ç»™å…¶ä»–èŠ‚ç‚¹</li><li>ç¡®å®šé˜¶æ®µï¼šå½“ä¸€ä¸ªèŠ‚ç‚¹æ”¶åˆ°è¶…è¿‡åŠæ•°èŠ‚ç‚¹çš„ç›¸åŒæŠ•ç¥¨ä¿¡æ¯ä¸­ï¼Œä»–å°±è®¤ä¸ºé€‰ä¸¾ç»“æŸï¼Œé€‰ä¸¾å‡ºçš„é¢†å¯¼è€…å°±æ˜¯æŠ•ç¥¨ä¿¡æ¯ä¸­çš„å€™é€‰èŠ‚ç‚¹ï¼Œç„¶åå°†ç»“æœå‘é€ç»™å…¶ä»–èŠ‚ç‚¹ã€‚</li></ul></li></ul></li><li>æ¶ˆæ¯é‡å¤æ¶ˆè´¹å¦‚ä½•è§£å†³<ul><li>kafkaéƒ½æ˜¯æŒ‰ç…§offsetè¿›è¡Œæ ‡è®°æ¶ˆè´¹çš„ï¼Œæ¶ˆè´¹è€…é»˜è®¤æ˜¯è‡ªåŠ¨æŒ‰æœŸæäº¤å·²ç»æ¶ˆè´¹çš„åç§»é‡ï¼Œå¦‚æœå‡ºç°é‡å¤æ¶ˆè´¹çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç¦ç”¨è‡ªåŠ¨æäº¤offsetï¼Œæ”¹ä¸ºæ‰‹åŠ¨æäº¤ï¼Œæ¶ˆè´¹æˆåŠŸåæŠ¥å‘Šç»™brokerï¼Œä¸ºäº†ç»´æŠ¤æ¶ˆæ¯çš„å¹‚ç­‰æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å”¯ä¸€ä¸»é”®è¿›è¡ŒåŒºåˆ†ï¼Œæˆ–è€…æ˜¯æ·é”ï¼Œæ•°æ®åº“çš„é”æˆ–è€…æ˜¯Redisçš„åˆ†å¸ƒå¼é”éƒ½èƒ½è§£å†³å¹‚ç­‰é—®é¢˜ã€‚</li></ul></li><li>å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼š<ol><li>å°†æ¶ˆæ¯éƒ½å­˜å‚¨åœ¨åŒä¸€ä¸ªåˆ†åŒºä¸‹</li><li>å‘é€æ¶ˆæ¯æ—¶æŒ‰ç…§ç›¸åŒçš„ä¸šåŠ¡è®¾ç½®ç›¸åŒçš„keyï¼Œé»˜è®¤çš„åˆ†åŒºæ˜¯é€šè¿‡keyçš„hashcodeå€¼æ¥é€‰æ‹©åˆ†åŒºçš„ï¼Œå¦‚æœhashå€¼ä¸€æ ·ï¼Œåˆ†åŒºä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</li></ol></li><li>é«˜å¯ç”¨ï¼š<ul><li>é›†ç¾¤ï¼šå¤šä¸ªbrokerï¼Œå³ä½¿ä¸€å°å®•æœºï¼Œå…¶ä»–å¯ä»¥ç»§ç»­æœåŠ¡<ul><li>brokerå¦‚ä½•å®ç°æ¶ˆæ¯åŒæ­¥ï¼Ÿ<ul><li>ä¸»ä»åŒæ­¥ï¼ŒLeader Brokeræ¥å—æ¶ˆæ¯åï¼Œå°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ—¥å¿—ï¼ŒFolloweræ‹‰å–æ¶ˆæ¯ï¼Œå†™å…¥æœ¬åœ°æ—¥å¿—ï¼Œå½“æ‰€æ¬²çš„ISR(åŒæ­¥å¤åˆ¶ä¿å­˜çš„follower)éƒ½å®Œæˆï¼ŒLeaderå°±ä¼šå‘ç”Ÿäº§è€…å‘é€ç¡®è®¤æ¶ˆæ¯ã€‚</li></ul></li><li>é€šè¿‡è¿‡ç¨‹ä¸­Leaderå®•æœºäº†ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ<ul><li>Kafkaå›ä»ISRåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªæ–°çš„Leaderï¼ŒISRåˆ—è¡¨ä¸­çš„éƒ½æ˜¯å·²ç»åŒæ­¥æœ€æ–°æ•°æ®çš„å‰¯æœ¬ï¼Œå½“FolloweråŒæ­¥å®Œæˆåï¼Œä¼šé‡æ–°åŠ å…¥åˆ°ISRåˆ—è¡¨ä¸­ã€‚</li></ul></li></ul></li><li>æ•°æ®æ¸…æ´—ï¼š<ul><li>æ—¥å¿—æ¸…æ´—ï¼š<ul><li>æ ¹æ®æ¶ˆæ¯ä¿ç•™æ—¶é—´ï¼Œè¶…è¿‡æŒ‡å®šæ—¶é—´è§¦å‘æ¸…æ´—ï¼Œé»˜è®¤æ˜¯168å°æ—¶</li><li>æ ¹æ®topicå­˜å‚¨çš„æ•°æ®å¤§å°ï¼Œå¤§äºä¸€å®šæ³•åˆ¶ï¼Œå¼€å§‹åˆ é™¤æœ€ä¹…çš„æ¶ˆæ¯ï¼Œé»˜è®¤å…³é—­ã€‚</li></ul></li></ul></li><li>é«˜æ€§èƒ½è®¾è®¡ï¼š<ul><li>æ¶ˆæ¯åˆ†åŒºï¼šä¸å—å•å°æœåŠ¡å™¨é™åˆ¶ï¼Œå¤„ç†æ›´å¤šæ•°æ®</li><li>é¡ºåºè¯»å†™ï¼šé¡ºåºè¯»å†™ï¼Œæé«˜è¯»å†™æ•ˆç‡</li><li>é¡µç¼“å­˜ï¼šç£ç›˜ä¸­çš„æ•°æ®ç¼“å­˜åˆ°å†…å­˜ï¼ŒæŠŠç£ç›˜çš„è®¿é—®å˜ä¸ºå¯¹å†…å­˜çš„è®¿é—®</li><li>é›¶æ‹·è´ï¼šå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢åŠæ•°æ®æ‹·è´</li><li>æ¶ˆæ¯å‹ç¼©ï¼šå‡å°‘ç£ç›˜IOå’Œç½‘ç»œIO</li><li>åˆ†æ‰¹å‘é€ï¼šåˆ†æ‰¹å‘é€ï¼Œå°†æ¶ˆæ¯æ‰“åŒ…æ‰¹é‡å‘é€ï¼Œå‡å°‘ç½‘ç»œå¼€é”€</li></ul></li></ul></li></ul><h2 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h2><h3 id="æ³¨å†Œä¸­å¿ƒ"><a href="#æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="æ³¨å†Œä¸­å¿ƒ"></a>æ³¨å†Œä¸­å¿ƒ</h3><ol><li>æ–¹ä¾¿æ›´æ”¹å¾®æœåŠ¡çš„ipå’Œ ç«¯å£å·</li><li>å¦‚æœå­˜åœ¨å¤šä¸ªæœåŠ¡ï¼Œå¯ä»¥é…ç½®è´Ÿè½½å‡è¡¡</li><li>æ–¹ä¾¿ç»´æŠ¤<br>æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼šå®ç°å¾®æœåŠ¡ä¹‹é—´çš„åŠ¨æ€æ³¨å†Œä¸å‘ç°<br><img src="/2024/03/05/33/%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E7%9A%84%E4%BD%9C%E7%94%A8.png"></li></ol><h3 id="consul"><a href="#consul" class="headerlink" title="consul"></a>consul</h3><p>åŠŸèƒ½ï¼š</p><ol><li>æœåŠ¡å‘ç° æ”¯æŒ httpå’Œdns</li><li>å¥åº·ç›‘æµ‹</li><li>KVå­˜å‚¨ é…ç½®</li><li>å¤šæ•°æ®ä¸­å¿ƒ</li><li>å¯è§†åŒ–Webç•Œé¢<br>åœ¨mainæ–¹æ³•ä¸Šä½¿ç”¨ @EnableDiscoveryClient<br>controller å±‚ä¸Š<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">PaymentSrv_URL</span> <span class="token operator">=</span> <span class="token string">"http://cloud-payment-service"</span><span class="token punctuation">;</span><span class="token comment">//æœåŠ¡æ³¨å†Œä¸­å¿ƒä¸Šçš„å¾®æœåŠ¡åç§°</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-cssx" data-language="cssx"><code class="language-cssx">consul agent -dev è¿›å…¥å¼€å‘è€…æ¨¡å¼ localhost:8500<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--SpringCloud consul discovery --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-consul-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-css" data-language="css"><code class="language-css">  <span class="token selector">####Spring Cloud Consul for Service Discoveryspring:    cloud: # æœåŠ¡æ³¨å†Œ      consul: # consulæ³¨å†Œä¸­å¿ƒ        host: localhost # consulåœ°å€        port: 8500 # consulç«¯å£        discovery: # æœåŠ¡å‘ç°          service-name: $</span><span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span> # æœåŠ¡åç§°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>RestTemplateæä¾›äº†å¤šç§ä¾¿æ·è®¿é—®è¿œç¨‹HttpæœåŠ¡çš„æ–¹æ³•ï¼Œ</li></ol><p>&nbsp;</p><p>æ˜¯ä¸€ç§ç®€å•ä¾¿æ·çš„è®¿é—®restfulæœåŠ¡æ¨¡æ¿ç±»ï¼Œæ˜¯Springæä¾›çš„ç”¨äºè®¿é—®RestæœåŠ¡çš„å®¢æˆ·ç«¯æ¨¡æ¿å·¥å…·é›†</p><blockquote><p>applicaiton.ymlæ˜¯ç”¨æˆ·çº§çš„èµ„æºé…ç½®é¡¹</p></blockquote><p>bootstrap.ymlæ˜¯ç³»ç»Ÿçº§çš„ï¼Œä¼˜å…ˆçº§æ›´åŠ é«˜</p><p>Spring Cloudä¼šåˆ›å»ºä¸€ä¸ªâ€œBootstrap Contextâ€ï¼Œä½œä¸ºSpringåº”ç”¨çš„<code>Application Context</code>çš„çˆ¶ä¸Šä¸‹æ–‡ã€‚åˆå§‹åŒ–çš„æ—¶å€™ï¼Œ<code>Bootstrap Context</code>è´Ÿè´£ä»å¤–éƒ¨æºåŠ è½½é…ç½®å±æ€§å¹¶è§£æé…ç½®ã€‚è¿™ä¸¤ä¸ªä¸Šä¸‹æ–‡å…±äº«ä¸€ä¸ªä»å¤–éƒ¨è·å–çš„<code>Environment</code>ã€‚</p><p><code>Bootstrap</code>å±æ€§æœ‰é«˜ä¼˜å…ˆçº§ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä¸ä¼šè¢«æœ¬åœ°é…ç½®è¦†ç›–ã€‚ <code>Bootstrap context</code>å’Œ<code>Application Context</code>æœ‰ç€ä¸åŒçš„çº¦å®šï¼Œæ‰€ä»¥æ–°å¢äº†ä¸€ä¸ª<code>bootstrap.yml</code>æ–‡ä»¶ï¼Œä¿è¯<code>Bootstrap Context</code>å’Œ<code>Application Context</code>é…ç½®çš„åˆ†ç¦»ã€‚</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">spring:  application:    name: cloud-payment-service    ####Spring Cloud Consul for Service Discovery  cloud:    consul:      host: localhost      port: 8500      discovery:        service-name: $</span><span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>      <span class="token property">config</span><span class="token punctuation">:</span>        <span class="token property">profile-separator</span><span class="token punctuation">:</span> <span class="token string">'-'</span> # default value is <span class="token string">","</span>ï¼Œwe update <span class="token string">'-'</span>        <span class="token property">format</span><span class="token punctuation">:</span> YAML# config/cloud-payment-service/data#       /cloud-payment-service-dev/data#       /cloud-payment-service-prod/data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>&nbsp;application.ymlæ–‡ä»¶æ”¹ä¸ºbootstrap.yml,è¿™æ˜¯å¾ˆå…³é”®çš„æˆ–è€…ä¸¤è€…å…±å­˜<br>å› ä¸ºbootstrap.ymlæ˜¯æ¯”application.ymlå…ˆåŠ è½½çš„ã€‚bootstrap.ymlä¼˜å…ˆçº§é«˜äºapplication.yml </p><ul><li>consul kvå†™æ³•</li><li>config/é…ç½®æ–‡ä»¶/data  é‡Œé¢å†™é…ç½®</li><li>åŠ¨æ€åˆ·æ–°ï¼šåœ¨mainä¸Šå†™ : @RefreshScope<br>é—®é¢˜: é‡å¯consulä¹‹åï¼Œé…ç½®ä¸¢å¤±ï¼Œå¦‚ä½•æŒä¹…åŒ–é…ç½®ï¼Ÿ</li></ul><h3 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h3><ul><li>å®¢æˆ·ç«¯è´Ÿè½½å’ŒæœåŠ¡å™¨è´Ÿè½½<br>loadbalanceræœ¬åœ°è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯ VS NginxæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡åŒºåˆ«</li></ul><p>Nginxæ˜¯æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼Œå®¢æˆ·ç«¯æ‰€æœ‰è¯·æ±‚éƒ½ä¼šäº¤ç»™nginxï¼Œç„¶åç”±nginxå®ç°è½¬å‘è¯·æ±‚ï¼Œå³è´Ÿè½½å‡è¡¡æ˜¯ç”±æœåŠ¡ç«¯å®ç°çš„ã€‚</p><p>loadbalanceræœ¬åœ°è´Ÿè½½å‡è¡¡ï¼Œåœ¨è°ƒç”¨å¾®æœåŠ¡æ¥å£æ—¶å€™ï¼Œä¼šåœ¨æ³¨å†Œä¸­å¿ƒä¸Šè·å–æ³¨å†Œä¿¡æ¯æœåŠ¡åˆ—è¡¨ä¹‹åç¼“å­˜åˆ°JVMæœ¬åœ°ï¼Œä»è€Œåœ¨æœ¬åœ°å®ç°RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æŠ€æœ¯ã€‚</p><ul><li>LoadBalancer åœ¨å·¥ä½œæ—¶åˆ†æˆä¸¤æ­¥ï¼š</li></ul><p><strong>ç¬¬ä¸€æ­¥</strong>ï¼Œå…ˆé€‰æ‹©ConsulServerä»æœåŠ¡ç«¯æŸ¥è¯¢å¹¶æ‹‰å–æœåŠ¡åˆ—è¡¨ï¼ŒçŸ¥é“äº†å®ƒæœ‰å¤šä¸ªæœåŠ¡(ä¸Šå›¾3ä¸ªæœåŠ¡)ï¼Œè¿™3ä¸ªå®ç°æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œ</p><p>é»˜è®¤è½®è¯¢è°ƒç”¨è°éƒ½å¯ä»¥æ­£å¸¸æ‰§è¡Œã€‚ç±»ä¼¼ç”Ÿæ´»ä¸­æ±‚åŒ»æŒ‚å·ï¼ŒæŸä¸ªç§‘å®¤ä»Šæ—¥å‡ºè¯Šçš„å…¨éƒ¨åŒ»ç”Ÿï¼Œå®¢æˆ·ç«¯ä½ è‡ªå·±é€‰ä¸€ä¸ªã€‚</p><p><strong>ç¬¬äºŒæ­¥</strong>ï¼ŒæŒ‰ç…§æŒ‡å®šçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ä»serverå–åˆ°çš„æœåŠ¡æ³¨å†Œåˆ—è¡¨ä¸­ç”±å®¢æˆ·ç«¯è‡ªå·±é€‰æ‹©ä¸€ä¸ªåœ°å€ï¼Œæ‰€ä»¥LoadBalanceræ˜¯ä¸€ä¸ª<strong>å®¢æˆ·ç«¯çš„</strong>è´Ÿè½½å‡è¡¡å™¨ã€‚</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--loadbalancer--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-loadbalancer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è®¿é—®æ—¶å³å¯åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸­åˆ‡æ¢<br>å‡è¡¡ç®—æ³•é»˜è®¤ä¸ºè½®è¯¢ï¼š<br>å¯ä»¥åˆ‡æ¢ä¸ºéšæœºç®—æ³•ï¼š<br>ä¿®æ”¹RestTemplateConfig:</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@LoadBalancerClient</span><span class="token punctuation">(</span>        <span class="token comment">//ä¸‹é¢çš„valueå€¼å¤§å°å†™ä¸€å®šè¦å’Œconsulé‡Œé¢çš„åå­—ä¸€æ ·ï¼Œå¿…é¡»ä¸€æ ·</span>        value <span class="token operator">=</span> <span class="token string">"cloud-payment-service"</span><span class="token punctuation">,</span>configuration <span class="token operator">=</span> <span class="token class-name">RestTemplateConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestTemplateConfig</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token annotation punctuation">@LoadBalanced</span> <span class="token comment">//ä½¿ç”¨@LoadBalancedæ³¨è§£èµ‹äºˆRestTemplateè´Ÿè½½å‡è¡¡çš„èƒ½åŠ›</span>    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token class-name">ReactorLoadBalancer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceInstance</span><span class="token punctuation">&gt;</span></span> <span class="token function">randomLoadBalancer</span><span class="token punctuation">(</span><span class="token class-name">Environment</span> environment<span class="token punctuation">,</span>                                                            <span class="token class-name">LoadBalancerClientFactory</span> loadBalancerClientFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">String</span> name <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">LoadBalancerClientFactory</span><span class="token punctuation">.</span><span class="token constant">PROPERTY_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RandomLoadBalancer</span><span class="token punctuation">(</span>loadBalancerClientFactory<span class="token punctuation">.</span><span class="token function">getLazyProvider</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token class-name">ServiceInstanceListSupplier</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="OpenFeign"><a href="#OpenFeign" class="headerlink" title="OpenFeign"></a>OpenFeign</h2><p>Feignæ˜¯ä¸€ä¸ª<strong>å£°æ˜æ€§webæœåŠ¡å®¢æˆ·ç«¯</strong>ã€‚å®ƒä½¿ç¼–å†™webæœåŠ¡å®¢æˆ·ç«¯å˜å¾—æ›´å®¹æ˜“ã€‚ä½¿ç”¨Feignåˆ›å»ºä¸€ä¸ªæ¥å£å¹¶å¯¹å…¶è¿›è¡Œæ³¨é‡Šã€‚å®ƒå…·æœ‰å¯æ’å…¥çš„æ³¨é‡Šæ”¯æŒï¼ŒåŒ…æ‹¬Feignæ³¨é‡Šå’ŒJAX-RSæ³¨é‡Šã€‚Feignè¿˜æ”¯æŒå¯æ’æ‹”ç¼–ç å™¨å’Œè§£ç å™¨ã€‚Spring Cloudæ·»åŠ äº†å¯¹Spring MVCæ³¨é‡Šçš„æ”¯æŒï¼Œä»¥åŠå¯¹ä½¿ç”¨Spring Webä¸­é»˜è®¤ä½¿ç”¨çš„HttpMessageConverterçš„æ”¯æŒã€‚Spring Cloudé›†æˆäº†Eurekaã€Spring Cloud CircuitBreakerä»¥åŠSpring Cloud LoadBalancerï¼Œä»¥ä¾¿åœ¨ä½¿ç”¨Feignæ—¶æä¾›è´Ÿè½½å¹³è¡¡çš„httpå®¢æˆ·ç«¯ã€‚</p><p>OpenFeignèƒ½å¹²ä»€ä¹ˆ</p><p>å‰é¢åœ¨ä½¿ç”¨<strong>SpringCloud LoadBalancer</strong>+RestTemplateæ—¶ï¼Œåˆ©ç”¨RestTemplateå¯¹httpè¯·æ±‚çš„å°è£…å¤„ç†å½¢æˆäº†ä¸€å¥—æ¨¡ç‰ˆåŒ–çš„è°ƒç”¨æ–¹æ³•ã€‚**<em>ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œ</em>**</p><p>ç”±äºå¯¹æœåŠ¡ä¾èµ–çš„è°ƒç”¨å¯èƒ½ä¸æ­¢ä¸€å¤„ï¼Œå¾€å¾€ä¸€ä¸ªæ¥å£ä¼šè¢«å¤šå¤„è°ƒç”¨ï¼Œæ‰€ä»¥é€šå¸¸éƒ½ä¼šé’ˆå¯¹æ¯ä¸ªå¾®æœåŠ¡è‡ªè¡Œå°è£…ä¸€äº›å®¢æˆ·ç«¯ç±»æ¥åŒ…è£…è¿™äº›ä¾èµ–æœåŠ¡çš„è°ƒç”¨ã€‚æ‰€ä»¥ï¼ŒOpenFeignåœ¨æ­¤åŸºç¡€ä¸Šåšäº†è¿›ä¸€æ­¥å°è£…ï¼Œç”±ä»–æ¥å¸®åŠ©æˆ‘ä»¬å®šä¹‰å’Œå®ç°ä¾èµ–æœåŠ¡æ¥å£çš„å®šä¹‰ã€‚åœ¨OpenFeignçš„å®ç°ä¸‹ï¼Œæˆ‘ä»¬åªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥é…ç½®å®ƒ(åœ¨ä¸€ä¸ªå¾®æœåŠ¡æ¥å£ä¸Šé¢æ ‡æ³¨ä¸€ä¸ª**_@FeignClient_**æ³¨è§£å³å¯)ï¼Œå³å¯å®Œæˆå¯¹æœåŠ¡æä¾›æ–¹çš„æ¥å£ç»‘å®šï¼Œç»Ÿä¸€å¯¹å¤–æš´éœ²å¯ä»¥è¢«è°ƒç”¨çš„æ¥å£æ–¹æ³•ï¼Œå¤§å¤§ç®€åŒ–å’Œé™ä½äº†è°ƒç”¨å®¢æˆ·ç«¯çš„å¼€å‘é‡ï¼Œä¹Ÿå³ç”±æœåŠ¡æä¾›è€…ç»™å‡ºè°ƒç”¨æ¥å£æ¸…å•ï¼Œæ¶ˆè´¹è€…ç›´æ¥é€šè¿‡OpenFeignè°ƒç”¨å³å¯ï¼ŒO(âˆ©_âˆ©)Oã€‚</p><p>OpenFeignåŒæ—¶è¿˜é›†æˆSpringCloud LoadBalancer</p><p>å¯ä»¥åœ¨ä½¿ç”¨OpenFeignæ—¶æä¾›Httpå®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ï¼Œä¹Ÿå¯ä»¥é›†æˆé˜¿é‡Œå·´å·´Sentinelæ¥æä¾›ç†”æ–­ã€é™çº§ç­‰åŠŸèƒ½ã€‚è€Œä¸SpringCloud LoadBalancerä¸åŒçš„æ˜¯ï¼Œé€šè¿‡OpenFeignåªéœ€è¦å®šä¹‰æœåŠ¡ç»‘å®šæ¥å£ä¸”ä»¥å£°æ˜å¼çš„æ–¹æ³•ï¼Œä¼˜é›…è€Œç®€å•çš„å®ç°äº†æœåŠ¡è°ƒç”¨ã€‚</p><ul><li>å¼•å…¥ä¾èµ–:<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--openfeign--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>é…ç½®æ–‡ä»¶<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">server:  port: 80spring:  application:    name: cloud-consumer-openfeign-order  ####Spring Cloud Consul for Service Discovery  cloud:    consul:      host: localhost      port: 8500      discovery:        prefer-ip-address: true #ä¼˜å…ˆä½¿ç”¨æœåŠ¡ipè¿›è¡Œæ³¨å†Œ        service-name: $</span><span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>mainå‡½æ•°ä¸Šä½¿ç”¨<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@EnableDiscoveryClient</span> <span class="token comment">//è¯¥æ³¨è§£ç”¨äºå‘ä½¿ç”¨consulä¸ºæ³¨å†Œä¸­å¿ƒæ—¶æ³¨å†ŒæœåŠ¡</span><span class="token annotation punctuation">@EnableFeignClients</span><span class="token comment">//å¯ç”¨feignå®¢æˆ·ç«¯,å®šä¹‰æœåŠ¡+ç»‘å®šæ¥å£ï¼Œä»¥å£°æ˜å¼çš„æ–¹æ³•ä¼˜é›…è€Œç®€å•çš„å®ç°æœåŠ¡è°ƒç”¨</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>apiæ¥å£ä¸Šä½¿ç”¨:<br>@FeignClient(value = â€œxxxâ€)</li><li>è¶…æ—¶æ§åˆ¶<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">sspring</span><span class="token punctuation">:</span>  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">openfeign</span><span class="token punctuation">:</span>      <span class="token key atrule">client</span><span class="token punctuation">:</span>        <span class="token key atrule">config</span><span class="token punctuation">:</span>          <span class="token comment"># default è®¾ç½®çš„å…¨å±€è¶…æ—¶æ—¶é—´ï¼ŒæŒ‡å®šæœåŠ¡åç§°å¯ä»¥è®¾ç½®å•ä¸ªæœåŠ¡çš„è¶…æ—¶æ—¶é—´</span>          <span class="token key atrule">default</span><span class="token punctuation">:</span>             <span class="token comment">#è¿æ¥è¶…æ—¶æ—¶é—´</span>             <span class="token key atrule">connectTimeout</span><span class="token punctuation">:</span> <span class="token number">4000</span>             <span class="token comment">#è¯»å–è¶…æ—¶æ—¶é—´</span>             <span class="token key atrule">readTimeout</span><span class="token punctuation">:</span> <span class="token number">4000</span>          <span class="token comment"># ä¸ºserviceCè¿™ä¸ªæœåŠ¡å•ç‹¬é…ç½®è¶…æ—¶æ—¶é—´ï¼Œå•ä¸ªé…ç½®çš„è¶…æ—¶æ—¶é—´å°†ä¼šè¦†ç›–å…¨å±€é…ç½®</span>          <span class="token key atrule">serviceC</span><span class="token punctuation">:</span>             <span class="token comment">#è¿æ¥è¶…æ—¶æ—¶é—´</span>             <span class="token key atrule">connectTimeout</span><span class="token punctuation">:</span> <span class="token number">2000</span>             <span class="token comment">#è¯»å–è¶…æ—¶æ—¶é—´</span>             <span class="token key atrule">readTimeout</span><span class="token punctuation">:</span> <span class="token number">2000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>æœåŠ¡é›ªå´©</strong></p><p>å¤šä¸ªå¾®æœåŠ¡ä¹‹é—´è°ƒç”¨çš„æ—¶å€™ï¼Œå‡è®¾å¾®æœåŠ¡Aè°ƒç”¨å¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cï¼Œå¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cåˆè°ƒç”¨å…¶å®ƒçš„å¾®æœåŠ¡ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œæ‰‡å‡ºâ€ã€‚å¦‚æœæ‰‡å‡ºçš„é“¾è·¯ä¸ŠæŸä¸ªå¾®æœåŠ¡çš„è°ƒç”¨å“åº”æ—¶é—´è¿‡é•¿æˆ–è€…ä¸å¯ç”¨ï¼Œå¯¹å¾®æœåŠ¡Açš„è°ƒç”¨å°±ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿèµ„æºï¼Œè¿›è€Œå¼•èµ·ç³»ç»Ÿå´©æºƒï¼Œæ‰€è°“çš„â€œé›ªå´©æ•ˆåº”â€.</p><p>å¯¹äºé«˜æµé‡çš„åº”ç”¨æ¥è¯´ï¼Œå•ä¸€çš„åç«¯ä¾èµ–å¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰èµ„æºéƒ½åœ¨å‡ ç§’é’Ÿå†…é¥±å’Œã€‚æ¯”å¤±è´¥æ›´ç³Ÿç³•çš„æ˜¯ï¼Œè¿™äº›åº”ç”¨ç¨‹åºè¿˜å¯èƒ½å¯¼è‡´æœåŠ¡ä¹‹é—´çš„å»¶è¿Ÿå¢åŠ ï¼Œå¤‡ä»½é˜Ÿåˆ—ï¼Œçº¿ç¨‹å’Œå…¶ä»–ç³»ç»Ÿèµ„æºç´§å¼ ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå‘ç”Ÿæ›´å¤šçš„çº§è”æ•…éšœã€‚è¿™äº›éƒ½è¡¨ç¤ºéœ€è¦å¯¹æ•…éšœå’Œå»¶è¿Ÿè¿›è¡Œéš”ç¦»å’Œç®¡ç†ï¼Œä»¥ä¾¿å•ä¸ªä¾èµ–å…³ç³»çš„å¤±è´¥ï¼Œä¸èƒ½å–æ¶ˆæ•´ä¸ªåº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿã€‚</p><p>æ‰€ä»¥ï¼Œ</p><p>é€šå¸¸å½“ä½ å‘ç°ä¸€ä¸ªæ¨¡å—ä¸‹çš„æŸä¸ªå®ä¾‹å¤±è´¥åï¼Œè¿™æ—¶å€™è¿™ä¸ªæ¨¡å—ä¾ç„¶è¿˜ä¼šæ¥æ”¶æµé‡ï¼Œç„¶åè¿™ä¸ªæœ‰é—®é¢˜çš„æ¨¡å—è¿˜è°ƒç”¨äº†å…¶ä»–çš„æ¨¡å—ï¼Œè¿™æ ·å°±ä¼šå‘ç”Ÿçº§è”æ•…éšœï¼Œæˆ–è€…å«é›ªå´©ã€‚</p><h2 id="CircuitBreaker-æ–­è·¯å™¨"><a href="#CircuitBreaker-æ–­è·¯å™¨" class="headerlink" title="CircuitBreaker  æ–­è·¯å™¨"></a>CircuitBreaker  æ–­è·¯å™¨</h2><p>é…ç½®å‚è€ƒ<br><img src="/2024/03/05/33/%E6%96%AD%E8%B7%AF%E5%99%A8%E9%85%8D%E7%BD%AE.png" alt="æ–­è·¯å™¨é…ç½®"></p><p>æ–­è·¯å™¨çš„çŠ¶æ€ï¼š</p><ol><li>CLOSED</li><li>OPEN</li><li>HALF_OPEN åŠå¼€<br><img src="/2024/03/05/33/%E7%8A%B6%E6%80%81.png"><br>pox<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--resilience4j-circuitbreaker--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-circuitbreaker-resilience4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- ç”±äºæ–­è·¯ä¿æŠ¤ç­‰éœ€è¦AOPå®ç°ï¼Œæ‰€ä»¥å¿…é¡»å¯¼å…¥AOPåŒ… --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-aop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="/2024/03/05/33/%E5%8E%9F%E7%90%86.png"></li></ol><h2 id="åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª"><a href="#åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª" class="headerlink" title="åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª"></a>åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª</h2><p>åŸå› :<br><img src="/2024/03/05/33/%E5%8E%9F%E5%9B%A0.png" alt="åŸå› "><br><strong>ZipKinæ¦‚è¿°</strong></p><p>Zipkinæ˜¯ä¸€ç§åˆ†å¸ƒå¼é“¾è·¯è·Ÿè¸ªç³»ç»Ÿå›¾å½¢åŒ–çš„å·¥å…·ï¼ŒZipkin æ˜¯ Twitter å¼€æºçš„åˆ†å¸ƒå¼è·Ÿè¸ªç³»ç»Ÿï¼Œèƒ½å¤Ÿæ”¶é›†å¾®æœåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­çš„å®æ—¶è°ƒç”¨é“¾è·¯ä¿¡æ¯ï¼Œå¹¶èƒ½å¤Ÿå°†è¿™äº›è°ƒç”¨é“¾è·¯ä¿¡æ¯å±•ç¤ºåˆ°Webå›¾å½¢åŒ–ç•Œé¢ä¸Šä¾›å¼€å‘äººå‘˜åˆ†æï¼Œå¼€å‘äººå‘˜èƒ½å¤Ÿä»ZipKinä¸­åˆ†æå‡ºè°ƒç”¨é“¾è·¯ä¸­çš„æ€§èƒ½ç“¶é¢ˆï¼Œè¯†åˆ«å‡ºå­˜åœ¨é—®é¢˜çš„åº”ç”¨ç¨‹åºï¼Œè¿›è€Œå®šä½é—®é¢˜å’Œè§£å†³é—®é¢˜<br>è¿è¡Œ: java -jar zipkin-server-3.0.0-rc0-exec.jar</p><h2 id="ç½‘å…³"><a href="#ç½‘å…³" class="headerlink" title="ç½‘å…³"></a>ç½‘å…³</h2><p><img src="/2024/03/05/33/%E7%BD%91%E5%85%B3.png" alt="ç½‘å…³"></p><h3 id="æ‰§è¡Œæµç¨‹ï¼š"><a href="#æ‰§è¡Œæµç¨‹ï¼š" class="headerlink" title="æ‰§è¡Œæµç¨‹ï¼š"></a>æ‰§è¡Œæµç¨‹ï¼š</h3><ol><li>è·¯ç”±åˆ¤æ–­ï¼šç”¨æˆ·ç«¯çš„è¯·æ±‚åˆ°è¾¾ç½‘å…³ä¹‹åï¼Œæ ¹æ®Gateway Handler Mapping å¤„ç†ï¼Œä¼šè¿›è¡Œæ–­è¨€åˆ¤æ–­</li><li>è·¯ç”±è¿‡æ»¤ï¼šå¾ˆå¤šHandler ç»„æˆçš„Fileter Chain</li><li>æœåŠ¡å¤„ç†ï¼šåç«¯æœåŠ¡ä¼šå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†</li><li>å“åº”è¿‡æ»¤ï¼šè¿”å›ç»™-Gatewayçš„è¿‡æ»¤å™¨ä¼šå†æ¬¡è¿›è¡Œå¤„ç†ï¼Œé€»è¾‘ä¸Šå¯ä»¥ä¹˜åPost-Filters</li><li>å“åº”è¿”å›ï¼šå“åº”ç»è¿‡è¿‡å¤„ç†ä¹‹åï¼Œè¿”å›ç»™å®¢æˆ·ç«¯</li></ol><ul><li>ä½œç”¨<ol><li>åå‘ä»£ç†</li><li>é‰´æƒ</li><li>æµé‡æ§åˆ¶</li><li>ç†”æ–­</li><li>æ—¥å¿—ç›‘æ§</li></ol></li></ul><h3 id="Spring-Cloud-Gatewayå¦‚ä½•å®ç°åŠ¨æ€è·¯ç”±"><a href="#Spring-Cloud-Gatewayå¦‚ä½•å®ç°åŠ¨æ€è·¯ç”±" class="headerlink" title="Spring Cloud Gatewayå¦‚ä½•å®ç°åŠ¨æ€è·¯ç”±"></a>Spring Cloud Gatewayå¦‚ä½•å®ç°åŠ¨æ€è·¯ç”±</h3><p>å¯ä»¥ä½¿ç”¨Nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒå»åŠ¨æ€æ›´æ”¹<br>é…ç½®çš„è·¯ç”±æ–­è¨€ç±»å‹</p><h3 id="Gatewayè¿‡æ»¤å™¨çš„ç±»å‹"><a href="#Gatewayè¿‡æ»¤å™¨çš„ç±»å‹" class="headerlink" title="Gatewayè¿‡æ»¤å™¨çš„ç±»å‹"></a>Gatewayè¿‡æ»¤å™¨çš„ç±»å‹</h3><ul><li>Preç±»å‹ï¼šåœ¨è¯·æ±‚è¢«è½¬å‘åˆ°å¾®æœåŠ¡ä¹‹å‰åŠé€†è¡Œæ‹¦æˆªå’Œä¿®æ”¹</li><li>Post ï¼š å¾®æœåŠ¡å¤„ç†è¯·æ±‚ä¹‹åï¼Œè¿”å›å“åº”ç»™ç½‘å…³ï¼Œç½‘å…³å¯ä»¥å†æ¬¡è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚ä¿®æ”¹ç›¸åº”å†…å®¹æˆ–è€…å“åº”å¤´ï¼Œæ—¥å¿—è¾“å‡ºï¼Œæµé‡ç›‘æ§<br>æˆ–è€…</li><li>GatewayFilterï¼šå±€éƒ¨è¿‡æ»¤å™¨ï¼Œåº”ç”¨åœ¨å•ä¸ªè·¯ç”±æˆ–è€…ä¸€ç»„è·¯ç”±ä¸Šçš„è¿‡æ»¤å™¨</li><li>GlobalFilterï¼šå…¨å±€è¿‡æ»¤å™¨<br>pom<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--gateway--&gt;</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>yml<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9527</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>gateway <span class="token comment">#ä»¥å¾®æœåŠ¡æ³¨å†Œè¿›consulæˆ–nacosæœåŠ¡åˆ—è¡¨å†…</span>  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">consul</span><span class="token punctuation">:</span> <span class="token comment">#é…ç½®consulåœ°å€</span>      <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>        <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token key atrule">gateway</span><span class="token punctuation">:</span>      <span class="token key atrule">routes</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 <span class="token comment">#pay_routh1                #è·¯ç”±çš„ID(ç±»ä¼¼mysqlä¸»é”®ID)ï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span>          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8001</span>                <span class="token comment">#åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span>          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>            <span class="token punctuation">-</span> Path=/pay/gateway/get/<span class="token important">**</span>              <span class="token comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±id: pay_routh2 #pay_routh2                #è·¯ç”±çš„ID(ç±»ä¼¼mysqlä¸»é”®ID)ï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span>          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8001</span>                <span class="token comment">#åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span>          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>            <span class="token punctuation">-</span> Path=/pay/gateway/info/<span class="token important">**</span>              <span class="token comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±      </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="SpringCloud-1"><a href="#SpringCloud-1" class="headerlink" title="SpringCloud"></a>SpringCloud</h2><p><img src="/2024/03/05/33/alibaba.png" alt="é˜¿é‡Œå·´å·´"></p><ul><li>åŠŸèƒ½<br><img src="/2024/03/05/33/%E5%8A%9F%E8%83%BD.png" alt="åŠŸèƒ½"></li><li>ç»„ä»¶<br><img src="/2024/03/05/33/%E7%BB%84%E4%BB%B6.png" alt="ç»„ä»¶"></li></ul><h3 id="æœåŠ¡æ³¨å†Œ-Nacos-x3D-x3D-consul"><a href="#æœåŠ¡æ³¨å†Œ-Nacos-x3D-x3D-consul" class="headerlink" title="æœåŠ¡æ³¨å†Œ Nacos == consul"></a>æœåŠ¡æ³¨å†Œ Nacos == consul</h3><p><strong>æ³¨æ„æ˜¯æ ¹æ®IDæ¥åŒºåˆ†çš„ä¸æ˜¯æ ¹æ®åå­—æ¥åŒºåˆ†å‘½åç©ºé—´çš„ï¼Œæ‰€ä»¥IDè¦å¡«è‡ªå·±æƒ³å¡«çš„</strong></p><p><img src="/2024/03/05/33/%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%AF%B9%E6%AF%94.png" alt="å¯¹æ¯”"></p><ul><li><p>å‘½ä»¤è¡Œ</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">startup.cmd -m standalone<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æœåŠ¡æä¾›è€…<br>pom:</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>yml</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9001</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#é…ç½®Nacosåœ°å€</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>mainå‡½æ•°ä¸Šä½¿ç”¨@EnableDiscoveryClient<br>ä¸šåŠ¡ç±»ç¤ºèŒƒ<br><img src="/2024/03/05/33/controller%E7%A4%BA%E8%8C%83.png" alt="ç¤ºèŒƒ"></p></li><li><p>æ¶ˆè´¹è€…<br>pom</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--nacos-discovery--&gt;</span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>       <span class="token comment">&lt;!--loadbalancer--&gt;</span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-loadbalancer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">server:  port: 83spring:  application:    name: nacos-order-consumer  cloud:    nacos:      discovery:        server-addr: localhost:8848#æ¶ˆè´¹è€…å°†è¦å»è®¿é—®çš„å¾®æœåŠ¡åç§°(nacoså¾®æœåŠ¡æä¾›è€…å«ä»€ä¹ˆä½ å†™ä»€ä¹ˆ)service-url:  nacos-user-service: http://nacos-payment-provider<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>mainä¸Šä¹Ÿä½¿ç”¨@EnableDiscoveryClient</p></li></ul><p>restTemplateé…ç½®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">ackage com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>config<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span></span><span class="token class-name">LoadBalanced</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestTemplate</span></span><span class="token punctuation">;</span><span class="token comment">/** * @auther zzyy * @create 2023-11-23 17:20 */</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestTemplateConfig</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token annotation punctuation">@LoadBalanced</span> <span class="token comment">//èµ‹äºˆRestTemplateè´Ÿè½½å‡è¡¡çš„èƒ½åŠ›</span>    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>Nacosä½œä¸ºé…ç½®ä¸­å¿ƒï¼Œè¿›è¡ŒåŠ¨æ€é…ç½®<br>å¯¼å…¥pom<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--bootstrap--&gt;</span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-bootstrap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>     <span class="token comment">&lt;!--nacos-config--&gt;</span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>ä¸ºä»€ä¹ˆè¿›è¡Œä¸¤ä¸ªé…ç½®ï¼Ÿ bootstrapå’Œapplication?<br>NacosåŒConsulä¸€æ ·ï¼Œåœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶ï¼Œè¦ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒè¿›è¡Œé…ç½®æ‹‰å–ï¼Œ<br>æ‹‰å–é…ç½®ä¹‹åï¼Œæ‰èƒ½ä¿è¯é¡¹ç›®çš„æ­£å¸¸å¯åŠ¨ï¼Œä¸ºäº†æ»¡è¶³åŠ¨æ€åˆ·æ–°å’Œå…¨å±€å¹¿æ’­é€šçŸ¥<br>springbootä¸­é…ç½®æ–‡ä»¶çš„åŠ è½½æ˜¯å­˜åœ¨ä¼˜å…ˆçº§é¡ºåºçš„ï¼Œbootstrapä¼˜å…ˆçº§é«˜äºapplication<br>bootstrap<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector"># nacosé…ç½®spring:  application:    name: nacos-config-client  cloud:    nacos:      discovery:        server-addr: localhost:8848 #NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€      config:        server-addr: localhost:8848 #Nacosä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€        file-extension: yaml #æŒ‡å®šyamlæ ¼å¼çš„é…ç½®# nacosç«¯é…ç½®æ–‡ä»¶DataIdçš„å‘½åè§„åˆ™æ˜¯ï¼š# $</span><span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token selector">-$</span><span class="token punctuation">{</span>spring.profile.active<span class="token punctuation">}</span><span class="token selector">.$</span><span class="token punctuation">{</span>spring.cloud.nacos.config.file-extension<span class="token punctuation">}</span># <span class="token property">æœ¬æ¡ˆä¾‹çš„DataIDæ˜¯</span><span class="token punctuation">:</span>nacos-config-client-dev.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>application<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token property">server</span><span class="token punctuation">:</span>  <span class="token property">port</span><span class="token punctuation">:</span> 3377<span class="token property">spring</span><span class="token punctuation">:</span>  <span class="token property">profiles</span><span class="token punctuation">:</span>    <span class="token property">active</span><span class="token punctuation">:</span> dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ      #<span class="token property">active</span><span class="token punctuation">:</span> prod # è¡¨ç¤ºç”Ÿäº§ç¯å¢ƒ    #<span class="token property">active</span><span class="token punctuation">:</span> test # è¡¨ç¤ºæµ‹è¯•ç¯å¢ƒ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>controllerå±‚ä¸Šä½¿ç”¨@RefreshScope //åœ¨æ§åˆ¶å™¨ç±»åŠ å…¥@RefreshScopeæ³¨è§£ä½¿å½“å‰ç±»ä¸‹çš„é…ç½®æ”¯æŒNacosçš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½ã€‚</li></ul><p><em><strong>é—®é¢˜1ï¼š</strong></em></p><p>å®é™…å¼€å‘ä¸­ï¼Œé€šå¸¸ä¸€ä¸ªç³»ç»Ÿä¼šå‡†å¤‡</p><p>devå¼€å‘ç¯å¢ƒ</p><p>testæµ‹è¯•ç¯å¢ƒ</p><p>prodç”Ÿäº§ç¯å¢ƒã€‚</p><p>å¦‚ä½•ä¿è¯æŒ‡å®šç¯å¢ƒå¯åŠ¨æ—¶æœåŠ¡èƒ½æ­£ç¡®è¯»å–åˆ°Nacosä¸Šç›¸åº”ç¯å¢ƒçš„é…ç½®æ–‡ä»¶å‘¢ï¼Ÿ</p><p><em><strong>é—®é¢˜2:</strong></em></p><p>ä¸€ä¸ªå¤§å‹åˆ†å¸ƒå¼å¾®æœåŠ¡ç³»ç»Ÿä¼šæœ‰å¾ˆå¤šå¾®æœåŠ¡å­é¡¹ç›®ï¼Œ</p><p>æ¯ä¸ªå¾®æœåŠ¡é¡¹ç›®åˆéƒ½ä¼šæœ‰ç›¸åº”çš„å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€é¢„å‘ç¯å¢ƒã€æ­£å¼ç¯å¢ƒâ€¦â€¦</p><p>é‚£æ€ä¹ˆå¯¹è¿™äº›å¾®æœåŠ¡é…ç½®è¿›è¡Œåˆ†ç»„å’Œå‘½åç©ºé—´ç®¡ç†å‘¢ï¼Ÿ</p><p><img src="/2024/03/05/33/model.png" alt="model"></p><h2 id="Sentinel-ç­‰ä»·äº-Circuit-Breaker-è‡ªå·±å»å®˜ç½‘çœ‹"><a href="#Sentinel-ç­‰ä»·äº-Circuit-Breaker-è‡ªå·±å»å®˜ç½‘çœ‹" class="headerlink" title="Sentinel ç­‰ä»·äº Circuit Breaker è‡ªå·±å»å®˜ç½‘çœ‹"></a>Sentinel ç­‰ä»·äº Circuit Breaker è‡ªå·±å»å®˜ç½‘çœ‹</h2><p><img src="/2024/03/05/33/%E9%9B%AA%E5%B4%A9.png"><br><img src="/2024/03/05/33/%E9%99%8D%E7%BA%A7.png"><br><img src="/2024/03/05/33/%E7%86%94%E6%96%AD.png"><br><img src="/2024/03/05/33/%E9%99%90%E6%B5%81.png"><br><img src="/2024/03/05/33/%E9%9A%94%E7%A6%BB.png"><br><img src="/2024/03/05/33/%E9%9A%94%E7%A6%BB.png"><br><img src="/2024/03/05/33/%E8%B6%85%E6%97%B6.png"></p><p>pom</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--SpringCloud alibaba sentinel --&gt;</span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>yml</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token property">server</span><span class="token punctuation">:</span>  <span class="token property">port</span><span class="token punctuation">:</span> 8401<span class="token property">spring</span><span class="token punctuation">:</span>  <span class="token property">application</span><span class="token punctuation">:</span>    <span class="token property">name</span><span class="token punctuation">:</span> cloudalibaba-sentinel-service  <span class="token property">cloud</span><span class="token punctuation">:</span>    <span class="token property">nacos</span><span class="token punctuation">:</span>      <span class="token property">discovery</span><span class="token punctuation">:</span>        <span class="token property">server-addr</span><span class="token punctuation">:</span> <span class="token property">localhost</span><span class="token punctuation">:</span>8848         #NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€    <span class="token property">sentinel</span><span class="token punctuation">:</span>      <span class="token property">transport</span><span class="token punctuation">:</span>        <span class="token property">dashboard</span><span class="token punctuation">:</span> <span class="token property">localhost</span><span class="token punctuation">:</span>8080 #é…ç½®Sentinel dashboardæ§åˆ¶å°æœåŠ¡åœ°å€        <span class="token property">port</span><span class="token punctuation">:</span> 8719 #é»˜è®¤8719ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨ä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æ<span class="token punctuation">,</span>ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2024/03/05/33/%E6%87%92%E5%8A%A0%E8%BD%BD.png" alt="æ‡’åŠ è½½"></p><ul><li>æµæ§è§„åˆ™<br><img src="/2024/03/05/33/%E6%B5%81%E6%8E%A7%E8%A7%84%E5%88%99.png"></li><li>ç†”æ–­é™çº§<br>Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç°ä¸ç¨³å®šçŠ¶æ€æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…æ—¶æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ï¼Œå¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œé™åˆ¶ï¼Œ</li></ul><p>è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“åˆ°å…¶å®ƒçš„èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ã€‚å½“èµ„æºè¢«é™çº§åï¼Œåœ¨æ¥ä¸‹æ¥çš„é™çº§æ—¶é—´çª—å£ä¹‹å†…ï¼Œå¯¹è¯¥èµ„æºçš„è°ƒç”¨éƒ½è‡ªåŠ¨ç†”æ–­ï¼ˆé»˜è®¤è¡Œä¸ºæ˜¯æŠ›å‡º DegradeExceptionï¼‰ã€‚ã€</p><h3 id="å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼-äº‹åŠ¡"><a href="#å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼-äº‹åŠ¡" class="headerlink" title="å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼ äº‹åŠ¡"></a>å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼ äº‹åŠ¡</h3><h2 id="Seata"><a href="#Seata" class="headerlink" title="Seata"></a>Seata</h2><p><img src="/2024/03/05/33/senta.png" alt="senta"></p><p>å»å®˜ç½‘çœ‹</p><p>é¢è¯•é¢˜ï¼š<br><img src="/2024/03/05/33/AT%E9%9D%A2%E8%AF%95%E9%A2%98.png"><br><img src="/2024/03/05/33/AT%E9%9D%A2%E8%AF%95%E9%A2%981.png"></p><p><img src="/2024/03/05/33/%E6%8F%90%E4%BA%A4.png"><br><img src="/2024/03/05/33/%E5%9B%9E%E6%BB%9A.png"></p><h2 id="åˆ†å¸ƒå¼è¯¦ç»†"><a href="#åˆ†å¸ƒå¼è¯¦ç»†" class="headerlink" title="åˆ†å¸ƒå¼è¯¦ç»†"></a>åˆ†å¸ƒå¼è¯¦ç»†</h2><h3 id="åˆ†å¸ƒå¼ID-åˆ†å¸ƒå¼ID-https-javaguide-cn-distributed-system-distributed-id-design-html"><a href="#åˆ†å¸ƒå¼ID-åˆ†å¸ƒå¼ID-https-javaguide-cn-distributed-system-distributed-id-design-html" class="headerlink" title="[åˆ†å¸ƒå¼ID](### åˆ†å¸ƒå¼ID https://javaguide.cn/distributed-system/distributed-id-design.html)"></a>[åˆ†å¸ƒå¼ID](### åˆ†å¸ƒå¼ID <a href="https://javaguide.cn/distributed-system/distributed-id-design.html">https://javaguide.cn/distributed-system/distributed-id-design.html</a>)</h3><h4 id="éœ€æ±‚ï¼š"><a href="#éœ€æ±‚ï¼š" class="headerlink" title="éœ€æ±‚ï¼š"></a>éœ€æ±‚ï¼š</h4><ol><li>å…¨å±€å”¯ä¸€</li><li>é«˜å¯ç”¨</li><li>é«˜æ€§èƒ½</li><li>å®‰å…¨</li><li>æ–¹ä¾¿æ˜“ç”¨</li></ol><h4 id="è§£å†³æ–¹å¼ï¼š"><a href="#è§£å†³æ–¹å¼ï¼š" class="headerlink" title="è§£å†³æ–¹å¼ï¼š"></a>è§£å†³æ–¹å¼ï¼š</h4><p>æ¨èä½¿ç”¨é›ªèŠ±ç®—æ³•</p><h3 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h3><h4 id="Rediså®ç°"><a href="#Rediså®ç°" class="headerlink" title="Rediså®ç°"></a>Rediså®ç°</h4><h5 id="setnx"><a href="#setnx" class="headerlink" title="setnx"></a>setnx</h5><h6 id="Redisson"><a href="#Redisson" class="headerlink" title="Redisson"></a>Redisson</h6><h4 id="å¯é‡å…¥é”"><a href="#å¯é‡å…¥é”" class="headerlink" title="å¯é‡å…¥é”"></a>å¯é‡å…¥é”</h4><p>ä¸€ä¸ªçº¿ç¨‹ä¸­å¯ä»¥å¤šæ¬¡è·å–åŒä¸€æŠŠé”ï¼Œä¾‹å¦‚ï¼Œæ–¹æ³•åˆè°ƒç”¨äº†å¦ä¸€ä¸ªéœ€è¦ç›¸åŒé”çš„æ–¹æ³•ã€‚<br>å¯ä»¥ä½¿ç”¨çº¢é”</p><h4 id="ZooKeeper"><a href="#ZooKeeper" class="headerlink" title="ZooKeeper"></a><a href="https://javaguide.cn/distributed-system/distributed-lock-implementations.html#%E5%9F%BA%E4%BA%8E-zookeeper-%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">ZooKeeper</a></h4><p><a href="https://javaguide.cn/distributed-system/distributed-process-coordination/zookeeper/zookeeper-intro.html">https://javaguide.cn/distributed-system/distributed-process-coordination/zookeeper/zookeeper-intro.html</a><br>Redisçš„æ€§èƒ½æ›´å¥½ï¼Œä½†æ˜¯Zookeeperçš„å¯é æ€§æ›´é«˜ã€‚<br>æ¨èä½¿ç”¨ Curator æ¥å®ç° ZooKeeper åˆ†å¸ƒå¼é”ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>python and web or ai</title>
      <link href="/2024/02/27/04/"/>
      <url>/2024/02/27/04/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºç¡€è¯­æ³•"><a href="#åŸºç¡€è¯­æ³•" class="headerlink" title="åŸºç¡€è¯­æ³•"></a>åŸºç¡€è¯­æ³•</h2><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">pip install beautifulsoup4 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="Scrapyæ¡†æ¶"><a href="#Scrapyæ¡†æ¶" class="headerlink" title="Scrapyæ¡†æ¶"></a>Scrapyæ¡†æ¶</h2><p>é¡¹ç›®ç»“æ„:</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">scrapy.cfg é…ç½®æ–‡ä»¶setting.py å®šä¹‰çˆ¬è™«çš„ç›¸å…³é…ç½®ä¿¡æ¯items.py å®šä¹‰å¾…çˆ¬é¡µé¢æ•°æ®çš„ç»“æ„pipelines.py å®šä¹‰å­˜å‚¨çˆ¬åˆ°çš„æ•°æ®çš„æ–¹å¼middlewares.py å®šä¹‰éšæœºåˆ‡æ¢ipç­‰é€»è¾‘Spiders åœ¨ç›®å½•é‡Œï¼Œå­˜æ”¾çˆ¬è™«ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">scrapy startproject projectName æ–°å»ºä¸€ä¸ªé¡¹ç›®1.åœ¨itemsæ¨¡å—ä¸­å®šä¹‰å¾…çˆ¬å–å†…å®¹çš„æ•°æ®ç»“æ„2.åœ¨spidersæ–‡ä»¶ä¸­scrapy genspider name xxx.com æ–°å»ºä¸€ä¸ªçˆ¬è™«æ–‡ä»¶3.pipelinesä¸­å®šä¹‰å­˜å‚¨æ–¹å¼4.settingsä¸­åŠ å…¥ITEM_PIPELINES =</span> <span class="token punctuation">{</span>    <span class="token string">"cnblogPrj.pipelines.CnblogprjPipeline"</span><span class="token punctuation">:</span> 300<span class="token punctuation">,</span><span class="token punctuation">}</span># ç¦ç”¨cookiesCOOKIES_ENABLED = False<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">x = float(input() )y = float(input())print("{:.3f} + {:.3f} = {:.3f}".format(x, y, x + y))print("{:.3f} - {:.3f} = {:.3f}" .format (x, y, x - y))print("{:.3f} * {:.3f} = {:.3f}" .format (x, y, x * y))print("{:.3f} / {:.3f} = {:.3f}" .format (x, y, x / &nbsp;y))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç½‘</title>
      <link href="/2023/10/23/46/"/>
      <url>/2023/10/23/46/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¡ç½‘"><a href="#è®¡ç½‘" class="headerlink" title="è®¡ç½‘"></a>è®¡ç½‘</h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>MTU:ç½‘ç»œä¸­ä¸€æ¬¡å¯ä»¥ä¼ è¾“çš„æœ€å¤§æ•°æ®åŒ…çš„å¤§å°<br>MSS:TCPä¸­é™¤å»TCPå’ŒIPçš„å¤´éƒ¨ï¼Œèƒ½å¤Ÿä¼ è¾“çš„æœ€å¤§çš„æ•°æ®é‡<br>SDUï¼ŒService Data Unitï¼ŒæœåŠ¡æ•°æ®å•å…ƒã€‚<br>ISP æ˜¯ Internet Service Provider çš„ç¼©å†™ï¼Œç¿»è¯‘ä¸ºäº’è”ç½‘æœåŠ¡æä¾›å•†ã€‚<br>åè®®<br>Telnet å®¢æˆ·ç«¯ç™»å½•åè®®ï¼Œå±äºåº”ç”¨å±‚<br>TLD æ˜¯ Top-Level Domain çš„ç¼©å†™ï¼Œç¿»è¯‘ä¸ºé¡¶çº§åŸŸå<br>GBN (Go-Back-N)  é€€å›<br>SR é€‰æ‹©æ€§é‡ä¼ <br>mask å­ç½‘æ©ç <br>SDN æ˜¯æŒ‡è½¯ä»¶å®šä¹‰ç½‘ç»œï¼ˆSoftware-Defined Networkingï¼‰<br>OSPFï¼ˆOpen Shortest Path Firstï¼‰æ˜¯ä¸€ç§å¼€æ”¾å¼çš„é“¾è·¯çŠ¶æ€è·¯ç”±åè®®ï¼Œç”¨äºè®¡ç®—æœºç½‘ç»œä¸­çš„åŠ¨æ€è·¯ç”±ã€‚<br>Secure sockets layer (SSL)</p><p><strong>MSL:æŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´<br>TTL:ç»è¿‡çš„è·¯ç”±è·³æ•°</strong></p><p>åºåˆ—å·ï¼šåœ¨å»ºç«‹è¿æ¥æ—¶ç”±å†…æ ¸ç”Ÿæˆçš„éšæœºæ•°ä½œä¸ºå…¶åˆå§‹å€¼ï¼Œé€šè¿‡ SYN æŠ¥æ–‡ä¼ ç»™æ¥æ”¶ç«¯ä¸»æœºï¼Œæ¯å‘é€ä¸€æ¬¡æ•°æ®ï¼Œå°±ã€Œç´¯åŠ ã€ä¸€æ¬¡è¯¥ã€Œæ•°æ®å­—èŠ‚æ•°ã€çš„å¤§å°ã€‚ç”¨æ¥è§£å†³ç½‘ç»œåŒ…ä¹±åºé—®é¢˜ã€‚<br>ç¡®è®¤å·ï¼šæŒ‡ä¸‹ä¸€æ¬¡ã€ŒæœŸæœ›ã€æ”¶åˆ°çš„æ•°æ®çš„åºåˆ—å·ï¼Œå‘é€ç«¯æ”¶åˆ°æ¥æ”¶æ–¹å‘æ¥çš„ ACK ç¡®è®¤æŠ¥æ–‡ä»¥åï¼Œå°±å¯ä»¥è®¤ä¸ºåœ¨è¿™ä¸ªåºå·ä»¥å‰çš„æ•°æ®éƒ½å·²ç»è¢«æ­£å¸¸æ¥æ”¶ã€‚ç”¨æ¥è§£å†³ä¸¢åŒ…çš„é—®é¢˜ã€‚<br><strong>æ§åˆ¶ä½ï¼š</strong> ç”¨æ¥æ ‡è¯† TCP æŠ¥æ–‡æ˜¯ä»€ä¹ˆç±»å‹çš„æŠ¥æ–‡ï¼Œæ¯”å¦‚æ˜¯ SYN æŠ¥æ–‡ã€æ•°æ®æŠ¥æ–‡ã€ACK æŠ¥æ–‡ï¼ŒFIN æŠ¥æ–‡ç­‰ã€‚</p><h1 id="é¢è¯•å¸¸é—®"><a href="#é¢è¯•å¸¸é—®" class="headerlink" title="é¢è¯•å¸¸é—®"></a>é¢è¯•å¸¸é—®</h1><ul><li>UDPæ˜¯é¢å‘æŠ¥æ–‡çš„ï¼šå‘é€æ–¹ä¸ä¼šå¯¹æŠ¥æ–‡è¿›è¡Œæ‹†åˆ†ï¼Œæ‰€ä»¥ä¸€ä¸ªæŠ¥æ–‡å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ¶ˆæ¯ï¼Œæ¥æ”¶æ–¹ä½¿ç”¨é˜Ÿåˆ—æ¥åŒºåˆ†ä¸åŒæŠ¥æ–‡</li><li>TCPæ˜¯é¢å‘å­—èŠ‚æµçš„ï¼šç²˜åŒ…é—®é¢˜ï¼šTCPæŠ¥æ–‡ä¼šæ‹†åˆ†æˆå¤šä¸ªï¼Œå–å†³äº<strong>å‘é€çª—å£ã€æ‹¥å¡çª—å£ä»¥åŠå½“å‰å‘é€ç¼“å†²åŒºçš„å¤§å°ç­‰æ¡ä»¶</strong>ï¼Œæ‰€ä»¥ä¸å®¹æ˜“çŸ¥é“ä¸€ä¸ªç”¨æˆ·æ¶ˆæ¯çš„è¾¹ç•Œ<ul><li><img src="/2023/10/23/46/TcpHeader.png"></li><li>æ§åˆ¶ä½æ˜¯å•ç‹¬çš„ç•™å‡ºæ¥çš„å‡ ä¸ªä½ç½®</li><li>TCPé¢å‘å­—èŠ‚æµçš„ï¼Œå‘é€çš„æ˜¯ä¸€ä¸ªä¸ªè¿ç»­çš„å­—èŠ‚ï¼Œè€ŒUDPæ˜¯é¢å‘æ•°æ®æŠ¥çš„ï¼Œä¸€ä¸ªUDPæ•°æ®æŠ¥å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ¶ˆæ¯</li><li>é‡ä¼ æœºåˆ¶ï¼š1.è¶…æ—¶é‡ä¼ ï¼Œé‡ä¼ æ—¶é—´æœ€å¥½ç•¥å¤§äºåŒ…çš„å¾€è¿”æ—¶é—´ï¼Œ2.å¿«é€Ÿé‡ä¼ 3.SACKé‡ä¼ ï¼Œé€‰æ‹©æ€§ç¡®è®¤&nbsp;TCP å¤´éƒ¨ã€Œé€‰é¡¹ã€å­—æ®µé‡ŒåŠ ä¸€ä¸ª&nbsp;<code>SACK</code>&nbsp;çš„ä¸œè¥¿ï¼Œå®ƒ<strong>å¯ä»¥å°†å·²æ”¶åˆ°çš„æ•°æ®çš„ä¿¡æ¯å‘é€ç»™ã€Œå‘é€æ–¹ã€</strong>ï¼Œè¿™æ ·å‘é€æ–¹å°±å¯ä»¥çŸ¥é“å“ªäº›æ•°æ®æ”¶åˆ°äº†ï¼Œå“ªäº›æ•°æ®æ²¡æ”¶åˆ°ï¼ŒçŸ¥é“äº†è¿™äº›ä¿¡æ¯ï¼Œå°±å¯ä»¥<strong>åªé‡ä¼ ä¸¢å¤±çš„æ•°æ®</strong>ã€‚4.   Duplicate SACK,åªå‘Šè¯‰å¯¹æ–¹æœ‰å“ªäº›æ•°æ®è¢«é‡å¤æ¥å—äº†</li><li>æ»‘åŠ¨çª—å£ï¼š<strong>æ— éœ€ç­‰å¾…ç¡®è®¤åº”ç­”ï¼Œè€Œå¯ä»¥ç»§ç»­å‘é€æ•°æ®çš„æœ€å¤§å€¼</strong></li><li><strong>æ‹¥å¡çª—å£ cwnd</strong>æ˜¯å‘é€æ–¹ç»´æŠ¤çš„ä¸€ä¸ªçš„çŠ¶æ€å˜é‡ï¼Œå®ƒä¼šæ ¹æ®<strong>ç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦åŠ¨æ€å˜åŒ–çš„</strong>ã€‚ ç½‘ç»œæ²¡å‡ºç°æ‹¥å¡ï¼Œcwndå¢åŠ ï¼Œå‡ºç°æ‹¥å¡cwndå‡å°‘</li></ul></li><li>HTTPï¼šæœ€å¸¸ä½¿ç”¨çš„æ˜¯HTTP/1.1 <ul><li>ä¼˜åŒ– HTTP/1.1<ol><li>å‡å°‘è¯·æ±‚æ¬¡æ•°ï¼š1.ä½¿ç”¨å®¢æˆ·ç«¯ç¼“å­˜ï¼Œ2.å‡å°‘é‡å®šå‘æ¬¡æ•°ï¼Œ3.åˆå¹¶è¯·æ±‚ï¼Œ4.å»¶è¿Ÿå‘é€ï¼Œåªå‘é€ä¸€éƒ¨åˆ†å†…å®¹</li><li>å‡å°‘å“åº”æ•°æ®å¤§å°ï¼šä½¿ç”¨å‹ç¼©æ–¹å¼</li></ol></li></ul><ol><li>Keep-Aliveï¼šç”¨äºä¿æŒé•¿è¿æ¥ï¼Œkeepaliveï¼ŒTCPä¸­çš„ä¿æ´»æœºåˆ¶,HTTP1.1é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œåœ¨è¯·æ±‚å¤´ä¸­ä½¿ç”¨<code>Connection: Keep-Alive</code></li><li>å¼ºåˆ¶ç¼“å­˜ï¼šæœåŠ¡å™¨ç›´æ¥è¦æ±‚ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜çš„æ•°æ®ï¼Œ åå•†ç¼“å­˜ï¼šæœåŠ¡å™¨ä¼šå¯¹æ¯”ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œå†³å®šæ˜¯å¦è¿‡æœŸï¼Œè¿”å›ç»™æµè§ˆå™¨å†³å®šæ˜¯å¦ä½¿ç”¨æµè§ˆå™¨çš„ç¼“å­˜</li><li>é˜Ÿå¤´é˜»å¡ï¼šæœåŠ¡ç«¯åœ¨å¤„ç†è¯·æ±‚æ—¶è€—æ—¶è¾ƒé•¿å¯¼è‡´åé¢çš„è¯·æ±‚æ— æ³•å³ä½¿å‘é€ï¼Œè§£å†³æ–¹å¼ ï¼šä½¿ç”¨ç®¡é“ï¼šå®¢æˆ·ç«¯å¯ä»¥ç›´æ¥å‘é€å¤šä¸ªè¯·æ±‚ï¼ŒæœåŠ¡ç«¯æ ¹æ®å‘é€é¡ºåºæ¥è§£å†³ï¼Œä½†æ˜¯ç®¡é“æŠ€æœ¯åŸºæœ¬ <strong>æ²¡äººä½¿ç”¨</strong></li></ol><ul><li>æ¼”è¿›è¿‡ç¨‹ï¼š<ol><li>1.1 ä½¿ç”¨é•¿è¿æ¥æ”¹å–„çŸ­é“¾æ¥çš„æ€§èƒ½å¼€é”€ï¼Œä½¿ç”¨ç®¡é“è¿›ä¼ è¾“ï¼Œæ”¹å–„äº†é˜Ÿå¤´é˜»å¡ã€‚ç¼ºç‚¹æ˜¯ï¼šheaderæœªå‹ç¼©ï¼Œåªèƒ½å‹ç¼©body,åªèƒ½ä»å®¢æˆ·ç«¯å¼€å§‹å‘é€è¯·æ±‚ï¼Œæ²¡æœ‰è¯·æ±‚ä¼˜å…ˆçº§</li><li>2 å¤´éƒ¨å‹ç¼©ï¼Œå½“åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚å¤´æ˜¯ä¸€æ ·æˆ–è€…ç›¸ä¼¼çš„å°±æŠŠé‡å¤å‘éƒ¨åˆ†æ¶ˆé™¤ï¼ŒåŸºäºHTTPSçš„ï¼Œå¤´éƒ¨å…¨éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶æ ¼å¼å–ä»£åŸæ¥çš„çº¯æ–‡æœ¬ï¼Œä½¿ç”¨Stream,ä¸€ä¸ªStreamå¯ä»¥åŒ…å«å¤šä¸ªMessage,Messageä¸­å¯ä»¥åŒ…å«å¤šä¸ªFrame,Frameä¸­åŒ…å«Headerså’ŒBody,Streaméƒ½è·‘åœ¨åŒä¸€ä¸ªTCPä¸Šï¼Œå®¢æˆ·ç«¯æ”¶åˆ°åä¼šæ ¹æ®ç›¸åŒçš„Stream ID æœ‰åºç»„è£…æˆHTTPæ¶ˆæ¯ï¼ŒStreamæµç”¨äºå¤šè·¯å¤ç”¨TCP<ul><li>ç¼ºç‚¹æ˜¯ï¼šç”±äºTCPçš„æ˜¯åŸºäºå­—èŠ‚æµçš„ï¼Œå¿…é¡»ä¿è¯æ”¶åˆ°çš„å­—èŠ‚æ•°æ®æ˜¯å®Œæ•´ä¸”æ‹é›ªçš„æ‰èƒ½å°†æ•°æ®è¿”å›ç»™åº”ç”¨å±‚</li></ul></li><li>HTTP/3 ä½¿ç”¨UDPåè®®æ¥è§£å†³å“åº”çš„é˜Ÿå¤´é˜»å¡ã€‚<ol><li>ä½¿ç”¨åŸºäºUDPçš„QUICåè®®ï¼Œä¿è¯ç±»ä¼¼çš„å¯é ä¼ è¾“</li><li>QUIC æœ‰è‡ªå·±çš„ä¸€å¥—æœºåˆ¶å¯ä»¥ä¿è¯ä¼ è¾“çš„å¯é æ€§çš„ã€‚å½“æŸä¸ªæµå‘ç”Ÿä¸¢åŒ…æ—¶ï¼Œåªä¼šé˜»å¡è¿™ä¸ªæµï¼Œå…¶ä»–æµä¸ä¼šå—åˆ°å½±å“ï¼Œå› æ­¤ä¸å­˜åœ¨é˜Ÿå¤´é˜»å¡é—®é¢˜ã€‚è¿™ä¸ HTTP/2 ä¸åŒï¼ŒHTTP/2 åªè¦æŸä¸ªæµä¸­çš„æ•°æ®åŒ…ä¸¢å¤±äº†ï¼Œå…¶ä»–æµä¹Ÿä¼šå› æ­¤å—å½±å“ã€‚</li><li>å½“æŸä¸ªæµä¸¢åŒ…æ—¶ï¼Œåªä¼šé˜»å¡è¿™ä¸ªæµï¼Œå…¶ä»–æµä¸ä¼šé˜»å¡ï¼Œä¸å­˜åœ¨é˜Ÿå¤´é˜»å¡é—®é¢˜</li><li><a href="https://xiaolincoding.com/network/2_http/https_rsa.html#tls-%E6%8F%A1%E6%89%8B%E8%BF%87%E7%A8%8B">RSAç®—æ³•</a>ä¸æ”¯æŒå‰å‘åŠ å¯†ï¼Œåªè¦è·å–æµè§ˆå™¨çš„ç§é’¥ï¼Œå³å¯ç ´è§£</li><li></li></ol></li></ol></li></ul></li><li>HTTPS: <ol><li>ä½¿ç”¨æ··åˆåŠ å¯†ï¼šé€šä¿¡å»ºç«‹å‰ä½¿ç”¨éå¯¹ç§°åŠ å¯†æ¥äº¤æ¢ä¼šè¯å¯†é’¥ï¼Œ é€šä¿¡è¿‡ç¨‹ä¸­ä½¿ç”¨å¯¹ç§°åŠ å¯†çš„ä¼šè¯å¯†é’¥æ¥è¿›è¡Œé€šä¿¡</li><li>å…¬é’¥è¿ç®—å‡ºçš„ç»“æœï¼Œåªæœ‰ä½¿ç”¨ç§é’¥æ¥è¿›è¡Œé€†è¿ç®—å¾—åˆ°ç»“æœã€‚ å‘é€æ—¶ï¼Œå‘é€è€…ä½¿ç”¨æ¥æ”¶è€…çš„å…¬é’¥ï¼Œå…¬é’¥æ˜¯å¯çŸ¥çš„ï¼Œè§£å†³äº†å¯†é’¥äº¤æ¢çš„é—®é¢˜ï¼Œæ¥æ”¶è€…ä½¿ç”¨è‡ªå·±çš„ç§é’¥è¿›è¡Œè§£å¯†ã€‚</li><li>å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼šä¿è¯ä¼ è¾“è¿‡ç¨‹ä¸­å†…å®¹çš„åŠ å¯†</li><li>ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†ï¼šä¿è¯æ¶ˆæ¯ä¸ä¼šè¢«ç¯¡æ”¹ã€‚â€”&gt;æ•°å­—ç­¾åç®—æ³•</li><li>ä½¿ç”¨æƒå¨æœºæ„CA(æ•°å­—è¯ä¹¦è®¤è¯æœºæ„)æ¥ä¿å­˜æ•°å­—è¯ä¹¦ï¼šä¸ªäººä¿¡æ¯+å…¬é’¥+æ•°å­—ç­¾å</li></ol></li><li>TCP<ul><li>ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹<ol><li>å®¢æˆ·ç«¯å‘é€å¸¦æœ‰SYN(åŒæ­¥åºåˆ—)SEQ(åºåˆ—å·) = x  æ ‡å¿—çš„æ•°æ®åŒ…ï¼Œå®¢æˆ·ç«¯è¿›å…¥SYN_SENDçŠ¶æ€</li><li>æœåŠ¡ç«¯å‘é€å¸¦æœ‰SYN(SEQ = y) + ACK (ACK = x + 1) æ ‡å¿—çš„æ•°æ®åŒ…ï¼Œè¿›å…¥SYN_RECVçŠ¶æ€</li><li>å®¢æˆ·ç«¯å‘é€ å¸¦æœ‰ACK(ACK = y + 1) æ ‡å¿—çš„æ•°æ®åŒ…ï¼ŒäºŒè€…è¿›å…¥ESTABLISHEDçŠ¶æ€</li></ol><ul><li>ä¸ºä»€ä¹ˆè¦ç¬¬äºŒæ¬¡ä¼ å›SYN ç”¨äºè¡¨æ˜æ‰€æ”¶åˆ°çš„æ˜¯å¯¹åº”çš„å®¢æˆ·ç«¯å‘é€çš„ä¿¡å·</li></ul></li><li>å››æ¬¡æŒ¥æ‰‹:<ol><li>å®¢æˆ·ç«¯å‘é€FIN(SEQ = x) ï¼Œè¿›å…¥FIN-WAIT-1çŠ¶æ€</li><li>æœåŠ¡ç«¯å‘é€ACK(ACK=x+1) è¿›å…¥CLOSE-WAITçŠ¶æ€ï¼Œå®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-2</li><li>æœåŠ¡ç«¯å‘é€FIN(SEQ=y) è¯·æ±‚å…³é—­,è¿›å…¥LAST-ACK</li><li>å®¢æˆ·ç«¯å‘é€ï¼ŒACK(ACK=y+1) ï¼Œå®¢æˆ·ç«¯è¿›å…¥TIME-WAITï¼ŒæœåŠ¡ç«¯æ¥æ”¶åè¿›å…¥CLOSEï¼Œå®¢æˆ·ç«¯ç­‰å¾…ä¸€æ®µæ—¶é—´ä¹‹åå¦‚æœæ²¡æœ‰æ”¶åˆ°å›å¤ï¼Œå°±å…³é—­å®¢æˆ·ç«¯ã€‚</li></ol></li><li>å¯ä¸å¯ä»¥æŠŠACKå’ŒFINåˆå¹¶èµ·æ¥å˜æˆä¸‰æ¬¡æŒ¥æ‰‹ï¼š ä¸è¡Œï¼Œå› ä¸ºæœåŠ¡å™¨æ”¶åˆ°æ–­å¼€è¯·æ±‚æ—¶ï¼Œå¯èƒ½è¿˜æœ‰ä¸€äº›æ•°æ®æ²¡æœ‰ä¼ è¾“å®Œæˆï¼Œæ‰€ä»¥å…ˆå‘é€ACKè¡¨æ˜æ”¶åˆ°è¯·æ±‚ï¼Œç­‰å¾…æ‰€æœ‰æ•°æ®å‘é€å®Œæˆä¹‹åå‘é€FINæ–­å¼€è¿æ¥</li></ul></li><li>IP<ul><li>DNS:åŸŸåè§£æï¼š</li><li>DHCPï¼ˆåŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼‰æ˜¯ä¸€ä¸ªç½‘ç»œåè®®ï¼Œç”¨äºè‡ªåŠ¨åˆ†é… IP åœ°å€å’Œå…¶ä»–ç›¸å…³é…ç½®ä¿¡æ¯ç»™ç½‘ç»œä¸­çš„è®¾å¤‡ã€‚è¿™ä½¿å¾—è®¾å¤‡å¯ä»¥åœ¨åŠ å…¥ç½‘ç»œæ—¶è‡ªåŠ¨è·å–ç½‘ç»œé…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®ã€‚</li><li>ARPå·¥ä½œåŸç†ï¼šå¹¿æ’­é—®è¯¢ï¼Œå•æ’­å“åº”<ul><li>ä¸€ä¸ªå±€åŸŸç½‘ä¸­<ol><li>ç»´æŠ¤ä¸€ä¸ªARPè¡¨ &lt;IP,MAC,TTL&gt;</li><li>æŸ¥è¯¢ARPè¡¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ„é€ ä¸€ä¸ªARPæŸ¥è¯¢åˆ†ç»„ï¼Œå°†å…¶å¹¿æ’­åˆ°å±€åŸŸç½‘ä¸­ï¼ŒMACåœ°å€ä¸ºå¹¿æ’­åœ°å€ï¼Œç„¶åå¸Œæœ›æ”¶åˆ°çš„æ˜¯IPåœ°å€</li><li>è®¾å¤‡æ¥æ”¶åæŸ¥è¯¢æ˜¯å¦ä¸ºè‡ªå·±çš„IPï¼Œå¦‚æœä¸æ˜¯åˆ™ä¸¢å¼ƒï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ„é€ ARPå“åº”åˆ†ç»„ï¼Œå‘é€ç»™æŸ¥è¯¢ä¸»æœºï¼Œå¹¶åœ¨è‡ªå·±çš„è¡¨ä¸­æ„é€ ä¸€æ¡æŸ¥è¯¢ä¸»æœºçš„IP-MACæ˜ å°„è¡¨ï¼Œä½¿ç”¨çš„æ˜¯å•æ’­ï¼Œä¸å†å¹¿æ’­</li><li>æŸ¥è¯¢çš„ä¸»æœºæ¥å—åï¼Œå°†å…¶åŠ å…¥ARPè¡¨ä¸­</li></ol></li><li>ä¸åœ¨ä¸€ä¸ªå±€åŸŸç½‘ä¸­ï¼šé€šè¿‡è·¯ç”±å™¨è½¬å‘æŸ¥è¯¢</li></ul></li><li>NAT:åŒä¸€ä¸ªåœºæ™¯ä¸‹å°†ç§æœ‰IPè½¬åŒ–ä¸ºå…±æœ‰IPåœ°å€</li><li>ICMPï¼šäº’è”ç½‘æ§åˆ¶æŠ¥æ–‡åè®®ï¼Œç¡®è®¤IpåŒ…æ˜¯å¦<ul><li>pingï¼šåŸºäºICMPåè®®å·¥ä½œçš„ï¼Œä½¿ç”¨çš„ICMPç±»å‹ä¸­0å’Œ8ï¼Œä¹Ÿå°±æ˜¯å›é€åº”ç­”å’Œä¼šé€è¯·æ±‚ï¼Œæ ¹æ®è¿™ä¸ªæ¥åˆ¤æ–­æ˜¯å¦åˆ°è¾¾IPåœ°å€ï¼Œå¦‚æœè·¯ç”±å™¨ä¸­é—´æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„æ¥æ”¶ç«¯IPå°±ä¼šå¾€å‘é€ç«¯IPå‘é€ICMPæŠ¥æ–‡ï¼Œ8æ˜¯æºä¸»æœºå‘ç›®æ ‡ä¸»æœºçš„å‘é€çš„è¯·æ±‚ï¼Œ0æ˜¯ç›®æ ‡ä¸»æœºçš„å›åº”</li><li>å„ç§æœ¬åœ°IPä»£æŒ‡çš„åŒºåˆ«ï¼š<ol><li>localhost é»˜è®¤å°±æ˜¯åŒäº127.0.0.1ï¼Œä½†æ˜¯å¯ä»¥ä¿®æ”¹ï¼Œæ˜¯å±äºåŸŸå</li><li>0.0.0.0 IPv4ä¸­æ˜¯æ— æ•ˆåœ°å€ï¼Œä»£æŒ‡çš„æ˜¯å¹¿æ’­ï¼Œç›‘å¬æœ¬åœ°çš„0.0.0.0æ—¶ï¼Œä»£è¡¨çš„ç›‘å¬æœ¬æœºä¸Šæ‰€æœ‰çš„IPv4åœ°å€</li><li>127.0.0.1æ˜¯å›ç¯åœ°å€</li></ol></li></ul></li><li>IGMPï¼šInternetç»„ç®¡ç†åè®®ï¼Œå·¥ä½œå“ä¸»æœºå’Œæœ€åä¸€è·³çš„è·¯ç”±ä¹‹é—´ã€‚</li><li>ä¸ºä½•æ–­ç½‘äº†ä¹Ÿèƒ½pingé€š127.0.0.1? å› ä¸ºä¼šæŠŠæ¶ˆæ¯äº¤ç»™æœ¬åœ°ç½‘å¡ï¼Œæœ¬åœ°ç½‘å¡ç›´æ¥æŠŠæ¶ˆæ¯å‘é€åˆ°æœ¬æœºæ¥å—åˆ°çš„æ¶ˆæ¯é“¾è¡¨ä¸­å¹¶è§¦å‘è½¯ä¸­æ–­ï¼Œç”±å†…æ ¸çº¿ç¨‹æ¥ä¼ é€’ç»™ä¸Šå±‚åº”ç”¨ç¨‹åº</li></ul></li></ul><h2 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h2><p>åˆ†ç±»</p><h2 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h2><h2 id="å¦‚ä½•è§£å†³ç²˜åŒ…é—®é¢˜"><a href="#å¦‚ä½•è§£å†³ç²˜åŒ…é—®é¢˜" class="headerlink" title="å¦‚ä½•è§£å†³ç²˜åŒ…é—®é¢˜"></a>å¦‚ä½•è§£å†³ç²˜åŒ…é—®é¢˜</h2><p>æ‰¾åˆ°æ¶ˆæ¯çš„è¾¹ç•Œå°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜</p><ol><li>å›ºå®šé•¿åº¦</li><li>ç‰¹æ®Šå­—ç¬¦ä½œä¸ºè¾¹ç•Œ</li><li>è‡ªå®šä¹‰æ¶ˆæ¯ç»“æ„</li></ol><h3 id="é‡ä¼ æœºåˆ¶"><a href="#é‡ä¼ æœºåˆ¶" class="headerlink" title="é‡ä¼ æœºåˆ¶"></a>é‡ä¼ æœºåˆ¶</h3><p>é‡ä¼ æ˜¯ç”±åºåˆ—å·å’Œç¡®è®¤åº”ç­”æ¥æ§åˆ¶çš„</p><ol><li>è¶…æ—¶é‡ä¼ ï¼ŒTCPçš„è¶…æ—¶é‡ä¼ ç­–ç•¥æ˜¯é—´éš”æ—¶é—´æ¯æ¬¡éƒ½è®¾ç½®ä¸ºå…ˆå‰å€¼çš„ä¸¤å€ï¼Œå¦‚æœå‡ºç°ä¸¤æ¬¡è¶…æ—¶ï¼Œè¯´æ˜ç½‘ç»œç¯å¢ƒå·®ï¼Œä¸ä¼šé‡ä¼ äº†</li><li>å¿«é€Ÿé‡ä¼ ï¼šå½“æ”¶åˆ°ä¸‰ä¸ªç›¸åŒACKæŠ¥æ–‡æ—¶ï¼Œè¯´æ˜å‡ºç°äº†ä¸¢åŒ…ï¼Œä¼šé‡ä¼ ä¸¢å¤±çš„æŠ¥æ–‡ã€‚</li></ol><h3 id="æ»‘åŠ¨çª—å£-4-2-TCP-é‡ä¼ ã€æ»‘åŠ¨çª—å£ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶-å°æ—coding-xiaolincoding-com"><a href="#æ»‘åŠ¨çª—å£-4-2-TCP-é‡ä¼ ã€æ»‘åŠ¨çª—å£ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶-å°æ—coding-xiaolincoding-com" class="headerlink" title="[æ»‘åŠ¨çª—å£](4.2 TCP é‡ä¼ ã€æ»‘åŠ¨çª—å£ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ | å°æ—coding (xiaolincoding.com))"></a>[æ»‘åŠ¨çª—å£](<a href="https://xiaolincoding.com/network/3_tcp/tcp_feature.html#%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6">4.2 TCP é‡ä¼ ã€æ»‘åŠ¨çª—å£ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ | å°æ—coding (xiaolincoding.com)</a>)</h3><p>TCPå¤´ä¸­æœ‰ä¸€ä¸ªWindowå­—æ®µï¼Œä»£è¡¨æ»‘åŠ¨çª—å£å¤§å°ã€‚è¡¨ç¤ºæ¥å—æ–¹å‘Šè¯‰å¯¹æ–¹è‡ªå·±è¿˜æœ‰å¤šå°‘ç¼“å†²åŒºå¯ä»¥æ¥å—æ•°æ®ã€‚</p><h4 id="å‘é€æ–¹çª—å£"><a href="#å‘é€æ–¹çª—å£" class="headerlink" title="å‘é€æ–¹çª—å£"></a>å‘é€æ–¹çª—å£</h4><p><img src="/2023/10/23/46/%E5%8F%91%E9%80%81%E6%96%B9%E7%AA%97%E5%8F%A3.png"></p><h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><p>HTTPæ˜¯ä¸€ä¸ªåœ¨è®¡ç®—æœºä¸–ç•Œä¸­ä¸“é—¨åœ¨äº®ç‚¹ä¹‹é—´ä¼ è¾“æ–‡å­—ã€å›¾ç‰‡ç­‰è¶…æ–‡æœ¬çš„çº¦å®šä¸è§„èŒƒ</p><h3 id="å¸¸è§çš„çŠ¶æ€ç "><a href="#å¸¸è§çš„çŠ¶æ€ç " class="headerlink" title="å¸¸è§çš„çŠ¶æ€ç "></a>å¸¸è§çš„çŠ¶æ€ç </h3><ol><li>1xx æ˜¯ä¸€ç§ä¸­é—´çŠ¶æ€ï¼Œå®é™…ä½¿ç”¨è¾ƒå°‘</li><li>2xx è¡¨ç¤ºæœåŠ¡å™¨æˆåŠŸå¤„ç†äº†è¯·æ±‚<ul><li>200 OK</li><li>204 No Content ä¸200åŸºæœ¬ç›¸åŒï¼Œä½†æ˜¯å“åº”å¤´æ²¡æœ‰bodyæ•°æ®</li><li>206 Partial Contentè¡¨ç¤ºå“åº”è¿”å›çš„bodyæ•°æ®å¹¶ä¸æ˜¯èµ„æºçš„å…¨éƒ¨ã€‚</li></ul></li><li>3xx é‡å®šå‘<ul><li>301 æ°¸ä¹…é‡å®šå‘</li><li>302 Found ä¸´æ—¶é‡å®šå‘ï¼Œæ³¨æ„301å’Œ302éƒ½ä¼šåœ¨å“åº”å¤´ä¸­ä½¿ç”¨Locationå­—æ®µçŸ¥ååç»­éœ€è¦è·³è½¬çš„URLï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨é‡å®šå‘åˆ°æ–°çš„URL</li><li>304  èµ„æºæœªä¿®æ”¹ï¼Œå¯ä»¥ä½¿ç”¨ç¼“å­˜èµ„æº</li></ul></li><li>4xx å®¢æˆ·ç«¯å‘é€çš„æŠ¥æ–‡æœ‰è¯¯<ul><li>400 è¯·æ±‚æœ‰è¯¯ï¼Œç¬¼ç»Ÿçš„é”™è¯¯</li><li>403 æœåŠ¡å™¨ç¦æ­¢è®¿é—®èµ„æº</li><li>404 æœåŠ¡å™¨ä¸å­˜åœ¨æˆ–æœªæ‰¾åˆ°</li></ul></li><li>5xx å®¢æˆ·ç«¯è¯·æ±‚æŠ¥æ–‡æ­£ç¡®ï¼Œä½†æ˜¯æœåŠ¡å™¨å¤„ç†æ—¶ï¼Œå†…éƒ¨å‡ºç°äº†é”™è¯¯ï¼Œå±äºæœåŠ¡ç«¯é”™è¯¯ç <ul><li>500 ç¬¼ç»Ÿé”™è¯¯</li><li>501 å®¢æˆ·ç«¯è¯·æ±‚åŠŸèƒ½ä¸æ”¯æŒï¼Œæ•¬è¯·æœŸå¾…</li><li>502 ç½‘å…³é”™è¯¯</li><li>503 æœåŠ¡å™¨ç¹å¿™ï¼Œæ— æ³•å’±æ˜¯æ— æ³•å“åº”å®¢æˆ·ç«¯ã€‚</li></ul></li></ol><h3 id="HTTPç¼“å­˜"><a href="#HTTPç¼“å­˜" class="headerlink" title="HTTPç¼“å­˜"></a>HTTPç¼“å­˜</h3><ol><li>å¼ºåˆ¶ç¼“å­˜ï¼šæµè§ˆå™¨åˆ¤æ–­ç¼“å­˜æ²¡è¿‡æœŸå°±å¼ºåˆ¶ä½¿ç”¨æœ¬åœ°ç¼“å­˜ã€‚ä½¿ç”¨çš„æ˜¯Cache-Controlå’ŒExpiresï¼Œç¬¬ä¸€ä¸ªæ˜¯ç›¸å¯¹æ—¶é—´ï¼Œç¬¬äºŒä¸ªæ˜¯ç»å¯¹æ—¶é—´ã€‚ç¬¬ä¸€ä¸ªä¼˜å…ˆçº§æ›´é«˜ã€‚<ul><li>æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œä¼šåŠ ä¸Šè¿™ä¸ªè¿‡æœŸæ—¶é—´</li><li>å†æ¬¡è¯·æ±‚æ—¶ï¼Œæ ¹æ®è¯·æ±‚æ—¶é—´å’Œè¿™ä¸ªè¿‡æœŸæ—¶é—´è¿›è¡Œæ¯”è¾ƒï¼Œæ¥åˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼Œå¹¶ä¸”æ›´æ–°è¿™ä¸ªæ—¶é—´</li></ul></li><li>åå•†ç¼“å­˜ï¼š ä¸æœåŠ¡å™¨åå•†ä¹‹åï¼Œé€šè¿‡åå•†ç»“æœæ¥åˆ¤æ–­æ˜¯å¦ä½¿ç”¨æœ¬åœ°ç¼“å­˜ã€‚<img src="/2023/10/23/46/%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98.png"></li></ol><h2 id="ä¸åŒç‰ˆæœ¬çš„HTTPç‰¹ç‚¹"><a href="#ä¸åŒç‰ˆæœ¬çš„HTTPç‰¹ç‚¹" class="headerlink" title="ä¸åŒç‰ˆæœ¬çš„HTTPç‰¹ç‚¹"></a>ä¸åŒç‰ˆæœ¬çš„HTTPç‰¹ç‚¹</h2><p>HTTP: 80<br>HTTPS: 443</p><h3 id="HTTPçš„è¿­ä»£å’Œå¯¹æ¯”"><a href="#HTTPçš„è¿­ä»£å’Œå¯¹æ¯”" class="headerlink" title="HTTPçš„è¿­ä»£å’Œå¯¹æ¯”"></a>HTTPçš„è¿­ä»£å’Œå¯¹æ¯”</h3><h4 id="HTTP1-1çš„è¿›æ­¥å’Œç¼ºç‚¹"><a href="#HTTP1-1çš„è¿›æ­¥å’Œç¼ºç‚¹" class="headerlink" title="HTTP1.1çš„è¿›æ­¥å’Œç¼ºç‚¹"></a>HTTP1.1çš„è¿›æ­¥å’Œç¼ºç‚¹</h4><p>è¿›æ­¥ï¼š</p><ol><li>é•¿è¿æ¥</li><li>æ”¯æŒç®¡é“ç½‘ç»œä¼ è¾“<br>ç¼ºç‚¹ï¼š</li><li>Headeréƒ¨åˆ†æœªç»å‹ç¼©å°±å‘é€ï¼Œå»¶è¿Ÿå¤§ï¼Œåªèƒ½å‹ç¼©Bodyéƒ¨åˆ†</li><li>ä¼šå‡ºç°é˜Ÿå¤´é˜»å¡ï¼šæœåŠ¡ç«¯ç›¸åº”æ…¢ï¼Œå¯¼è‡´åç»­çš„è¯·æ±‚ä¸èƒ½åŠæ—¶å‘é€</li><li>è¯·æ±‚åªèƒ½ä»å®¢æˆ·ç«¯å¼€å§‹</li></ol><h4 id="HTTP-x2F-2"><a href="#HTTP-x2F-2" class="headerlink" title="HTTP/2"></a>HTTP/2</h4><p>è¿›æ­¥ï¼š</p><ol><li>HTTP/2æ˜¯åŸºäºHTTPSï¼Œå®‰å…¨æœ‰ä¿è¯</li><li>é˜Ÿå¤´å‹ç¼©ï¼šå¦‚æœåŒæ—¶å‘å‡ºå¤šä¸ªè¯·æ±‚ï¼Œä»–ä»¬çš„è¯·æ±‚å¤´æ˜¯ä¸€æ ·çš„æˆ–è€…æ˜¯ç›¸ä¼¼çš„ï¼Œå°±ä¼šæ¶ˆé™¤é‡å¤çš„éƒ¨åˆ†ï¼ŒåŸç†æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ—¶ç»´æŠ¤ä¸€å¼ å¤´ä¿¡æ¯è¡¨ï¼Œæ‰€æœ‰å­—æ®µéƒ½ä¼šå­˜åœ¨é‡Œé¢æ¥è¿›è¡Œç´¢jå¼•</li><li>äºŒè¿›åˆ¶æ ¼å¼ï¼šæŠ¥æ–‡ä½¿ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨çº¯æ–‡æœ¬çš„æ ¼å¼</li><li>å¹¶å‘ä¼ è¾“</li><li>æœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨æ¨é€èµ„æº</li></ol><h3 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h3><blockquote><p>HTTPSæ˜¯åœ¨TCPå’ŒHTTPä¹‹é—´åŠ å…¥äº†SSL/TLSå®‰å…¨åè®®</p></blockquote><h4 id="æ ¸å¿ƒ"><a href="#æ ¸å¿ƒ" class="headerlink" title="æ ¸å¿ƒ"></a>æ ¸å¿ƒ</h4><ol><li>æ··åˆåŠ å¯†ï¼šå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†çš„æ··åˆåŠ å¯†æ–¹å¼ï¼Œé€šä¿¡å»ºç«‹ä¹‹å‰ä½¿ç”¨çš„æ˜¯éå¯¹ç§°åŠ å¯†ï¼Œå»ºç«‹ä¹‹åé€šä¿¡ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†ï¼Œå¯¹ç§°åŠ å¯†åªéœ€è¦ä½¿ç”¨ä¸€ä¸ªå¯†é’¥ï¼Œæ‰€ä»¥æ›´åŠ é«˜æ•ˆã€‚</li><li>æ‘˜è¦ç®—æ³• + æ•°å­—ç­¾åï¼šé€šè¿‡æ‘˜è¦ç®—æ³•è·å¾—å“ˆå¸Œå€¼ï¼Œæ¥åˆ¤æ–­æŠ¥æ–‡æ˜¯å¦è¢«ä¿®æ”¹ã€‚è€Œæ•°å­—ç­¾ååˆ™èƒ½ä¿è¯é€šä¿¡åŒæ–¹çš„èº«ä»½</li><li>æ•°å­—è¯ä¹¦ï¼šå¯ä¿¡çš„ç¬¬ä¸‰æ–¹æ¥ä¿è¯åŒæ–¹èº«ä»½ï¼Œä¸»è¦æ˜¯CAé€šè¿‡ç§é’¥åŠ å¯†åŒæ–¹çš„å…¬é’¥æ•°å­—ç­¾åï¼Œç„¶åCAçš„å…¬é’¥æ˜¯å…¬å¼€çš„ï¼Œä¹‹åå¦ä¸€æ–¹é€šè¿‡CAçš„å…¬é’¥è§£å¯†è·å¾—å¯¹æ–¹çš„å…¬é’¥ï¼Œä¹‹åå¯¹æ–¹ä½¿ç”¨ç§é’¥åŠ å¯†ï¼Œå°±å¯ä»¥ä½¿ç”¨å…¬é’¥è¿›è¡Œè§£å¯†äº†æˆ–è€…æ˜¯åŠ å¯†é€šä¿¡ã€‚<img src="/2023/10/23/46/CA%E7%AE%97%E6%B3%95.png"></li></ol><h4 id="éå¯¹ç§°åŠ å¯†"><a href="#éå¯¹ç§°åŠ å¯†" class="headerlink" title="éå¯¹ç§°åŠ å¯†"></a>éå¯¹ç§°åŠ å¯†</h4><ol><li>å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼šä¿è¯å†…å®¹çš„å®‰å…¨ï¼Œåªæœ‰ç§é’¥å¯ä»¥è§£å¯†å†…å®¹</li><li>ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†ï¼šä¿è¯æ¶ˆæ¯ä¸å¯å†’å……ï¼Œå› ä¸ºç§é’¥æ˜¯ä¸å¯ä»¥æ³„æ¼çš„ï¼ŒéªŒè¯åŒæ–¹èº«ä»½ï¼Œä¹Ÿå°±æ˜¯æ•°å­—ç­¾åç®—æ³•<img src="/2023/10/23/46/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95.png" alt="|525"></li></ol><h4 id="æµç¨‹-RSAç®—æ³•ä¸ºä¾‹"><a href="#æµç¨‹-RSAç®—æ³•ä¸ºä¾‹" class="headerlink" title="æµç¨‹(RSAç®—æ³•ä¸ºä¾‹)"></a>æµç¨‹(RSAç®—æ³•ä¸ºä¾‹)</h4><ol><li>ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹TCPè¿æ¥</li><li>å®¢æˆ·ç«¯å‘é€ClientHelloè¯·æ±‚ï¼Œæºå¸¦å®¢æˆ·ç«¯æ”¯æŒçš„TLSç‰ˆæœ¬ä¿¡æ¯å’Œå®¢æˆ·ç«¯éšæœºæ•°Client Randomï¼Œæ”¯æŒçš„å¯†ç å¥—ä»¶åˆ—è¡¨(æ¯”å¦‚RSAç®—æ³•)</li><li>ServerHelloå“åº”ï¼šç¡®å®šTLSç‰ˆæœ¬ï¼Œæµè§ˆå™¨ä¸æ”¯æŒå°±æ–­å¼€ï¼ŒæœåŠ¡å™¨éšæœºæ•°Server Randomï¼Œ ä½¿ç”¨çš„åŠ å¯†ç®—æ³•ï¼ŒæœåŠ¡å™¨çš„æ•°å­—è¯ä¹¦</li><li>å®¢æˆ·ç«¯ä½¿ç”¨CAçš„å…¬é’¥ç¡®å®šè¯ä¹¦çš„çœŸå®æ€§ï¼Œä¹‹åå–å‡ºå…¬é’¥ï¼ŒåŠ å¯†æŠ¥æ–‡å‘é€ï¼š1. éšæœºæ•° pre-master key 2.åŠ å¯†é€šä¿¡ç®—æ³•æ”¹å˜é€šçŸ¥ï¼Œè¡¨ç¤ºä¹‹åéƒ½å°†ä½¿ç”¨ä¼šè¯å¯†é’¥(å¯¹ç§°åŠ å¯†)è¿›è¡Œé€šä¿¡ï¼Œå®¢æˆ·ç«¯æ¡æ‰‹ç»“æŸé€šçŸ¥ï¼ŒæŠŠä¹‹å‰æ‰€æœ‰çš„å†…å®¹è¿›è¡Œæ‘˜è¦ï¼Œç»™æœåŠ¡å™¨è¿›è¡Œæ ¡éªŒ</li><li>åŒæ–¹ä½¿ç”¨è¿™ä¸‰ä¸ªéšæœºæ•°å’ŒåŠ å¯†ç®—æ³•ç”Ÿæˆä¼šè¯å¯†é’¥</li><li>æœåŠ¡å™¨æœ€å1.åŠ å¯†ç®—æ³•æ”¹å˜ 2.æ¡æ‰‹ç»“æŸï¼Œç”Ÿæˆæ‘˜è¦ä¾›å®¢æˆ·ç«¯æ ¡éªŒ</li></ol><h3 id="HTTP-x2F-1-1"><a href="#HTTP-x2F-1-1" class="headerlink" title="HTTP/1.1"></a>HTTP/1.1</h3><h4 id="ä¼˜ç‚¹å’Œç¼ºç‚¹"><a href="#ä¼˜ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>ä¼˜ç‚¹å’Œç¼ºç‚¹</h4><p>åŒåˆƒå‰‘ï¼šæ— çŠ¶æ€ã€æ˜æ–‡ä¼ è¾“<br>ç¼ºç‚¹ï¼šä¸å®‰å…¨</p><ul><li>æ— çŠ¶æ€å¯ä»¥ä½¿å¾—æµè§ˆå™¨ä¸éœ€è¦é¢å¤–è®°å¿†HTTPçš„çŠ¶æ€ï¼Œç¼ºç‚¹æ˜¯å¤„ç†æœ‰å…³è”æ€§çš„æ“ä½œæ—¶ä¼šå¾ˆéº»çƒ¦<ul><li>è§£å†³æ–¹å¼å°±æ˜¯ä½¿ç”¨Cookie</li></ul></li><li>æ˜æ–‡ä¼ è¾“ï¼šæ–¹ä¾¿è°ƒè¯•çš„åŒæ—¶ä¸å®‰å…¨</li><li>ä¸å®‰å…¨ï¼š1. æ˜æ–‡ä¼ è¾“2.ä¸éªŒè¯é€šä¿¡åŒæ–¹çš„èº«ä»½3.ä¸èƒ½è¯æ˜æŠ¥æ–‡çš„å®Œæ•´æ€§ <ul><li>è§£å†³æ–¹å¼ä½¿ç”¨HTTPS</li></ul></li></ul><h4 id="æ€§èƒ½-é•¿è¿æ¥"><a href="#æ€§èƒ½-é•¿è¿æ¥" class="headerlink" title="æ€§èƒ½(é•¿è¿æ¥)"></a>æ€§èƒ½(é•¿è¿æ¥)</h4><ol><li>ç›¸æ¯”è¾ƒäº1.0ï¼Œ1.1ä½¿ç”¨äº†é•¿è¿æ¥ï¼Œä¸€æ¬¡TCPè¿æ¥å‘èµ·å¤šæ¬¡è¯·æ±‚</li><li>å¯ä»¥ä½¿ç”¨ç®¡é“é€šä¿¡ï¼Œåªè¦è¯·æ±‚å‘é€å‡ºå»åï¼Œä¸éœ€è¦ç­‰å¾…å“åº”ç»“æœå³å¯å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚<br>è§£å†³äº†è¯·æ±‚çš„é˜Ÿå¤´é˜»å¡ï¼Œä½†æ˜¯æ²¡æœ‰è§£å†³å“åº”çš„é˜Ÿå¤´é˜»å¡ï¼ŒåŒæ—¶ä¸æ˜¯é»˜è®¤ä½¿ç”¨çš„<blockquote><p>é˜Ÿå¤´é˜»å¡æ˜¯æŒ‡å½“ä¸€ä¸ªè¯·æ±‚å› ä¸ºæŸç§åŸå› è¢«é˜»å¡ï¼Œä¼šå¯¼è‡´åé¢æ’é˜Ÿçš„æ‰€æœ‰è¯·æ±‚éƒ½ä¸€åŒè¢«é˜»å¡</p></blockquote></li></ol><h2 id="è®¡ç½‘å¸¸é—®"><a href="#è®¡ç½‘å¸¸é—®" class="headerlink" title="è®¡ç½‘å¸¸é—®"></a>è®¡ç½‘å¸¸é—®</h2><h3 id="ä¸€ä¸ªè¯·æ±‚æ•´ä¸ªç½‘ç»œçš„å¤„ç†"><a href="#ä¸€ä¸ªè¯·æ±‚æ•´ä¸ªç½‘ç»œçš„å¤„ç†" class="headerlink" title="ä¸€ä¸ªè¯·æ±‚æ•´ä¸ªç½‘ç»œçš„å¤„ç†"></a>ä¸€ä¸ªè¯·æ±‚æ•´ä¸ªç½‘ç»œçš„å¤„ç†</h3><ol><li>æµè§ˆå™¨è§£æURLç”ŸæˆHTTPæ¶ˆæ¯</li><li>é€šè¿‡DNSè§£æè·å¾—IPåœ°å€</li><li>ä¹‹åå°†HTTPçš„ä¼ è¾“å·¥ä½œé€šè¿‡è°ƒç”¨Socketåº“äº¤ç»™æ“ä½œç³»ç»Ÿçš„åè®®æ ˆ</li><li>TCPç®€å†é“¾æ¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¿è¯åŒæ–¹éƒ½æœ‰å‘é€å’Œæ¥æ”¶çš„èƒ½åŠ›</li><li>å»ºç«‹è¿æ¥ä¹‹åï¼ŒTCPæŠ¥æ–‡ä¸­çš„æ•°æ®éƒ¨åˆ†å°±æ˜¯å­˜æ”¾HTTPå¤´éƒ¨+æ•°æ®ï¼Œç»„è£…å¥½TCPæŠ¥æ–‡ä¹‹åï¼Œäº¤ç»™ä¸‹é¢çš„ç½‘ç»œå±‚å¤„ç†</li><li>IPåè®®é‡Œéœ€è¦æºåœ°å€å’Œç›®çš„åœ°å€IPï¼Œå­˜åœ¨å¤šä¸ªç½‘å¡æ—¶ï¼Œéœ€è¦æ ¹æ®è·¯ç”±è¡¨è§„åˆ™ã€‚</li><li>ç”ŸæˆIPå¤´éƒ¨ä¹‹åï¼Œéœ€è¦åœ¨å‰é¢åŠ ä¸ŠMACå¤´éƒ¨ï¼Œæ¥æ”¶æ–¹çš„MACåœ°å€é€šè¿‡ARPåè®®è·å¾—ï¼Œå¹¶ä¸”æ”¾å…¥ARPç¼“å­˜</li><li>ç½‘å¡é©±åŠ¨è·å¾—ç½‘ç»œåŒ…ï¼Œå°†å…¶å¤åˆ¶åˆ°ç½‘å¡å†…çš„ç¼“å­˜åŒºä¸­ï¼Œä»å¼€å¤´åŠ ä¸ŠåŒ…å¤´å’Œèµ·å§‹å¸§åˆ†èŠ‚ç¬¦ï¼Œæœ«å°¾åŠ ä¸Šç”¨äºæ ¡éªŒé”™è¯¯çš„å¸§æ ¡éªŒåºåˆ—ã€‚ä¹‹åç½‘å¡å°†åŒ…è½¬ä¸ºç”µä¿¡å·ï¼Œé€šè¿‡ç½‘çº¿å‘é€</li><li>ç”µä¿¡å·åˆ°è¾¾ç½‘çº¿æ¥å£ï¼Œäº¤æ¢æœºé‡Œçš„æ¨¡å—è¿›è¡Œæ¥æ”¶ã€‚ä¹‹åå°†ç”µä¿¡å·è½¬åŒ–ä¸ºæ•°å­—ä¿¡å·ã€‚FCSæ ¡éªŒæ²¡é—®é¢˜åæ”¾å…¥ç¼“å†²åŒºï¼Œä¹‹åæŸ¥è¯¢MACåœ°å€ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±å‘é™¤äº†æºç«¯å£çš„æ‰€æœ‰ç«¯å£ã€‚</li><li>ç”µä¿¡å·åˆ°è¾¾â½¹çº¿æ¥â¼éƒ¨åˆ†ï¼Œè·¯ç”±å™¨ä¸­çš„æ¨¡å—ä¼šå°†ç”µä¿¡å·è½¬æˆæ•°å­—ä¿¡å·ï¼Œ FCS è¿›â¾é”™è¯¯æ ¡éªŒæ²¡é—®é¢˜åç¡®è®¤æ¥æ”¶â½…MACåœ°å€ï¼Œç„¶åå»æ‰MACå¤´éƒ¨ï¼ŒæŸ¥è¯¢è·¯ç”±è¡¨åˆ¤æ–­è½¬å‘â½¬æ ‡ï¼Œå¦‚æœâ½¹å…³ä¸ºç©ºåˆ™ IP å¤´éƒ¨ä¸­çš„æ¥æ”¶â½… IP åœ°å€å°±æ˜¯è¦è½¬å‘åˆ°çš„â½¬æ ‡åœ°å€</li><li>çŸ¥é“å¯¹â½…çš„ IP åœ°å€ä¹‹åï¼Œæ¥ä¸‹æ¥éœ€è¦é€šè¿‡ ARP åè®®æ ¹æ® IP åœ°å€æŸ¥è¯¢ MAC åœ°å€ï¼ŒåŠ ä¸ŠMACå¤´éƒ¨ï¼Œå‘é€â½¹ç»œåŒ…ï¼Œé€šè¿‡äº¤æ¢æœºåˆ°è¾¾ä¸‹â¼€ä¸ªè·¯ç”±å™¨</li><li>æœ€åæ•°æ®åŒ…æŠµè¾¾äº†æœåŠ¡å™¨</li></ol><h3 id="IPv6ä¼˜ç‚¹"><a href="#IPv6ä¼˜ç‚¹" class="headerlink" title="IPv6ä¼˜ç‚¹"></a>IPv6ä¼˜ç‚¹</h3><ol><li>æ›´â¼¤çš„åœ°å€ç©ºé—´ï¼šIPv6å°†åœ°å€â»“åº¦ä»IPv4çš„32ä½æ‰©å±•åˆ°äº†128ä½ï¼Œç†è®ºä¸Šå¯ä»¥åˆ†é…â¼¤çº¦3.4x10^38ä¸ªå”¯â¼€çš„IPåœ°å€ã€‚</li><li>ç®€åŒ–çš„æŠ¥â½‚æ ¼å¼ï¼šIPv6å¤´éƒ¨æ ¼å¼æ›´ä¸ºç®€æ´ï¼Œå‡å°‘äº†å¤„ç†çš„å¤æ‚æ€§ï¼Œæâ¾¼äº†è·¯ç”±æ•ˆç‡ã€‚</li><li>æ”¹è¿›çš„æœåŠ¡è´¨é‡ï¼ˆQoSï¼‰ï¼šIPv6â½€æŒæ›´å¥½çš„æµé‡åˆ†ç±»å’Œä¼˜å…ˆçº§å¤„ç†ï¼Œæœ‰åŠ©äºæä¾›æ›´åŠ å¯é çš„æœåŠ¡è´¨é‡ã€‚</li><li>å†…å»ºçš„å®‰å…¨æœºåˆ¶ï¼šIPv6åŸâ½£â½€æŒIPsecï¼ˆâ½¹ç»œå®‰å…¨åè®®ï¼‰ï¼Œä¸ºæ•°æ®ä¼ è¾“æä¾›äº†ç«¯åˆ°ç«¯çš„åŠ å¯†å’Œè®¤è¯ã€‚</li><li>â¾ƒåŠ¨é…ç½®èƒ½â¼’ï¼šIPv6â½€æŒæœ‰çŠ¶æ€å’Œâ½†çŠ¶æ€çš„åœ°å€â¾ƒåŠ¨é…ç½®ï¼ˆSLAACï¼‰ï¼Œç®€åŒ–äº†â½¹ç»œè®¾å¤‡çš„é…ç½®å’Œç®¡ç†</li></ol><h3 id="BGPã€OSPFåè®®åŸç†"><a href="#BGPã€OSPFåè®®åŸç†" class="headerlink" title="BGPã€OSPFåè®®åŸç†"></a>BGPã€OSPFåè®®åŸç†</h3><blockquote><p>è¾¹ç•Œâ½¹å…³åè®®(Border Gateway Protocolï¼Œç®€ç§°BGP)å’Œå¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆåè®®(Open Shortest Path<br>Firstï¼Œç®€ç§°OSPF)æ˜¯ä¸–ç•Œä¸Šæœ€æµâ¾çš„ä¸¤ç§åŸºäºæ ‡å‡†çš„åŠ¨æ€è·¯ç”±åè®®ã€‚</p></blockquote><h3 id="ä¸‰æ¡å››æŒ¥"><a href="#ä¸‰æ¡å››æŒ¥" class="headerlink" title="ä¸‰æ¡å››æŒ¥"></a>ä¸‰æ¡å››æŒ¥</h3><p><img src="/2023/10/23/46/%E4%B8%89%E6%8F%A1%E5%9B%9B%E6%8C%A5.png"></p><h3 id="TCPå’ŒUDP"><a href="#TCPå’ŒUDP" class="headerlink" title="TCPå’ŒUDP"></a>TCPå’ŒUDP</h3><p><img src="/2023/10/23/46/%E5%A4%B4%E9%83%A8.png" alt="|525"></p><ol><li>åºåˆ—å·ï¼šå»ºç«‹è¿æ¥æ—¶ï¼Œç”±è®¡ç®—æœºç”Ÿæˆçš„éšæœºæ•°ä½œä¸ºåˆå§‹å€¼ï¼Œé€šè¿‡SYNåŒ…ä¼ ç»™æ¥æ”¶ç«¯ä¸»æœºï¼Œæ¯å‘é€ä¸€æ¬¡ï¼Œå°±ç´¯åŠ ä¸€æ¬¡è¯¥æ•°æ®å­—èŠ‚æ•°çš„å¤§å°ï¼Œè§£å†³ç½‘ç»œåŒ…ä¹±åºé—®é¢˜ã€‚</li><li>ç¡®è®¤åº”ç­”å·ï¼šä¸‹ä¸€æ¬¡æœŸæœ›æ”¶åˆ°æ•°æ®çš„åºåˆ—å·ã€‚å‘é€ç«¯æ”¶åˆ°è¿™ä¸ªä¹‹åå¯ä»¥è®¤ä¸ºåœ¨è¿™ä¹‹å‰çš„æ•°æ®éƒ½è¢«æ­£å¸¸æ¥æ”¶ï¼Œç”¨äºè§£å†³ä¸¢åŒ…é—®é¢˜ã€‚</li><li>æ§åˆ¶ä½ä¸º1æ—¶ï¼š<ul><li>ACKï¼šç¡®è®¤åº”ç­”å˜ä¸ºæœ‰æ•ˆï¼ŒTCPè§„å®šé™¤äº†æœ€åˆå»ºç«‹è¿æ¥æ—¶çš„SYNåŒ…ä¹‹å¤–å¿…é¡»è®¾ä¸º1</li><li>RSTï¼šæ ‡è¯†è¿æ¥å¼‚å¸¸å¿…é¡»å¼ºåˆ¶æ–­å¼€è¿æ¥</li><li>SYNï¼šè¡¨ç¤ºå¸Œæœ›å»ºç«‹è¿æ¥</li><li>FINï¼šä»Šåä¸ä¼šå†æœ‰æ•°æ®å‘é€ï¼Œå¸Œæœ›æ–­å¼€è¿æ¥æ—¶ï¼Œè¡¨ç¤ºä»Šåä¸å†æœ‰æ•°æ®å‘é€ï¼Œå¸Œæœ›æ–­å¼€è¿æ¥ã€‚å½“é€šä¿¡ç»“æŸå¸Œæœ›æ–­å¼€è¿æ¥æ—¶ï¼Œé€šä¿¡åŒæ–¹å¯ä»¥äº¤æ¢FINä½ä¸º1çš„TCPæ®µã€‚</li></ul></li></ol><h4 id="SYNæ”»å‡»"><a href="#SYNæ”»å‡»" class="headerlink" title="SYNæ”»å‡»"></a>SYNæ”»å‡»</h4><blockquote><p>æ”»å‡»è€…çŸ­æ—¶é—´ä¼ªé€ ä¸åŒçš„IPåœ°å€çš„SYNæŠ¥æ–‡ï¼Œæ²¾æ»¡æœåŠ¡ç«¯çš„åŠç†æŒ‰æ­é˜Ÿåˆ—ï¼Œå¯¼è‡´å®¢æˆ·ç«¯æ— æ³•å’ŒæœåŠ¡ç«¯å»ºç«‹è¿æ¥ã€‚</p></blockquote><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>å¢å¤§netdev_max_backlogï¼šç½‘å¡æ¥æ”¶æ•°æ®åŒ…çš„æ•°æ®å¤§äºå†…æ ¸å¤„ç†é€Ÿåº¦æ—¶ä¿å­˜æ•°æ®åŒ…çš„é˜Ÿåˆ—é•¿åº¦</li><li>å¢å¤§TCPåŠè¿æ¥é˜Ÿåˆ—ï¼š<ul><li>å¢å¤§net.ipv4.tcp_max_syn_backlog</li><li>å¢å¤§listen()å‡½æ•°ä¸­çš„backlog</li><li>å¢å¤§net.core.somaxconn</li></ul></li><li>å¼€å¯net.ipv4.tcp_syncookiesï¼Œå°±å¯ä»¥åœ¨ä½¿ç”¨SYNåŠè¿æ¥çš„æƒ…å†µä¸‹æˆåŠŸå»ºç«‹è¿æ¥ã€‚<img src="/2023/10/23/46/%E4%BD%BF%E7%94%A8cookie%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5.png" alt="|550"></li></ol><ul><li>å‡å°‘SYN+ACKé‡ä¼ æ¬¡æ•°ï¼Œtcp_synack_retrieså†…æ ¸å‚æ•°</li><li>Anti-DDoSç³»ç»Ÿæ‹¦æˆªå®¢â¼¾ç«¯å‘é€çš„SYNæŠ¥â½‚ï¼Œä»£æ›¿æœåŠ¡å™¨å‘å®¢â¼¾ç«¯å‘é€SYN-ACKæŠ¥â½‚ï¼Œå¦‚æœå®¢â¼¾ç«¯ä¸åº”ç­”ï¼Œåˆ™è®¤ä¸ºè¯¥å®¢â¼¾ç«¯ä¸ºè™šå‡æºï¼›å¦‚æœå®¢â¼¾ç«¯åº”ç­”ï¼Œåˆ™Anti-DDoSç³»ç»Ÿè®¤ä¸ºè¯¥å®¢â¼¾ç«¯ä¸ºçœŸå®æºï¼Œå¹¶å°†å…¶IPåœ°å€åŠ â¼Šâ½©åå•ï¼Œåœ¨â¼€æ®µæ—¶é—´å…è®¸è¯¥æºå‘é€çš„æ‰€æœ‰SYNæŠ¥â½‚é€šè¿‡ï¼Œä¹Ÿä¸åšä»£ç­”ã€‚</li></ul><h4 id="æ»‘åŠ¨çª—å£"><a href="#æ»‘åŠ¨çª—å£" class="headerlink" title="æ»‘åŠ¨çª—å£"></a>æ»‘åŠ¨çª—å£</h4><p>æ»‘åŠ¨çª—å£æœºåˆ¶å…è®¸å‘é€æ–¹åœ¨ç­‰å¾…æ¥æ”¶æ–¹ç¡®è®¤ä¹‹å‰å‘é€å¤šä¸ªæ•°æ®åŒ…ï¼Œä»è€Œæé«˜æ•°æ®ä¼ è¾“æ•ˆç‡ã€‚<br>ä¸ºäº†è§£å†³ä¸€å‘ä¸€ç­”çš„æ•ˆç‡é—®é¢˜ã€‚çª—å£çš„å®ç°å®é™…ä¸Šæ˜¯æ“ä½œç³»ç»Ÿå¼€è¾Ÿä¸€ä¸ªç¼“å­˜ç©ºé—´ï¼Œå‘é€æ–¹ä¸»æœºåœ¨ç­‰åˆ°ç¡®è®¤åº”ç­”è¿”å›ä¹‹å‰ï¼Œå¿…é¡»åœ¨ç¼“å†²åŒºä¸­ä¿ç•™å·²å‘é€çš„æ•°æ®ï¼Œå¦‚æœæŒ‰æœŸæ”¶åˆ°ç¡®è®¤åº”ç­”ï¼Œè¿™ä¸ªæ•°æ®å°±å¯ä»¥ä»ç¼“å†²åŒºåˆ é™¤ã€‚<img src="/2023/10/23/46/TCP%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3.png"></p><h4 id="æ…¢å¯åŠ¨"><a href="#æ…¢å¯åŠ¨" class="headerlink" title="æ…¢å¯åŠ¨"></a>æ…¢å¯åŠ¨</h4><p>å½“è¿æ¥å¼€å§‹æ—¶ï¼Œä»¥æŒ‡æ•°é€Ÿç‡å¢åŠ å‘é€é€Ÿç‡ï¼Œç›´åˆ°ç¬¬ä¸€æ¬¡æŠ¥æ–‡ä¸¢å¤±äº‹ä»¶å‘ç”Ÿä¸ºæ­¢ã€‚<br>åˆå§‹ï¼šæ‹¥å¡çª—å£å€¼cwnd = 1 MSS<br>æ¯RTTå€å¢cwnd<br>æ¯æ”¶åˆ°ä¸€ä¸ªACKï¼Œå¢åŠ cwnd<br>åˆå§‹é€Ÿç‡å¾ˆä½ï¼Œä½†æ˜¯ä»¥æŒ‡æ•°å¢åŠ </p><h4 id="é˜»å¡æ§åˆ¶"><a href="#é˜»å¡æ§åˆ¶" class="headerlink" title="é˜»å¡æ§åˆ¶"></a>é˜»å¡æ§åˆ¶</h4><ol><li>æ…¢å¯åŠ¨ï¼šå‘é€æ–¹æ¯æ”¶åˆ°ä¸€ä¸ªACKï¼Œæ‹¥å¡çª—å£cwndå¤§å°æŒ‡æ•°å¢åŠ </li><li>æ‹¥å¡é¿å…ç®—æ³•ï¼šå½“cwndè¶…è¿‡æ…¢å¯åŠ¨é—¨é™ssthreshå°±ä¼šè¿›å…¥æ‹¥å¡é¿å…ç®—æ³•ï¼šæ¯ä¸ª RTTï¼ˆå¾€è¿”æ—¶é—´ï¼‰å¢åŠ  1 ä¸ª MSSï¼Œè€Œä¸æ˜¯æ¯ä¸ª ACK å¢åŠ  1 ä¸ª MSSã€‚</li><li>æ‹¥å¡å‘ç”Ÿï¼šå‘ç”Ÿäº† è¶…æ—¶é‡ä¼ æ—¶ï¼Œsshtreshè®¾ç½®ä¸ºcwnd/2ï¼Œcwndæ¢å¤ä¸ºåˆå§‹åŒ–å€¼ï¼Œå‘ç”Ÿå¿«é€Ÿé‡ä¼ æ˜¯ï¼Œcwnd =cwnd/2ï¼Œssthresh=cwndå¹¶è¿›å…¥å¿«é€Ÿæ¢å¤ç®—æ³•ã€‚</li><li>å¿«é€Ÿæ¢å¤<img src="/2023/10/23/46/%E5%BF%AB%E9%80%9F%E6%81%A2%E5%A4%8D.png"></li></ol><h4 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h4><p>ä¸»æœºååˆ°IPåœ°å€çš„è½¬æ¢<br>ä¸»æœºåˆ«åï¼šä¸€ä¸ªä¸»æœºå¯ä»¥æœ‰ä¸€ä¸ªè§„èŒƒä¸»æœºåå’Œå¤šä¸ªä¸»æœºåˆ«åã€‚<br>é‚®ä»¶æœåŠ¡å™¨åˆ«åï¼šè´Ÿè½½åˆ†é…ï¼šDNSå®ç°å†—ä½™æœåŠ¡å™¨ï¼Œä¸€ä¸ªIPåœ°å€é›†åˆå¯ä»¥å¯¹åº”åŒä¸€ä¸ªè§„èŒƒä¸»æœºåã€‚</p><p>DNSå®¢â¼¾ç«¯è®¾ç½®ä½¿â½¤çš„DNSæœåŠ¡å™¨â¼€èˆ¬éƒ½æ˜¯é€’å½’æœåŠ¡å™¨ï¼Œå®ƒè´Ÿè´£å…¨æƒå¤„ç†å®¢â¼¾ç«¯çš„DNSæŸ¥è¯¢è¯·æ±‚ï¼Œç›´<br>åˆ°è¿”å›æœ€ç»ˆç»“æœã€‚â½½DNSæœåŠ¡å™¨ä¹‹é—´â¼€èˆ¬é‡‡â½¤è¿­ä»£æŸ¥è¯¢â½…å¼ã€‚<br><img src="/2023/10/23/46/DNS%E8%AE%B0%E5%BD%95%E6%A0%BC%E5%BC%8F.png"></p><h4 id="DNSåŠ«æŒ"><a href="#DNSåŠ«æŒ" class="headerlink" title="DNSåŠ«æŒ"></a>DNSåŠ«æŒ</h4><blockquote><p>é€šè¿‡æŸäº›æ‰‹æ®µè·å¾—å¯¹æŸåŸŸåçš„è§£ææ§åˆ¶æƒï¼Œä¿®æ”¹æ­¤åŸŸåçš„è§£æç»“æœï¼Œå¯¼è‡´å¯¹è¯¥åŸŸåçš„è®¿é—®ç”±åŸIPè½¬ä¸ºä¿®æ”¹åçš„æŒ‡å®šIPï¼Œè®°è¿‡å°±æ˜¯å¯¹ç‰¹å®šç½‘ç«™ä¸èƒ½è®¿é—®/è®¿é—®çš„æ˜¯å‡ç½‘ç«™</p></blockquote><p>é˜²æ­¢ï¼šé™åˆ¶å¯¹DNSçš„è®¿é—®ã€è®¾ç½®è¾ƒå°çš„TTLå€¼ï¼Œå®šæœŸä¿®æ”¹åŸŸåç®¡ç†ç³»ç»Ÿçš„è´¦å·ï¼Œä½¿ç”¨æ”¯æŒDNSSECçš„æ³¨å†Œå•†ï¼Œä½¿ç”¨å¯é çš„DNSæœåŠ¡å•†ã€‚</p><blockquote><p>DNSSECï¼ˆDomain Name System Security Extensionsï¼ŒåŸŸåç³»ç»Ÿå®‰å…¨æ‰©å±•ï¼‰æ˜¯ä¸€ç»„ç”¨äºä¿æŠ¤ DNSï¼ˆåŸŸåç³»ç»Ÿï¼‰ä¿¡æ¯å®‰å…¨çš„åè®®å’ŒæŠ€æœ¯ã€‚å®ƒé€šè¿‡æ•°å­—ç­¾åéªŒè¯ DNS æ•°æ®çš„çœŸå®æ€§å’Œå®Œæ•´æ€§ï¼Œé˜²æ­¢ DNS ç¼“å­˜æŠ•æ¯’å’Œå…¶ä»–ç±»å‹çš„æ”»å‡»ã€‚</p></blockquote><h4 id="QUICã€Http2ç‰¹ç‚¹"><a href="#QUICã€Http2ç‰¹ç‚¹" class="headerlink" title="QUICã€Http2ç‰¹ç‚¹"></a>QUICã€Http2ç‰¹ç‚¹</h4><p>QUICæ˜¯googleè®¾è®¡çš„ä¸€ä¸ªåŸºäºUDPçš„ç½‘ç»œä¼ è¾“åè®®ï¼Œæ—¨åœ¨æ›¿ä»£TCPåè®®ä»¥æä¾›æ›´å¿«çš„è¿æ¥å»ºç«‹å’Œæ•°æ®ä¼ è¾“é€Ÿåº¦ã€‚</p><ol><li>å¿«é€Ÿå»ºç«‹è¿æ¥ï¼šä½¿ç”¨åŸºäºTLSçš„å®‰å…¨è¿æ¥ï¼ŒåŒæ—¶å°†è¿æ¥çš„å»ºç«‹ä¸TLSæ¡æ‰‹åˆå¹¶ï¼Œä»è€Œå‡å°‘äº†è¿æ¥æ‰€éœ€è¦çš„å¾€è¿”æ—¶é—´ã€‚</li><li>å¤šè·¯å¤ç”¨ï¼šå…è®¸åœ¨å•ä¸ªè¿æ¥ä¸ŠåŒæ—¶è¿›è¡Œå¤šä¸ªç‹¬ç«‹çš„æ•°æ®æµï¼Œä»é¿å…äº†TCPè¿æ¥ä¸­çš„é˜Ÿå¤´é˜»å¡</li><li>é›¶RTTæ¡æ‰‹ï¼šQUICæ”¯æŒé›¶å¾€è¿”æ—¶é—´æ¡æ‰‹ï¼Œå…è®¸å®¢æˆ·ç«¯åœ¨ç¬¬ä¸€æ¬¡è¿æ¥æ—¶å‘é€æ•°æ®ï¼Œæ— éœ€ç­‰å¾…æ¡æ‰‹å®Œæˆï¼Œè¿›ä¸€æ­¥å‡å°‘äº†è¿æ¥å»ºç«‹æ—¶é—´ã€‚</li><li>åŠ¨æ€è°ƒæ•´æ‹¥å¡æ§åˆ¶ï¼šä½¿ç”¨æ›´å…ˆè¿›çš„æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œèƒ½å¤ŸåŠ¨æ€çš„æ ¹æ®ç½‘ç»œæ¡ä»¶è°ƒå¢æ•°æ®ä¼ è¾“é€Ÿç‡ã€‚</li><li>é”™è¯¯æ¢å¤ï¼šQUICå†…ç½®äº†ä¸€äº›é”™è¯¯æ¢å¤æœºåˆ¶ï¼ŒåŒ…æ‹¬å¿«é€Ÿé‡ä¼ å’Œå‰å‘é”™è¯¯çº æ­£ï¼Œèƒ½å¤Ÿåœ¨å‘ç”Ÿä¸¢åŒ…æˆ–ç½‘ç»œæ‹¥å¡æ—¶æ›´å¿«çš„æ¢å¤æ•°æ®ä¼ è¾“ã€‚</li></ol><p>HTTP/2 æ˜¯â¼€ä¸ªåº”â½¤å±‚åè®®ï¼Œæ˜¯ HTTP/1.1 çš„åç»§ç‰ˆæœ¬ï¼Œæ—¨åœ¨æâ¾¼ Web â»šâ¾¯åŠ è½½é€Ÿåº¦å’Œæ€§èƒ½ã€‚ HTTP/2<br>åœ¨ä¼ è¾“å±‚ä½¿â½¤äº†â¼†è¿›åˆ¶åˆ†å¸§ï¼Œå¤´éƒ¨å‹ç¼©ï¼Œå¤šè·¯å¤â½¤ç­‰æŠ€æœ¯ï¼Œä»¥å‡å°‘å»¶è¿Ÿå’Œæâ¾¼æ•ˆç‡ã€‚ HTTP/2 ä¸æ˜¯â¼€ä¸ª<br>æ›¿ä»£ä¼ è¾“å±‚åè®®ï¼Œâ½½æ˜¯åœ¨ä¼ è¾“å±‚ä¸Šå®ç°çš„ HTTP åè®®çš„å¢å¼ºç‰ˆæœ¬ã€‚</p><h2 id="ç½‘ç»œæ ¸å¿ƒ"><a href="#ç½‘ç»œæ ¸å¿ƒ" class="headerlink" title="ç½‘ç»œæ ¸å¿ƒ"></a>ç½‘ç»œæ ¸å¿ƒ</h2><p>æ¦‚å¿µï¼šè·¯ç”±å™¨çš„ç½‘çŠ¶ç½‘ç»œ<br>æé—®ï¼š æ•°æ®æ€ä¹ˆé€šè¿‡ç½‘ç»œè¿›è¡Œä¼ è¾“ï¼Ÿ</p><ul><li>ç”µè·¯ç”µè·¯äº¤æ¢ï¼š  ä¸å¯å…±äº«èµ„æºï¼Œä¼šé€ æˆèµ„æºæµªè´¹ï¼Œä¸é€‚åˆè®¡ç®—æœºä¹‹é—´çš„é€šè®¯ï¼Œè®¡ç®—æœºé€šä¿¡çš„ç‰¹ç‚¹ï¼š çªå‘æ€§ï¼Œè€—æ—¶çŸ­</li><li>åˆ†ç»„äº¤æ¢ï¼š å­˜å‚¨ â€“ è½¬å‘  ï¼Œ æ•°æ®è½¬å‘è¿‡ç¨‹ä¸­ä½¿ç”¨æ‰€æœ‰çš„èµ„æºï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¸€éƒ¨åˆ†piecesï¼Œä¼šå°†æ‰€æœ‰çš„çš„åˆ†ç»„éƒ½å­˜å‚¨ä¹‹åå†è¿›è¡Œè½¬å‘ï¼Œæ–¹ä¾¿å…±äº«çš„å®ç°</li></ul><h2 id="åº”ç”¨å±‚"><a href="#åº”ç”¨å±‚" class="headerlink" title="åº”ç”¨å±‚"></a>åº”ç”¨å±‚</h2><ol><li>åº”ç”¨æ¶æ„<ul><li>CSä½“ç³» å®¢æˆ·-æœåŠ¡å™¨:<ul><li>æœåŠ¡å™¨ï¼š ä¸€ç›´è¿è¡Œï¼Œå›ºå®šipå’Œå‘¨çŸ¥çš„ç«¯å£å·ï¼Œæ‰©å±•æ€§å·®</li><li>å®¢æˆ·ç«¯ï¼š ä¸»åŠ¨ä¸æœåŠ¡å™¨é€šä¿¡ï¼Œå¯èƒ½æ˜¯åŠ¨æ€ipï¼Œä¸ç›´æ¥ä¸å…¶ä»–å®¢æˆ·ç«¯é€šä¿¡</li></ul></li><li>P2P æ¯ä¸ªç«¯éƒ½å¯ä»¥ä½œä¸ºæœåŠ¡å™¨ï¼Œç‚¹å¯¹ç‚¹</li><li>æ··åˆä½“ c/s + P2P</li></ul></li><li>TCP socket ï¼šå¯¹äºé¢å‘è¿æ¥æœåŠ¡ï¼ˆTCP) çš„åº”ç”¨è€Œè¨€ï¼Œsocketæ˜¯å››å…ƒç»„çš„ä¸€ä¸ªå…·æœ‰æœ¬åœ°æ„ä¹‰çš„æ ‡ç¤º,ç›¸å½“äºä¸€ä¸ªè®°å½•ç‰¹å®šä¼šè¯çš„æŒ‡é’ˆï¼Œåªéœ€è¦ç”¨socketå°±å¯ä»¥æŒ‡å®šè¿™ä¸ªåº”ç”¨<ul><li>socket å…¶å®æ˜¯åº”ç”¨å±‚å’Œä¼ è¾“å±‚ä¹‹é—´çš„ï¼Œä½¿å¾—å…è®¸åº”ç”¨èƒ½å‘èµ·é€šä¿¡ï¼Œä¸å…¶ä»–ä¸»æœºä¸Šçš„åº”ç”¨è¿›ç¨‹è¿›è¡Œé€šä¿¡</li><li>4å…ƒç»„  æºIP æºport ç›®æ ‡IP ç›®æ ‡port</li><li>å”¯ä¸€æŒ‡å®šäº†ä¸€ä¸ªä¼šè¯</li><li>åº”ç”¨ä½¿ç”¨è¿™ä¸ªæ ‡ç¤ºï¼Œä¸è¿œç¨‹çš„åº”ç”¨è¿›ç¨‹è¿›è¡Œé€šè®¯</li><li>ä¸å¿…åœ¨æ¯ä¸€ä¸ªæŠ¥æ–‡ä¸­éƒ½æŒ‡å®šè¿™å››å…ƒç»„</li><li>udp åªæä¾›æºä¸»æœºçš„ip å’Œ port</li></ul></li><li>WebSocket å·¥ä½œè¿‡ç¨‹ï¼š<ol><li>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªHTTPè¯·æ±‚ï¼ŒåŒ…å«å‡çº§å­—æ®µ</li><li>æœåŠ¡å™¨æ¥æ”¶ä¹‹å,è¿›è¡Œåè®®å‡çº§ï¼Œå¦‚æœæ”¯æŒï¼Œä¼šè¿”å›ä¸€ä¸ª101çŠ¶æ€ç ï¼ŒåŒ…å«ä¸€äº›å¯¹åº”å“åº”å¤´</li><li>è¿›è¡ŒåŒå‘é€šä¿¡ï¼Œæ•°æ®ä»¥å¸§çš„æ–¹å¼ä¼ é€ã€‚</li><li>å…¶ä¸­ä¸€æ–¹å‘é€ä¸€ä¸ªå…³é—­å¸§ï¼ŒäºŒè€…å…³é—­TCPè¿æ¥</li><li>é€šè¿‡å¿ƒè·³æœºåˆ¶ä¿è¯WebSocketçš„ç¨³å®šæ€§å’Œæ´»è·ƒæ€§</li></ol></li><li>UDP socket<br> UDP ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ä¹‹å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œæ¯ä¸ªæŠ¥æ–‡ç‹¬ç«‹ä¼ è¾“ï¼Œå‰åæŠ¥æ–‡å¯èƒ½ç»™ä¸åŒçš„åˆ†å¸ƒå¼è¿›ç¨‹<br> udp socket è®°å½•æœ¬IP æœ¬port ä½†æ˜¯ä¼ è¾“æŠ¥æ–‡æ—¶ï¼Œéœ€è¦æä¾›å¯¹æ–¹ipï¼Œ port ,æ¥æ”¶æŠ¥æ–‡æ—¶ä¼ è¾“å±‚éœ€è¦ä¸Šä¼ å¯¹æ–¹IP port<br> äºŒå…ƒç»„ï¼š æºIP  æºport</li></ol><p>TCP æœåŠ¡ï¼š</p><ul><li><p>å¯é çš„ä¼ è¾“æœåŠ¡</p></li><li><p>æµé‡æ§åˆ¶ï¼šå‘é€æ–¹ä¸ä¼šæ·¹</p></li></ul><p>æ²¡æ¥å—æ–¹</p><ul><li>æ‹¥å¡æ§åˆ¶ï¼šå½“ç½‘ç»œå‡ºç°æ‹¥</li></ul><p>å¡æ—¶ï¼Œèƒ½æŠ‘åˆ¶å‘é€æ–¹</p><ul><li><p>ä¸èƒ½æä¾›çš„æœåŠ¡ï¼šæ—¶é—´ä¿è¯ã€æœ€å°ååä¿è¯å’Œå®‰å…¨</p></li><li><p>é¢å‘è¿æ¥ï¼šè¦æ±‚åœ¨å®¢æˆ·ç«¯è¿›ç¨‹å’ŒæœåŠ¡å™¨è¿›ç¨‹ä¹‹é—´å»ºç«‹è¿æ¥</p></li></ul><p>UDP æœåŠ¡ï¼š</p><ul><li><p>ä¸å¯é æ•°æ®ä¼ è¾“</p></li><li><p>ä¸æä¾›çš„æœåŠ¡ï¼šå¯é ï¼Œæµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ã€æ—¶é—´ã€å¸¦å®½ä¿è¯ã€å»ºç«‹è¿æ¥<br>UDPå­˜åœ¨çš„å¿…è¦æ€§</p></li><li><p>èƒ½å¤ŸåŒºåˆ†ä¸åŒçš„è¿›ç¨‹ï¼Œè€ŒIPæœåŠ¡ä¸èƒ½</p></li><li><p>åœ¨IPæä¾›çš„ä¸»æœºåˆ°ä¸»æœºç«¯åˆ°ç«¯åŠŸèƒ½çš„åŸºç¡€ä¸Šï¼ŒåŒºåˆ†äº†ä¸»æœºçš„</p></li></ul><p>åº”ç”¨è¿›ç¨‹</p><ul><li>æ— éœ€å»ºç«‹è¿æ¥ï¼Œçœå»äº†å»ºç«‹è¿æ¥æ—¶é—´ï¼Œé€‚åˆäº‹åŠ¡æ€§çš„</li></ul><p>åº”ç”¨</p><ul><li>ä¸åšå¯é æ€§çš„å·¥ä½œï¼Œä¾‹å¦‚æ£€é”™é‡å‘ï¼Œé€‚åˆé‚£äº›å¯¹å®æ—¶</li></ul><p>æ€§è¦æ±‚æ¯”è¾ƒé«˜è€Œå¯¹æ­£ç¡®æ€§è¦æ±‚ä¸é«˜çš„åº”ç”¨</p><ul><li>å› ä¸ºä¸ºäº†å®ç°å¯é æ€§ï¼ˆå‡†ç¡®æ€§ã€ä¿åºç­‰ï¼‰ï¼Œå¿…é¡»ä»˜å‡ºæ—¶é—´ä»£</li></ul><p>ä»·ï¼ˆæ£€é”™é‡å‘ï¼‰</p><ul><li>æ²¡æœ‰æ‹¥å¡æ§åˆ¶å’Œæµé‡æ§åˆ¶ï¼Œåº”ç”¨èƒ½å¤ŸæŒ‰ç…§è®¾å®šçš„é€Ÿåº¦</li></ul><p>å‘é€æ•°æ®</p><ul><li>è€Œåœ¨TCPä¸Šé¢çš„åº”ç”¨ï¼Œåº”ç”¨å‘é€æ•°æ®çš„é€Ÿåº¦å’Œä¸»æœºå‘ç½‘ç»œå‘é€</li></ul><p>çš„å®é™…é€Ÿåº¦æ˜¯ä¸ä¸€è‡´çš„ï¼Œå› ä¸ºæœ‰æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶</p><ul><li>å®‰å…¨TCP<br>  TCPå’ŒUDPéƒ½æ²¡æœ‰åŠ å¯†ï¼Œæ˜æ–‡ä¼ è¾“<br>  ä½¿ç”¨SSLåè®®æ¥å®ç°åŠ å¯†ï¼Œåœ¨TCPçš„åŸºç¡€ä¸Šå®ç°ï¼Œæä¾›åŠ å¯†çš„TCPï¼Œç§å¯†æ€§ï¼Œæ•°æ®å®Œæ•´æ€§ï¼Œæ®µå †åˆ°ç«¯çš„é‰´åˆ«<br>  SSL socket API åº”ç”¨é€šè¿‡APIå°†é“­æ–‡äº¤ç»™socketï¼ŒSSLå°†å…¶åŠ å¯†<br>URL : è®¿é—®åè®® + ç”¨æˆ·å + å£ä»¤å­— + ç«¯å£ç­‰</li></ul><h3 id="å¸¸è§çš„åº”ç”¨å±‚åè®®"><a href="#å¸¸è§çš„åº”ç”¨å±‚åè®®" class="headerlink" title="å¸¸è§çš„åº”ç”¨å±‚åè®®"></a>å¸¸è§çš„åº”ç”¨å±‚åè®®</h3><h4 id="HTTPé¢è¯•é¢˜"><a href="#HTTPé¢è¯•é¢˜" class="headerlink" title="HTTPé¢è¯•é¢˜"></a>HTTPé¢è¯•é¢˜</h4><ul><li><p>çŠ¶æ€ç ï¼š</p><ol><li>200 </li><li>204 No Content å“åº”å¤´æ²¡æœ‰bodyæ•°æ®</li><li>206 &nbsp;<strong>Partial Content</strong> è¡¨ç¤ºè¿”å›çš„bodyæ•°æ®ä¸æ˜¯èµ„æºçš„å…¨éƒ¨ï¼Œåªæ˜¯ä¸€éƒ¨åˆ†</li><li>301 <strong>Moved Permanently</strong> æ°¸ä¹…é‡å®šå‘ï¼Œè¯·æ±‚çš„èµ„æºå·²ç»ä¸å­˜åœ¨çš„</li><li>302: Found: è¡¨ç¤ºä¸´æ—¶é‡å®šå‘ï¼Œ301ï¼Œ302éƒ½ä¼šåœ¨å“åº”å¤´ä¸­ä½¿ç”¨å­—æ®µLocationæŒ‡æ˜åç»­è¦è·³è½¬URL,æµè§ˆå™¨ä¼šè‡ªåŠ¨é‡å®šå‘åˆ°æ–°çš„URL</li><li>304ï¼š<strong>Not Modified</strong> å‘Šè¯‰å®¢æˆ·ç«¯å¯ä»¥æ¥ç€ä½¿ç”¨ç¼“å­˜èµ„æº</li><li>400<strong>Bad Request</strong> æŠ¥æ–‡æœ‰é”™</li><li>403 <strong>Forbidden</strong> ç¦æ­¢è®¿é—®</li><li>404 <strong>Not Found</strong> èµ„æºä¸å­˜åœ¨æˆ–è€…æ²¡æ‰¾åˆ°</li><li>500 <strong>Internal Server Error</strong> æœåŠ¡å™¨å†…éƒ¨é”™è¯¯</li><li><strong>501 Not Implemented</strong> å®¢æˆ·ç«¯è¯·æ±‚è¿˜ä¸æ”¯æŒ</li><li><strong>502 Bad Gateway</strong> é€šå¸¸æ˜¯æœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†æ—¶è¿”å›çš„é”™è¯¯ç ï¼Œè¡¨ç¤ºæœåŠ¡å™¨è‡ªèº«å·¥ä½œæ­£å¸¸ï¼Œè®¿é—®åç«¯æœåŠ¡å™¨å‘ç”Ÿäº†é”™è¯¯ã€‚</li><li><strong>03 Service Unavailable</strong> æœåŠ¡å™¨å¿™ï¼Œæš‚æ—¶æ— æ³•å“åº”</li></ol></li><li><p>ç¼“å­˜æŠ€æœ¯ï¼šæŠŠè¯·æ±‚-å“åº”çš„æ•°æ®å­˜åˆ°æœ¬åœ°ï¼Œä¸‹ä¸€æ¬¡ç›´æ¥éƒ½æœ¬åœ°æ•°æ®ï¼Œä¸éœ€è¦ç­‰å¾…æœåŠ¡å™¨çš„æƒ³ç”¨äº†</p><ol><li>å¼ºåˆ¶ç¼“å­˜<ul><li><code>Cache-Control</code>ï¼Œ æ˜¯ä¸€ä¸ªç›¸å¯¹æ—¶é—´ï¼›</li><li><code>Expires</code>ï¼Œæ˜¯ä¸€ä¸ªç»å¯¹æ—¶é—´ï¼›</li></ul></li><li>åå•†ç¼“å­˜<ul><li>åœ¨å¼ºåˆ¶ç¼“å­˜æœªå‘½ä¸­æ—¶ï¼ŒæœåŠ¡å™¨ç¬¬ä¸€æ¬¡è¯·æ±‚èµ„æºæ—¶ï¼Œä¼šåœ¨Responseå¤´éƒ¨åŠ ä¸ŠETagå”¯ä¸€è¡¨ç¤º</li><li>å½“æµè§ˆå™¨å†æ¬¡è¯·æ±‚è®¿é—®æœåŠ¡å™¨ä¸­çš„èµ„æºæ—¶ï¼Œå…ˆæ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœæ²¡æœ‰è¿‡æœŸç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œå¦‚æœè¿‡æœŸäº†ä¼šåœ¨Requestå¤´éƒ¨ä¸ŠåŠ ä¸ŠIf-None-Matchç´«è¼æ®µ</li><li>æœåŠ¡å™¨å†æ¬¡æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œä¼šæ ¹æ®è¯·æ±‚ä¸­çš„If-None-Matchå€¼æ˜¯å¦ä¸å½“å‰è¯·æ±‚çš„èµ„æºç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†æ¯”è¾ƒ<ul><li>å¦‚æœå€¼ç›¸ç­‰ï¼Œè¿”å›304 Not Modified ä¸ä¼šè¿”å›èµ„æº</li><li>å¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™è¿”å› 200 çŠ¶æ€ç å’Œè¿”å›èµ„æºï¼Œå¹¶åœ¨ Response å¤´éƒ¨åŠ ä¸Šæ–°çš„ ETag å”¯ä¸€æ ‡è¯†ï¼›</li></ul></li><li>æµè§ˆå™¨æ”¶åˆ°304å“åº”ç ï¼Œä¼šä»æœ¬åœ°åŠ è½½èµ„æºå¦åˆ™æ›´æ–°èµ„æºã€‚</li></ul></li></ol></li><li><p>HTTP/1.1 çš„ä¼˜ç‚¹ï¼šç®€å•çµæ´»ã€åº”ç”¨å¹¿æ³›</p><ul><li>ç¼ºç‚¹æ˜¯ï¼šæ— çŠ¶æ€ä¸€æ–¹é¢å¯ä»¥ä¸éœ€è¦æœåŠ¡å™¨ä½¿ç”¨é¢å¤–çš„èµ„æºæ¥è®°å½•çŠ¶æ€ä¿¡æ¯</li><li>åå¤„æ˜¯ï¼šè¿›è¡Œå…³è”æ€§æ“ä½œæ—¶ï¼Œéœ€è¦æ¯æ¬¡éƒ½éªŒè¯ä¸€æ¬¡èº«ä»½</li><li>è§£å†³æ–¹æ³•ï¼šä½¿ç”¨Cookie</li></ul></li><li></li><li><p>HTTPï¼šè¶…æ–‡æœ¬ä¼ è¾“åè®® HTTPé»˜è®¤80 HTTPSé»˜è®¤ 443</p><ul><li>æµç¨‹ï¼š 1. å®¢æˆ·å‘èµ·ä¸€ä¸ªä¸æœåŠ¡å™¨çš„TCPè¿æ¥ï¼Œ(å»ºç«‹socket) 2. æœåŠ¡å™¨æ¥å—TCP è¿æ¥ 3. æµè§ˆå™¨å’ŒwebæœåŠ¡å™¨ä¹‹é—´äº¤æ¢HTTPæŠ¥æ–‡ 4. TCPè¿æ¥å…³é—­ </li><li>HTTP æ˜¯æ— çŠ¶æ€çš„è¿æ¥ï¼Œä¸ä¼šç»´æŠ¤ä»»ä½•å’Œå®¢æˆ·æœ‰å…³çš„ä¿¡æ¯ï¼Œè¿™æ—¶å€™å°±éœ€è¦websocketäº†</li><li>HTTP/1.1 ä¹‹åé»˜è®¤ä½¿ç”¨æŒä¹…è¿æ¥ï¼Œä¿è¯äº†å¤šä¸ªuç¬¬é¡¹å¯ä»¥åœ¨ä¸€ä¸ªTCPè¿æ¥ä¸Šä¼ è¾“ ï¼ŒéæŒä¹…è¿æ¥ä¸‹è½½å¤šä¸ªæ–‡ä»¶éœ€è¦åŠæ¡ˆä¾‹å¤šä¸ªTCPè¿æ¥<br> å“åº”æ—¶é—´<br> å¾€è¿”æ—¶é—´ RTT round - trip - timeï¼š ä¸€ä¸ªå°çš„åˆ†ç»„ä»å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨ï¼Œå†å›åˆ°å®¢æˆ·ç«¯çš„æ—¶é—´ï¼Œä¼ è¾“æ—¶é—´å¿½ç•¥ä¸è®¡<br> å“åº”æ—¶é—´ä¸ºï¼š 2RTT + ä¼ è¾“æ—¶é—´<br> 1. ä¸€ä¸ªRTT ç”¨æ¥å‘èµ·TCPè¯·æ±‚<br> 2. ä¸€ä¸ªç”¨æ¥HTTPè¯·æ±‚å’Œç­‰å¾…å“åº”<br> 3. æ–‡ä»¶ä¼ è¾“æ—¶é—´<br> <strong>æŒä¹…HTTP</strong> ï¼š ä¸€ä¸ªTCPè¿æ¥å»ºç«‹ä¹‹åï¼Œä¸ä¼šæ–­å¼€ç„¶åè¿›è¡Œå¤šä¸ªHTTPè¯·æ±‚<br> æœåŠ¡å™¨åœ¨å‘é€å“åº”ä¹‹åä»ç„¶ä¿æŒTCPè¿æ¥<br> åœ¨ç›¸åŒå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„åç»­è¯·æ±‚å’Œå“åº”æŠ¥æ–‡é€šè¿‡ç›¸åŒçš„è¿æ¥è¿›è¡Œä¼ é€<br> å®¢æˆ·ç«¯ï¼Œåœ¨é‡åˆ°ä¸€ä¸ªå¼•ç”¨å¯¹è±¡çš„æ—¶å€™å°±å¯ä»¥å°½å¿«çš„å‘é€è¯¥å¯¹è±¡çš„è¯·æ±‚ï¼Œ<br> 1. æ¯ä¸ªå¯¹è±¡è¦ä¸¤ä¸ªRTT<br> 2. æ“ä½œç³»ç»Ÿå¿…é¡»ä¸ºæ¯ä¸€ä¸ªTCPè¿æ¥åˆ†é…èµ„æºï¼Œä½†æ˜¯æµè§ˆå™¨é€šå¸¸å¹¶è¡Œæ‰“å¼€TPCè¿æ¥ï¼Œä»¥è·å¾—å¼•ç”¨å¯¹è±¡<br> ä¸¤ç§æ–¹å¼ï¼š<br>     1. éæµçº¿æ–¹å¼çš„æŒä¹…HTTPï¼Œå®¢æˆ·ç«¯åªèƒ½åœ¨å‰ä¸€ä¸ªHTTPè¯·æ±‚å“åº”ä¹‹åæ‰èƒ½å‘é€æ–°çš„è¯·æ±‚ï¼Œæ¯ä¸ªå¼•ç”¨å¯¹è±¡èŠ±è´¹ä¸€ä¸ªRTT<br>     2. æµæ°´çº¿æ–¹å¼ï¼šå®¢æˆ·ç«¯é‡åˆ°ä¸€ä¸ªå¼•ç”¨å¯¹è±¡ï¼ˆä¸€ä¸ªå°çš„uiæ‰€æŒ‡çš„èµ„æºï¼‰ä¹‹åå°±ç«‹å³äº§ç”Ÿä¸€ä¸ªè¯·<br>     3. æ‰€æœ‰(å°)çš„å¼•ç”¨å¯¹è±¡åªèŠ±è´¹ä¸€ä¸ªRTTæ˜¯æœ‰å¯èƒ½çš„<br> HTTP æŠ¥æ–‡æ ¼å¼ ï¼š è¯·æ±‚è¡Œ + è¯·æ±‚å¤´ + (request body)<br> tips : PUT è¯·æ±‚æ˜¯å°†å®ä½“å¯¹è±¡ä¸­æ–‡ä»¶è½½åˆ°URLæŒ‡å®šçš„è·¯å¾„(ä¸€èˆ¬æ˜¯æ›´æ–°èµ„æº)<br> POST ä¸éœ€è¦åœ¨URL ä¸­æŒ‡å®šèµ„æºä½ç½®ï¼Œä¸€èˆ¬ç”¨äºåˆ›å»ºèµ„æº<ul><li>ç¼“å­˜ï¼šå‘½ä¸­ç‡(h)ï¼š ç™¾åˆ†ä¹‹å¤šå°‘çš„è¯·æ±‚å¯ä»¥åœ¨ç¼“å­˜ä¸­æ»¡è¶³</li><li>æ¥å…¥é“¾è·¯çš„åˆ©ç”¨ç‡:  (1-h) *  è¯·æ±‚é€Ÿç‡ / å¸¦å®½</li></ul></li></ul></li><li><p>FTP æ–‡ä»¶ä¼ è¾“åè®®(åŸºäºTCP)<br> ftpæœåŠ¡å™¨ç«¯å£å·é»˜è®¤ä¸º 21ï¼Œéœ€è¦å»ºç«‹ä¸¤ä¸ªTCPè¿æ¥ï¼Œä¸€ä¸ªç”¨äºæ§åˆ¶ï¼Œä¸€ä¸ªç”¨äºä¼ è¾“</p></li><li><p>SMIT ç”µå­é‚®ä»¶çš„é‚®ä»¶ä¼ è¾“åè®® (é»˜è®¤ç«¯å£25)<br>  ç”¨äºä¸Šä¼ é‚®ä»¶ï¼Œå’ŒHTTPçš„åŒºåˆ«ï¼ŒHTTPçš„æ¯ä¸ªå¯¹è±¡å°è£…åœ¨å„è‡ªçš„å“åº”æŠ¥æ–‡ä¸­ï¼ŒSMITå¯ä»¥å°†å¤šä¸ª å¼•ç”¨å¯¹è±¡å°è£…åœ¨ä¸€ä¸ªæŠ¥æ–‡ä¸­<br>  æŠ¥æ–‡æ ¼å¼ï¼š<br>  HEAD<br>  To :<br>  From :<br>  Subject:<br>  BODY:<br>  æŠ¥æ–‡</p><ul><li>MIME å¤šåª’ä½“é‚®ä»¶æ‰©å±•</li><li>POP é‚®å±€è®¿é—®åè®® ç”¨æˆ·ç¡®è®¤èº«ä»½(ä»£ç† &lt;â€“&gt;æœåŠ¡å™¨)å¹¶ä¸‹è½½<ul><li>POP3 ä¸ä¿ç•™ä¼šè¯çŠ¶æ€ æœ¬åœ°ç®¡ç†æ–‡ä»¶å¤¹</li></ul></li><li>IMAP Internet é‚®ä»¶è®¿é—®åè®®ï¼Œä¿ç•™ç”¨æˆ·çŠ¶æ€ è¿œç¨‹ç®¡ç†æ–‡ä»¶å¤¹</li></ul></li><li><p><em>DNS</em> Domain Name System å»ºç«‹IP åœ°å€å’Œ å¯¹åº”åŸŸåä¹‹é—´çš„æ˜ å°„<br>  <strong><em>DNSé»˜è®¤é»˜è®¤ç«¯å£æ˜¯53</em></strong><br>  ä¸»è¦æ€è·¯ï¼šåˆ†å±‚ï¼ŒåŸºäºåŸŸçš„å‘½åæœºåˆ¶ï¼Œåœ¨è‹¥å¹²åˆ†å¸ƒå¼çš„æ•°æ®åº“ä¸Šå®Œæˆè½¬æ¢<br>  ä¹Ÿå¯ä»¥åšåˆ°è´Ÿè½½å‡è¡¡<br>  åŸŸåç»“æ„ï¼šä½¿ç”¨å±‚æ¬¡æ ‘çŠ¶ç»“æ„æ¥è¿›è¡Œå‘½å<br>  åŸŸåç»“æ„ï¼šä»æœ¬åŸŸå¼€å§‹å¾€ä¸Šç›´è‡³æ ‘æ ¹ï¼ŒåŸŸä¸¥æ ¼éµå¾ªç»„ç»‡ç•Œé™ï¼Œè€Œä¸æ˜¯ç‰©ç†ç½‘ç»œ<br>  DNS è®°å½•æ ¼å¼<br>  RPæ ¼å¼: (name,value,type , ttl)<br>  type=A  æ—¶ï¼Œ name ä¸ºä¸»æœº value ä¸ºIP<br>  =CNAME  Name ä¸ºè§„èŒƒåå­—çš„åˆ«å<br>  =NS           Name ä¸ºåŸŸå (foo.com) value ä¸ºè¯¥åŸŸåçš„æƒå¨æœåŠ¡å™¨çš„åŸŸå<br>  =MX          Value ä¸ºnameå¯¹åº”é‚®ä»¶æœåŠ¡å™¨åå­—</p><ul><li>åº”ç”¨è°ƒç”¨ è§£æå™¨(resolver)</li><li>è§£æå™¨ä½œä¸ºå®¢æˆ· å‘Name Serverå‘å‡ºæŸ¥è¯¢æŠ¥æ–‡ï¼ˆå°è£…åœ¨UDPæ®µä¸­ï¼‰</li><li>Name Serverè¿”å›å“åº”æŠ¥æ–‡(name/ip)</li><li>æœ¬åœ°åå­—æœåŠ¡å™¨ Local Name Server èµ·åˆ°ä»£ç†çš„ä½œç”¨ï¼Œå°†æŸ¥è¯¢è½¬å‘åˆ°DNSæœåŠ¡å™¨<ul><li>ä¸ä¸¥æ ¼å±äºå±‚æ¬¡ç»“æ„ï¼Œæ¯ä¸ªISP éƒ½æœ‰ä¸€ä¸ªæœ¬åœ°DNSï¼Œä¼˜å…ˆå»æœ¬åœ°DNSæœåŠ¡å™¨ä¸­æŸ¥è¯¢</li><li>é€’å½’æŸ¥è¯¢ï¼šæœ¬åœ°LNS æ— ï¼Œ<strong>ç›´æ¥</strong> å»æ‰¾æƒå¨æœåŠ¡å™¨ï¼Œç„¶åä»æƒå¨æœåŠ¡å™¨å¾€ä¸‹å¼€å§‹æŸ¥è¯¢ï¼Œåªéœ€è¦å‘ä¸€ä¸ªæœåŠ¡å™¨å»è¯·æ±‚ï¼Œç„¶åç”±è¿™ä¸ªæœåŠ¡å™¨å»æŸ¥è¯¢æˆ–è€…å»å‘å…¶ä»–æœåŠ¡å™¨æ¥è¿›è¡ŒæŸ¥æ‰¾ï¼Œæœ€ç»ˆç”±è¿™ä¸ªæœåŠ¡å™¨æ¥è¿”å›ç»“æœ</li><li>è¿­ä»£æŸ¥è¯¢ï¼šè½¬å‘åˆ°æœåŠ¡å™¨ï¼Œå¦‚æœè¿™ä¸ªæœåŠ¡å™¨æ²¡æœ‰å°±å‘Šè¯‰å‘èµ·è¯·æ±‚çš„æœåŠ¡å™¨è¦å»æŸ¥è¯¢ä¸‹ä¸ªä¸€ä¸ªæœåŠ¡å™¨ï¼Œç”±è¯·æ±‚æœåŠ¡å™¨å»æ¥ç€è¯·æ±‚å…¶ä»–æœåŠ¡å™¨ï¼Œæœ€ç»ˆç”±èƒ½æŸ¥è¯¢åˆ°çš„æœåŠ¡å™¨æ¥è¿”å›ç»“æœï¼Œå°±å¯ä»¥é™ä½æ ¹æœåŠ¡å™¨çš„è´Ÿè·äº†</li></ul></li><li>ç¼“å­˜ï¼Œä¸€æ—¦åå­—æœåŠ¡å™¨å¾—åˆ°äº†ä¸€ä¸ªæ˜ å°„ï¼Œå°±å°†è¯¥æ˜ å°„ç¼“å­˜èµ·æ¥ï¼Œæ ¹æœåŠ¡å™¨ä¸€èˆ¬åœ¨æœ¬åœ°æœåŠ¡å™¨ä¸­ç¼“å­˜ç€ï¼Œä½¿ç”¨TTL (Time to Live)</li><li>æ”»å‡»DNSçš„æ–¹æ³•ï¼š <ul><li>DDoSæ”»å‡»ï¼šå¯¹æ ¹æœåŠ¡å™¨è¿›è¡Œæµé‡è½°ç‚¸ï¼Œå‘é€å¤§é‡çš„ping</li><li>å‘TLD(æƒå¨ï¼Œé¡¶çº§åŸŸå)æ”»å‡»</li><li>é‡å®šå‘æ”»å‡»ï¼š</li></ul></li></ul></li><li><p>CDN å†…å®¹åˆ†å‘ç½‘ç»œï¼šåœ¨CDNèŠ‚ç‚¹ä¸­å­˜å‚¨å†…å®¹çš„å¤šä¸ªæ‹·è´ï¼Œç”¨æˆ·è¯·æ±‚é‡å®šå‘åˆ°æœ€è¿‘çš„ä¸€ä¸ªCDNèŠ‚ç‚¹</p></li></ul><h2 id="ä¼ è¾“å±‚"><a href="#ä¼ è¾“å±‚" class="headerlink" title="ä¼ è¾“å±‚"></a>ä¼ è¾“å±‚</h2><p>æä¾›æœåŠ¡ï¼šä¸ºè¿è¡Œåœ¨ä¸åŒä¸»æœºä¸Šåº”ç”¨ç¨‹åºæä¾›é€»è¾‘é€šä¿¡<br>æ•°æ®å…ƒä¸ºæŠ¥æ–‡æ®µ<br>ä¸ç½‘ç»œå±‚çš„åŒºåˆ«ï¼šç½‘ç»œå±‚æä¾›ä¸åŒä¸»æœºä¹‹é—´çš„é€»è¾‘é€šä¿¡ï¼Œä¼ è¾“å±‚æä¾›çš„åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šè®¯<br>tipsï¼šTCPå’ŒUDPéƒ½ä¸æä¾›å»¶æ—¶ä¿è¯å’Œå¸¦å®½ä¿è¯ï¼Œéƒ½æ”¯æŒå¤šè·¯å¤ç”¨å’Œè§£å¤ç”¨ï¼ŒTCPé¢å¤–æä¾›æ‹¥å¡æ§åˆ¶å’Œæµé‡æ§åˆ¶ï¼Œä»¥åŠå»ºç«‹è¿æ¥</p><ul><li>å¤šè·¯å¤ç”¨/è§£å¤ç”¨ï¼šå¤šè·¯å¤ç”¨æŒ‡çš„æ˜¯è®¸å¤šä¸ªä¿¡å·æˆ–æ•°æ®æµå…±äº«åŒä¸€ç‰©ç†é€šä¿¡é€šé“ï¼Œè§£å¤ç”¨æŒ‡çš„æ˜¯æ ¹æ®æŠ¥æ–‡æ®µçš„å¤´èƒŒéƒ¨ä¿¡æ¯ä¸­çš„IPåœ°å€å’Œç«¯å£å·å°†æ¥å—çš„æŠ¥æ–‡æ®µå‘ç»™æ­£ç¡®çš„socket</li><li>ä¸ºä½•è¦æœ‰UDP ï¼š <ol><li>ä¸å»ºç«‹è¿æ¥(ä¼šå¢åŠ å»¶æ—¶)</li><li>ç®€å•ï¼šåœ¨å‘é€ç«¯å’Œæ¥æ”¶ç«¯æ²¡æœ‰è¿æ¥çŠ¶æ€</li><li>æŠ¥æ–‡æ®µçš„å¤´éƒ¨å¾ˆå°(å¼€é”€å°)</li><li>æ— é˜»å¡æ§åˆ¶å’Œæµé‡æ§åˆ¶å¯ä»¥ä¿è¯UDPå°½å¿«çš„å‘é€æŠ¥æ–‡æ®µï¼Œåº”ç”¨-&gt; ä¼ è¾“é€Ÿç‡ = ä¸»æœº -&gt; ç½‘ç»œçš„é€Ÿç‡</li><li><u>UDPä¹Ÿä¼šè¿›è¡Œæ ¡éªŒï¼Œä½†æ˜¯åªæ˜¯é€šè¿‡æ ¡éªŒå’Œçš„æ–¹å¼æ¥æ£€æµ‹æ˜¯å¦é­åˆ°ç¯¡æ”¹</u></li></ol></li><li>RDT æ˜¯ä¸€ç§æ¨¡å‹: RDTï¼ˆReliable Data Transferï¼‰æ˜¯ä¸€ç§å¯é çš„æ•°æ®ä¼ è¾“åè®®ï¼Œç”¨äºåœ¨ä¸å¯é çš„é€šä¿¡ä¿¡é“ä¸Šå®ç°å¯é çš„æ•°æ®ä¼ è¾“ã€‚<ol><li>RDT 1.0ï¼ˆåœç­‰åè®®ï¼‰ï¼šç›¸ä¿¡ä¿¡é“å¯é <ul><li>å‘é€æ–¹åªå‘é€ä¸€æ¬¡æ•°æ®ï¼Œä¸è¿›è¡Œé‡ä¼ ã€‚</li><li>æ¥æ”¶æ–¹åªæ¥å—ä¸€æ¬¡æ•°æ®ï¼Œä¸è¿›è¡Œé‡ä¼ è¯·æ±‚ã€‚</li><li>é€‚ç”¨äºç†æƒ³åŒ–çš„é€šä¿¡ä¿¡é“ï¼Œä¸è€ƒè™‘é”™è¯¯å’Œä¸¢å¤±ã€‚</li></ul></li><li>RDT 2.0ï¼ˆå›é€€Nåè®®ï¼‰ï¼š ç›¸ä¿¡ä¼šå‡ºç°bits errors<ul><li>ä½¿ç”¨checksum æ¥è¿›è¡Œé”™è¯¯æ£€éªŒ</li><li>å¼•å…¥äº†æœ‰é™çŠ¶æ€è‡ªåŠ¨æœºï¼Œæ¥åˆ‡æ¢æ¥æŒ‡å®šå‘é€è€…å’Œæ¥æ”¶è€…</li><li>å‘é€æ–¹å‘é€æ•°æ®å¸§ï¼Œå¹¶ç­‰å¾…æ¥æ”¶æ–¹çš„ç¡®è®¤å¸§ã€‚</li><li>æ¥æ”¶æ–¹æ¥æ”¶æ•°æ®å¸§ï¼Œå‘é€ç¡®è®¤å¸§ã€‚</li><li>å¦‚æœå‘é€æ–¹æœªæ”¶åˆ°ç¡®è®¤å¸§ï¼Œå®ƒå°†é‡ä¼ æ•°æ®å¸§ã€‚</li><li>æ¥æ”¶æ–¹å¯èƒ½æ”¶åˆ°é‡å¤çš„æ•°æ®å¸§ï¼Œä½†é€šè¿‡å¸¦æœ‰åºå·çš„æ•°æ®å¸§æ¥æ’é™¤é‡å¤ã€‚</li><li>é—®é¢˜ï¼šå¦‚æœACKæˆ–è€…NCKä¼ é”™äº†ï¼Œå°±ä¼šé‡å¤</li></ul></li><li>RDT 3.0 <ul><li>æœºåˆ¶ï¼šåœ¨è¶…è¿‡åˆç†æ—¶é—´ä¹‹åè¿›è¡Œé‡ä¼ </li><li><ul><li>å¦‚æœpackageï¼ˆæˆ–ACKï¼‰åªæ˜¯è¢«å»¶è¿Ÿäº†ï¼š</li><li>é‡ä¼ å°†ä¼šå¯¼è‡´æ•°æ®é‡å¤ï¼Œä½†åˆ©ç”¨åºåˆ—å·å·²ç»å¯ä»¥å¤„ç†è¿™ä¸ªé—®é¢˜</li><li>æ¥æ”¶æ–¹å¿…é¡»æŒ‡æ˜è¢«æ­£ç¡®æ¥æ”¶çš„åºåˆ—å·</li></ul></li></ul></li></ol><ul><li>éœ€è¦ä¸€ä¸ªå€’è®¡æ•°å®šæ—¶å™¨<ol><li>åœç­‰åè®®ï¼šå‘é€æ–¹å‘é€ä¸€ä¸ªåˆ†ç»„ï¼Œç„¶åç­‰å¾…æ¥æ”¶æ–¹çš„åº”ç­”</li><li>ACK NAK   NAK æ˜¯negative ACK</li></ol></li></ul></li><li>TCP:<ul><li>ç‚¹å¯¹ç‚¹ï¼šä¸€ä¸ªå‘é€æ–¹ï¼Œä¸€ä¸ªæ¥æ”¶æ–¹ </li><li>å¯é çš„ã€æŒ‰é¡ºåºçš„å­—èŠ‚æµï¼šæ²¡æœ‰æŠ¥æ–‡è¾¹ç•Œ </li><li>ç®¡é“åŒ–ï¼šTCPæ‹¥å¡æ§åˆ¶å’Œæµé‡æ§åˆ¶è®¾ç½®çª—å£çš„å¤§å°</li><li>é¢å‘è¿æ¥ï¼šäº¤æ¢æ•°æ®ä¹‹å‰ï¼Œé€šè¿‡æ¡æ‰‹æ¥åˆå§‹åŒ–åŒæ–¹çš„çŠ¶æ€å˜é‡</li><li>æµé‡æ§åˆ¶ï¼šå‘é€æ–¹ä¸ä¼šæ·¹æ²¡æ¥æ”¶æ–¹</li><li><img src="/2023/10/23/46/tcp%E6%8A%A5%E6%96%87.png" alt="tcpæŠ¥æ–‡"></li><li>åºå·ï¼šæŠ¥æ–‡æ®µé¦–å­—èŠ‚åœ¨å­—èŠ‚æµçš„ç¼–å·</li><li>ç¡®è®¤å·ï¼šæœŸæœ›ä»å¦ä¸€æ–¹æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªå­—èŠ‚çš„åºå·</li><li>TCPè¶…æ—¶æ—¶é—´= EstimatedRTT + å®‰å…¨è¾¹ç•Œæ—¶é—´</li><li>ã€‚ã€‚ã€‚ã€‚å¾…ç»­</li></ul></li></ul><h2 id="ç½‘ç»œå±‚"><a href="#ç½‘ç»œå±‚" class="headerlink" title="ç½‘ç»œå±‚"></a>ç½‘ç»œå±‚</h2><p>DU ä¸º æ•°æ®åŒ…</p><ul><li>æœåŠ¡ï¼šåœ¨å‘é€å’Œæ¥æ”¶ä¸»æœºä¹‹é—´ä¼ é€æ®µ</li><li>åŠŸèƒ½ï¼š<ul><li>è½¬å‘ï¼šå°†åˆ†ç»„ä»è·¯ç”±å™¨çš„è¾“å…¥æ¥å£è½¬å‘åˆ°åˆé€‚çš„è¾“å‡ºæ¥å£ä¸Š</li><li>è·¯ç”±ï¼šä½¿ç”¨è·¯ç”±ç®—æ³•æ¥å†³å®šåˆ†ç»„ä»å‘é€ä¸»æœºåˆ°ç›®æ ‡æ¥æ”¶ä¸»æœºçš„è·¯å¾„</li></ul></li><li>æ•°æ®å¹³é¢ï¼šè½¬å‘</li><li>æ§åˆ¶å¹³é¢ï¼šè·¯å¾„</li><li>è·¯ç”±å™¨çš„ç»“æ„ï¼š<ul><li>è·¯ç”±ï¼šè¿è¡Œè·¯ç”±é€‰æ‹©ç®—æ³•ç”Ÿæˆè·¯ç”±è¡¨</li><li>è½¬å‘ï¼šä»è¾“å…¥åˆ°è¾“å‡ºé“¾è·¯äº¤æ¢æ•°æ®æŠ¥ï¼Œæ ¹æ®è·¯ç”±è¡¨è¿›è¡Œåˆ†ç»„çš„è½¬å‘</li></ul></li><li>æŸ¥è¡¨æ–¹å¼ï¼š <ul><li>æœ€é•¿å‰ç¼€åŒ¹é…</li></ul></li><li>äº¤æ¢ç»“æ„ï¼š<ul><li>é€šè¿‡å†…å­˜äº¤æ¢ï¼Œåœ¨cpuçš„ç›´æ¥æ§åˆ¶ä¸‹è¿›è¡Œäº¤æ¢</li><li>ä½¿ç”¨æ€»çº¿è¿›è¡Œäº¤æ¢ï¼š æ•°æ®æŠ¥é€šè¿‡å…±äº«æ€»çº¿è¿›è¡Œè½¬å‘ï¼Œäº¤æ¢é€Ÿåº¦å—é™äºæ€»çº¿å¸¦å®½</li><li>ä½¿ç”¨äº’è”ç½‘ç»œè¿›è¡Œäº¤æ¢</li></ul></li><li>è°ƒåº¦æœºåˆ¶ï¼š è°ƒåº¦æŒ‡çš„æ˜¯é€‰æ‹©ä¸‹ä¸€ä¸ªè¦é€šè¿‡é“¾è·¯äº¤æ¢çš„åˆ†ç»„<ul><li>FIFO</li><li>ä¼˜å…ˆæƒè°ƒåº¦</li><li>è½®è¯¢</li></ul></li><li>IP<ul><li>IPåœ°å€æ˜¯å¯¹ä¸»æœºæˆ–è€…è·¯ç”±å™¨çš„æ¥å£è¿›è¡Œç¼–å€</li><li>æ¥å£æŒ‡çš„æ˜¯ ä¸»æœº/è·¯ç”±å™¨ å’Œ ç‰©ç†é“¾è·¯çš„è¿æ¥å¤„</li><li>å…³ç³»æ˜¯1 : 1</li><li><strong>å­ç½‘</strong>ï¼š<ol><li>ä¸€ä¸ªå­ç½‘å†…çš„èŠ‚ç‚¹ï¼Œä»–ä»¬IPåœ°å€çš„é«˜ä½éƒ¨åˆ†éƒ½ç›¸åŒï¼Œè¿™äº›èŠ‚ç‚¹å«åšå­ç½‘</li><li>æ— éœ€è·¯ç”±å™¨ä»‹å…¥ï¼Œå­ç½‘å†…çš„ä¸ªä¸»æœºåœ¨ç‰©ç†ä¸Šæ˜¯å¯ä»¥ç›´æ¥æ‰“åˆ°</li><li>å°†å­ç½‘æ©ç è½¬ä¸ºäºŒè¿›åˆ¶ï¼Œåˆ™ä¸º1çš„éƒ¨åˆ†ä»£è¡¨ç€IPåœ°å€ä¸­çš„è¿™ä¸€éƒ¨åˆ†æ˜¯ç½‘ç»œä¸­çš„åœ°å€ï¼Œä¸º0çš„éƒ¨åˆ†æ˜¯æ ‡è¯†å­ç½‘ä¸­çš„ä¸»æœº</li></ol></li><li>åˆ†ç±»ï¼šæ ¹æ®ç¬¬ä¸€ä¸ª8ä½bitæ¥è¿›è¡Œåˆ†ç±»<ul><li>A ç±» æœ€é«˜ä½å›ºå®šä¸º0ï¼šä¹Ÿå°±æ˜¯ 1 - 126  7 ä½ç½‘ç»œ  24 ä½ä¸»æœº</li><li>B : 10  128 - 191 14ä½ ç½‘ç»œ 16ä¸»æœº</li><li>C : 110 192 - 223  21ä½ ç½‘ç»œ  8ä½ä¸»æœº</li><li>D : 224 - 239 ç”¨äºå¤šæ’­</li><li>E : 240 - 255 ä¿ç•™ç”¨äºå®éªŒå’Œç ”ç©¶ç›®çš„</li></ul></li><li>CIDR Classless InterDomain Routing æ— ç±»åŸŸé—´è·¯ç”±<ul><li>ä¹Ÿå°±æ˜¯ a.b.c.d/x xæ˜¯å­ç½‘æ©ç (mask)</li></ul></li><li>NAT ç½‘ç»œåœ°å€è½¬æ¢ <ul><li>å°†ç§æœ‰ç½‘ç»œä¸­çš„å†…éƒ¨IPæ˜ å°„åˆ°å…¬å…±ç½‘ç»œä¸­çš„å•ä¸ªIPåœ°å€</li></ul><ol><li><p>èŠ‚çœIPåœ°å€ï¼šNATå…è®¸å¤šä¸ªå†…éƒ¨è®¾å¤‡å…±äº«ä¸€ä¸ªå…¬å…±IPåœ°å€ï¼Œå› æ­¤å¯ä»¥å»¶é•¿IPv4åœ°å€æ± çš„ä½¿ç”¨å¯¿å‘½ã€‚</p></li><li><p>å¢å¼ºç½‘ç»œå®‰å…¨æ€§ï¼šå› ä¸ºå†…éƒ¨è®¾å¤‡çš„ç§æœ‰IPåœ°å€ä¸ç›´æ¥æš´éœ²åœ¨äº’è”ç½‘ä¸Šï¼ŒNATæä¾›äº†ä¸€å±‚åŸºæœ¬çš„å®‰å…¨æ€§ï¼Œå¯ä»¥éšè—å†…éƒ¨ç½‘ç»œç»“æ„ã€‚</p></li><li><p>ç®€åŒ–ç½‘ç»œç®¡ç†ï¼šNATå¯ä»¥ä½¿ç½‘ç»œç®¡ç†å‘˜æ›´è½»æ¾åœ°ç®¡ç†å¤šå°è®¾å¤‡ï¼Œè€Œæ— éœ€ä¸ºæ¯ä¸ªè®¾å¤‡åˆ†é…å”¯ä¸€çš„å…¬å…±IPåœ°å€ã€‚</p></li></ol></li></ul></li><li>IPv6 <ul><li>IPv4å’ŒIPv6é€šä¿¡æ–¹å¼ï¼šéš§é“ Tunnelingï¼Œ åœ¨IPv4è·¯ç”±å™¨ä¹‹é—´ä¼ è¾“çš„IPv4æŠ¥æ–‡ä¸­æºå¸¦PIv6çš„æŠ¥æ–‡</li></ul></li><li>SDN</li><li>OpenFlow</li><li>route è·¯ç”±ï¼ŒæŒ‰ç…§æŸç§æŒ‡æ ‡æ‰¾åˆ°ä¸€æ¡ä»æºèŠ‚ç‚¹åˆ°ç›®æ ‡èŠ‚ç‚¹çš„è¾ƒå¥½è·¯å¾„<ul><li>è·¯ç”±ç®—æ³•åˆ†ä¸º å…¨å±€å’Œ åˆ†å¸ƒå¼</li><li>å…¨å±€ï¼š<ul><li>æ‰€æœ‰è¾¹éƒ½æ‹¥æœ‰å®Œæ•´(æ‰€æœ‰çš„æ‹“æ‰‘)çš„æ‹“æ‰‘å’Œè¾¹çš„ä»£ä»·çš„ä¿¡æ¯</li><li>link state  LS  é“¾è·¯çŠ¶æ€è·¯ç”±é€‰æ‹©ç®—æ³•</li></ul></li><li>åˆ†å¸ƒå¼: <ul><li>è·¯ç”±å™¨åªçŸ¥é“ä¸å®ƒç‰©ç†è¿æ¥å…³ç³»çš„é‚»å±…è·¯ç”±å™¨å’Œåˆ°å“åº”é‚»å±…è·¯ç”±å™¨çš„ä»£ä»·</li><li>è¿­ä»£çš„ä¸é‚»å±…è·¯ç”±å™¨äº¤æ¢è·¯ç”±ä¿¡æ¯ï¼Œè®¡ç®—è·¯ç”±ä¿¡æ¯</li><li>distance vector DVç®—æ³•  è·ç¦»çŸ¢é‡è·¯ç”±é€‰æ‹©ç®—æ³•</li></ul></li></ul></li><li>RIPï¼ˆRouting Information Protocolï¼‰æ˜¯ä¸€ç§ç”¨äºè®¡ç®—æœºç½‘ç»œä¸­çš„è·ç¦»çŸ¢é‡è·¯ç”±åè®®</li><li>OSP</li><li>DNS ä¸»æœºå‘è¦è®¿é—®-&gt;å‘DNSæŸ¥è¯¢IPåœ°å€-&gt;æ‰€æŸ¥è¯¢çš„DNSæœåŠ¡å™¨æœªçŸ¥è¦æŸ¥è¯¢çš„IPåœ°å€-&gt;å‘æ ¹åŸŸåæœåŠ¡å™¨æŸ¥è¯¢-&gt;æ ¹åŸŸåæœåŠ¡å™¨æ”¶å½•äº†è¿™ä¸ªåœ°å€ -&gt;è¿”å›åœ°å€ç»™å®¢æˆ·ç«¯-&gt;å®¢æˆ·ç«¯å»ºç«‹é€šä¿¡<br>ç½‘ç»œå±‚è§£å†³ä¸€ä¸ªä¸¤ä¸ªç½‘ç»œä¹‹é—´çš„é—®é¢˜ï¼Œé“¾è·¯å±‚è¦è§£å†³ç‚¹å¯¹ç‚¹ä¼ è¾“çš„é—®é¢˜</li><li><strong>ARP</strong>:ä»¥ç›®æ ‡IPåœ°å€ä¸ºçº¿ç´¢ï¼Œæ¥å®šä½ä¸‹ä¸€ä¸ªåº”è¯¥æ¥å—æ•°æ®åˆ†åŒ…çš„ç½‘ç»œè®¾å¤‡çš„MACåœ°å€ï¼Œæ²Ÿé€šIPå’ŒMACåœ°å€ **IP-&gt;MAC **æ•°æ®å…ƒä¸º frame å¸§ï¼Œå¸§çš„å¤´éƒ¨æ—¶ä½¿ç”¨MACåœ°å€æ¥æ ‡ç¤ºæºå’Œç›®çš„åœ°<ul><li>ARPè®°å½•ä¸€ä¸ª&lt;IP,MAC,TTL&gt; çš„è¡¨ï¼ŒTTLæ˜¯ç”Ÿå­˜å‘¨æœŸ</li></ul></li><li><strong>RARP</strong> MAC-&gt;IP<br>å®ç°æ˜¯åœ¨é€‚é…å™¨ä¸Šå®ç°çš„ï¼Œä¾‹å¦‚ä»¥å¤ªç½‘å¡</li><li>WAN å¹¿åŸŸç½‘ ç½‘ç»œå½¢å¼é‡‡ç”¨ç‚¹åˆ°ç‚¹é“¾è·¯</li><li>LAN å±€åŸŸç½‘ ä¸€èˆ¬é‡‡ç”¨å¤šç‚¹è¿æ¥çš„æ–¹å¼</li><li>å¥‡å¶æ ¡éªŒ<ul><li>å•bitå¥‡å¶æ ¡éªŒåªèƒ½æ£€æµ‹å•ä¸ªbitçº§åˆ«çš„é”™è¯¯ï¼Œä¸èƒ½çº é”™</li><li>äºŒç»´å¥‡å¶æ ¡éªŒå¯ä»¥æ£€æµ‹å’Œçº æ­£å•ä¸ªbité”™è¯¯</li><li>checksum </li><li>CRC å¾ªç¯å†—ä½™æ ¡éªŒ</li></ul></li></ul><h3 id="ç½‘ç»œæ¥å£å±‚ï¼šç­‰ä»·æ•°æ®é“¾è·¯å±‚ï¼Œä½¿ç”¨macåœ°å€"><a href="#ç½‘ç»œæ¥å£å±‚ï¼šç­‰ä»·æ•°æ®é“¾è·¯å±‚ï¼Œä½¿ç”¨macåœ°å€" class="headerlink" title="ç½‘ç»œæ¥å£å±‚ï¼šç­‰ä»·æ•°æ®é“¾è·¯å±‚ï¼Œä½¿ç”¨macåœ°å€"></a>ç½‘ç»œæ¥å£å±‚ï¼šç­‰ä»·æ•°æ®é“¾è·¯å±‚ï¼Œä½¿ç”¨macåœ°å€</h3><ul><li><p>NICçš„é©±åŠ¨ç¨‹åº</p></li><li><p>NIC æ˜¯ç½‘ç»œé€‚é…å™¨ï¼Œä¹Ÿå°±æ˜¯ç½‘å¡</p></li><li><p>PPPä¹Ÿå±äºæ•°æ®é“¾è·¯å±‚</p></li></ul><h2 id="ç‰©ç†å±‚"><a href="#ç‰©ç†å±‚" class="headerlink" title="ç‰©ç†å±‚"></a>ç‰©ç†å±‚</h2><h4 id="OSIå‚è€ƒæ¨¡å‹-æœ‰ä¸ƒä¸ªåˆ†å±‚"><a href="#OSIå‚è€ƒæ¨¡å‹-æœ‰ä¸ƒä¸ªåˆ†å±‚" class="headerlink" title="OSIå‚è€ƒæ¨¡å‹ æœ‰ä¸ƒä¸ªåˆ†å±‚"></a>OSIå‚è€ƒæ¨¡å‹ æœ‰ä¸ƒä¸ªåˆ†å±‚</h4><p>è‡ªä¸Šè€Œä¸‹ æ¯ä¸€å±‚çš„åŠŸèƒ½å’Œä½œç”¨ç”±åè®®è§„å®šï¼Œåè®®çš„å†…å®¹æ˜¯è§„èŒƒ</p><ol><li><p><strong>åº”ç”¨å±‚</strong></p><ul><li>é’ˆå¯¹ç‰¹å®šåº”ç”¨çš„åè®®</li></ul></li><li><p><strong>è¡¨ç¤ºå±‚</strong></p><ul><li>è®¾å¤‡å›ºæœ‰æ•°æ®æ ¼å¼å’Œç½‘ç»œæ ‡å‡†æ•°æ®æ ¼å¼ æ¯”å¦‚ï¼šæ¥å—ä¸åŒè¡¨ç°å½¢å¼çš„ä¿¡æ¯</li></ul></li><li><p><em>ä¼šè¯å±‚</em></p><ul><li>è´Ÿè´£é€šä¿¡ç®¡ç†ï¼Œè´Ÿè´£å»ºç«‹è¿æ¥å’Œæ–­å¼€ï¼Œç®¡ç†ä¼ è¾“å±‚ä»¥ä¸‹çš„åˆ†å±‚</li></ul></li><li><p><strong>ä¼ è¾“å±‚</strong></p><ul><li>ç®¡ç†ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œè´Ÿè´£å¯é ä¼ è¾“</li></ul></li><li><p><strong>ç½‘ç»œå±‚</strong></p><ul><li>è·¯ç”±é€‰æ‹©ä¸åœ°å€ç®¡ç†</li></ul></li><li><p><strong>æ•°æ®é“¾è·¯å±‚</strong></p><ul><li>äº’è¿è®¾å¤‡ä¹‹é—´ä¼ é€ï¼Œå’Œ è¯†åˆ«æ•°æ®å¸§</li></ul></li><li><p><strong>ç‰©ç†å±‚</strong></p><ul><li>ç•Œå®šè¿æ¥å™¨å’Œç½‘çº¿çš„è§„æ ¼ï¼Œæ¯”ç‰¹æµå’Œç”µå­ä¿¡å·è½¬æ¢</li></ul></li></ol><h2 id="ç½‘ç»œå®‰å…¨"><a href="#ç½‘ç»œå®‰å…¨" class="headerlink" title="ç½‘ç»œå®‰å…¨"></a>ç½‘ç»œå®‰å…¨</h2><ul><li>å¯¹ç§°åŠ å¯†ï¼šå‘é€æ–¹å’Œæ¥æ”¶æ–¹çš„å¯†é’¥ç›¸åŒ</li><li>å…¬å¼€å¯†é’¥åŠ å¯†ï¼šå‘é€æ–¹ä½¿ç”¨æ¥æ”¶æ–¹çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œæ¥æ”¶æ–¹ä½¿ç”¨è‡ªå·±çš„ç§é’¥è¿›è¡Œè§£å¯†</li><li>æ•°å­—ç­¾åï¼š</li></ul>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®€å†</title>
      <link href="/2023/10/21/39/"/>
      <url>/2023/10/21/39/</url>
      
        <content type="html"><![CDATA[<p>å›½å¤–çš„é‚£äº›è¯¾çš„å®éªŒæ˜¯å¯ä»¥å†™åœ¨ç®€å†ä¸Šçš„æ¯”å¦‚ 15445<br>è‹ç©¹å¤–å–é¡¹ç›® + æœåŠ¡å™¨éƒ¨ç½²</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç»„</title>
      <link href="/2023/10/16/48/"/>
      <url>/2023/10/16/48/</url>
      
        <content type="html"><![CDATA[<p>æµ·æ˜ç :<a href="https://www.cnblogs.com/godoforange/p/12003676.html">https://www.cnblogs.com/godoforange/p/12003676.html</a><br><a href="https://www.bilibili.com/video/BV1t4411e7LH?p=38&amp;spm_id_from=pageDriver&amp;vd_source=603b67fa519e58ee792d9e969a3ad8a1">https://www.bilibili.com/video/BV1t4411e7LH?p=38&amp;spm_id_from=pageDriver&amp;vd_source=603b67fa519e58ee792d9e969a3ad8a1</a></p><h2 id="åŸºæœ¬åè¯è§£é‡Š"><a href="#åŸºæœ¬åè¯è§£é‡Š" class="headerlink" title="åŸºæœ¬åè¯è§£é‡Š"></a>åŸºæœ¬åè¯è§£é‡Š</h2><p>PC ç¨‹åºè®¡æ•°å™¨<br>IR æŒ‡ä»¤å¯„å­˜å™¨ï¼Œå­˜æ”¾å½“å‰æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œ<br>MAR<br>CU æ§åˆ¶å•å…ƒï¼Œä¸ºæ§åˆ¶å™¨çš„æ ¸å¿ƒéƒ¨ä»¶ï¼Œå…¶åŠŸèƒ½æ˜¯äº§ç”Ÿå¾®æ“ä½œå‘½ä»¤åºåˆ—ã€‚<br>ALUï¼šArithmetic Logic Unitï¼Œç®—æœ¯é€»è¾‘è¿ç®—å•å…ƒï¼Œä¸ºè¿ç®—å™¨çš„æ ¸å¿ƒéƒ¨ä»¶ï¼Œå…¶åŠŸèƒ½æ˜¯è¿›è¡Œç®—æœ¯ã€é€»è¾‘è¿ç®—ã€‚<br>ACCï¼šAccumulatorï¼Œç´¯åŠ å™¨ï¼Œæ˜¯è¿ç®—å™¨ä¸­æ—¢èƒ½å­˜æ”¾è¿ç®—å‰çš„æ“ä½œæ•°ï¼Œåˆèƒ½å­˜æ”¾è¿ç®—ç»“æœçš„å¯„å­˜å™¨ã€‚<br>MQï¼šMultiplier-Quotient Registerï¼Œä¹˜å•†å¯„å­˜å™¨ï¼Œä¹˜æ³•è¿ç®—æ—¶å­˜æ”¾ä¹˜æ•°ã€é™¤æ³•æ—¶å­˜æ”¾å•†çš„å¯„å­˜å™¨ã€‚<br>MARï¼šMemory Address Registerï¼Œå­˜å‚¨å™¨åœ°å€å¯„å­˜å™¨ï¼Œåœ¨ä¸»å­˜ä¸­ç”¨æ¥å­˜æ”¾æ¬²è®¿é—®çš„å­˜å‚¨å•å…ƒçš„åœ°å€ã€‚<br>MDRï¼šMemory Data Registerï¼Œå­˜å‚¨å™¨æ•°æ®ç¼“å†²å¯„å­˜å™¨ï¼Œåœ¨ä¸»å­˜ä¸­ç”¨æ¥å­˜æ”¾ä»æŸå•å…ƒè¯»å‡ºã€æˆ–è¦å†™å…¥æŸå­˜å‚¨å•å…ƒçš„æ•°æ®ã€‚<br>I/Oï¼šInput/Output equipmentï¼Œè¾“å…¥/è¾“å‡ºè®¾å¤‡ï¼Œä¸ºè¾“å…¥è®¾å¤‡å’Œè¾“å‡ºè®¾å¤‡çš„æ€»ç§°ï¼Œç”¨äºè®¡ç®—æœºå†…éƒ¨å’Œå¤–ç•Œä¿¡æ¯çš„è½¬æ¢ä¸ä¼ é€ã€‚</p><p>MIPSï¼šMillion Instruction Per Secondï¼Œæ¯ç§’æ‰§è¡Œç™¾ä¸‡æ¡æŒ‡ä»¤æ•°ï¼Œä¸ºè®¡ç®—æœºè¿ç®—é€Ÿåº¦æŒ‡æ ‡çš„ä¸€ç§è®¡é‡å•ä½ã€‚</p><p>CPIï¼šæ‰§è¡Œä¸€æ¡æŒ‡ä»¤æ‰€éœ€çš„æ—¶é’Ÿå‘¨æœŸï¼ˆæœºå™¨ä¸»é¢‘çš„å€’æ•°)ã€‚</p><p>FLOPSï¼šæµ®ç‚¹è¿ç®—æ¬¡æ•°æ¯ç§’ã€‚</p><h2 id="ä¸»å­˜å‚¨å™¨"><a href="#ä¸»å­˜å‚¨å™¨" class="headerlink" title="ä¸»å­˜å‚¨å™¨"></a>ä¸»å­˜å‚¨å™¨</h2><ul><li>æ±‰æ˜ç </li></ul><ol><li>æ±‰æ˜ç è¦æ·»åŠ  æ£€æµ‹ä½è¦æ»¡è¶³ 2 ^k &gt;= n + k +1 kä½æ£€æµ‹ä½ ï¼Œ nä¸ºæ€»ä½æ•°</li><li>æ£€æµ‹ä½æ”¾åœ¨ 2 ^i  æ¬¡æ–¹å¤„ i = 0 , 1 , â€¦â€¦</li></ol><h2 id="è¿›åˆ¶å­—æ¯è¡¨ç¤º"><a href="#è¿›åˆ¶å­—æ¯è¡¨ç¤º" class="headerlink" title="è¿›åˆ¶å­—æ¯è¡¨ç¤º"></a>è¿›åˆ¶å­—æ¯è¡¨ç¤º</h2><p>åè¿›åˆ¶æ•°ç”¨Dè¡¨ç¤ºï¼ŒäºŒè¿›åˆ¶ç”¨Bè¡¨ç¤ºï¼Œåå…­è¿›åˆ¶æ•°ç”¨Hè¡¨ç¤ºï¼Œå…«è¿›åˆ¶ç”¨Oè¡¨ç¤ºã€‚</p><h2 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a>Cache</h2><p>å‘½ä¸­ç‡ï¼š è®¿é—®æˆåŠŸæ¬¡æ•° / æ€»è®¿é—®æ¬¡æ•°<br>å‘½ä¸­ç‡ä¸Cache çš„å®¹é‡å’Œå—é•¿æœ‰å…³<br>è®¿é—®æ•ˆç‡ = è®¿é—®Cache çš„æ—¶é—´ / å¹³å‡è®¿é—®æ—¶é—´   * 100 %<br>e è®¿é—®æ•ˆç‡ ï¼Œ h å‘½ä¸­ç‡ï¼Œ è®¿é—®Cache æ—¶é—´ä¸ºtc è®¿é—®ä¸»å­˜æ—¶é—´ä¸ºtm<br>åˆ™ e = tc / h * tc   + ( 1 - h) * t    * 100%<br>è®¿é—®æ—¶é—´ / å‘½ä¸­çš„æ—¶é—´ + æœªå‘½ä¸­çš„æ—¶é—´</p><ul><li>è¯»å†™æ“ä½œ <ul><li>å†™ ï¼š 1. å†™ç›´è¾¾æ³• ï¼š å†™æ—¶åŒæ—¶å†™å…¥Cacheå’Œä¸»å­˜</li><li><ol start="2"><li>å†™å›æ³•ï¼š åªå†™å…¥Cache ä¸å†™å…¥å†…å­˜ï¼Œå½“Cacheæ•°æ®è¢«æ›¿æ¢å‡ºå»çš„æ—¶å€™æ‰å†™ä¼šä¸»å­˜ï¼Œä¼šå¯¼è‡´Cacheå’Œä¸»å­˜çš„ä¸ä¸€è‡´</li></ol></li></ul></li><li>åœ°å€æ˜ å°„<ol><li>ç›´æ¥æ˜ å°„ Cacheä»»æ„ä¸€å—å¯ä»¥æ”¾åœ¨</li><li>å…¨ç›¸è”æ˜ å°„  ä¸»å­˜ä»»ä½•ä¸€å—å¯ä»¥æ”¾åœ¨Cacheä»»æ„ä¸€å—ä¸­</li><li></li></ol></li></ul><h2 id="DMA"><a href="#DMA" class="headerlink" title="DMA"></a>DMA</h2><ol start="3"><li>DMAå’Œ CPUäº¤æ›¿è®¿é—®<br> CPUå·¥ä½œå‘¨æœŸ  C1 ä¸“ä¾›DMAè®¿å­˜ï¼ŒC2ä¸“æ”»CPUè®¿å­˜</li></ol><ul><li>åŠŸèƒ½ï¼š<ol><li>å‘CPUç”³è¯·DMAä¼ é€</li><li>å¤„ç†æ€»çº¿æ§åˆ¶æƒçš„è½¬äº¤</li><li>ç®¡ç†ç³»ç»Ÿæ€»çº¿ï¼Œæ§åˆ¶æ•°æ®ä¼ è¾“</li><li>ç¡®å®šæ•°æ®ä¼ é€çš„é¦–åœ°å€å’Œé•¿åº¦ï¼Œä¿®æ­£ä¼ é€è¿‡ç¨‹ä¸­çš„æ•°æ®å’Œé•¿åº¦</li><li>DMAä¼ é€ç»“æŸæ—¶ï¼Œç»™å‡ºæ“ä½œå®Œæˆçš„ä¿¡å·</li></ol></li></ul><h2 id="æ•°"><a href="#æ•°" class="headerlink" title="æ•°"></a>æ•°</h2><p>æµ®ç‚¹æ•°ï¼š é˜¶ç ç»„æˆä¸º é˜¶ç¬¦ + æ•°å€¼éƒ¨åˆ†   å°¾æ•°ç”±æ•°ç¬¦å’Œæ•°å€¼ç»„æˆ<br>é˜¶ç æ˜¯ç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºçš„æ¯”å¦‚<br>2 ^15<br>å°±æ˜¯ 2 ^1111<br>å³å¯ï¼Œæ‰€ä»¥è¦ç”¨å››ä½äºŒè¿›åˆ¶æ¥è¡¨ç¤º</p><ul><li>è§„æ ¼åŒ–<br>åŸºæ•°ä¸º<br>2  è¦æ±‚å°¾æ•°æœ€é«˜ä½ä¸º 1  2 ^1<br>4                 æœ€é«˜2ä½ä¸º1  2 ^2</li></ul><p>8                 æœ€é«˜3ä½ä¸º 1  2 ^3</p><p>å·¦è§„ï¼Œæ•°æ®å·¦ç§»ï¼Œå°¾æ•°å˜å¤§<br>å°æ•°è½¬äºŒè¿›åˆ¶ï¼Œç›´æ¥æŠŠåˆ†å­å†™æˆäºŒè¿›åˆ¶ï¼Œç„¶åæ ¹æ®åˆ†æ¯æ˜¯2çš„å¤šå°‘æ¬¡æ–¹ï¼Œç§»åŠ¨å°æ•°ç‚¹å°±è¡Œäº†</p><ul><li><p>IEEE 754æ ‡å‡†<br>æ•°ç¬¦ + é˜¶ç (å«é˜¶ç¬¦) å°¾æ•°<br>å°¾æ•°ä½¿ç”¨è§„æ ¼åŒ–è¡¨ç¤ºï¼Œé 0 çš„æœ‰æ•ˆä½æœ€é«˜ä½ä¸º1</p></li><li><p>è¿ç®—<br>è¡¥ç  å·¦ç§»æ—¶ï¼Œåé¢åŠ 0 ï¼Œ å³ç§»æ—¶å‰é¢åŠ  1<br>å®šç‚¹æ•°è¿ç®—ï¼š</p></li></ul><ol><li>è¡¥ç åŠ å‡è¿ç®—ï¼Œç›´æ¥ A + B  mod 2 ^n+1</li><li>å°æ•° å°±mod 2</li></ol><h2 id="æŒ‡ä»¤ç³»ç»Ÿ"><a href="#æŒ‡ä»¤ç³»ç»Ÿ" class="headerlink" title="æŒ‡ä»¤ç³»ç»Ÿ"></a>æŒ‡ä»¤ç³»ç»Ÿ</h2><ul><li>æŒ‡ä»¤æ ¼å¼ ï¼š æ“ä½œç  + åœ°å€ç +å¯»å€æ–¹å¼<br>æŒ‡ä»¤å­—é•¿åˆ†ä¸ºå¯å˜å’Œå›ºå®šå­—é•¿<br>RISC ç²¾ç®€æŒ‡ä»¤ç³»ç»Ÿ<br>é•¿åº¦å¯å˜çš„æŒ‡ä»¤ï¼šæ“ä½œç åˆ†æ•£åœ¨æŒ‡ä»¤å­—çš„ä¸åŒå­—æ®µä¸­</li><li>åœ°å€ç </li></ul><ol><li>å››åœ°å€    op + A1 + A2 + A3 + A4  åˆ†åˆ«æ˜¯ç¬¬ä¸€æ“ä½œæ•°åœ°å€ï¼Œç¬¬äºŒæ“ä½œæ•°åœ°å€ï¼Œç»“æœåœ°å€ï¼Œä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€  (A1) OP(A2) â€“&gt; A3</li><li>ä¸‰åœ°å€  OP A1 A2 A3   </li><li>äºŒåœ°å€   OP A1 A2    (A1) OP (A2) â€“&gt; A1 æˆ–è€… (A1) OP(A2) -&gt; A2</li><li>ä¸€åœ°å€ OP A1     (ACC) OP (A1) -&gt; A1  ACCæš‚å­˜</li><li>é›¶åœ°å€ï¼Œå¯¹ACCä¸­çš„æ•°æ®è¿›è¡Œæ“ä½œ<br>å¯ä»¥ä½¿ç”¨å¯„å­˜å™¨åœ°å€æ¥æ›¿ä»£æŒ‡ä»¤åœ°å€å­—æ®µï¼Œå› ä¸ºå¯„å­˜å™¨å¾ˆå°‘ï¼Œå ç”¨çš„ä½æ•°å°‘</li></ol><ul><li>æŒ‡ä»¤å¯»å€<br>é¡ºåº PC + 1 -&gt; PC<br>è·³è·ƒ ç”±è½¬ç§»æŒ‡ä»¤ç»™å‡º<br>æ•°æ®å¯»å€ï¼š æ“ä½œç  + å¯»å€ç‰¹å¾+ å½¢å¼åœ°å€A<br>å½¢å¼åœ°å€ æ˜¯æŒ‡ä»¤å­—ä¸­çš„åœ°å€ï¼Œæœ‰æ•ˆåœ°å€æ˜¯æ“ä½œæ•°çš„çœŸå®åœ°å€</li></ul><ol><li>ç«‹å³å¯»å€ï¼š å½¢å¼åœ°å€Aå°±æ˜¯æ“ä½œæ•°ï¼ŒOP # A   # ä¸ºç«‹å¯»å€æ ‡å¿— A ä½¿ç”¨è¡¥ç </li><li>ç›´æ¥å¯»å€ï¼ŒEA = A æœ‰æ•ˆåœ°å€ç”±å½¢å¼åœ°å€ç»™å‡ºï¼Œæ— åç§»é‡</li><li>éšå«å¯»å€ é—´æ¥å¯»å€ æœ‰æ•ˆåœ°å€ç”±å½¢å¼åœ°å€ç®€ä»‹æä¾›ï¼ŒAæä¾›çš„æ˜¯EA çš„åœ°å€ï¼Œéœ€è¦å»å¯»å€ï¼ŒEA çš„åœ°å€æ‰æ˜¯æŒ‡å‘çœŸå®çš„æ•°æ®</li><li>å¯„å­˜å™¨å¯»å€ï¼ŒEA = Ri æœ‰æ•ˆåœ°å€ä¸ºå¯„å­˜å™¨çš„ç¼–å·</li><li>å¯„å­˜å™¨é—´æ¥å¯»å€ï¼š EA = (Ri) æœ‰æ•ˆåœ°å€åœ¨å¯„å­˜å™¨ä¸­</li></ol><ul><li>åŸºå€å¯»å€<ol><li>ä½¿ç”¨ä¸“ç”¨å¯„å­˜å™¨ä½œä¸ºåŸºå€å¯„å­˜å™¨<br> EA = (BR) + A BR ä¸ºåŸºå€å¯„å­˜å™¨ï¼Œä¹Ÿå°±æ˜¯ ç‰©ç†åœ°å€ = é€»è¾‘åœ°å€ + åŸºå€åœ°å€</li></ol></li></ul><h2 id="CPU-ç»„æˆ"><a href="#CPU-ç»„æˆ" class="headerlink" title="CPU ç»„æˆ"></a>CPU ç»„æˆ</h2><ul><li>å¯„å­˜å™¨<ol><li>é€šç”¨å¯„å­˜å™¨ ï¼š å­˜æ”¾æ“ä½œæ•°ï¼Œå¯ä½œä¸ºæŸä¸­å¯»å€æ–¹å¼çš„ä¸“ç”¨å¯„å­˜å™¨</li><li>æ•°æ®å¯„å­˜å™¨ï¼šå­˜æ”¾æ“ä½œæ•°ï¼Œä¸¤ä¸ªå¯„å­˜å™¨æ‹¼æ¥æ”¾åŒå€å­—é•¿çš„æ•°æ®</li><li>åœ°å€å¯„å­˜å™¨ï¼š å­˜æ”¾åœ°å€</li><li>æ¡ä»¶ç å¯„å­˜å™¨ï¼š å­˜æ”¾æ¡ä»¶ç ï¼Œå¯ä½œä¸ºç¨‹åºåˆ†æ”¯çš„ä¾æ®ï¼Œæ­£è´Ÿ,0ï¼Œæº¢å‡ºç­‰</li><li>æ§åˆ¶å’ŒçŠ¶æ€å¯„å­˜å™¨ï¼š <ul><li>æ§åˆ¶å¯„å­˜å™¨ PC -&gt; MAR -&gt; M -&gt; MDR -&gt; IR</li><li>PCç”¨æˆ·å¯è§</li><li>çŠ¶æ€å¯„å­˜å™¨ å­˜æ”¾æ¡ä»¶ç </li><li>PSW å­˜æ”¾ç¨‹åºçŠ¶æ€å­—</li></ul></li></ol></li><li>æŒ‡ä»¤å‘¨æœŸ ï¼š å–å‡ºå¹¶æ‰§è¡Œä¸€æ¡æŒ‡ä»¤æ‰€éœ€çš„å…¨éƒ¨æ—¶é—´</li><li>åŒ…æ‹¬ å–æŒ‡ï¼Œåˆ†æ =&gt; å–æŒ‡å‘¨æœŸ  æ‰§è¡Œ=&gt;æ‰§è¡Œå‘¨æœŸ</li></ul><p>æµæ°´çº¿</p><ul><li>ååç‡ï¼š å•ä½æ—¶é—´å†…æµæ°´çº¿æ‰€å®Œæˆæ‰§è¡Œæˆ–è¾“å‡ºç»“æœçš„æ•°é‡</li><li>æœ€å¤§ååç‡: Tpmax = 1 / Î”t Î”tä¸ºmæ®µæµæ°´çº¿å„æ®µæ—¶é—´</li><li>åŠ é€Ÿæ¯” ï¼š <ul><li>ä½¿ç”¨æµæ°´çº¿çš„æ–¹å¼å®Œæˆnæ¡æŒ‡ä»¤åœ¨mæ®µæµæ°´çº¿ä¸Šå…±éœ€ T = m * t + (n-1) * t   </li><li>ä½¿ç”¨ç­‰æ•ˆçš„éæµæ°´çº¿å…±éœ€ï¼š T =  nmt</li><li>åŠ é€Ÿæ¯”ç­‰äº  ä¸ä½¿ç”¨ / ä½¿ç”¨</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºç»„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äººäº‹</title>
      <link href="/2023/10/11/58/"/>
      <url>/2023/10/11/58/</url>
      
        <content type="html"><![CDATA[<h1 id="ç®€å•çš„å¢åˆ æ”¹æŸ¥ç»ƒä¹ "><a href="#ç®€å•çš„å¢åˆ æ”¹æŸ¥ç»ƒä¹ " class="headerlink" title="ç®€å•çš„å¢åˆ æ”¹æŸ¥ç»ƒä¹ "></a>ç®€å•çš„å¢åˆ æ”¹æŸ¥ç»ƒä¹ </h1><h2 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h2><pre class="line-numbers language-none"><code class="language-none">## æœåŠ¡å™¨ç»™nginxè®¾ç½®è´Ÿè½½å‡è¡¡å³å¯## å…·ä½“ç¼–ç 1. BeanUtilsçš„ä½¿ç”¨2. DigestUtils md5åŠ å¯†- ä¸€äº›å€Ÿé‰´jwtæ‹¦æˆªå™¨,md5åŠ å¯†ï¼Œå…¨å±€é”™è¯¯å¤„ç†ï¼ŒThreadLocal è¿›è¡Œçº¿ç¨‹å†…éƒ¨ä¼ é€’å˜é‡PageHelperåˆ†é¡µ```java//è®¾ç½®åˆ†é¡µå’Œåˆ†é¡µå¤§å°    PageHelper.startPage(employeePageQueryDTO.getPage(), employeePageQueryDTO.getPageSize());//è¿›è¡ŒæŸ¥è¯¢    Page&lt;Employee&gt; page = employeeMapper.pageQuery(employeePageQueryDTO);//åç»­å®šä¹‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>xmlä¸­çš„mapperç¤ºä¾‹:</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pageQuery<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.sky.entity.Employee<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        select * from employee        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name != null and name != ''<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                and name like concat('%',#{name},'%')            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">&gt;</span></span>        order by create_time desc    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹äºæ—¶é—´æ ¼å¼çš„å…¨å±€ç®¡ç†ï¼Œåœ¨mvcconfigä¸­</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">extendMessageConverters</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> converters<span class="token punctuation">)</span> <span class="token punctuation">{</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ‰©å±•æ¶ˆæ¯è½¬æ¢å™¨..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯è½¬æ¢å™¨å¯¹è±¡</span>    <span class="token class-name">MappingJackson2HttpMessageConverter</span> converter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MappingJackson2HttpMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//éœ€è¦ä¸ºæ¶ˆæ¯è½¬æ¢å™¨è®¾ç½®ä¸€ä¸ªå¯¹è±¡è½¬æ¢å™¨ï¼Œå¯¹è±¡è½¬æ¢å™¨å¯ä»¥å°†Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonæ•°æ®</span>    converter<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JacksonObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//å°†è‡ªå·±çš„æ¶ˆæ¯è½¬åŒ–å™¨åŠ å…¥å®¹å™¨ä¸­</span>    converters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>converter<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>aop</p></li><li><p>Apache POI æ¥è¿›è¡Œæ–‡ä»¶æ ¼å¼è½¬æ¢ï¼Œå¯¼å‡ºä¸ºexcel</p></li><li><p>Apache ECharts å¯è§†åŒ–å›¾è¡¨</p></li><li><p><strong>Spring Task</strong> å®šæ—¶ä»»åŠ¡</p></li><li><p>HttpClient<br><strong>HttpClientçš„æ ¸å¿ƒAPIï¼š</strong></p></li><li><p>HttpClientï¼šHttpå®¢æˆ·ç«¯å¯¹è±¡ç±»å‹ï¼Œä½¿ç”¨è¯¥ç±»å‹å¯¹è±¡å¯å‘èµ·Httpè¯·æ±‚ã€‚</p></li><li><p>HttpClientsï¼šå¯è®¤ä¸ºæ˜¯æ„å»ºå™¨ï¼Œå¯åˆ›å»ºHttpClientå¯¹è±¡ã€‚</p></li><li><p>CloseableHttpClientï¼šå®ç°ç±»ï¼Œå®ç°äº†HttpClientæ¥å£ã€‚</p></li><li><p>HttpGetï¼šGetæ–¹å¼è¯·æ±‚ç±»å‹ã€‚</p></li><li><p>HttpPostï¼šPostæ–¹å¼è¯·æ±‚ç±»å‹ã€‚</p></li></ul><p><strong>HttpClientå‘é€è¯·æ±‚æ­¥éª¤ï¼š</strong></p><ul><li><p>åˆ›å»ºHttpClientå¯¹è±¡</p></li><li><p>åˆ›å»ºHttpè¯·æ±‚å¯¹è±¡</p></li><li><p>è°ƒç”¨HttpClientçš„executeæ–¹æ³•å‘é€è¯·æ±‚</p></li></ul><h1 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h1><p>å­¦ç”Ÿç®¡ç†ç³»ç»Ÿ</p><p>ä¸€ï¼åŠŸèƒ½è¦æ±‚</p><ul><li><p>æ·»åŠ å­¦ç”ŸåŠŸèƒ½ï¼šå§“åã€å­¦å·ã€æ€§åˆ«ã€å‡ºç”Ÿå¹´æœˆæ—¥ã€‚ï¼ˆå­¦å·è‡ªåŠ¨ç”Ÿæˆä¸”å”¯ä¸€ï¼‰</p></li><li><p>æ·»åŠ å­¦ç”Ÿæˆç»©åŠŸèƒ½ï¼šæ¯ä¸ªäººéƒ½æœ‰æ•°å­¦ã€Javaã€è‹±è¯­ã€ä½“è‚²å››é—¨è¯¾ï¼Œå¯åˆ†è¯¾ç¨‹è¾“å…¥æˆç»©ã€‚</p></li><li><p>æ ¹æ®å­¦ç”Ÿå­¦å·æŸ¥æ‰¾å­¦ç”Ÿæˆç»©åŠŸèƒ½ï¼šåœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºå§“åã€å­¦å·å’Œæˆç»©ï¼Œå­¦å·ä¸å­˜åœ¨çš„èƒ½ç»™å‡ºæç¤ºä¿¡æ¯ã€‚</p></li><li><p>æ ¹æ®å­¦ç”Ÿå§“åï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼‰æŸ¥æ‰¾å­¦ç”Ÿæˆç»©åŠŸèƒ½ï¼šå¹¶åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºå§“åã€å­¦å·å’Œæˆç»©ï¼Œå¦‚æœæœ‰å¤šä¸ªç›¸åŒå§“åå­¦ç”Ÿå­˜åœ¨ï¼Œä¸€èµ·æ˜¾ç¤ºå‡ºæ¥ï¼Œå§“åä¸å­˜åœ¨çš„ç»™å‡ºæç¤ºä¿¡æ¯ã€‚</p></li><li><p>æ”¯æŒå¯¹å•ä¸ªå­¦ç”Ÿå„ç§‘æˆç»©ç”»å‡ºæŸ±çŠ¶åˆ†å¸ƒå›¾ã€‚</p></li><li><p>å­¦ç”Ÿä¿¡æ¯çš„ä¿®æ”¹ä¸åˆ é™¤åŠŸèƒ½ï¼šä¸èƒ½ä¿®æ”¹å­¦å·ã€‚</p></li><li><p>ç”Ÿæˆå­¦ç”Ÿå­¦ä¹ æƒ…å†µæŠ¥è¡¨åŠŸèƒ½ï¼šæŠ¥è¡¨åŒ…å«å­¦å·ã€å§“åã€å„ç§‘ç›®æˆç»©åŠå¯¹åº”çš„è¯¥ç§‘ç›®ç­çº§å¹³å‡å€¼ï¼Œæ€»æˆç»©ä»¥åŠç­çº§æ€»æˆç»©å¹³å‡å€¼ï¼Œå¹¶å°†è¯¥æ’åºç»“æœè¾“å‡ºè‡³excelæ–‡ä»¶ã€‚</p></li></ul><h2 id="æ•°æ®åº“è®¾è®¡"><a href="#æ•°æ®åº“è®¾è®¡" class="headerlink" title="æ•°æ®åº“è®¾è®¡"></a>æ•°æ®åº“è®¾è®¡</h2><ol><li>admin<pre class="line-numbers language-css" data-language="css"><code class="language-css">idusername password<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li>student<pre class="line-numbers language-css" data-language="css"><code class="language-css">id <span class="token punctuation">(</span>å­¦å·è‡ªåŠ¨ç”Ÿæˆä¸”å”¯ä¸€<span class="token punctuation">)</span>namebirthday<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li>score<pre class="line-numbers language-css" data-language="css"><code class="language-css">idMathJavaEnglishPE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>sqlè®¾è®¡</li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> management<span class="token punctuation">;</span><span class="token keyword">USE</span> management<span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> admin<span class="token punctuation">(</span>    Id <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>    Username <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    Password <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> student<span class="token punctuation">(</span>    Id <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>    StudentId <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">UNIQUE</span><span class="token punctuation">,</span>    StudentName <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    Birthday <span class="token keyword">date</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> score<span class="token punctuation">(</span>    Id <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>    Math <span class="token keyword">DOUBLE</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    Java <span class="token keyword">DOUBLE</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    English <span class="token keyword">DOUBLE</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    PE <span class="token keyword">DOUBLE</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ps: ä½¿ç”¨æ–¹å¼ mysql -u username -p  &lt;  xxx.sql ï¼Œä¹‹åè¾“å…¥å¯†ç å³å¯</p><p>xmlé…ç½®<br>druid<br>knife4jç”Ÿæˆæ¥å£æ–‡æ¡£</p><ul><li>éƒ¨ç½²<br>æœåŠ¡å™¨é…ç½®:<br>mysql<br>å°†æœåŠ¡å™¨ä¸Šçš„mysqlé…ç½®æ–‡ä»¶ä¿®æ”¹<pre class="line-numbers language-css" data-language="css"><code class="language-css">vim /etc/mysql/mysql.conf.d/mysqld.cnfå°†bind-address çš„127.0.0.1 æ”¹ä¸º  0.0.0.0 æœåŠ¡å™¨å¼€æ”¾ç«¯å£ 3306<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>redis<br>1.æ‰“å¼€redisçš„é…ç½®æ–‡ä»¶â€œredis.confâ€ã€‚</li></ul><p>2.å°†â€œbind 127.0.0.1â€æ³¨é‡Šæ‰ã€‚</p><p>3.å°†â€œprotected-mode yesâ€æ”¹æˆâ€œprotected-mode noâ€ã€‚</p><p>4.æ·»åŠ ä»¥ä¸‹ä¸€è¡Œä»£ç ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">daemonize no<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¤åˆ¶</p><p>5.é‡å¯redisæœåŠ¡å³å¯<br><code>sudo service redis restart</code></p><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>knif4jæ³¨æ„è®¾ç½®å¥½æ‰«æçš„åŒ…</p><h2 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h2><ol><li>common module<ol><li>è¿”å›ç±»å°è£…Result</li><li>pageHelperæ‰€éœ€çš„åˆ†é¡µå‚æ•°</li></ol></li><li></li></ol><h1 id="è‹ç©¹å¤–å–é¡¹ç›®"><a href="#è‹ç©¹å¤–å–é¡¹ç›®" class="headerlink" title="è‹ç©¹å¤–å–é¡¹ç›®"></a>è‹ç©¹å¤–å–é¡¹ç›®</h1><p>ä»“åº“ï¼š å·²å®Œæˆ <a href="https://github.com/qiuEly/sky-take-out">https://github.com/qiuEly/sky-take-out</a></p><h2 id="çŸ¥è¯†"><a href="#çŸ¥è¯†" class="headerlink" title="çŸ¥è¯†"></a>çŸ¥è¯†</h2><ol><li>å½“å‰ç«¯ä¼ è¾“çš„æ•°æ®ä¸å®ä½“ç±»å·®è·æ¯”è¾ƒå¤§æ—¶ä½¿ç”¨DTOæ¥å°è£…</li><li><a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93/2987565?fromModule=lemma_inlink">æ•°æ®ä¼ è¾“</a>å¯¹è±¡ï¼ˆDTOï¼‰(Data Transfer Object)ï¼Œæ˜¯ä¸€ç§<a href="https://baike.baidu.com/item/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/1212549?fromModule=lemma_inlink">è®¾è®¡æ¨¡å¼</a>ä¹‹é—´ä¼ è¾“æ•°æ®çš„è½¯ä»¶<a href="https://baike.baidu.com/item/%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F/56497111?fromModule=lemma_inlink">åº”ç”¨ç³»ç»Ÿ</a>ã€‚æ•°æ®ä¼ è¾“ç›®æ ‡å¾€å¾€æ˜¯<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E5%AF%B9%E8%B1%A1/3351868?fromModule=lemma_inlink">æ•°æ®è®¿é—®å¯¹è±¡</a>ä»æ•°æ®åº“ä¸­æ£€ç´¢æ•°æ®ã€‚æ•°æ®ä¼ è¾“å¯¹è±¡ä¸æ•°æ®äº¤äº’å¯¹è±¡æˆ–æ•°æ®è®¿é—®å¯¹è±¡ä¹‹é—´çš„å·®å¼‚æ˜¯ä¸€ä¸ªä»¥ä¸å…·æœ‰ä»»ä½•è¡Œä¸ºé™¤äº†å­˜å‚¨å’Œæ£€ç´¢çš„æ•°æ®ï¼ˆè®¿é—®å’Œå­˜å–å™¨ï¼‰ã€‚</li><li>ThreadLocal ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯å¯ä»¥ç”¨äºä¿å­˜Threadçš„ä¸€ä¸ªå˜é‡ï¼Œç›¸å½“äºè®¾ç½®çº¿ç¨‹å†…éƒ¨çš„å˜é‡ï¼Œå¯ä»¥ç”¨æ¥å­˜tokenå’Œcookie</li><li>mybatis-plus åˆ†é¡µæ’ä»¶çš„ä½¿ç”¨ï¼Œå¹¶ä¸”é…åˆqueryWrapperæ¥å°è£…è‡ªå®šä¹‰æŸ¥è¯¢</li><li>ä½¿ç”¨é…ç½®jacksonå’Œjavaæ ¼å¼äº’ç›¸è½¬åŒ–å™¨</li><li>â€˜ALTER TABLE table_name AUTO_INCREMENT = value;â€™  è®°å¾—åˆ é™¤æ²¡æœ‰ç”¨çš„æ•°æ®ä¹‹åå¹¶ä¸”è®©valueå¤§äºå½“å‰çš„è¡Œæ•°</li><li>mp å®ç°é€’å¢éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ ä¸Š â€˜mybatis-plus:<br>global-config:<br>db-config:<br>id-type: autoâ€™</li><li>è‡ªå®šä¹‰æ³¨è§£ï¼š <ol><li><p><strong><code>@Target</code> æ³¨è§£</strong>ï¼š</p><p> @Targetæ³¨è§£ï¼š</p><ul><li>ä½œç”¨ï¼š<code>@Target</code> æ³¨è§£ç”¨äºæŒ‡å®šå¯ä»¥å°†æ³¨è§£åº”ç”¨åˆ°çš„å…ƒç´ ç±»å‹ã€‚å®ƒå†³å®šäº†æ³¨è§£å¯ä»¥ç”¨äºæ ‡è®°å“ªäº›ç¨‹åºå…ƒç´ ï¼Œä¾‹å¦‚ç±»ã€æ–¹æ³•ã€å­—æ®µç­‰ã€‚</li><li>å‚æ•°ï¼š<code>@Target</code> çš„å‚æ•°æ˜¯ä¸€ä¸ª <code>ElementType</code> æšä¸¾æ•°ç»„ï¼Œä½ å¯ä»¥åœ¨å…¶ä¸­æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªç›®æ ‡å…ƒç´ ç±»å‹ã€‚å¯¹äº <code>@ComponentScan</code> æ¥è¯´ï¼Œ<code>@Target(ElementType.TYPE)</code> è¡¨ç¤ºè¯¥æ³¨è§£å¯ä»¥ç”¨äºæ ‡è®°ç±»ã€‚</li></ul></li><li><p><strong><code>@Retention</code> æ³¨è§£</strong>ï¼š</p><ul><li>ä½œç”¨ï¼š<code>@Retention</code> æ³¨è§£ç”¨äºæŒ‡å®šæ³¨è§£åœ¨ç¼–è¯‘åæ˜¯å¦ä¿ç•™åˆ°è¿è¡Œæ—¶ï¼Œå¹¶ä¸”æ˜¯å¦å¯ä»¥é€šè¿‡åå°„è®¿é—®æ³¨è§£ã€‚æœ‰ä¸‰ä¸ªå¯èƒ½çš„ <code>RetentionPolicy</code> å€¼ï¼š<code>SOURCE</code>ã€<code>CLASS</code> å’Œ <code>RUNTIME</code>ã€‚</li><li>å‚æ•°ï¼š<code>@Retention</code> çš„å‚æ•°æ˜¯ä¸€ä¸ª <code>RetentionPolicy</code> æšä¸¾å€¼ã€‚<code>@Retention(RetentionPolicy.RUNTIME)</code> è¡¨ç¤ºæ³¨è§£ä¼šåœ¨è¿è¡Œæ—¶ä¿ç•™ï¼Œå¹¶å¯ä»¥é€šè¿‡åå°„è®¿é—®ã€‚</li></ul></li><li><p><strong><code>@Documented</code> æ³¨è§£</strong>ï¼š</p><ul><li>ä½œç”¨ï¼š<code>@Documented</code> æ³¨è§£ç”¨äºæŒ‡ç¤ºè¯¥æ³¨è§£åº”è¯¥åŒ…å«åœ¨ç”Ÿæˆçš„æ–‡æ¡£ä¸­ã€‚å¦‚æœä½ æƒ³è¦å°†æ³¨è§£çš„ä¿¡æ¯åŒ…å«åœ¨ Java æ–‡æ¡£ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>@Documented</code> æ³¨è§£ã€‚</li><li>å‚æ•°ï¼š<code>@Documented</code> æ³¨è§£æ²¡æœ‰å‚æ•°ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ ‡è®°æ³¨è§£ï¼Œç”¨äºæŒ‡ç¤ºæ–‡æ¡£å·¥å…·è¦åŒ…æ‹¬æ³¨è§£ä¿¡æ¯ã€‚</li></ul></li></ol></li><li>é˜¿é‡Œäº‘ossä½¿ç”¨ï¼Œä¸»è¦ä½¿ç”¨çš„æ˜¯spring ä¸­çš„MultipartFile </li><li>Redisçš„ä½¿ç”¨</li><li>é€šè¿‡ç»™RestControllerè®¾ç½®æ ‡è¯†åæ¥é˜²æ­¢ä¾èµ–æ³¨å…¥æ— æ³•è¯†åˆ«ç›¸åŒåç§°çš„Bean</li><li>vivo50<blockquote><p><strong>HttpClientçš„æ ¸å¿ƒAPIï¼š</strong></p></blockquote></li></ol><ul><li><p>HttpClientï¼šHttpå®¢æˆ·ç«¯å¯¹è±¡ç±»å‹ï¼Œä½¿ç”¨è¯¥ç±»å‹å¯¹è±¡å¯å‘èµ·Httpè¯·æ±‚ã€‚</p></li><li><p>HttpClientsï¼šå¯è®¤ä¸ºæ˜¯æ„å»ºå™¨ï¼Œå¯åˆ›å»ºHttpClientå¯¹è±¡ã€‚</p></li><li><p>CloseableHttpClientï¼šå®ç°ç±»ï¼Œå®ç°äº†HttpClientæ¥å£ã€‚</p></li><li><p>HttpGetï¼šGetæ–¹å¼è¯·æ±‚ç±»å‹ã€‚</p></li><li><p>HttpPostï¼šPostæ–¹å¼è¯·æ±‚ç±»å‹ã€‚</p></li></ul><p><strong>HttpClientå‘é€è¯·æ±‚æ­¥éª¤ï¼š</strong></p><ul><li><p>åˆ›å»ºHttpClientå¯¹è±¡</p></li><li><p>åˆ›å»ºHttpè¯·æ±‚å¯¹è±¡</p></li><li><p>è°ƒç”¨HttpClientçš„executeæ–¹æ³•å‘é€è¯·æ±‚<br>ç”¨ä¾‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sky<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpEntity</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>client<span class="token punctuation">.</span>methods<span class="token punctuation">.</span></span><span class="token class-name">CloseableHttpResponse</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>client<span class="token punctuation">.</span>methods<span class="token punctuation">.</span></span><span class="token class-name">HttpGet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">CloseableHttpClient</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">HttpClients</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">EntityUtils</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@SpringBootTest</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HttpClientTest</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * æµ‹è¯•é€šè¿‡httpclientå‘é€GETæ–¹å¼çš„è¯·æ±‚     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGET</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>        <span class="token comment">//åˆ›å»ºhttpclientå¯¹è±¡</span>        <span class="token class-name">CloseableHttpClient</span> httpClient <span class="token operator">=</span> <span class="token class-name">HttpClients</span><span class="token punctuation">.</span><span class="token function">createDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºè¯·æ±‚å¯¹è±¡</span>        <span class="token class-name">HttpGet</span> httpGet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpGet</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8080/user/shop/status"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å‘é€è¯·æ±‚ï¼Œæ¥å—å“åº”ç»“æœ</span>        <span class="token class-name">CloseableHttpResponse</span> response <span class="token operator">=</span> httpClient<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>httpGet<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è·å–æœåŠ¡ç«¯è¿”å›çš„çŠ¶æ€ç </span>        <span class="token keyword">int</span> statusCode <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getStatusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æœåŠ¡ç«¯è¿”å›çš„çŠ¶æ€ç ä¸ºï¼š"</span> <span class="token operator">+</span> statusCode<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">HttpEntity</span> entity <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token class-name">EntityUtils</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æœåŠ¡ç«¯è¿”å›çš„æ•°æ®ä¸ºï¼š"</span> <span class="token operator">+</span> body<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å…³é—­èµ„æº</span>        response<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        httpClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><ol start="13"><li>spring cache<br>åœ¨SpringCacheä¸­æä¾›äº†å¾ˆå¤šç¼“å­˜æ“ä½œçš„æ³¨è§£ï¼Œå¸¸è§çš„æ˜¯ä»¥ä¸‹çš„å‡ ä¸ªï¼š</li></ol><table><thead><tr><th><strong>æ³¨è§£</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>@EnableCaching</td><td>å¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½ï¼Œé€šå¸¸åŠ åœ¨å¯åŠ¨ç±»ä¸Š</td></tr><tr><td>@Cacheable</td><td>åœ¨æ–¹æ³•æ‰§è¡Œå‰å…ˆæŸ¥è¯¢ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼›å¦‚æœæ²¡æœ‰ç¼“å­˜æ•°æ®ï¼Œè°ƒç”¨æ–¹æ³•å¹¶å°†æ–¹æ³•è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­</td></tr><tr><td>@CachePut</td><td>å°†æ–¹æ³•çš„è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­</td></tr><tr><td>@CacheEvict</td><td>å°†ä¸€æ¡æˆ–å¤šæ¡æ•°æ®ä»ç¼“å­˜ä¸­åˆ é™¤</td></tr></tbody></table><p>åœ¨spring booté¡¹ç›®ä¸­ï¼Œä½¿ç”¨ç¼“å­˜æŠ€æœ¯åªéœ€åœ¨é¡¹ç›®ä¸­å¯¼å…¥ç›¸å…³ç¼“å­˜æŠ€æœ¯çš„ä¾èµ–åŒ…ï¼Œå¹¶åœ¨å¯åŠ¨ç±»ä¸Šä½¿ç”¨@EnableCachingå¼€å¯ç¼“å­˜æ”¯æŒå³å¯ã€‚</p><ol start="14"><li>spring task å®šæ—¶ä»»åŠ¡</li><li>websocket<br>WebSocket æ˜¯åŸºäº TCP çš„ä¸€ç§æ–°çš„<strong>ç½‘ç»œåè®®</strong>ã€‚å®ƒå®ç°äº†æµè§ˆå™¨ä¸æœåŠ¡å™¨å…¨åŒå·¥é€šä¿¡â€”â€”æµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦å®Œæˆä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±å¯ä»¥åˆ›å»º<strong>æŒä¹…æ€§</strong>çš„è¿æ¥ï¼Œ å¹¶è¿›è¡Œ<strong>åŒå‘</strong>æ•°æ®ä¼ è¾“ã€‚</li></ol><p><strong>HTTPåè®®å’ŒWebSocketåè®®å¯¹æ¯”ï¼š</strong></p><ul><li><p>HTTPæ˜¯<strong>çŸ­è¿æ¥</strong></p></li><li><p>WebSocketæ˜¯<strong>é•¿è¿æ¥</strong></p></li><li><p>HTTPé€šä¿¡æ˜¯<strong>å•å‘</strong>çš„ï¼ŒåŸºäºè¯·æ±‚å“åº”æ¨¡å¼</p></li><li><p>WebSocketæ”¯æŒ<strong>åŒå‘</strong>é€šä¿¡</p></li><li><p>HTTPå’ŒWebSocketåº•å±‚éƒ½æ˜¯TCPè¿æ¥</p></li></ul><ol start="16"><li>Apache ECharts</li><li>Apache POI</li><li>éƒ¨ç½²ï¼ï¼ï¼</li></ol><ul><li>buildè¿‡ç¨‹ä¸­å‡ºç°æ£€æµ‹é—®é¢˜ <a href="https://www.cnblogs.com/SparkMore/p/15919302.html">https://www.cnblogs.com/SparkMore/p/15919302.html</a></li></ul><ol start="19"><li>å½“springbooté¡¹ç›®ä¸è¯†åˆ«applicationé…ç½®æ–‡ä»¶æ—¶ï¼Œå³é”®resource -&gt; Mark Directory as &gt; Resources Root</li></ol><h2 id="ä¿®æ”¹å»ºè®®Todo"><a href="#ä¿®æ”¹å»ºè®®Todo" class="headerlink" title="ä¿®æ”¹å»ºè®®Todo:"></a>ä¿®æ”¹å»ºè®®Todo:</h2><ol><li>å¯†ç åŠ å¯† ä½¿ç”¨ security + jwt ï¼Œå‰ç«¯ä¿å­˜session</li><li>å¾®ä¿¡å°ç¨‹åºå¼€å‘ + å‰ç«¯ vue </li><li>dockerç¯å¢ƒä¸‹ä½¿ç”¨</li></ol><h1 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h1><ol><li>admin ç•Œé¢æ¥ç®¡ç†</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>blogæ­å»º</title>
      <link href="/2023/09/30/23/"/>
      <url>/2023/09/30/23/</url>
      
        <content type="html"><![CDATA[<h1 id="é¡¹ç›®ä»‹ç»"><a href="#é¡¹ç›®ä»‹ç»" class="headerlink" title="é¡¹ç›®ä»‹ç»"></a>é¡¹ç›®ä»‹ç»</h1><p>ä¸€æ¬¡è‡ªå·±blogæ‰‹åŠ¨æ­å»ºè®°å½•<br>æŠ€æœ¯æ ˆï¼š</p><ul><li>å‰ç«¯ï¼švue</li><li>åç«¯:   express redis</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯å­¦ä¹ </title>
      <link href="/2023/09/29/36/"/>
      <url>/2023/09/29/36/</url>
      
        <content type="html"><![CDATA[<h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><ul><li>headä¸­çš„<ul><li>metaçš„ä½¿ç”¨ï¼Œdescriptionå¯ä»¥ç”¨æ¥è®°å½•æ–‡ç« ä¸»è¦å†…å®¹ï¼Œæ–¹ä¾¿æœç´¢å¼•æ“ä½¿ç”¨</li><li><code>&lt;link rel="icon" href="./favicon.ico"&gt;</code> å¼•å…¥ico</li></ul></li></ul><h1 id="Vue"><a href="#Vue" class="headerlink" title="Vue"></a>Vue</h1><p>æ–‡ä»¶ç»“æ„:</p><ul><li>api å­˜æ”¾å°è£…äº†Ajaxçš„è¯·æ±‚æ–‡ä»¶</li><li>components å…¬å…±ç»„ä»¶å­˜æ”¾ç›®å½•</li><li>views è§†å›¾ç»„ä»¶</li><li>App.vue ä¸»ç»„ä»¶ï¼Œå…¥å£æ–‡ä»¶</li><li>main.ts é¡¹ç›®çš„è·¯å£æ–‡ä»¶</li><li>router.tsè·¯ç”±æ–‡ä»¶</li></ul><h2 id="æ‰“åŒ…éƒ¨ç½²åœ¨nginxä¸Š"><a href="#æ‰“åŒ…éƒ¨ç½²åœ¨nginxä¸Š" class="headerlink" title="æ‰“åŒ…éƒ¨ç½²åœ¨nginxä¸Š"></a>æ‰“åŒ…éƒ¨ç½²åœ¨nginxä¸Š</h2><p>ä½¿ç”¨npm run build è¿›è¡Œæ‰“åŒ…ï¼Œå°†diståŒ…æ”¾åœ¨/usr/share/nginx/html<br>å³å¯ï¼Œç„¶årootè·¯å¾„è¦å†™å…¨<br>æœ¬åœ°ä½¿ç”¨vueï¼ŒåŸºäºè„šæ‰‹æ¶å®‰è£…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> create vue@latest<span class="token builtin class-name">cd</span> xxx<span class="token function">npm</span> <span class="token function">install</span><span class="token function">npm</span> run dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åŸºç¡€è¯­æ³•:</li><li>v-bind:xxx ç»‘å®šè¯­æ³•ï¼Œå¯ç®€å†™ä¸º:xxx å¦‚æœç»‘å®šçš„æ˜¯å¤šä¸ªå€¼ï¼Œæ¯”å¦‚æ˜¯ä¸€ä¸ªjsonæ•°ç»„ï¼Œé‚£ä¹ˆå¯ä»¥æŠŠxxxçœç•¥ç•™ä¸‹ v-bind: = aaa</li><li>v-on ç›‘å¬äº‹ä»¶ ç®€å†™ä¸º @xxx åŠ¨æ€ç»‘å®šäº‹ä»¶ <code>@[äº‹ä»¶åˆ—è¡¨] = "äº‹ä»¶å‡½æ•°"</code></li><li><code>&lt;template&gt;</code> ä¸ä¼šè¢«æ¸²æŸ“ï¼Œä¸€èˆ¬ä½œä¸ºv-ifæ ¹</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºä½ç½®ç´¢å¼•ï¼š<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;li v-for="(value, key, index) in myObject"&gt;  {{ index }}. {{ key }}: {{ value }}&lt;/li&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li>setupæ˜¯åœ¨å»ºç«‹æ¸²æŸ“ä¹‹å‰å°±ä¼šè°ƒç”¨</li><li>æƒ³è¦ä½¿ç”¨å˜é‡å°±å¿…é¡»è¦æŠŠå˜é‡return å‡ºæ¥å³å¯</li><li>ä½¿ç”¨è¯­æ³•ç³–å¯ä»¥ç®€åŒ–ä»£ç ï¼Œä¸éœ€è¦ä¸€ä¸ªä¸ªreturnäº†<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;script setup&gt;     const msg = 'Hello Vite + Vue 3!'  &lt;/script&gt;  &lt;template&gt;    &lt;div id="app"&gt;      &lt;h1&gt;{{msg}}&lt;/h1&gt;    &lt;/div&gt;&lt;/template&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>ä½¿ç”¨reactiveå‡½æ•°æ¥è¿”å›ä¸€ä¸ªå“åº”å¼å¯¹è±¡<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;script setup&gt;     import {reactive} from "vue";     const state = reactive({       msg: "hell world"     })     const setState = ()=&gt;{       state.msg = "hello vite"     }  &lt;/script&gt;  &lt;template&gt;    {{state.msg}}    &lt;button @click="setState"&gt;click&lt;/button&gt;  &lt;/template&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>ä½¿ç”¨refæ¥è¿”å›ä¸€ä¸ªç®€å•å“åº”å¼å¯¹è±¡<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;script setup&gt;      import {ref} from "vue";      const msg = ref(0);  &lt;/script&gt;  &lt;template&gt;    &lt;div id="app"&gt;      &lt;button @click="msg++"&gt;count is: {{ msg }}&lt;/button&gt;    &lt;/div&gt;&lt;/template&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>computedå¯¹è±¡å‡½æ•°ï¼Œé‡Œé¢ä¼ è¿›å»è®¡ç®—é€»è¾‘<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;script setup&gt;  import {computed, ref} from "vue";    const list = ref([1,2,3,4,5]);    const filterlist = computed(()=&gt;{      return list.value.filter(item=&gt;item&gt;3)    })  &lt;/script&gt;  &lt;template&gt;    &lt;div&gt;    &lt;ul&gt;      &lt;li v-for="item in filterlist" :key="item"&gt;{{item}}&lt;/li&gt;      &lt;/ul&gt;  &lt;/div&gt;&lt;/template&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>watch ç›‘å¬æ•°æ®çš„å˜åŒ–ï¼Œå¦‚æœæ•°æ®å˜åŒ–å°±æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œå‰©ä¸‹ä¸¤ä¸ªå‚æ•°ï¼Œimmediate æ§åˆ¶ç«‹åˆ»æ‰§è¡Œï¼Œdeepå¼€å¯æ·±åº¦ç›‘å¬<ul><li>ç›‘å¬ä¸€ä¸ª  <pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;script setup&gt;  import {ref, watch} from "vue";  const count = ref(0);  watch(count,(newCount, oldCount) =&gt; {    console.log(`new count is: ${newCount}, old count is: ${oldCount}`)  })  const increment = () =&gt; {    count.value++;  }  &lt;/script&gt;  &lt;template&gt;  &lt;button @click="increment"&gt;count is: {{count}}&lt;/button&gt;  &lt;/template&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>ç›‘å¬å¤šä¸ªæ•°æ®ï¼Œåªéœ€è¦æŠŠå‚æ•°åŒ–æˆæ•°ç»„å³å¯<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">watch([count, name], ([newCount, newName],[oldCount,oldName])=&gt;</span><span class="token punctuation">{</span>  console.<span class="token function">log</span><span class="token punctuation">(</span>`countæˆ–è€…nameå˜åŒ–äº†ï¼Œ[newCount<span class="token punctuation">,</span> newName]<span class="token punctuation">,</span>[oldCount<span class="token punctuation">,</span>oldName]<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul></li><li>immediate åœ¨åˆ›å»ºæ—¶ç«‹åˆ»å‡ºå‘<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">watch(count, (newValue, oldValue)=&gt;</span><span class="token punctuation">{</span>   <span class="token selector">console.log(`countå‘ç”Ÿäº†å˜åŒ–ï¼Œè€å€¼ä¸º$</span><span class="token punctuation">{</span>oldValue<span class="token punctuation">}</span><span class="token selector">,æ–°å€¼ä¸º$</span><span class="token punctuation">{</span>newValue<span class="token punctuation">}</span>`<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token selector">,</span><span class="token punctuation">{</span>   <span class="token property">immediate</span><span class="token punctuation">:</span> true <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>deepé€šè¿‡watchç›‘å¬çš„refå¯¹è±¡æ˜¯æµ…å±‚ç›‘å¬çš„ï¼Œç›´æ¥ä¿®æ”¹åµŒå¥—çš„å¯¹è±¡å±æ€§æ˜¯ä¸ä¼šå›è°ƒçš„ï¼Œä½†æ˜¯å¼€å¯ä¹‹åå°±å¯ä»¥å›è°ƒäº†<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;script setup&gt;  // 1. å¯¼å…¥watch  import { ref, watch } from 'vue'  const state = ref({ count: 0 })  // 2. ç›‘å¬å¯¹è±¡state  watch(state, ()=&gt;{    console.log('æ•°æ®å˜åŒ–äº†')  })  const changeStateByCount = ()=&gt;{    // ç›´æ¥ä¿®æ”¹ä¸ä¼šå¼•å‘å›è°ƒæ‰§è¡Œ    state.value.count++  }&lt;/script&gt;&lt;script setup&gt;  // 1. å¯¼å…¥watch  import { ref, watch } from 'vue'  const state = ref({ count: 0 })  // 2. ç›‘å¬å¯¹è±¡state å¹¶å¼€å¯deep  watch(state, ()=&gt;{    console.log('æ•°æ®å˜åŒ–äº†')  },{deep:true})  const changeStateByCount = ()=&gt;{    // æ­¤æ—¶ä¿®æ”¹å¯ä»¥è§¦å‘å›è°ƒ    state.value.count++  }&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>çˆ¶ç»„ä»¶ä¼ å€¼ç»™å­ç»„ä»¶: 1.å¼•å…¥å­ç»„ä»¶ï¼Œä½¿ç”¨å­ç»„ä»¶å¹¶ç»‘å®šå­ç»„ä»¶ä¸­propsä¸­çš„å±æ€§ 2. å­ç»„ä»¶ä½¿ç”¨definePropsæ¥æ¥å—çˆ¶ç»„ä»¶çš„ä¼ å€¼<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">çˆ¶ç»„ä»¶&lt;script setup&gt;  import son from './components/money.vue'  &lt;/script&gt;    &lt;template&gt;    &lt;son  message="hello world"/&gt;  &lt;/template&gt;&lt;!--å­ç»„ä»¶--&gt;&lt;script setup&gt;  const props =  defineProps({    message : String  })  &lt;/script&gt;  &lt;template&gt;    {{message}}  &lt;/template&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å­ç»„ä»¶ä¼ å€¼ç»™çˆ¶ç»„ä»¶: 1.å­ç»„ä»¶é€šè¿‡defineEmitsæ¥ç”Ÿæˆemitæ–¹æ³• 2.å­ç»„ä»¶ä½¿ç”¨emitå®šä¹‰äº‹ä»¶ï¼Œå¹¶ä¼ é€’å‚æ•° 3.çˆ¶ç»„ä»¶ä½¿ç”¨ç»‘å®šå­ç»„ä»¶çš„äº‹ä»¶ï¼Œå¹¶ç»‘å®šè‡ªå·±çš„å‡½æ•°ï¼Œå®šä¹‰è‡ªå·±çš„å‡½æ•°ä½¿ç”¨ä¼ é€’çš„å€¼<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">å­ç»„ä»¶&lt;script setup&gt;  const props =  defineProps({    message : String  })  const emit = defineEmits(['say']) //äº‹ä»¶åˆ—è¡¨  const hh = ()=&gt;{    emit('say','hello world')  }  &lt;/script&gt;  &lt;template&gt;    {{message}}    &lt;button @click="hh"&gt;click&lt;/button&gt;  &lt;/template&gt;çˆ¶ç»„ä»¶&lt;script setup&gt;  import son from './components/money.vue'  const func = (msg,num)=&gt;{    console.log(msg,num)  }  &lt;/script&gt;  &lt;template&gt;    &lt;son  messoage="hello world" @say="func"/&gt;  &lt;/template&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>æ¨¡æ¿ä½¿ç”¨ æ–°å»ºä¸€ä¸ªref ç„¶ååœ¨ html ä¸­çš„refæ¥è¿›è¡Œç»‘å®šè¿™ä¸ªrefå³å¯è·å¾—domå…ƒç´ ï¼Œä½†æ˜¯ä¼šåœ¨onmountedä¹‹åæ‰èƒ½è®¿é—®</li><li>çˆ¶ç»„ä»¶é»˜è®¤ä¸ä¼šè·å¾—å­ç»„ä»¶çš„domå› ä¸ºæœ‰setup æ‰€ä»¥å¯ä»¥ä½¿ç”¨<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">defineExpose({éœ€è¦æš´æ¼çš„å±æ€§å’Œæ–¹æ³•åæˆ–è€…ä¸€ä¸ªåŒ¿åå‡½æ•°})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li>é€šè¿‡provideå’Œinjectæ¥è·¨å±‚ä¼ é€’<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">é¡¶å±‚provide('key',value) valueå¯ä»¥æ˜¯å‡½æ•°ç­‰åº•å±‚const value = inject('key')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li>v-text æ¥æ›´æ–°æ–‡æœ¬å†…å®¹ï¼Œv-htmlæ¥æ›´æ–°htmlå…ƒç´ </li></ul><h1 id="Express"><a href="#Express" class="headerlink" title="Express"></a>Express</h1><p>æ”¯æŒå‰åç«¯åˆ†ç¦»çš„ç®€å•æ¡†æ¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> express-generator <span class="token parameter variable">-g</span>express --no-view server æ–°å»ºé¡¹ç›®<span class="token builtin class-name">cd</span> server<span class="token function">npm</span> <span class="token function">install</span>ET DEBUG <span class="token operator">=</span> server:* <span class="token operator">&amp;</span> <span class="token function">npm</span> start å¼€å¯æœåŠ¡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">user www-data<span class="token punctuation">;</span>worker_processes auto<span class="token punctuation">;</span>pid /run/nginx.pid<span class="token punctuation">;</span>include /etc/nginx/modules-enabled/*.conf<span class="token punctuation">;</span>events <span class="token punctuation">{</span>        worker_connections <span class="token number">768</span><span class="token punctuation">;</span>        <span class="token comment"># multi_accept on;</span>        <span class="token comment">##è‡ªå®šä¹‰æœåŠ¡åˆ—è¡¨</span><span class="token punctuation">}</span>http <span class="token punctuation">{</span>        <span class="token comment">##</span>        sendfile on<span class="token punctuation">;</span>        tcp_nopush on<span class="token punctuation">;</span>        types_hash_max_size <span class="token number">2048</span><span class="token punctuation">;</span>        <span class="token comment"># server_tokens off;</span>        <span class="token comment"># server_names_hash_bucket_size 64;</span>        <span class="token comment"># server_name_in_redirect off;</span>        include /etc/nginx/mime.types<span class="token punctuation">;</span>        default_type application/octet-stream<span class="token punctuation">;</span><span class="token builtin class-name">.</span>         ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3<span class="token punctuation">;</span> <span class="token comment"># Dropping SSLv3, ref: POODLE</span>        ssl_prefer_server_ciphers on<span class="token punctuation">;</span>        <span class="token comment">##</span>        <span class="token comment"># Logging Settings</span>        <span class="token comment">##</span>        access_log /var/log/nginx/access.log<span class="token punctuation">;</span>        error_log /var/log/nginx/error.log<span class="token punctuation">;</span>        <span class="token comment">##</span>        <span class="token comment"># Gzip Settings</span>        <span class="token comment">##</span>        <span class="token function">gzip</span> on<span class="token punctuation">;</span>        <span class="token comment"># gzip_vary on;</span>        <span class="token comment"># gzip_proxied any;</span>        <span class="token comment"># gzip_comp_level 6;</span>        <span class="token comment"># gzip_buffers 16 8k;</span>        <span class="token comment"># gzip_http_version 1.1;</span>        <span class="token comment"># gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;</span>        <span class="token comment">##</span>        <span class="token comment"># Virtual Host Configs</span>        <span class="token comment">##</span>          include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span>        include /etc/nginx/sites-enabled/*<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h1><ul><li><p>è¿›åº¦æ¡</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> ProgressBar <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'progress'</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProgressBar</span><span class="token punctuation">(</span><span class="token string">':bar'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">total</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> timer <span class="token operator">=</span>  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>      bar<span class="token punctuation">.</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>bar<span class="token punctuation">.</span>complete<span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>      <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ–‡ä»¶æ“ä½œ  require(â€˜fsâ€™)</p></li><li><p>ç½‘ç»œå¼€å‘</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'net'</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> server <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å®¢æˆ·ç«¯å·²è¿æ¥'</span><span class="token punctuation">)</span>      c<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ–­å¼€è¿æ¥'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>      <span class="token keyword">throw</span> err  <span class="token punctuation">}</span><span class="token punctuation">)</span>  server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8124</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æœåŠ¡å™¨å·²å¯åŠ¨'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>onæ¥ç»‘å®šäº‹ä»¶</p></li><li><p>udp ä½¿ç”¨dgramæ¨¡å—</p></li><li><p>WebSocket ä½¿ç”¨ wsæ¨¡å—ï¼Œæ˜¯å¯¹socketçš„å…·ä½“å®ç°</p></li><li><p>socket.ioæ¡†æ¶</p></li><li><p>å¸¸ç”¨api<br><img src="/2023/09/29/36/%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0/2.jpg"><br><img src="/2023/09/29/36/%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0/1.jpg"></p></li><li><p>expressæ¡†æ¶</p></li><li><p>koaæ¡†æ¶</p></li><li><p>mongoose</p></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è½¯è€ƒ</title>
      <link href="/2023/09/19/11/"/>
      <url>/2023/09/19/11/</url>
      
        <content type="html"><![CDATA[<h1 id="è½¯ä»¶å·¥ç¨‹"><a href="#è½¯ä»¶å·¥ç¨‹" class="headerlink" title="è½¯ä»¶å·¥ç¨‹"></a>è½¯ä»¶å·¥ç¨‹</h1><p>æè¿°è½¯ä»¶éœ€æ±‚çš„æ–¹æ³•ï¼š</p><p>åŠŸèƒ½å±‚æ¬¡æ¨¡å‹ï¼šä¸€èˆ¬æ¥è®²å°±æ˜¯ç³»ç»Ÿçš„åŠŸèƒ½å›¾ï¼Œæ¨¡å—åˆ†å¸ƒå›¾ç­‰æè¿°æ•´ä¸ªç³»ç»Ÿçš„åŠŸèƒ½çš„åˆ†å¸ƒå’ŒåŠŸèƒ½çš„å±‚æ¬¡ç»“æ„ï¼›</p><p>æ•°æ®æµæ¨¡å‹ï¼šå°±æ˜¯ä»¥æ•°æ®æµä¸ºç€çœ¼ç‚¹çš„åˆ†ææ–¹æ³•å¾—åˆ°çš„æ¨¡å‹ï¼Œä¸»è¦é€šè¿‡æ•°æ®åœ¨æ•´ä¸ªç³»ç»Ÿçš„æµåŠ¨æƒ…å†µæ¥ç¡®å®šç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½ä¸»çº¿å’Œæµç¨‹ï¼›</p><p>æ§åˆ¶æµæ¨¡å‹ï¼šé€šè¿‡äº†è§£å’Œç•Œå®šç³»ç»Ÿä¸­æ§åˆ¶çº¿ï¼Œé€šè¿‡æ§åˆ¶æµçš„èµ°å‘å’Œæ§åˆ¶çš„å¯¹è±¡æ¥ç¡®å®šç³»ç»Ÿçš„åŠŸèƒ½åˆ†å¸ƒå’Œæ§åˆ¶ä¸è¢«æ§åˆ¶çš„å…³ç³»ï¼›</p><p><strong>ç»“æ„åŒ–åˆ†æï¼ˆSA)</strong> æ–¹æ³•æ˜¯ä¸€ç§é¢å‘æ•°æ®æµçš„éœ€æ±‚åˆ†ææ–¹æ³•ï¼Œå®ƒé€‚ç”¨äºåˆ†æå¤§å‹æ•°æ®å¤„ç†ç³»ç»Ÿã€‚ç»“æ„åŒ–åˆ†ææ–¹æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯è‡ªé¡¶å‘ä¸‹é€å±‚åˆ†è§£ï¼Œè¿™æ ·åšå¯ä»¥æŠŠä¸€ä¸ªå¤§é—®é¢˜åˆ†è§£æˆè‹¥å¹²ä¸ªå°é—®é¢˜ï¼Œç»è¿‡å¤šæ¬¡é€å±‚åˆ†è§£ï¼Œæ¯ä¸ªæœ€åº•å±‚çš„é—®é¢˜éƒ½æ˜¯è¶³å¤Ÿç®€å•ã€å®¹æ˜“è§£å†³çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åˆ†è§£çš„è¿‡ç¨‹ã€‚</p><p>ç»“æ„åŒ–æ–¹æ³•çš„åˆ†æç»“æœç”±æ•°æ®æµå›¾DFDã€æ•°æ®è¯å…¸å’ŒåŠ å·¥é€»è¾‘è¯´æ˜å‡ ä¸ªéƒ¨åˆ†ç»„æˆã€‚å…¶ä¸­ï¼ŒDFDçš„åŸºæœ¬æˆåˆ†æœ‰æ•°æ®æµï¼ˆdata flowï¼‰ã€åŠ å·¥ï¼ˆprocessï¼‰ã€æ–‡ä»¶ï¼ˆfileï¼‰å’Œæº/å®¿ï¼ˆsource/sinkï¼‰ã€‚</p><p><strong>ç»“æ„åŒ–è®¾è®¡ï¼ˆSD)</strong> æ–¹æ³•æ˜¯ä¸€ç§é¢å‘æ•°æ®æµçš„è®¾è®¡æ–¹æ³•ï¼Œå®ƒå¯ä»¥ä¸SAæ–¹æ³•è¡”æ¥ã€‚</p><p>ç»“æ„åŒ–è®¾è®¡é‡‡ç”¨<strong>ç»“æ„å›¾ï¼ˆSCï¼‰</strong> æ¥æè¿°ç¨‹åºçš„ç»“æ„ã€‚å…¶åŸºæœ¬æˆåˆ†æœ‰æ¨¡å—ã€è°ƒç”¨å’Œè¾“å…¥/è¾“å‡ºæ•°æ®ã€‚</p><p>ç»“æ„å›¾ï¼š</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><img src="file:///C:\Users\ASUS\AppData\Local\Temp\ksohtml32068\wps1.jpg">ã€€ <img src="file:///C:\Users\ASUS\AppData\Local\Temp\ksohtml32068\wps2.jpg"></td><td></td></tr><tr><td></td><td><img src="file:///C:\Users\ASUS\AppData\Local\Temp\ksohtml32068\wps3.jpg"></td></tr></tbody></table><p>æ¡ä»¶è°ƒç”¨&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¾ªç¯è°ƒç”¨</p><p>&nbsp;&nbsp;&nbsp;åœ¨éœ€æ±‚åˆ†æé˜¶æ®µç”¨SAæ–¹æ³•äº§ç”Ÿäº†<strong>æ•°æ®æµå›¾ï¼ˆDFDï¼‰</strong> ã€‚é¢å‘æ•°æ®æµçš„è®¾è®¡å¯ä»¥æ–¹ä¾¿çš„å°†DFDè½¬æ¢æˆç¨‹åºç»“æ„å›¾ã€‚DFDä»ç³»ç»Ÿçš„è¾“å…¥æ•°æ®æµåˆ°ç³»ç»Ÿçš„è¾“å‡ºæ•°æ®æµçš„ä¸€è¿ä¸²è¿ç»­å˜æ¢å½¢æˆä¸€æ¡ä¿¡æ¯æµã€‚DFDçš„ä¿¡æ¯æµå¤§ä½“å¯åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šå˜æ¢æµå’Œäº‹åŠ¡æµã€‚ä¸ä¹‹å¯¹åº”çš„ä¹Ÿå­˜åœ¨ä¸¤ç§åˆ†æï¼Œå˜æ¢åˆ†æå’Œäº‹åŠ¡åˆ†æã€‚å˜æ¢åˆ†ææ˜¯ä»å˜æ¢æµå‹çš„DFDå¯¼å‡ºç¨‹åºç»“æ„å›¾ï¼Œè€Œäº‹åŠ¡åˆ†æåˆ™æ˜¯ä»äº‹åŠ¡æµè¡Œå‹çš„DFDå¯¼å‡ºç¨‹åºç»“æ„å›¾ã€‚</p><p>SDæ–¹æ³•çš„å…·ä½“è®¾è®¡æ­¥éª¤ä¸ºï¼š</p><p>Ã˜&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; å¤æŸ¥å¹¶ç²¾åŒ–æ•°æ®æµå›¾</p><p>Ã˜&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ç¡®å®šDFDçš„ä¿¡æ¯æµç±»å‹</p><p>Ã˜&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; æ ¹æ®ä¿¡æ¯æµç±»å‹åˆ†åˆ«å°†å˜æ¢æµæˆ–äº‹åŠ¡æµè½¬æ¢æˆç¨‹åºç»“æ„å›¾</p><p>Ã˜&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; æ ¹æ®è½¯ä»¶è®¾è®¡çš„åŸåˆ™å¯¹ç¨‹åºç»“æ„å›¾ä½œæ”¹è¿›</p><ul><li>æµ‹è¯•</li></ul><p>ç™½ç›’æµ‹è¯•æ˜¯æ ¹æ®ç¨‹åºçš„å†…éƒ¨é€»è¾‘æ¥è®¾è®¡æµ‹è¯•ç”¨ä¾‹ï¼Œå¸¸ç”¨çš„æŠ€æœ¯æ˜¯é€»è¾‘è¦†ç›–ï¼Œå³è€ƒå¯Ÿç”¨ä¾‹æµ‹è¯•æ•°æ®è¿è¡Œè¢«æµ‹ç¨‹åºæ—¶å¯¹ç¨‹åºé€»è¾‘çš„è¦†ç›–ç¨‹åº¦ã€‚ä¸»è¦çš„è¦†ç›–æ ‡å‡†æœ‰6ç§ï¼š </p><p>é»‘ç›’æµ‹è¯•</p><p>é»‘ç›’æµ‹è¯•æ—¶æ ¹æ®è§„æ ¼è¯´æ˜æ‰€è§„å®šçš„åŠŸèƒ½æ¥è®¾è®¡æµ‹è¯•ç”¨ä¾‹ï¼Œå®ƒä¸è€ƒè™‘ç¨‹åºçš„å†…éƒ¨ç»“æ„å’Œå¤„ç†è¿‡ç¨‹ã€‚å¸¸ç”¨çš„é»‘ç›’æµ‹è¯•æŠ€æœ¯æœ‰ï¼š</p><p>Ã˜&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ç­‰ä»·ç±»åˆ’åˆ†</p><p>Ã˜&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; è¾¹å€¼åˆ’åˆ†</p><p>Ã˜&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; é”™è¯¯çŒœæµ‹</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ssm-practice</title>
      <link href="/2023/09/17/02/"/>
      <url>/2023/09/17/02/</url>
      
        <content type="html"><![CDATA[<h1 id="Springbootç»ƒä¹ "><a href="#Springbootç»ƒä¹ " class="headerlink" title="Springbootç»ƒä¹ "></a>Springbootç»ƒä¹ </h1><p>é€šè¿‡atguiguçš„ä»Šæ—¥å¤´æ¡é¡¹ç›®è¿›è¡Œé¡¹ç›®é©±åŠ¨å¼å­¦ä¹ <br>å‰ç«¯å·²å‡†å¤‡</p><h2 id="åç«¯å¼€å‘"><a href="#åç«¯å¼€å‘" class="headerlink" title="åç«¯å¼€å‘"></a>åç«¯å¼€å‘</h2><p>è¦æ±‚ï¼šåç«¯ä½¿ç”¨springbootæ•´åˆmybatiså’Œspringmvcæ¥è¿›è¡Œç®€å•çš„å¢åˆ æ”¹æŸ¥</p><ol><li>å¯¼å…¥ä¾èµ–:<ul><li>springbootå¯åŠ¨åŒ…ï¼Œspringboot-webé¡¹ç›®å¯åŠ¨åŒ…ï¼Œmybatisæ’ä»¶ï¼Œæ•°æ®åº“é…ç½®å¯åŠ¨å™¨springboot-starter-jdbcï¼Œdruidå¯åŠ¨å™¨ï¼Œmysqlé©±åŠ¨ç±»ï¼Œlombokï¼Œaop,test,æ‰“åŒ…æ’ä»¶</li></ul></li><li>ç¼–å†™é…ç½®ç±»:<br>mybatisçš„é…ç½®ç±»å¯ä»¥ä½¿ç”¨yamlæ ¼å¼æˆ–è€…æ˜¯propertiesæ ¼å¼çš„æ–‡ä»¶ï¼Œæ¨èä½¿ç”¨yamlæ ¼å¼çš„æ–‡ä»¶ï¼Œæœ‰åˆ†å±‚çš„æ•ˆæœ<br>[[Tools#yaml|æŸ¥çœ‹Toolsä¸­çš„yaml]]<br><a href="https://www.runoob.com/w3cnote/yaml-intro.html">èœé¸Ÿæ•™ç¨‹</a><br><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html#appendix.application-properties">å…·ä½“é…ç½®</a><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># serveré…ç½®</span><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> / <span class="token comment">#é»˜è®¤çš„æ ¹è·¯å¾„</span><span class="token comment"># è¿æ¥æ± é…ç½®</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource    <span class="token key atrule">druid</span><span class="token punctuation">:</span>      <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>///sm_db1      <span class="token key atrule">username</span><span class="token punctuation">:</span> root      <span class="token key atrule">password</span><span class="token punctuation">:</span> root      <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver<span class="token comment"># mybatis-plusçš„é…ç½®</span><span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>  <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> com.atguigu.pojo  <span class="token key atrule">global-config</span><span class="token punctuation">:</span>    <span class="token key atrule">db-config</span><span class="token punctuation">:</span>      <span class="token key atrule">logic-delete-field</span><span class="token punctuation">:</span> isDeleted  <span class="token comment">#å…¨å±€é€»è¾‘åˆ é™¤</span>      <span class="token key atrule">id-type</span><span class="token punctuation">:</span> auto <span class="token comment">#ç›´æ¥ä½¿ç”¨springbootæ¥è¿›è¡Œé…ç½®ï¼Œå°±ä¸éœ€è¦å†åŠ ä¸Šè¿™ä¸ªæ³¨è§£äº†</span>      <span class="token key atrule">table-prefix</span><span class="token punctuation">:</span> news_ <span class="token comment"># è®¾ç½®è¡¨çš„å‰ç¼€</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>druidå…¼å®¹æ–‡ä»¶<pre class="line-numbers language-none"><code class="language-none">æ–‡ä»¶å:org.springframework.boot.autoconfigure.AutoConfiguration.importså†…å®¹:com.alibaba.druid.spring.boot3.autoconfigure.DruidDataSourceAutoConfigure<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li>ç¼–å†™å¯åŠ¨ç±»main<br><strong>ç–‘é—®ï¼š ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”</strong><br>é…ç½®ä½¿ç”¨çš„æ’ä»¶ [[Java#^f13de1]]<br><a href="https://baomidou.com/pages/2976a3/#%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98-sql-%E8%A7%A3%E6%9E%90">æ•™ç¨‹</a><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">"com.atguigu.mapper"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Main</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">//é…ç½®mybatis-plusæ’ä»¶</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">MybatisPlusInterceptor</span> <span class="token function">mybatisPlusInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">MybatisPlusInterceptor</span> interceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MybatisPlusInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        interceptor<span class="token punctuation">.</span><span class="token function">addInnerInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PaginationInnerInterceptor</span><span class="token punctuation">(</span><span class="token class-name">DbType</span><span class="token punctuation">.</span><span class="token constant">MYSQL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//åˆ†é¡µ</span>        interceptor<span class="token punctuation">.</span><span class="token function">addInnerInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OptimisticLockerInnerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//ä¹è§‚é”</span>        interceptor<span class="token punctuation">.</span><span class="token function">addInnerInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BlockAttackInnerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//é˜²å…¨å±€ä¿®æ”¹å’Œåˆ é™¤</span>        <span class="token keyword">return</span> interceptor<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å·¥å…·ç±»å°è£…:ä¸»è¦æ˜¯ç»Ÿä¸€è¿”å›ç»“æœçš„ç±»<br> ç»“æœå°è£…ç±»</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * å…¨å±€ç»Ÿä¸€è¿”å›ç»“æœç±» */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span> <span class="token comment">//Tæ˜¯è¦ä½¿ç”¨çš„æ³›å‹ï¼Œè¦åœ¨è¿™é‡Œå£°æ˜</span>    <span class="token comment">// è¿”å›ç </span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>    <span class="token comment">// è¿”å›æ¶ˆæ¯</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>    <span class="token comment">// è¿”å›æ•°æ®</span>    <span class="token keyword">private</span> <span class="token class-name">T</span> data<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token comment">// è¿”å›æ•°æ®</span>    <span class="token comment">//æ³›å‹æ–¹æ³•ï¼Œè¦å°† è¦ä½¿ç”¨çš„æ³›å‹åœ¨è¿”å›ç±»å‹ä¹‹å‰è¿›è¡Œå£°æ˜</span>    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">T</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>            result<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">T</span> body<span class="token punctuation">,</span> <span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token function">build</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>        result<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>        result<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">T</span> body<span class="token punctuation">,</span> <span class="token class-name">ResultCodeEnum</span> resultCodeEnum<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token function">build</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>        result<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>resultCodeEnum<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        result<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>resultCodeEnum<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æ“ä½œæˆåŠŸ     * @param data  baseCategory1List     * @param &lt;T&gt;     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">ok</span><span class="token punctuation">(</span><span class="token class-name">T</span> data<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token function">build</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">build</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token class-name">ResultCodeEnum</span><span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">code</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> code<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> message<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> data<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setData</span><span class="token punctuation">(</span><span class="token class-name">T</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è§£å†³æšä¸¾ç±»<br>æšä¸¾ç±»å¯ä»¥ä½¿ç”¨ å¸¸é‡(å…·ä½“çš„å¸¸é‡å†…å®¹æ¥è¿›è¡Œæšä¸¾)</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ç»Ÿä¸€è¿”å›ç»“æœçŠ¶æ€ä¿¡æ¯ç±» * */</span><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ResultCodeEnum</span> <span class="token punctuation">{</span>    <span class="token function">SUCCESS</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">USERNAME_ERROR</span><span class="token punctuation">(</span><span class="token number">501</span><span class="token punctuation">,</span><span class="token string">"usernameError"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">PASSWORD_ERROR</span><span class="token punctuation">(</span><span class="token number">503</span><span class="token punctuation">,</span><span class="token string">"passwordError"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">NOTLOGIN</span><span class="token punctuation">(</span><span class="token number">504</span><span class="token punctuation">,</span><span class="token string">"notLogin"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">USERNAME_USED</span><span class="token punctuation">(</span><span class="token number">505</span><span class="token punctuation">,</span><span class="token string">"userNameUsed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">ResultCodeEnum</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> code<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> message<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>MD5åŠ å¯†å·¥å…·ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">MessageDigest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">NoSuchAlgorithmException</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">MD5Util</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token class-name">String</span> strSrc<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">char</span> hexChars<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token char">'0'</span><span class="token punctuation">,</span> <span class="token char">'1'</span><span class="token punctuation">,</span> <span class="token char">'2'</span><span class="token punctuation">,</span> <span class="token char">'3'</span><span class="token punctuation">,</span> <span class="token char">'4'</span><span class="token punctuation">,</span> <span class="token char">'5'</span><span class="token punctuation">,</span> <span class="token char">'6'</span><span class="token punctuation">,</span> <span class="token char">'7'</span><span class="token punctuation">,</span> <span class="token char">'8'</span><span class="token punctuation">,</span>                    <span class="token char">'9'</span><span class="token punctuation">,</span> <span class="token char">'a'</span><span class="token punctuation">,</span> <span class="token char">'b'</span><span class="token punctuation">,</span> <span class="token char">'c'</span><span class="token punctuation">,</span> <span class="token char">'d'</span><span class="token punctuation">,</span> <span class="token char">'e'</span><span class="token punctuation">,</span> <span class="token char">'f'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> strSrc<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è·å¾—m5çš„å®ä¾‹</span>            <span class="token class-name">MessageDigest</span> md <span class="token operator">=</span> <span class="token class-name">MessageDigest</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"MD5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            md<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>            bytes <span class="token operator">=</span> md<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> j <span class="token operator">=</span> bytes<span class="token punctuation">.</span>length<span class="token punctuation">;</span>            <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> chars <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>j <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bytes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">byte</span> b <span class="token operator">=</span> bytes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>                chars<span class="token punctuation">[</span>k<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> hexChars<span class="token punctuation">[</span>b <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">4</span> <span class="token operator">&amp;</span> <span class="token number">0xf</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                chars<span class="token punctuation">[</span>k<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> hexChars<span class="token punctuation">[</span>b <span class="token operator">&amp;</span> <span class="token number">0xf</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>chars<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"MD5åŠ å¯†å‡ºé”™ï¼ï¼+"</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="6"><li>ä½¿ç”¨mybatisXæ’ä»¶ï¼Œé€‰ä¸­è¡¨ä¹‹åé€†å‘å·¥ç¨‹ç”Ÿæˆå®ä½“ç±»å’Œæ¥å£(æ³¨æ„è‡ªå·±è¡¥å……å’Œåˆ å‡ä¸€äº›æ³¨é‡Š)<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>        <span class="token annotation punctuation">@TableId</span> <span class="token comment">//ä¸»é”®</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> uid<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> userPwd<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> nickName<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Version</span> <span class="token comment">//ç‰ˆæœ¬</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> version<span class="token punctuation">;</span>    <span class="token annotation punctuation">@TableLogic</span> <span class="token comment">//é€»è¾‘åˆ é™¤</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> isDeleted<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>è¡¥å……:<br>[[Java#^86b436||é€»è¾‘åˆ é™¤]]</li><li>ä½¿ç”¨jwtæ¥ç”Ÿæˆ[[Webå­¦ä¹ #Tokenæ˜¯ä¸€ç§ä»¤ç‰Œï¼Œç”¨æ¥è¯†åˆ«è®¿é—®äººå‘˜çš„|Token]]</li><li>JSON Web Token JWTç”±ä¸‰éƒ¨åˆ†ç»„æˆ: header(å¤´éƒ¨).payload(è½½è·).signature(ç­¾å)<br>1. å¯¼å…¥ä¾èµ–</li></ol><pre><code><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.jsonwebtoken<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jjwt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.9.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.xml.bind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jaxb-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></code></pre><ol start="2"><li><p>ç¼–å†™é…ç½®</p><p> application.yaml</p> <pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment">#jwté…ç½®</span><span class="token key atrule">jwt</span><span class="token punctuation">:</span>  <span class="token key atrule">token</span><span class="token punctuation">:</span>    <span class="token key atrule">tokenExpiration</span><span class="token punctuation">:</span> <span class="token number">120</span> <span class="token comment">#æœ‰æ•ˆæ—¶é—´,å•ä½åˆ†é’Ÿ</span>    <span class="token key atrule">tokenSignKey</span><span class="token punctuation">:</span> headline123456  <span class="token comment">#å½“å‰ç¨‹åºç­¾åç§˜é’¥ è‡ªå®šä¹‰</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¯¼å…¥å·¥å…·ç±»</p><p> å°è£…jwtæŠ€æœ¯å·¥å…·ç±»</p> <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>jsonwebtoken<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"jwt.token"</span><span class="token punctuation">)</span> <span class="token comment">//ä½¿ç”¨è¿™ä¸ªå°±å¯ä»¥çœç•¥å‰ç¼€ï¼Œå¦‚æœåé¢çš„å˜é‡åå’Œé…ç½®ä¸­ç›¸åŒçš„è¯å°±å¯ä»¥è‡ªåŠ¨è£…é…è€Œä¸ç”¨æ‰‹åŠ¨è£…é…äº†</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtHelper</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span>  <span class="token keyword">long</span> tokenExpiration<span class="token punctuation">;</span> <span class="token comment">//æœ‰æ•ˆæ—¶é—´,å•ä½æ¯«ç§’ 1000æ¯«ç§’ == 1ç§’</span>    <span class="token keyword">private</span>  <span class="token class-name">String</span> tokenSignKey<span class="token punctuation">;</span>  <span class="token comment">//å½“å‰ç¨‹åºç­¾åç§˜é’¥</span>    <span class="token comment">//ç”Ÿæˆtokenå­—ç¬¦ä¸²</span>    <span class="token keyword">public</span>  <span class="token class-name">String</span> <span class="token function">createToken</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"tokenExpiration = "</span> <span class="token operator">+</span> tokenExpiration<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"tokenSignKey = "</span> <span class="token operator">+</span> tokenSignKey<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span><span class="token string">"YYGH-USER"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> tokenExpiration<span class="token operator">*</span><span class="token number">1000</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//å•ä½åˆ†é’Ÿ</span>                <span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">signWith</span><span class="token punctuation">(</span><span class="token class-name">SignatureAlgorithm</span><span class="token punctuation">.</span><span class="token constant">HS512</span><span class="token punctuation">,</span> tokenSignKey<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">compressWith</span><span class="token punctuation">(</span><span class="token class-name">CompressionCodecs</span><span class="token punctuation">.</span><span class="token constant">GZIP</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> token<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">//ä»tokenå­—ç¬¦ä¸²è·å–userid</span>    <span class="token keyword">public</span>  <span class="token class-name">Long</span> <span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">Jws</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Claims</span><span class="token punctuation">&gt;</span></span> claimsJws <span class="token operator">=</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSigningKey</span><span class="token punctuation">(</span>tokenSignKey<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseClaimsJws</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Claims</span> claims <span class="token operator">=</span> claimsJws<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Integer</span> userId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span>claims<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> userId<span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">//åˆ¤æ–­tokenæ˜¯å¦æœ‰æ•ˆ</span>    <span class="token keyword">public</span>  <span class="token keyword">boolean</span> <span class="token function">isExpiration</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">boolean</span> isExpire <span class="token operator">=</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">setSigningKey</span><span class="token punctuation">(</span>tokenSignKey<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">parseClaimsJws</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">getExpiration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//æ²¡æœ‰è¿‡æœŸï¼Œæœ‰æ•ˆï¼Œè¿”å›false</span>            <span class="token keyword">return</span> isExpire<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">//è¿‡æœŸå‡ºç°å¼‚å¸¸ï¼Œè¿”å›true</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç¼–å†™controller<br>çŸ¥è¯†ç‚¹ï¼šè·¨åŸŸ: ä¾‹å¦‚ä»ä¸åŒçš„æœåŠ¡å™¨æˆ–åŸŸåè·å–ä¿¡æ¯ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h2 id="æ—¶é—´æ ¼å¼è§£å†³"><a href="#æ—¶é—´æ ¼å¼è§£å†³" class="headerlink" title="æ—¶é—´æ ¼å¼è§£å†³"></a>æ—¶é—´æ ¼å¼è§£å†³</h2><p><img src="/2023/09/17/02/timeFormat.png" alt="timeformat"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ç®—æ³•</title>
      <link href="/2023/09/09/34/"/>
      <url>/2023/09/09/34/</url>
      
        <content type="html"><![CDATA[<h2 id="JAVA-å¿«å†™"><a href="#JAVA-å¿«å†™" class="headerlink" title="JAVA å¿«å†™"></a>JAVA å¿«å†™</h2><h2 id="æœ€çŸ­è·¯ä¸å…·ä½“çš„è·¯å¾„è®°å½•é—®é¢˜"><a href="#æœ€çŸ­è·¯ä¸å…·ä½“çš„è·¯å¾„è®°å½•é—®é¢˜" class="headerlink" title="æœ€çŸ­è·¯ä¸å…·ä½“çš„è·¯å¾„è®°å½•é—®é¢˜"></a><a href="https://leetcode.cn/problems/find-edges-in-shortest-paths/description/">æœ€çŸ­è·¯ä¸å…·ä½“çš„è·¯å¾„è®°å½•é—®é¢˜</a></h2><h2 id="TreeMap"><a href="#TreeMap" class="headerlink" title="TreeMap"></a>TreeMap</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>map<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> è·å¾—è¿™ä¸ªæ•°ï¼Œå¦‚æœä¸ºç©º<span class="token punctuation">,</span>è¿”å›é»˜è®¤å€¼ï¼Œå¯ä»¥è‡ªå·±è®¾å®šk <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">higherKey</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span> è·å¾—ä¸‹ä¸€ä¸ªé¡ºåºçš„é”®<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="æŠŠtoCharArrayå‘å³ç§»åŠ¨ä¸€ä½"><a href="#æŠŠtoCharArrayå‘å³ç§»åŠ¨ä¸€ä½" class="headerlink" title="æŠŠtoCharArrayå‘å³ç§»åŠ¨ä¸€ä½"></a>æŠŠtoCharArrayå‘å³ç§»åŠ¨ä¸€ä½</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"> a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token char">' '</span><span class="token operator">+</span> re<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="a-z-ä¹‹é—´åç§»é‡ç¡®è®¤"><a href="#a-z-ä¹‹é—´åç§»é‡ç¡®è®¤" class="headerlink" title="a ~ z ä¹‹é—´åç§»é‡ç¡®è®¤"></a>a ~ z ä¹‹é—´åç§»é‡ç¡®è®¤</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token char">'a'</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> offset <span class="token operator">-</span> <span class="token char">'a'</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="çœ‹åˆ°å”¯ä¸€è§£ï¼Œä¸”æ˜¯éš¾ä»¥åšçš„å›¾å½¢é¢˜ï¼Œå¯ä»¥è€ƒè™‘è½¬åŒ–ä¸ºæ–¹ç¨‹"><a href="#çœ‹åˆ°å”¯ä¸€è§£ï¼Œä¸”æ˜¯éš¾ä»¥åšçš„å›¾å½¢é¢˜ï¼Œå¯ä»¥è€ƒè™‘è½¬åŒ–ä¸ºæ–¹ç¨‹" class="headerlink" title="çœ‹åˆ°å”¯ä¸€è§£ï¼Œä¸”æ˜¯éš¾ä»¥åšçš„å›¾å½¢é¢˜ï¼Œå¯ä»¥è€ƒè™‘è½¬åŒ–ä¸ºæ–¹ç¨‹"></a>çœ‹åˆ°å”¯ä¸€è§£ï¼Œä¸”æ˜¯éš¾ä»¥åšçš„å›¾å½¢é¢˜ï¼Œå¯ä»¥è€ƒè™‘è½¬åŒ–ä¸ºæ–¹ç¨‹</h2><p><a href="https://www.lanqiao.cn/problems/17160/learning/?contest_id=179">https://www.lanqiao.cn/problems/17160/learning/?contest_id=179</a></p><h3 id="å¡ç‰¹å…°æ•°é—®é¢˜-ï¼šh-n-x3D-C-2n-n-âˆ’C-2n-nâˆ’1-n-x3D-0-1-2-â€¦-ç»„åˆæ•°Cä¸è§£é‡Šäº†ï¼›-Cæ˜¯ç»„åˆæ•°"><a href="#å¡ç‰¹å…°æ•°é—®é¢˜-ï¼šh-n-x3D-C-2n-n-âˆ’C-2n-nâˆ’1-n-x3D-0-1-2-â€¦-ç»„åˆæ•°Cä¸è§£é‡Šäº†ï¼›-Cæ˜¯ç»„åˆæ•°" class="headerlink" title="å¡ç‰¹å…°æ•°é—®é¢˜ ï¼šh[n]=C[2n,n]âˆ’C [2n,nâˆ’1] (n=0,1,2,â€¦)&nbsp;ç»„åˆæ•°Cä¸è§£é‡Šäº†ï¼› Cæ˜¯ç»„åˆæ•°"></a>å¡ç‰¹å…°æ•°é—®é¢˜ ï¼šh[n]=C[2n,n]âˆ’C [2n,nâˆ’1] (n=0,1,2,â€¦)&nbsp;ç»„åˆæ•°Cä¸è§£é‡Šäº†ï¼› Cæ˜¯ç»„åˆæ•°</h3><ol><li>å‡ºæ ˆé¡ºåºé—®é¢˜ å‡è®¾æœ‰Nä¸ªæ•°å­—ä¾æ¬¡å…¥æ ˆï¼š1,2,3,â€¦,nï¼Œè¯•é—®æœ‰å¤šå°‘ç§å‡ºæ ˆé¡ºåºï¼Ÿè¿™é‡Œä¸ºè¡¨è¿°ç®€ä¾¿ï¼Œä¸‹æ–‡ç”¨+1è¡¨ç¤ºä¸€ä¸ªå…ƒç´ å…¥æ ˆï¼Œç”¨-1è¡¨ç¤ºä¸€ä¸ªå…ƒç´ å‡ºæ ˆ</li><li>é—®é¢˜æè¿°ï¼šæœ‰nå¯¹()æ‹¬å·ï¼Œè¯•é—®å¯ä»¥ç»„æˆå¤šå°‘ç§åˆæ³•æ­£ç¡®çš„æ‹¬å·åºåˆ—ï¼Ÿ</li></ol><h2 id="æ ‘æ˜¯æ— å‘è¾¹"><a href="#æ ‘æ˜¯æ— å‘è¾¹" class="headerlink" title="æ ‘æ˜¯æ— å‘è¾¹"></a>æ ‘æ˜¯æ— å‘è¾¹</h2><h2 id="Javaæ—¥æœŸ"><a href="#Javaæ—¥æœŸ" class="headerlink" title="Javaæ—¥æœŸ"></a>Javaæ—¥æœŸ</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDate</span> d1 <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>format<span class="token punctuation">.</span></span>DateTimeFormatter</span><span class="token punctuation">.</span><span class="token constant">BASIC_ISO_DATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalDate</span> d2 <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>format<span class="token punctuation">.</span></span>DateTimeFormatter</span><span class="token punctuation">.</span><span class="token constant">BASIC_ISO_DATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">long</span> diff <span class="token operator">=</span> <span class="token class-name">ChronoUnit</span><span class="token punctuation">.</span><span class="token constant">DAYS</span><span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>diff<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">BufferedWriter</span> writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedWriter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OutputStreamWriter</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> æ‰ä¼šå†™<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="JAVAæ›´å¿«æ›´å¼ºçš„è¯»å…¥å’Œå†™-https-www-luogu-com-cn-problem-P2367"><a href="#JAVAæ›´å¿«æ›´å¼ºçš„è¯»å…¥å’Œå†™-https-www-luogu-com-cn-problem-P2367" class="headerlink" title="JAVAæ›´å¿«æ›´å¼ºçš„è¯»å…¥å’Œå†™ https://www.luogu.com.cn/problem/P2367"></a>JAVAæ›´å¿«æ›´å¼ºçš„è¯»å…¥å’Œå†™ <a href="https://www.luogu.com.cn/problem/P2367">https://www.luogu.com.cn/problem/P2367</a></h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token class-name">StreamTokenizer</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StreamTokenizer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>reader<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>n <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> reader<span class="token punctuation">.</span>nval<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å–ä½™æ•°çš„å°æŠ€å·§"><a href="#å–ä½™æ•°çš„å°æŠ€å·§" class="headerlink" title="å–ä½™æ•°çš„å°æŠ€å·§"></a>å–ä½™æ•°çš„å°æŠ€å·§</h2><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token punctuation">(</span>x + n<span class="token punctuation">)</span> % n å¯ä»¥ä¿è¯ä¸ä¼šå‡ºç°è´Ÿæ•°<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å…ˆæ€è€ƒå†åšé¢˜ï¼Œå‰å‡ ä¸ªé¢˜å¤§æ¦‚ç‡æ—¶æ¨¡æ‹Ÿé¢˜ï¼Œæ‰€ä»¥åˆ«æ€¥ç€ç”¨ç®—æ³•</p><h2 id="å¸¸ç”¨ç®—æ³•"><a href="#å¸¸ç”¨ç®—æ³•" class="headerlink" title="å¸¸ç”¨ç®—æ³•"></a>å¸¸ç”¨ç®—æ³•</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">next_permutation</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>a<span class="token operator">+</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> å¯¹æ•°ç»„çš„å‰nä¸ªæ•°è¿›è¡Œå…¨æ’åˆ—ï¼Œå¹¶å­˜å‚¨åœ¨è¿™ä¸ªæ•°ç»„ä¸­<span class="token keyword">char</span> a<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token function">puts</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> å¯ä»¥ç›´æ¥è¾“å‡ºä¸€è¡Œï¼Œå¦‚æœä¸æ˜¯æœ€åä¸€è¡Œè¿˜ä¼šè¾“å‡ºæ¢è¡Œç¬¦æ±‚ q<span class="token operator">^</span><span class="token number">0</span> <span class="token operator">+</span> q<span class="token operator">^</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">+</span> q<span class="token operator">^</span>n<span class="token keyword">long</span> <span class="token keyword">long</span> t <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">while</span><span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">//ç§¦ä¹zhaoç®—æ³•</span>    t <span class="token operator">=</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>q <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span>mod<span class="token punctuation">;</span><span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ•´æ•°åˆ’åˆ†</strong><a href="https://ac.nowcoder.com/acm/problem/252724">https://ac.nowcoder.com/acm/problem/252724</a></p><p>accumulate æ±‚å’Œ</p><p>å¿«ä¹çš„æ¨¡æ¿ï¼š</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;bits/stdc++.h&gt;  #define ll long long   #define pii pair&lt;int,int&gt;  using namespace std;  void solve(){   &nbsp; &nbsp;return ;  }  int main(){   &nbsp; &nbsp;ios::sync_with_stdio(false);   &nbsp; &nbsp;cin.tie(nullptr);   &nbsp; &nbsp;int T;   &nbsp; &nbsp;cin &gt;&gt; T;   &nbsp; &nbsp;while (T--) solve();   &nbsp; &nbsp;return 0;  }  â€‹```## å°TIPSï¼šåšé¢˜æ€è·¯ï¼š1. ä»å°æ•°æ®ï¼Œå°èŒƒå›´æ¨å¤§èŒƒå›´    2. åˆ’åˆ†ï¼Œä»¥åŠåè¯ï¼Œå¦‚æœè¦æ±‚å…¨éƒ¨æ»¡è¶³ä¸€ä¸ªæ€§è´¨ï¼Œé‚£ä¹ˆåªè¦æœ‰éƒ¨åˆ†ä¸æ»¡è¶³æˆ‘ä»¬å·²ç»æ¨å‡ºæ¥çš„æ¡ä»¶å³å¯ä¸æ»¡è¶³æ‰€æœ‰æ€§è´¨    &gt; 1. æ•°ç»„å’Œå­—ç¬¦ä¸²æ¯”è¾ƒå­—å…¸åºæ˜¯å¯ä»¥ç›´æ¥ç”¨å¤§äºå·å°äºå·æ¯”è¾ƒçš„&gt;     &gt; 2. å­—å…¸åºæ˜¯æŒ‡åœ¨ASCIIç ä¸­å‡ºç°çš„é¡ºåºæ‰€ä»¥ ä¹Ÿå°±æ˜¯ a b c 0 1 2 3 ABC ç­‰z&gt;     &gt; 3. vector &lt;&gt; å¯ä»¥ç›´æ¥èµ‹å€¼&gt;     ## ç‰›é¡¿è¿­ä»£æ³•ï¼šæ±‚å¹³æ–¹æ ¹ä¾‹å­ï¼š f(x)=m,å¯è½¬åŒ–ä¸º g(x)=f(x)-m=0;è¿­ä»£å…¬å¼ï¼š_x_n+1 = _x_n âˆ’ _g_ (_x_n)/ _g_ â€² (_x_n)ä¾‹é¢˜ï¼š[åŠ›æ‰£ï¼ˆLeetCodeï¼‰å®˜ç½‘ - å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å°](https://leetcode.cn/problems/sqrtx/submissions/431189596/)```c++//f (x) = x2 âˆ’ a = 0  int mySqrt(int a) {  long x = a;  while (x * x &gt; a) {  x = (x + a / x) / 2;  }  return x;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="stlå’Œä¸€äº›å†…ç½®å‡½æ•°"><a href="#stlå’Œä¸€äº›å†…ç½®å‡½æ•°" class="headerlink" title="stlå’Œä¸€äº›å†…ç½®å‡½æ•°"></a>stlå’Œä¸€äº›å†…ç½®å‡½æ•°</h3><p>accumulate(num.begin(),num.end(),0); //ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯åˆå§‹åŒ–è¦è¿”å›çš„ä¸œè¥¿ </p><h2 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h2><h3 id="å¿«é€Ÿæ’åºæ¨¡æ¿-æ ¹æ®æ•°æ¥åˆ†æ²»"><a href="#å¿«é€Ÿæ’åºæ¨¡æ¿-æ ¹æ®æ•°æ¥åˆ†æ²»" class="headerlink" title="å¿«é€Ÿæ’åºæ¨¡æ¿ æ ¹æ®æ•°æ¥åˆ†æ²»"></a>å¿«é€Ÿæ’åºæ¨¡æ¿ æ ¹æ®æ•°æ¥åˆ†æ²»</h3><p>å…ˆæ‰¾æ•°å­—ä¸­çš„ä¸­ä½æ•°ï¼Œç„¶åé€’å½’<br><strong>æ³¨æ„ï¼š</strong> whileä¸­å…ˆé€’å½’çš„å·¦è¾¹ï¼Œé‚£ä¹ˆæœ€åé€’å½’çš„æ—¶å€™å°±è¦ä»¥jæ¥ä¸ºç•Œé™ï¼Œé€’å½’çš„é¡ºåºæ— æ‰€è°“</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">void quick_sort(int q[], int l, int r){    if (l &gt;= r) return;    int x = q[rand()% (r-l+1)+l]; // éšæœºå–    int i = l - 1, j = r + 1;     while (i &lt; j) {        do i++; while (q[i] &lt; x);        do j--; while (q[j] &gt; x);        if (i &lt; j) swap(q[i], q[j]);    //å¦‚æœiä¸jæ²¡æœ‰ç›¸é‡ï¼Œå°±äº¤æ¢ä¸€ä¸‹    }    quick_sort(q, l, j);    //é€’å½’å¤„ç†å·¦å³ä¸¤è¾¹    quick_sort(q, j + 1, r);}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å½’å¹¶æ’åºæ¨¡æ¿-åˆ†æ²»-æ ¹æ®ä¸­é—´ä¸¤ä¸ªæ•°ä¸ºåˆ†ç•Œçº¿"><a href="#å½’å¹¶æ’åºæ¨¡æ¿-åˆ†æ²»-æ ¹æ®ä¸­é—´ä¸¤ä¸ªæ•°ä¸ºåˆ†ç•Œçº¿" class="headerlink" title="å½’å¹¶æ’åºæ¨¡æ¿ åˆ†æ²» æ ¹æ®ä¸­é—´ä¸¤ä¸ªæ•°ä¸ºåˆ†ç•Œçº¿"></a>å½’å¹¶æ’åºæ¨¡æ¿ åˆ†æ²» æ ¹æ®ä¸­é—´ä¸¤ä¸ªæ•°ä¸ºåˆ†ç•Œçº¿</h3><ol><li><p>ç¡®å®šåˆ†ç•Œç‚¹ï¼Œ mid=(l+r)/2</p></li><li><p>é€’å½’æ’åº leftï¼Œright</p></li><li><p>å½’å¹¶ åˆäºŒä¸ºä¸€</p></li></ol><p>æ¨¡æ¿</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">void msort(int a[], int l, int r) {      if (l &gt;= r) return;      //ç¡®å®šåˆ†ç•Œ      int mid = l + r &gt;&gt; 1;      //é€’å½’      msort(a, l, mid); msort(a, mid + 1, r);      //å½’å¹¶      int k = 0, i = l, j = mid + 1;            while (i &lt;=mid &amp;&amp; j &lt;= r) {//å·¦å³æ¯”è¾ƒï¼Œå°çš„æ”¾åœ¨è¾…åŠ©æ•°ç»„é‡Œï¼Œç›´åˆ°æœ‰ä¸€ä¸ªæŒ‡é’ˆåˆ°è¾¾è¾¹ç•Œ          if (a[i] &lt;= a[j]) tmp[k++] = a[i++];          else tmp[k++] = a[j++];      }      //è¿™é‡Œç»§ç»­æŠŠå¦ä¸€ä¸ªæ²¡åˆ°è¾¹ç•Œçš„æŒ‡é’ˆèµ‹å€¼ç»™è¾…åŠ©æ•°ç»„      while (i &lt;= mid) tmp[k++] = a[i++];      while (j &lt;= r)tmp[k++] = a[j++];      //æœ€åæŠŠè¾…åŠ©æ•°ç»„çš„å…ƒç´ è¿˜å›å»      for (int i = l, j = 0; i &lt;= r; i++, j++) a[i] = tmp[j];  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äºŒåˆ†æ³•-äºŒåˆ†è¦ä¿è¯æœ‰è§£"><a href="#äºŒåˆ†æ³•-äºŒåˆ†è¦ä¿è¯æœ‰è§£" class="headerlink" title="äºŒåˆ†æ³• äºŒåˆ†è¦ä¿è¯æœ‰è§£"></a>äºŒåˆ†æ³• äºŒåˆ†è¦ä¿è¯æœ‰è§£</h2><h3 id="æ•´æ•°äºŒåˆ†"><a href="#æ•´æ•°äºŒåˆ†" class="headerlink" title="æ•´æ•°äºŒåˆ†"></a>æ•´æ•°äºŒåˆ†</h3><p>ä¸€åˆ†ä¸ºäºŒï¼Œä¸€è¾¹æ»¡è¶³æ€§è´¨ï¼Œä¸€åŠä¸æ»¡è¶³ï¼Œå¯ä»¥æ¥ç”¨æ¥å¯»æ‰¾æ€§è´¨çš„è¾¹ç•Œ</p><p>ä¸¤ç§æ¨¡æ¿ï¼šä¸€ç§å»æ£€æŸ¥æ»¡è¶³çš„ä¸€åŠï¼Œå¦ä¸€ç§å»æ£€æŸ¥ä¸æ»¡è¶³æ€§è´¨çš„çš„ä¸€åŠ</p><p>è€ƒè™‘è¾¹ç•Œæ˜¯å¦ä¼šåŒ…æ‹¬è¿›å»</p><ol><li><p>å…ˆå†™å‡º mid=r+l&gt;&gt;1</p></li><li><p>äºŒåˆ†è¦æ£€æŸ¥çš„æ€§è´¨</p></li><li><p>ç”»å›¾è€ƒè™‘ï¼Œç›´çº¿å›¾</p></li><li><p>æ€è€ƒmidæ˜¯å¦ä¼šåŒ…å«</p></li><li><p>è€ƒè™‘ä¸å­˜åœ¨æ¡ä»¶æ—¶</p></li></ol><h2 id="l-x3D-mid-1-æ—¶-è¾“å‡ºçš„æ˜¯-L-r-x3D-mid-1-æ—¶-è¾“å‡ºçš„æ˜¯r"><a href="#l-x3D-mid-1-æ—¶-è¾“å‡ºçš„æ˜¯-L-r-x3D-mid-1-æ—¶-è¾“å‡ºçš„æ˜¯r" class="headerlink" title="l = mid + 1 æ—¶,è¾“å‡ºçš„æ˜¯ L , r = mid -1 æ—¶ è¾“å‡ºçš„æ˜¯r"></a>l = mid + 1 æ—¶,è¾“å‡ºçš„æ˜¯ L , r = mid -1 æ—¶ è¾“å‡ºçš„æ˜¯r</h2><p>æ³¨æ„æ­»å¾ªç¯ï¼Œç”·å·¦å¥³å³ï¼ŒæŸ¥æ‰¾ä»å³ä¾§å¾€å·¦çš„æ—¶å€™mid è¦ + 1ï¼Œå¦åˆ™ä¸+1</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">l + (r - l + 1 &gt;&gt; 1); â€‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">æ›´å¥½çš„äºŒåˆ†æ¨¡æ¿<span class="token keyword">while</span><span class="token punctuation">(</span>l<span class="token operator">&lt;=</span>r<span class="token punctuation">)</span><span class="token punctuation">{</span>mid <span class="token operator">=</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>mid <span class="token operator">&lt;</span> r<span class="token punctuation">)</span> r <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">else</span>  mid <span class="token operator">=</span> l <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æµ®ç‚¹æ•°äºŒåˆ†-ä¸è¦å¤„ç†è¾¹ç•Œ"><a href="#æµ®ç‚¹æ•°äºŒåˆ†-ä¸è¦å¤„ç†è¾¹ç•Œ" class="headerlink" title="æµ®ç‚¹æ•°äºŒåˆ† ä¸è¦å¤„ç†è¾¹ç•Œ"></a>æµ®ç‚¹æ•°äºŒåˆ† ä¸è¦å¤„ç†è¾¹ç•Œ</h3><p>æ€è·¯ï¼šé€šè¿‡midæ¥åˆ¤æ–­ï¼Œç­”æ¡ˆè½åœ¨ç¼©å°çš„åŒºé—´å†…ï¼Œåªè¦è¿‘ä¼¼å€¼</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">bool check(double x) {/* ... */} // æ£€æŸ¥xæ˜¯å¦æ»¡è¶³æŸç§æ€§è´¨    double bsearch_3(double l, double r)  {      const double eps = 1e-6;   // eps è¡¨ç¤ºç²¾åº¦ï¼Œå–å†³äºé¢˜ç›®å¯¹ç²¾åº¦çš„è¦æ±‚      while (r - l &gt; eps)      {          double mid = (l + r) / 2;          if (check(mid)) r = mid;          else l = mid;      }      //æˆ–è€…ç›´æ¥ä¸ç®¡ç²¾åº¦ï¼Œç›´æ¥å¾ªç¯å‡ ç™¾æ¬¡      return l;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é«˜ç²¾åº¦"><a href="#é«˜ç²¾åº¦" class="headerlink" title="é«˜ç²¾åº¦"></a>é«˜ç²¾åº¦</h2><h3 id="åŠ æ³•ï¼š-æ³¨æ„è¦æŠŠAè®¾ä¸ºä½æ•°æ›´å¤§çš„é‚£ä¸€ä¸ªï¼Œå› ä¸ºæœ€åçš„ä½æ•°å–å†³äºä½æ•°å¤§çš„é‚£ä¸€ä¸ªï¼Œä½¿ç”¨vectorå®¹å™¨å¯ä»¥æ›´æ–¹ä¾¿çš„è¿›è¡Œè®¡ç®—å’Œè¿›ä½å’Œç¡®å®šä½æ•°"><a href="#åŠ æ³•ï¼š-æ³¨æ„è¦æŠŠAè®¾ä¸ºä½æ•°æ›´å¤§çš„é‚£ä¸€ä¸ªï¼Œå› ä¸ºæœ€åçš„ä½æ•°å–å†³äºä½æ•°å¤§çš„é‚£ä¸€ä¸ªï¼Œä½¿ç”¨vectorå®¹å™¨å¯ä»¥æ›´æ–¹ä¾¿çš„è¿›è¡Œè®¡ç®—å’Œè¿›ä½å’Œç¡®å®šä½æ•°" class="headerlink" title="åŠ æ³•ï¼š æ³¨æ„è¦æŠŠAè®¾ä¸ºä½æ•°æ›´å¤§çš„é‚£ä¸€ä¸ªï¼Œå› ä¸ºæœ€åçš„ä½æ•°å–å†³äºä½æ•°å¤§çš„é‚£ä¸€ä¸ªï¼Œä½¿ç”¨vectorå®¹å™¨å¯ä»¥æ›´æ–¹ä¾¿çš„è¿›è¡Œè®¡ç®—å’Œè¿›ä½å’Œç¡®å®šä½æ•°"></a>åŠ æ³•ï¼š æ³¨æ„è¦æŠŠAè®¾ä¸ºä½æ•°æ›´å¤§çš„é‚£ä¸€ä¸ªï¼Œå› ä¸ºæœ€åçš„ä½æ•°å–å†³äºä½æ•°å¤§çš„é‚£ä¸€ä¸ªï¼Œä½¿ç”¨vectorå®¹å™¨å¯ä»¥æ›´æ–¹ä¾¿çš„è¿›è¡Œè®¡ç®—å’Œè¿›ä½å’Œç¡®å®šä½æ•°</h3><ol><li><p>é€†åºå­˜æ•°çš„æ¯ä¸€ä½</p></li><li><p>ä»ä½ä½å¼€å§‹è®¡ç®—ï¼Œä¹‹åè®¡ç®—è¿›ä½</p></li><li><p>åŠ å®Œä¹‹åæ£€æŸ¥æœ€åä¸€ä½æ˜¯å¦è¿˜æœ‰è¿›ä½</p></li><li><p>è¿”å›æ•°å­—</p></li></ol><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">vector&lt;int&gt; add(vector&lt;int&gt; &amp;A, vector&lt;int&gt; &amp;B)  {      if (A.size() &lt; B.size()) return add(B, A);        vector&lt;int&gt; C;      int t = 0;      for (int i = 0; i &lt; A.size(); i ++ )      {          t += A[i];          if (i &lt; B.size()) t += B[i];          C.push_back(t % 10);          t /= 10;      }        if (t) C.push_back(1);      return C;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å‡æ³•"><a href="#å‡æ³•" class="headerlink" title="å‡æ³•"></a>å‡æ³•</h3><p>å’ŒåŠ æ³•åŸºæœ¬ä¸€è‡´ï¼Œåªè¦å˜è¿›ä½ä¸ºå€Ÿä½å³å¯</p><p>// C = A - B, æ»¡è¶³A &gt;= B, A &gt;= 0, B &gt;= 0  </p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">vector&lt;int&gt; sub(vector&lt;int&gt; &amp;A, vector&lt;int&gt; &amp;B)  {      vector&lt;int&gt; C;      for (int i = 0, t = 0; i &lt; A.size(); i ++ )      {          t = A[i] - t;          if (i &lt; B.size()) t -= B[i];          C.push_back((t + 10) % 10);          if (t &lt; 0) t = 1;          else t = 0;      }        while (C.size() &gt; 1 &amp;&amp; C.back() == 0) C.pop_back();      return C;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¹˜æ³•"><a href="#ä¹˜æ³•" class="headerlink" title="ä¹˜æ³•"></a>ä¹˜æ³•</h3><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">vector&lt;int&gt; mul(vector&lt;int&gt;&amp;A,int b){   &nbsp; vector&lt;int&gt;C;   &nbsp; int t=0;   &nbsp; for(int i=0;i&lt;A.size()||t;i++){//å‡ºç°è¿›ä½   &nbsp; &nbsp; &nbsp;if(i&lt;A.size()) t+=A[i]*b;   &nbsp; &nbsp; &nbsp;C.push_back(t%10);   &nbsp; &nbsp; &nbsp;t/=10;   &nbsp; }   &nbsp; while(C.size()&gt;1&amp;&amp;C.back()==0) C.pop_back();   &nbsp; //å»é™¤å‰å¯¼é›¶   &nbsp; return C;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">### é™¤æ³•vector&lt;int&gt; div(vector&lt;int&gt;&amp;A,int b){   &nbsp; vector&lt;int&gt;C;   &nbsp; int t=0;   &nbsp; for(int i=0;i&lt;A.size();i++){   &nbsp; &nbsp; &nbsp;t=t*10+A[i];   &nbsp; &nbsp; &nbsp;C.push_back(t/b);   &nbsp; &nbsp; &nbsp;t %= b;   &nbsp; }   &nbsp; //è¿™é‡Œæ˜¯æ¸…é™¤å‰ç½®é›¶ï¼Œä¸æ˜¯åç½®é›¶ &nbsp; reverse(C.begin(),C.end());   &nbsp; while(C.size()&gt;1&amp;&amp;C.back()==0) C.pop_back();   &nbsp; return C;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‰ç¼€å’Œå’Œå·®åˆ†"><a href="#å‰ç¼€å’Œå’Œå·®åˆ†" class="headerlink" title="å‰ç¼€å’Œå’Œå·®åˆ†"></a>å‰ç¼€å’Œå’Œå·®åˆ†</h2><p><strong>æ„é€ å·®åˆ†å¯ä»¥ç”¨ä¸€ä¸ªç©ºæ•°ç»„ï¼Œä¸€ç›´æ‰§è¡Œæ’å…¥æ“ä½œå³å¯</strong></p><p>å‰ç¼€å’Œä¸€èˆ¬åˆå§‹åŒ–ä¸º0åˆ°nä½†æ˜¯åªç”¨1åˆ°n</p><p>äºŒç»´</p><p>S[i, j] = ç¬¬iè¡Œjåˆ—æ ¼å­å·¦ä¸Šéƒ¨åˆ†æ‰€æœ‰å…ƒç´ çš„å’Œ<br>ä»¥(x1, y1)ä¸ºå·¦ä¸Šè§’ï¼Œ(x2, y2)ä¸ºå³ä¸‹è§’çš„å­çŸ©é˜µçš„å’Œä¸ºï¼š<br>S[x2, y2] - S[x1 - 1, y2] - S[x2, y1 - 1] + S[x1 - 1, y1 - 1]</p><p>äºŒç»´å·®åˆ†ï¼š å·®åˆ†çš„å‰ç¼€å’Œå°±æ˜¯åŸæ•°ç»„</p><p>ç»™ä»¥(x1, y1)ä¸ºå·¦ä¸Šè§’ï¼Œ(x2, y2)ä¸ºå³ä¸‹è§’çš„å­çŸ©é˜µä¸­çš„æ‰€æœ‰å…ƒç´ åŠ ä¸Šcï¼š<br>S[x1, y1] += c, S[x2 + 1, y1] -= c, S[x1, y2 + 1] -= c, S[x2 + 1, y2 + 1] += c//æ³¨æ„æ˜¯x2+1,y2+1ä¸æ˜¯x2,y2</p><h2 id="åŒæŒ‡é’ˆ"><a href="#åŒæŒ‡é’ˆ" class="headerlink" title="åŒæŒ‡é’ˆ"></a>åŒæŒ‡é’ˆ</h2><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">int x;  int * p1 = &amp;x; // æŒ‡é’ˆå¯ä»¥è¢«ä¿®æ”¹ï¼Œå€¼ä¹Ÿå¯ä»¥è¢«ä¿®æ”¹  const int * p2 = &amp;x; // æŒ‡é’ˆå¯ä»¥è¢«ä¿®æ”¹ï¼Œå€¼ä¸å¯ä»¥è¢«ä¿®æ”¹ï¼ˆconst intï¼‰  int * const p3 = &amp;x; // æŒ‡é’ˆä¸å¯ä»¥è¢«ä¿®æ”¹ï¼ˆ* constï¼‰ï¼Œå€¼å¯ä»¥è¢«ä¿®æ”¹  const int * const p4 = &amp;x; // æŒ‡é’ˆä¸å¯ä»¥è¢«ä¿®æ”¹ï¼Œå€¼ä¹Ÿä¸å¯ä»¥è¢«ä¿®æ”¹for (int i = 0, j = 0; i &lt; n; i ++ )  {      while (j &lt; i &amp;&amp; check(i, j)) j ++ ;        // å…·ä½“é—®é¢˜çš„é€»è¾‘  }  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¸¸è§é—®é¢˜åˆ†ç±»ï¼š<br>    (1) å¯¹äºä¸€ä¸ªåºåˆ—ï¼Œç”¨ä¸¤ä¸ªæŒ‡é’ˆç»´æŠ¤ä¸€æ®µåŒºé—´<br>    (2) å¯¹äºä¸¤ä¸ªåºåˆ—ï¼Œç»´æŠ¤æŸç§æ¬¡åºï¼Œæ¯”å¦‚å½’å¹¶æ’åºä¸­åˆå¹¶ä¸¤ä¸ªæœ‰åºåºåˆ—çš„æ“ä½œ</p><h3 id="Floydåˆ¤åœˆæ³•-é¾Ÿå…”èµ›è·‘æ³•-ç”¨äºåˆ¤æ–­é“¾è¡¨æœ‰æ— ç¯å’Œæ±‚å‡ºç¯çš„é•¿åº¦"><a href="#Floydåˆ¤åœˆæ³•-é¾Ÿå…”èµ›è·‘æ³•-ç”¨äºåˆ¤æ–­é“¾è¡¨æœ‰æ— ç¯å’Œæ±‚å‡ºç¯çš„é•¿åº¦" class="headerlink" title="Floydåˆ¤åœˆæ³• é¾Ÿå…”èµ›è·‘æ³• ç”¨äºåˆ¤æ–­é“¾è¡¨æœ‰æ— ç¯å’Œæ±‚å‡ºç¯çš„é•¿åº¦"></a>Floydåˆ¤åœˆæ³• é¾Ÿå…”èµ›è·‘æ³• ç”¨äºåˆ¤æ–­é“¾è¡¨æœ‰æ— ç¯å’Œæ±‚å‡ºç¯çš„é•¿åº¦</h3><p>ä¸¤ä¸ªæŒ‡é’ˆfast slow éƒ½ä»èµ·å§‹ä½ç½®å‡ºå‘ï¼Œfast ä¸€æ¬¡èµ°2æ­¥ï¼Œslowä¸€æ¬¡èµ°1æ­¥ï¼Œå¦‚æœèƒ½ç›¸é‡ï¼Œåˆ™å­˜åœ¨ç¯</p><p>è®¡ç®—ç¯çš„é•¿åº¦</p><p>è®©å…¶ä¸­ä¸€ä¸ªæŒ‡é’ˆåœåœ¨ç¯çš„èµ·ç‚¹ä¸åŠ¨ï¼Œå¦ä¸€ä¸ªä¸€æ­¥ä¸€æ­¥å‘å‰èµ°å¹¶è®°å½•æ­¥æ•°ï¼Œå†æ¬¡ç›¸é‡æ—¶æ­¥æ•°å³ä¸ºç¯çš„é•¿åº¦ã€‚</p><p>å¯»æ‰¾ç¯çš„èµ·ç‚¹</p><p>å…¶ä¸­ä¸€ä¸ªæŒ‡é’ˆåœ¨ç¯çš„èµ·ç‚¹ä¸åŠ¨ï¼Œå¦ä¸€ä¸ªæ”¾åˆ°èµ·ç‚¹ï¼Œä¸¤ä¸ªæŒ‡é’ˆåŒæ—¶ä¸€æ­¥ä¸€æ­¥ç§»åŠ¨ï¼Œåˆ™ä¸¤æŒ‡é’ˆå°†ä¼šåœ¨å¾ªç¯èŠ‚çš„èµ·ç‚¹ç›¸é‡ã€‚</p><p><a href="https://leetcode.cn/problems/linked-list-cycle-ii/description/">142. ç¯å½¢é“¾è¡¨ II - åŠ›æ‰£ï¼ˆLeetcodeï¼‰</a></p><p>/**  </p><ul><li>Definition for singly-linked list.  </li><li>struct ListNode {  </li><li><pre><code>int val;  </code></pre></li><li><pre><code>ListNode *next;  </code></pre></li><li><pre><code>ListNode(int x) : val(x), next(NULL) {}  </code></pre></li><li>};<br> */<br>class Solution {<br>public:<br> ListNode *detectCycle(ListNode *head) {<br>ListNode *fast=head,*slow=head;<br>   do{<br>   if(!fast||!fast-&gt;next) return NULL;//å¦‚æœèƒ½åˆ°è¾¾æœ«å°¾ï¼Œåˆ™ä¸å­˜åœ¨ç¯<br>   fast=fast-&gt;next-&gt;next;<br>   slow=slow-&gt;next;<br>   }while(fast!=slow);<br>   fast=head;<br>   while(fast!=slow){<br>   fast=fast-&gt;next;<br>   slow=slow-&gt;next;<br>   }<br>   return slow;<br> }<br>};</li></ul><h2 id="ä½è¿ç®—"><a href="#ä½è¿ç®—" class="headerlink" title="ä½è¿ç®—"></a>ä½è¿ç®—</h2><p>æ€è·¯ï¼š</p><p>nçš„ç¬¬kä½æ˜¯ä»€ä¹ˆï¼Ÿ n&gt;&gt;k&amp;1 å³ç§»kä½ä¸1ä¸å¾—åˆ°æ˜¯0å°±æ˜¯0ï¼Œåä¹‹å°±æ˜¯1</p><ol><li><p>å…ˆæŠŠè¦åˆ¤æ–­çš„ä½ç½®ç§»åˆ°æœ€å·¦è¾¹</p></li><li><p>åˆ¤æ–­</p></li></ol><h3 id="lowbit"><a href="#lowbit" class="headerlink" title="lowbit"></a>lowbit</h3><p>è§£é‡Šï¼šcppçš„è´Ÿæ•°ä½¿ç”¨çš„è¡¥ç è¡¨ç¤ºçš„æ‰€ä»¥ï¼Œ-xå°±ç­‰äº ~x+1 åç +1</p><p>ç”¨æ³•ï¼š<a href="https://zhuanlan.zhihu.com/p/93795692">æ ‘çŠ¶æ•°ç»„</a>å’Œæ±‚1çš„ä¸ªæ•°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span></span><span class="token punctuation">;</span><span class="token comment">// 1:æ— éœ€package</span><span class="token comment">// 2: ç±»åå¿…é¡»Main, ä¸å¯ä¿®æ”¹</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">N</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token number">1e5</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tree <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">long</span><span class="token punctuation">[</span><span class="token class-name">N</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">int</span> n <span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">lowbit</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> x <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token punctuation">,</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> pos <span class="token operator">=</span> i <span class="token punctuation">;</span> pos <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> pos <span class="token operator">+=</span> <span class="token function">lowbit</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    tree<span class="token punctuation">[</span>pos<span class="token punctuation">]</span> <span class="token operator">+=</span> x<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">long</span> sum <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> pos <span class="token operator">=</span> x<span class="token punctuation">;</span> pos <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> pos<span class="token operator">-=</span><span class="token function">lowbit</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    sum <span class="token operator">+=</span>tree<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> sum<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">ask</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span><span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">query</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">query</span><span class="token punctuation">(</span>a<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Scanner</span> scan <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>        n <span class="token operator">=</span> scan<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> m <span class="token operator">=</span>scan<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> x <span class="token operator">=</span> scan<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">update</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>m<span class="token operator">--</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> k <span class="token operator">=</span> scan<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> a <span class="token operator">=</span> scan<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> b <span class="token operator">=</span> scan<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">ask</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token function">update</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        scan<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="æ ‘çŠ¶æ•°ç»„ï¼šå¯¹å·®åˆ†å’Œå‰ç¼€å’Œçš„åˆ©ç”¨ï¼š"><a href="#æ ‘çŠ¶æ•°ç»„ï¼šå¯¹å·®åˆ†å’Œå‰ç¼€å’Œçš„åˆ©ç”¨ï¼š" class="headerlink" title="æ ‘çŠ¶æ•°ç»„ï¼šå¯¹å·®åˆ†å’Œå‰ç¼€å’Œçš„åˆ©ç”¨ï¼š"></a>æ ‘çŠ¶æ•°ç»„ï¼šå¯¹å·®åˆ†å’Œå‰ç¼€å’Œçš„åˆ©ç”¨ï¼š</h1><h3 id="ä½¿ç”¨æƒ…å†µï¼š"><a href="#ä½¿ç”¨æƒ…å†µï¼š" class="headerlink" title="ä½¿ç”¨æƒ…å†µï¼š"></a>ä½¿ç”¨æƒ…å†µï¼š</h3><ol><li><p>æ•°ç»„ä¸å˜æ±‚åŒºé—´å’Œ</p></li><li><p>å¤šæ¬¡ä¿®æ”¹æŸä¸ªåŒºé—´ï¼Œæ±‚åŒºé—´å’Œ</p></li><li><p>å°†æŸä¸ªåŒºé—´å˜ä¸ºåŒä¸€ä¸ªæ•°æ±‚åŒºé—´å’Œ</p></li><li><p>å¤šæ¬¡ä¿®æ”¹åŒºé—´ï¼Œå¯»æ‰¾å®šç‚¹å€¼</p></li></ol><h2 id="æ¨¡æ¿ï¼š"><a href="#æ¨¡æ¿ï¼š" class="headerlink" title="æ¨¡æ¿ï¼š"></a>æ¨¡æ¿ï¼š</h2><p>è¯´æ˜ï¼šlowbit()å¥‡å¦™ç”¨æ³•â€¦..</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#define low```bit(x) (-x)&amp;x  ///æˆ–è€… int lowbit(int x) {return -x&amp;x;}  int tree[length];//æ ‘çŠ¶æ•°ç»„ï¼Œé•¿åº¦å’ŒåŸæ•°ç»„ç›¸ç­‰  //åŒºé—´ä¿®æ”¹  void update(int x,int val)  {      while(x){          tree[x]+=val;          x+=lowbit(x);      }  }  //åŒºé—´æ±‚å’Œ  int sum(int l,int r){      int ans=0;      while(r){          ans+=tree[r];          r-=lowbit(r);      }      l--;//      while(l){          ans-=tree[l];          l-=lowbit(l);      }      return ans;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä½¿ç”¨æ–¹å¼ï¼š"><a href="#ä½¿ç”¨æ–¹å¼ï¼š" class="headerlink" title="ä½¿ç”¨æ–¹å¼ï¼š"></a>ä½¿ç”¨æ–¹å¼ï¼š</h2><ol><li><p>æ­£å¸¸çš„é¡¶ç‚¹ä¿®æ”¹ï¼ŒåŒºé—´æ±‚å’Œç›´æ¥ç”¨</p></li><li><p><strong>åŒºé—´ä¿®æ”¹ï¼Œæ±‚å•ç‹¬ä¸€ä¸ªæ•°</strong> <a href="https://www.luogu.com.cn/problem/P3368">P3368 ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„ 2 - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)</a></p><ul><li><p>æ ‘çŠ¶æ•°ç»„æ˜¯ä¿å­˜çš„æ¯ä¸€ä¸ªä¸‹æ ‡ä¸ºä½ç½®çš„å‰ç¼€å’Œ</p></li><li><p>æƒ³è¦æ±‚æŒ‡å®šä½ç½®çš„æ•°å€¼éœ€è¦ç”¨åˆ°å·®åˆ†,å·®åˆ†çš„å‰ç¼€å’Œå°±æ˜¯æ¯ä¸€ä¸ªä½ç½®çš„æ•°æ®å¤§å°</p></li><li><p>ä¿®æ”¹æ—¶åªéœ€è¦ä¿®æ”¹ update(l,val),update(r+1,-val)</p></li><li><p>åˆå§‹åŒ–æ—¶ï¼Œè¦æ’å…¥çš„æ˜¯å·®åˆ†</p>  <pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;  #include &lt;algorithm&gt;  #define ll long long  #define lowbit(x) (x&amp;(-x))  using namespace std;  const int mx = 10e5 + 5;  int t[mx], m, n;  int add(int x, int k) {  while (x &lt;= n) {  t[x] += k;  x += lowbit(x);  }  }  int query(int x){  ll ans=0;  while(x){  ans+=t[x];  x-=lowbit(x);  }  return ans;  }  //ç”¨å·®åˆ†æ¥çš„å‰ç¼€å’Œæ¥è¡¨ç¤ºæ¯ä¸€ä½ç½®ä¸Šçš„æ•°å­—ï¼Œ  //ç¬¬ä¸€ä¸ªæ•°å­—ä¹‹åï¼Œæ¯æ¬¡æŠŠå·®åˆ†åŠ å…¥ï¼Œå†æ±‚å‰ç¼€å’Œå°±èƒ½å¾—åˆ°æ¯ä¸€ä¸ªä½ç½®ä¸Šçš„æ•°å­—æ˜¯å¤šå°‘äº†  //ä¿®æ”¹æ—¶åªéœ€è¦ä¿®æ”¹xå’Œy+1ä¸¤ä¸ªä½ç½®çš„å·®åˆ†ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨çš„treeæ˜¯å‰ç¼€å’Œï¼Œæ‰€ä»¥ä¾ç„¶è¦ç”¨æŠŠå’Œlowbitæœ‰å…³çš„éƒ½ä¿®æ”¹ äº†   int main() {  cin &gt;&gt; n &gt;&gt; m;  int cf=0;   for (int i = 1; i &lt;= n; i++) {  int num;  scanf("%d", &amp;num);  add(i,num-cf);  cf=num;  }    for (int i = 1; i &lt;= m; i++) {  int ch, x, y,k;  scanf("%d", &amp;ch);  if (ch == 1){  scanf("%d %d %d", &amp;x, &amp;y, &amp;k);  add(x,k);  add(y+1,-k);  }  else {  int s;  scanf("%d", &amp;s);  printf("%d\n", query(s));  }  }  return 0;  }  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>ç”¨æŒ‡å®šæ•°æ®æ›¿æ¢æŸä¸ªæ•°æ®ï¼Œç„¶åæ±‚å’Œ <a href="https://leetcode.cn/problems/range-sum-query-mutable/submissions/429237767/">307. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„å¯ä¿®æ”¹ - åŠ›æ‰£ï¼ˆLeetcodeï¼‰</a></p><ul><li><p>æ›´æ¢æ•°æ®ä¹Ÿæ˜¯ç”¨åˆ°äº†å·®åˆ†ï¼Œæ–°çš„æ•°æ®-åŸæ•°æ®==è¦æ›´æ–°çš„val</p></li><li><p>ç„¶åæ›´æ–°ä¹‹åï¼ŒåŸæ•°ç»„æŒ‡å®šä½ç½®ä¹Ÿè¦æ›´æ–°ï¼Œæ–¹ä¾¿ä¸‹æ¬¡ä¿®æ”¹åŒä¸€ä½ç½®</p></li><li><p>å…¶ä»–æ­£å¸¸é£Ÿç”¨å³å¯</p>  <pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">class NumArray {      int []t;      int n;      int []nums;      int lowbit(int x){return x&amp;(-x);}      public NumArray(int[] nums) {          this.nums=nums;          n=nums.length;          t=new int[n+1];          int i=1;          for (int num:nums               ) {              add(i++,num);          }      }      void add(int index,int val){          while(index&lt;=n){              t[index]+=val;              index+=lowbit(index);          }      }      public void update(int index, int val) {          add(index+1,val-nums[index]);          nums[index]=val;      }            public int sumRange(int left, int right) {          int ans=0;          right++;          while(right&gt;0){              ans+=t[right];              right-=lowbit(right);          }            while(left&gt;0){              ans-=t[left];              left-=lowbit(left);          }          return ans;      }  }    /**   * Your NumArray object will be instantiated and called as such:   * NumArray obj = new NumArray(nums);   * obj.update(index,val);   * int param_2 = obj.sumRange(left,right);   */<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ol><p>æ±‚1çš„ä¸ªæ•°</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;algorithm&gt;  #include &lt;vector&gt;  #include &lt;iostream&gt;  #define lowbit(x) (-x)&amp;x  using namespace std;  int main(){   &nbsp; &nbsp;int n,ans=0;   &nbsp; &nbsp;cin&gt;&gt;n;   &nbsp; &nbsp;while(n){   &nbsp; &nbsp; &nbsp; &nbsp;ans++;   &nbsp; &nbsp; &nbsp; &nbsp;n-=lowbit(n);   &nbsp;  }   &nbsp; &nbsp;cout&lt;&lt;ans&lt;&lt;endl;   &nbsp; &nbsp;return 0;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç¦»æ•£åŒ–"><a href="#ç¦»æ•£åŒ–" class="headerlink" title="ç¦»æ•£åŒ–"></a>ç¦»æ•£åŒ–</h2><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">unique è¿”å›çš„æ˜¯ä¸‹ä¸‹æ ‡vector&lt;int&gt; alls; // å­˜å‚¨æ‰€æœ‰å¾…ç¦»æ•£åŒ–çš„å€¼  sort(alls.begin(), alls.end()); // å°†æ‰€æœ‰å€¼æ’åº  alls.erase(unique(alls.begin(), alls.end()), alls.end()); &nbsp; // å»æ‰é‡å¤å…ƒç´   //é…åˆerase å³å¯æŠŠæ”¾åœ¨åé¢çš„é‡å¤å…ƒç´ åˆ é™¤  /*  è¯¥å‡½æ•°çš„ä½œç”¨æ˜¯â€œå»é™¤â€å®¹å™¨æˆ–è€…æ•°ç»„ä¸­ç›¸é‚»å…ƒç´ çš„é‡å¤å‡ºç°çš„å…ƒç´   (1) è¿™é‡Œçš„å»é™¤å¹¶éçœŸæ­£æ„ä¹‰çš„eraseï¼Œè€Œæ˜¯å°†é‡å¤çš„å…ƒç´ æ”¾åˆ°å®¹å™¨çš„æœ«å°¾ï¼Œè¿”å›å€¼æ˜¯å»é‡ä¹‹åçš„å°¾åœ°å€ã€‚   (2) uniqueé’ˆå¯¹çš„æ˜¯ç›¸é‚»å…ƒç´ ï¼Œæ‰€ä»¥å¯¹äºé¡ºåºé¡ºåºé”™ä¹±çš„æ•°ç»„æˆå‘˜ï¼Œæˆ–è€…å®¹å™¨æˆå‘˜ï¼Œéœ€è¦å…ˆè¿›è¡Œæ’åºï¼Œå¯ä»¥è°ƒç”¨std::sort()å‡½æ•°  // äºŒåˆ†æ±‚å‡ºxå¯¹åº”çš„ç¦»æ•£åŒ–çš„å€¼*/  int find(int x) // æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºç­‰äºxçš„ä½ç½®  {   &nbsp; &nbsp;int l = 0, r = alls.size() - 1;   &nbsp; &nbsp;while (l &lt; r)   &nbsp;  {   &nbsp; &nbsp; &nbsp; &nbsp;int mid = l + r &gt;&gt; 1;   &nbsp; &nbsp; &nbsp; &nbsp;if (alls[mid] &gt;= x) r = mid;   &nbsp; &nbsp; &nbsp; &nbsp;else l = mid + 1;   &nbsp;  }   &nbsp; &nbsp;return r + 1; // æ˜ å°„åˆ°1, 2, ...n  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åŒºé—´å’Œå¹¶"><a href="#åŒºé—´å’Œå¹¶" class="headerlink" title="åŒºé—´å’Œå¹¶"></a>åŒºé—´å’Œå¹¶</h2><p>æ¯æ¬¡ç»´æŠ¤ä¸€ä¸ªå³ç«¯ç‚¹</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">// å°†æ‰€æœ‰å­˜åœ¨äº¤é›†çš„åŒºé—´åˆå¹¶  void merge(vector&lt;PII&gt; &amp;segs)  {      vector&lt;PII&gt; res;        sort(segs.begin(), segs.end());//æ ¹æ®firstè¿›è¡Œæ’åºï¼Œé»˜è®¤çš„å°±æ˜¯è¿™æ ·çš„ä¸éœ€è¦è¿›è¡Œè‡ªå®šä¹‰        int st = -2e9, ed = -2e9;      for (auto seg : segs)          if (ed &lt; seg.first)          {              //å½“èµ·ç‚¹çš„å€¼å¤§äºå³ç«¯ç‚¹çš„æ—¶å€™ï¼Œä¸€æ®µåŒºé—´ç»“æŸï¼Œå¯ä»¥ç»§ç»­ä¸‹ä¸€æ®µåŒºé—´äº†              if (st != -2e9) res.push_back({st, ed});              st = seg.first, ed = seg.second;          }  g        else ed = max(ed, seg.second);//å¦‚æœå·¦æ²¡å¤§äºå³ç«¯ç‚¹ï¼Œé‚£ä¹ˆå³ç«¯ç‚¹æ¯æ¬¡æ›´æ–°å®Œä¸ºæœ€å¤§å€¼        if (st != -2e9) res.push_back({st, ed});      segs = res;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ•°ç»„æ¨¡æ‹Ÿé“¾è¡¨"><a href="#æ•°ç»„æ¨¡æ‹Ÿé“¾è¡¨" class="headerlink" title="æ•°ç»„æ¨¡æ‹Ÿé“¾è¡¨"></a>æ•°ç»„æ¨¡æ‹Ÿé“¾è¡¨</h2><h3 id="å•é“¾è¡¨"><a href="#å•é“¾è¡¨" class="headerlink" title="å•é“¾è¡¨"></a>å•é“¾è¡¨</h3><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">int head,e[N],ne[N],idx;  void init(){      head=-1;      idx=0;  }  //å¤´æ’  //head ä¹Ÿæ˜¯æŒ‡é’ˆ,e[idx] æ–°èŠ‚ç‚¹  void add_head(int x){      e[idx]=x;//æ’å…¥æ•°æ®      ne[idx]=head;//idx å½“å‰çš„ä½ç½®çš„æŒ‡é’ˆæŒ‡å‘headæŒ‡å‘çš„ä½ç½® -1      head=idx;//head æŒ‡é’ˆæŒ‡å‘idx       idx++;  }  //æ’å…¥ä»»æ„ä½ç½®  void insert_linkedlist(int k,int x){      e[idx]=x;//å»ºç«‹æ–°èŠ‚ç‚¹      ne[idx]=ne[k];//æ–°èŠ‚ç‚¹æŒ‡å‘kçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹      ne[k]=ne[idx]; //kæŒ‡å‘idxè¿™ä¸ªç»“ç‚¹      idx++;  }  void delete_linkedlist(int k){      ne[k]=ne[ne[k]];  }  int main(){      int k,x,m;      char op;      cin&gt;&gt;m;      init();      while(m--){          cin&gt;&gt;op;          if(op=='h'){              cin&gt;&gt;x;              add_head(x);          }          else if(op=='d'){              cin&gt;&gt;k;              delete_linkedlist(k-1);          }          else {              cin&gt;&gt;k&gt;&gt;x;              insert_linkedlist(k-1,x);          }      }      for(int i=head;i!=-1;i=ne[i]){cout&lt;&lt;e[i]&lt;&lt;' ';}      return 0;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åŒé“¾è¡¨"><a href="#åŒé“¾è¡¨" class="headerlink" title="åŒé“¾è¡¨"></a>åŒé“¾è¡¨</h2><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">// e[]è¡¨ç¤ºèŠ‚ç‚¹çš„å€¼ï¼Œl[]è¡¨ç¤ºèŠ‚ç‚¹çš„å·¦æŒ‡é’ˆï¼Œr[]è¡¨ç¤ºèŠ‚ç‚¹çš„å³æŒ‡é’ˆï¼Œidxè¡¨ç¤ºå½“å‰ç”¨åˆ°äº†å“ªä¸ªèŠ‚ç‚¹  int e[N], l[N], r[N], idx;    // åˆå§‹åŒ–  void init()  {      //0æ˜¯å·¦ç«¯ç‚¹ï¼Œ1æ˜¯å³ç«¯ç‚¹      r[0] = 1, l[1] = 0;      idx = 2;  }    // åœ¨èŠ‚ç‚¹açš„å³è¾¹æ’å…¥ä¸€ä¸ªæ•°x  void insert(int a, int x)  {      e[idx] = x;      l[idx] = a, r[idx] = r[a];      l[r[a]] = idx, r[a] = idx ++ ;  }    // åˆ é™¤èŠ‚ç‚¹a  void remove(int a)  {      l[r[a]] = l[a];      r[l[a]] = r[a];  }  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ ˆ"><a href="#æ ˆ" class="headerlink" title="æ ˆ"></a>æ ˆ</h2><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">// ttè¡¨ç¤ºæ ˆé¡¶  int stk[N], tt = 0;    // å‘æ ˆé¡¶æ’å…¥ä¸€ä¸ªæ•°  stk[ ++ tt] = x;    // ä»æ ˆé¡¶å¼¹å‡ºä¸€ä¸ªæ•°  tt -- ;    // æ ˆé¡¶çš„å€¼  stk[tt];    // åˆ¤æ–­æ ˆæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœ tt &gt; 0ï¼Œåˆ™è¡¨ç¤ºä¸ä¸ºç©º  if (tt &gt; 0)  {    }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å•è°ƒæ ˆ"><a href="#å•è°ƒæ ˆ" class="headerlink" title="å•è°ƒæ ˆ"></a>å•è°ƒæ ˆ</h2><p>æ³¨æ„è¿™ä¸ªé¢˜ç›®è¦çš„æ˜¯ç»“æœçš„ä¸‹æ ‡ä¸æ˜¯å…·ä½“çš„æ•°æ®</p><p>ç”¨æ ˆæš´åŠ›æ¨¡æ‹Ÿä¸€éï¼Œç„¶åå†è€ƒè™‘å“ªäº›å…ƒç´ æ²¡æœ‰ç”¨å¤„ï¼Œå°±å¯ä»¥æ’é™¤</p><p><a href="https://www.luogu.com.cn/problem/P5788">P5788 ã€æ¨¡æ¿ã€‘å•è°ƒæ ˆ - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)</a></p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include&lt;iostream&gt;  #include &lt;cstdio&gt;  #define ll long long   using namespace std;  const ll N=3*1000000+1;  ll stk[N],a[N],ans[N];  int tt=0;  int main(){      int n;      cin&gt;&gt;n;      for(int i=1;i&lt;=n;i++){          scanf("%lld",&amp;a[i]);      }      for(int i=n;i&gt;0;i--){          while(tt!=0&amp;&amp;a[i]&gt;=a[stk[tt]]) tt--;          ans[i]= tt==0?0:stk[tt];          stk[++tt]=i;      }      for(int i=1;i&lt;=n;i++)printf("%lld ",ans[i]);      return 0;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h2><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">// hh è¡¨ç¤ºé˜Ÿå¤´ï¼Œttè¡¨ç¤ºé˜Ÿå°¾  int q[N], hh = 0, tt = -1;    // å‘é˜Ÿå°¾æ’å…¥ä¸€ä¸ªæ•°  q[ ++ tt] = x;    // ä»é˜Ÿå¤´å¼¹å‡ºä¸€ä¸ªæ•°  hh ++ ;    // é˜Ÿå¤´çš„å€¼  q[hh];    // åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœ hh &lt;= ttï¼Œåˆ™è¡¨ç¤ºä¸ä¸ºç©º  if (hh &lt;= tt)  {    }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="å•è°ƒé˜Ÿåˆ—-ï¼ˆå¥½ä¸œè¥¿ï¼‰"><a href="#å•è°ƒé˜Ÿåˆ—-ï¼ˆå¥½ä¸œè¥¿ï¼‰" class="headerlink" title="å•è°ƒé˜Ÿåˆ— ï¼ˆå¥½ä¸œè¥¿ï¼‰"></a>å•è°ƒé˜Ÿåˆ— ï¼ˆå¥½ä¸œè¥¿ï¼‰</h1><p><strong>å‡ ä¸ªç‚¹ï¼š</strong></p><ul><li><p>åˆå§‹åŒ–æ—¶ï¼Œhh=0,tt=-1 ä½¿å¾—é˜Ÿåˆ—ä¸ºç©º</p></li><li><p>æ¯”è¾ƒçš„æ˜¯é˜Ÿå°¾å…ƒç´ ä¸å½“å‰å…ƒç´ </p></li><li><p>æ³¨æ„é˜Ÿåˆ—é•¿åº¦ä¸º0æ—¶ä¸è¦è¾“å‡º</p></li></ul><p>å¸¸è§æ¨¡å‹ï¼šæ‰¾å‡ºæ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼/æœ€å°å€¼  </p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">int hh = 0, tt = -1;  for (int i = 0; i &lt; n; i ++ )  {      while (hh &lt;= tt &amp;&amp; check_out(q[hh])) hh ++ ;  // åˆ¤æ–­é˜Ÿå¤´æ˜¯å¦æ»‘å‡ºçª—å£      while (hh &lt;= tt &amp;&amp; check(q[tt], i)) tt -- ;      q[ ++ tt] = i;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¾‹é¢˜</p><p><a href="https://www.luogu.com.cn/problem/P1886">P1886 æ»‘åŠ¨çª—å£ /ã€æ¨¡æ¿ã€‘å•è°ƒé˜Ÿåˆ— - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)</a></p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include&lt;iostream&gt;  #include &lt;cstdio&gt;  #define ll long long   using namespace std;  const int N=1000000+2;  int n,k,a[N],q[N],ans,hh,tt;    int main(){      cin&gt;&gt;n&gt;&gt;k;      for(int i=0;i&lt;n;i++){          scanf("%d",&amp;a[i]);      }      //é˜Ÿåˆ—å­˜çš„æ˜¯ä¸‹æ ‡      //æœ€å°å€¼      hh=0;tt=-1;//ç›®çš„æ˜¯è®©é˜Ÿåˆ—åˆå§‹åŒ–ä¸ºç©º      for(int i=0;i&lt;n;i++){          //åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º          if(hh&lt;=tt&amp;&amp;i-k+1&gt;q[hh]) hh++;          //ç›®çš„æ˜¯æŠŠæœ€å°çš„å…ƒç´ æ”¾åœ¨é˜Ÿå¤´          while(hh&lt;=tt&amp;&amp;a[q[tt]]&gt;=a[i]) tt--;//ä»é˜Ÿå°¾åˆ é™¤ï¼Œå› ä¸ºç»è¿‡æˆ‘ä»¬çš„å¤„ç†ï¼Œå·²ç»æ˜¯ä¸¥æ ¼å•è°ƒé€’å¢çš„äº†ï¼Œæ‰€ä»¥å¦‚æœç¬¬ä¸€ä¸ªéƒ½å¤§äºè¿™ä¸ªå…ƒç´ çš„è¯ï¼Œé‚£ä¹ˆåé¢å‡ ä¸ªéƒ½å¤§äºï¼Œæ‰€ä»¥è¦åˆ é™¤          q[++tt]=i;          if(i&gt;=k-1)          printf("%d ",a[q[hh]]);      }      cout&lt;&lt;endl;      //æœ€å¤§å€¼        hh=0;tt=-1;      for(int i=0;i&lt;n;i++){          //åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º          if(hh&lt;=tt&amp;&amp;i-k+1&gt;q[hh]) hh++;          //ç›®çš„æ˜¯æŠŠæœ€å¤§çš„å…ƒç´ æ”¾åœ¨é˜Ÿå¤´          while(hh&lt;=tt&amp;&amp;a[q[tt]]&lt;=a[i]) tt--;          q[++tt]=i;          if(i&gt;=k-1)          printf("%d ",a[q[hh]]);      }            return 0;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="KMP"><a href="#KMP" class="headerlink" title="KMP"></a>KMP</h2><p>å¯¹ç§°çš„ ,ä»¥jè¿™ä¸ªç‚¹ä¸ºä¸­ç‚¹çš„å‰åç¼€æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å˜æˆnext[ j ]<br><img src="file://D:/typora%E7%94%A8%E5%9B%BE/Screenshots/image-20230511171657614.png?lastModify=1694256669" alt="image-20230511171657614"></p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">sä»1å¼€å§‹ï¼Œpä»0å¼€å§‹// s[]æ˜¯é•¿æ–‡æœ¬ï¼Œp[]æ˜¯æ¨¡å¼ä¸²ï¼Œnæ˜¯sçš„é•¿åº¦ï¼Œmæ˜¯pçš„é•¿åº¦  æ±‚æ¨¡å¼ä¸²çš„Nextæ•°ç»„ï¼šne[1]=0  ,ä¸€å¼€å§‹å°±é”™äº†è‚¯å®šä»é›¶å¼€å§‹for (int i = 2, j = 0; i &lt;= m; i ++ )  {      while (j &amp;&amp; p[i] != p[j + 1]) j = ne[j];      if (p[i] == p[j + 1]) j ++ ;      ne[i] = j;  }    // åŒ¹é…  for (int i = 1, j = 0; i &lt;= n; i ++ )  {      while (j &amp;&amp; s[i] != p[j + 1]) j = ne[j];      if (s[i] == p[j + 1]) j ++ ;      if (j == m)      {          j = ne[j];          // åŒ¹é…æˆåŠŸåçš„é€»è¾‘      }  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ä¾‹é¢˜</strong></p><p><a href="https://www.luogu.com.cn/problem/P3375">P3375 ã€æ¨¡æ¿ã€‘KMPå­—ç¬¦ä¸²åŒ¹é… - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)</a></p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;  #include &lt;cstring&gt;  #define N 1000010  using namespace std;  char s[N],p[N];  int ls,lp,ne[N];  int main(){      cin&gt;&gt;s+1&gt;&gt;p+1;      ls=strlen(s+1);      lp=strlen(p+1);      for(int i=2,j=0;i&lt;=lp;i++){          while(j&amp;&amp;p[i]!=p[j+1]) j=ne[j];          if(p[j+1]==p[i]) j++;          ne[i]=j;      }       for(int i=1,j=0;i&lt;=ls;i++){          while(j&amp;&amp;s[i]!=p[j+1]) j=ne[j];          if(s[i]==p[j+1]) j++;          if(j==lp){              cout&lt;&lt;i-lp+1&lt;&lt;endl;              j=ne[j];          }      }      for(int i=1;i&lt;=lp;i++){          cout&lt;&lt;ne[i]&lt;&lt;" ";      }      return 0;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Trieæ ‘-é«˜æ•ˆå­˜å‚¨å’ŒæŸ¥æ‰¾å­—ç¬¦ä¸²"><a href="#Trieæ ‘-é«˜æ•ˆå­˜å‚¨å’ŒæŸ¥æ‰¾å­—ç¬¦ä¸²" class="headerlink" title="Trieæ ‘ é«˜æ•ˆå­˜å‚¨å’ŒæŸ¥æ‰¾å­—ç¬¦ä¸²"></a>Trieæ ‘ é«˜æ•ˆå­˜å‚¨å’ŒæŸ¥æ‰¾å­—ç¬¦ä¸²</h2><p>é›†åˆçš„æ•°æ®ç»“æ„</p><p>å°†å­—ç¬¦ä¸²åˆ†è§£ä¸ºä¸€ä¸ªä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦ç„¶åå­˜å‚¨ï¼Œç„¶åæŸ¥è¯¢è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯å¦å‡ºç°è¿‡ï¼Œ</p><p>å‡ºç°è¿‡å‡ æ¬¡</p><h4 id="æ›´å…¨é¢-çš„æ˜ å°„"><a href="#æ›´å…¨é¢-çš„æ˜ å°„" class="headerlink" title="æ›´å…¨é¢ çš„æ˜ å°„"></a>æ›´å…¨é¢ çš„æ˜ å°„</h4><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">int getnum(char x){      if(x&gt;='A'&amp;&amp;x&lt;='Z')          return x-'A';      else if(x&gt;='a'&amp;&amp;x&lt;='z')          return x -'a'+26;      else          return x-'0'+52;  } #include&lt;iostream&gt;  #include &lt;algorithm&gt;  #include &lt;cstdio&gt;  using namespace std;  const int N=100010;  int son[N][26],cnt[N],idx;//å­å­èŠ‚ç‚¹çš„ä¸ªæ•°ï¼ŒåªåŒ…å«26ä¸ª å°å†™å­—æ¯ cntæ˜¯ä»¥è¿™ä¸ªå­—æ¯ä¸ºç»“å°¾çš„å•è¯å‡ºç°äº†ç¦å“¦å°‘ä¸ª  //idx å½“å‰ç”¨åˆ°å“ªäº†  //æ’å…¥æ“ä½œ  char str[N];  void insert(char str[]){   &nbsp; &nbsp;int p=0;//å½“å‰çš„ç»“ç‚¹   &nbsp; &nbsp;for(int i=0;str[i];i++){   &nbsp; &nbsp; &nbsp; &nbsp;int u=str[i]-'a';//å°†26ä¸ªå°å†™å­—æ¯æ˜ å°„ä¸ºæ•°å­—   &nbsp; &nbsp; &nbsp; &nbsp;if(!son[p][u]) son[p][u]=++idx;   &nbsp; &nbsp; &nbsp; &nbsp;p=son[p][u];   &nbsp;  }   &nbsp; &nbsp;cnt[p]++;  }  int query(char str[]){   &nbsp; &nbsp;int p=0;   &nbsp; &nbsp;for(int i=0;str[i];i++){   &nbsp; &nbsp; &nbsp; &nbsp;int u=str[i]-'a';   &nbsp; &nbsp; &nbsp; &nbsp;if(!son[p][u]) return 0;   &nbsp; &nbsp; &nbsp; &nbsp;p=son[p][u];   &nbsp;  }   &nbsp; &nbsp;return cnt[p];  }  int main(){   &nbsp; &nbsp;int n;   &nbsp; &nbsp;cin&gt;&gt;n;   &nbsp; &nbsp;while(n--){   &nbsp; &nbsp; &nbsp; char op[2];   &nbsp; &nbsp; &nbsp; cin&gt;&gt;op&gt;&gt;str;   &nbsp; &nbsp; &nbsp; if(op[0]=='i') insert(str);   &nbsp; &nbsp; &nbsp; else cout&lt;&lt;query(str)&lt;&lt;endl;   &nbsp;  }   &nbsp; &nbsp;return 0;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.luogu.com.cn/problem/P8306">P8306 ã€æ¨¡æ¿ã€‘å­—å…¸æ ‘ - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)</a></p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include&lt;iostream&gt;  #include &lt;algorithm&gt;  #include &lt;cstdio&gt;  #include &lt;cstring&gt;  using namespace std;  const int N=3000005;  int son[N][65],cnt[N],idx;//å­å­èŠ‚ç‚¹çš„ä¸ªæ•°ï¼ŒåªåŒ…å«26ä¸ª å°å†™å­—æ¯ cntæ˜¯ä»¥è¿™ä¸ªå­—æ¯ä½å€Ÿä½çš„å•è¯å‡ºç°äº†ç¦å“¦å°‘ä¸ª  //idx å½“å‰ç”¨åˆ°å“ªäº†  //æ’å…¥æ“ä½œ   int n,m,t;  char str[N];  int hashs(char x){      if(x&gt;='A'&amp;&amp;x&lt;='Z')          return x-'A';      else if(x&gt;='a'&amp;&amp;x&lt;='z')          return x-'a'+26;      else          return x-'0'+52;  }  void insert(char str[]){      int p=0;//å½“å‰çš„ç»“ç‚¹      int l=strlen(str);      for(int i=0;i&lt;l;i++){          int u=hashs(str[i]);//å°†26ä¸ªå°å†™å­—æ¯æ˜ å°„ä¸ºæ•°å­—          if(!son[p][u]) son[p][u]=++idx;          p=son[p][u];          cnt[p]++;      }        }  int query(char str[]){      int p=0;//å½“å‰çš„ç»“ç‚¹      int l=strlen(str);      for(int i=0;i&lt;l;i++){          int u =hashs(str[i]);          if(!son[p][u]) return 0;          p=son[p][u];      }      return cnt[p];  }  int main(){           cin&gt;&gt;t;      while(t--){            for(int i=0;i&lt;=idx;i++){              for(int j=0;j&lt;=122;j++){                  son[i][j]=0;              }            }            for(int i=0;i&lt;=idx;i++)              cnt[i]=0;          idx=0;         scanf("%d%d",&amp;n,&amp;m);          while(n--){              scanf("%s",str);              insert(str);          }          while(m--){               scanf("%s",str);              printf("%d\n",query(str));          }      }      return 0;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¹¶æŸ¥é›†"><a href="#å¹¶æŸ¥é›†" class="headerlink" title="å¹¶æŸ¥é›†"></a>å¹¶æŸ¥é›†</h2><p>ç”¨æ³•ï¼š</p><h3 id="æŸäº›ç‚¹æˆ–è€…æ•°æ®æ˜¯å¦å¤„äºä¸€ä¸ªè¿é€šå—ä¸­"><a href="#æŸäº›ç‚¹æˆ–è€…æ•°æ®æ˜¯å¦å¤„äºä¸€ä¸ªè¿é€šå—ä¸­" class="headerlink" title="æŸäº›ç‚¹æˆ–è€…æ•°æ®æ˜¯å¦å¤„äºä¸€ä¸ªè¿é€šå—ä¸­"></a>æŸäº›ç‚¹æˆ–è€…æ•°æ®æ˜¯å¦å¤„äºä¸€ä¸ªè¿é€šå—ä¸­</h3><ol><li><p>å°†ä¸¤ä¸ªé›†åˆåˆå¹¶</p></li><li><p>è¯¢é—®ä¸¤ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­</p></li></ol><p>åŸºæœ¬åŸç†ï¼šæ¯ä¸ªé›†åˆç”¨ä¸€ä¸ªæ ‘æ¥è¡¨ç¤ºï¼Œæ ‘æ ¹çš„ç¼–å·å°±æ˜¯æ•´ä¸ªé›†åˆçš„ç¼–å·ï¼Œ</p><p>æ¯ä¸€ä¸ªç»“ç‚¹è¡¨ç¤ºä»–çš„çˆ¶èŠ‚ç‚¹p[x] è¡¨ç¤ºxçš„çˆ¶èŠ‚ç‚¹</p><ul><li><p>åˆ¤æ–­æ ‘æ ¹: ifï¼ˆp[x]==xï¼‰</p></li><li><p>å¦‚ä½•é›†åˆçš„ç¼–å·ï¼š while(p[x]!=x) x=p[x];</p></li><li><p>å¦‚ä½•åˆå¹¶ä¸¤ä¸ªé›†åˆç›´æ¥è®©å…¶ä¸­ä¸€ä¸ªçš„æ ¹èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸ºå¦ä¸€ä¸ªé›†åˆçš„æ ¹èŠ‚ç‚¹å°±è¡Œ</p></li><li><p>å¦‚ä½•ä¼˜åŒ–ï¼ŒæŸ¥è¯¢ä¸€æ¬¡åï¼Œå°†å°†æ‰€ç»è¿‡çš„è·¯å¾„çš„çˆ¶èŠ‚ç‚¹å…¨éƒ½ä¿®æ”¹ä¸ºæ ¹èŠ‚ç‚¹</p></li></ul><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include&lt;iostream&gt;  #include &lt;algorithm&gt;  #include &lt;cstdio&gt;  #include &lt;cstring&gt;  using namespace std;  const int N=10010;  int p[N];  //åˆå§‹æ¯ä¸ªç‚¹éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„é›†åˆ  void init(int n){      for(int i=1;i&lt;=n;i++){          p[i]=i;      }  }  int find(int x){      if(p[x]!=x) p[x]=find(p[x]);      return p[x];  }    int main(){      int n,m;      cin&gt;&gt;n&gt;&gt;m;      init(n);      char op[2];      while(m--){          int a,b;          cin&gt;&gt;op&gt;&gt;a&gt;&gt;b;          //åˆå¹¶ä¸¤ä¸ªé›†åˆ,è·¯å¾„å‹ç¼©          if(op[0]=='i') p[find(a)]=find(b);//è®©açš„çˆ¶èŠ‚ç‚¹ç­‰äºbçš„çˆ¶èŠ‚ç‚¹ï¼Œå³å¯åˆå¹¶          else {              //æŸ¥è¯¢              if(find(a)==find(b)) cout&lt;&lt;"yes"&lt;&lt;endl;              else cout&lt;&lt;"no"&lt;&lt;endl;          }      }      return 0;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.luogu.com.cn/problem/P3367">P3367 ã€æ¨¡æ¿ã€‘å¹¶æŸ¥é›† - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)</a></p><p>ç»´æŠ¤ç‚¹çš„æ•°é‡ï¼š</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include&lt;iostream&gt;  #include &lt;algorithm&gt;  #include &lt;cstdio&gt;  #include &lt;cstring&gt;  using namespace std;  const int N=10010;  int p[N],sizes[N];//æ¯ä¸ªé›†åˆä¸­ç‚¹çš„æ•°é‡  //åˆå§‹æ¯ä¸ªç‚¹éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„é›†åˆ  void init(int n){      for(int i=1;i&lt;=n;i++){          p[i]=i;          sizes[i]=1;      }  }  int find(int x){      if(p[x]!=x) p[x]=find(p[x]);      return p[x];  }    int main(){      int n,m;      cin&gt;&gt;n&gt;&gt;m;      init(n);      int op;      while(m--){          int a,b;          cin&gt;&gt;op;          //åˆå¹¶ä¸¤ä¸ªé›†åˆ,è·¯å¾„å‹ç¼©          if(op==1){              cin&gt;&gt;a&gt;&gt;b;              if(find(a)==find(b)) continue;              sizes[find(b)]+=sizes[find(a)];              p[find(a)]=find(b);//è®©açš„çˆ¶èŠ‚ç‚¹ç­‰äºbçš„çˆ¶èŠ‚ç‚¹ï¼Œå³å¯åˆå¹¶                }          else if(op==2){              //æŸ¥è¯¢              cin&gt;&gt;a&gt;&gt;b;              if(find(a)==find(b)) cout&lt;&lt;"Y"&lt;&lt;endl;              else cout&lt;&lt;"N"&lt;&lt;endl;          }          else {              //è¯¢é—®æŸä¸ªé›†åˆä¸­ç‚¹çš„æ•°é‡              cin&gt;&gt;n;              cout&lt;&lt;sizes[find(a)]&lt;&lt;endl;          }      }      return 0;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å †-åªèƒ½ä¿è¯å †é¡¶æ˜¯æœ€å€¼ï¼Œä¿è¯ä¸äº†å·¦å³ä¸¤è¾¹çš„å¤§å°å…³ç³»"><a href="#å †-åªèƒ½ä¿è¯å †é¡¶æ˜¯æœ€å€¼ï¼Œä¿è¯ä¸äº†å·¦å³ä¸¤è¾¹çš„å¤§å°å…³ç³»" class="headerlink" title="å † åªèƒ½ä¿è¯å †é¡¶æ˜¯æœ€å€¼ï¼Œä¿è¯ä¸äº†å·¦å³ä¸¤è¾¹çš„å¤§å°å…³ç³»"></a>å † åªèƒ½ä¿è¯å †é¡¶æ˜¯æœ€å€¼ï¼Œä¿è¯ä¸äº†å·¦å³ä¸¤è¾¹çš„å¤§å°å…³ç³»</h2><p>æ“ä½œï¼šdown å’Œup æŠŠå…ƒç´ å‘ä¸‹æˆ–å‘ä¸Šèµ°ï¼Œä½¿ç”¨çš„æ˜¯ä¸€ç»´æ•°ç»„ï¼Œxçš„å·¦å„¿å­2x,å³å„¿å­2x+1</p><p>size è¡¨ç¤ºæ•°ç»„çš„æœ€åä¸€ä¸ªä½ç½®</p><ol><li><p>æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼š heap[++size]=x up(size)</p></li><li><p>æ±‚æœ€å°å€¼ heap[1]</p></li><li><p>åˆ é™¤æœ€å°å€¼ æ•°ç»„å°¾éƒ¨å¥½åˆ é™¤ï¼Œæ‰€ä»¥ç”¨æœ€åä¸€ä¸ªå…ƒç´ è¦†ç›–æ•°ç»„çš„å¤´ï¼Œç„¶åæ‰§è¡Œdownï¼Œ</p><p> å†åˆ é™¤å°¾éƒ¨ï¼Œhead[k]=heap[size];sizeâ€“; down(k)||up(k)</p></li><li><p>ä¿®æ”¹ heap[k]=k; down(k)||up(k);</p></li></ol><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">// h[N]å­˜å‚¨å †ä¸­çš„å€¼, h[1]æ˜¯å †é¡¶ï¼Œxçš„å·¦å„¿å­æ˜¯2x, å³å„¿å­æ˜¯2x + 1  // ph[k]å­˜å‚¨ç¬¬kä¸ªæ’å…¥çš„ç‚¹åœ¨å †ä¸­çš„ä½ç½®  // hp[k]å­˜å‚¨å †ä¸­ä¸‹æ ‡æ˜¯kçš„ç‚¹æ˜¯ç¬¬å‡ ä¸ªæ’å…¥çš„  int h[N], ph[N], hp[N], size;    // äº¤æ¢ä¸¤ä¸ªç‚¹ï¼ŒåŠå…¶æ˜ å°„å…³ç³»  void heap_swap(int a, int b)  {      swap(ph[hp[a]],ph[hp[b]]);      swap(hp[a], hp[b]);      swap(h[a], h[b]);  }    void down(int u)  {      int t = u;      //æŸ¥æ‰¾åˆ°ä¸‰ä¸ªç»“ç‚¹ä¸­çš„æœ€å°å€¼      if (u * 2 &lt;= size &amp;&amp; h[u * 2] &lt; h[t]) t = u * 2;      if (u * 2 + 1 &lt;= size &amp;&amp; h[u * 2 + 1] &lt; h[t]) t = u * 2 + 1;      if (u != t)      {          heap_swap(u, t);          down(t);      }  }    void up(int u)  {      while (u / 2 &amp;&amp; h[u] &lt; h[u / 2])//çˆ¶èŠ‚ç‚¹å­˜åœ¨ä¸”å½“å‰ç»“ç‚¹å°äºçˆ¶èŠ‚ç‚¹       {          heap_swap(u, u / 2);          u &gt;&gt;= 1;//ä¸‹ä¸€ä¸ªçˆ¶èŠ‚ç‚¹      }  }    // O(n)å»ºå †  for (int i = n / 2; i; i -- ) down(i);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.luogu.com.cn/problem/P3378">P3378 ã€æ¨¡æ¿ã€‘å † - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)</a></p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;bits/stdc++.h&gt;  using namespace std;  const int N=1000001;  int h[N],s;  void down(int u){      int t=u;      if(u*2&lt;=s&amp;&amp;h[u*2]&lt;h[t]) t=u*2;      if(u*2+1&lt;=s&amp;&amp;h[u*2+1]&lt;h[t]) t=u*2+1;      if(u!=t){          swap(h[u],h[t]);          down(t);      }  }  void up(int u){      while(u/2&amp;&amp;h[u]&lt;h[u/2]){          swap(h[u],h[u/2]);          u&gt;&gt;=1;      }  }  int main(){      int n,op;      cin&gt;&gt;n;      for(int i=n/2;i;i--){          down(i);      }      while(n--){          scanf("%d",&amp;op);          if(op==1) {              int x;              scanf("%d",&amp;x);              h[++s]=x;              up(s);          }          else if(op==2){              printf("%d\n",h[1]);          }          else {              //æœ€åä¸€ä¸ªæ¢åˆ°ç¬¬ä¸€ä¸ª              swap(h[1],h[s]);              s--;//åˆ é™¤æœ€åä¸€ä¸ª              down(1);          }      }    }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="HashTable"><a href="#HashTable" class="headerlink" title="HashTable"></a>HashTable</h2><p>åˆ é™¤çš„è¯æ‰“ä¸ªæ ‡è®°<br>(1) æ‹‰é“¾æ³• </p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">int h[N], e[N], ne[N], idx;    // å‘å“ˆå¸Œè¡¨ä¸­æ’å…¥ä¸€ä¸ªæ•°  void insert(int x)  {      int k = (x % N + N) % N;      e[idx] = x;      ne[idx] = h[k];      h[k] = idx ++ ;  }    // åœ¨å“ˆå¸Œè¡¨ä¸­æŸ¥è¯¢æŸä¸ªæ•°æ˜¯å¦å­˜åœ¨  bool find(int x)  {      int k = (x % N + N) % N;      for (int i = h[k]; i != -1; i = ne[i])          if (e[i] == x)              return true;        return false;  }  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¼€æ”¾å¯»å€æ³•ï¼Œé‡åˆ°å†²çªçš„è¯ç›´æ¥å¾€åæ‰¾æ²¡ç”¨çš„èŠ‚ç‚¹</p><p>æ•°ç»„è¦å¼€æ¯”åŸæ¥æ•°æ®èŒƒå›´å¤§2~3å€</p><p>//åªè¦å¼€ä¸€ä¸ªhæ•°ç»„å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦eå’Œneäº†ï¼Œæ‰¾ä¸€ä¸ªä¸åœ¨æ•°æ®èŒƒå›´å†…çš„æ•°æ®æ¥è¡¨ç¤ºå½“å‰ä½ç½®ä¸ºç©º<br>(2) å¼€æ”¾å¯»å€æ³•  </p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">   int h[N];  const int null =xxx;     // å¦‚æœxåœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œè¿”å›xçš„ä¸‹æ ‡ï¼›å¦‚æœxä¸åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œè¿”å›xåº”è¯¥æ’å…¥çš„ä½ç½®     int find(int x)     {         int t = (x % N + N) % N;         while (h[t] != null &amp;&amp; h[t] != x)         {             t ++ ;             if (t == N) t = 0;         }         return t;     }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å­—ç¬¦ä¸²å“ˆå¸Œ"><a href="#å­—ç¬¦ä¸²å“ˆå¸Œ" class="headerlink" title="å­—ç¬¦ä¸²å“ˆå¸Œ"></a>å­—ç¬¦ä¸²å“ˆå¸Œ</h3><p>å¿«é€Ÿåˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰</p><p>æ ¸å¿ƒæ€æƒ³ï¼šå°†å­—ç¬¦ä¸²çœ‹æˆPè¿›åˆ¶æ•°ï¼ŒPçš„ç»éªŒå€¼æ˜¯131æˆ–13331ï¼Œå–è¿™ä¸¤ä¸ªå€¼çš„å†²çªæ¦‚ç‡ä½<br>å°æŠ€å·§ï¼šå–æ¨¡çš„æ•°ç”¨2^64ï¼Œè¿™æ ·ç›´æ¥ç”¨unsigned long longå­˜å‚¨ï¼Œæº¢å‡ºçš„ç»“æœå°±æ˜¯å–æ¨¡çš„ç»“æœ  </p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">typedef unsigned long long ULL;  ULL h[N], p[N]; // h[k]å­˜å‚¨å­—ç¬¦ä¸²å‰kä¸ªå­—æ¯çš„å“ˆå¸Œå€¼, p[k]å­˜å‚¨ P^k mod 2^64    // åˆå§‹åŒ–  p[0] = 1;  for (int i = 1; i &lt;= n; i ++ )  {      h[i] = h[i - 1] * P + str[i];      p[i] = p[i - 1] * P;//På­˜å‚¨çš„æ˜¯æ¯ä¸€ä½çš„åŸºæ•°å€¼  }    // è®¡ç®—å­ä¸² str[l ~ r] çš„å“ˆå¸Œå€¼  ULL get(int l, int r)  {      return h[r] - h[l - 1] * p[r - l + 1];  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="STLå¸¸ç”¨"><a href="#STLå¸¸ç”¨" class="headerlink" title="STLå¸¸ç”¨"></a>STLå¸¸ç”¨</h2><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">vector, å˜é•¿æ•°ç»„ï¼Œå€å¢çš„æ€æƒ³ &nbsp;ä¼˜åŒ–æ€è·¯ï¼šå‡å°‘ç”³è¯·ç©ºé—´çš„æ¬¡æ•°   &nbsp; &nbsp;size() &nbsp;è¿”å›å…ƒç´ ä¸ªæ•°   &nbsp; &nbsp;empty() &nbsp;è¿”å›æ˜¯å¦ä¸ºç©º   &nbsp; &nbsp;clear() &nbsp;æ¸…ç©º   &nbsp; &nbsp;front()/back()   &nbsp; &nbsp;push_back()/pop_back()   &nbsp; &nbsp;begin()/end()   &nbsp;  []   &nbsp; &nbsp;æ”¯æŒæ¯”è¾ƒè¿ç®—ï¼ŒæŒ‰å­—å…¸åº   &nbsp; &nbsp;vector&lt;int&gt; a(1,2),b(3,4);  printf(a&lt;b) == 0  â€‹  pair&lt;int, int&gt;   &nbsp; &nbsp;first, ç¬¬ä¸€ä¸ªå…ƒç´    &nbsp; &nbsp;second, ç¬¬äºŒä¸ªå…ƒç´    &nbsp; &nbsp;æ”¯æŒæ¯”è¾ƒè¿ç®—ï¼Œä»¥firstä¸ºç¬¬ä¸€å…³é”®å­—ï¼Œä»¥secondä¸ºç¬¬äºŒå…³é”®å­—ï¼ˆå­—å…¸åºï¼‰  â€‹  stringï¼Œå­—ç¬¦ä¸²   &nbsp; &nbsp;size()/length() &nbsp;è¿”å›å­—ç¬¦ä¸²é•¿åº¦   &nbsp; &nbsp;empty()   &nbsp; &nbsp;clear()   &nbsp; &nbsp;substr(èµ·å§‹ä¸‹æ ‡ï¼Œ(å­ä¸²é•¿åº¦)) &nbsp;è¿”å›å­ä¸²   &nbsp; &nbsp;c_str() &nbsp;è¿”å›å­—ç¬¦ä¸²æ‰€åœ¨å­—ç¬¦æ•°ç»„çš„èµ·å§‹åœ°å€  â€‹  queue, é˜Ÿåˆ—   &nbsp; &nbsp;size()   &nbsp; &nbsp;empty()   &nbsp; &nbsp;push() &nbsp;å‘é˜Ÿå°¾æ’å…¥ä¸€ä¸ªå…ƒç´    &nbsp; &nbsp;front() &nbsp;è¿”å›é˜Ÿå¤´å…ƒç´    &nbsp; &nbsp;back() &nbsp;è¿”å›é˜Ÿå°¾å…ƒç´    &nbsp; &nbsp;pop() &nbsp;å¼¹å‡ºé˜Ÿå¤´å…ƒç´   â€‹  priority_queue, ä¼˜å…ˆé˜Ÿåˆ—ï¼Œé»˜è®¤æ˜¯å¤§æ ¹å †   &nbsp; &nbsp;size()   &nbsp; &nbsp;empty()   &nbsp; &nbsp;push() &nbsp;æ’å…¥ä¸€ä¸ªå…ƒç´    &nbsp; &nbsp;top() &nbsp;è¿”å›å †é¡¶å…ƒç´    &nbsp; &nbsp;pop() &nbsp;å¼¹å‡ºå †é¡¶å…ƒç´    &nbsp; &nbsp;å®šä¹‰æˆå°æ ¹å †çš„æ–¹å¼ï¼špriority_queue&lt;int, vector&lt;int&gt;, greater&lt;int&gt;&gt; q;  â€‹  stack, æ ˆ   &nbsp; &nbsp;size()   &nbsp; &nbsp;empty()   &nbsp; &nbsp;push() &nbsp;å‘æ ˆé¡¶æ’å…¥ä¸€ä¸ªå…ƒç´    &nbsp; &nbsp;top() &nbsp;è¿”å›æ ˆé¡¶å…ƒç´    &nbsp; &nbsp;pop() &nbsp;å¼¹å‡ºæ ˆé¡¶å…ƒç´   â€‹  deque, åŒç«¯é˜Ÿåˆ—   &nbsp; &nbsp;size()   &nbsp; &nbsp;empty()   &nbsp; &nbsp;clear()   &nbsp; &nbsp;front()/back()   &nbsp; &nbsp;push_back()/pop_back()   &nbsp; &nbsp;push_front()/pop_front()   &nbsp; &nbsp;begin()/end()   &nbsp;  []  â€‹  set, map, multiset, multimap, åŸºäºå¹³è¡¡äºŒå‰æ ‘ï¼ˆçº¢é»‘æ ‘ï¼‰ï¼ŒåŠ¨æ€ç»´æŠ¤æœ‰åºåºåˆ—   &nbsp; &nbsp;size()   &nbsp; &nbsp;empty()   &nbsp; &nbsp;clear()   &nbsp; &nbsp;begin()/end()   &nbsp; &nbsp;++, -- è¿”å›å‰é©±å’Œåç»§ï¼Œæ—¶é—´å¤æ‚åº¦ O(logn)  â€‹   &nbsp; &nbsp;set/multiset   &nbsp; &nbsp; &nbsp; &nbsp;insert() &nbsp;æ’å…¥ä¸€ä¸ªæ•°   &nbsp; &nbsp; &nbsp; &nbsp;find() &nbsp;æŸ¥æ‰¾ä¸€ä¸ªæ•°   &nbsp; &nbsp; &nbsp; &nbsp;count() &nbsp;è¿”å›æŸä¸€ä¸ªæ•°çš„ä¸ªæ•°   &nbsp; &nbsp; &nbsp; &nbsp;erase()   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (1) è¾“å…¥æ˜¯ä¸€ä¸ªæ•°xï¼Œåˆ é™¤æ‰€æœ‰x &nbsp; O(k + logn)   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (2) è¾“å…¥ä¸€ä¸ªè¿­ä»£å™¨ï¼Œåˆ é™¤è¿™ä¸ªè¿­ä»£å™¨   &nbsp; &nbsp; &nbsp; &nbsp;lower_bound()/upper_bound()   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lower_bound(x) &nbsp;è¿”å›å¤§äºç­‰äºxçš„æœ€å°çš„æ•°çš„è¿­ä»£å™¨   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;upper_bound(x) &nbsp;è¿”å›å¤§äºxçš„æœ€å°çš„æ•°çš„è¿­ä»£å™¨   &nbsp; &nbsp;map/multimap   &nbsp; &nbsp; &nbsp; &nbsp;insert() &nbsp;æ’å…¥çš„æ•°æ˜¯ä¸€ä¸ªpair   &nbsp; &nbsp; &nbsp; &nbsp;erase() &nbsp;è¾“å…¥çš„å‚æ•°æ˜¯pairæˆ–è€…è¿­ä»£å™¨   &nbsp; &nbsp; &nbsp; &nbsp;find()   &nbsp; &nbsp; &nbsp;  [] &nbsp;æ³¨æ„multimapä¸æ”¯æŒæ­¤æ“ä½œã€‚ æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)   &nbsp; &nbsp; &nbsp; &nbsp;lower_bound()/upper_bound()  â€‹  unordered_set, unordered_map, unordered_multiset, unordered_multimap, å“ˆå¸Œè¡¨   &nbsp; &nbsp;å’Œä¸Šé¢ç±»ä¼¼ï¼Œå¢åˆ æ”¹æŸ¥çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)   &nbsp; &nbsp;ä¸æ”¯æŒ lower_bound()/upper_bound()ï¼Œ è¿­ä»£å™¨çš„++ï¼Œ--  â€‹  bitset, åœ§ä½ çœç©ºé—´ &nbsp; &nbsp;   &nbsp; &nbsp;bitset&lt;10000&gt; s; &nbsp;//&lt; &gt;é‡Œé¢æ˜¯ä¸ªæ•°, å¯ä»¥ç”¨æ¥æ›¿ä»£bool æ•°ç»„      //ä»¥ä¸‹æ“ä½œéƒ½æ”¯æŒ      ~, &amp;, |, ^   &nbsp; &nbsp;&gt;&gt;, &lt;&lt;   &nbsp; &nbsp;==, !=   &nbsp;  []  â€‹   &nbsp; &nbsp;count() &nbsp;è¿”å›æœ‰å¤šå°‘ä¸ª1  â€‹   &nbsp; &nbsp;any() &nbsp;åˆ¤æ–­æ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ª1   &nbsp; &nbsp;none() &nbsp;åˆ¤æ–­æ˜¯å¦å…¨ä¸º0  â€‹   &nbsp; &nbsp;set() &nbsp;æŠŠæ‰€æœ‰ä½ç½®æˆ1   &nbsp; &nbsp;set(k, v) &nbsp;å°†ç¬¬kä½å˜æˆv   &nbsp; &nbsp;reset() &nbsp;æŠŠæ‰€æœ‰ä½å˜æˆ0   &nbsp; &nbsp;flip() &nbsp;ç­‰ä»·äº~   &nbsp; &nbsp;flip(k) æŠŠç¬¬kä½å–å  â€‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å›¾è®ºèƒŒæ€è·¯"><a href="#å›¾è®ºèƒŒæ€è·¯" class="headerlink" title="å›¾è®ºèƒŒæ€è·¯"></a>å›¾è®ºèƒŒæ€è·¯</h2><h2 id="BFSå’ŒDFS"><a href="#BFSå’ŒDFS" class="headerlink" title="BFSå’ŒDFS"></a>BFSå’ŒDFS</h2><h3 id="éå¸¸å®Œç¾çš„ä¸€é“dfs-å¹¶æŸ¥é›†-https-www-luogu-com-cn-problem-P1127"><a href="#éå¸¸å®Œç¾çš„ä¸€é“dfs-å¹¶æŸ¥é›†-https-www-luogu-com-cn-problem-P1127" class="headerlink" title="éå¸¸å®Œç¾çš„ä¸€é“dfs + å¹¶æŸ¥é›† https://www.luogu.com.cn/problem/P1127"></a>éå¸¸å®Œç¾çš„ä¸€é“dfs + å¹¶æŸ¥é›† <a href="https://www.luogu.com.cn/problem/P1127">https://www.luogu.com.cn/problem/P1127</a></h3><p><u>è¿˜åŸç°åœºå¾ˆé‡è¦</u> </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> start<span class="token punctuation">,</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">==</span> n<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//å¼€å§‹æœç´¢</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//æ‰¾startè¿™ä¸ªå¼€å¤´çš„string</span><span class="token keyword">if</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token char">'a'</span> <span class="token operator">==</span> start <span class="token operator">&amp;&amp;</span> st<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//æ ‡è®°</span>st<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>ans<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">dfs</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token char">'a'</span><span class="token punctuation">,</span>num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//è¿˜åŸç°åœº</span>st<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>ans<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>ans<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="DFS-å›æº¯çš„æ—¶å€™è®°å¾—å›å¤ç°åœº"><a href="#DFS-å›æº¯çš„æ—¶å€™è®°å¾—å›å¤ç°åœº" class="headerlink" title="DFS å›æº¯çš„æ—¶å€™è®°å¾—å›å¤ç°åœº"></a>DFS å›æº¯çš„æ—¶å€™è®°å¾—å›å¤ç°åœº</h3><h3 id="é‚»æ¥çŸ©é˜µï¼š-p-a-b-a-gt-b-é€‚åˆç¨ å¯†å›¾"><a href="#é‚»æ¥çŸ©é˜µï¼š-p-a-b-a-gt-b-é€‚åˆç¨ å¯†å›¾" class="headerlink" title="é‚»æ¥çŸ©é˜µï¼š p[ a] [ b ] a -> b é€‚åˆç¨ å¯†å›¾"></a>é‚»æ¥çŸ©é˜µï¼š p[ a] [ b ] a -&gt; b é€‚åˆç¨ å¯†å›¾</h3><h3 id="é‚»æ¥è¡¨ï¼š-ç¨€ç–å›¾"><a href="#é‚»æ¥è¡¨ï¼š-ç¨€ç–å›¾" class="headerlink" title="é‚»æ¥è¡¨ï¼š ç¨€ç–å›¾"></a>é‚»æ¥è¡¨ï¼š ç¨€ç–å›¾</h3><p>å’Œå“ˆå¸Œè¡¨æ€è·¯ä¸€æ ·</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">// å¯¹äºæ¯ä¸ªç‚¹kï¼Œå¼€ä¸€ä¸ªå•é“¾è¡¨ï¼Œå­˜å‚¨kæ‰€æœ‰å¯ä»¥èµ°åˆ°çš„ç‚¹ã€‚h[k]å­˜å‚¨è¿™ä¸ªå•é“¾è¡¨çš„å¤´ç»“ç‚¹  int h[N], e[N], ne[N], idx; //eæ˜¯ç»ˆç‚¹end    // æ·»åŠ ä¸€æ¡è¾¹a-&gt;b  void add(int a, int b)  {      e[idx] = b, ne[idx] = h[a], h[a] = idx ++ ;  }   // åˆå§‹åŒ–  idx = 0;  memset(h, -1, sizeof h);  //éå†å›¾  for(int i = h[t] ; i != -1 ; i = ne[i] )## å¦ä¸€ç§ä½¿ç”¨ç»“æ„ä½“çš„é‚»æ¥è¡¨å­˜æ³•int idx=0,n;  int h[N] , dis[N] , vis[N];  struct Edge{      int ne,to,dis;  }ed[N];  //æ·»åŠ ï¼Œ ä» 1 å¼€å§‹  void add(int a,int b ,int c){      ed[++idx].ne = h[a];      ed[idx].to = b;      ed[idx].dis = c;      h[a] = idx;  }//éå†å›¾  for(int i = h[t] ; i ; i = ed[i].ne)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="BFS-å¯ç”¨äºè§£å†³æƒå€¼ç›¸ç­‰çš„æœ€çŸ­è·¯å¾„é—®é¢˜"><a href="#BFS-å¯ç”¨äºè§£å†³æƒå€¼ç›¸ç­‰çš„æœ€çŸ­è·¯å¾„é—®é¢˜" class="headerlink" title="BFS å¯ç”¨äºè§£å†³æƒå€¼ç›¸ç­‰çš„æœ€çŸ­è·¯å¾„é—®é¢˜"></a>BFS å¯ç”¨äºè§£å†³æƒå€¼ç›¸ç­‰çš„æœ€çŸ­è·¯å¾„é—®é¢˜</h3><h2 id="æ‹“æ‰‘æ’åº"><a href="#æ‹“æ‰‘æ’åº" class="headerlink" title="æ‹“æ‰‘æ’åº"></a>æ‹“æ‰‘æ’åº</h2><p>å¿…é¡»æ˜¯åˆå‘æ— ç¯</p><p>æ’å®Œåï¼Œæ‰€æœ‰çš„èµ·ç‚¹éƒ½åœ¨ç»ˆç‚¹ä¹‹å‰</p><ol><li><p>ç»Ÿè®¡æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„å…¥åº¦å’Œå‡ºåº¦</p></li><li><p>æ¯ä¸€æ¬¡å°†å…¥è¯»ç›¸åŒçš„ç‚¹æ”¾å…¥queue</p></li><li><p>æšä¸¾é˜Ÿå¤´çš„å‡ºè¾¹ï¼Œåˆ æ‰ å‡ºè¾¹,è¿™æ¡è¾¹çš„ç»ˆç‚¹çš„å…¥åº¦-1</p></li><li><p>å¦‚æœæŸä¸ªç‚¹çš„å…¥åº¦ä¸º0 æ”¾å…¥é˜Ÿåˆ—</p></li></ol><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">bool topsort()  {      int hh = 0, tt = -1;        // d[i] å­˜å‚¨ç‚¹içš„å…¥åº¦      for (int i = 1; i &lt;= n; i ++ )          if (!d[i])              q[ ++ tt] = i;//æŠŠæ¯ä¸ªå…¥åº¦ä¸º0çš„ç‚¹åŠ å…¥é˜Ÿåˆ—        while (hh &lt;= tt)      {          int t = q[hh ++ ];//å–å‡ºé˜Ÿå¤´  //ä»é˜Ÿå¤´å¼€å§‹æ‰¾è·¯å¾„          for (int i = h[t]; i != -1; i = ne[i])          {              int j = e[i];              if (-- d[j] == 0)                  q[ ++ tt] = j;          }      }        // å¦‚æœæ‰€æœ‰ç‚¹éƒ½å…¥é˜Ÿäº†ï¼Œè¯´æ˜å­˜åœ¨æ‹“æ‰‘åºåˆ—ï¼›å¦åˆ™ä¸å­˜åœ¨æ‹“æ‰‘åºåˆ—ã€‚      return tt == n - 1;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æœ€çŸ­è·¯é—®é¢˜ï¼š"><a href="#æœ€çŸ­è·¯é—®é¢˜ï¼š" class="headerlink" title="æœ€çŸ­è·¯é—®é¢˜ï¼š"></a>æœ€çŸ­è·¯é—®é¢˜ï¼š</h2><h2 id="åˆ†å±‚æœ€çŸ­è·¯-ï¼Œé€‚ç”¨äºä¹˜è½¦è·¯çº¿å’Œå…è´¹æ¬¡æ•°ã€‚"><a href="#åˆ†å±‚æœ€çŸ­è·¯-ï¼Œé€‚ç”¨äºä¹˜è½¦è·¯çº¿å’Œå…è´¹æ¬¡æ•°ã€‚" class="headerlink" title="_åˆ†å±‚æœ€çŸ­è·¯_ï¼Œé€‚ç”¨äºä¹˜è½¦è·¯çº¿å’Œå…è´¹æ¬¡æ•°ã€‚"></a>_åˆ†å±‚æœ€çŸ­è·¯_ï¼Œé€‚ç”¨äºä¹˜è½¦è·¯çº¿å’Œå…è´¹æ¬¡æ•°ã€‚</h2><p><a href="https://www.luogu.com.cn/problem/P4568#submit">é£æœºè·¯çº¿</a></p><h3 id="å•æºæœ€çŸ­è·¯-ä¸€ä¸ªç‚¹-x2F-åˆ°å…¶ä»–æ‰€æœ‰ç‚¹çš„æœ€çŸ­è·¯"><a href="#å•æºæœ€çŸ­è·¯-ä¸€ä¸ªç‚¹-x2F-åˆ°å…¶ä»–æ‰€æœ‰ç‚¹çš„æœ€çŸ­è·¯" class="headerlink" title="å•æºæœ€çŸ­è·¯ ä¸€ä¸ªç‚¹./.åˆ°å…¶ä»–æ‰€æœ‰ç‚¹çš„æœ€çŸ­è·¯"></a>å•æºæœ€çŸ­è·¯ ä¸€ä¸ªç‚¹./.åˆ°å…¶ä»–æ‰€æœ‰ç‚¹çš„æœ€çŸ­è·¯</h3><ul><li><p>æ‰€æœ‰è¾¹çš„æƒéƒ½æ˜¯æ­£æ•°</p><ol><li>æœ´ç´ Dijkstra O(n^2) nä¸ºç‚¹çš„æ•°é‡ ç¨ å¯†å›¾ è¾¹å¾ˆå¤š å¤–éƒ¨è¿­ä»£n-1 æ¬¡ <pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">int g[N][N];  // å­˜å‚¨æ¯æ¡è¾¹  æƒå€¼  int dist[N];  // å­˜å‚¨1å·ç‚¹åˆ°æ¯ä¸ªç‚¹çš„æœ€çŸ­è·ç¦»  bool st[N];   // å­˜å‚¨æ¯ä¸ªç‚¹çš„æœ€çŸ­è·¯æ˜¯å¦å·²ç»ç¡®å®š    // æ±‚1å·ç‚¹åˆ°nå·ç‚¹çš„æœ€çŸ­è·¯ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›-1  int dijkstra()  {      memset(dist, 0x3f, sizeof dist);      dist[1] = 0;        for (int i = 0; i &lt; n - 1; i ++ )//è¿­ä»£n-1 æ¬¡ï¼Œå› ä¸ºä¸Šæ¥é€‰ä¸­äº†ä¸€ä¸ªç‚¹      {          int t = -1;     // åœ¨è¿˜æœªç¡®å®šæœ€çŸ­è·¯çš„ç‚¹ä¸­ï¼Œå¯»æ‰¾è·ç¦»æœ€å°çš„ç‚¹          for (int j = 1; j &lt;= n; j ++ )              if (!st[j] &amp;&amp; (t == -1 || dist[t] &gt; dist[j]))                  t = j;            // ç”¨tæ›´æ–°å…¶ä»–ç‚¹çš„è·ç¦»          for (int j = 1; j &lt;= n; j ++ )              dist[j] = min(dist[j], dist[t] + g[t][j]);            st[t] = true;      }        if (dist[n] == 0x3f3f3f3f) return -1;      return dist[n];  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å †ä¼˜åŒ–ç‰ˆçš„ O(mlogn) ç¨€ç–å›¾  <pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">typedef pair&lt;int, int&gt; PII;    int n;      // ç‚¹çš„æ•°é‡  int h[N], w[N], e[N], ne[N], idx;       // é‚»æ¥è¡¨å­˜å‚¨æ‰€æœ‰è¾¹  int dist[N];        // å­˜å‚¨æ‰€æœ‰ç‚¹åˆ°1å·ç‚¹çš„è·ç¦»  bool st[N];     // å­˜å‚¨æ¯ä¸ªç‚¹çš„æœ€çŸ­è·ç¦»æ˜¯å¦å·²ç¡®å®š    // æ±‚1å·ç‚¹åˆ°nå·ç‚¹çš„æœ€çŸ­è·ç¦»ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›-1  int dijkstra()  {      memset(dist, 0x3f, sizeof dist);      dist[1] = 0;      priority_queue&lt;PII, vector&lt;PII&gt;, greater&lt;PII&gt;&gt; heap;      heap.push({0, 1});      // firstå­˜å‚¨è·ç¦»ï¼Œsecondå­˜å‚¨èŠ‚ç‚¹ç¼–å·        while (heap.size())      {          auto t = heap.top();          heap.pop();            int ver = t.second, distance = t.first;            if (st[ver]) continue;          st[ver] = true;            for (int i = h[ver]; i != -1; i = ne[i])          {              int j = e[i];              if (dist[j] &gt; distance + w[i])              {                  dist[j] = distance + w[i];                  heap.push({dist[j], j});              }          }      }        if (dist[n] == 0x3f3f3f3f) return -1;      return dist[n];  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol></li><li><p>å­˜åœ¨è´Ÿæƒè¾¹</p><ol><li><p>Bellman -Ford O(nm) <strong>å¥‡å¦™çš„å­˜å›¾æ–¹å¼</strong> æ— è´Ÿæƒå›è·¯ ç»è¿‡è·¯å¾„æœ‰æ¬¡æ•°é™åˆ¶çš„è¯åªèƒ½ç”¨è¿™ä¸ªäº†ï¼Œå¤–é¢é™åˆ¶çš„æ˜¯ç»è¿‡içš„ç‚¹çš„ä¸ªæ•°ï¼Œç„¶åæ¯æ¬¡éå†è¾¹å³å¯ã€‚</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">int n, m;       // nè¡¨ç¤ºç‚¹æ•°ï¼Œmè¡¨ç¤ºè¾¹æ•°  int dist[N];        // dist[x]å­˜å‚¨1åˆ°xçš„æœ€çŸ­è·¯è·ç¦»    struct Edge     // è¾¹ï¼Œaè¡¨ç¤ºå‡ºç‚¹ï¼Œbè¡¨ç¤ºå…¥ç‚¹ï¼Œwè¡¨ç¤ºè¾¹çš„æƒé‡  {      int a, b, w;  }edges[M];    // æ±‚1åˆ°nçš„æœ€çŸ­è·¯è·ç¦»ï¼Œå¦‚æœæ— æ³•ä»1èµ°åˆ°nï¼Œåˆ™è¿”å›-1ã€‚  int bellman_ford()  {      memset(dist, 0x3f, sizeof dist);      dist[1] = 0;  //ä¸éœ€è¦è¿›è¡Œæ”¶å½•é¡¶ç‚¹      // å¦‚æœç¬¬næ¬¡è¿­ä»£ä»ç„¶ä¼šæ¾å¼›ä¸‰è§’ä¸ç­‰å¼ï¼Œå°±è¯´æ˜å­˜åœ¨ä¸€æ¡é•¿åº¦æ˜¯n+1çš„æœ€çŸ­è·¯å¾„ï¼Œç”±æŠ½å±‰åŸç†ï¼Œè·¯å¾„ä¸­è‡³å°‘å­˜åœ¨ä¸¤ä¸ªç›¸åŒçš„ç‚¹ï¼Œè¯´æ˜å›¾ä¸­å­˜åœ¨è´Ÿæƒå›è·¯ã€‚      for (int i = 0; i &lt; n; i ++ )//è¿™ä¸ªnæ˜¯æŒ‡çš„æ˜¯æœ€å¤šä¸ç»è¿‡ å¤šå°‘æ¬¡ç»è¿‡åŒä¸€æ¡è¾¹      {          for (int j = 0; j &lt; m; j ++ )          {              int a = edges[j].a, b = edges[j].b, w = edges[j].w;              if (dist[b] &gt; dist[a] + w)                  dist[b] = dist[a] + w;          }      }        if (dist[n] &gt; 0x3f3f3f3f / 2) return -1;      return dist[n];  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>SPFA ä¸€èˆ¬ï¼š Oï¼ˆm) æœ€åOï¼ˆnmï¼‰ ä¸å­˜åœ¨è´Ÿæƒç¯æ‰èƒ½ä½¿ç”¨ 99%éƒ½æ²¡æœ‰è´Ÿç¯æ¯”è¾ƒå¥½ç”¨</p><p> ä¼˜åŒ–æ€è·¯ï¼šåªæœ‰æ›´æ–°è¿‡ç‚¹æ‰å¯¹åé¢çš„ç‚¹æ›´æ–°æœ‰å½±å“</p><p> è¦ä» 1 å¼€å§‹å­˜æ¯”è¾ƒå¥½ ï¼Œe æ˜¯end ä¹Ÿå°±æ˜¯ä¸€æ¡è¾¹çš„ç»ˆç‚¹</p> <pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">int n;      // æ€»ç‚¹æ•°  int h[N], w[N], e[N], ne[N], idx;       // é‚»æ¥è¡¨å­˜å‚¨æ‰€æœ‰è¾¹  int dist[N];        // å­˜å‚¨æ¯ä¸ªç‚¹åˆ°1å·ç‚¹çš„æœ€çŸ­è·ç¦»  bool st[N];     // å­˜å‚¨æ¯ä¸ªç‚¹æ˜¯å¦åœ¨é˜Ÿåˆ—ä¸­      // æ±‚xå·ç‚¹åˆ°nå·ç‚¹çš„æœ€çŸ­è·¯è·ç¦»ï¼Œå¦‚æœä»1å·ç‚¹æ— æ³•èµ°åˆ°nå·ç‚¹åˆ™è¿”å›-1  int spfa(int x)  {      memset(dist, 0x3f, sizeof dist);//åˆå§‹åŒ–è¦æ ¹æ®é¢˜ç›®æ¥            dist[x] = 0;  /*æˆ–è€…  for(int i = 1 ; i &lt;= n ; i ++){          dis[i] = INT_MAX;      }*/      queue&lt;int&gt; q;      q.push(x);        while (q.size())//ä¸ä¸ºç©ºï¼Œå³ä¸ºè¿˜æœ‰æ›´æ–°çš„ç‚¹      {          auto t = q.front();          q.pop();            st[t] = false;//è¿™é‡Œä¸è¦å¿˜è®°         //éå†æ‰€ä»¥èƒ½åˆ°è¾¾çš„é¡¶ç‚¹ï¼Œè¿›è¡Œæ›´æ–°          for (int i = h[t]; i != -1; i = ne[i])          {              int j = e[i];              if (dist[j] &gt; dist[t] + w[i])              {                  dist[j] = dist[t] + w[i];                  if (!st[j])     // å¦‚æœé˜Ÿåˆ—ä¸­å·²å­˜åœ¨jï¼Œåˆ™ä¸éœ€è¦å°†jé‡å¤æ’å…¥                  {                      q.push(j);//è¿™é‡Œæ˜¯j                      st[j] = true;//è¿™é‡Œæ˜¯j                  }              }          }      }        if (dist[n] == 0x3f3f3f3f) return -1;      return dist[n];  }  //åˆå§‹åŒ–å’Œå­˜å›¾  void add(int a, int b , int c){      w[idx] = c;      ne[idx] = h[a];       en[idx] =  b;        h[a] = idx++;  }  void init(){      idx = 1;      memset(h , -1 ,sizeof h);  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ¨¡æ¿é¢˜ï¼š"><a href="#æ¨¡æ¿é¢˜ï¼š" class="headerlink" title="æ¨¡æ¿é¢˜ï¼š"></a>æ¨¡æ¿é¢˜ï¼š</h4><p> <a href="https://www.luogu.com.cn/problem/P3371">P3371 ã€æ¨¡æ¿ã€‘å•æºæœ€çŸ­è·¯å¾„ï¼ˆå¼±åŒ–ç‰ˆï¼‰ - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)</a></p></li></ol></li></ul><h2 id="x3D-x3D-åˆ¤æ–­æœ‰æ— è´Ÿç¯-ç”¨cnt-æ¥è®°å½•å½“å‰æœ€çŸ­è·¯çš„è¾¹æ•°"><a href="#x3D-x3D-åˆ¤æ–­æœ‰æ— è´Ÿç¯-ç”¨cnt-æ¥è®°å½•å½“å‰æœ€çŸ­è·¯çš„è¾¹æ•°" class="headerlink" title="==åˆ¤æ–­æœ‰æ— è´Ÿç¯ ç”¨cnt æ¥è®°å½•å½“å‰æœ€çŸ­è·¯çš„è¾¹æ•°"></a>==<strong>åˆ¤æ–­æœ‰æ— è´Ÿç¯ ç”¨cnt æ¥è®°å½•å½“å‰æœ€çŸ­è·¯çš„è¾¹æ•°</strong></h2><p>ä¾‹é¢˜ï¼š <a href="https://www.luogu.com.cn/problem/P3385">è´Ÿç¯è·¯</a></p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">int n;      // æ€»ç‚¹æ•°  int h[N], w[N], e[N], ne[N], idx;       // é‚»æ¥è¡¨å­˜å‚¨æ‰€æœ‰è¾¹  int dist[N], cnt[N];        // dist[x]å­˜å‚¨1å·ç‚¹åˆ°xçš„æœ€çŸ­è·ç¦»ï¼Œcnt[x]å­˜å‚¨1åˆ°xçš„æœ€çŸ­è·¯ä¸­ç»è¿‡çš„ç‚¹æ•°  bool st[N];     // å­˜å‚¨æ¯ä¸ªç‚¹æ˜¯å¦åœ¨é˜Ÿåˆ—ä¸­    // å¦‚æœå­˜åœ¨è´Ÿç¯ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚  bool spfa()  {      // ä¸éœ€è¦åˆå§‹åŒ–distæ•°ç»„      // åŸç†ï¼šå¦‚æœæŸæ¡æœ€çŸ­è·¯å¾„ä¸Šæœ‰nä¸ªç‚¹ï¼ˆé™¤äº†è‡ªå·±ï¼‰ï¼Œé‚£ä¹ˆåŠ ä¸Šè‡ªå·±ä¹‹åä¸€å…±æœ‰n+1ä¸ªç‚¹ï¼Œç”±æŠ½å±‰åŸç†ä¸€å®šæœ‰ä¸¤ä¸ªç‚¹ç›¸åŒï¼Œæ‰€ä»¥å­˜åœ¨ç¯ã€‚        queue&lt;int&gt; q;      for (int i = 1; i &lt;= n; i ++ )      {          q.push(i);          st[i] = true;      }        while (q.size())      {          auto t = q.front();          q.pop();            st[t] = false;            for (int i = h[t]; i != -1; i = ne[i])          {              int j = e[i];              if (dist[j] &gt; dist[t] + w[i])              {                  dist[j] = dist[t] + w[i];                  cnt[j] = cnt[t] + 1;                  if (cnt[j] &gt;= n) return true;       // å¦‚æœä»1å·ç‚¹åˆ°xçš„æœ€çŸ­è·¯ä¸­åŒ…å«è‡³å°‘nä¸ªç‚¹ï¼ˆä¸åŒ…æ‹¬è‡ªå·±ï¼‰ï¼Œåˆ™è¯´æ˜å­˜åœ¨ç¯                  if (!st[j])                  {                      q.push(j);                      st[j] = true;                  }              }          }      }        return false;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¤šæºæ±‡æœ€çŸ­è·¯-èµ·ç‚¹ç»ˆç‚¹éƒ½ä¸ç¡®å®š"><a href="#å¤šæºæ±‡æœ€çŸ­è·¯-èµ·ç‚¹ç»ˆç‚¹éƒ½ä¸ç¡®å®š" class="headerlink" title="å¤šæºæ±‡æœ€çŸ­è·¯ èµ·ç‚¹ç»ˆç‚¹éƒ½ä¸ç¡®å®š"></a>å¤šæºæ±‡æœ€çŸ­è·¯ èµ·ç‚¹ç»ˆç‚¹éƒ½ä¸ç¡®å®š</h3><p>Floyd O(n^3)</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">åˆå§‹åŒ–ï¼š   &nbsp; &nbsp;for (int i = 1; i &lt;= n; i ++ )   &nbsp; &nbsp; &nbsp; &nbsp;for (int j = 1; j &lt;= n; j ++ )   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (i == j) d[i][j] = 0;   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;else d[i][j] = INF;  â€‹  // ç®—æ³•ç»“æŸåï¼Œd[a][b]è¡¨ç¤ºaåˆ°bçš„æœ€çŸ­è·ç¦»  void floyd()  {   &nbsp; &nbsp;for (int k = 1; k &lt;= n; k ++ )   &nbsp; &nbsp; &nbsp; &nbsp;for (int i = 1; i &lt;= n; i ++ )   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for (int j = 1; j &lt;= n; j ++ )   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;d[i][j] = min(d[i][j], d[i][k] + d[k][j]);// iç»è¿‡k ç‚¹åˆ°è¾¾j   }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æœ€å°ç”Ÿæˆæ ‘"><a href="#æœ€å°ç”Ÿæˆæ ‘" class="headerlink" title="æœ€å°ç”Ÿæˆæ ‘"></a>æœ€å°ç”Ÿæˆæ ‘</h2><h3 id="æ™®åˆ©å§†ç®—æ³•-Prim-æ€è·¯å’ŒDijsktraç®—æ³•ç›¸ä¼¼-å¤–éƒ¨è¿­ä»£-n-æ¬¡ï¼Œå› ä¸ºæ²¡æœ‰æå‰é€‰ä¸­ä¸€ä¸ªç‚¹"><a href="#æ™®åˆ©å§†ç®—æ³•-Prim-æ€è·¯å’ŒDijsktraç®—æ³•ç›¸ä¼¼-å¤–éƒ¨è¿­ä»£-n-æ¬¡ï¼Œå› ä¸ºæ²¡æœ‰æå‰é€‰ä¸­ä¸€ä¸ªç‚¹" class="headerlink" title="æ™®åˆ©å§†ç®—æ³• Prim æ€è·¯å’ŒDijsktraç®—æ³•ç›¸ä¼¼ å¤–éƒ¨è¿­ä»£ n æ¬¡ï¼Œå› ä¸ºæ²¡æœ‰æå‰é€‰ä¸­ä¸€ä¸ªç‚¹"></a>æ™®åˆ©å§†ç®—æ³• Prim æ€è·¯å’ŒDijsktraç®—æ³•ç›¸ä¼¼ å¤–éƒ¨è¿­ä»£ n æ¬¡ï¼Œå› ä¸ºæ²¡æœ‰æå‰é€‰ä¸­ä¸€ä¸ªç‚¹</h3><h3 id="è¿­ä»£næ¬¡å› ä¸ºæ²¡æœ‰æå‰é€‰ä¸­ä¸€ä¸ªç‚¹-æšä¸¾æ‰€æœ‰ç‚¹"><a href="#è¿­ä»£næ¬¡å› ä¸ºæ²¡æœ‰æå‰é€‰ä¸­ä¸€ä¸ªç‚¹-æšä¸¾æ‰€æœ‰ç‚¹" class="headerlink" title="è¿­ä»£næ¬¡å› ä¸ºæ²¡æœ‰æå‰é€‰ä¸­ä¸€ä¸ªç‚¹ æšä¸¾æ‰€æœ‰ç‚¹"></a>è¿­ä»£næ¬¡å› ä¸ºæ²¡æœ‰æå‰é€‰ä¸­ä¸€ä¸ªç‚¹ æšä¸¾æ‰€æœ‰ç‚¹</h3><ol><li><p>æœ´ç´ Primç®—æ³• ç¨ å¯†å›¾ æ¯æ¬¡æ‰¾åˆ°æœªæ”¶å½•çš„è·ç¦»æœ€è¿‘çš„ç‚¹ï¼Œæ”¶å½•å¹¶è¿›è¡Œæ›´æ–°å…¶ä»–ç‚¹åˆ°<strong>é›†åˆ</strong>çš„è·ç¦»</p></li><li><p>æ‰¾è¿™ä¸ªç‚¹æ˜¯å¦ä¸é›†åˆå†…éƒ¨ç›¸è¿</p></li><li><p>æŸä¸ªç‚¹åˆ°è¿™ä¸ªé›†åˆçš„è·ç¦»ä¸ºæŸä¸ªç‚¹åˆ°è¿™ä¸ªé›†åˆå½“ä¸­çš„ç‚¹çš„è·ç¦»æœ€çŸ­çš„è¾¹</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">int n; &nbsp; &nbsp; &nbsp;// nè¡¨ç¤ºç‚¹æ•°  int g[N][N]; &nbsp; &nbsp; &nbsp; &nbsp;// é‚»æ¥çŸ©é˜µï¼Œå­˜å‚¨æ‰€æœ‰è¾¹  int dist[N]; &nbsp; &nbsp; &nbsp; &nbsp;// å­˜å‚¨å…¶ä»–ç‚¹åˆ°å½“å‰æœ€å°ç”Ÿæˆæ ‘çš„è·ç¦»  bool st[N]; &nbsp; &nbsp; // å­˜å‚¨æ¯ä¸ªç‚¹æ˜¯å¦å·²ç»åœ¨ç”Ÿæˆæ ‘ä¸­  â€‹  â€‹  // å¦‚æœå›¾ä¸è¿é€šï¼Œåˆ™è¿”å›INF(å€¼æ˜¯0x3f3f3f3f), å¦åˆ™è¿”å›æœ€å°ç”Ÿæˆæ ‘çš„æ ‘è¾¹æƒé‡ä¹‹å’Œ  int prim()  {   &nbsp; &nbsp;memset(dist, 0x3f, sizeof dist);  â€‹   &nbsp; &nbsp;int res = 0;   &nbsp; &nbsp;for (int i = 0; i &lt; n; i ++ )   &nbsp;  {   &nbsp; &nbsp; &nbsp; &nbsp;int t = -1;   &nbsp; &nbsp; &nbsp; &nbsp;for (int j = 1; j &lt;= n; j ++ )   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!st[j] &amp;&amp; (t == -1 || dist[t] &gt; dist[j]))   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;t = j;  â€‹   &nbsp; &nbsp; &nbsp; &nbsp;if (i &amp;&amp; dist[t] == INF) return INF;  â€‹   &nbsp; &nbsp; &nbsp; &nbsp;if (i) res += dist[t];   &nbsp; &nbsp; &nbsp; &nbsp;st[t] = true;  â€‹   &nbsp; &nbsp; &nbsp; &nbsp;for (int j = 1; j &lt;= n; j ++ ) dist[j] = min(dist[j], g[t][j]);   &nbsp; &nbsp; &nbsp; &nbsp;//ä¸æ˜¯ç›¸åŠ    &nbsp;  }  â€‹   &nbsp; &nbsp;return res;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å †ä¼˜åŒ–ç‰ˆçš„Prim ç¨€ç–å›¾ ä¸å¸¸ç”¨</p></li></ol><h3 id="å…‹é²æ–¯å¡å°”ç®—æ³•-Kruskal-å…ˆå¯¹è¾¹è¿›è¡Œæ’åº-ç¨€ç–å›¾-å¯ä»¥ç”¨å¹¶æŸ¥é›†-æšä¸¾æ‰€æœ‰è¾¹"><a href="#å…‹é²æ–¯å¡å°”ç®—æ³•-Kruskal-å…ˆå¯¹è¾¹è¿›è¡Œæ’åº-ç¨€ç–å›¾-å¯ä»¥ç”¨å¹¶æŸ¥é›†-æšä¸¾æ‰€æœ‰è¾¹" class="headerlink" title="å…‹é²æ–¯å¡å°”ç®—æ³• Kruskal å…ˆå¯¹è¾¹è¿›è¡Œæ’åº ç¨€ç–å›¾ å¯ä»¥ç”¨å¹¶æŸ¥é›† æšä¸¾æ‰€æœ‰è¾¹"></a>å…‹é²æ–¯å¡å°”ç®—æ³• Kruskal å…ˆå¯¹è¾¹è¿›è¡Œæ’åº ç¨€ç–å›¾ å¯ä»¥ç”¨å¹¶æŸ¥é›† æšä¸¾æ‰€æœ‰è¾¹</h3><p>javaç‰ˆæœ¬:</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bronya</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigInteger</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Edge</span> <span class="token punctuation">{</span><span class="token keyword">int</span> a <span class="token punctuation">,</span> b <span class="token punctuation">,</span> w<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token class-name">Edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> a <span class="token punctuation">,</span> <span class="token keyword">int</span> b <span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> a<span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">=</span> b<span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>w <span class="token operator">=</span> w<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span><span class="token punctuation">{</span><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">N</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1e5</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">int</span> n <span class="token punctuation">,</span> m <span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token class-name">N</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token class-name">Edge</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Edge</span><span class="token punctuation">[</span><span class="token class-name">N</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">long</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">!=</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n <span class="token punctuation">;</span>  i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>ed<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>m<span class="token punctuation">,</span><span class="token punctuation">(</span>e1<span class="token punctuation">,</span>e2<span class="token punctuation">)</span><span class="token operator">-&gt;</span>e1<span class="token punctuation">.</span>w <span class="token operator">-</span> e2<span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m <span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">int</span> a <span class="token operator">=</span> ed<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>a<span class="token punctuation">;</span><span class="token keyword">int</span> b <span class="token operator">=</span> ed<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>b<span class="token punctuation">;</span><span class="token keyword">int</span> w <span class="token operator">=</span> ed<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>b <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">!=</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>p<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">;</span>ans <span class="token operator">+=</span> w<span class="token punctuation">;</span>cnt <span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span>cnt <span class="token operator">&lt;</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span><span class="token class-name">BufferedReader</span> re <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> s <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>n <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>m <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>  i <span class="token operator">&lt;</span> m <span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>s <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> w <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ed<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Edge</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">boolean</span> f <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ans<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">else</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"orz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.luogu.com.cn/problem/P3366">P3366 ã€æ¨¡æ¿ã€‘æœ€å°ç”Ÿæˆæ ‘ - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)</a></p><ol><li><p>æ‰€æœ‰è¾¹æŒ‰æƒé‡ä»å°åˆ°å¤§æ’åº</p></li><li><p>æšä¸¾æ¯æ¡è¾¹a,bæƒé‡c if a,bä¸è¿é€šï¼Œ å°†è¿™æ¡è¾¹åŠ å…¥é›†åˆä¸­</p></li></ol><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">int n, m;       // næ˜¯ç‚¹æ•°ï¼Œmæ˜¯è¾¹æ•°  int p[N];       // å¹¶æŸ¥é›†çš„çˆ¶èŠ‚ç‚¹æ•°ç»„    struct Edge     // å­˜å‚¨è¾¹  {      int a, b, w;        bool operator&lt; (const Edge &amp;W)const // é‡è½½äº† &lt;       {          return w &lt; W.w;      }  }edges[M];    int find(int x)     // å¹¶æŸ¥é›†æ ¸å¿ƒæ“ä½œ  {      if (p[x] != x) p[x] = find(p[x]);      return p[x];  }    int kruskal()  {      sort(edges, edges + m);        for (int i = 1; i &lt;= n; i ++ ) p[i] = i;    // åˆå§‹åŒ–å¹¶æŸ¥é›†        int res = 0, cnt = 0;      for (int i = 0; i &lt; m; i ++ )      {          int a = edges[i].a, b = edges[i].b, w = edges[i].w;            a = find(a), b = find(b);          if (a != b)     // å¦‚æœä¸¤ä¸ªè¿é€šå—ä¸è¿é€šï¼Œåˆ™å°†è¿™ä¸¤ä¸ªè¿é€šå—åˆå¹¶          {              p[a] = b;              res += w;              cnt ++ ;          }      }        if (cnt &lt; n - 1) return INF;      return res;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äºŒåˆ†å›¾-å½“ä¸”ä»…å½“å›¾ä¸­æ²¡æœ‰å¥‡æ•°ç¯"><a href="#äºŒåˆ†å›¾-å½“ä¸”ä»…å½“å›¾ä¸­æ²¡æœ‰å¥‡æ•°ç¯" class="headerlink" title="äºŒåˆ†å›¾ å½“ä¸”ä»…å½“å›¾ä¸­æ²¡æœ‰å¥‡æ•°ç¯"></a>äºŒåˆ†å›¾ å½“ä¸”ä»…å½“å›¾ä¸­æ²¡æœ‰å¥‡æ•°ç¯</h2><h3 id="æŸ“è‰²æ³•-O-n-m-åˆ¤æ–­æ˜¯å¦æ˜¯äºŒåˆ†å›¾"><a href="#æŸ“è‰²æ³•-O-n-m-åˆ¤æ–­æ˜¯å¦æ˜¯äºŒåˆ†å›¾" class="headerlink" title="æŸ“è‰²æ³• O(n+m) åˆ¤æ–­æ˜¯å¦æ˜¯äºŒåˆ†å›¾"></a>æŸ“è‰²æ³• O(n+m) åˆ¤æ–­æ˜¯å¦æ˜¯äºŒåˆ†å›¾</h3><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">int n;      // nè¡¨ç¤ºç‚¹æ•°  int h[N], e[M], ne[M], idx;     // é‚»æ¥è¡¨å­˜å‚¨å›¾  int color[N];       // è¡¨ç¤ºæ¯ä¸ªç‚¹çš„é¢œè‰²ï¼Œ-1è¡¨ç¤ºæœªæŸ“è‰²ï¼Œ0è¡¨ç¤ºç™½è‰²ï¼Œ1è¡¨ç¤ºé»‘è‰²    // å‚æ•°ï¼šuè¡¨ç¤ºå½“å‰èŠ‚ç‚¹ï¼Œcè¡¨ç¤ºå½“å‰ç‚¹çš„é¢œè‰²  bool dfs(int u, int c)  {      color[u] = c;      for (int i = h[u]; i != -1; i = ne[i])      {          int j = e[i];          if (color[j] == -1)//æœªæŸ“è‰²          {              if (!dfs(j, !c)) return false;//æ¯”å¦‚ä¸¤ç§é¢œè‰²ï¼Œ 0ï¼Œ1è¡¨ç¤ºï¼Œé‚£ä¹ˆè¿™é‡Œå°±å¯ä»¥ç”¨ 3- c,ä¹Ÿå°±æ˜¯ç”¨å¦ä¸€ç§é¢œè‰²å»æŸ“è‰²          }          else if (color[j] == c) return false;      }        return true;  }    bool check()  {      memset(color, -1, sizeof color);      bool flag = true;      //æšä¸¾æ‰€æœ‰ç‚¹ï¼Œå»æŸ“è‰²      for (int i = 1; i &lt;= n; i ++ )          if (color[i] == -1)              if (!dfs(i, 0))              {                  flag = false;                  break;              }      return flag;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åŒˆç‰™åˆ©ç®—æ³•-O-mn-å®é™…è¿è¡Œæ—¶é—´ä¸€èˆ¬å°äºè¿™ä¸ªå€¼-ç¨ å¯†å›¾ä¸é€‚åˆç”¨é‚»æ¥è¡¨ï¼Œæ¨èä½¿ç”¨ä¸´ç•ŒçŸ©é˜µ"><a href="#åŒˆç‰™åˆ©ç®—æ³•-O-mn-å®é™…è¿è¡Œæ—¶é—´ä¸€èˆ¬å°äºè¿™ä¸ªå€¼-ç¨ å¯†å›¾ä¸é€‚åˆç”¨é‚»æ¥è¡¨ï¼Œæ¨èä½¿ç”¨ä¸´ç•ŒçŸ©é˜µ" class="headerlink" title="åŒˆç‰™åˆ©ç®—æ³• O(mn) å®é™…è¿è¡Œæ—¶é—´ä¸€èˆ¬å°äºè¿™ä¸ªå€¼ ç¨ å¯†å›¾ä¸é€‚åˆç”¨é‚»æ¥è¡¨ï¼Œæ¨èä½¿ç”¨ä¸´ç•ŒçŸ©é˜µ"></a>åŒˆç‰™åˆ©ç®—æ³• O(mn) å®é™…è¿è¡Œæ—¶é—´ä¸€èˆ¬å°äºè¿™ä¸ªå€¼ ç¨ å¯†å›¾ä¸é€‚åˆç”¨é‚»æ¥è¡¨ï¼Œæ¨èä½¿ç”¨ä¸´ç•ŒçŸ©é˜µ</h3><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">int n1, n2; &nbsp; &nbsp; // n1è¡¨ç¤ºç¬¬ä¸€ä¸ªé›†åˆä¸­çš„ç‚¹æ•°ï¼Œn2è¡¨ç¤ºç¬¬äºŒä¸ªé›†åˆä¸­çš„ç‚¹æ•°  int h[N], e[M], ne[M], idx; &nbsp; &nbsp; // é‚»æ¥è¡¨å­˜å‚¨æ‰€æœ‰è¾¹ï¼ŒåŒˆç‰™åˆ©ç®—æ³•ä¸­åªä¼šç”¨åˆ°ä»ç¬¬ä¸€ä¸ªé›†åˆæŒ‡å‘ç¬¬äºŒä¸ªé›†åˆçš„è¾¹ï¼Œæ‰€ä»¥è¿™é‡Œåªç”¨å­˜ä¸€ä¸ªæ–¹å‘çš„è¾¹  int match[N]; &nbsp; &nbsp; &nbsp; // å­˜å‚¨ç¬¬äºŒä¸ªé›†åˆä¸­çš„æ¯ä¸ªç‚¹å½“å‰åŒ¹é…çš„ç¬¬ä¸€ä¸ªé›†åˆä¸­çš„ç‚¹æ˜¯å“ªä¸ª  bool st[N]; &nbsp; &nbsp; // è¡¨ç¤ºç¬¬äºŒä¸ªé›†åˆä¸­çš„æ¯ä¸ªç‚¹æ˜¯å¦å·²ç»è¢«éå†è¿‡  â€‹  bool find(int x)  {   &nbsp; &nbsp;for (int i = h[x]; i != -1; i = ne[i])   &nbsp;  {   &nbsp; &nbsp; &nbsp; &nbsp;int j = e[i];   &nbsp; &nbsp; &nbsp; &nbsp;if (!st[j])   &nbsp; &nbsp; &nbsp;  {   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;st[j] = true;   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (match[j] == 0 || find(match[j]))//ç¬¬äºŒä¸ªé›†åˆçš„ç‚¹æœªåŒ¹é…ï¼Œæˆ–è€…æ˜¯å¯ä»¥ä¸ºå·²ç» åŒ¹é…çš„ç¬¬ä¸€ä¸ªé›†åˆä¸­çš„ç‚¹æ‰¾åˆ°åˆ«çš„é›†åˆäºŒä¸­çš„ç‚¹   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;match[j] = x;   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return true;   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }   &nbsp; &nbsp; &nbsp;  }   &nbsp;  }  â€‹   &nbsp; &nbsp;return false;  }  â€‹  // æ±‚æœ€å¤§åŒ¹é…æ•°ï¼Œä¾æ¬¡æšä¸¾ç¬¬ä¸€ä¸ªé›†åˆä¸­çš„æ¯ä¸ªç‚¹èƒ½å¦åŒ¹é…ç¬¬äºŒä¸ªé›†åˆä¸­çš„ç‚¹  int res = 0;  for (int i = 1; i &lt;= n1; i ++ )  {   &nbsp; &nbsp;memset(st, false, sizeof st);   &nbsp; &nbsp;if (find(i)) res ++ ;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ä¾‹é¢˜ï¼š<a href="https://www.luogu.com.cn/problem/P3386">P3386 ã€æ¨¡æ¿ã€‘äºŒåˆ†å›¾æœ€å¤§åŒ¹é… - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)</a></strong></p><h2 id="é‚»æ¥è¡¨çš„å†™æ³•-ç¨ å¯†å›¾ä¼šè¶…æ—¶"><a href="#é‚»æ¥è¡¨çš„å†™æ³•-ç¨ å¯†å›¾ä¼šè¶…æ—¶" class="headerlink" title="é‚»æ¥è¡¨çš„å†™æ³•(ç¨ å¯†å›¾ä¼šè¶…æ—¶)"></a>é‚»æ¥è¡¨çš„å†™æ³•(ç¨ å¯†å›¾ä¼šè¶…æ—¶)</h2><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;bits/stdc++.h&gt;  using namespace std;  const int N  = 505;  int n1,n2,ed;//éœ€è¦ä¸¤ä¸ªé›†åˆ  int h[N] , ne[N] , e[N] , idx;  int match[N] ;  bool vis[N];  void init(){      memset(h,-1,sizeof h);      idx = 0;  }  void add(int a, int b){      e[idx] = b ;      ne[idx] = h[a];      h[a] = idx++;  }  bool find(int x){      for (int i = h[x] ; i != -1 ; i =ne[i]){          int j = e[i];          if(!vis[j]){              vis[j] = true;              if(match[j] == 0 || find(match[j])){                  //å¦‚æœç»ˆè¾¹çš„ç‚¹æœªåŒ¹é…ï¼Œæˆ–è€…æ˜¯å¯ä»¥ä¸ºä»¥åŒ¹é…çš„èµ·ç‚¹æ‰¾åˆ°å¦ä¸€ä¸ªç»ˆç‚¹                  match[j] = x;                  return true;              }          }      }      return false;  }  int main(){      ios::sync_with_stdio(false);      cin.tie(nullptr);      cin &gt;&gt; n1 &gt;&gt; n2 &gt;&gt;ed;      init();      int u ,v;      for (int i = 1 ; i &lt;= ed ; i++){          cin &gt;&gt; u &gt;&gt; v;          if(v &lt;= n2){              add(u , v);          }               }      int ans = 0;      for (int i = 1 ; i &lt;= n1 ; i++){          memset(vis, false ,sizeof vis);          if(find(i)) ans++;      }      cout &lt;&lt; ans &lt;&lt;endl ;      return 0;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é‚»æ¥çŸ©é˜µçš„å†™æ³•ï¼š"><a href="#é‚»æ¥çŸ©é˜µçš„å†™æ³•ï¼š" class="headerlink" title="é‚»æ¥çŸ©é˜µçš„å†™æ³•ï¼š"></a>é‚»æ¥çŸ©é˜µçš„å†™æ³•ï¼š</h2><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;bits/stdc++.h&gt;  using namespace std;  const int N  = 505;  int n1,n2,ed;//éœ€è¦ä¸¤ä¸ªé›†åˆ  bool a[N][N];  int match[N];  bool vis[N];  bool find(int x){      //æšä¸¾ç»ˆè¾¹      for (int i = 1 ; i &lt;= n2 ; i ++){          if(!vis[i] &amp;&amp; a[x][i]){              vis[i] = true;              if(match[i] == 0 || find(match[i])){                  //å¦‚æœç»ˆè¾¹çš„ç‚¹æœªåŒ¹é…ï¼Œæˆ–è€…æ˜¯å¯ä»¥ä¸ºä»¥åŒ¹é…çš„èµ·ç‚¹æ‰¾åˆ°å¦ä¸€ä¸ªç»ˆç‚¹                  match[i] = x;                  return true;              }          }      }      return false;  }  int main(){      ios::sync_with_stdio(false);      cin.tie(nullptr);      cin &gt;&gt; n1 &gt;&gt; n2 &gt;&gt;ed;      int u ,v;      for (int i = 1 ; i &lt;= ed ; i++){          cin &gt;&gt; u &gt;&gt; v;          if(v &lt;= n2){              a[u][v] = 1;          }               }      int ans = 0;      for (int i = 1 ; i &lt;= n1 ; i++){          ans+=find(i); // è¿™é‡Œä¸ä¸€æ ·å“¦          memset(vis, false ,sizeof vis);      }      cout &lt;&lt; ans &lt;&lt;endl ;      return 0;  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ•°å­¦çŸ¥è¯†"><a href="#æ•°å­¦çŸ¥è¯†" class="headerlink" title="æ•°å­¦çŸ¥è¯†"></a>æ•°å­¦çŸ¥è¯†</h2><blockquote><p>[!NOTE]</p><h2 id="å½“çœ‹è§-0-çš„ä¸ªæ•°æ—¶è€ƒè™‘å°†ç»“æœåˆ†æˆ-2-ï¼Œ-5-çš„ä¸ªæ•°-å¹¶ä¸”ï¼Œæœ«å°¾çš„0çš„ä¸ªæ•°ä¸€å®šæ˜¯ç”±5çš„ä¸ªæ•°å†³å®šçš„"><a href="#å½“çœ‹è§-0-çš„ä¸ªæ•°æ—¶è€ƒè™‘å°†ç»“æœåˆ†æˆ-2-ï¼Œ-5-çš„ä¸ªæ•°-å¹¶ä¸”ï¼Œæœ«å°¾çš„0çš„ä¸ªæ•°ä¸€å®šæ˜¯ç”±5çš„ä¸ªæ•°å†³å®šçš„" class="headerlink" title="å½“çœ‹è§ 0 çš„ä¸ªæ•°æ—¶è€ƒè™‘å°†ç»“æœåˆ†æˆ 2 ï¼Œ 5 çš„ä¸ªæ•°,å¹¶ä¸”ï¼Œæœ«å°¾çš„0çš„ä¸ªæ•°ä¸€å®šæ˜¯ç”±5çš„ä¸ªæ•°å†³å®šçš„"></a>å½“çœ‹è§ 0 çš„ä¸ªæ•°æ—¶è€ƒè™‘å°†ç»“æœåˆ†æˆ 2 ï¼Œ 5 çš„ä¸ªæ•°,å¹¶ä¸”ï¼Œæœ«å°¾çš„0çš„ä¸ªæ•°ä¸€å®šæ˜¯ç”±5çš„ä¸ªæ•°å†³å®šçš„</h2></blockquote><p><a href="https://ac.nowcoder.com/acm/contest/57683/E">E-Kevinå–œæ¬¢é›¶(å›°éš¾ç‰ˆæœ¬)_ç‰›å®¢å°ç™½æœˆèµ›73 (nowcoder.com)</a></p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;bits/stdc++.h&gt;  â€‹  void solve() {#include &lt;bits/stdc++.h&gt;  â€‹  void solve() {   &nbsp; &nbsp;int n, k;   &nbsp; &nbsp;std::cin &gt;&gt; n &gt;&gt; k;  â€‹   &nbsp; &nbsp;int64_t ans = 0;   &nbsp; &nbsp;std::unordered_map&lt;int, std::vector&lt;int&gt;&gt; tp, fp;   &nbsp; &nbsp;//tp è®°å½•5çš„ä¸ªæ•°ï¼Œfpè®°å½•2çš„ä¸ªæ•°   &nbsp; &nbsp;//ä¸¤ä¸ªæ˜¯äº’è¡¥çš„   &nbsp; &nbsp;tp[0].push_back(0);   &nbsp; &nbsp;fp[0].push_back(0);  â€‹   &nbsp; &nbsp;for (int i = 0, t = 0, f = 0; i &lt; n; i++) {   &nbsp; &nbsp; &nbsp; &nbsp;int x;   &nbsp; &nbsp; &nbsp; &nbsp;std::cin &gt;&gt; x;   &nbsp; &nbsp; &nbsp; &nbsp;for (; x &amp;&amp; x % 2 == 0; x /= 2, t++) {   &nbsp; &nbsp; &nbsp;  }   &nbsp; &nbsp; &nbsp; &nbsp;for (; x &amp;&amp; x % 5 == 0; x /= 5, f++) {   &nbsp; &nbsp; &nbsp;  }   &nbsp; &nbsp; &nbsp; &nbsp;ans += std::max(   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//éœ€è¦ 2^k &nbsp; * 5^k å³å¯æ»¡è¶³ 10^k æ‰€ä»¥æ˜¯åŠ¨æ€è§„åˆ’   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//æ¯æ¬¡è®¡ç®—å‡ºå½“å‰æ•°æ®å«æœ‰çš„2 å’Œ  5 çš„æ•°é‡ å’Œä»ç„¶éœ€è¦ k  - å½“å‰æ•°é‡ &nbsp; è¿™ä¸€è¡Œçš„å»æ›´æ–°   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//å› ä¸ºåŒä¸€ä¸ªçŠ¶æ€æœ‰å¯èƒ½å¯¹åº”å¤šä¸ªæ•°æ®ï¼Œ æ‰€ä»¥åªè¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³èƒ½å‡‘å‡ºå¦ä¸€ä¸ª2æˆ–è€…5çš„å³å¯    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//mapä¸èƒ½ä½¿ç”¨upper_bound ä½†æ˜¯ å†…éƒ¨çš„vector æ˜¯å¯ä»¥ä½¿ç”¨çš„   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;std::upper_bound(tp[t - k].begin(), tp[t - k].end(), f - k) - tp[t - k].begin(),   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;std::upper_bound(fp[f - k].begin(), fp[f - k].end(), t - k) - fp[f - k].begin()   &nbsp; &nbsp; &nbsp;  );   &nbsp; &nbsp; &nbsp; &nbsp;tp[t].push_back(f);   &nbsp; &nbsp; &nbsp; &nbsp;fp[f].push_back(t);   &nbsp;  }  â€‹   &nbsp; &nbsp;std::cout &lt;&lt; ans &lt;&lt; "\n";  }  â€‹  int main() {   &nbsp; &nbsp;std::ios::sync_with_stdio(false);   &nbsp; &nbsp;std::cin.tie(nullptr);  â€‹   &nbsp; &nbsp;int t;   &nbsp; &nbsp;std::cin &gt;&gt; t;  â€‹   &nbsp; &nbsp;while (t--) {   &nbsp; &nbsp; &nbsp; &nbsp;solve();   &nbsp;  }  â€‹   &nbsp; &nbsp;return 0;  }  â€‹   &nbsp; &nbsp;int n, k;   &nbsp; &nbsp;std::cin &gt;&gt; n &gt;&gt; k;  â€‹   &nbsp; &nbsp;int64_t ans = 0;   &nbsp; &nbsp;std::unordered_map&lt;int, std::vector&lt;int&gt;&gt; tp, fp;   &nbsp; &nbsp;//tp è®°å½•5çš„ä¸ªæ•°ï¼Œfpè®°å½•2çš„ä¸ªæ•°   &nbsp; &nbsp;//ä¸¤ä¸ªæ˜¯äº’è¡¥çš„   &nbsp; &nbsp;tp[0].push_back(0);   &nbsp; &nbsp;fp[0].push_back(0);  â€‹   &nbsp; &nbsp;for (int i = 0, t = 0, f = 0; i &lt; n; i++) {   &nbsp; &nbsp; &nbsp; &nbsp;int x;   &nbsp; &nbsp; &nbsp; &nbsp;std::cin &gt;&gt; x;   &nbsp; &nbsp; &nbsp; &nbsp;for (; x &amp;&amp; x % 2 == 0; x /= 2, t++) {   &nbsp; &nbsp; &nbsp;  }   &nbsp; &nbsp; &nbsp; &nbsp;for (; x &amp;&amp; x % 5 == 0; x /= 5, f++) {   &nbsp; &nbsp; &nbsp;  }   &nbsp; &nbsp; &nbsp; &nbsp;ans += std::max(   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//éœ€è¦ 2^k &nbsp; * 5^k å³å¯æ»¡è¶³ 10^k æ‰€ä»¥æ˜¯åŠ¨æ€è§„åˆ’   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//æ¯æ¬¡è®¡ç®—å‡ºå½“å‰æ•°æ®å«æœ‰çš„2 å’Œ  5 çš„æ•°é‡ å’Œä»ç„¶éœ€è¦ k  - å½“å‰æ•°é‡ &nbsp; è¿™ä¸€è¡Œçš„å»æ›´æ–°   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//å› ä¸ºåŒä¸€ä¸ªçŠ¶æ€æœ‰å¯èƒ½å¯¹åº”å¤šä¸ªæ•°æ®ï¼Œ æ‰€ä»¥åªè¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³èƒ½å‡‘å‡ºå¦ä¸€ä¸ª2æˆ–è€…5çš„å³å¯    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;std::upper_bound(tp[t - k].begin(), tp[t - k].end(), f - k) - tp[t - k].begin(),   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;std::upper_bound(fp[f - k].begin(), fp[f - k].end(), t - k) - fp[f - k].begin()   &nbsp; &nbsp; &nbsp;  );   &nbsp; &nbsp; &nbsp; &nbsp;tp[t].push_back(f);   &nbsp; &nbsp; &nbsp; &nbsp;fp[f].push_back(t);   &nbsp;  }  â€‹   &nbsp; &nbsp;std::cout &lt;&lt; ans &lt;&lt; "\n";  }  â€‹  int main() {   &nbsp; &nbsp;std::ios::sync_with_stdio(false);   &nbsp; &nbsp;std::cin.tie(nullptr);  â€‹   &nbsp; &nbsp;int t;   &nbsp; &nbsp;std::cin &gt;&gt; t;  â€‹   &nbsp; &nbsp;while (t--) {   &nbsp; &nbsp; &nbsp; &nbsp;solve();   &nbsp;  }  â€‹   &nbsp; &nbsp;return 0;  }  â€‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="æ•°è®º"><a href="#æ•°è®º" class="headerlink" title="æ•°è®º"></a>æ•°è®º</h1><ol><li><p>è´¨æ•°</p><ul><li><p>è¯•é™¤æ³•åˆ¤å®šè´¨æ•°ï¼Œåªæšä¸¾ d*d&lt;=n å³å¯`</p>  <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>n<span class="token operator">/</span>i<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//ä¸è¦æ‹…å¿ƒæ•°æ®è¶…è¿‡int  </span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>è¯•é™¤æ³•åˆ†è§£è´¨å› å­ï¼Œè´¨å› æ•° ,æ±‚çº¦æ•°</p><ul><li>ä»å°åˆ°å¤§æšä¸¾æ‰€æœ‰çš„çº¦æ•°,nä¸­æœ€å¤šåªå­˜åœ¨ä¸€ä¸ªå¤§äºé£é›¨æ ¹å·nçš„è´¨å› å­</li></ul></li></ul></li></ol><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">            <span class="token keyword">void</span> <span class="token function">divide</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span>              <span class="token punctuation">{</span>                  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> x <span class="token operator">/</span> i<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span>                      <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>                      <span class="token punctuation">{</span>                          <span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                          <span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> x <span class="token operator">/=</span> i<span class="token punctuation">,</span> s <span class="token operator">++</span> <span class="token punctuation">;</span>                          cout <span class="token operator">&lt;&lt;</span> i <span class="token operator">&lt;&lt;</span> <span class="token char">' '</span> <span class="token operator">&lt;&lt;</span> s <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>                      <span class="token punctuation">}</span>                  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> cout <span class="token operator">&lt;&lt;</span> x <span class="token operator">&lt;&lt;</span> <span class="token char">' '</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>                  cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>              <span class="token punctuation">}</span>            ```            # åŸƒæ°ç­›æ³•ï¼š æšä¸¾æ‰€æœ‰æ•°æ®ï¼Œç„¶åæŠŠæ¯ä¸ªæ•°çš„å€æ•°ç­›å»ï¼Œç•™ä¸‹çš„å°±æ˜¯è´¨æ•° <span class="token operator">*</span><span class="token operator">*</span>æ€æƒ³æ¯”è¾ƒå¥½<span class="token operator">*</span><span class="token operator">*</span> æ€æƒ³å¤ªå¥½äº†``` cpp   <span class="token keyword">void</span> <span class="token function">get_primes</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">if</span><span class="token punctuation">(</span>st<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>                  <span class="token comment">//åˆ é™¤æ‰€æœ‰è´¨æ•°çš„å€æ•°  </span>        primes<span class="token punctuation">[</span>cnt<span class="token operator">++</span><span class="token punctuation">]</span><span class="token operator">=</span>i<span class="token punctuation">;</span>          <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>i<span class="token operator">+</span>i<span class="token punctuation">;</span>j<span class="token operator">&lt;=</span>n<span class="token punctuation">;</span>j<span class="token operator">+=</span>i<span class="token punctuation">)</span><span class="token punctuation">{</span>          st<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>          <span class="token punctuation">}</span>          <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="çº¿æ€§ç­›æ³•ï¼š-å¦‚æœè´¨æ•°ï¼ŒæŠŠè¿™ä¸ªæ•°åŠ å…¥é›†åˆä¸­-æœ€å¸¸ç”¨"><a href="#çº¿æ€§ç­›æ³•ï¼š-å¦‚æœè´¨æ•°ï¼ŒæŠŠè¿™ä¸ªæ•°åŠ å…¥é›†åˆä¸­-æœ€å¸¸ç”¨" class="headerlink" title="çº¿æ€§ç­›æ³•ï¼š å¦‚æœè´¨æ•°ï¼ŒæŠŠè¿™ä¸ªæ•°åŠ å…¥é›†åˆä¸­ æœ€å¸¸ç”¨"></a><strong>çº¿æ€§ç­›æ³•ï¼š å¦‚æœè´¨æ•°ï¼ŒæŠŠè¿™ä¸ªæ•°åŠ å…¥é›†åˆä¸­</strong> æœ€å¸¸ç”¨</h3> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> primes<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> cnt<span class="token punctuation">;</span>     <span class="token comment">// primes[]å­˜å‚¨æ‰€æœ‰ç´ æ•°  </span><span class="token keyword">bool</span> st<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>         <span class="token comment">// st[x]å­˜å‚¨xæ˜¯å¦è¢«ç­›æ‰  </span>  <span class="token keyword">void</span> <span class="token function">get_primes</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span>  <span class="token punctuation">{</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span>      <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>st<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> primes<span class="token punctuation">[</span>cnt <span class="token operator">++</span> <span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>          <span class="token comment">//æšä¸¾å·²æœ‰çš„è´¨æ•°ï¼Œåˆ é™¤å®ƒçš„å€æ•°  </span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> primes<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> n <span class="token operator">/</span> i<span class="token punctuation">;</span> j <span class="token operator">++</span> <span class="token punctuation">)</span>          <span class="token punctuation">{</span>              st<span class="token punctuation">[</span>primes<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> primes<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>      <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li><p>çº¦æ•°</p><ul><li><p>è¯•é™¤æ³•æ±‚æ‰€æœ‰çº¦æ•°</p><ul><li>åªæšä¸¾è¾ƒå°çš„çº¦æ•°ï¼Œè¾ƒå¤§çš„çº¦æ•°å¯ä»¥ç›´æ¥ç®—å‡º</li></ul></li></ul></li></ol><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>  vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> ans<span class="token punctuation">;</span>  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>n<span class="token operator">/</span>i<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">%</span>i<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//ä»å°åˆ°å¤§æšä¸¾æ‰€æœ‰çº¦æ•°ï¼Œå¹¶æŠŠn/i å¾—åˆ°çš„çº¦æ•°åŠ å…¥å³å¯  </span>ans<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">!=</span>n<span class="token operator">/</span>i<span class="token punctuation">)</span> ans<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>n<span class="token operator">/</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">sort</span><span class="token punctuation">(</span>ans<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>ans<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> ans<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>çº¦æ•°ä¸ªæ•°,çº¦æ•°ä¹‹å’Œ<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">        å¦‚æœ N <span class="token operator">=</span> p1<span class="token operator">^</span>c1 <span class="token operator">*</span> p2<span class="token operator">^</span>c2 <span class="token operator">*</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">*</span>pk<span class="token operator">^</span>ck          çº¦æ•°ä¸ªæ•°ï¼š <span class="token punctuation">(</span>c1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>c2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">*</span> <span class="token punctuation">(</span>ck <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>          çº¦æ•°ä¹‹å’Œï¼š <span class="token punctuation">(</span>p1<span class="token operator">^</span><span class="token number">0</span> <span class="token operator">+</span> p1<span class="token operator">^</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">+</span> p1<span class="token operator">^</span>c1<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">*</span> <span class="token punctuation">(</span>pk<span class="token operator">^</span><span class="token number">0</span> <span class="token operator">+</span> pk<span class="token operator">^</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">+</span> pk<span class="token operator">^</span>ck<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span> ULL<span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">int</span> mod  <span class="token operator">=</span> <span class="token number">1e9</span> <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> n <span class="token punctuation">;</span>    cin <span class="token operator">&gt;&gt;</span> n<span class="token punctuation">;</span>    unordered_map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token operator">&gt;</span> primes<span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> x<span class="token punctuation">;</span>        <span class="token function">scanf</span> <span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> x <span class="token operator">/</span> i <span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">while</span><span class="token punctuation">(</span>x <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                primes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">++</span><span class="token punctuation">;</span>                x <span class="token operator">/=</span> i<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>  primes<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    ULL cnts <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>res <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token punctuation">[</span>prime<span class="token punctuation">,</span>cnt<span class="token punctuation">]</span><span class="token operator">:</span>primes<span class="token punctuation">)</span>  <span class="token punctuation">{</span>        cnts <span class="token operator">=</span> <span class="token punctuation">(</span>cnts <span class="token operator">*</span> <span class="token punctuation">(</span>cnt <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span>        <span class="token comment">//æ±‚å’Œ</span>        ULL t <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>cnt<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">//ç§¦ä¹zhaoç®—æ³•</span>            t <span class="token operator">=</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>prime <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span>mod<span class="token punctuation">;</span>        <span class="token punctuation">}</span>         res <span class="token operator">=</span> res <span class="token operator">*</span> t <span class="token operator">%</span> mod<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    cout <span class="token operator">&lt;&lt;</span> cnts <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> res<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><ol start="3"><li><p>æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼Œè¾—è½¬ç›¸é™¤æ³•ï¼Œæ±‚æœ€å¤§å…¬çº¦æ•°</p><ul><li>GCD(a,b) = =GCD(a.amodb)<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">        <span class="token keyword">int</span> <span class="token function">gcd</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span>          <span class="token punctuation">{</span>              <span class="token keyword">return</span> b <span class="token operator">?</span> <span class="token function">gcd</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a <span class="token operator">%</span> b<span class="token punctuation">)</span> <span class="token operator">:</span> a<span class="token punctuation">;</span>          <span class="token punctuation">}</span>        ```         <span class="token operator">-</span> LCM æœ€å°å…¬å€æ•° å°†ä¸¤ä¸ªæ•°ç›¸ä¹˜å†é™¤ä»¥æœ€å¤§å…¬å› æ•°å³å¯å¾—åˆ°æœ€å°å…¬å€æ•°    ```cpp        <span class="token keyword">int</span> <span class="token function">lcm</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span><span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">return</span> a<span class="token operator">*</span>b<span class="token operator">/</span><span class="token function">gcd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>æ±‚ax+by=gcd(a,b)<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">        <span class="token keyword">int</span> <span class="token function">xGCD</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>x<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>y<span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//b = 0 æ—¶  </span>                x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                  <span class="token keyword">return</span> a<span class="token punctuation">;</span>              <span class="token punctuation">}</span>              <span class="token keyword">int</span> x1<span class="token punctuation">,</span> y10<span class="token punctuation">,</span> gcd <span class="token operator">=</span> <span class="token function">xGCD</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a <span class="token operator">%</span> b<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">;</span>              x <span class="token operator">=</span> y1<span class="token punctuation">,</span> y <span class="token operator">=</span> x1 <span class="token operator">-</span> <span class="token punctuation">(</span>a <span class="token operator">/</span> b<span class="token punctuation">)</span> <span class="token operator">*</span> y1<span class="token punctuation">;</span>              <span class="token keyword">return</span> gcd<span class="token punctuation">;</span>          <span class="token punctuation">}</span>        ```     ### æ¬§æ‹‰å‡½æ•°ï¼šå°äºxçš„æ•´æ•°ä¸­ä¸xäº’è´¨çš„æ•°çš„ä¸ªæ•°<span class="token punctuation">]</span>        æ±‚å‡ºå•ä¸ªæ•°çš„æ¬§æ‹‰å‡½æ•°  <span class="token function">f</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=</span> `n <span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">/</span> p1<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">/</span> p2a<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>````cpp        <span class="token keyword">int</span> <span class="token function">phi</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">int</span> res<span class="token operator">=</span>x<span class="token punctuation">;</span>          <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>x<span class="token operator">/</span>i<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token operator">%</span>i<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          res<span class="token operator">=</span>res<span class="token operator">/</span>i<span class="token operator">*</span><span class="token punctuation">(</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">while</span><span class="token punctuation">(</span>x<span class="token operator">%</span>i<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> x<span class="token operator">/=</span>i<span class="token punctuation">;</span>          <span class="token punctuation">}</span>          <span class="token punctuation">}</span>          <span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span> res<span class="token operator">=</span>res<span class="token operator">/</span>x<span class="token operator">*</span><span class="token punctuation">(</span>x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> res<span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ol><p>ç­›æ³•ï¼šæ±‚å‡º1-næ¯ä¸ªæ•°çš„æ¬§æ‹‰å‡½æ•°ï¼Œåœ¨çº¿æ€§ç­›æ³•çš„æ¨¡æ¿ä¸­åŠ ä¸Šä¸‰è¡Œ</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> primes<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> cnt<span class="token punctuation">;</span>     <span class="token comment">// primes[]å­˜å‚¨æ‰€æœ‰ç´ æ•°  </span><span class="token keyword">int</span> euler<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>           <span class="token comment">// å­˜å‚¨æ¯ä¸ªæ•°çš„æ¬§æ‹‰å‡½æ•°  </span><span class="token keyword">bool</span> st<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>         <span class="token comment">// st[x]å­˜å‚¨xæ˜¯å¦è¢«ç­›æ‰  </span>    <span class="token keyword">void</span> <span class="token function">get_eulers</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span>  <span class="token punctuation">{</span>      euler<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span>      <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>st<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>          <span class="token punctuation">{</span>              primes<span class="token punctuation">[</span>cnt <span class="token operator">++</span> <span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>              euler<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> primes<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> n <span class="token operator">/</span> i<span class="token punctuation">;</span> j <span class="token operator">++</span> <span class="token punctuation">)</span>          <span class="token punctuation">{</span>              <span class="token keyword">int</span> t <span class="token operator">=</span> primes<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*</span> i<span class="token punctuation">;</span>              st<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> primes<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>              <span class="token punctuation">{</span>                  euler<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> euler<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> primes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                  <span class="token keyword">break</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span>              euler<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> euler<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>primes<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>      <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ¬§æ‹‰å®šç†"><a href="#æ¬§æ‹‰å®šç†" class="headerlink" title="æ¬§æ‹‰å®šç†"></a>æ¬§æ‹‰å®šç†</h3><p>a ^f(n) % n = 1<br>aå’Œnäº’è´¨</p><h3 id="å¿«é€Ÿå¹‚ï¼š"><a href="#å¿«é€Ÿå¹‚ï¼š" class="headerlink" title="å¿«é€Ÿå¹‚ï¼š"></a>å¿«é€Ÿå¹‚ï¼š</h3>  <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">        æŠŠæŒ‡æ•°è½¬ä¸º<span class="token number">2</span>è¿›åˆ¶å°±å¯ä»¥çœ‹å‡ºæ¥æœ‰å“ªäº›å«æœ‰äº†                é¢„å¤„ç†æ—¶æ¯ä¸€ä¸ªç»“æœéƒ½æ˜¯å‰ä¸€ä¸ªçš„å¹³æ–¹å†mod                æ±‚ m<span class="token operator">^</span>k mod pï¼Œæ—¶é—´å¤æ‚åº¦ <span class="token function">O</span><span class="token punctuation">(</span>logk<span class="token punctuation">)</span>ã€‚          â€‹          <span class="token keyword">int</span> <span class="token function">qmi</span><span class="token punctuation">(</span><span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> p<span class="token punctuation">)</span>          <span class="token punctuation">{</span>              <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">%</span> p<span class="token punctuation">,</span> t <span class="token operator">=</span> m<span class="token punctuation">;</span>              <span class="token keyword">while</span> <span class="token punctuation">(</span>k<span class="token punctuation">)</span>              <span class="token punctuation">{</span>                  <span class="token keyword">if</span> <span class="token punctuation">(</span>k<span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span> res <span class="token operator">=</span> res <span class="token operator">*</span> t <span class="token operator">%</span> p<span class="token punctuation">;</span>                  t <span class="token operator">=</span> t <span class="token operator">*</span> t <span class="token operator">%</span> p<span class="token punctuation">;</span>                  k <span class="token operator">&gt;&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span>              <span class="token keyword">return</span> res<span class="token punctuation">;</span>          <span class="token punctuation">}</span>            ```      ### å¿«é€Ÿå¹‚æ±‚é€†å…ƒ```cpp<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">typedef</span> <span class="token keyword">long</span> <span class="token keyword">long</span> LL<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">quick_mi</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span><span class="token keyword">int</span> b<span class="token punctuation">,</span><span class="token keyword">int</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">%</span> p<span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>b<span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span> res <span class="token operator">=</span> <span class="token punctuation">(</span>LL<span class="token punctuation">)</span> res<span class="token operator">*</span>a <span class="token operator">%</span>p<span class="token punctuation">;</span>        b <span class="token operator">&gt;&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>        a <span class="token operator">=</span> <span class="token punctuation">(</span>LL<span class="token punctuation">)</span> a <span class="token operator">*</span> a <span class="token operator">%</span> p<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> res<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> n<span class="token punctuation">;</span>    <span class="token function">scanf</span> <span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> a<span class="token punctuation">,</span>p<span class="token punctuation">;</span>        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>a<span class="token punctuation">,</span><span class="token operator">&amp;</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">%</span> p<span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span><span class="token function">quick_mi</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>p<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">else</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"impossible"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•-ä¸ä¼š"><a href="#æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•-ä¸ä¼š" class="headerlink" title="æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•(ä¸ä¼š)"></a>æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•(ä¸ä¼š)</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">    <span class="token comment">// æ±‚x, yï¼Œä½¿å¾—ax + by = gcd(a, b)  </span>    <span class="token keyword">int</span> <span class="token function">exgcd</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>x<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>y<span class="token punctuation">)</span>      <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>b<span class="token punctuation">)</span>          <span class="token punctuation">{</span>              x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>              <span class="token keyword">return</span> a<span class="token punctuation">;</span>          <span class="token punctuation">}</span>          <span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token function">exgcd</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a <span class="token operator">%</span> b<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>          y <span class="token operator">-=</span> <span class="token punctuation">(</span>a<span class="token operator">/</span>b<span class="token punctuation">)</span> <span class="token operator">*</span> x<span class="token punctuation">;</span>          <span class="token keyword">return</span> d<span class="token punctuation">;</span>      <span class="token punctuation">}</span>```  #### é«˜æ–¯æ¶ˆå…ƒæ±‚è§£æ–¹ç¨‹ç»„çš„è§£ ```cpp <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h&gt;</span>  </span>    <span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>      <span class="token keyword">const</span> <span class="token keyword">int</span> N<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>      <span class="token keyword">int</span> n<span class="token punctuation">;</span>      <span class="token keyword">const</span> <span class="token keyword">double</span> eps<span class="token operator">=</span><span class="token number">1e-6</span><span class="token punctuation">;</span>      <span class="token keyword">double</span> a<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment">// a[N][N]æ˜¯å¢å¹¿çŸ©é˜µ  </span>    <span class="token comment">// a[N][N]æ˜¯å¢å¹¿çŸ©é˜µ  </span>    <span class="token keyword">int</span> <span class="token function">gauss</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span>          <span class="token keyword">int</span> c<span class="token punctuation">,</span> r<span class="token punctuation">;</span>          <span class="token keyword">for</span> <span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> r <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> c <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> c <span class="token operator">++</span> <span class="token punctuation">)</span>          <span class="token punctuation">{</span>              <span class="token keyword">int</span> t <span class="token operator">=</span> r<span class="token punctuation">;</span>              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> r<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span>   <span class="token comment">// æ‰¾åˆ°ç»å¯¹å€¼æœ€å¤§çš„è¡Œ  </span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fabs</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">fabs</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                      t <span class="token operator">=</span> i<span class="token punctuation">;</span>      â€‹              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fabs</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> eps<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>      â€‹              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> c<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// å°†ç»å¯¹å€¼æœ€å¤§çš„è¡Œæ¢åˆ°æœ€é¡¶ç«¯  </span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n<span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> c<span class="token punctuation">;</span> i <span class="token operator">--</span> <span class="token punctuation">)</span> a<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/=</span> a<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment">// å°†å½“å‰è¡Œçš„é¦–ä½å˜æˆ1  </span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span>       <span class="token comment">// ç”¨å½“å‰è¡Œå°†ä¸‹é¢æ‰€æœ‰çš„åˆ—æ¶ˆæˆ0  </span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fabs</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> eps<span class="token punctuation">)</span>                      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> n<span class="token punctuation">;</span> j <span class="token operator">&gt;=</span> c<span class="token punctuation">;</span> j <span class="token operator">--</span> <span class="token punctuation">)</span>                          a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-=</span> a<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">;</span>      â€‹              r <span class="token operator">++</span> <span class="token punctuation">;</span>          <span class="token punctuation">}</span>      â€‹          <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">&lt;</span> n<span class="token punctuation">)</span>          <span class="token punctuation">{</span>              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> r<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span>                  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fabs</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> eps<span class="token punctuation">)</span>                      <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// æ— è§£  </span>            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// æœ‰æ— ç©·å¤šç»„è§£  </span>        <span class="token punctuation">}</span>      â€‹          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">--</span> <span class="token punctuation">)</span>              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> j <span class="token operator">++</span> <span class="token punctuation">)</span>                  a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">-=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>      â€‹          <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// æœ‰å”¯ä¸€è§£  </span>    <span class="token punctuation">}</span>      <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          cin<span class="token operator">&gt;&gt;</span>n<span class="token punctuation">;</span>          <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>              <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                  cin<span class="token operator">&gt;&gt;</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span>      â€‹      <span class="token keyword">int</span> t<span class="token operator">=</span><span class="token function">gauss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">if</span><span class="token punctuation">(</span>t<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>              <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.2lf "</span><span class="token punctuation">,</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span>          <span class="token punctuation">}</span>          <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>t<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span> cout<span class="token operator">&lt;&lt;</span><span class="token string">"æ— è§£"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>          <span class="token keyword">else</span> cout<span class="token operator">&lt;&lt;</span><span class="token string">"æœ‰æ— æ•°ç»„è§£"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>          <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é€’æ¨æ±‚ç»„åˆæ•°ï¼Œdpæ³•-é€‚åˆè¯¢é—®æ¬¡æ•°-gt-10w"><a href="#é€’æ¨æ±‚ç»„åˆæ•°ï¼Œdpæ³•-é€‚åˆè¯¢é—®æ¬¡æ•°-gt-10w" class="headerlink" title="é€’æ¨æ±‚ç»„åˆæ•°ï¼Œdpæ³• é€‚åˆè¯¢é—®æ¬¡æ•°>10w"></a>é€’æ¨æ±‚ç»„åˆæ•°ï¼Œdpæ³• é€‚åˆè¯¢é—®æ¬¡æ•°&gt;10w</h3> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// c[a][b] è¡¨ç¤ºä»aä¸ªè‹¹æœä¸­é€‰bä¸ªçš„æ–¹æ¡ˆæ•°  </span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> i<span class="token punctuation">;</span> j <span class="token operator">++</span> <span class="token punctuation">)</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>j<span class="token punctuation">)</span> c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token keyword">else</span> c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>c<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> c<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é€šè¿‡é¢„å¤„ç†é€†å…ƒçš„æ–¹å¼æ±‚ç»„åˆæ•°-è¯¢é—®1w"><a href="#é€šè¿‡é¢„å¤„ç†é€†å…ƒçš„æ–¹å¼æ±‚ç»„åˆæ•°-è¯¢é—®1w" class="headerlink" title="é€šè¿‡é¢„å¤„ç†é€†å…ƒçš„æ–¹å¼æ±‚ç»„åˆæ•° è¯¢é—®1w"></a>é€šè¿‡é¢„å¤„ç†é€†å…ƒçš„æ–¹å¼æ±‚ç»„åˆæ•° è¯¢é—®1w</h4><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">    é¦–å…ˆé¢„å¤„ç†å‡ºæ‰€æœ‰é˜¶ä¹˜å–æ¨¡çš„ä½™æ•°fact<span class="token punctuation">[</span>N<span class="token punctuation">]</span>ï¼Œä»¥åŠæ‰€æœ‰é˜¶ä¹˜å–æ¨¡çš„é€†å…ƒinfact<span class="token punctuation">[</span>N<span class="token punctuation">]</span>      å¦‚æœå–æ¨¡çš„æ•°æ˜¯è´¨æ•°ï¼Œå¯ä»¥ç”¨è´¹é©¬å°å®šç†æ±‚é€†å…ƒ      <span class="token keyword">int</span> <span class="token function">qmi</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> p<span class="token punctuation">)</span>    <span class="token comment">// å¿«é€Ÿå¹‚æ¨¡æ¿  </span>    <span class="token punctuation">{</span>          <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token keyword">while</span> <span class="token punctuation">(</span>k<span class="token punctuation">)</span>          <span class="token punctuation">{</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> res <span class="token operator">=</span> <span class="token punctuation">(</span>LL<span class="token punctuation">)</span>res <span class="token operator">*</span> a <span class="token operator">%</span> p<span class="token punctuation">;</span>              a <span class="token operator">=</span> <span class="token punctuation">(</span>LL<span class="token punctuation">)</span>a <span class="token operator">*</span> a <span class="token operator">%</span> p<span class="token punctuation">;</span>              k <span class="token operator">&gt;&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>          <span class="token keyword">return</span> res<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      â€‹      <span class="token comment">// é¢„å¤„ç†é˜¶ä¹˜çš„ä½™æ•°å’Œé˜¶ä¹˜é€†å…ƒçš„ä½™æ•°  </span>    fact<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> infact<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span>      <span class="token punctuation">{</span>          fact<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>LL<span class="token punctuation">)</span>fact<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> i <span class="token operator">%</span> mod<span class="token punctuation">;</span>          infact<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>LL<span class="token punctuation">)</span>infact<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token function">qmi</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> mod <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> mod<span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      â€‹```    ### Lucaså®šç†æ±‚ç»„åˆæ•° <span class="token number">20</span>æ¬¡è¯¢é—®ä»¥ä¸‹    <span class="token operator">!</span><span class="token punctuation">[</span>image<span class="token operator">-</span><span class="token number">20230519193526425</span><span class="token punctuation">]</span><span class="token punctuation">(</span>file<span class="token operator">:</span><span class="token comment">//D:/typora%E7%94%A8%E5%9B%BE/Screenshots/image-20230519193526425.png?lastModify=1694256669)    </span>```cpp      <span class="token comment">//è‹¥pæ˜¯è´¨æ•°ï¼Œåˆ™å¯¹äºä»»æ„æ•´æ•° 1 &lt;= m &lt;= nï¼Œæœ‰ï¼š  </span>      <span class="token comment">//  C(n, m) = C(n % p, m % p) * C(n / p, m / p) (mod p)  </span>    â€‹      <span class="token keyword">int</span> <span class="token function">qmi</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> p<span class="token punctuation">)</span>  <span class="token comment">// å¿«é€Ÿå¹‚æ¨¡æ¿  </span>    <span class="token punctuation">{</span>          <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">%</span> p<span class="token punctuation">;</span>          <span class="token keyword">while</span> <span class="token punctuation">(</span>k<span class="token punctuation">)</span>          <span class="token punctuation">{</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> res <span class="token operator">=</span> <span class="token punctuation">(</span>LL<span class="token punctuation">)</span>res <span class="token operator">*</span> a <span class="token operator">%</span> p<span class="token punctuation">;</span>              a <span class="token operator">=</span> <span class="token punctuation">(</span>LL<span class="token punctuation">)</span>a <span class="token operator">*</span> a <span class="token operator">%</span> p<span class="token punctuation">;</span>              k <span class="token operator">&gt;&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>          <span class="token keyword">return</span> res<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      â€‹      <span class="token keyword">int</span> <span class="token function">C</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> p<span class="token punctuation">)</span>  <span class="token comment">// é€šè¿‡å®šç†æ±‚ç»„åˆæ•°C(a, b)  </span>    <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&lt;</span> b<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>      â€‹          LL x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// xæ˜¯åˆ†å­ï¼Œyæ˜¯åˆ†æ¯  </span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> a<span class="token punctuation">,</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> b<span class="token punctuation">;</span> i <span class="token operator">--</span><span class="token punctuation">,</span> j <span class="token operator">++</span> <span class="token punctuation">)</span>          <span class="token punctuation">{</span>              x <span class="token operator">=</span> <span class="token punctuation">(</span>LL<span class="token punctuation">)</span>x <span class="token operator">*</span> i <span class="token operator">%</span> p<span class="token punctuation">;</span>              y <span class="token operator">=</span> <span class="token punctuation">(</span>LL<span class="token punctuation">)</span> y <span class="token operator">*</span> j <span class="token operator">%</span> p<span class="token punctuation">;</span>          <span class="token punctuation">}</span>      â€‹          <span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token punctuation">(</span>LL<span class="token punctuation">)</span><span class="token function">qmi</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> p <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">%</span> p<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      â€‹      <span class="token keyword">int</span> <span class="token function">lucas</span><span class="token punctuation">(</span>LL a<span class="token punctuation">,</span> LL b<span class="token punctuation">,</span> <span class="token keyword">int</span> p<span class="token punctuation">)</span>      <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&lt;</span> p <span class="token operator">&amp;&amp;</span> b <span class="token operator">&lt;</span> p<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">C</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> <span class="token punctuation">(</span>LL<span class="token punctuation">)</span><span class="token function">C</span><span class="token punctuation">(</span>a <span class="token operator">%</span> p<span class="token punctuation">,</span> b <span class="token operator">%</span> p<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">lucas</span><span class="token punctuation">(</span>a <span class="token operator">/</span> p<span class="token punctuation">,</span> b <span class="token operator">/</span> p<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">%</span> p<span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="file://D:/typora%E7%94%A8%E5%9B%BE/Screenshots/image-20230519193254443.png?lastModify=1694256669" alt="image-20230519193254443"></p><h3 id="é€†å…ƒï¼š"><a href="#é€†å…ƒï¼š" class="headerlink" title="é€†å…ƒï¼š"></a>é€†å…ƒï¼š</h3><p>å¯ä»¥åœ¨å¿«é€Ÿå¹‚ä¸­æ±‚å‡º</p><p>ä¹Ÿå°±æ˜¯açš„p-2æ¬¡æ–¹çš„</p><blockquote><p>åœ¨æ¨¡ä¸ºç´ æ•°pçš„æƒ…å†µä¸‹ï¼Œæœ‰è´¹é©¬å°å®šç† a^(p-1)=1ï¼ˆmod pï¼‰ é‚£ä¹ˆa^(p-2)=a^-1(mod p) ä¹Ÿå°±æ˜¯è¯´açš„é€†å…ƒä¸ºa^(p-2)</p></blockquote><h4 id="åˆ†è§£è´¨å› æ•°æ³•æ±‚ç»„åˆæ•°"><a href="#åˆ†è§£è´¨å› æ•°æ³•æ±‚ç»„åˆæ•°" class="headerlink" title="åˆ†è§£è´¨å› æ•°æ³•æ±‚ç»„åˆæ•°"></a>åˆ†è§£è´¨å› æ•°æ³•æ±‚ç»„åˆæ•°</h4><p> &nbsp; </p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">    å½“æˆ‘ä»¬éœ€è¦æ±‚å‡ºç»„åˆæ•°çš„çœŸå®å€¼ï¼Œè€Œéå¯¹æŸä¸ªæ•°çš„ä½™æ•°æ—¶ï¼Œåˆ†è§£è´¨å› æ•°çš„æ–¹å¼æ¯”è¾ƒå¥½ç”¨ï¼š          <span class="token number">1.</span> ç­›æ³•æ±‚å‡ºèŒƒå›´å†…çš„æ‰€æœ‰è´¨æ•°          <span class="token number">2.</span> é€šè¿‡ <span class="token function">C</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span> a<span class="token operator">!</span> <span class="token operator">/</span> b<span class="token operator">!</span> <span class="token operator">/</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token operator">!</span> è¿™ä¸ªå…¬å¼æ±‚å‡ºæ¯ä¸ªè´¨å› å­çš„æ¬¡æ•°ã€‚ n<span class="token operator">!</span> ä¸­pçš„æ¬¡æ•°æ˜¯ n <span class="token operator">/</span> p <span class="token operator">+</span> n <span class="token operator">/</span> p<span class="token operator">^</span><span class="token number">2</span> <span class="token operator">+</span> n <span class="token operator">/</span> p<span class="token operator">^</span><span class="token number">3</span> <span class="token operator">+</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>          <span class="token number">3.</span> ç”¨é«˜ç²¾åº¦ä¹˜æ³•å°†æ‰€æœ‰è´¨å› å­ç›¸ä¹˜            <span class="token keyword">int</span> primes<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> cnt<span class="token punctuation">;</span>     <span class="token comment">// å­˜å‚¨æ‰€æœ‰è´¨æ•°  </span>    <span class="token keyword">int</span> sum<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// å­˜å‚¨æ¯ä¸ªè´¨æ•°çš„æ¬¡æ•°  </span>    <span class="token keyword">bool</span> st<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// å­˜å‚¨æ¯ä¸ªæ•°æ˜¯å¦å·²è¢«ç­›æ‰</span>    <span class="token keyword">void</span> <span class="token function">get_primes</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span>      <span class="token comment">// çº¿æ€§ç­›æ³•æ±‚ç´ æ•°  </span>â€¢        <span class="token punctuation">{</span>  â€¢            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span>  â€¢            <span class="token punctuation">{</span>  â€¢                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>st<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> primes<span class="token punctuation">[</span>cnt <span class="token operator">++</span> <span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>  â€¢                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> primes<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> n <span class="token operator">/</span> i<span class="token punctuation">;</span> j <span class="token operator">++</span> <span class="token punctuation">)</span>  â€¢                <span class="token punctuation">{</span>  â€¢                    st<span class="token punctuation">[</span>primes<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  â€¢                    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> primes<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>  â€¢                <span class="token punctuation">}</span>  â€¢            <span class="token punctuation">}</span>  â€¢        <span class="token punctuation">}</span>  â€‹  â€‹  â€¢          â€¢        <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> p<span class="token punctuation">)</span>       <span class="token comment">// æ±‚nï¼ä¸­çš„æ¬¡æ•°  </span>â€¢        <span class="token punctuation">{</span>  â€¢            <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  â€¢            <span class="token keyword">while</span> <span class="token punctuation">(</span>n<span class="token punctuation">)</span>  â€¢            <span class="token punctuation">{</span>  â€¢                res <span class="token operator">+=</span> n <span class="token operator">/</span> p<span class="token punctuation">;</span>  â€¢                n <span class="token operator">/=</span> p<span class="token punctuation">;</span>  â€¢            <span class="token punctuation">}</span>  â€¢            <span class="token keyword">return</span> res<span class="token punctuation">;</span>  â€¢        <span class="token punctuation">}</span>  â€‹  â€‹  â€¢          â€¢        vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">mul</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span>       <span class="token comment">// é«˜ç²¾åº¦ä¹˜ä½ç²¾åº¦æ¨¡æ¿  </span>â€¢        <span class="token punctuation">{</span>  â€¢            vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> c<span class="token punctuation">;</span>  â€¢            <span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  â€¢            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> a<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span>  â€¢            <span class="token punctuation">{</span>  â€¢                t <span class="token operator">+=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">;</span>  â€¢                c<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>t <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  â€¢                t <span class="token operator">/=</span> <span class="token number">10</span><span class="token punctuation">;</span>  â€¢            <span class="token punctuation">}</span>  â€¢          â€¢            <span class="token keyword">while</span> <span class="token punctuation">(</span>t<span class="token punctuation">)</span>  â€¢            <span class="token punctuation">{</span>  â€¢                c<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>t <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  â€¢                t <span class="token operator">/=</span> <span class="token number">10</span><span class="token punctuation">;</span>  â€¢            <span class="token punctuation">}</span>  â€¢          â€¢            <span class="token keyword">return</span> c<span class="token punctuation">;</span>  â€¢        <span class="token punctuation">}</span>  â€¢            <span class="token function">get_primes</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// é¢„å¤„ç†èŒƒå›´å†…çš„æ‰€æœ‰è´¨æ•°  </span>          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cnt<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span>     <span class="token comment">// æ±‚æ¯ä¸ªè´¨å› æ•°çš„æ¬¡æ•°  </span>    <span class="token punctuation">{</span>          <span class="token keyword">int</span> p <span class="token operator">=</span> primes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>          sum<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">get</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">get</span><span class="token punctuation">(</span>a <span class="token operator">-</span> b<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>            vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> res<span class="token punctuation">;</span>      res<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cnt<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span>     <span class="token comment">// ç”¨é«˜ç²¾åº¦ä¹˜æ³•å°†æ‰€æœ‰è´¨å› å­ç›¸ä¹˜  </span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> sum<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> j <span class="token operator">++</span> <span class="token punctuation">)</span>              res <span class="token operator">=</span> <span class="token function">mul</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> primes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p></p><h2 id="åŠ¨æ€è§„åˆ’DP"><a href="#åŠ¨æ€è§„åˆ’DP" class="headerlink" title="åŠ¨æ€è§„åˆ’DP"></a>åŠ¨æ€è§„åˆ’DP</h2><p>æ€è·¯ï¼š</p><ol><li><p>çŠ¶æ€è¡¨ç¤ºï¼šéœ€è¦å‡ ç»´çš„åŠ¨æ€è§„åˆ’</p><ul><li><p>é›†åˆ æ‰€æœ‰é€‰æ³•</p><ol><li><p>æ‰€æœ‰é€‰æ³•</p></li><li><p>æ¡ä»¶</p><ul><li><p>åªä»å‰iä¸ªç‰©å“ä¸­é€‰æ‹©</p></li><li><p>æ€»ä½“ç§¯&lt;=j</p></li></ul></li></ol></li><li><p>å±æ€§ æœ€å¤§å€¼ï¼Ÿæœ€å°å€¼?â€¦â€¦</p></li></ul></li><li><p>çŠ¶æ€è®¡ç®—ï¼šæ€ä¹ˆå¾—åˆ°ç»“æœ</p></li></ol><h3 id="01èƒŒåŒ…-æ¯ä¸ªç‰©å“åªèƒ½ç”¨ä¸€æ¬¡"><a href="#01èƒŒåŒ…-æ¯ä¸ªç‰©å“åªèƒ½ç”¨ä¸€æ¬¡" class="headerlink" title="01èƒŒåŒ… æ¯ä¸ªç‰©å“åªèƒ½ç”¨ä¸€æ¬¡"></a>01èƒŒåŒ… æ¯ä¸ªç‰©å“åªèƒ½ç”¨ä¸€æ¬¡</h3><p>ä¸€ç»´ä¼˜åŒ–;</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">///f[N][N] è¡¨ç¤ºå‰iä¸ªç‰©å“ï¼Œjçš„å®¹é‡ä¸‹çš„æœ€å¤§å€¼  </span>è¿›è¡Œå‹ç¼©ï¼Œå› ä¸ºæ¯æ¬¡æ›´æ–°iæ˜¯æ—¶åªç”¨åˆ°äº†i<span class="token operator">-</span><span class="token number">1</span> è¿™ä¸ªä½ç½®çš„æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨æ»šåŠ¨æ•°ç»„ï¼Œå®ç°æ¯æ¬¡i<span class="token operator">-</span><span class="token number">1</span>åˆ°içš„æ›´æ–°<span class="token punctuation">;</span>  æ‰€ä»¥ç¼–æˆ  f<span class="token punctuation">[</span>N<span class="token punctuation">]</span> è¡¨ç¤ºjçš„èƒŒåŒ…å®¹é‡ä¸‹çš„æœ€å¤§å€¼<span class="token punctuation">;</span>  j<span class="token operator">=</span><span class="token number">0</span>çš„ç»“æœéƒ½ä¸º<span class="token number">0</span> æ‰€ä»¥å¯ä»¥è·³è¿‡<span class="token punctuation">;</span>i<span class="token operator">=</span><span class="token number">0</span>çš„ç»“æœä¹Ÿéƒ½ä¸º<span class="token number">0</span><span class="token punctuation">,</span>åŒæ—¶ï¼Œå¦‚æœå½“å‰çš„èƒŒåŒ…å®¹é‡ä¸è¶³ä»¥æŠŠå½“å‰ç‰©å“è£…å…¥ä¹Ÿä¸éœ€è¦è¿›è¡Œæ›´æ–°äº†ï¼Œæ‰€ä»¥å°äºå½“å‰èƒŒåŒ…å®¹é‡çš„å°±ä¸è¦è€ƒè™‘äº†<span class="token punctuation">;</span>  ä¸èƒ½æ›´æ–°ä¹Ÿå°±æ˜¯f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span>f<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> æ‰€ä»¥å¯ä»¥ç›´æ¥å»æ‰ï¼Œå˜ä¸º  f<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span>f<span class="token punctuation">[</span>j<span class="token punctuation">]</span>  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//éè§ˆç‰©å“  </span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>m<span class="token punctuation">;</span>j<span class="token operator">&gt;=</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>j<span class="token operator">--</span><span class="token punctuation">)</span><span class="token comment">//mä¸ºæœ€å¤§èƒŒåŒ…å®¹é‡  </span>        f<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">max</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>f<span class="token punctuation">[</span>j<span class="token operator">-</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¤šçŠ¶æ€dp"><a href="#å¤šçŠ¶æ€dp" class="headerlink" title="å¤šçŠ¶æ€dp"></a>å¤šçŠ¶æ€dp</h2><p>ç¤ºä¾‹ï¼š<br><a href="https://www.lanqiao.cn/problems/2223/learning/?subject_code=2&amp;group_code=4&amp;match_num=13&amp;match_flow=2&amp;origin=cup">é­”æ³•èƒŒåŒ…</a><br><a href="https://www.lanqiao.cn/problems/2224/learning/?subject_code=2&amp;group_code=4&amp;match_num=13&amp;match_flow=2&amp;origin=cup">ä¿®è·¯</a><br><a href="https://www.lanqiao.cn/problems/3542/learning/?subject_code=2&amp;group_code=4&amp;match_num=14&amp;match_flow=1&amp;origin=cup">é­”æ³•é˜µ</a><br>å­˜åœ¨å¤šä¸ªçŠ¶æ€ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªçŠ¶æ€å†…çš„è½¬ç§»æ˜¯æ­£å¸¸è½¬ç§»çš„ï¼Œè€ŒçŠ¶æ€ä¹‹é—´æ˜¯éœ€è¦æ»¡è¶³æ¡ä»¶è¿›è¡Œè½¬ç§»çš„ã€‚</p><h3 id="å®Œå…¨èƒŒåŒ…-æ¯ä»¶ç‰©å“æœ‰æ— é™ä¸ª"><a href="#å®Œå…¨èƒŒåŒ…-æ¯ä»¶ç‰©å“æœ‰æ— é™ä¸ª" class="headerlink" title="å®Œå…¨èƒŒåŒ… æ¯ä»¶ç‰©å“æœ‰æ— é™ä¸ª"></a>å®Œå…¨èƒŒåŒ… æ¯ä»¶ç‰©å“æœ‰æ— é™ä¸ª</h3><p>01èƒŒåŒ…ï¼šä»f[i-1]è½¬è¿‡æ¥ f[i,h]=max(f[i-1,j],f[i-1,j-v]+w[i]) //ä¼˜åŒ–å:f[j]=max(f[j],f[v-v[i]]+w[i])</p><p>å®Œå…¨èƒŒåŒ…ï¼šä»f[i]è½¬ç§» f[i,j]=max(f[i-1,j],f[i,j-v[i]]+w[i])</p><p>æ¯æ¬¡æ›´æ–°ï¼škæ˜¯æ¯ä¸ªç‰©å“å¯ä»¥æœ‰å¤šå°‘ä¸ªï¼Œiæ˜¯å‰iä¸ªç‰©å“ï¼Œjæ˜¯å½“å‰èƒŒåŒ…å®¹é‡</p><p>f[i][j]=max(f[i][j],f[i-j][j-v[i]*k]+w[i]*k</p><p>ä¼˜åŒ–æ€è·¯ï¼š</p><p><img src="file://D:/typora%E7%94%A8%E5%9B%BE/Screenshots/image-20230521084412853.png?lastModify=1694256669" alt="image-20230521084412853"></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">â€‹  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> m <span class="token punctuation">;</span> j <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// for (int k = 0 ; k * v[i] &lt;= j ; k ++) {</span>            <span class="token comment">//     f[i][j] = max(f[i][j],f[i - 1][j - k *v[i]] + k * w[i]);</span>            <span class="token comment">// }</span>            <span class="token comment">//f[i][j] = max(f[i-1][j],f[i-1][j-v]+w,f[i-1][j-2v] + 2w , ......)</span>            <span class="token comment">//f[i][j-v] = max(        ,f[i-1][j-v],f[i-1][j-2v]+2w,....)</span>            <span class="token comment">//é”™ä½ç›¸å‡</span>            <span class="token comment">// f[i][j] - f[i][j-v] = w</span>            <span class="token comment">// f[i][j] = f[i][j-v] + w</span>            <span class="token comment">//æ‰€ä»¥ </span>            <span class="token comment">//f[i][j] = max(f[i-1][j],f[i][j-v] + w)</span>            <span class="token comment">//æ ¹æ®é€’æ¨ï¼Œæ¯ä¸€ä¸ªmaxåé¢é‚£ä¸ªæ•°éƒ½ç­‰äºä¸Šä¸€ä¸ªçš„f[i][j-v] + w</span>            <span class="token comment">//å‰ææ˜¯è¦å¤§äºv[i]ç­‰å¼æ‰æˆç«‹</span>            f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> f<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//å‰ä¸€ä¸ªè½¬ç§»</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;=</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">-</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span>w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>ä¸€ç»´ä¼˜åŒ–ï¼šåˆ å»ä¸€ç»´<span class="token comment">//f[i][j]=f[i-1][j];  f[i]==f[i-1] ç›´æ¥åˆ å»  </span>â€‹  <span class="token comment">//if(j&gt;=v[i]){ åªæœ‰å½“å‰èƒŒåŒ…å®¹é‡å¤§äºå½“å‰çš„ç‰©å“æ—¶æ‰èƒ½è£…å…¥ï¼Œé‡‡ç”¨ä»v[i]éå†èƒŒåŒ…å®¹é‡  </span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>j<span class="token operator">&lt;=</span>m<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>      <span class="token comment">//f[i,j]=max(f[i-1,j],f[i,j-v[i]]+w[i])  </span>        f<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">max</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>f<span class="token punctuation">[</span>j<span class="token operator">-</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span>w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//}  </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>01å’Œå®Œå…¨èƒŒåŒ…åŒºåˆ«ï¼š</p><p>èƒŒåŒ…å®¹é‡çš„éå†ä¸åŒ</p><p>01:</p><p> for(int j=m;j&gt;=v[i];jâ€“)//mä¸ºæœ€å¤§èƒŒåŒ…å®¹é‡<br>        f[j]=max(f[j],f[j-v[i]+w[i]]);</p><p>å®Œå…¨ï¼š</p><p>for(int j=v[i],j&lt;=m;j++)<br>        f[j]=max(f[j],f[j-v[i]]+w[i]);</p><h3 id="å¤šé‡èƒŒåŒ…é—®é¢˜-ä¼˜åŒ–"><a href="#å¤šé‡èƒŒåŒ…é—®é¢˜-ä¼˜åŒ–" class="headerlink" title="å¤šé‡èƒŒåŒ…é—®é¢˜ ä¼˜åŒ–"></a>å¤šé‡èƒŒåŒ…é—®é¢˜ ä¼˜åŒ–</h3><p>æ¯ä¸ªç‰©å“æœ‰ä¸ªæ•°é™åˆ¶ï¼Œä½†ä¸æ˜¯æ— é™</p><ol><li><p>çŠ¶æ€è¡¨ç¤ºï¼šf[ i ] [ j ]</p><ul><li><p>é›†åˆ</p></li><li><p>å±æ€§</p></li></ul></li><li><p>çŠ¶æ€è®¡ç®—ï¼š</p><p> f[i][j]=max(f[i-1][j-v[i]*k]+w[i]*k)  kæœ‰èŒƒå›´</p><p> ä¼˜åŒ–ï¼šå°†æ•°é‡æ‰“åŒ…ï¼Œæ¯”å¦‚æ‰“åŒ…æˆ1ä¸ªç‰©å“ä¸€èµ·ï¼Œ2ä¸ªç‰©å“ä¸€èµ·â€¦â€¦</p><p> ä¹‹åç”¨01èƒŒåŒ…åšå³å¯</p></li></ol><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h&gt;</span>  </span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>  <span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">1001</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> f<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span>v<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span>w<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">int</span> n<span class="token punctuation">,</span>m<span class="token punctuation">,</span>cnt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>      cin<span class="token operator">&gt;&gt;</span>n<span class="token operator">&gt;&gt;</span>m<span class="token punctuation">;</span>      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">int</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>s<span class="token punctuation">;</span><span class="token comment">//å®¹é‡ï¼Œä»·å€¼  </span>        cin<span class="token operator">&gt;&gt;</span>a<span class="token operator">&gt;&gt;</span>b<span class="token operator">&gt;&gt;</span>s<span class="token punctuation">;</span>          <span class="token keyword">int</span> k<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//ç”¨æ¥æ‰“åŒ…  </span>        <span class="token keyword">while</span><span class="token punctuation">(</span>k<span class="token operator">&lt;=</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span>              cnt<span class="token operator">++</span><span class="token punctuation">;</span>              v<span class="token punctuation">[</span>cnt<span class="token punctuation">]</span><span class="token operator">=</span>a<span class="token operator">*</span>k<span class="token punctuation">;</span>              w<span class="token punctuation">[</span>cnt<span class="token punctuation">]</span><span class="token operator">=</span>b<span class="token operator">*</span>k<span class="token punctuation">;</span>              s<span class="token operator">-=</span>k<span class="token punctuation">;</span>              k<span class="token operator">*=</span><span class="token number">2</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>          <span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>              cnt<span class="token operator">++</span><span class="token punctuation">;</span>              v<span class="token punctuation">[</span>cnt<span class="token punctuation">]</span><span class="token operator">=</span>a<span class="token operator">*</span>s<span class="token punctuation">;</span>              w<span class="token punctuation">[</span>cnt<span class="token punctuation">]</span><span class="token operator">=</span>b<span class="token operator">*</span>s<span class="token punctuation">;</span>          <span class="token punctuation">}</span>      <span class="token punctuation">}</span>      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>cnt<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>m<span class="token punctuation">;</span>j<span class="token operator">&gt;=</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>j<span class="token operator">--</span><span class="token punctuation">)</span>          f<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">max</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>f<span class="token punctuation">[</span>j<span class="token operator">-</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span>w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ†ç»„èƒŒåŒ…é—®é¢˜"><a href="#åˆ†ç»„èƒŒåŒ…é—®é¢˜" class="headerlink" title="åˆ†ç»„èƒŒåŒ…é—®é¢˜"></a>åˆ†ç»„èƒŒåŒ…é—®é¢˜</h3><h2 id="çº¿æ€§DP"><a href="#çº¿æ€§DP" class="headerlink" title="çº¿æ€§DP"></a>çº¿æ€§DP</h2><p>é€’å½’æ–¹ç¨‹æœ‰çº¿æ€§å…³ç³»ï¼Œå…·æœ‰æ±‚çš„å…ˆåé¡ºåº</p><p>å…·ä½“æœ‰å„ç§å­åºåˆ—</p><p>å»ºè®®çœ‹leetcode101 é‡Œé¢çš„æ¯”è¾ƒå¥½</p><h1 id="æ•°ä½ç»Ÿè®¡DP"><a href="#æ•°ä½ç»Ÿè®¡DP" class="headerlink" title="æ•°ä½ç»Ÿè®¡DP"></a>æ•°ä½ç»Ÿè®¡DP</h1><p>ç»™å‡ºä¸¤ä¸ªæ•°å­— a, b</p><p>ç»Ÿè®¡aåˆ°b ä¸­æ¯ä¸€ä½ çš„0~9çš„å‡ºç°æ¬¡æ•°</p><p>æ€è·¯ï¼šåˆ†æƒ…å†µè®¨è®º + å‰ç¼€å’Œæ€æƒ³</p><p><img src="file://D:/typora%E7%94%A8%E5%9B%BE/Screenshots/image-20230524164849922.png?lastModify=1694256669" alt="image-20230524164849922"></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">include <span class="token operator">&lt;</span>iostream<span class="token operator">&gt;</span>  <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">include</span> <span class="token string">&lt;cmath&gt;</span>  </span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">dgt</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token comment">// è®¡ç®—æ•´æ•°næœ‰å¤šå°‘ä½  </span><span class="token punctuation">{</span>      <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">++</span> res<span class="token punctuation">,</span> n <span class="token operator">/=</span> <span class="token number">10</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> res<span class="token punctuation">;</span>  <span class="token punctuation">}</span>    <span class="token keyword">int</span> <span class="token function">cnt</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token comment">// è®¡ç®—ä»1åˆ°nçš„æ•´æ•°ä¸­æ•°å­—iå‡ºç°å¤šå°‘æ¬¡   </span><span class="token punctuation">{</span>      <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> d <span class="token operator">=</span> <span class="token function">dgt</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span> j <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">// ä»å³åˆ°å·¦ç¬¬jä½ä¸Šæ•°å­—iå‡ºç°å¤šå°‘æ¬¡ï¼Œæ‰€æœ‰ä½ä¸Šçš„æ¬¡æ•°åŠ èµ·æ¥å°±æ˜¯iå‡ºç°çš„æ€»æ¬¡æ•°  </span>    <span class="token punctuation">{</span>          <span class="token comment">// lå’Œræ˜¯ç¬¬jä½å·¦è¾¹å’Œå³è¾¹çš„æ•´æ•° (è§†é¢‘ä¸­çš„abcå’Œefg); djæ˜¯ç¬¬jä½çš„æ•°å­—  </span>        <span class="token keyword">int</span> p <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> l <span class="token operator">=</span> n <span class="token operator">/</span> p <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">,</span> r <span class="token operator">=</span> n <span class="token operator">%</span> p<span class="token punctuation">,</span> dj <span class="token operator">=</span> n <span class="token operator">/</span> p <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>          <span class="token comment">// è®¡ç®—ç¬¬jä½å·¦è¾¹çš„æ•´æ•°å°äºl (è§†é¢‘ä¸­xxx = 000 ~ abc - 1)çš„æƒ…å†µ  </span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span> res <span class="token operator">+=</span> l <span class="token operator">*</span> p<span class="token punctuation">;</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>i <span class="token operator">&amp;&amp;</span> l<span class="token punctuation">)</span> res <span class="token operator">+=</span> <span class="token punctuation">(</span>l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> p<span class="token punctuation">;</span> <span class="token comment">// å¦‚æœi = 0, å·¦è¾¹é«˜ä½ä¸èƒ½å…¨ä¸º0(è§†é¢‘ä¸­xxx = 001 ~ abc - 1)ï¼Œå¹¶ä¸”&amp;&amp;lè¡¨ç¤ºè¿™æ—¶iä¹Ÿä¸èƒ½åœ¨æœ€é«˜ä½å‡ºç°ã€‚  </span>        <span class="token comment">// è®¡ç®—ç¬¬jä½å·¦è¾¹çš„æ•´æ•°ç­‰äºl (è§†é¢‘ä¸­xxx = abc)çš„æƒ…å†µ  </span>        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>dj <span class="token operator">&gt;</span> i<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>i <span class="token operator">||</span> l<span class="token punctuation">)</span> <span class="token punctuation">)</span> res <span class="token operator">+=</span> p<span class="token punctuation">;</span>  <span class="token comment">//(i || l)è¡¨ç¤ºi=0æ—¶ï¼Œiä¸èƒ½å‡ºç°åœ¨æœ€é«˜ä½ï¼ˆå³lä¸èƒ½ä¸º0ï¼‰ï¼Œå› ä¸ºè¿™ç§æ•°æ˜¯ä¸å­˜åœ¨çš„  </span>        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>dj <span class="token operator">==</span> i<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>i <span class="token operator">||</span> l<span class="token punctuation">)</span> <span class="token punctuation">)</span> res <span class="token operator">+=</span> r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//(i || l)è¡¨ç¤ºi=0æ—¶ï¼Œiä¸èƒ½å‡ºç°åœ¨æœ€é«˜ä½ï¼ˆå³lä¸èƒ½ä¸º0ï¼‰ï¼Œå› ä¸ºè¿™ç§æ•°æ˜¯ä¸å­˜åœ¨çš„  </span>    <span class="token punctuation">}</span>      <span class="token keyword">return</span> res<span class="token punctuation">;</span>  <span class="token punctuation">}</span>    <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>      <span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>cin <span class="token operator">&gt;&gt;</span> a <span class="token operator">&gt;&gt;</span> b <span class="token punctuation">,</span> a<span class="token punctuation">)</span>      <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&gt;</span> b<span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token operator">++</span> i<span class="token punctuation">)</span> cout <span class="token operator">&lt;&lt;</span> <span class="token function">cnt</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">cnt</span><span class="token punctuation">(</span>a <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token char">' '</span><span class="token punctuation">;</span>          cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="æ•°ä½DP-é‡è¦"><a href="#æ•°ä½DP-é‡è¦" class="headerlink" title="æ•°ä½DP(é‡è¦)"></a>æ•°ä½DP(é‡è¦)</h1><p>DPæ—¶é—´å¤æ‚åº¦ï¼šçŠ¶æ€ä¸ªæ•°*è½¬ç§»ä¸ªæ•°</p><p>ç›¸å½“äºå¾€ç©ºé‡Œå¡«æ•°å­—</p><p><strong>çŸ¥è¯†ç‚¹1ï¼š</strong>maské›†åˆ</p><blockquote><p>é›†åˆå’Œæ•°å­—çš„æ›¿æ¢ï¼Œä½¿ç”¨äºŒè¿›åˆ¶è½¬åŒ–é›†åˆæ¥å®ç°æŸäº›æ•°å­—ä¸é€‰æ‹©</p><p>ä¾‹ï¼š 10011 ä»é«˜åˆ°ä½ä¾æ¬¡ä»£è¡¨è€… 4 3 2 1 0 è¿™å‡ ä¸ªæ•°å­—é€‰ä¸é€‰ï¼Œ1è¡¨ç¤ºé€‰æ‹©ï¼Œé‚£ä¹ˆï¼Œ</p><p>é›†åˆmask &gt;&gt; d &amp; 1 dä¸ºè¿™ä¸ªæ•°å­—ï¼Œè¿›è¡Œè¿™æ ·çš„è¿ç®—å°±å¯ä»¥åˆ¤æ–­mask å¯¹åº”çš„dæ•°å­—è¿™ä¸ªä½ç½®ä¸Šæ˜¯1è¿˜æ˜¯0</p><p>åŒç† mask|(1&lt;&lt;d) å°†1ç§»ä½åˆ°maskä¸Š ä»£è¡¨dè¿™ä¸ªæ•°å­—çš„ä½ç½®ï¼Œè¿›è¡Œæˆ–è¿ç®—ï¼Œå³å¯å°†dåŠ å…¥é›†åˆä¸­</p></blockquote><h2 id="æ¨¡æ¿ï¼š-1"><a href="#æ¨¡æ¿ï¼š-1" class="headerlink" title="æ¨¡æ¿ï¼š"></a>æ¨¡æ¿ï¼š</h2><p>å°†é—®é¢˜è½¬åŒ–ä¸ºå¡«æ•°å­—å—é™é—®é¢˜ï¼š</p><blockquote><p>é€’å½’ä¸­çš„å˜é‡ï¼š</p><p>i å½“å‰ä¸‹æ ‡ å½“ i == æœ€å¤§é•¿åº¦æ—¶ï¼Œæ ¹æ®æ˜¯å¦æ»¡è¶³æ¡ä»¶è¿”å› 0 æˆ– 1</p><p>mask é›†åˆ ä»£è¡¨ç€ä¸€ç§çŠ¶æ€çš„è®°å½•ï¼Œæ¯”å¦‚æŸä½å¡«äº†å“ªäº›æ•°å­—ï¼Œæˆ–è€…æˆªæ­¢åˆ°ä¸Šä¸€ä½å·²ç»ç§¯ç´¯çš„æŸä¸ªè¦æ±‚æ»¡è¶³æ¡ä»¶çš„æ•°æ®æ˜¯å¤šå°‘ï¼Œè¿™ä¸ªä¸€èˆ¬æ˜¯å˜åŒ–çš„</p><p>is_limit å‰ä¸€ä¸ªä½ç½®æ˜¯å¦æ”¶åˆ°åŸæ¥çš„æ•°å­—çš„é™åˆ¶ï¼š123 ç¬¬ä¸€ä¸ªå¡«1 äº†åé¢ä¸€å®šå—é™ï¼ŒåŒæ—¶å¦‚æœå‰é¢å—é™äº†ï¼Œé‚£ä¹ˆåé¢æ‰€æœ‰çš„éƒ½å—é™</p><p>is_num å‰ä¸€ä¸ªä½ç½®æ˜¯å¦å¡«æ•°å­—ï¼Œå¦‚æœå‰ä¸€ä¸ªæ²¡å¡«æ•°å­—ï¼Œé‚£ä¹ˆè¿™ä¸€ä½æ— æ³•å¡«0äº†ï¼Œå¦‚æœå¡«äº†å¯ä»¥å¡«ä»»æ„æ•°å­—ï¼Œå½“0å¯¹é¢˜ç›®æ²¡å½±å“æ—¶ï¼Œå¯ä»¥ä¸ç”¨è¿™ä¸ªä¸œè¥¿</p></blockquote><p><strong>æ¨¡æ¿å…¬å¼ï¼š</strong></p><ol><li><p>æ±‚å‡ºæœ€å¤§é•¿åº¦å’Œmemoï¼Œè®°å¿†æ•°ç»„ï¼Œå¹¶åˆå§‹åŒ–ä¸º-1 memoæ•°ç»„çš„ä¸€ç»´æ˜¯é•¿åº¦ï¼ŒäºŒç»´æ˜¯èƒ½åŒ…å«æ‰€æœ‰æšä¸¾çš„æœ€å¤§é•¿åº¦ï¼Œå…·ä½“é—®é¢˜å…·ä½“åˆ†æ</p></li><li><p>é€’å½’å‡½æ•°</p><ul><li><p>ç»“æŸé€’å½’æ¡ä»¶<code>i == m è¿”å›æ˜¯å¦æ»¡è¶³ æ»¡è¶³ä¸º1 æ»¡è¶³ä¸º0</code></p></li><li><p>è®°å¿†åŒ–å‰ªæï¼šå½“is_limit å’Œ is_num åªæœ‰ä¸€ä¸ªä¸ºçœŸæ—¶ï¼Œåé¢çš„æ•°å­—ä¹Ÿæ˜¯å¯ä»¥ä»»æ„å¡«çš„ï¼Œæ‰€ä»¥å¯ä»¥å‰ªæ</p></li><li><p><code>!is_limit &amp;&amp; is_num &amp;&amp; memo[i][mask] != -1 return memo[i][mask]</code></p></li><li><p>è®¾å‡ºres = 0 å³ä¸ºæˆ‘ä»¬è¦æ±‚çš„ç­”æ¡ˆ</p></li><li><p>(å¯èƒ½ä¸å­˜åœ¨è¿™ç§æƒ…å†µ)è¿™ä¸€ä½ä¸å¡«æ•°å­—ï¼š<code>res = (i+1 , maskä¸æ”¹å˜, false , false)</code></p></li><li><p>æ±‚å‡ºè¿™ä¸€ä½æ•°å­—å¯ä»¥å¡«å†™çš„ä¸Šä¸‹ç•Œï¼šæ ¹æ®is_limitæ¥æ±‚ <code>up = is_limit ? s[i] - '0' : 9</code></p></li><li><p>æšä¸¾è¿™ä¸€ä½æ•°å­—ï¼Œè¿›è¡Œé€’å½’ (æ¡ä»¶åˆ¤æ–­ä¸ä¸€å®šéœ€è¦)</p></li><li><p><code>for (int d = åˆå§‹ ; d &lt;= up ; d++) if(å½“å‰è¿™ä¸ªæ•°å­—æ²¡ä½¿ç”¨) æŠŠè¿™ä¸ªæ•°å­—åŠ å…¥mask</code></p></li><li><p>å¾ªç¯å†…ï¼š<code>res = (i+1 , mask çš„æ”¹å˜ , is_limit &amp;&amp; d == up , is_numçš„å˜åŒ–)</code></p></li><li><p>å½“is_limit å’Œ is_num åªæœ‰ä¸€ä¸ªä¸ºçœŸæ—¶å°†ç­”æ¡ˆåŠ å…¥memoä¸­ <code>if(!is_limit &amp;&amp; is_num) memo[i][mask] = res</code></p></li><li><p>è¿”å›res</p></li></ul></li></ol><p><strong>ä¾‹é¢˜ï¼š</strong></p><ol><li><a href="https://leetcode.cn/problems/numbers-with-repeated-digits/description/">1012. è‡³å°‘æœ‰ 1 ä½é‡å¤çš„æ•°å­— - åŠ›æ‰£ï¼ˆLeetcodeï¼‰</a></li></ol><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>  <span class="token keyword">public</span><span class="token operator">:</span>      <span class="token keyword">int</span> <span class="token function">numDupDigitsAtMostN</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment">//å°†nè½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œæ–¹ä¾¿æšä¸¾æ¯ä¸€ä½ç½®ä¸Šçš„æ•°å­—  </span>        <span class="token keyword">auto</span> s <span class="token operator">=</span><span class="token function">to_string</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä½¿ç”¨auto é˜²æ­¢çˆ†int  </span>        <span class="token comment">//è®°å¿†åŒ–æ•°ç»„ï¼Œå½“dpåˆ°ç›¸åŒçš„æƒ…å†µæ—¶ç›´æ¥å¯ä»¥ä½¿ç”¨ä»¥å‰çš„çš„å‡ºæ¥çš„  </span>        <span class="token comment">//ç¬¬ä¸€ç»´ä¸ºé•¿åº¦  </span>        <span class="token comment">//ç¬¬äºŒä½ä»£è¡¨å¯ä»¥é€‰æ‹©çš„æ•°å­—æœ‰å“ªäº›  </span>        <span class="token comment">//è¿™é¢˜ä»é«˜åˆ°ä½æ¯ä¸€ä½ä»£è¡¨ç€ 9876543210 æ‰€ä»¥éœ€è¦ç§»åŠ¨åˆ°ç¬¬11ä½ï¼Œæ‰èƒ½å‡ºç°10ä¸ªæ•°å­—éƒ½é€‰æ‹©çš„æƒ…å†µ  </span>        <span class="token keyword">int</span> m <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>memo<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          <span class="token function">memset</span><span class="token punctuation">(</span>memo<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">,</span><span class="token keyword">sizeof</span> memo<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//-1è¡¨ç¤ºæ²¡æœ‰è®¡ç®—è¿‡è¿™ç§æƒ…å†µ  </span>        <span class="token comment">//é€’å½’å‡½æ•°  </span>        function<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">bool</span><span class="token punctuation">,</span><span class="token keyword">bool</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token punctuation">,</span><span class="token keyword">int</span> mask<span class="token punctuation">,</span> <span class="token keyword">bool</span> is_limit <span class="token punctuation">,</span> <span class="token keyword">bool</span> is_num<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">int</span> <span class="token punctuation">{</span>              <span class="token comment">//i ä¸‹æ ‡  </span>            <span class="token comment">//mask æ˜¯è®°å½•å½“å‰å·²ç»é€‰æ‹©æ•°å­—çš„é›†åˆ  </span>            <span class="token comment">//is_limit ä»£è¡¨å½“å‰ä½ç½®æ˜¯å¦å—åˆ°nè¿™ä¸ªæ•°å­—çš„åˆ¶çº¦ï¼Œæ¯”å¦‚ä¸èƒ½è¶…è¿‡æŸä¸ªæ•°å­—  </span>            <span class="token comment">//is_num ä»£è¡¨å‰ä¸€ä½æ˜¯å¦å¡«æ•°å­—äº†ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥åˆ¤æ–­0æ˜¯å¦å¯å¡«çš„ï¼Œå¦‚æœ0å¯ä¸å¯å¡«éƒ½æ— æ‰€è°“å°±å¯ä»¥ä¸ä½¿ç”¨è¿™ä¸ªäº†  </span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> m<span class="token punctuation">)</span> <span class="token comment">//å¦‚æœdpåˆ°äº†æœ€åä¸€ä¸ªä½ç½®äº†ï¼Œè¦è¿”å›æ˜¯å¦å¾—åˆ°åˆæ³•æ•°å­—äº†  </span>                 <span class="token keyword">return</span> is_num<span class="token punctuation">;</span><span class="token comment">//åˆæ³•æ•°å­—ä¸€å®šä¸ºtrueï¼Œå› ä¸ºé•¿åº¦åˆ°äº†å‰ä¸€ä¸ªä¸€å®šè¦å¡«æ•°å­—çš„  </span>            <span class="token comment">//å¦‚æœæ²¡æ”¶åˆ°é™åˆ¶æˆ–è€…æ²¡æ”¶åˆ°å‰ä¸€ä¸ªçš„å¡«æ•°å­—çš„é™åˆ¶ï¼Œåé¢å¯ä»¥ä»»æ„å¡«äº†ï¼Œæ‰€ä»¥å¿…å®šä¼šæœ‰å¾ˆå°é‡å¤æ€§çš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è¿”å›  </span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>is_limit <span class="token operator">&amp;&amp;</span> is_num <span class="token operator">&amp;&amp;</span>memo<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>mask<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> memo<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>mask<span class="token punctuation">]</span><span class="token punctuation">;</span>              <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>is_num<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//å‰ä¸€ä¸ªæ•°å­—æ²¡å¡«ï¼Œè¿™ä¸ªæ•°å­—å½“ç„¶ä¹Ÿå¯ä»¥ä¸å¡«  </span>                res <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">,</span> mask <span class="token punctuation">,</span> <span class="token boolean">false</span> <span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">//ç»§ç»­é€’å½’  </span>            <span class="token punctuation">}</span>              <span class="token comment">//å¦‚æœå½“å‰æ•°å­—æ²¡æ”¶åˆ°é™åˆ¶ï¼Œé‚£ä¹ˆå½“ç„¶å¯ä»¥ç»§ç»­ä»»æ„å¡«  </span>            <span class="token comment">//å¦‚æœæ”¶åˆ°é™åˆ¶äº†ï¼Œé‚£ä¹ˆæœ€å¤šåªèƒ½å¡«å½“å‰è¿™ä¸€ä½ç½®ä¸Šçš„æ•°å­—  </span>            <span class="token keyword">int</span> up <span class="token operator">=</span> is_limit <span class="token operator">?</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token char">'0'</span> <span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">;</span>              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> is_num <span class="token punctuation">;</span> d <span class="token operator">&lt;=</span> up <span class="token punctuation">;</span> <span class="token operator">++</span>d<span class="token punctuation">)</span>                  <span class="token comment">//æšä¸¾å¯ä»¥å¡«å…¥çš„æ•°æ®ï¼Œå‰ä¸€ä½æ²¡å¡«æ•°å­— ï¼Œé‚£ä¹ˆè¿™ä¸€ä½åªèƒ½ä»1å¼€å§‹ï¼Œå¦åˆ™å¯ä»¥ä»0å¼€å§‹ï¼Œé‚£ä¹ˆå¯ä»¥å¡«0ï¼Œå¦‚æœæ²¡è¢«é™åˆ¶ï¼Œé‚£ä¹ˆè¦å°å¿ƒæ˜¯å¦æ˜¯ç¬¬ä¸€ä½äº†ï¼Œæ‰€ä»¥ä»1å¼€å§‹  </span>                <span class="token comment">//å½“d == up æ—¶ï¼Œ  </span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mask <span class="token operator">&gt;&gt;</span> d <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// d ä¸åœ¨ mask ä¸­  </span>                <span class="token comment">//d != up æ—¶ï¼Œæ‰€æœ‰çš„åé¢çš„ä½ç½®éƒ½ä¸ä¼šå—é™  </span>                <span class="token comment">//d == up æ—¶ï¼Œå¦‚æœå‰ä¸€ä½å·²ç»å—é™äº†ï¼Œé‚£ä¹ˆåé¢è¿˜ä¼šæ¥ç€å—é™  </span>                    res <span class="token operator">+=</span> <span class="token function">f</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> mask <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> d<span class="token punctuation">)</span><span class="token punctuation">,</span> is_limit <span class="token operator">&amp;&amp;</span> d <span class="token operator">==</span> up<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                               <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>is_limit <span class="token operator">&amp;&amp;</span> is_num<span class="token punctuation">)</span>              <span class="token comment">//å¦‚æœæ²¡æ”¶åˆ°é™åˆ¶æˆ–è€…æ²¡æ”¶åˆ°å‰ä¸€ä¸ªçš„å¡«æ•°å­—çš„é™åˆ¶ï¼Œåé¢å¯ä»¥ä»»æ„å¡«äº†  </span>                memo<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>mask<span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>              <span class="token keyword">return</span> res<span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> n <span class="token operator">-</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç¬¬ä¸€ä¸ªæ•°å­—è‚¯å®šå—é™äº†  </span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token number">2.</span> <span class="token punctuation">[</span><span class="token number">6396.</span> ç»Ÿè®¡æ•´æ•°æ•°ç›® <span class="token operator">-</span> åŠ›æ‰£ï¼ˆLeetcodeï¼‰<span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token operator">:</span><span class="token comment">//leetcode.cn/problems/count-of-integers/description/) ä¸€ç§å˜å½¢ï¼Œå¥½å¥½ç†è§£</span>    <span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>      <span class="token keyword">public</span><span class="token operator">:</span>          <span class="token keyword">const</span> <span class="token keyword">int</span> mod <span class="token operator">=</span> <span class="token number">1e9</span> <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">;</span>          <span class="token keyword">int</span> <span class="token function">cmp</span><span class="token punctuation">(</span>string s <span class="token punctuation">,</span> <span class="token keyword">int</span> min_sum <span class="token punctuation">,</span> <span class="token keyword">int</span> max_sum<span class="token punctuation">)</span><span class="token punctuation">{</span>              <span class="token comment">//memoæ•°ç»„æœ€å¤§æœ‰ nä¸ª9 æˆ–è€…æ˜¯è¢«è¿«çš„è¿™ä¸ªæœ€å¤§æ•°å­— è®°å¾— + 1  </span>            <span class="token keyword">int</span> n <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> memo<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token operator">*</span>n<span class="token punctuation">,</span>max_sum<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>              <span class="token function">memset</span><span class="token punctuation">(</span>memo <span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">,</span> <span class="token keyword">sizeof</span> memo<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">//å› ä¸º0æ— å½±å“ï¼Œæ‰€ä»¥is_numå¯ä»¥ä¸è¦äº†  </span>            <span class="token comment">//sum å°±æ˜¯mask  </span>            function <span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token punctuation">,</span><span class="token keyword">bool</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token punctuation">,</span> <span class="token keyword">int</span> sum <span class="token punctuation">,</span> <span class="token keyword">bool</span> is_limit<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">int</span> <span class="token punctuation">{</span>              <span class="token comment">//1.éæ³•æƒ…å†µ  </span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">&gt;</span> max_sum<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//ç»“æŸé€’å½’ï¼Œsumæ˜¯ä¸€ç›´å¢åŠ çš„ï¼Œåé¢æ— æ³•å‡å°çš„  </span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> n<span class="token punctuation">)</span> <span class="token keyword">return</span> sum <span class="token operator">&gt;=</span> min_sum<span class="token punctuation">;</span><span class="token comment">//ç»“æŸé€’å½’çš„æ—¶å€™å¦‚æœæ•°å­—åˆæ³•ä¸”æ»¡è¶³  </span>            <span class="token comment">//å°‘äº†ä¸€ä¸ªis_num,åªè¦åé¢ä¸å—é™åˆ¶ï¼Œé‚£ä¹ˆï¼Œåé¢ä¸€å®šé‡å¤  </span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>is_limit <span class="token operator">&amp;&amp;</span> memo<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>sum<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> memo<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>sum<span class="token punctuation">]</span><span class="token punctuation">;</span>              <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> <span class="token comment">//è®¡ç®—æ‰€è¦çš„ç­”æ¡ˆï¼Œä¹Ÿå°±æ˜¯è®¡æ•°  </span>            <span class="token keyword">int</span> up <span class="token operator">=</span> is_limit <span class="token operator">?</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token char">'0'</span> <span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">;</span><span class="token comment">//ä¸Šç•Œ  </span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> d <span class="token operator">&lt;=</span> up <span class="token punctuation">;</span> d<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//æšä¸¾ä½ç½®ä¸Šçš„æ•°å­—  </span>                <span class="token comment">//d == upçš„æ—¶å€™ï¼Œå¦‚æœå‰é¢å—é™äº†ï¼Œåé¢ç»§ç»­å—é™ï¼Œå¦‚æœå‰é¢æ²¡å—é™ï¼Œé‚£ä¹ˆåé¢ä¹Ÿä¸å—é™  </span>                res <span class="token operator">=</span> <span class="token punctuation">(</span>res <span class="token operator">+</span> <span class="token function">f</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">,</span> sum <span class="token operator">+</span> d  <span class="token punctuation">,</span> is_limit <span class="token operator">&amp;&amp;</span> d <span class="token operator">==</span> up<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span>              <span class="token punctuation">}</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>is_limit<span class="token punctuation">)</span> memo<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>sum<span class="token punctuation">]</span> <span class="token operator">=</span> res <span class="token punctuation">;</span>  <span class="token comment">//ä¸ä¸Šé¢ä¿æŒä¸€è‡´  </span>            <span class="token keyword">return</span> res <span class="token punctuation">;</span><span class="token comment">//è¿”å›ç­”æ¡ˆ  </span>            <span class="token punctuation">}</span><span class="token punctuation">;</span>              <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆå§‹çŠ¶æ€ä¸‹ï¼Œä¸€å®šå—é™  </span>        <span class="token punctuation">}</span>          <span class="token keyword">int</span> <span class="token function">count</span><span class="token punctuation">(</span>string num1<span class="token punctuation">,</span> string num2<span class="token punctuation">,</span> <span class="token keyword">int</span> min_sum<span class="token punctuation">,</span> <span class="token keyword">int</span> max_sum<span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token comment">//è½¬åŒ–ï¼š  </span>            <span class="token comment">/*                  è®¡ç®— &lt;= num2 çš„åˆæ³•æ•°å­—aå’Œ &lt;= num2 çš„åˆæ³•æ•°å­—b ç­”æ¡ˆå°±ç­‰äº a - b                  å¯ä»¥ç›´æ¥è®¡ç®— &lt;= num1 çš„åˆæ³•æ•°å­—ï¼Œæœ€åå•ç‹¬åˆ¤å®š num1æ˜¯å¦åˆæ³•                  å¥—æ¨¡æ¿ï¼š mask åœ¨è¿™é‡ŒæŒ‡çš„æ˜¯å„ä½æ•°å­—ä¹‹å’Œ                  é€’å½’ç»“æŸæ¡ä»¶ï¼š                  sum &gt; max_sum ç›´æ¥è¿”å›0 ï¼Œä¸æˆç«‹ï¼Œå› ä¸ºsumä¸èƒ½å‡å°ï¼Œæ‰€ä»¥ç»§ç»­é€’å½’ä¸‹å»ä¹Ÿæ²¡æœ‰ç”¨                  é€’å½’åˆ°å°±ç»“æŸçš„æ—¶å€™ï¼Œå¦‚æœ sum &gt;= min_sum é‚£ä¹ˆå°±æ˜¯æ»¡è¶³çš„ï¼Œå¯ä»¥ç›´æ¥è¿”å›1äº†                  å‰å¯¼é›¶å¯¹å’Œæ²¡æœ‰å½±å“ï¼Œæ‰€ä»¥isnumå¯ä»¥ä¸ç”¨                  æœ€åï¼šå–æ¨¡è¿ç®—                  (a+b)mod m = ((a mod m) + (b mod m )) mod m                  (a*b)mode m = ((a mod m) * (b mod m )) mod m              */</span>              <span class="token keyword">int</span> ans <span class="token operator">=</span> <span class="token function">cmp</span><span class="token punctuation">(</span>num2 <span class="token punctuation">,</span> min_sum <span class="token punctuation">,</span>max_sum<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">cmp</span><span class="token punctuation">(</span>num1 <span class="token punctuation">,</span> min_sum <span class="token punctuation">,</span>max_sum<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>              <span class="token comment">//æœ€åä¸€ä¸ªnum1å•ç‹¬åˆ¤æ–­ï¼Œå› ä¸ºä¸Šé¢è®¡ç®—çš„æ˜¯ num1 &lt; x &lt;= num2çš„ï¼Œå’Œå‰ç¼€å’Œä¸€æ ·  </span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> c <span class="token operator">:</span> num1<span class="token punctuation">)</span> sum <span class="token operator">+=</span> c <span class="token operator">-</span> <span class="token char">'0'</span><span class="token punctuation">;</span>              ans <span class="token operator">+=</span> min_sum <span class="token operator">&lt;=</span> sum <span class="token operator">&amp;&amp;</span> sum <span class="token operator">&lt;=</span> max_sum <span class="token punctuation">;</span>              <span class="token keyword">return</span> ans <span class="token operator">%</span> mod<span class="token punctuation">;</span>          <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="çŠ¶å‹DP-çŠ¶æ€å‹ç¼©-åŠ¨æ€è§„åˆ’-åˆ©ç”¨äºŒè¿›åˆ¶æŠŠçŠ¶æ€è®°å½•æˆäºŒè¿›åˆ¶æ•°"><a href="#çŠ¶å‹DP-çŠ¶æ€å‹ç¼©-åŠ¨æ€è§„åˆ’-åˆ©ç”¨äºŒè¿›åˆ¶æŠŠçŠ¶æ€è®°å½•æˆäºŒè¿›åˆ¶æ•°" class="headerlink" title="çŠ¶å‹DP çŠ¶æ€å‹ç¼©+åŠ¨æ€è§„åˆ’ åˆ©ç”¨äºŒè¿›åˆ¶æŠŠçŠ¶æ€è®°å½•æˆäºŒè¿›åˆ¶æ•°"></a>çŠ¶å‹DP çŠ¶æ€å‹ç¼©+åŠ¨æ€è§„åˆ’ åˆ©ç”¨äºŒè¿›åˆ¶æŠŠçŠ¶æ€è®°å½•æˆäºŒè¿›åˆ¶æ•°</h2><p>291 91</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æ ‘å½¢DP-å„å±‚é€‰æ‹©å–æœ€å¤§å€¼"><a href="#æ ‘å½¢DP-å„å±‚é€‰æ‹©å–æœ€å¤§å€¼" class="headerlink" title="æ ‘å½¢DP å„å±‚é€‰æ‹©å–æœ€å¤§å€¼"></a>æ ‘å½¢DP å„å±‚é€‰æ‹©å–æœ€å¤§å€¼</h2><p>å°†çŠ¶æ€åˆ†ä¸ºå½“å‰èŠ‚ç‚¹é€‰æ‹©å’Œä¸é€‰æ‹©</p><p><a href="https://www.acwing.com/problem/content/287/">285. æ²¡æœ‰ä¸Šå¸çš„èˆä¼š - AcWingé¢˜åº“</a></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h&gt;</span>  </span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>  <span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">6010</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> happy<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> n<span class="token punctuation">;</span>  <span class="token keyword">int</span> e<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token comment">/*eå­˜çš„æ˜¯ç¼–å·1*/</span> <span class="token punctuation">,</span> ne<span class="token punctuation">[</span>N<span class="token punctuation">]</span> <span class="token punctuation">,</span> idx <span class="token punctuation">,</span>h<span class="token punctuation">[</span>N<span class="token punctuation">]</span> <span class="token punctuation">,</span> dp<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">bool</span> fa<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">/*      çŠ¶æ€å®šä¹‰ï¼šdp[i][1] dp[i][0] å½“å‰èŠ‚ç‚¹é€‰ä¸é€‰      çŠ¶æ€è½¬ç§» ï¼š dp[i][0] = sum(å­æ ‘)   å­æ ‘æœ‰å¯ä»¥åˆ†ä¸ºé€‰ä¸ä¸é€‰  å–æœ€å¤§å€¼                  dp[i][1] = sum(ä¸‹ä¸€å±‚å­æ ‘ä¸é€‰)        å±æ€§ï¼š æœ€å¤§å€¼     */</span>  <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      idx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>      <span class="token function">memset</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">,</span> <span class="token keyword">sizeof</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">{</span>      e<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">;</span>      ne<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> h<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">;</span>      h<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> idx<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">void</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token comment">//å¦‚æœå½“å‰çš„èŠ‚ç‚¹è¦é€‰æ‹©çš„è¯ï¼Œè¦åˆå§‹åŒ–æ•°æ®  </span>        dp<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> happy<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span>          <span class="token comment">//éå†uçš„å­æ ‘  </span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> h<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token punctuation">;</span> i <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">;</span> i <span class="token operator">=</span> ne<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>              <span class="token keyword">int</span> j <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>              <span class="token comment">//é€’å½’åˆ°æœ€ä½å±‚ï¼Œå®ç°ä¸€å±‚å±‚çš„æ±‚å’Œ  </span>            <span class="token function">dfs</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">//å½“å‰ä¸é€‰ï¼Œåˆ™æ˜¯å­æ ‘çš„æœ€å¤§å€¼  </span>            dp<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token function">max</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> dp<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">//å½“å‰é€‰æ‹©ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸‹ä¸€å±‚å­æ ‘ä¸é€‰  </span>            dp<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> dp<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span> <span class="token punctuation">,</span><span class="token operator">&amp;</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>happy<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">int</span> a <span class="token punctuation">,</span> b <span class="token punctuation">;</span>          <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>a<span class="token punctuation">,</span><span class="token operator">&amp;</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>          fa<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>          <span class="token function">add</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">int</span> root <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>      <span class="token keyword">while</span><span class="token punctuation">(</span>fa<span class="token punctuation">[</span>root<span class="token punctuation">]</span><span class="token punctuation">)</span> root<span class="token operator">++</span><span class="token punctuation">;</span>      <span class="token function">dfs</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>root<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>dp<span class="token punctuation">[</span>root<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="çŠ¶æ€æœºï¼š"><a href="#çŠ¶æ€æœºï¼š" class="headerlink" title="çŠ¶æ€æœºï¼š"></a>çŠ¶æ€æœºï¼š</h2><blockquote><p>é€šè¿‡è¡¨ç¤ºå‡ºçŠ¶æ€çš„è½¬æ¢æ–¹å¼å³å¯è‡ªåŠ¨å¾—åˆ°ç­”æ¡ˆ</p></blockquote><h2 id="DPè¡Œ-x2F-åˆ—é—®é¢˜"><a href="#DPè¡Œ-x2F-åˆ—é—®é¢˜" class="headerlink" title="DPè¡Œ/åˆ—é—®é¢˜"></a>DPè¡Œ/åˆ—é—®é¢˜</h2><p><a href="https://leetcode.cn/problems/maximum-strictly-increasing-cells-in-a-matrix/">6456. çŸ©é˜µä¸­ä¸¥æ ¼é€’å¢çš„å•å…ƒæ ¼æ•° - åŠ›æ‰£ï¼ˆLeetcodeï¼‰</a></p><h3 id="ä¾‹é¢˜ï¼šè‚¡ç¥¨ä¹°å–é—®é¢˜"><a href="#ä¾‹é¢˜ï¼šè‚¡ç¥¨ä¹°å–é—®é¢˜" class="headerlink" title="ä¾‹é¢˜ï¼šè‚¡ç¥¨ä¹°å–é—®é¢˜"></a>ä¾‹é¢˜ï¼šè‚¡ç¥¨ä¹°å–é—®é¢˜</h3><p><strong>å«æœ‰å†·å´æ—¶é—´éœ€è¦ç”¨å››ä¸ªçŠ¶æ€ï¼Œæ­£å¸¸ä¸¤ä¸ªå³å¯ï¼Œå…·ä½“é—®é¢˜å…·ä½“åˆ†æ</strong></p><ol><li><p><a href="https://leetcode.cn/problems/best-time-to-buy-and-sell-stock-with-transaction-fee/description/">714. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºå«æ‰‹ç»­è´¹ - åŠ›æ‰£ï¼ˆLeetcodeï¼‰</a></p></li><li><p><a href="https://leetcode.cn/problems/best-time-to-buy-and-sell-stock-with-cooldown/solutions/2283535/zhuang-tai-ji-dp-by-hardcore-dubinsky348-1qew/">309. æœ€ä½³ä¹°å–è‚¡ç¥¨æ—¶æœºå«å†·å†»æœŸ - åŠ›æ‰£ï¼ˆLeetcodeï¼‰</a></p></li></ol><h2 id="é€šè¿‡stoi-å’Œéš”æ¿æ³•å®ç°æšä¸¾æ¯ä¸€ä¸ªæ•°å­—çš„ä»»æ„å­å­ä¸²"><a href="#é€šè¿‡stoi-å’Œéš”æ¿æ³•å®ç°æšä¸¾æ¯ä¸€ä¸ªæ•°å­—çš„ä»»æ„å­å­ä¸²" class="headerlink" title="é€šè¿‡stoi å’Œéš”æ¿æ³•å®ç°æšä¸¾æ¯ä¸€ä¸ªæ•°å­—çš„ä»»æ„å­å­ä¸²"></a>é€šè¿‡stoi å’Œéš”æ¿æ³•å®ç°æšä¸¾æ¯ä¸€ä¸ªæ•°å­—çš„ä»»æ„å­å­ä¸²</h2><p>stoi substr to_string çš„å¦™ç”¨</p><p><a href="https://leetcode.cn/problems/find-the-punishment-number-of-an-integer/">6441. æ±‚ä¸€ä¸ªæ•´æ•°çš„æƒ©ç½šæ•° - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p><h2 id="å­åˆ—å’Œ-x2F-å­—ä¸²é—®é¢˜ï¼š"><a href="#å­åˆ—å’Œ-x2F-å­—ä¸²é—®é¢˜ï¼š" class="headerlink" title="å­åˆ—å’Œ/å­—ä¸²é—®é¢˜ï¼š"></a>å­åˆ—å’Œ/å­—ä¸²é—®é¢˜ï¼š</h2><ol><li><p>æ±‚ä»»æ„å­åˆ—çš„ä¹˜ç§¯æœ€å¤§ <a href="https://leetcode.cn/problems/maximum-strength-of-a-group/">6393. ä¸€ä¸ªå°ç»„çš„æœ€å¤§å®åŠ›å€¼ - åŠ›æ‰£ï¼ˆLeetcodeï¼‰</a></p></li><li><p>ä¸€ä¸ªå­—ç¬¦ä¸²åŒ¹é…å¦ä¸€ä¸ªå­—å…¸æ±‚æœ€å¤§åŒ¹é…é•¿åº¦é—®é¢˜ï¼š<a href="https://leetcode.cn/problems/extra-characters-in-a-string/">6394. å­—ç¬¦ä¸²ä¸­çš„é¢å¤–å­—ç¬¦ - åŠ›æ‰£ï¼ˆLeetcodeï¼‰</a></p></li><li><p>åè½¬01å¾—åˆ°ç›¸ç­‰å­—ç¬¦ä¸²é—®é¢˜ï¼š<a href="https://leetcode.cn/problems/minimum-cost-to-make-all-characters-equal/">6455. ä½¿æ‰€æœ‰å­—ç¬¦ç›¸ç­‰çš„æœ€å°æˆæœ¬ - åŠ›æ‰£ï¼ˆLeetcodeï¼‰</a></p></li></ol><h1 id="æš´åŠ›æšä¸¾æ³•"><a href="#æš´åŠ›æšä¸¾æ³•" class="headerlink" title="æš´åŠ›æšä¸¾æ³•"></a>æš´åŠ›æšä¸¾æ³•</h1><p>ä½¿ç”¨äºç»„åˆçš„æ•°é‡å°‘ï¼Œä½†æ˜¯éœ€è¦æ‰¾åˆ°æœ€åˆé€‚çš„ç»„åˆçš„é¢˜ç›®<br>ä¾‹é¢˜<br><a href="https://leetcode.cn/problems/minimum-moves-to-spread-stones-over-grid/submissions/">3*3</a></p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•ï¼Œæ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaåŸºç¡€</title>
      <link href="/2023/08/27/25/"/>
      <url>/2023/08/27/25/</url>
      
        <content type="html"><![CDATA[<h1 id="é¢è¯•å¸¸é—®ï¼š"><a href="#é¢è¯•å¸¸é—®ï¼š" class="headerlink" title="é¢è¯•å¸¸é—®ï¼š"></a>é¢è¯•å¸¸é—®ï¼š</h1><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><ul><li>æ¦‚å¿µè¾¨åˆ«ï¼š<ul><li>JDK Java Development Kit æ˜¯Javaçš„å¼€å‘å·¥å…·åŒ…ï¼Œæ˜¯Javaçš„ä¸€ä¸ªSDK</li><li>JRE Java Runtime Environment Javaè¿è¡Œç¯å¢ƒ</li><li>SDK Software Development Kit è½¯ä»¶å¼€å‘å·¥å…·åŒ…</li><li>Java9 ä¹‹åéƒ¨åˆ†jdkå’Œjreäº†</li><li>JIT è¿è¡Œæ—¶ç¼–è¯‘ï¼Œå½“JITç¼–è¯‘å™¨ç¬¬ä¸€æ¬¡ç¼–è¯‘ä¹‹åï¼Œä¼šæŠŠå­—èŠ‚ç å¯¹åº”çš„æœºå™¨ç ä¿å­˜ä¸‹æ¥ï¼Œä¸‹æ¬¡å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå¦‚æœæ˜¯çƒ­ç‚¹ä»£ç å°±ä½¿ç”¨JITè¿›è¡Œç¼–è¯‘å¯åŠ¨ï¼Œå¦‚æœä¸æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œå°±ä½¿ç”¨è§£é‡Šå™¨æ¥æ‰§è¡Œã€‚</li><li>AOTï¼šåœ¨ç¨‹åºæ‰§è¡Œå‰å°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œå±äºé™æ€ç¼–è¯‘ã€‚é€‚åˆäº‘åŸç”Ÿåœºæ™¯</li><li><img src="/2023/08/27/25/%E6%AD%BB%E8%80%85%E5%85%B3%E7%B3%BB.png"></li></ul></li><li>åŸºç¡€æ•°æ®ç±»å‹ï¼š<ul><li>== å’Œ equals : == æ¯”è¾ƒçš„æ˜¯å†…å­˜åœ°å€æ˜¯å¦ä¸€è‡´ï¼Œequalsæ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ï¼ŒObjectç±»ä¸­æ²¡æœ‰åŒºåˆ«ï¼ŒStriingï¼ŒIntegerç­‰å°±æœ‰åŒºåˆ«äº†</li><li>åŸºæœ¬æ•°æ®ç±»å‹ï¼šbyte 8bit ,short 16 ,int 32 ,long 64,float 32 ,double 64,boolean 1,char , æ³¨æ„charçš„é»˜è®¤å€¼æ˜¯ <code>\u0000</code> ä¹Ÿå°±æ˜¯è¡¨ç¤ºnullçš„å­—ç¬¦</li><li>StringBufferå¯ä»¥çœ‹ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„StringBuilder</li><li>Mapå’ŒSet:<ul><li>ä¸ºä»€ä¹ˆHashMapçš„é•¿åº¦(æ¡¶çš„æ•°é‡æ˜¯2çš„å¹‚æ¬¡æ–¹)ï¼Œå› ä¸ºå¯ä»¥ä¼˜åŒ–å“ˆå¸Œå€¼çš„åˆ†å¸ƒï¼Œå“ˆå¸Œå€¼ä¸é•¿åº¦-1è¿›è¡Œä½è¿ç®—è€Œä¸æ˜¯å–æ¨¡ï¼Œå¯ä»¥åŠ å¿«æ•ˆç‡ï¼Œä¹Ÿèƒ½åˆ†å¸ƒæ›´å‡åŒ€ï¼Œæ–¹ä¾¿æ‰©å®¹</li><li>HashSetçš„åº•å±‚æ˜¯æ˜¯ç”¨æ¥ä¸€ä¸ªHashMapï¼Œkeyä¸ºsetçš„å…ƒç´ ,valueä¸ºä¸€ä¸ªå›ºå®šçš„Objectå¯¹è±¡</li><li>HashMapçš„æŸ¥è¯¢ï¼šåº•å±‚å®ç°æ•°ç»„+é“¾è¡¨ 1.8ä¹‹åå¤šäº†çº¢é»‘æ ‘<ol><li>æ²¡æœ‰å“ˆå¸Œå†²çªï¼ŒO(1)</li><li>æœ‰å†²çªï¼Œå°±ä¼šæŠŠå†²çªçš„é”®æ”¾åœ¨åŒä¸€ä¸ªæ¡¶çš„é“¾è¡¨ä¸­ï¼Œéœ€è¦æŸ¥è¯¢é“¾è¡¨O(n);</li><li>Java8ä¹‹åï¼Œå½“æ¡¶ä¸­çš„æ•°æ®è¾¾åˆ°ä¸€å®šè§„æ¨¡å°±ä¼šè½¬ä¸ºçº¢é»‘æ ‘ï¼ŒO(logn)</li></ol><ul><li>putæ–¹æ³•ï¼š<ol><li>åˆ¤æ–­keyå¯¹æ•°ç»„tableï¼Œæ˜¯å¦ä¸ºnullï¼Œå¦åˆ™æ‰§è¡Œresizeè¿›è¡Œæ‰©å®¹ï¼ˆåˆå§‹åŒ–ï¼‰</li><li>æ ¹æ®keyè®¡ç®—hashï¼Œå¾—åˆ°æ•°ç»„ç´¢å¼•</li><li>table[i] == null ç›´æ¥æ·»åŠ </li><li>ä¸æˆç«‹ï¼š<ul><li>åˆ¤æ–­table[i] çš„é¦–ä¸ªå…ƒç´ æ˜¯å¦å’Œkeyä¸€æ ·ï¼Œå¦‚æœç›¸åŒç›´æ¥è¦†ç›–value</li><li>table[i] æ˜¯å¦ä¸ºtreeNode ï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Œå¦‚æœæ˜¯ç›´æ¥åœ¨æ ‘ç§æ’å…¥é”®å€¼å¯¹</li><li>éå†table[i] åœ¨å°¾éƒ¨æ’å…¥æ•°æ®ï¼Œå¦‚æœé•¿åº¦å¤§äº8è½¬ä¸ºçº¢é»‘æ ‘</li></ul></li><li>åˆ¤æ–­å®é™…æ•°é‡æ˜¯å¦è¶…è¿‡äº†æœ€å¤§å®¹é‡*0.75ï¼Œå¦‚æœè¶…è¿‡è¿›è¡Œæ‰©å®¹</li></ol></li><li>å¦‚ä½•æ‰©å®¹ï¼š<ul><li>æ¯æ¬¡åˆ°è¾¾æ•°ç»„é•¿åº¦* 0.75æ—¶æ‰©å®¹ï¼Œï¼Œæ¯æ¬¡æ‰©å®¹é•¿åº¦æ˜¯åŸæ¥æœ€å¤§å®¹é‡çš„ä¸¤å€</li><li>æ‰©å®¹ä¹‹åè¦æŠŠè€æ•°ç»„ç§»åˆ°æ–°æ•°ç»„é’Ÿ</li></ul></li><li>å¯»å€ç®—æ³•ï¼š<ul><li>è®¡ç®—å‡ºkeyçš„hashCodeï¼Œç„¶ååœ¨è¿™ä¸ªå€¼å³ç§»16ä½åçš„äºŒè¿›åˆ¶åŠé€†è¡ŒæŒ‰ä½å¼‚æˆ–è¿ç®—ï¼Œå¾—åˆ°çš„hash</li></ul></li></ul></li><li>HashSetå¦‚ä½•æ¯”è¾ƒæ˜¯å¦é‡å¤ï¼šæ ¹æ®hashcodeæ¥æ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œé‚£ä¹ˆå†è°ƒç”¨equalsæ–¹æ³•æ¥æ¯”è¾ƒ</li></ul></li><li>å­—èŠ‚ç ï¼šJVMå¯ä»¥ç†è§£çš„ä»£ç å°±æ˜¯å­—èŠ‚ç ï¼Œä¹Ÿå°±æ˜¯.classæ–‡ä»¶<ul><li>Javaä»£ç å…ˆç»è¿‡ç¼–è¯‘ç”Ÿæˆå­—èŠ‚ç ï¼Œä¹‹åç”±javaè§£é‡Šå™¨æ¥è§£é‡Šæ‰§è¡Œ</li><li>é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹ç‚¹ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€</li><li>æ¯”è¾ƒå¯¹è±¡æ¯”è¾ƒçš„æ˜¯å†…å­˜åœ°å€ï¼Œè€Œequals()æ²¡æœ‰é‡å†™æ—¶ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒçš„åœ°å€</li><li>åºåˆ—åŒ–ï¼šå°†æ•°æ®ç»“æ„æˆ–è€…å¯¹è±¡è½¬æ¢æˆäºŒè¿›åˆ¶å­—èŠ‚æµçš„è¿‡ç¨‹</li><li>åŒ…è£…ç±»å‹çš„å¸¸é‡æ± ï¼šåŒ…è£…ç±»å‹ä¿å­˜äº†ä¸€å®šèŒƒå›´å†…çš„æ‰€æœ‰çš„å®ä¾‹ï¼Œå¯ä»¥å‡å°‘å†…å­˜çš„ä½¿ç”¨</li></ul></li><li>å¼•ç”¨ç±»å‹ï¼š<ol><li>å¼ºå¼•ç”¨ï¼šä½¿ç”¨new </li><li>è½¯å¼•ç”¨ï¼šåªæœ‰è¿™ä¸ªæ–¹å¼æ—¶ï¼Œå†…å­˜ä¸è¶³æ—¶ä¼šè¢«å›æ”¶</li><li>å¼±å¼•ç”¨ï¼šåªæœ‰è¿™ä¸ªæ–¹å¼æ˜¯ï¼Œå†…å­˜é‡ç»„ä¹Ÿä¼šè¢«å›æ”¶</li><li>è™šå¼•ç”¨ï¼šæ— æ³•é€šè¿‡ä»–è·å–å¯¹è±¡</li></ol></li></ul></li><li>IO<ul><li>BIOåŒæ­¥é˜»å¡IOä¸€ç›´ç­‰å¾…å†…æ ¸æŠŠæ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´</li><li>NIOéé˜»å¡IOï¼Œå¯ä»¥çœ‹ä½œå¤šè·¯å¤ç”¨IO</li><li>AIOå¼‚æ­¥IO</li><li>NIOéé˜»å¡IO Nettyä½¿ç”¨</li></ul></li></ul><h3 id="å¤šæ€çš„åŸç†"><a href="#å¤šæ€çš„åŸç†" class="headerlink" title="å¤šæ€çš„åŸç†"></a>å¤šæ€çš„åŸç†</h3><p>åŠ¨æ€ç»‘å®šï¼Œè¿è¡Œæ—¶æ‰å°†æ–¹æ³•è°ƒç”¨å’Œæ–¹æ³•å®ç°å…³è”èµ·æ¥ã€‚</p><h3 id="é™æ€æ–¹æ³•ä¸ºä»€ä¹ˆä¸èƒ½è°ƒç”¨éé™æ€æˆå‘˜"><a href="#é™æ€æ–¹æ³•ä¸ºä»€ä¹ˆä¸èƒ½è°ƒç”¨éé™æ€æˆå‘˜" class="headerlink" title="é™æ€æ–¹æ³•ä¸ºä»€ä¹ˆä¸èƒ½è°ƒç”¨éé™æ€æˆå‘˜"></a>é™æ€æ–¹æ³•ä¸ºä»€ä¹ˆä¸èƒ½è°ƒç”¨éé™æ€æˆå‘˜</h3><blockquote><p>é™æ€æ–¹æ³•åœ¨ç±»åŠ è½½æ—¶å°±ä¼šåˆ†é…å†…å­˜ï¼Œè€Œéé™æ€æˆå‘˜å±äºå®ä¾‹å¯¹è±¡ï¼Œæ‰€ä»¥è°ƒç”¨ä¸åˆ°ï¼Œå±äºéæ³•æ“ä½œ</p></blockquote><h3 id="å­—ç¬¦ä¸²å¸¸é‡æ± "><a href="#å­—ç¬¦ä¸²å¸¸é‡æ± " class="headerlink" title="å­—ç¬¦ä¸²å¸¸é‡æ± "></a>å­—ç¬¦ä¸²å¸¸é‡æ± </h3><blockquote><p>å¯¹äºç¼–è¯‘æœŸå¯ä»¥ç¡®å®šå€¼çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯å¸¸é‡å­—ç¬¦ä¸² ï¼Œjvm ä¼šå°†å…¶å­˜å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚å¹¶ä¸”ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ‹¼æ¥å¾—åˆ°çš„å­—ç¬¦ä¸²å¸¸é‡åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«å­˜æ”¾å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œè¿™ä¸ªå¾—ç›Šäºç¼–è¯‘å™¨çš„ä¼˜åŒ–ã€‚<br><strong>å­—ç¬¦ä¸²ä½¿ç”¨&nbsp;<code>final</code>&nbsp;å…³é”®å­—å£°æ˜ä¹‹åï¼Œå¯ä»¥è®©ç¼–è¯‘å™¨å½“åšå¸¸é‡æ¥å¤„ç†ã€‚</strong></p></blockquote><h3 id="Stringä¸ºä»€ä¹ˆä¸å¯å˜"><a href="#Stringä¸ºä»€ä¹ˆä¸å¯å˜" class="headerlink" title="Stringä¸ºä»€ä¹ˆä¸å¯å˜"></a>Stringä¸ºä»€ä¹ˆä¸å¯å˜</h3><ol><li>Stringä¸­çš„byteæ•°ç»„è¢«privateå’Œfinalä¿®é¥°ï¼Œå¹¶ä¸”æ²¡æœ‰å…·ä½“çš„æ–¹æ³•æš´éœ²</li><li>Stringå¯¹è±¡ä½¿ç”¨finalä¿®é¥°ï¼Œä¸å¯è¢«ç»§æ‰¿ï¼Œä¿è¯ä¸ä¼šè¢«å­ç±»ç ´åä¸å¯å˜æ€§<img src="/2023/08/27/25/String%E4%B8%8D%E5%8F%AF%E5%8F%98.png"></li></ol><h3 id="x3D-x3D-å’Œ-equalsåŒºåˆ«"><a href="#x3D-x3D-å’Œ-equalsåŒºåˆ«" class="headerlink" title="== å’Œ equalsåŒºåˆ«"></a>== å’Œ equalsåŒºåˆ«</h3><p>== ï¼š<br>åŸºæœ¬æ•°æ®ç±»å‹æ˜¯æ¯”è¾ƒçš„å€¼ï¼Œå¯¹è±¡æ¯”è¾ƒçš„æ˜¯åœ°å€<br>equalsï¼š<br>æ²¡é‡å†™çš„è¯æ¯”è¾ƒçš„æ˜¯åœ°å€ï¼ŒStringæ˜¯ä¸“é—¨é‡å†™è¿‡çš„ï¼Œæ¯”è¾ƒçš„æ˜¯å…·ä½“çš„å€¼æ˜¯å¦ç›¸åŒ</p><h3 id="ä¸‰ç§æ‹·è´æ–¹å¼çš„åŒºåˆ«"><a href="#ä¸‰ç§æ‹·è´æ–¹å¼çš„åŒºåˆ«" class="headerlink" title="ä¸‰ç§æ‹·è´æ–¹å¼çš„åŒºåˆ«"></a>ä¸‰ç§æ‹·è´æ–¹å¼çš„åŒºåˆ«</h3><ol><li>å¼•ç”¨æ‹·è´ï¼šä¸åŒçš„å¼•ç”¨æŒ‡å‘ç›¸åŒçš„å¯¹è±¡</li><li>æµ…æ‹·è´ï¼šå¤–éƒ¨å¯¹è±¡æ˜¯new å‡ºæ¥çš„æ–°å¯¹è±¡ï¼Œå†…éƒ¨å¯¹è±¡ä»ç„¶æ˜¯æŒ‡å‘ä¸€ä¸ª</li><li>æ·±æ‹·è´ï¼šå¤–éƒ¨å¯¹è±¡å’Œå†…éƒ¨å¯¹è±¡éƒ½æ˜¯æ–°new å‡ºæ¥çš„<br><img src="/2023/08/27/25/%E4%B8%89%E7%A7%8D%E6%8B%B7%E8%B4%9D%E6%96%B9%E5%BC%8F.png"></li></ol><h3 id="concurrenthashmapå’Œhashmapå’Œhashtableçš„åŒºåˆ«"><a href="#concurrenthashmapå’Œhashmapå’Œhashtableçš„åŒºåˆ«" class="headerlink" title="concurrenthashmapå’Œhashmapå’Œhashtableçš„åŒºåˆ«"></a>concurrenthashmapå’Œhashmapå’Œhashtableçš„åŒºåˆ«</h3><p>HashMapçº¿ç¨‹ä¸å®‰å…¨<br>HashTableå’ŒconcurrentHashMapæ˜¯çº¿ç¨‹å®‰å…¨çš„HashMapï¼ŒHashTableä¸Šé”æ—¶ï¼Œä¼šé”ä½æ•´ä¸ªè¡¨ï¼Œè€ŒConcurrentHashMapåªä¼šé”å¯¹åº”çš„æ®µï¼Œä½¿ç”¨çš„æ˜¯åˆ†æ®µé”ã€‚</p><h3 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h3><h4 id="SerialVersionUID"><a href="#SerialVersionUID" class="headerlink" title="SerialVersionUID"></a>SerialVersionUID</h4><p>å³ä½¿è¢«staticä¿®é¥°ï¼Œä¹Ÿä¼šè¢«åºåˆ—åŒ–è¿›äºŒè¿›åˆ¶æµä¸­ï¼Œç”¨æ¥åˆ¤æ–­åºåˆ—åŒ–å¯¹è±¡çš„ç‰ˆæœ¬ä¸€è‡´æ€§ã€‚</p><h3 id="ä»£ç†"><a href="#ä»£ç†" class="headerlink" title="ä»£ç†"></a>ä»£ç†</h3><p>ä»£ç†æ¨¡å¼æ˜¯ä½¿ç”¨ä»£ç†å¯¹è±¡æ¥æ›¿ä»£çœŸå®å¯¹è±¡ï¼Œä»è€Œåœ¨ä¸ä¿®æ”¹åŸç›®æ ‡çš„å‰æä¸‹æä¾›é¢å¤–çš„åŠŸèƒ½æ“ä½œï¼Œæ‹“å±•å¯¹è±¡åŠŸèƒ½ã€‚</p><h4 id="åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„åŒºåˆ«"><a href="#åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„åŒºåˆ«" class="headerlink" title="åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„åŒºåˆ«"></a>åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„åŒºåˆ«</h4><ol><li>é™æ€ä»£ç†åœ¨ç¼–è¯‘é˜¶æ®µå°±å°†æ¥å£ã€å®ç°ç±»ã€ä»£ç†ç±»éƒ½å˜æˆä¸€ä¸ªä¸ªå®é™…çš„classæ–‡ä»¶ã€‚å¯¹äºæ¯ä¸€ä¸ªè¢«ä»£ç†çš„å¯¹è±¡éƒ½éœ€è¦å•ç‹¬å†™ä¸€ä¸ªä»£ç†ç±»ï¼Œéå¸¸ä¸æ–¹ä¾¿</li><li>åŠ¨æ€ä»£ç†ï¼šæ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆå­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ°JVMä¸­ã€‚æ ¸å¿ƒæ˜¯ <strong><code>InvocationHandler</code>&nbsp;æ¥å£å’Œ&nbsp;<code>Proxy</code>&nbsp;ç±»</strong></li></ol><h3 id="JDKå’ŒCGLIBçš„åŒºåˆ«"><a href="#JDKå’ŒCGLIBçš„åŒºåˆ«" class="headerlink" title="JDKå’ŒCGLIBçš„åŒºåˆ«"></a>JDKå’ŒCGLIBçš„åŒºåˆ«</h3><p>JDKæ˜¯é¢å‘æ¥å£çš„ï¼Œè€ŒCGLibæ˜¯é€šè¿‡ç›´æ¥å—åº•å±‚ç»§æ‰¿è¦ä»£ç†çš„ç±»æ¥å®ç°çš„ï¼Œåº•å±‚æ˜¯asm</p><blockquote><p>Spring AOPçš„åº•å±‚å®ç°ä¸»è¦åŸºäºåŠ¨æ€ä»£ç†æ¨¡å¼ã€‚å…·ä½“æ¥è¯´ï¼Œæœ‰ä¸¤ç§ä¸»è¦çš„å®ç°æ–¹å¼ï¼šJDK åŠ¨æ€ä»£ç†å’Œ CGLIB åŠ¨æ€ä»£ç†ã€‚Spring AOP åœ¨è¿è¡Œæ—¶ä¼šæ ¹æ®ç›®æ ‡å¯¹è±¡çš„ç±»å‹å’Œé…ç½®æ¥é€‰æ‹©ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†è¿˜æ˜¯ CGLIB åŠ¨æ€ä»£ç†ã€‚å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œå¹¶ä¸”æ²¡æœ‰å¼ºåˆ¶è¦æ±‚ä½¿ç”¨ CGLIB ä»£ç†ï¼ŒSpring ä¼šä¼˜å…ˆä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ã€‚å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°æ¥å£ï¼Œæˆ–è€…é€šè¿‡é…ç½®å¼ºåˆ¶ä½¿ç”¨ CGLIB ä»£ç†ï¼Œé‚£ä¹ˆ Spring ä¼šä½¿ç”¨ CGLIB åŠ¨æ€ä»£ç†æ¥å®ç° AOPã€‚</p></blockquote><h3 id="BigDecimalå·¥å…·ç±»"><a href="#BigDecimalå·¥å…·ç±»" class="headerlink" title="BigDecimalå·¥å…·ç±»"></a>BigDecimalå·¥å…·ç±»</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">RoundingMode</span></span><span class="token punctuation">;</span><span class="token comment">/** * ç®€åŒ–BigDecimalè®¡ç®—çš„å°å·¥å…·ç±» */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BigDecimalUtil</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * é»˜è®¤é™¤æ³•è¿ç®—ç²¾åº¦     */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEF_DIV_SCALE</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">BigDecimalUtil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æä¾›ç²¾ç¡®çš„åŠ æ³•è¿ç®—ã€‚     *     * @param v1 è¢«åŠ æ•°     * @param v2 åŠ æ•°     * @return ä¸¤ä¸ªå‚æ•°çš„å’Œ     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">double</span> v1<span class="token punctuation">,</span> <span class="token keyword">double</span> v2<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">BigDecimal</span> b1 <span class="token operator">=</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BigDecimal</span> b2 <span class="token operator">=</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> b1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>b2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æä¾›ç²¾ç¡®çš„å‡æ³•è¿ç®—ã€‚     *     * @param v1 è¢«å‡æ•°     * @param v2 å‡æ•°     * @return ä¸¤ä¸ªå‚æ•°çš„å·®     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">subtract</span><span class="token punctuation">(</span><span class="token keyword">double</span> v1<span class="token punctuation">,</span> <span class="token keyword">double</span> v2<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">BigDecimal</span> b1 <span class="token operator">=</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BigDecimal</span> b2 <span class="token operator">=</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> b1<span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span>b2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æä¾›ç²¾ç¡®çš„ä¹˜æ³•è¿ç®—ã€‚     *     * @param v1 è¢«ä¹˜æ•°     * @param v2 ä¹˜æ•°     * @return ä¸¤ä¸ªå‚æ•°çš„ç§¯     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">double</span> v1<span class="token punctuation">,</span> <span class="token keyword">double</span> v2<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">BigDecimal</span> b1 <span class="token operator">=</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BigDecimal</span> b2 <span class="token operator">=</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> b1<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>b2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æä¾›ï¼ˆç›¸å¯¹ï¼‰ç²¾ç¡®çš„é™¤æ³•è¿ç®—ï¼Œå½“å‘ç”Ÿé™¤ä¸å°½çš„æƒ…å†µæ—¶ï¼Œç²¾ç¡®åˆ°     * å°æ•°ç‚¹ä»¥å10ä½ï¼Œä»¥åçš„æ•°å­—å››èˆäº”å…¥ã€‚     *     * @param v1 è¢«é™¤æ•°     * @param v2 é™¤æ•°     * @return ä¸¤ä¸ªå‚æ•°çš„å•†     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">divide</span><span class="token punctuation">(</span><span class="token keyword">double</span> v1<span class="token punctuation">,</span> <span class="token keyword">double</span> v2<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">divide</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> <span class="token constant">DEF_DIV_SCALE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æä¾›ï¼ˆç›¸å¯¹ï¼‰ç²¾ç¡®çš„é™¤æ³•è¿ç®—ã€‚å½“å‘ç”Ÿé™¤ä¸å°½çš„æƒ…å†µæ—¶ï¼Œç”±scaleå‚æ•°æŒ‡     * å®šç²¾åº¦ï¼Œä»¥åçš„æ•°å­—å››èˆäº”å…¥ã€‚     *     * @param v1    è¢«é™¤æ•°     * @param v2    é™¤æ•°     * @param scale è¡¨ç¤ºè¡¨ç¤ºéœ€è¦ç²¾ç¡®åˆ°å°æ•°ç‚¹ä»¥åå‡ ä½ã€‚     * @return ä¸¤ä¸ªå‚æ•°çš„å•†     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">divide</span><span class="token punctuation">(</span><span class="token keyword">double</span> v1<span class="token punctuation">,</span> <span class="token keyword">double</span> v2<span class="token punctuation">,</span> <span class="token keyword">int</span> scale<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>scale <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span>                    <span class="token string">"The scale must be a positive integer or zero"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token class-name">BigDecimal</span> b1 <span class="token operator">=</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BigDecimal</span> b2 <span class="token operator">=</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> b1<span class="token punctuation">.</span><span class="token function">divide</span><span class="token punctuation">(</span>b2<span class="token punctuation">,</span> scale<span class="token punctuation">,</span> <span class="token class-name">RoundingMode</span><span class="token punctuation">.</span><span class="token constant">HALF_EVEN</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æä¾›ç²¾ç¡®çš„å°æ•°ä½å››èˆäº”å…¥å¤„ç†ã€‚     *     * @param v     éœ€è¦å››èˆäº”å…¥çš„æ•°å­—     * @param scale å°æ•°ç‚¹åä¿ç•™å‡ ä½     * @return å››èˆäº”å…¥åçš„ç»“æœ     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">double</span> v<span class="token punctuation">,</span> <span class="token keyword">int</span> scale<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>scale <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span>                    <span class="token string">"The scale must be a positive integer or zero"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token class-name">BigDecimal</span> b <span class="token operator">=</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BigDecimal</span> one <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">divide</span><span class="token punctuation">(</span>one<span class="token punctuation">,</span> scale<span class="token punctuation">,</span> <span class="token class-name">RoundingMode</span><span class="token punctuation">.</span><span class="token constant">HALF_UP</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æä¾›ç²¾ç¡®çš„ç±»å‹è½¬æ¢(Float)     *     * @param v éœ€è¦è¢«è½¬æ¢çš„æ•°å­—     * @return è¿”å›è½¬æ¢ç»“æœ     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">float</span> <span class="token function">convertToFloat</span><span class="token punctuation">(</span><span class="token keyword">double</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">BigDecimal</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">floatValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æä¾›ç²¾ç¡®çš„ç±»å‹è½¬æ¢(Int)ä¸è¿›è¡Œå››èˆäº”å…¥     *     * @param v éœ€è¦è¢«è½¬æ¢çš„æ•°å­—     * @return è¿”å›è½¬æ¢ç»“æœ     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">convertsToInt</span><span class="token punctuation">(</span><span class="token keyword">double</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">BigDecimal</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æä¾›ç²¾ç¡®çš„ç±»å‹è½¬æ¢(Long)     *     * @param v éœ€è¦è¢«è½¬æ¢çš„æ•°å­—     * @return è¿”å›è½¬æ¢ç»“æœ     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">convertsToLong</span><span class="token punctuation">(</span><span class="token keyword">double</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">BigDecimal</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è¿”å›ä¸¤ä¸ªæ•°ä¸­å¤§çš„ä¸€ä¸ªå€¼     *     * @param v1 éœ€è¦è¢«å¯¹æ¯”çš„ç¬¬ä¸€ä¸ªæ•°     * @param v2 éœ€è¦è¢«å¯¹æ¯”çš„ç¬¬äºŒä¸ªæ•°     * @return è¿”å›ä¸¤ä¸ªæ•°ä¸­å¤§çš„ä¸€ä¸ªå€¼     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">returnMax</span><span class="token punctuation">(</span><span class="token keyword">double</span> v1<span class="token punctuation">,</span> <span class="token keyword">double</span> v2<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">BigDecimal</span> b1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BigDecimal</span> b2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> b1<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>b2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è¿”å›ä¸¤ä¸ªæ•°ä¸­å°çš„ä¸€ä¸ªå€¼     *     * @param v1 éœ€è¦è¢«å¯¹æ¯”çš„ç¬¬ä¸€ä¸ªæ•°     * @param v2 éœ€è¦è¢«å¯¹æ¯”çš„ç¬¬äºŒä¸ªæ•°     * @return è¿”å›ä¸¤ä¸ªæ•°ä¸­å°çš„ä¸€ä¸ªå€¼     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">returnMin</span><span class="token punctuation">(</span><span class="token keyword">double</span> v1<span class="token punctuation">,</span> <span class="token keyword">double</span> v2<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">BigDecimal</span> b1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BigDecimal</span> b2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> b1<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>b2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç²¾ç¡®å¯¹æ¯”ä¸¤ä¸ªæ•°å­—     *     * @param v1 éœ€è¦è¢«å¯¹æ¯”çš„ç¬¬ä¸€ä¸ªæ•°     * @param v2 éœ€è¦è¢«å¯¹æ¯”çš„ç¬¬äºŒä¸ªæ•°     * @return å¦‚æœä¸¤ä¸ªæ•°ä¸€æ ·åˆ™è¿”å›0ï¼Œå¦‚æœç¬¬ä¸€ä¸ªæ•°æ¯”ç¬¬äºŒä¸ªæ•°å¤§åˆ™è¿”å›1ï¼Œåä¹‹è¿”å›-1     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">double</span> v1<span class="token punctuation">,</span> <span class="token keyword">double</span> v2<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">BigDecimal</span> b1 <span class="token operator">=</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BigDecimal</span> b2 <span class="token operator">=</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> b1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>b2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="UnSafeç±»"><a href="#UnSafeç±»" class="headerlink" title="UnSafeç±»"></a>UnSafeç±»</h2><p>æä¾›ä¸€äº›å¾ˆåº•å±‚çš„æ“ä½œï¼ŒJUCä¸­ç»å¸¸ä½¿ç”¨ã€‚<br>æ ¸å¿ƒåŠŸèƒ½ï¼š</p><ol><li>å†…å­˜æ“ä½œ</li><li>[[å¤šçº¿ç¨‹#å†…å­˜å±éšœ|å†…å­˜å±éšœ]]</li><li>å¯¹è±¡æ“ä½œ</li><li>æ•°æ®æ“ä½œ</li><li>CASæ“ä½œ</li><li>çº¿ç¨‹è°ƒåº¦</li><li>Classæ“ä½œ</li><li>ç³»ç»Ÿä¿¡æ¯</li></ol><h2 id="å¹¶å‘ç›¸å…³"><a href="#å¹¶å‘ç›¸å…³" class="headerlink" title="å¹¶å‘ç›¸å…³"></a>å¹¶å‘ç›¸å…³</h2><h3 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h3><h4 id="çº¿ç¨‹æ± çš„åŸç†"><a href="#çº¿ç¨‹æ± çš„åŸç†" class="headerlink" title="çº¿ç¨‹æ± çš„åŸç†"></a>çº¿ç¨‹æ± çš„åŸç†</h4><p>åˆå§‹åŒ–ä¸€ä¸ªçº¿ç¨‹æ± ï¼ŒæŒ‡å®šçº¿ç¨‹æ± çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡<br>ç„¶åæ¯æ¬¡å‘çº¿ç¨‹æ± ä¸­æäº¤ä»»åŠ¡ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¾ªç¯ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å»é™¤ä»»åŠ¡å¹¶ä¸”æ‰§è¡Œ<br>å¦‚æœä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ä¹‹åï¼Œå°±ä¼šå›åˆ°çº¿ç¨‹æ± ï¼Œè€Œä¸æ˜¯é”€æ¯</p><p>çº¿ç¨‹æ± é€šè¿‡å¾ªç¯åˆ©ç”¨çº¿ç¨‹ï¼Œè€Œä¸æ˜¯é”€æ¯é¿å…äº†é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹æ± çš„å¼€é”€</p><h4 id="çº¿ç¨‹æ± ä¸­å…³äºæ—¶é—´çš„å‚æ•°èµ·ä»€ä¹ˆä½œç”¨"><a href="#çº¿ç¨‹æ± ä¸­å…³äºæ—¶é—´çš„å‚æ•°èµ·ä»€ä¹ˆä½œç”¨" class="headerlink" title="çº¿ç¨‹æ± ä¸­å…³äºæ—¶é—´çš„å‚æ•°èµ·ä»€ä¹ˆä½œç”¨"></a>çº¿ç¨‹æ± ä¸­å…³äºæ—¶é—´çš„å‚æ•°èµ·ä»€ä¹ˆä½œç”¨</h4><ol><li>ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼šå½“çº¿ç¨‹ä¸­çš„çº¿ç¨‹æ•°é‡è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°é‡æ—¶ï¼Œè¿™äº›é¢å¤–çš„çº¿ç¨‹åœ¨è¶…è¿‡ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´å°±ä¼šè¢«ä¸­æ­¢</li><li>ä»»åŠ¡è¶…æ—¶æ—¶é—´ï¼šæ‰§è¡Œä»»åŠ¡æ‰§è¡Œçš„æœ€å¤§æ—¶é—´ï¼Œå¦‚æœ</li></ol><ul><li>å¤šçº¿ç¨‹ï¼š<ul><li>çº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆï¼š<ul><li>ArrayList,HashMap,HashSet,LinkedListç­‰<ul><li>ArrayListçš„å®ç°ï¼š<ul><li>addæ–¹æ³•ï¼šç¡®ä¿æ•°ç»„åœ¨å·²ä½¿ç”¨é•¿åº¦(size) + 1ä¹‹åèƒ½å¤Ÿå­˜ä¸‹æ´—ä¸€ä¸ªæ•°æ®</li><li>è®¡ç®—æ•°ç»„çš„å®¹é‡ï¼Œå¦‚æœå½“å‰æ•°ç»„å·²ä½¿ç”¨çš„é•¿åº¦+1åçš„å¤§äºå½“å‰æ•°ç»„çš„é•¿åº¦ï¼Œä½¿ç”¨growæ–¹æ³•æ‰©å®¹ï¼Œæ‰©å¤§çº¦1.5å€</li><li>ç¡®ä¿æ–°å¢çš„æ•°æ®æœ‰åœ°æ–¹å­˜å‚¨ä¹‹åå¥–æ–°å…ƒç´ åŠ åˆ°ä½äºsizeçš„ä½ç½®ä¸Š</li><li>è¿”å›boolå€¼</li></ul></li><li>ArrayList list=new ArrayList(10)ä¸­çš„list ä¸ä¼šæ‰©å®¹</li><li>ä½¿ç”¨asListåï¼ŒåŸæ•°ç»„ä¿®æ”¹ä¼šæ”¹å˜æ–°ç”Ÿæˆçš„Listï¼Œå› ä¸ºä»–ä»¬æœ€ç»ˆæŒ‡å‘çš„éƒ½æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€</li><li>å¦‚ä½•å¤„ç†linkedlistå’Œarraylistçš„çº¿ç¨‹ä¸å®‰å…¨ï¼š<ol><li>ä¼˜å…ˆåœ¨æ–¹æ³•å†…ä½¿ç”¨ï¼Œå®šä¹‰ä¸ºå±€éƒ¨å˜é‡</li><li>ä½¿ç”¨synchornizedListæ¥æ›¿æ¢ConcurrentLinkedQueue</li></ol></li></ul></li><li>ä½¿ç”¨toArrayåï¼Œä¿®æ”¹Listçš„å†…å®¹ï¼Œæ•°ç»„çš„å†…å®¹ä¸ä¼šæ”¹å˜</li><li>Vectorå’ŒArrayListçš„åŒºåˆ«ï¼šVectoræ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤§éƒ¨åˆ†æ–¹æ³•æ˜¯åŒæ­¥åˆ°ï¼Œæ€§èƒ½ä¸ŠArrayListå¥½ä¸€ç‚¹ï¼Œä»¥ä¸ºä¸éœ€è¦åŒæ­¥ï¼Œæ‰©å®¹çš„æ—¶å€™ï¼ŒAå¢åŠ 50%ï¼ŒVæ€åŠ 100%</li><li>ConcurrentHashMapå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼š<ol><li>ä½¿ç”¨CAS(Compare and Swap)ï¼Œæ¯æ¬¡æ›´æ–°æ—¶ï¼Œå¯¹æ¯”å†…å­˜ä½ç½®çš„å€¼ä¸é¢„æœŸçš„åŸå€¼ç›¸åŒåˆ™æ›´æ–°ï¼Œå¦åˆ™ä¸æ›´æ–°ï¼Œè¿™æ˜¯ä¸€ç§æ— é”çš„æ“ä½œ</li><li>ä½¿ç”¨synchorinizedï¼ŒConcurrentHashMapçš„æ¯ä¸ªæ¡¶(ä¹Ÿå³æ˜¯å“ˆå¸Œè¡¨ç§çš„é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘)ï¼Œéƒ½å¯ä»¥å½“ä½œä¸€ä¸ªé”ï¼Œçº¿ç¨‹è®¿é—®æ—¶ï¼Œé”ä½è¿™ä¸ªæ¡¶ï¼Œè€Œä¸æ˜¯é”ä½æ•´ä¸ªå“ˆå¸Œè¡¨</li></ol></li></ul></li><li>6ç§çŠ¶æ€ï¼š</li><li>synchronized:<ul><li>ä½œç”¨ï¼šæŠŠè¯åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œè¯¥æ®µä»£ç ï¼Œä¿è¯çº¿ç¨‹çš„åŒæ­¥</li><li>åŸç†ï¼šä½¿ç”¨äº†JVMç§çš„ç›‘è§†å™¨é”monitorï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå†…æ²»æ‰€ï¼Œå½“çº¿ç¨‹è°ƒç”¨synchronizedæ–¹æ³•æ—¶ï¼Œå°±è·å¾—äº†è¿™ä¸ªé”ï¼Œ</li><li>JDK1.6 ä¹‹åçš„ä¼˜åŒ–ï¼šå¼•å…¥äº†åå‘é”ã€å’Œè½»é‡çº§é”ï¼Œé€æ­¥å‡çº§åˆ°é‡é‡çº§é”</li><li><strong>synchronizedå’Œvolatileçš„åŒºåˆ«</strong>ï¼švolatileåªèƒ½ä¿è¯çº¿ç¨‹çš„å¯è§æ€§ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹ç«‹åˆ»å¯è§è¿™ä¸ªä¿®æ”¹</li><li>å¹¶å‘ç¼–ç¨‹çš„ä¸‰ä¸ªé‡è¦ç‰¹æ€§ï¼šåŸå­æ€§(å…¨åšorå…¨éƒ¨åš)ï¼Œå¯è§æ€§(å…±äº«å˜é‡å¯è§)ï¼Œæœ‰åºæ€§(æŒ‰ç…§å…ˆåé¡ºåº)</li><li>ThreadLocalåŸç†ï¼šç»´æŠ¤ä¸€ä¸ªThreadLocalMapï¼Œkeyä¸ºThreadLocalå¯¹ï¼Œå€¼ä¸ºå˜é‡<ul><li>å†…å­˜æ³„æ¼ï¼škeyæ˜¯å¼±å¼•ç”¨ï¼Œvalueæ˜¯å¼ºå¼•ç”¨ï¼Œæ‰€ä»¥å¤–éƒ¨æ²¡æœ‰ä½¿ç”¨å¼ºå¼•ç”¨æ—¶ï¼ŒThreadLocalä¼šè¢«å›æ”¶ï¼Œä½†æ˜¯valueä¼šç»§ç»­ä½¿ç”¨å†…å­˜ï¼Œå¯ä»¥ä½¿ç”¨ThreadLocal.remove()æ¥è§£å†³è¿™ä¸ªé—®é¢˜</li></ul></li></ul></li></ul></li><li>JUCï¼š<ul><li>Java Util Concurrentæ˜¯å¹¶å‘ç¼–ç¨‹çš„ä¸€ä¸ªå·¥å…·åŒ…ï¼Œå¸¸ç”¨ï¼š<ul><li>Executoræ¡†æ¶</li><li>ConcurrentHashMapå¹¶å‘é›†åˆ</li><li>CountDownLatchåŒæ­¥å·¥å…·</li><li>Locks æ¯”synchronizedæ›´çµæ´»çš„é”æœºåˆ¶</li><li>åŸå­å˜é‡ï¼šAtomicInteger</li><li>å¹¶å‘å·¥å…·ç±»ï¼šForkJoinPool</li></ul></li><li>volatileå…³é”®å­—ï¼šä¿è¯å˜é‡çš„å¯è§æ€§ï¼Œè¦æ±‚æ¯æ¬¡ä½¿ç”¨å®ƒæ—¶éƒ½éœ€è¦ä»ä¸»å­˜ä¸­é‡æ–°è¯»å–ï¼Œä½†ä¸èƒ½ä¿è¯åŸå­æ€§</li><li>å•ä¾‹æ¨¡å¼ç¤ºä¾‹ä»£ç ï¼š<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> uniqueInstance<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span>  <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getUniqueInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token comment">//å…ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²ç»å®ä¾‹è¿‡ï¼Œæ²¡æœ‰å®ä¾‹åŒ–è¿‡æ‰è¿›å…¥åŠ é”ä»£ç </span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>uniqueInstance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">//ç±»å¯¹è±¡åŠ é”</span>            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>uniqueInstance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    uniqueInstance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> uniqueInstance<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><h2 id="é›†åˆç›¸å…³"><a href="#é›†åˆç›¸å…³" class="headerlink" title="é›†åˆç›¸å…³"></a>é›†åˆç›¸å…³</h2><h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><ul><li>HashSetåº•å±‚ä½¿ç”¨çš„æ˜¯HashMap</li><li>LinkedHashSeté€šè¿‡LinkedHashMapå®ç°çš„</li><li>TreeSetï¼šçº¢é»‘æ ‘(è‡ªå¹³è¡¡çš„æ’åºäºŒå‰æ ‘)å®ç°</li></ul><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><p>ArrayListæ˜¯åŠ¨æ€æ•°ç»„ï¼Œå¯ä»¥æ‰©å®¹ã€ç¼©å®¹ï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨æ³›å‹æ¥ä¿è¯ï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼Œé€‚ç”¨äºé¢‘ç¹çš„æŸ¥æ‰¾å·¥ä½œã€‚å¯æ·»åŠ nullå€¼<br>Vectoræ˜¯è€å®ç°ï¼Œåº•å±‚ä½¿ç”¨Object [   ]å­˜å‚¨ï¼Œçº¿ç¨‹å®‰å…¨</p><h3 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h3><h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><h4 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h4><p>JDK1.8ä¹‹å‰ç”±æ•°ç»„+é“¾è¡¨ç»„æˆã€‚JDK1.8ä¹‹åå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼Œä¼šè½¬åŒ–ä¸ºçº¢é»‘æ ‘(å½“å‰æ•°ç»„çš„é•¿åº¦å°äº64æ—¶ï¼Œä¼šå…ˆè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬åŒ–ä¸ºçº¢é»‘æ ‘)<br>LinkedHashMapï¼šç»§æ‰¿HashMapï¼Œå¢åŠ äº† ä¸€æ¡åŒå‘é“¾è¡¨ã€‚<br>JDK1.7æ—¶ï¼ŒHashMapåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæ‰©å®¹æ“ä½œä½¿ç”¨çš„æ˜¯å¤´æ’æ³•ï¼Œå¯¼è‡´é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æŒ‡å‘é”™è¯¯çš„ä½ç½®ã€‚JDK1.8ä½¿ç”¨çš„æ˜¯ä¸ºå°¾æ’æ³•ï¼Œä½†æ˜¯æœ‰å¯èƒ½ä¼šå‡ºç°æ•°æ®è¦†ç›–çš„é—®é¢˜ï¼Œå¹¶å‘ç¯å¢ƒä¸‹æ¨èä½¿ç”¨ConcurrentHashMap</p><h3 id="Queue-1"><a href="#Queue-1" class="headerlink" title="Queue"></a>Queue</h3><h4 id="PriorityQueue"><a href="#PriorityQueue" class="headerlink" title="PriorityQueue"></a>PriorityQueue</h4><p>ä½¿ç”¨äºŒå‰å †å®ç°ï¼Œåº•å±‚ä½¿ç”¨å¯å˜é•¿çš„æ•°æ®æ¥å­˜å‚¨æ•°æ®ï¼Œéçº¿ç¨‹å®‰å…¨ï¼Œä¸çŸ¥å¤„NULLå€¼å’Œä¸å¯æ’åºçš„å¯¹è±¡ï¼Œé»˜è®¤æ˜¯å°é¡¶å †</p><h4 id="BlockingQueue"><a href="#BlockingQueue" class="headerlink" title="BlockingQueue"></a>BlockingQueue</h4><p>é˜»å¡é˜Ÿåˆ—</p>]]></content>
      
      
      <categories>
          
          <category> è¯­è¨€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“</title>
      <link href="/2023/08/02/58/"/>
      <url>/2023/08/02/58/</url>
      
        <content type="html"><![CDATA[<h1 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h1><p>æ•°æ®åº“åŒæ­¥é—®é¢˜ï¼š</p><h2 id="Mysqlé¢è¯•æŒ‡å—"><a href="#Mysqlé¢è¯•æŒ‡å—" class="headerlink" title="Mysqlé¢è¯•æŒ‡å—"></a>Mysqlé¢è¯•æŒ‡å—</h2><p><a href="https://javabetter.cn/interview/mysql-60.html">60 é“ MySQL ç²¾é€‰é¢è¯•é¢˜ğŸ‘ | äºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯ (javabetter.cn)</a></p><h3 id="InnoDBä¸ºä»€ä¹ˆæ˜¯é»˜è®¤çš„å¼•æ“"><a href="#InnoDBä¸ºä»€ä¹ˆæ˜¯é»˜è®¤çš„å¼•æ“" class="headerlink" title="InnoDBä¸ºä»€ä¹ˆæ˜¯é»˜è®¤çš„å¼•æ“"></a>InnoDBä¸ºä»€ä¹ˆæ˜¯é»˜è®¤çš„å¼•æ“</h3><ol><li>æ˜¯mysqlä¸­å”¯ä¸€æ”¯æŒäº‹åŠ¡çš„å¼•æ“</li><li>é”æœºåˆ¶ï¼šä½¿ç”¨è¡Œçº§é”ï¼Œè€Œä¸æ˜¯è¡¨çº§é”</li><li>æ”¯æŒå¤–é”®çº¦æŸ</li><li>å…·æœ‰å´©æºƒæ¢å¤</li></ol><h3 id="ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨B-æ ‘"><a href="#ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨B-æ ‘" class="headerlink" title="ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘"></a>ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘</h3><ol><li>æ”¯å‡ºå¿«é€ŸæŸ¥æ‰¾ï¼šB+æ ‘é«˜åº¦ç›¸å¯¹è¾ƒä½ï¼ŒæŸ¥æ‰¾æ•ˆç‡é«˜</li><li>æœ‰åºæ€§ï¼šèŠ‚ç‚¹çš„é”®å€¼æ˜¯æœ‰åºæ’åˆ—çš„</li><li>æ”¯æŒé«˜æ•ˆæ’å…¥å’Œåˆ é™¤æ“ä½œï¼šå¶å­èŠ‚ç‚¹ä¹‹é—´ä½¿ç”¨åŒå‘é“¾è¡¨é“¾æ¥ï¼Œå¯ä»¥å¿«è¯»å®šä½åˆ°è¦æ’å…¥å’Œåˆ é™¤çš„ä½ç½®</li><li>é€‚åº”ç¡¬ç›˜å­˜å‚¨ï¼šB+æ ‘èŠ‚ç‚¹è¢«æ§åˆ¶åœ¨ç¡¬ç›˜å¤§å°çš„èŒƒå›´å†…</li><li>æ”¯æŒæ•°æ®ç‚¹æœ‰åºå­˜å‚¨å’ŒèŒƒå›´æŸ¥æ‰¾</li></ol><h3 id="å¦‚ä½•è¿›è¡Œå›æ»šçš„"><a href="#å¦‚ä½•è¿›è¡Œå›æ»šçš„" class="headerlink" title="å¦‚ä½•è¿›è¡Œå›æ»šçš„"></a>å¦‚ä½•è¿›è¡Œå›æ»šçš„</h3><ol><li>ä½¿ç”¨Undo Logè¿›è¡Œå›æ»šï¼Œ</li><li>æ··æ»šæ—¶ï¼ŒæŒ‰ç…§äº‹åŠ¡çš„æ‰§è¡Œçš„é€†åºè¿›è¡Œå›æ»šã€‚</li><li>Undo Logè®°å½•äº†äº‹åŠ¡å¯¹æ•°æ®åº“çš„ä¿®æ”¹æ“ä½œ</li></ol><h3 id="æ…¢æŸ¥è¯¢å¦‚ä½•è€ƒè™‘ä¼˜åŒ–"><a href="#æ…¢æŸ¥è¯¢å¦‚ä½•è€ƒè™‘ä¼˜åŒ–" class="headerlink" title="æ…¢æŸ¥è¯¢å¦‚ä½•è€ƒè™‘ä¼˜åŒ–"></a>æ…¢æŸ¥è¯¢å¦‚ä½•è€ƒè™‘ä¼˜åŒ–</h3><p><img src="/2023/08/02/58/%E6%85%A2%E6%9F%A5%E8%AF%A2%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96.png"></p><h3 id="æ•°æ®åº“ä¸­çš„CAP"><a href="#æ•°æ®åº“ä¸­çš„CAP" class="headerlink" title="æ•°æ®åº“ä¸­çš„CAP"></a>æ•°æ®åº“ä¸­çš„CAP</h3><p>Cï¼šConsistencyå¼ºä¸€è‡´æ€§ï¼Œç³»ç»Ÿåœ¨æ‰§è¡ŒæŸé¡¹æ“ä½œä¹‹åï¼Œä»ç„¶èƒ½å¤Ÿä¿æŒä¸€è‡´ã€‚æ›´æ–°æ“ä½œæ‰§è¡ŒæˆåŠŸï¼Œæ‰€æœ‰çš„ç”¨æˆ·éƒ½åº”è¯¥è¯»åˆ°æœ€æ–°çš„å€¼<br>Aï¼šAvailabliyå¯ç”¨æ€§ï¼Œæ¯ä¸ªæ“ä½œæ€»æ˜¯èƒ½å¤Ÿåœ¨ä¸€å®šæ—¶é—´å†…è¿”å›ç»“æœã€‚ç»“æœå¯ä»¥æ˜¯æˆåŠŸæˆ–è€…å¤±è´¥<br>Pï¼šåˆ†åŒºå®¹é”™æ€§ï¼Œå‡ºç°ç½‘ç»œåˆ†åŒºæ—¶ï¼Œç³»ç»Ÿèƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚</p><h3 id="æ€ä¹ˆå¯¹planè¿›è¡Œä¼˜åŒ–"><a href="#æ€ä¹ˆå¯¹planè¿›è¡Œä¼˜åŒ–" class="headerlink" title="æ€ä¹ˆå¯¹planè¿›è¡Œä¼˜åŒ–"></a>æ€ä¹ˆå¯¹planè¿›è¡Œä¼˜åŒ–</h3><ol><li>è°“è¯ä¸‹æ¨ï¼šæŸ¥è¯¢æ—¶ï¼Œç«Ÿé­è¿‡æ»¤æ‰ä¸éœ€è¦çš„æ•°æ®<code>SELECT * FROM orders WHERE order_date &gt; '2023-01-01';</code></li><li>ç´¢å¼•ä¸‹æ¨ï¼šä½¿ç”¨ç´¢å¼•æ¥åŠ é€ŸæŸ¥è¯¢ï¼Œå°¤å…¶æ˜¯åœ¨ç´¢å¼•è¦†ç›–æŸ¥è¯¢ä¸­</li><li>è¡¨è¾¾å¼ä¼˜åŒ–ï¼šç®€åŒ–å’Œé‡å†™è¡¨è¾¾å¼æ¥æé«˜æ•ˆç‡</li><li>æœ€å·¦åŒ¹é…ä¼˜åŒ–é€‰æ‹©ç´¢å¼•ï¼šä½¿ç”¨ç´¢å¼•çš„æœ€å·¦å‰ç¼€åŸåˆ™æ¥ä¼˜åŒ–æŸ¥è¯¢</li><li>é¿å…SELECT * </li><li>ä½¿ç”¨é€‚å½“çš„JOINç±»å‹</li><li>ä½¿ç”¨ç´¢å¼•è¦†ç›–ï¼šåˆ›å»ºåŒ…å«æ‰€æœ‰æŸ¥è¯¢åˆ—çš„ç´¢å¼•é¿å…å›è¡¨</li><li></li></ol><h3 id="ä»‹ç»ä¸€ä¸‹MySQLçš„ç´¢å¼•"><a href="#ä»‹ç»ä¸€ä¸‹MySQLçš„ç´¢å¼•" class="headerlink" title="ä»‹ç»ä¸€ä¸‹MySQLçš„ç´¢å¼•"></a>ä»‹ç»ä¸€ä¸‹MySQLçš„ç´¢å¼•</h3><p>MySQLçš„ç´¢å¼•æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¯ä»¥å¸®åŠ©MySQLå¿«é€Ÿæç¬‘çš„æŸ¥è¯¢ï¼Œæ›´æ–°æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚</p><h3 id="B-æ ‘çš„ç‰¹å¾ï¼Œä¸ºä»€ä¹ˆ-MySQL-è¦ä½¿ç”¨-B-æ ‘"><a href="#B-æ ‘çš„ç‰¹å¾ï¼Œä¸ºä»€ä¹ˆ-MySQL-è¦ä½¿ç”¨-B-æ ‘" class="headerlink" title="B+æ ‘çš„ç‰¹å¾ï¼Œä¸ºä»€ä¹ˆ MySQL è¦ä½¿ç”¨ B+æ ‘"></a>B+æ ‘çš„ç‰¹å¾ï¼Œä¸ºä»€ä¹ˆ MySQL è¦ä½¿ç”¨ B+æ ‘</h3><p>ç‰¹ç‚¹ï¼š </p><ol><li>åªæœ‰å¶å­èŠ‚ç‚¹ä¼šå­˜æ”¾å®é™…çš„æ•°æ®ï¼ŒåŒ…æ‹¬ç´¢å¼•+è®°å½•ï¼Œéå¶å­èŠ‚åªå­˜æ”¾ç´¢å¼•</li><li>æ‰€æœ‰ç´¢å¼•éƒ½åœ¨å¶å­èŠ‚ç‚¹ä¸­å‡ºç°ï¼Œå¶å­èŠ‚ç‚¹ä¹‹é—´æ„æˆä¸€ä¸ªæœ‰åºé“¾è¡¨</li><li>éå¶å­èŠ‚ç‚¹çš„ç´¢å¼•ä¹Ÿä¼šåŒæ—¶å­˜åœ¨å¶å­èŠ‚ç‚¹ä¸­ï¼Œå¹¶ä¸”æ˜¯å¶å­èŠ‚ç‚¹ä¸­ç´¢å¼•ä¸­çš„æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼</li><li>éå¶å­èŠ‚ç‚¹æœ‰å¤šå°‘ä¸ªå­èŠ‚ç‚¹ï¼Œå°±æœ‰å¤šå°‘ä¸ªç´¢å¼•</li></ol><p>çœ‹çœ‹å‡ ä¸ªéš”ç¦»çº§åˆ«å’Œè§£å†³åŠæ³•<br>GBKhå’ŒUTF-8ä¸æ˜¯ä¸€ç§ç¼–ç æ–¹å¼<br>mysqlä¸­ä½¿ç”¨çš„utf-8æ˜¯utf8mb3 ä½¿ç”¨1<del>3ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦<br>è€Œutf-8ä½¿ç”¨1</del>4<br>MVCC ï¼ˆMulti-Version Concurrency Control ï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰MVCC ï¼ˆMulti-Version Concurrency Control ï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æŒ‡çš„å°±æ˜¯åœ¨ä½¿ç”¨ READ COMMITTD ã€ REPEATABLE READ è¿™ä¸¤ç§éš”ç¦»çº§åˆ«çš„äº‹åŠ¡åœ¨æ‰§è¡Œæ™®é€šçš„ SEELCT æ“ä½œæ—¶è®¿é—®è®°å½•çš„ç‰ˆæœ¬é“¾çš„è¿‡ç¨‹ï¼Œè¿™æ ·å­å¯ä»¥ä½¿ä¸åŒäº‹åŠ¡çš„ è¯»-å†™ ã€ å†™-è¯» æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œä»è€Œæå‡ç³»ç»Ÿæ€§èƒ½ã€‚</p><ul><li>sqlè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ï¼šmysql8.0 clientå‘é€sqlè¯­å¥-&gt;sqlè§£æ-&gt;æ‰§è¡Œä¼˜åŒ–å’Œæ‰§è¡Œè®¡åˆ’ç”Ÿæˆ-&gt;æ‰§è¡Œ-&gt;è¿”å›ç»“æœ</li><li>éš”ç¦»ç­‰çº§ï¼š<img src="/2023/08/02/58/%E9%9A%94%E7%A6%BB%E7%AD%89%E7%BA%A7.png" alt="|575"><ul><li>MySQLé»˜è®¤æ˜¯å¯é‡å¤è¯»ï¼Œå¯ä»¥è§£å†³å¹»è¯»ã€‚ç„¶åä¸²è¡ŒåŒ–æ˜¯åŸºäºé”å®ç°çš„ï¼Œå¯é‡å¤è¯»å’Œè¯»å·²æäº¤éƒ½æ˜¯åŸºäºMVCCå®ç°çš„ï¼Œå¯é‡å¤è¯»åœ¨å½“å‰è¯»çš„æƒ…å†µä¸‹éœ€è¦åŠ é”æ‰èƒ½ä¿è¯ä¸ä¼šå‡ºç°å¹»è¯»ï¼Œæ‰€ä»¥ä»…ä»…ä½¿ç”¨MVCCä¸èƒ½è§£å†³å¹»è¯»</li></ul></li><li>æ—¥å¿—ï¼š<ul><li>ç§ç±»ï¼šé”™è¯¯æ—¥å¿—ï¼ŒæŸ¥è¯¢æ—¥å¿—ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—ï¼ŒBinary Log, ä¸­ç»§æ—¥å¿—ï¼Œäº‹åŠ¡æ—¥å¿—</li></ul><ol><li>undo log æœ‰ä¸¤ç§<ul><li>insert undo log æ‰§è¡Œinsert æ“ä½œäº§ç”Ÿçš„undo log isnertåªå¯¹äº‹åŠ¡æœ¬èº«å¯è§ï¼Œå…¶ä»–äº‹åŠ¡ä¸å¯è§ï¼Œæ‰€ä»¥äº‹åŠ¡æäº¤ä¹‹åå¯ä»¥ç›´æ¥åˆ é™¤</li><li>update undo log æä¾›MVCCæœºåˆ¶ï¼Œæäº¤æ—¶æ”¾å…¥undo log é“¾è¡¨ï¼Œç­‰å¾…purgeçº¿ç¨‹è¿›è¡Œæœ€åçš„åˆ é™¤<ul><li>purgeï¼šä¼šå®šæœŸæ£€æŸ¥ undo log å’Œæ•°æ®è¡Œï¼Œæ‰¾å‡ºé‚£äº›å·²ç»ä¸å†éœ€è¦çš„ï¼Œç„¶åå°†å®ƒä»¬ä»ç£ç›˜ä¸Šåˆ é™¤ï¼Œä»è€Œå›æ”¶ç£ç›˜ç©ºé—´ã€‚</li></ul></li></ul></li><li>æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šè®°å½•æ‰§è¡Œæ—¶é—´æŸ¥è¿‡æŒ‡å®šé˜ˆå€¼çš„æ‰€æœ‰SQLæŸ¥è¯¢ï¼Œ</li><li>Binlog: ä¸»è¦è®°å½•äº†æ•°æ®åº“çš„ä¿®æ”¹æ“ä½œï¼Œäº‹åŠ¡ä¿¡æ¯å’Œä¸€äº›ç‰¹æ®Šäº‹ä»¶ï¼šæœåŠ¡å™¨çš„å¯åŠ¨å’Œåœæ­¢ï¼Œä¸»ä»å¤åˆ¶çŠ¶æ€å˜æ›´äº‹ä»¶ç­‰</li><li>redo log å¦‚ä½•ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ï¼Ÿ <ul><li>äº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œé¦–å…ˆè®°å½•åœ¨redo logè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹æ•°æ®æ–‡ä»¶ï¼Œredo log ä¿å­˜åœ¨å†…å­˜ä¸­çš„log bufferï¼Œç„¶åè¢«å¼‚æ­¥åˆ·æ–°åˆ°ç£ç›˜ä¸­çš„redo log fileä¸­</li><li>äº‹åŠ¡æäº¤æ—¶ï¼Œç›¸å…³çš„æ•°æ®è¿˜æ²¡æœ‰æ²¡åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œåªè¦ä¿è¯redo log è¢«åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œå³ä½¿ç³»ç»Ÿåœ¨äº‹åŠ¡æäº¤åå´©æºƒäº†ï¼Œä¹Ÿå¯ä»¥åœ¨ç³»ç»Ÿé‡å¯ä¹‹åé€šè¿‡redo log é‡Œæ¢å¤æ•°æ®ï¼Œ</li><li>ä¸ºä»€ä¹ˆè¦å…ˆå†™å…¥redo log ï¼Œå› ä¸ºredo log æ—¶é¡ºåºå†™å…¥çš„ï¼Œè€Œå†™æ•°æ®éœ€è¦æ¶‰åŠéšæœºI/Oï¼Œèƒ½å¤Ÿæé«˜æ•°æ®åº“çš„æ€§èƒ½</li></ul></li><li>é¡µè¡¨ä¿®æ”¹ä¹‹åä¸ºä»€ä¹ˆä¸ç›´æ¥åˆ·ç›˜ï¼Ÿå› ä¸ºåˆ·æ–°åˆ°ç£ç›˜ä¸­éå¸¸è€—æ—¶ï¼Œæ‰€ä»¥ä½¿ç”¨é¢„å†™å¼æ—¥å¿—çš„æŠ€æœ¯ï¼Œå…ˆå†™å…¥redologï¼Œä¹‹åå¼‚æ­¥åˆ·æ–°å†…å­˜ä¸­çš„redologåˆ°ç£ç›˜ä¸­ï¼Œä¹‹åå†™å…¥æ•°æ®åˆ°å†…å­˜ä¸­çš„æ•°æ®é¡µä¸­ï¼Œä¹‹åå†™å…¥binlogï¼Œå†…å­˜ä¸­çš„æ•°æ®é¡µä¼šåœ¨é€‚å½“å®é™…åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚</li><li>binlogå’Œredologçš„åŒºåˆ«ï¼š<ul><li>ç”¨é€”ä¸Šï¼šbinlogç”¨äºä¸»ä»å¤åˆ¶å’Œæ•°æ®æ¢å¤ï¼Œå¤åˆ¶æ—¶ä¼šæŠŠä¸»æœåŠ¡å™¨ä¸Šçš„binlogå‘ç»™ä»æœåŠ¡å™¨ï¼Œç„¶åä»æœåŠ¡å™¨æ ¹æ®binlogä¸­çš„è®°å½•æ¥æ›´æ–°;è€Œredo log ç”¨äºä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§</li><li>æ ¼å¼ï¼šbinlog:å¯ä»¥æ˜¯è¯­å¥æ ¼å¼æˆ–è€…è¡Œæ ¼å¼ï¼Œè¯­å¥è®°å½•SQLæ‰§è¡Œçš„è¯­å¥ï¼Œè¡Œæ ¼å¼è®°å½•æ¯ä¸€è¡Œçš„æ•°æ®å˜åŒ–ã€‚redo logä»¥ç‰©ç†æ ¼å¼è®°å½•æ•°æ®é¡µçš„ä¿®æ”¹ï¼Œè®°å½•çš„æ˜¯æŸä¸ªæ•°æ®é¡µçš„æŸä¸ªä½ç½®ï¼Œå°†æŸä¸ªæ•°æ®ä¿®æ”¹ä¸ºäº†ä»€ä¹ˆ</li><li>å†™å…¥æ—¶æœºï¼šbinlog äº‹åŠ¡æäº¤æ—¶ï¼Œredo log äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å°±å¼€å§‹å†™å…¥ï¼Œäº‹åŠ¡æäº¤æ—¶ç¡®ä¿å·²ç»å°†redo log å†™å…¥ç£ç›˜ä¸­</li><li>æ¸…ç†æ–¹å¼ï¼šbinlog éœ€æ‰‹åŠ¨æ¸…ç†æˆ–è€…è®¾ç½®è¿‡æœŸæ—¶é—´æ¸…ç†ï¼› redo log å½“æ•°æ®é¡µçš„ä¿®æ”¹åˆ·æ–°åˆ°ç£ç›˜ä¸­ä¹‹åï¼Œredo log å³å¯è¢«è¦†ç›–é‡æ–°ä½¿ç”¨</li></ul></li><li>undo log å¦‚ä½•ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ï¼šäº‹åŠ¡å¼€å§‹æ‰§è¡Œæ—¶ï¼Œudno log ä¸­ä¼šè®°å½•ä¿®æ”¹å‰çš„æ•°æ®ï¼Œå¦‚æœäº‹åŠ¡ä½“éª„å‚²æˆåŠŸï¼Œundo log å³å¯ä»¥è¢«æ¸…ç†ï¼Œå¦‚æœå¤±è´¥å°±ä¼šä½¿ç”¨undo log å›æ»šäº‹åŠ¡ã€‚</li><li>MVCC(ä¹è§‚é”)å¦‚ä½•å®ç°ï¼šæ¯ä¸ªæ•°æ®è¡Œä¸­éƒ½æœ‰ä¸¤ä¸ªéšè—åˆ—ï¼šä¸€ä¸ªç”¨äºè®°å½•æ”¹è¡Œåˆ›å»ºæ—¶çš„äº‹åŠ¡IDï¼Œä¸€ä¸ªè®°å½•åˆ é™¤è¯¥è¡Œçš„äº‹åŠ¡IDï¼Œå½“äº‹åŠ¡å¼€å§‹æ—¶ï¼Œä»–ä¼šæ ¹æ®å½“å‰æ‰€æœ‰æ´»è·ƒçš„äº‹åŠ¡äº§ç”ŸRead View ï¼Œå…¶ä¸­è®°å½•äº†ï¼š<ul><li>åˆ›å»ºè¿™ä¸ªRead Viewæ—¶ä¸‹ä¸ªå³å°†è¢«åˆ†é…çš„äº‹åŠ¡ID m_low_limit_id</li><li>æ´»è·ƒåˆ—è¡¨ä¸­æœ€å°çš„äº‹åŠ¡ID m_up_limit_id</li><li>Read Viewåˆ›å»ºæ—¶ï¼Œå…¶ä»–æœªæäº¤çš„æ´»è·ƒäº‹åŠ¡IDåˆ—è¡¨ m_ids</li><li>åˆ›å»ºè¯¥Read View çš„äº‹åŠ¡ID m_creator_trx_id<br> ä¹‹åå¯¹æ•°æ®è¡Œè¿›è¡Œè¯»å–æ—¶ï¼Œæ£€æŸ¥è¯¥è¡Œçš„åˆ›å»ºäº‹åŠ¡IDå’Œåˆ é™¤äº‹åŠ¡ID <img src="/2023/08/02/58/ReadView%E5%8F%AF%E8%A7%81%E6%80%A7.png" alt="ReadViewå¯è§æ€§|525"></li><li>å¦‚æœåˆ›å»ºIDå¤§äºm_low_limit_idï¼Œè¯´æ˜æ˜¯åœ¨å½“å‰äº‹åŠ¡ä¹‹ååˆ›å»ºçš„ï¼Œä¸å¯è§</li><li>å¦‚æœåˆ é™¤IDå°äºm_up_limit_idï¼Œè¯´æ˜åœ¨å½“å‰äº‹åŠ¡å¼€å§‹å‰å°±å·²ç»è¢«åˆ é™¤äº†ï¼Œä¸å¯è§</li><li>å¦‚æœåˆ›å»ºäº‹åŠ¡IDå°äºm_low_limit_idä½†åˆ é™¤IDå¤§äºm_up_limit_idï¼Œéœ€è¦ä¸m_idsåˆ—è¡¨ä¸­æ¯”å¯¹ï¼Œå¦‚æœå­˜åœ¨äºm_idsåˆ—è¡¨ä¸­ï¼Œåˆ™ä¸å¯è§</li></ul></li><li></li></ol></li><li>å¤–é”®ï¼š<ul><li>ä¸å»ºè®®ä½¿ç”¨å¤–é”®ï¼Œå¤–é”®åº”è¯¥åœ¨åº”ç”¨å±‚ä¸­ä¿è¯ï¼Œè€Œä¸æ˜¯åœ¨æ•°æ®åº“ä¸Šä½¿ç”¨å¤–é”®ï¼Œå› ä¸ºå¤–é”®å¯¹åˆ†åº“åˆ†è¡¨æ— æ³•ç”Ÿæ•ˆï¼ŒåŒæ—¶éœ€è¦ç»´æŠ¤å¤–é”®ï¼Œå½“æˆ‘ä»¬åšä¸€äº›æ¶‰åŠå¤–é”®çš„CUDæ“ä½œæ—¶ï¼Œéœ€è¦è§¦å‘ç›¸å…³çš„æ“ä½œå»æ£€æŸ¥ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§ï¼Œä»è€Œæ¶ˆè€—é¢å¤–èµ„æºï¼Œ</li></ul></li><li>é›†ç¾¤ï¼š<ul><li>redo log å’Œ undo logéƒ½æ˜¯ç”±InnoDBå¼•æ“å®ç°çš„</li><li>bin log æ˜¯ç”±mysqlçº§åˆ«çš„æ—¥å¿—<ul><li>redoå’Œbin çš„åŒºåˆ«ï¼šRedo logæ˜¯è®°å½•äº†æ•°æ®çš„ä¿®æ”¹ï¼Œå¤§å°åˆ°ä¸€å®šç¨‹åº¦ï¼Œæ–°çš„æ—¥å¿—ä¼šè¦†ç›–ï¼Œå…ˆå†™redoå†å†™binï¼Œç›®çš„æ˜¯ä¸ºäº†ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§</li><li>Binlogæ˜¯è®°å½•äº†æ‰§è¡Œäº†ä»€ä¹ˆsqlè¯­å¥ï¼Œä¸ä¼šè¦†ç›–æ—§æ—¥å¿—ï¼Œç”¨äºå®ç°mysqlçš„ä¸»ä»å¤åˆ¶</li></ul></li><li>redologçš„ä¼˜åŠ¿ï¼šé¡ºåºå†™ï¼Œé¢„å†™å…¥ï¼Œç£ç›˜åŒæ­¥è¿‡ç¨‹ä¸­å¯ä»¥ä¸€æ¬¡åŒæ­¥å¤šä¸ªäº‹åŠ¡çš„Redo logï¼šå…ˆæŠŠä¿®æ”¹å†™å…¥redologï¼Œå†ä¿®æ”¹å†…å­˜ä¸­çš„æ•°æ®ï¼Œäº‹åŠ¡æäº¤æ—¶å†å…¥bin logï¼Œä¹‹åå†å°†æ•°æ®å†™å…¥ç£ç›˜ä¸­ </li><li>ä¸»ä»å¤åˆ¶ï¼š<ul><li>masterèŠ‚ç‚¹ä¼šä¸æ–­å°†sqlå‘½ä»¤å†™å…¥Binary Logï¼Œå­èŠ‚ç‚¹ä½¿ç”¨I/Oçº¿ç¨‹è¯»å…¥masterèŠ‚ç‚¹ä¸­çš„Bin Log</li><li>å­—èŠ‚ç‚¹ä½¿ç”¨SQLçº¿ç¨‹æ‰§è¡ŒBin Logçš„è¯­å¥</li></ul></li></ul></li><li>å­˜å‚¨å¼•æ“çš„åŒºåˆ«ï¼šMyISAM å’Œ InnoDB çš„åŒºåˆ«<ul><li>MySQLçš„å­˜å‚¨å¼•æ“é‡‡ç”¨çš„æ˜¯æ’ä»¶å¼æ¶æ„ï¼Œæ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ä¸ºä¸åŒçš„æ•°æ®åº“è¡¨è®¾è®¡ä¸åŒçš„å­˜å‚¨å¼•æ“ï¼Œå­˜å‚¨å¼•æ“æ˜¯åŸºäºè¡¨è€Œä¸æ˜¯æ•°æ®åº“çš„ã€‚</li><li>InnodDBæ”¯æŒäº‹åŠ¡</li><li>InnoDBæ”¯æŒè¡Œçº§é”å®šï¼ŒMyISAMæ“ä½œæ—¶ç›´æ¥é”å®šæ•´ä¸ªè¡¨</li><li>InnoDBæ”¯æŒå¤–é”®å’Œçº§è”åˆ é™¤/æ›´æ–°</li><li>InnoBDå­˜å‚¨æ•°æ®æ›´å¤§</li><li>å´©æºƒæ¢å¤æ›´å¥½</li><li>InnoDBä»¥èšç°‡çš„æ–¹å¼å­˜å‚¨æ•°æ®ï¼ŒMyISAMæ˜¯å°†æ•°æ®å’Œç´¢å¼•åˆ†å¼€å­˜å‚¨</li><li>InnoDBæ”¯æŒMVCC</li></ul></li><li>äº‹åŠ¡ï¼š<ul><li>å¹¶å‘äº‹åŠ¡å¸¦æ¥äº†å“ªäº›é—®é¢˜ï¼š<ol><li>è„è¯»ï¼šä¸€ä¸ªäº‹åŠ¡è¯»åˆ°äº†å¦ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹åå›æ»šçš„æ•°æ®</li><li>ä¸¢å¤±ä¿®æ”¹:ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¿®æ”¹ä¸€ä¸ªæ•°æ®ï¼Œå…ˆæäº¤çš„ä¼šä¸¢å¤±ä¿®æ”¹</li><li>ä¸å¯é‡å¤è¯»ï¼šæ‰§è¡Œç›¸åŒçš„ä¸¤ä¸ªè¯­å¥ï¼Œç»“æœä¸ä¸€æ ·</li><li>å¹»è¯»ï¼šå¤šäº†è®°å½•æˆ–è€…æ˜¯å°‘äº†è®°å½•<ul><li>3å’Œ4çš„åŒºåˆ«ï¼š3æ˜¯è®°å½•è¢«ä¿®æ”¹ï¼Œ4æ˜¯è®°å½•æ¡æ•°å˜åŒ–</li></ul></li></ol></li><li>mysqlä¸­çš„éš”ç¦»ç­‰çº§ï¼š é»˜è®¤æ˜¯å¯é‡å¤è¯»ï¼Œèƒ½å¤Ÿé˜²æ­¢å¹»è¯» å®ç°æ˜¯é€šè¿‡ <strong>é”å’ŒMVCC(å¤šç‰ˆæœ¬æ§åˆ¶å¹¶å‘æ§åˆ¶)</strong> å®ç°çš„<ol><li>è¯»æœªæäº¤ï¼šå…è®¸äº‹åŠ¡è¯»å–æœªæäº¤çš„äº‹åŠ¡çš„ä¿®æ”¹ï¼Œä¼šå‡ºç°è„è¯»ï¼Œå¹»è¯»ï¼Œä¸å¯é‡å¤è¯»</li><li>è¯»å·²æäº¤ï¼šåªèƒ½è¯»åˆ°æäº¤çš„äº‹åŠ¡çš„ä¿®æ”¹ï¼Œé¿å…è„è¯»ï¼Œä½†æ˜¯è¿˜æœ‰å¹»è¯» ï¼ˆè¯»æ•°æ®æ—¶åŠ ä¸Šå…±äº«é”ï¼Œè¯»å–åç«‹åˆ»é‡Šæ”¾ï¼‰</li><li>å¯é‡å¤è¯»ï¼šåŒä¸€äº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡è¯»å–ç»Ÿä¸€æ•°æ®è¿”å›ç»“æœè¦ä¸€è‡´ (äº‹åŠ¡ç»“æŸæ‰é‡Šæ”¾é”ï¼ŒåŒæ—¶ä½¿ç”¨MVCCæ¥ä¿è¯æ¯ä¸ªäº‹åŠ¡éƒ½çœ‹åˆ°ä¸€ä¸ªä¸€è‡´çš„å¿«ç…§)</li><li>å¯ä¸²è¡ŒåŒ–ï¼šå¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œå½±å“æ•ˆç‡</li></ol></li><li>MVCCçš„åŸç†ï¼š</li><li>è¿™ä¸¤ä¸ªéšè—çš„åˆ—å°±æ˜¯undo logæ—¥å¿—<img src="/2023/08/02/58/undolog.png" alt="|700"><ul><li>è¿™ä¿©å°±æ˜¯éšè—åˆ—ï¼Œtrx_idå½“å‰ä¿®æ”¹ä¹‹åçš„äº‹åŠ¡idï¼Œroll_pointeræŒ‡å‘ä¿®æ”¹ä¹‹å‰çš„ä¿¡æ¯</li><li><img src="/2023/08/02/58/undolog%E8%A1%A8.png" alt="|725"></li><li>MVCCå®ç°åŸç†ï¼šReadView<ul><li>ä¸»è¦å†…å®¹ï¼š<ul><li>m_ids:ç”ŸæˆReadViewæ—¶å½“å‰ç³»ç»Ÿæ´»è·ƒçš„è¯»å†™äº‹åŠ¡idåˆ—è¡¨</li><li>min_trx_id:åœ¨ç”ŸæˆReadViewæ—¶å½“å‰ç³»ç»Ÿæ´»è·ƒçš„è¯»å†™äº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡idï¼Œä¹Ÿå°±æ˜¯min (m_ids)</li><li>max_trx_id:è¡¨ç¤ºç”ŸæˆReadVeiwæ—¶ç³»ç»Ÿåº”è¯¥åˆ†é…ç»™ä¸‹ä¸‹ä¸€ä¸ªäº‹åŠ¡çš„idå€¼</li><li>creator_trx_idï¼šè¡¨ç¤ºç”Ÿæˆè¯¥ReadViewçš„äº‹åŠ¡id</li></ul></li><li>åŸç†ï¼šåœ¨è®¿é—®æŸæ¡è®°å½•æ—¶æ ¹æ®ä»¥ä¸‹æ–¹å¼æ¥åˆ¤æ–­ï¼š<ol><li>trx_id == creator_trx_idï¼Œè¡¨ç¤ºæ˜¯è‡ªå·±ä¿®æ”¹è¿‡çš„è®°å½•ï¼Œå¯è§</li><li>trx_id &lt; min_trx_id å¯ä»¥è¢«è®¿é—®</li><li>trx_id &gt; max_trx_idï¼Œä¸å¯è¢«è®¿é—®</li><li>trx_id &gt; min  &amp;&amp; trx_id &lt; max éœ€è¦åˆ¤æ–­ï¼šå¦‚æœtrx_idåœ¨m_idsä¸­ï¼Œè¡¨ç¤ºä»ç„¶æ´»è·ƒï¼Œä¸å¯è®¿é—®ï¼Œä¸åœ¨è¡¨ç¤ºå·²ç»è¢«æäº¤ï¼Œå¯ä»¥è®¿é—®äº†</li><li>å¦‚æœæŸä¸ªç‰ˆæœ¬å¯¹å½“å‰äº‹åŠ¡ä¸å¯è§ï¼Œåˆ™é¡ºç€ç‰ˆæœ¬è¿æ‰¾ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œç›´åˆ°æœ€åï¼Œå¦‚æœæœ€åä¸€ä¸ªç‰ˆæœ¬ä¹Ÿä¸å¯è§çš„è¯ï¼Œæ„å‘³ç€è¿™æ¡è®°å½•å¯¹è¿™ä¸ªäº‹åŠ¡å®Œå…¨ä¸å¯è§ï¼ŒæŸ¥è¯¢ç»“æœä¸è¿”å›è¿™ä¸ªè®°å½•</li></ol></li><li>è¯»å·²æäº¤æ¯æ¬¡è¯»éƒ½ä¼šç”Ÿæˆä¸€ä¸ªReadViewï¼Œè€Œå¯é‡å¤è¯»æ™ºæ…§åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡ŒæŸ¥è¯¢è¯­å¥æ—¶ç”Ÿæˆä¸€ä¸ªReadView</li></ul></li></ul></li></ul></li><li>ç´¢å¼•å¸¸é—®ï¼š<ul><li>è¦†ç›–ç´¢å¼•ï¼šæŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•ï¼Œå¹¶ä¸”æŸ¥è¯¢è¿‡ç¨‹ä¸­å·²ç»æ‰¾åˆ°äº†æ‰€æœ‰éœ€è¦çš„åˆ—ï¼Œä¸éœ€è¦ç»§ç»­å›è¡¨äº†</li><li>ç´¢å¼•å¤±æ•ˆé—®é¢˜ï¼š<ol><li>ä½¿ç”¨äº†!= &lt; &gt; LIKE ï¼Œå‡½æ•°æ“ä½œæˆ–è€…è¡¨è¾¾å¼æ“ä½œ</li><li>è”åˆç´¢å¼•ä¸­æ²¡æœ‰éµå¾ªæœ€å·¦å‰ç¼€ï¼Œè·³è¿‡äº†ä¸­é—´çš„ç´¢å¼•å­—æ®µ</li><li></li></ol></li></ul></li><li>SQLè¯­å¥ï¼š<ul><li>å¸¸è§å‡½æ•°ï¼š<ol><li>Concat()æŠŠå¤šåˆ—æ‹¼æ¥åœ¨ä¸€èµ·</li><li>RTrim() å»é™¤å¤šæœ‰ç©ºæ ¼</li><li>ASç»™åˆ—èµ·åˆ«å</li></ol></li><li>å­˜å‚¨è¿‡ç¨‹ï¼šå­˜å‚¨è¿‡ç¨‹æ˜¯ä¸€ç§åœ¨æ•°æ®åº“ä¸­å­˜å‚¨çš„é¢„ç¼–è¯‘çš„SQLè¯­å¥é›†åˆï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨å®ƒçš„åå­—æ¥æ‰§è¡Œã€‚å­˜å‚¨è¿‡ç¨‹å¯ä»¥æ¥æ”¶å‚æ•°ï¼Œå¹¶ä¸”å¯ä»¥è¿”å›å€¼ï¼Œé•¿å“Ÿä¸ªä¸è¿›è¡Œæ‰¹å¤„ç†<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">USE test;CREATE PROCEDURE productpricing()BEGINSELECT * FROM hello;END;è°ƒç”¨CALL productpricing()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><h3 id="InooDBè¯¦è§£"><a href="#InooDBè¯¦è§£" class="headerlink" title="InooDBè¯¦è§£"></a>InooDBè¯¦è§£</h3><ol><li>InooDBå¤§å°ä¸€èˆ¬ä¸º16kb</li><li>InooDBé¡µè¡¨:<img src="/2023/08/02/58/InnoDB%E6%95%B0%E6%8D%AE%E9%A1%B5.png"></li><li>File Headerï¼š<img src="/2023/08/02/58/FileHeader.png"></li><li>Page Headerï¼š<img src="/2023/08/02/58/PageHeader.png"></li><li>infimumu+supremum æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•ã€‚ä¸å­˜æ”¾çœŸæ˜¯æ•°æ®<img src="/2023/08/02/58/%E6%95%B0%E6%8D%AE%E9%A1%B5%E8%AF%A6%E8%A7%A3.png"><ul><li>heap_noåˆ†åˆ«ä¸º0å’Œ1ï¼Œ record_typeåˆ†ä¸º4ç§ï¼Œ0æ™®é€šè®°å½•ï¼Œ1è¡¨ç¤ºB+æ ‘éå¶èŠ‚ç‚¹è®°å½•ï¼Œ2æœ€å°è®°å½•ï¼Œ3æœ€å¤§è®°å½•ã€‚</li><li>next_record ç”±å½“å‰çœŸå®æ•°æ®æŒ‡å‘å“ä¸€è·³è®°å½•çš„çœŸå®æ•°æ®ã€‚å“ä¸€è·³è®°å½•ä¸æ˜¯æŒ‰ç…§æ’å…¥é¡ºåºçš„ä¸‹ä¸€æ¡ï¼Œè€Œæ˜¯æ ¹æ®ä¸»é”®æ’åºä¹‹åçš„ä¸‹ä¸€æ¡ã€‚infimumçš„ä¸‹ä¸€æ¡è®°å½•æ˜¯ç”¨æˆ·è®°å½•ä¸­ä¸»é”®æœ€å°çš„ï¼Œç”¨æˆ·è®°å½•ä¸­ä¸»é”®æœ€å¤§çš„ä¸‹ä¸€æ¡æŒ‡å‘supremum</li><li>ä¸ºä»€ä¹ˆæŒ‡å‘çš„æ˜¯çœŸæ˜¯æ•°æ®çš„å¼€å¤´ï¼Ÿ<ul><li>å› ä¸ºå‘å·¦è¯»å–ä¸ºè®°å½•å¤´ä¿¡æ¯ï¼Œå‘å³è¯»å–çœŸå®æ•°æ®ã€‚ è®°å½•å¤´ä¿¡æ¯åˆšå¥½æ˜¯<strong>é€†åºçš„ï¼</strong></li></ul></li><li><img src="/2023/08/02/58/next_record%E7%A4%BA%E4%BE%8B.png"></li></ul></li><li>User Record ï¼š <ul><li>ç”±é¢å¤–è®°å½•ä¿¡æ¯å’Œå®é™…ä¿¡æ¯ç»„æˆ</li><li>é¢å¤–è®°å½•ï¼š<ul><li>å˜é•¿å­—æ®µçš„çœŸå®æ•°æ®çš„å­—èŠ‚é•¿åº¦éƒ½æ”¾åœ¨è®°å½•çš„å¼€å¤´ï¼Œé€†åºå­˜æ”¾ã€‚ä¸å­˜æ”¾NULLçš„å­—èŠ‚é•¿åº¦</li><li>NULLLå€¼åˆ—è¡¨ï¼ŒNULLå€¼å­˜å‚¨åœ¨è¿™é‡Œï¼Œå¹¶ä¸”æ˜¯é€†åºå­˜å‚¨ï¼Œå¦‚æœå­˜åœ¨NULLå€¼å°±ä¸ä¼šå­˜åœ¨è¿™ä¸ªåˆ—è¡¨</li><li>è®°å½•å¤´ä¿¡æ¯ï¼š<img src="/2023/08/02/58/%E8%AE%B0%E5%BD%95%E5%A4%B4%E4%BF%A1%E6%81%AF.png"><ul><li>delete_maskæ ‡è®°çš„è®°å½•ä¸ä¼šç†ç§‘åˆ é™¤ï¼Œè€Œæ˜¯ä¼šæ”¾åœ¨åƒåœ¾åˆ—è¡¨ä¸­ï¼Œç­‰å¾…è¦†ç›–ã€‚</li><li>heap_noæ˜¯æ ¹æ®ä¸»é”®çš„å¤§å°æ¥ç¡®å®šçš„</li></ul></li></ul></li><li>çœŸå®ä¿¡æ¯ï¼š<ul><li><img src="/2023/08/02/58/%E9%9A%90%E8%97%8F%E5%88%97.png"></li><li>å¦‚æœæœªæŒ‡å®šä¸»é”®ï¼Œä¼šç”Ÿæˆrow_idéšè—åˆ—</li></ul></li></ul></li><li>Page  Directory ï¼š<ul><li>å°†æ­£å¸¸çš„æ‰€æœ‰è®°å½•åˆ’åˆ†ä¸ºå‡ ä¸ªç»„ï¼ŒåŒ…æ‹¬æœ€å¤§å’Œæœ€å°è®°å½•ï¼Œä¸åŒ…æ‹¬å·²åˆ é™¤çš„è®°å½•,æœ€å°è®°å½•æ‰€åœ¨çš„åˆ†ç»„åªåŒ…æ‹¬è‡ªå·±ã€‚</li><li>æ¯ç»„æœ€åä¸€ä¸ªè®°å½•çš„å¤´ä¿¡æ¯ä¸­çš„n_owndæ¥è¡¨ç¤ºè¯¥ç»„ä¸­è®°å½•æ•°ã€‚</li><li>å°†æ¯ç»„çš„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡æ‹¿å‡ºæ¥æ”¾å…¥PageDirectoryä¸­ï¼Œåç§»é‡è¢«ç§°ä¸ºæ§½(slot)</li><li><img src="/2023/08/02/58/PageDirectory%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F.png"></li></ul></li><li>File Trailer: ç”¨äºæ£€éªŒä¸€ä¸ªé¡µæ˜¯å¦å®Œæ•´ï¼š</li></ol><h3 id="ç´¢å¼•ï¼š"><a href="#ç´¢å¼•ï¼š" class="headerlink" title="ç´¢å¼•ï¼š"></a>ç´¢å¼•ï¼š</h3><h4 id="å›è¡¨é—®é¢˜"><a href="#å›è¡¨é—®é¢˜" class="headerlink" title="å›è¡¨é—®é¢˜"></a>å›è¡¨é—®é¢˜</h4><p>å½“æŸ¥è¯¢çš„æ•°æ®åœ¨ç´¢å¼•æ ‘ä¸­æ‰¾ä¸åˆ°æ—¶ï¼Œå°±éœ€è¦å›åˆ°ä¸»é”®ç´¢å¼•æ ‘ç§å»è·å–ã€‚<br>è¦†ç›–ç´¢å¼•ï¼š<br>æŸ¥è¯¢æ—¶ä»ç´¢å¼•åˆ—å°±èƒ½å¤Ÿè·å–äº†ï¼Œå°±ä¸éœ€è¦å›åˆ°ä¸»é”®æ ‘ä¸­æŸ¥æ‰¾äº†</p><ul><li>å‰æ<ol><li>æ•°æ®é¡µé“¾è¡¨ä¸­çš„å‰åä¿è¯å‰ä¸€ä¸ªæ•°æ®é¡µä¸­çš„ä¸»é”®çš„æœ€å¤§å€¼å¤§äºåä¸€ä¸ªé¡µè¡¨ä¸­ä¸»é”®çš„æœ€å°å€¼ï¼Œä¹Ÿå°±ä¸»é”®é€’å¢ï¼Œæ¯ä¸€ä¸ªé¡µè¡¨å†…ï¼Œä¸»é”®ä¹Ÿé€’å¢</li><li>å»ºç«‹ä¸€ä¸ªç›®å½•é¡¹ï¼šåŒ…æ‹¬ key:é¡µä¸­ä¸»é”®æœ€å°å€¼ page_no:é¡µå·ã€‚</li><li><img src="/2023/08/02/58/%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86.png"></li></ol></li><li>mysqlä¸­çš„å®ç°ï¼š<ol><li>ä½¿ç”¨ç”¨æˆ·è®°å½•çš„æ•°æ®é¡µæ¥å­˜å‚¨ç›®å½•é¡¹ï¼Œå¹¶ä¸”ä½¿ç”¨record_type = 1æ¥æ ‡æ˜ï¼ŒåªåŒ…å«keyå’Œpage_noå³å¯</li><li>ä½¿ç”¨åŒå‘åˆ—è¡¨æ¥ç»´æŠ¤å¤šä¸ªç›®å½•é¡¹</li><li>ä½¿ç”¨æ ‘çš„ç»“æ„æ¥é‡å¤å»ºç«‹ç´¢å¼•ï¼ŒåŠ å¿«è®¿é—®<img src="/2023/08/02/58/%E7%B4%A2%E5%BC%95.png"><img src="/2023/08/02/58/B+%E6%A0%91.png"></li><li>çœŸæ­£çš„æ•°æ®é¡µéƒ½æ”¾åœ¨æœ€åº•å±‚çš„å¶å­èŠ‚ç‚¹</li></ol><ul><li>èšç°‡ç´¢å¼•ï¼š1. ä½¿ç”¨ä¸»é”®å€¼å¤§å°è¿›è¡Œè®°å½•å’Œæ’åº 2. å¶å­èŠ‚ç‚¹æ˜¯å®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚ç´¢å¼•å³æ•°æ®ï¼Œæ•°æ®å³ç´¢å¼•</li><li>äºŒçº§ç´¢å¼•ï¼š1.ä½¿ç”¨éä¸»é”®å€¼æ¥è¿›è¡Œè®°å½•å’Œæ’åº 2. å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ç´¢å¼•é”®å’Œä¸»é”®çš„å€¼ 3. æŸ¥è¯¢åˆ°å¶å­èŠ‚ç‚¹ä¹‹åéœ€è¦å†æŸ¥æ‰¾ä¸€å˜ä¸»é”®çš„ç´¢å¼•æ¥æ‰¾åˆ°çœŸæ­£çš„ç”¨æˆ·è®°å½•ã€‚ ä¼˜ç‚¹æ˜¯èŠ‚çœç©ºé—´ã€‚<img src="/2023/08/02/58/%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95.png"></li><li>è”åˆç´¢å¼•ï¼š1.ä½¿ç”¨å¤šä¸ªåˆ—çš„å¤§å°æ¥è¿›è¡Œæ’åºã€‚å…ˆæŒ‰ç…§ä¸€ä¸ªåˆ—æ’åºï¼Œåˆ—å¤§å°ç›¸åŒæ—¶ï¼Œä½¿ç”¨ä¸‹ä¸€ä¸ªåˆ—å¤§å°æ¥æ’åºã€‚2. å¯¹äºè¿™å¤šä¸ªåˆ—åªéœ€è¦å»ºç«‹ä¸€ä¸ªB+æ ‘å³å¯ï¼ŒèŠ‚çœäº†ç©ºé—´3.å®è´¨ä¸Šä¹Ÿæ˜¯äºŒçº§ç´¢å¼•</li><li>å¯¹æ¯”ï¼šMyISAM<ul><li>å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºï¼Œæœ‰è¡Œå·</li><li>ç´¢å¼•æ”¾åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ä¸»é”®å€¼+è¡Œå·ä½œä¸ºç´¢å¼•ï¼Œæ‰€ä»¥å…¨æ˜¯äºŒçº§ç´¢å¼•ï¼Œè€Œä¸”ä¸èƒ½äºŒåˆ†æŸ¥æ‰¾ã€‚</li></ul></li><li>SQLå»ºç«‹ç´¢å¼•ï¼šæ¯ä¸€ä¸ªè¡¨ä¼šè‡ªåŠ¨ä¸ºä¸»é”®æˆ–è€…uniqueå»ºç«‹ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œå¯ä½¿ç”¨è¯­å¥æŒ‡å®šå»ºç«‹å…¶ä»–åˆ—çš„ç´¢å¼•<img src="/2023/08/02/58/sql%E5%BB%BA%E7%AB%8B%E7%B4%A2%E5%BC%95.png"></li><li>åˆ é™¤ç´¢å¼•ï¼šALTER TABLE index_demo DROP INDEX idx_c2_c3;</li></ul></li><li>ç‹¬ç«‹è¡¨ç©ºé—´ï¼š<ol><li>åŒºï¼šè¡¨ç©ºé—´åˆ†ä¸ºå¤šä¸ªåŒºï¼ŒåŒºåŒ…å«å¤šä¸ªé¡µ</li></ol></li></ul><h3 id="æŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹"><a href="#æŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="æŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹"></a>æŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹</h3><ul><li>select <ol><li>ä½¿ç”¨è¿æ¥å™¨è¿æ¥mysql server,æœŸé—´é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹ show processlistæ¥æŸ¥çœ‹å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿æ¥äº†</li><li>æŸ¥è¯¢ç¼“å­˜(8.0) å·²æŠ›å¼ƒ</li><li>è§£æSQL ï¼š<ol><li>è¯æ³•åˆ†æï¼Œæ ¹æ®å­—ç¬¦ä¸²è¯†åˆ«å…³é”®è¯ï¼Œåˆ†ç±»å­—ç¬¦ä¸²</li><li>è¯­æ³•åˆ†æï¼Œè¯­æ³•è§£æå™¨ä¼šæ ¹æ®è¯­æ³•è§„åˆ™æ¥åˆ¤æ–­æ˜¯å¦ç¬¦åˆMySQLè¯­æ³•ç§’å¦‚æœæ²¡é—®é¢˜å°±ä¼šæ„å‡ºSQLè¯­æ³•æ ‘</li></ol></li><li>æ‰§è¡ŒSQLè¯­å¥ï¼Œ<code>SELECT</code>&nbsp;æŸ¥è¯¢è¯­å¥æµç¨‹ä¸»è¦å¯ä»¥åˆ†ä¸ºä¸‹é¢è¿™ä¸‰ä¸ªé˜¶æ®µï¼š<ul><li>prepare é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯é¢„å¤„ç†é˜¶æ®µï¼›æ£€æŸ¥è¡¨å’Œå­—æ®µæ˜¯å¦å­˜åœ¨ï¼Œå°†* æ‰©å±•ä¸ºè¡¨ä¸Šçš„åˆ—</li><li>optimize é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯ä¼˜åŒ–é˜¶æ®µï¼›<strong>ä¼˜åŒ–å™¨ä¸»è¦è´Ÿè´£å°† SQL æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæ–¹æ¡ˆç¡®å®šä¸‹æ¥</strong>ï¼Œæ¯”å¦‚åœ¨è¡¨é‡Œé¢æœ‰å¤šä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œä¼˜åŒ–å™¨ä¼šåŸºäºæŸ¥è¯¢æˆæœ¬çš„è€ƒè™‘ï¼Œæ¥å†³å®šé€‰æ‹©ä½¿ç”¨å“ªä¸ªç´¢å¼•ã€‚</li><li>execute é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œé˜¶æ®µï¼›æ ¹æ®æ‰§è¡Œè®¡åˆ’æ‰§è¡Œ SQL æŸ¥è¯¢è¯­å¥ï¼Œä»å­˜å‚¨å¼•æ“è¯»å–è®°å½•ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼›</li></ul></li></ol></li><li>MySQLä¸€è¡Œè®°å½•å¦‚ä½•<ul><li>æ¯å»ºç«‹ä¸€ä¸ªæ•°æ®åº“éƒ½ä¼šå’‹/var.lib/mysql/ä¸‹å»ºç«‹ä¸€ä¸ªåŒåçš„æ–‡ä»¶å¤¹</li><li>æ–‡ä»¶å¤¹ä¸­æœ‰ä¸‰ä¸ªæ–‡ä»¶</li><li>db.opt ç”¨æ¥å­˜å‚¨æ•°æ®åº“çš„é»˜è®¤å­—ç¬¦é›†å’Œå­—ç¬¦æ£€éªŒè§„åˆ™</li><li>tableNaem.frm å¯¹åº”çš„è¡¨ç»“æ„ä¼šä¿å­˜åœ¨è¿™ä¸ªæ–‡ä»¶ï¼Œä¸»è¦åŒ…å«è¡¨ç»“æ„çš„å®šä¹‰</li><li>tableName.ibd è¡¨ä¸­çš„æ•°æ®ä¼šä¿å­˜åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­</li></ul></li><li>è¡¨ç©ºé—´æ–‡ä»¶çš„ç»“æ„ ï¼š<ul><li><img src="/2023/08/02/58/%E8%A1%A8%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84.png"></li><li>æ®µ <ul><li>ç´¢å¼•æ®µï¼šå­˜æ”¾ B + æ ‘çš„éå¶å­èŠ‚ç‚¹çš„åŒºçš„é›†åˆï¼›</li><li>æ•°æ®æ®µï¼šå­˜æ”¾ B + æ ‘çš„å¶å­èŠ‚ç‚¹çš„åŒºçš„é›†åˆï¼›</li><li>å›æ»šæ®µï¼šå­˜æ”¾çš„æ˜¯å›æ»šæ•°æ®çš„åŒºçš„é›†åˆï¼Œä¹‹å‰è®²<a href="https://xiaolincoding.com/mysql/transaction/mvcc.html">äº‹åŠ¡éš”ç¦»&nbsp;(opens new window)</a>çš„æ—¶å€™å°±ä»‹ç»åˆ°äº† MVCC åˆ©ç”¨äº†å›æ»šæ®µå®ç°äº†å¤šç‰ˆæœ¬æŸ¥è¯¢æ•°æ®ã€‚</li></ul></li><li>åŒº InnoDB ä½¿ç”¨çš„æ˜¯B+æ ‘ ä»¥é¡µä¸ºå•ä½æ¥æ¥åˆ†é…ç©ºé—´æ—¶ï¼Œé“¾è¡¨ä¸­ç›¸é‚»çš„ä¸¤ä¸ªé¡µçš„ç‰©ç†ä½ç½®æ˜¯ä¸è¿ç»­çš„ï¼Œä¸ºäº†é˜²æ­¢éšæœºI/Oï¼Œå¯ä»¥æŒ‰ç…§åŒºæ¥åˆ†é…ï¼Œä¸€ä¸ªåŒºå¯ä»¥åŒ…å«å¤šä¸ªé¡µï¼Œè¿™æ ·é¡µåœ¨ä½ç½®ä¸Šå°±æ˜¯ç›¸é‚»çš„äº†å¯ä»¥ä½¿ç”¨é¡ºåºI/O</li><li>é¡µ è¯»å–æ•°æ®ä»¥é¡µä¸ºå•ä½ï¼Œå½“è¯»å–ä¸€è¡Œæ—¶ï¼Œä¼šå°†ä¸€é¡µä¸€åŒè¯»å–å‡ºæ¥ï¼Œæ”¾å…¥å†…å­˜ä¸­ é»˜è®¤é¡µ 16kb ,é¡µæ˜¯ InnoDB å­˜å‚¨å¼•æ“ç£ç›˜ç®¡ç†çš„æœ€å°å•å…ƒï¼Œ</li><li>è¡Œ è®°å½•æŒ‰ç…§è¡Œ<ul><li>è¡Œæ ¼å¼ï¼šCOMPACT <img src="/2023/08/02/58/compact.png"><ul><li>å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ï¼Œç”¨äºä¿å­˜æ•°æ®å ç”¨çš„å¤§å°ï¼Œ åœ¨åˆ—è¡¨ä¸­é‡‡ç”¨é€†åºå­˜æ”¾æ•°æ®å ç”¨çš„å®é™…å­—èŠ‚ï¼Œå½“ä¸€è¡Œä¸­æ²¡æœ‰å˜é•¿å­—æ®µæ—¶ï¼Œä¾‹å¦‚å…¨intæ—¶ï¼Œå°±ä¸ä¼šå­˜åœ¨å˜é•¿å­—æ®µåˆ—è¡¨äº†ã€‚</li><li>NULLåˆ—è¡¨ï¼Œæ•°æ®ä¸­ä¸ºNULL çš„æ•°æ®ä¼šæ”¾åœ¨NULLå€¼åˆ—è¡¨ä¸­çš„ã€‚NULLå€¼ä¹Ÿæ˜¯æŒ‰ç…§é€†åºå­˜å‚¨çš„ï¼Œä½¿ç”¨äºŒè¿›åˆ¶ 0 1 æ¥è¡¨ç¤ºæ˜¯å¦ä¸ºNULLå€¼ï¼Œ1 ä¸ºæ˜¯  <strong>å½“æ•°æ®è¡¨çš„å­—æ®µéƒ½å®šä¹‰æˆ NOT NULL çš„æ—¶å€™ï¼Œè¿™æ—¶å€™è¡¨é‡Œçš„è¡Œæ ¼å¼å°±ä¸ä¼šæœ‰ NULL å€¼åˆ—è¡¨äº†</strong>ã€‚</li><li>è®°å½•å¤´ä¿¡æ¯</li><li>delete_mask ï¼šæ ‡è¯†æ­¤æ¡æ•°æ®æ˜¯å¦è¢«åˆ é™¤ã€‚ä»è¿™é‡Œå¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬æ‰§è¡Œ detele åˆ é™¤è®°å½•çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šçœŸæ­£çš„åˆ é™¤è®°å½•ï¼Œåªæ˜¯å°†è¿™ä¸ªè®°å½•çš„ delete_mask æ ‡è®°ä¸º 1ã€‚</li><li>next_recordï¼šä¸‹ä¸€æ¡è®°å½•çš„ä½ç½®ã€‚ä»è¿™é‡Œå¯ä»¥çŸ¥é“ï¼Œè®°å½•ä¸è®°å½•ä¹‹é—´æ˜¯é€šè¿‡é“¾è¡¨ç»„ç»‡çš„ã€‚åœ¨å‰é¢æˆ‘ä¹Ÿæåˆ°äº†ï¼ŒæŒ‡å‘çš„æ˜¯ä¸‹ä¸€æ¡è®°å½•çš„ã€Œè®°å½•å¤´ä¿¡æ¯ã€å’Œã€ŒçœŸå®æ•°æ®ã€ä¹‹é—´çš„ä½ç½®ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å‘å·¦è¯»å°±æ˜¯è®°å½•å¤´ä¿¡æ¯ï¼Œå‘å³è¯»å°±æ˜¯çœŸå®æ•°æ®ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚</li><li>record_typeï¼šè¡¨ç¤ºå½“å‰è®°å½•çš„ç±»å‹ï¼Œ0è¡¨ç¤ºæ™®é€šè®°å½•ï¼Œ1è¡¨ç¤ºB+æ ‘éå¶å­èŠ‚ç‚¹è®°å½•ï¼Œ2è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ3è¡¨ç¤ºæœ€å¤§è®°å½•</li></ul></li><li>çœŸå®æ•°æ®éƒ¨åˆ†<ul><li>row_id æœªæŒ‡å®šä¸»é”®æˆ–è€…å”¯ä¸€çº¦æŸåˆ—æ—¶ï¼Œä¼šæœ‰ï¼Œå ç”¨6ä¸ªå­—èŠ‚</li><li>trx_idäº‹åŠ¡idè¡¨ç¤ºæ•°æ®ç”±å“ªä¸ªäº‹åŠ¡ç”Ÿæˆçš„ï¼Œå¿…éœ€</li><li>roll_pointer è®°å½•ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„æŒ‡é’ˆï¼Œå¿…éœ€</li></ul></li></ul></li><li><strong>ä¸€è¡Œæ•°æ®çš„æœ€å¤§å­—èŠ‚æ•° 65535(ä¸åŒ…å« TEXTã€BLOBs è¿™ç§å¤§å¯¹è±¡ç±»å‹)ï¼Œå…¶å®æ˜¯åŒ…å«ã€Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€å’Œ ã€ŒNULL å€¼åˆ—è¡¨ã€æ‰€å ç”¨çš„å­—èŠ‚æ•°çš„</strong></li><li>å¦‚æœä¸€ä¸ªæ•°æ®é¡µå­˜ä¸äº†ä¸€æ¡è®°å½•ï¼ŒInnoDB å­˜å‚¨å¼•æ“ä¼šè‡ªåŠ¨å°†æº¢å‡ºçš„æ•°æ®å­˜æ”¾åˆ°ã€Œæº¢å‡ºé¡µã€ä¸­ã€‚</li></ul></li></ul><p>Compact è¡Œæ ¼å¼é’ˆå¯¹è¡Œæº¢å‡ºçš„å¤„ç†æ˜¯è¿™æ ·çš„ï¼šå½“å‘ç”Ÿè¡Œæº¢å‡ºæ—¶ï¼Œåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„åªä¼šä¿å­˜è¯¥åˆ—çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œè€ŒæŠŠå‰©ä½™çš„æ•°æ®æ”¾åœ¨ã€Œæº¢å‡ºé¡µã€ä¸­ï¼Œç„¶åçœŸå®æ•°æ®å¤„ç”¨ 20 å­—èŠ‚å­˜å‚¨æŒ‡å‘æº¢å‡ºé¡µçš„åœ°å€ï¼Œä»è€Œå¯ä»¥æ‰¾åˆ°å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µã€‚</p><p>Compressed å’Œ Dynamic è¿™ä¸¤ç§æ ¼å¼é‡‡ç”¨å®Œå…¨çš„è¡Œæº¢å‡ºæ–¹å¼ï¼Œè®°å½•çš„çœŸå®æ•°æ®å¤„ä¸ä¼šå­˜å‚¨è¯¥åˆ—çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œåªå­˜å‚¨ 20 ä¸ªå­—èŠ‚çš„æŒ‡é’ˆæ¥æŒ‡å‘æº¢å‡ºé¡µã€‚è€Œå®é™…çš„æ•°æ®éƒ½å­˜å‚¨åœ¨æº¢å‡ºé¡µä¸­ã€‚<br>ç´¢å¼•åˆ†ç±»ï¼š</p><ul><li>æŒ‰ã€Œæ•°æ®ç»“æ„ã€åˆ†ç±»ï¼š<strong>B+treeç´¢å¼•ã€Hashç´¢å¼•ã€Full-textç´¢å¼•</strong>ã€‚</li><li>æŒ‰ã€Œç‰©ç†å­˜å‚¨ã€åˆ†ç±»ï¼š<strong>èšç°‡ç´¢å¼•ï¼ˆä¸»é”®ç´¢å¼•ï¼‰ã€äºŒçº§ç´¢å¼•ï¼ˆè¾…åŠ©ç´¢å¼•ï¼‰</strong>ã€‚</li><li>æŒ‰ã€Œå­—æ®µç‰¹æ€§ã€åˆ†ç±»ï¼š<strong>ä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•ã€å‰ç¼€ç´¢å¼•</strong>ã€‚</li><li>æŒ‰ã€Œå­—æ®µä¸ªæ•°ã€åˆ†ç±»ï¼š<strong>å•åˆ—ç´¢å¼•ã€è”åˆç´¢å¼•</strong>ã€‚</li></ul><h3 id="MySqlæŸ¥è¯¢ä¼˜åŒ–"><a href="#MySqlæŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="MySqlæŸ¥è¯¢ä¼˜åŒ–"></a>MySqlæŸ¥è¯¢ä¼˜åŒ–</h3><ul><li>å•è¡¨ <ol><li>æ ¹æ®æœç´¢æ¡ä»¶ï¼Œæ‰¾å‡ºæ‰€æœ‰å¯èƒ½ä½¿ç”¨çš„ç´¢å¼•</li><li>è®¡ç®—å…¨è¡¨æ‰«æçš„ä»£ä»·</li><li>è®¡ç®—ä½¿ç”¨ä¸åŒç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢çš„ä»£ä»·</li><li>å¯¹æ¯”å„ç§æ‰§è¡Œæ–¹æ¡ˆçš„ä»£ä»·ï¼Œæ‰¾å‡ºæˆæœ¬æœ€ä½çš„é‚£ä¸€ä¸ª</li></ol></li><li>å¤šè¡¨è¿æ¥ï¼š<ol><li>å•æ¬¡æŸ¥è¯¢é©±åŠ¨è¡¨çš„æˆæœ¬</li><li>å¤šæ¬¡æŸ¥è¯¢è¢«é©±åŠ¨è¡¨çš„æˆæœ¬ï¼ˆå…·ä½“æŸ¥è¯¢å¤šå°‘æ¬¡å–å†³äºå¯¹é©±åŠ¨è¡¨æŸ¥è¯¢çš„ç»“æœé›†ä¸­æœ‰å¤šå°‘æ¡è®°å½•ï¼‰</li></ol></li><li>è¿æ¥æŸ¥è¯¢æˆæœ¬å å¤§å¤´çš„å…¶å®æ˜¯ é©±åŠ¨è¡¨æ‰‡å‡ºæ•° x å•æ¬¡è®¿é—®è¢«é©±åŠ¨è¡¨çš„æˆæœ¬ ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¼˜åŒ–<ol><li>é‡ç‚¹å…¶å®æ˜¯ä¸‹è¾¹è¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼š</li><li>å°½é‡å‡å°‘é©±åŠ¨è¡¨çš„æ‰‡å‡º</li><li>å¯¹è¢«é©±åŠ¨è¡¨çš„è®¿é—®æˆæœ¬å°½é‡ä½</li></ol></li></ul><h3 id="Buffer-Pool-ç¼“å†²æ± "><a href="#Buffer-Pool-ç¼“å†²æ± " class="headerlink" title="Buffer Pool ç¼“å†²æ± "></a>Buffer Pool ç¼“å†²æ± </h3><p>è„é¡µï¼šç¼“å†²æ± ä¸­çš„æ•°æ®å·²ç»ä¿®æ”¹ä½†æ˜¯æ²¡æœ‰åŒæ­¥åˆ°ç£ç›˜ä¸­</p><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><h3 id="æ¨¡å¼"><a href="#æ¨¡å¼" class="headerlink" title="æ¨¡å¼"></a>æ¨¡å¼</h3><ul><li>æ¨¡å¼: é€»è¾‘æ¨¡å¼ï¼Œæ˜¯å¼€å‘è€…å¯è§çš„æ¨¡å¼ï¼Œæ˜¯æ•°æ®åº“ä¸­å…¨ä½“æ•°æ®çš„é€»è¾‘ç»“æ„å’Œç‰¹å¾çš„æè¿°ï¼Œæ˜¯æ‰€æœ‰ç”¨æˆ·çš„å…¬å…±æ•°æ®è§†å›¾ã€‚</li><li>å¤–æ¨¡å¼:å­æ¨¡å¼ï¼Œç”¨æˆ·æ¨¡å¼ï¼Œç”¨æˆ·å¯è§</li><li>å†…æ¨¡å¼: å­˜å‚¨æ¨¡å¼ï¼Œæ˜¯ç‰©ç†å­˜å‚¨æ¨¡å¼</li></ul><h2 id="schema-å’Œ-database-åŒºåˆ«"><a href="#schema-å’Œ-database-åŒºåˆ«" class="headerlink" title="schema å’Œ database åŒºåˆ«"></a>schema å’Œ database åŒºåˆ«</h2><p>database æ˜¯ä¸€æ ‹æ¥¼ï¼Œschema(æ¨¡å¼) æ˜¯ä¸€ä¸ªä¸ªæˆ¿é—´ï¼Œä½†æ˜¯åœ¨mysqlä¸­ä¸¤ç§æ²¡æœ‰åŒºåˆ«ã€‚</p><ul><li>è§†å›¾å’Œè¡¨çš„åŒºåˆ«ï¼šè§†å›¾æ˜¯è¡¨çš„å­é›†ï¼Œå¸¸ç”¨äºå°†æŸ¥è¯¢ç»“æœä¿å­˜åœ¨è§†å›¾ä¸­ï¼Œæ–¹ä¾¿å†æ¬¡è°ƒç”¨</li><li>è¯­æ³•ï¼šâ€™CREATE VIEW viewName AS æŸ¥è¯¢å‡ºæ¥çš„è¡¨â€™</li></ul><h2 id="èŒƒå¼"><a href="#èŒƒå¼" class="headerlink" title="èŒƒå¼"></a>èŒƒå¼</h2><ul><li>1NF ä¿è¯åŸå­æ€§å³å¯ï¼Œä¸å¯å†åˆ†å‰²äº†</li><li>2NF è¦æœ‰ä¸»é”®ï¼Œä¸”ä¸å­˜åœ¨éƒ¨ä»½ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯å…¶ä»–éä¸»é”®çš„éƒ¨åˆ†è¦æ²»ç†æ¥äºä¸»é”®å³å¯</li><li>3NF éä¸»é”®ä¹‹é—´ä¸å­˜åœ¨ä¼ é€’ä¾èµ–ï¼Œä¾‹å¦‚ å­¦å·, å§“å, å¹´é¾„, å­¦é™¢åç§°, å­¦é™¢ç”µè¯ï¼Œæ»¡è¶³ç¬¬äºŒèŒƒå¼ï¼Œå› ä¸ºåé¢å‡ ä¸ªå±æ€§éƒ½è¦å’Œä¸»é”®ç›¸å…³è”ï¼Œä¸èƒ½ç‹¬ç«‹å­˜åœ¨ï¼Œä½†æ˜¯é€šè¿‡ å­¦å· -&gt; å­¦ç”Ÿ -&gt; æ‰€åœ¨é™¢ -&gt; é™¢ç”µè¯ ï¼Œæ‰€ä»¥å­˜åœ¨ä¼ é€’ä¾èµ–åº”ä¿®æ”¹ä¸ºï¼šå­¦ç”Ÿï¼š(å­¦å·, å§“å, å¹´é¾„, æ‰€åœ¨å­¦é™¢)ï¼›å­¦é™¢ï¼š(å­¦é™¢ï¼Œå­¦é™¢åç§°ï¼Œ ç”µè¯)ã€‚</li><li>BCNF æ¶ˆé™¤å‡ ä¸ªä¸»é”®ä¹‹é—´çš„ä¼ é€’ä¾èµ–</li></ul><h2 id="ACID"><a href="#ACID" class="headerlink" title="ACID"></a><a href="https://xiaolincoding.com/mysql/transaction/mvcc.html#%E4%BA%8B%E5%8A%A1%E6%9C%89%E5%93%AA%E4%BA%9B%E7%89%B9%E6%80%A7">ACID</a></h2><ul><li><p>Atomicityï¼ˆåŸå­æ€§ï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡ï¼ˆtransactionï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«æ¢å¤ï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚</p></li><li><p>Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ï¼šåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾è§„åˆ™ï¼Œè¿™åŒ…å«èµ„æ–™çš„ç²¾ç¡®åº¦ã€ä¸²è”æ€§ä»¥åŠåç»­æ•°æ®åº“å¯ä»¥è‡ªå‘æ€§åœ°å®Œæˆé¢„å®šçš„å·¥ä½œã€‚</p></li><li><p>Isolationï¼ˆéš”ç¦»æ€§ï¼‰ï¼šæ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬è¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰ã€è¯»æäº¤ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ã€‚</p></li><li><p>Durabilityï¼ˆæŒä¹…æ€§ï¼‰ï¼šäº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p></li></ul><h2 id="E-Ræ¨¡å‹"><a href="#E-Ræ¨¡å‹" class="headerlink" title="E-Ræ¨¡å‹"></a>E-Ræ¨¡å‹</h2><p>E-Ræ¨¡å‹æ˜¯Entity-Relationshipæ¨¡å‹çš„ç¼©å†™ï¼Œæ˜¯ä¸€ç§ç”¨äºæ•°æ®åº“è®¾è®¡çš„æ¦‚å¿µæ€§æ•°æ®æ¨¡å‹ã€‚å®ƒç”¨æ¥æè¿°ç°å®ä¸–ç•Œä¸­çš„æ•°æ®ä¹‹é—´çš„å…³ç³»ï¼Œä»¥åŠè¿™äº›æ•°æ®çš„å±æ€§ã€‚E-Ræ¨¡å‹æä¾›äº†ä¸€ç§å›¾å½¢åŒ–çš„æ–¹å¼æ¥è¡¨ç¤ºæ•°æ®æ¨¡å‹ï¼Œä½¿æ•°æ®åº“è®¾è®¡å¸ˆèƒ½å¤Ÿæ›´å®¹æ˜“åœ°ç†è§£å’Œè§„åˆ’æ•°æ®åº“ç»“æ„ã€‚</p><p>E-Ræ¨¡å‹åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š</p><ol><li><p>å®ä½“ï¼ˆEntityï¼‰ï¼šå®ä½“æ˜¯ç°å®ä¸–ç•Œä¸­å¯ä»¥è¢«è¯†åˆ«çš„ç‹¬ç«‹å¯¹è±¡ï¼Œä¾‹å¦‚äººã€ç‰©å“ã€åœ°ç‚¹æˆ–æ¦‚å¿µã€‚æ¯ä¸ªå®ä½“éƒ½æœ‰ä¸€äº›å±æ€§ï¼Œç”¨æ¥æè¿°è¿™ä¸ªå®ä½“çš„ç‰¹å¾ã€‚</p></li><li><p>å±æ€§ï¼ˆAttributeï¼‰ï¼šå±æ€§æ˜¯æè¿°å®ä½“çš„ç‰¹å¾æˆ–å±æ€§ï¼Œå®ƒä»¬ç”¨æ¥å­˜å‚¨æœ‰å…³å®ä½“çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªâ€äººâ€å®ä½“ï¼Œå±æ€§å¯ä»¥åŒ…æ‹¬å§“åã€å¹´é¾„ã€æ€§åˆ«ç­‰ã€‚</p></li><li><p>å…³ç³»ï¼ˆRelationshipï¼‰ï¼šå…³ç³»è¡¨ç¤ºä¸åŒå®ä½“ä¹‹é—´çš„è”ç³»æˆ–è¿æ¥ã€‚å…³ç³»å¯ä»¥æ˜¯ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šæˆ–å¤šå¯¹å¤šçš„ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªâ€é›‡å‘˜â€å®ä½“å¯ä»¥ä¸ä¸€ä¸ªâ€éƒ¨é—¨â€å®ä½“ä¹‹é—´æœ‰ä¸€ä¸ªâ€å±äºâ€å…³ç³»ï¼Œè¡¨ç¤ºé›‡å‘˜å±äºæŸä¸ªéƒ¨é—¨ã€‚</p></li><li><p>ä¸»é”®ï¼ˆPrimary Keyï¼‰ï¼šä¸»é”®æ˜¯ä¸€ä¸ªå±æ€§æˆ–å±æ€§ç»„åˆï¼Œç”¨æ¥å”¯ä¸€æ ‡è¯†å®ä½“é›†ä¸­çš„æ¯ä¸ªå®ä½“ã€‚å®ƒç¡®ä¿äº†æ¯ä¸ªå®ä½“éƒ½å…·æœ‰å”¯ä¸€çš„æ ‡è¯†ã€‚</p></li><li><p>å¤–é”®ï¼ˆForeign Keyï¼‰ï¼šå¤–é”®æ˜¯ä¸€ä¸ªå®ä½“ä¸­çš„å±æ€§ï¼Œå®ƒå¼•ç”¨äº†å¦ä¸€ä¸ªå®ä½“çš„ä¸»é”®ï¼Œç”¨äºå»ºç«‹å®ä½“ä¹‹é—´çš„å…³è”ã€‚</p></li></ol><p>é€šè¿‡ä½¿ç”¨E-Ræ¨¡å‹ï¼Œæ•°æ®åº“è®¾è®¡å¸ˆå¯ä»¥æ›´å¥½åœ°ç†è§£æ•°æ®ä¹‹é—´çš„å…³ç³»ï¼Œä»è€Œè§„åˆ’æ•°æ®åº“çš„ç»“æ„ï¼ŒåŒ…æ‹¬è¡¨çš„è®¾è®¡ã€å…³ç³»çš„å»ºç«‹å’Œæ•°æ®çš„å­˜å‚¨ã€‚ä¸€æ—¦E-Ræ¨¡å‹å®Œæˆï¼Œå®ƒå¯ä»¥ç”¨ä½œè®¾è®¡æ•°æ®åº“æ¶æ„çš„åŸºç¡€ï¼Œè¿›è€Œåˆ›å»ºç‰©ç†æ•°æ®åº“æ¨¡å¼ï¼ˆå¦‚å…³ç³»æ¨¡å‹ï¼‰ï¼Œä»¥å®é™…å­˜å‚¨å’Œç®¡ç†æ•°æ®ã€‚è¿™æœ‰åŠ©äºç¡®ä¿æ•°æ®åº“èƒ½å¤Ÿæœ‰æ•ˆåœ°å­˜å‚¨å’Œæ£€ç´¢ä¿¡æ¯ï¼Œå¹¶æ»¡è¶³åº”ç”¨ç¨‹åºçš„éœ€æ±‚ã€‚</p><h2 id="è‡ªè”ç»“ï¼Œå˜é‡ä¸ä¼šï¼Œè¡¥ä¸€è¡¥å»"><a href="#è‡ªè”ç»“ï¼Œå˜é‡ä¸ä¼šï¼Œè¡¥ä¸€è¡¥å»" class="headerlink" title="è‡ªè”ç»“ï¼Œå˜é‡ä¸ä¼šï¼Œè¡¥ä¸€è¡¥å»"></a>è‡ªè”ç»“ï¼Œå˜é‡ä¸ä¼šï¼Œè¡¥ä¸€è¡¥å»</h2><p>æ‰“å¼€</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>æ•°æ®ç±»å‹</strong></p><p>å…³ç³»å‹æ•°æ®åº“ï¼šå»ºç«‹åœ¨å…³ç³»æ¨¡å‹åŸºç¡€ä¸Šï¼Œç”±å¤šå¼ ç›¸äº’é“¾æ¥çš„äºŒç»´è¡¨ç»„æˆçš„æ•°æ®åº“</p><h2 id="SQLè¯­å¥"><a href="#SQLè¯­å¥" class="headerlink" title="SQLè¯­å¥"></a>SQLè¯­å¥</h2><ol><li><p><strong>æ•°å€¼ç±»å‹</strong></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">TINYINT 1byte -128 - 127  0 - 255 /*åé¢åŠ ä¸Šunsigned å³å¯æŒ‡å®šä¸ºæ— ç¬¦å·*/SMALLINT 2MEDIUMINT 3INT 4BIGINT 8FLOAT 4DOUBLE 8DECIMAL çœ‹ç²¾åº¦å’Œæ ‡åº¦  125.25 ç²¾åº¦ä¸º5 æ ‡åº¦ä¸º2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>å­—ç¬¦ä¸²ç±»å‹</strong></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CHAR() å®šé•¿å­—ç¬¦ä¸²VARCHAR æ ¹æ®å†…å®¹è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦TINYTEXT çŸ­æ–‡æœ¬å­—ç¬¦ä¸²<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p><strong>æ—¥æœŸç±»</strong></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">DATE YYYY-MM-DDTIME HH:MM:SSYEAR YYYYDATETIME YYYY-MM-DD HH:MM:SSTIMESTAMP YYYY-MM-DD HH:MM:SS æ—¶é—´æˆ³<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¸¸ç”¨å‡½æ•°</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">DATE_FORMAT()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>æ—¶é—´æˆ³è®°</strong>æˆ–ç§°ä¸º<strong>æ—¶é—´æ ‡è®°</strong>ï¼ˆè‹±è¯­ï¼štimestampï¼‰æ˜¯æŒ‡å­—ç¬¦ä¸²æˆ–ç¼–ç ä¿¡æ¯ç”¨äºè¾¨è¯†è®°å½•ä¸‹æ¥çš„æ—¶é—´æ—¥æœŸã€‚å›½é™…æ ‡å‡†ä¸º<a href="https://zh.wikipedia.org/wiki/ISO_8601" title="ISO 8601">ISO 8601</a>ã€‚</p><p>æ—¶é—´æˆ³è®°çš„èŒƒä¾‹å¦‚ä¸‹ï¼š</p><ul><li>2016-12-25T00:15:22Z</li><li>2005-10-30 10:45&nbsp;<a href="https://zh.wikipedia.org/wiki/UTC" title="UTC">UTC</a></li><li>Sat Jul 23 02:16:57 2005</li><li>2016å¹´12æœˆ25æ—¥ (æ—¥) 00:14 (UTC)</li></ul></blockquote></li></ol><p>æ³¨é‡Š # æˆ–è€… /**/</p><ol><li>DDL (Data Definition Language æ•°æ®å®šä¹‰è¯­è¨€ï¼‰ç”¨äºæ“ä½œå¯¹è±¡åŠå¯¹è±¡æœ¬èº«ï¼Œè¿™ç§å¯¹è±¡åŒ…æ‹¬æ•°æ®åº“,è¡¨å¯¹è±¡ï¼ŒåŠè§†å›¾å¯¹è±¡ï¼Œè¡¨å¤´ ^c501f6</li><li>DML ï¼ˆData Manipulation Language æ•°æ®æ“æ§è¯­è¨€) ç”¨äºæ“ä½œæ•°æ®åº“å¯¹è±¡å¯¹è±¡ä¸­åŒ…å«çš„æ•°æ®</li><li>DQL (Data Query Language æ•°æ®æŸ¥è¯¢è¯­è¨€ )ç”¨äºæŸ¥è¯¢æ•°æ®</li><li>DCL ï¼ˆData Control Language æ•°æ®æ§åˆ¶è¯­å¥ï¼‰ ç”¨äºæ“ä½œæ•°æ®åº“å¯¹è±¡çš„æƒé™</li></ol><h3 id="DDL-Data-Definition-Language-æ•°æ®å®šä¹‰è¯­è¨€ï¼‰ç”¨äºæ“ä½œå¯¹è±¡åŠå¯¹è±¡æœ¬èº«ï¼Œè¿™ç§å¯¹è±¡åŒ…æ‹¬æ•°æ®åº“-è¡¨å¯¹è±¡ï¼ŒåŠè§†å›¾å¯¹è±¡ï¼Œè¡¨å¤´"><a href="#DDL-Data-Definition-Language-æ•°æ®å®šä¹‰è¯­è¨€ï¼‰ç”¨äºæ“ä½œå¯¹è±¡åŠå¯¹è±¡æœ¬èº«ï¼Œè¿™ç§å¯¹è±¡åŒ…æ‹¬æ•°æ®åº“-è¡¨å¯¹è±¡ï¼ŒåŠè§†å›¾å¯¹è±¡ï¼Œè¡¨å¤´" class="headerlink" title="DDL (Data Definition Language æ•°æ®å®šä¹‰è¯­è¨€ï¼‰ç”¨äºæ“ä½œå¯¹è±¡åŠå¯¹è±¡æœ¬èº«ï¼Œè¿™ç§å¯¹è±¡åŒ…æ‹¬æ•°æ®åº“,è¡¨å¯¹è±¡ï¼ŒåŠè§†å›¾å¯¹è±¡ï¼Œè¡¨å¤´"></a>DDL (Data Definition Language æ•°æ®å®šä¹‰è¯­è¨€ï¼‰ç”¨äºæ“ä½œå¯¹è±¡åŠå¯¹è±¡æœ¬èº«ï¼Œè¿™ç§å¯¹è±¡åŒ…æ‹¬æ•°æ®åº“,è¡¨å¯¹è±¡ï¼ŒåŠè§†å›¾å¯¹è±¡ï¼Œè¡¨å¤´</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SHOW DATABASES æŸ¥è¯¢æ‰€æœ‰çš„æ•°æ®åº“SELECT DATABASE(); æŸ¥è¯¢å½“å‰æ‰€å¤„æ•°æ®åº“CREATE DATABASE  åˆ›å»ºDROP DATABASE XXX åˆ é™¤USE xxx  ä½¿ç”¨æ•°æ®åº“SHOW TABLES æŸ¥è¯¢å½“å‰æ•°æ®åº“çš„æ‰€æœ‰è¡¨DESC è¡¨å   æŸ¥è¯¢è¡¨ç»“æ„SHOW CREATE TABLE è¡¨æ˜ æŸ¥è¯¢æŒ‡å®šè¡¨çš„å»ºè¡¨è¯­å¥å­—æ®µ1 å­—æ®µ1ç±»å‹ COMMENT 'XXX',/*æ³¨é‡Š*/     ........    ) COMMENTT 'XXX'/*æ³¨é‡Šå¯ä»¥çœç•¥*//*å­—ç¬¦ä¸²ç±»å‹æ˜¯varchar(æŒ‡å®šçš„å­—ç¬¦é•¿åº¦)*//*ä¿®æ”¹è¡¨*/ALTER TABLE tablename 1.ADDå­—æ®µå ç±»å‹ comment xxx æ·»åŠ è¡¨å¤´2.CHANGE æ—§ æ–° ç±»å‹ comment xxx ä¿®æ”¹3.DROP name4.RENAME TO name ä¿®æ”¹è¡¨åDROP TABLE name åˆ é™¤TRUNCATE TABLE name åˆ é™¤å¹¶é‡æ–°åˆ›å»ºåŒåè¡¨ï¼Œæ•°æ®ä¾æ—§ä¼šåˆ é™¤<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="DML-ï¼ˆData-Manipulation-Language-æ•°æ®æ“æ§è¯­è¨€-ç”¨äºæ“ä½œæ•°æ®åº“å¯¹è±¡å¯¹è±¡ä¸­åŒ…å«çš„æ•°æ®"><a href="#DML-ï¼ˆData-Manipulation-Language-æ•°æ®æ“æ§è¯­è¨€-ç”¨äºæ“ä½œæ•°æ®åº“å¯¹è±¡å¯¹è±¡ä¸­åŒ…å«çš„æ•°æ®" class="headerlink" title="DML ï¼ˆData Manipulation Language æ•°æ®æ“æ§è¯­è¨€) ç”¨äºæ“ä½œæ•°æ®åº“å¯¹è±¡å¯¹è±¡ä¸­åŒ…å«çš„æ•°æ®"></a>DML ï¼ˆData Manipulation Language æ•°æ®æ“æ§è¯­è¨€) ç”¨äºæ“ä½œæ•°æ®åº“å¯¹è±¡å¯¹è±¡ä¸­åŒ…å«çš„æ•°æ®</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">/*æ·»åŠ æ•°æ®*/INSERT INTO è¡¨å(å­—æ®µå) VALUES (æ•°å€¼) ç»™æŒ‡å®šå­—æ®µæ·»åŠ æ•°æ®INSERT INTO è¡¨å  VALUES (æ•°å€¼) ç»™æ‰€æœ‰å­—æ®µåŠ ä¸Šæ•°æ®INSERT INTO è¡¨æ˜(å­—æ®µå) VALUES (æ•°æ®) ,(æ•°æ®)INSERT INTO è¡¨æ˜ VALUE (æ•°æ®),(æ•°æ®).../*ä¿®æ”¹*/UPDATE è¡¨å SET å­—æ®µå=å€¼, .... WHERE æ¡ä»¶DELETE è¡¨å (WHERE æ¡ä»¶) /*åˆ é™¤*/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h4><p>è¯­å¥ï¼šINSERT</p><p>å‰æ:<em><strong><u>è·å¾—æƒé™</u></strong></em></p><p>ç”¨æ³•ï¼š</p><blockquote><p>ï± æ’å…¥å®Œæ•´çš„è¡Œï¼›</p><p>ï± æ’å…¥è¡Œçš„ä¸€éƒ¨åˆ†ï¼›</p><p>ï± æ’å…¥æŸäº›æŸ¥è¯¢çš„ç»“æœã€‚</p></blockquote><p>è¯­æ³•ï¼š</p>   <pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">INSERT INTO Customers VALUES('1000000006',  'Toy Land',  '123 Any Street',  'New York',  'NY',  '11111',  'USA',  NULL,  NULL);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>   æ›´åŠ å®‰å…¨çš„æ“ä½œ,å°†è¦æ’å…¥çš„åˆ—ä¹Ÿåˆ—å‡º</p>   <pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">INSERT INTO Customers(cust_id,  cust_name,  cust_address,  cust_city,  cust_state,  cust_zip,  cust_country,  cust_contact,  cust_email) VALUES('1000000006',  'Toy Land',  '123 Any Street',  'New York',  'NY',  '11111',  'USA',  NULL,  NULL);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li><p>æ’å…¥åˆ—çš„ä¸€éƒ¨åˆ†ï¼Œè¯­æ³•å’Œä¸Šé¢ä¸€æ ·ï¼Œåªæ˜¯ä¸éœ€è¦æ’å…¥çš„åˆ—å¯ä»¥çœç•¥ä¸å†™ï¼Œåˆ—åä¸å†™ï¼Œå¯¹åº”çš„æ•°æ®ä¹Ÿä¸å†™</p></li><li><p>æ’å…¥æ£€ç´¢å‡ºçš„æ•°æ®</p><p>è¯­æ³•ï¼š</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT cust_id,  cust_contact,  cust_email,  cust_name,  cust_address,  cust_city,  cust_state,  cust_zip,  cust_country FROM CustNew;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><u>å®ƒä½¿ç”¨çš„æ˜¯åˆ—çš„ä½ç½®ï¼Œå› æ­¤ SELECT ä¸­çš„ç¬¬ä¸€åˆ—ï¼ˆä¸ç®¡</u></p><p><u>å…¶åˆ—åï¼‰å°†ç”¨æ¥å¡«å……è¡¨åˆ—ä¸­æŒ‡å®šçš„ç¬¬ä¸€åˆ—ï¼Œç¬¬äºŒåˆ—å°†ç”¨æ¥å¡«å……è¡¨åˆ—ä¸­</u></p><p><u>æŒ‡å®šçš„ç¬¬äºŒåˆ—ï¼Œå¦‚æ­¤ç­‰ç­‰</u></p><p>INSERT SELECT ä¸­ SELECT è¯­å¥å¯ä»¥åŒ…å« WHERE å­å¥ï¼Œä»¥è¿‡æ»¤æ’å…¥çš„æ•°æ®ã€‚</p><p>INSERT é€šå¸¸åªæ’å…¥ä¸€è¡Œã€‚è¦æ’å…¥å¤šè¡Œï¼Œå¿…é¡»æ‰§è¡Œå¤šä¸ª INSERT è¯­å¥ã€‚</p><p>INSERT SELECTæ˜¯ä¸ªä¾‹å¤–ï¼Œå®ƒå¯ä»¥ç”¨ä¸€æ¡INSERTæ’å…¥å¤šè¡Œï¼Œä¸ç®¡SELECT</p><p>è¯­å¥è¿”å›å¤šå°‘è¡Œï¼Œéƒ½</p></li><li><p>ä»ä¸€ä¸ªè¡¨å¤åˆ¶åˆ°å¦ä¸€ä¸ªè¡¨</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE CustCopy AS SELECT * FROM Customers;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><u>SELECT INTO æ˜¯è¯•éªŒæ–° SQL è¯­å¥å‰è¿›è¡Œè¡¨å¤åˆ¶çš„å¾ˆå¥½å·¥å…·ã€‚å…ˆè¿›è¡Œå¤</u></p><p><u>åˆ¶ï¼Œå¯åœ¨å¤åˆ¶çš„æ•°æ®ä¸Šæµ‹è¯• SQL ä»£ç ï¼Œè€Œä¸ä¼šå½±å“å®é™…çš„æ•°æ®ã€‚</u></p><h2 id="æ›´æ–°ä¸åˆ é™¤"><a href="#æ›´æ–°ä¸åˆ é™¤" class="headerlink" title="æ›´æ–°ä¸åˆ é™¤"></a>æ›´æ–°ä¸åˆ é™¤</h2><h3 id="æ›´æ–°ï¼šUPDATE-æ³¨æ„è¦ç”¨WHERE-å¦åˆ™ä¼šå‡ºäº‹"><a href="#æ›´æ–°ï¼šUPDATE-æ³¨æ„è¦ç”¨WHERE-å¦åˆ™ä¼šå‡ºäº‹" class="headerlink" title="æ›´æ–°ï¼šUPDATE æ³¨æ„è¦ç”¨WHERE å¦åˆ™ä¼šå‡ºäº‹"></a>æ›´æ–°ï¼šUPDATE æ³¨æ„è¦ç”¨WHERE å¦åˆ™ä¼šå‡ºäº‹</h3><ol><li><p>æ›´æ–°ç‰¹å®šè¡Œ</p><p>è¯­æ³•ï¼š</p><p>ï± è¦æ›´æ–°çš„è¡¨ï¼›</p><p>ï± åˆ—åå’Œå®ƒä»¬çš„æ–°å€¼ï¼›</p><p>ï± ç¡®å®šè¦æ›´æ–°å“ªäº›è¡Œçš„è¿‡æ»¤æ¡ä»¶ã€‚</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">UPDATE Customers SET cust_email = 'kim@thetoystore.com' WHERE cust_id = '1000000005';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>UPDATE è¯­å¥ä»¥ WHERE å­å¥ç»“æŸï¼Œå®ƒå‘Šè¯‰ DBMS æ›´æ–°å“ªä¸€è¡Œã€‚æ²¡æœ‰ WHERE</p><p>å­å¥ï¼ŒDBMS å°†ä¼šç”¨è¿™ä¸ªç”µå­é‚®ä»¶åœ°å€æ›´æ–° Customers è¡¨ä¸­çš„æ‰€æœ‰è¡Œï¼Œ</p><p>è¿™ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çš„ã€‚</p></blockquote></li><li><p>æ›´æ–°ç‰¹å®šåˆ—</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">UPDATE Customers SET cust_contact = 'Sam Roberts',  cust_email = 'sam@toyland.com' WHERE cust_id = '1000000006';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>åœ¨æ›´æ–°å¤šä¸ªåˆ—æ—¶ï¼Œåªéœ€è¦ä½¿ç”¨ä¸€æ¡ SET å‘½ä»¤ï¼Œæ¯ä¸ªâ€œåˆ—=å€¼â€å¯¹ä¹‹é—´ç”¨</p><p>UPDATE è¯­å¥ä¸­å¯ä»¥ä½¿ç”¨å­æŸ¥è¯¢ï¼Œä½¿å¾—èƒ½ç”¨ SELECT è¯­å¥æ£€ç´¢å‡ºçš„æ•°æ®</p><p>æ›´æ–°åˆ—æ•°æ®</p><p>è¦åˆ é™¤æŸä¸ªåˆ—çš„å€¼ï¼Œå¯è®¾ç½®å®ƒä¸º NULLï¼ˆå‡å¦‚è¡¨å®šä¹‰å…è®¸ NULL å€¼ï¼‰</p></blockquote></li></ol></li></ol><h4 id="åˆ é™¤æ•°æ®"><a href="#åˆ é™¤æ•°æ®" class="headerlink" title="åˆ é™¤æ•°æ®"></a>åˆ é™¤æ•°æ®</h4><p>DELETE  æ³¨æ„WHERE ç¼ºå°‘æ˜¯ä¼šå‡ºäº‹çš„</p><p>ï± ä»è¡¨ä¸­åˆ é™¤ç‰¹å®šçš„è¡Œ</p><p>ï± ä»è¡¨ä¸­åˆ é™¤æ‰€æœ‰è¡Œã€‚</p><ol><li><p>åˆ é™¤ç‰¹å®šè¡Œ</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">DELETE FROM Customers WHERE cust_id = '1000000006';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>DELETE è¯­å¥ä»è¡¨ä¸­åˆ é™¤è¡Œï¼Œç”šè‡³æ˜¯åˆ é™¤è¡¨ä¸­æ‰€æœ‰è¡Œã€‚ä½†æ˜¯ï¼ŒDELETE</p><p>ä¸åˆ é™¤è¡¨æœ¬èº«</p><p>æœæƒ³ä»è¡¨ä¸­åˆ é™¤æ‰€æœ‰è¡Œï¼Œä¸è¦ä½¿ç”¨ DELETEã€‚å¯ä½¿ç”¨ TRUNCATE +TABLE +è¡¨å</p><p>è¯­å¥ï¼Œå®ƒå®Œæˆç›¸åŒçš„å·¥ä½œï¼Œè€Œé€Ÿåº¦æ›´å¿«ï¼ˆå› ä¸ºä¸è®°å½•æ•°æ®çš„å˜åŠ¨ï¼‰ã€‚</p></blockquote></li><li><p>åˆ é™¤å…¨éƒ¨è¡Œ</p><blockquote><p>å¦‚æœæ‰§è¡Œ DELETE è¯­å¥è€Œä¸å¸¦ WHERE</p><p>å­å¥ï¼Œè¡¨çš„æ‰€æœ‰æ•°æ®éƒ½å°†è¢«åˆ é™¤</p></blockquote></li></ol><h3 id="DQL-Data-Query-Language-æ•°æ®æŸ¥è¯¢è¯­è¨€-ç”¨äºæŸ¥è¯¢æ•°æ®"><a href="#DQL-Data-Query-Language-æ•°æ®æŸ¥è¯¢è¯­è¨€-ç”¨äºæŸ¥è¯¢æ•°æ®" class="headerlink" title="DQL (Data Query Language æ•°æ®æŸ¥è¯¢è¯­è¨€ )ç”¨äºæŸ¥è¯¢æ•°æ®"></a>DQL (Data Query Language æ•°æ®æŸ¥è¯¢è¯­è¨€ )ç”¨äºæŸ¥è¯¢æ•°æ®</h3><blockquote><p>SELECT + å­—æ®µåˆ—è¡¨<br>FROM  è¡¨ååˆ—è¡¨<br>WHERE æ¡ä»¶åˆ—è¡¨<br>[[æ•°æ®åº“#^aa4a30|GROUP BY åˆ†ç»„å­—æ®µåˆ—è¡¨]]<br>HAVING åˆ†ç»„åæ¡ä»¶åˆ—è¡¨<br>ORDER BY æ’åº<br>LIMIT  åˆ†é¡µå‚æ•°<br>[[æ•°æ®åº“#^1cd456|AS è®¾ç½®åˆ«å]]<br>WHRER å’Œ HAVING çš„åŒºåˆ«ï¼ŒWHERE åœ¨åˆ†ç»„ä¹‹å‰èµ·ä½œç”¨ï¼ŒHAVINGåœ¨åˆ†ç»„ä¹‹åèµ·ä½œç”¨</p></blockquote><h4 id="SELECT"><a href="#SELECT" class="headerlink" title="SELECT"></a>SELECT</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT å­—æ®µ1ï¼Œ... FROM è¡¨ æˆ–è€… SELECT * FROMSELECT DISTINCT å»é‡SELECT å­—æ®µ AS åˆ«å  ... FROM è®¾ç½®å­—æ®µçš„åˆ«å<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ¡ä»¶</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT XXX FROM XXX WHERE +&gt; &gt;= &lt; &lt;= = &lt;&gt;(ä¸ç­‰äºï¼Œç›¸å½“äº!=) BETWEEN ... AND ... IN (...) æ»¡è¶³åˆ—è¡¨ä¸­çš„å…¶ä¸€LIKE åŒ…å«è¿™ä¸ªå­—ç¬¦ æ¨¡ç³ŠåŒ¹é…'%a'     //ä»¥aç»“å°¾çš„æ•°æ®'a%'     //ä»¥aå¼€å¤´çš„æ•°æ®'%a%'    //å«æœ‰açš„æ•°æ®'_a_'    //ä¸‰ä½ä¸”ä¸­é—´å­—æ¯æ˜¯açš„'_a'     //ä¸¤ä½ä¸”ç»“å°¾å­—æ¯æ˜¯açš„'a_'     //ä¸¤ä½ä¸”å¼€å¤´å­—æ¯æ˜¯açš„'___'    //å«æœ‰ä¸‰ä¸ªå­—ç¬¦çš„'[]'     //ç±»ä¼¼æ­£åˆ™è¡¨è¾¾å¼'[^]'    //ä¸åŒ…å«æ‹¬å·ä¹‹å†…çš„å•ä¸ªå­—ç¬¦<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>èšåˆå‡½æ•°:å°†ä¸€åˆ—æ•°æ®ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œè¿›è¡Œçºµå‘è®¡ç®—</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT +count maxminavg å¹³å‡å€¼sum+ å­—æ®µåˆ—è¡¨+  FROM è¡¨å<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ†ç»„æŸ¥è¯¢ ^aa4a30</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT å­—æ®µå FROM è¡¨ WHERE GROUP BY åˆ†ç»„å­—æ®µå HAVING åˆ†ç»„ä¹‹åçš„è¿‡æ»¤æ¡ä»¶<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ’åºæŸ¥è¯¢</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT xx FROM è¡¨å ORDER BY å­—æ®µ1 æ’åºæ–¹å¼(ASCå‡åºï¼ŒDESC é™åº)ï¼Œå­—æ®µ2 XXX <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><u>åˆ†é¡µæŸ¥è¯¢</u></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT xx FROM XXX LIMIT (èµ·å§‹ç´¢å¼•ï¼ŒæŸ¥è¯¢è®°å½•æ•°)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç­‰äºOFFSET n ROWS<br>FETCH NEXY M ROWS ONLY è·³è¿‡nè¡Œï¼Œå¹¶è¿”å›æ¥ä¸‹æ¥çš„mè¡Œ</p><h3 id="DCL-ï¼ˆData-Control-Language-æ•°æ®æ§åˆ¶è¯­å¥ï¼‰-ç”¨äºæ“ä½œæ•°æ®åº“å¯¹è±¡çš„æƒé™"><a href="#DCL-ï¼ˆData-Control-Language-æ•°æ®æ§åˆ¶è¯­å¥ï¼‰-ç”¨äºæ“ä½œæ•°æ®åº“å¯¹è±¡çš„æƒé™" class="headerlink" title="DCL ï¼ˆData Control Language æ•°æ®æ§åˆ¶è¯­å¥ï¼‰ ç”¨äºæ“ä½œæ•°æ®åº“å¯¹è±¡çš„æƒé™"></a>DCL ï¼ˆData Control Language æ•°æ®æ§åˆ¶è¯­å¥ï¼‰ ç”¨äºæ“ä½œæ•°æ®åº“å¯¹è±¡çš„æƒé™</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FORM userCREATE USER 'ç”¨æˆ·å'@'ä¸»æœºå' IDENTIFIED BY '/'/*ä½¿ç”¨%æ¥æŒ‡å®šä»»æ„ä¸»æœºéƒ½å¯ä»¥è®¿é—®*/ALTER USER 'ç”¨æˆ·å' @ 'ä¸»æœºå' IDENTIFIED WITH  mysql_native_password BY 'æ–°å¯†ç '  ä¿®æ”¹å¯†ç DROP USER 'ç”¨æˆ·å' @ 'ä¸»æœºå' åˆ é™¤ç”¨æˆ·/*æƒé™æ§åˆ¶*/SHOW GRANT FOR 'ç”¨æˆ·å'@'ä¸»æœºå'GRANT æƒé™åˆ—è¡¨ ON æ•°æ®åº“å è¡¨å TO 'ç”¨æˆ·å'@'ä¸»æœºå'å–æ¶ˆæƒé™REVOKE æƒé™åˆ—è¡¨ ON æ•°æ®åº“å è¡¨å FROM 'ç”¨æˆ·å'@'ä¸»æœºå'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‡½æ•°-é…åˆSELECT-ä½¿ç”¨"><a href="#å‡½æ•°-é…åˆSELECT-ä½¿ç”¨" class="headerlink" title="å‡½æ•° é…åˆSELECT ä½¿ç”¨"></a>å‡½æ•° é…åˆSELECT ä½¿ç”¨</h2><h3 id="å­—ç¬¦ä¸²å‡½æ•°"><a href="#å­—ç¬¦ä¸²å‡½æ•°" class="headerlink" title="å­—ç¬¦ä¸²å‡½æ•°"></a>å­—ç¬¦ä¸²å‡½æ•°</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CONCAT (s1,s2...) æ‹¼æ¥LOWER(str)UPPER(str)LPAD(str,n,pad) å·¦å¡«å……ï¼Œç”¨padæ¥å¡«å……åŸå­—ç¬¦ä¸²ï¼Œå¡«å……næ¬¡RPAD å³å¡«å……TRIM(str) å»æ‰é¦–ä½çš„ç©ºæ ¼SUBSTRING(str,start,len) <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ•°å€¼å‡½æ•°"><a href="#æ•°å€¼å‡½æ•°" class="headerlink" title="æ•°å€¼å‡½æ•°"></a>æ•°å€¼å‡½æ•°</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CEIL() å‘ä¸Šå–æ•´FLOOR() å‘ä¸‹å–æ•´MOD(x,y) x % yRAND() 0-1å†…çš„éšæœºæ•°ROUND(x,y) å››èˆäº”å…¥ä¿ç•™yä½å°æ•°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ—¥æœŸå‡½æ•°"><a href="#æ—¥æœŸå‡½æ•°" class="headerlink" title="æ—¥æœŸå‡½æ•°"></a><em>æ—¥æœŸå‡½æ•°</em></h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CURDATE() è¿”å›å½“å‰æ—¥æœŸCURTIME()NOW() å½“å‰æ—¥æœŸå’Œæ—¶é—´YEAR(date) è·å–æŒ‡å®šæ—¥æœŸçš„å¹´ä»½MONTH(date)DAY(date)DATE_ADD(date,interval expr type) è¿”å›ä¸€ä¸ªæ—¥æœŸ/æ—¶é—´åŠ ä¸Šæ—¶é—´é—´éš”expråçš„æ—¶é—´DATEDIFF(date1,date2) è¿”å›ä¸¤ä¸ªæ—¥æœŸç›¸å·®çš„å¤©æ•°timestampdiff(é—´éš”ç±»å‹ï¼Œå‰ä¸€ä¸ªæ—¶é—´ï¼Œåä¸€ä¸ªæ—¶é—´) è®¡ç®—æ—¥æœŸæŸ¥ä¾‹å¦‚: timestampdiff(YEAR,hiredate,now()))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æµç¨‹å‡½æ•°"><a href="#æµç¨‹å‡½æ•°" class="headerlink" title="æµç¨‹å‡½æ•°"></a><em>æµç¨‹å‡½æ•°</em></h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">if (value,t,f) å¦‚æœvalue true è¿”å›t å¦åˆ™è¿”å›fIFNULL(v1,v2) å¦‚æœv1ä¸ä¸ºç©ºè¿”å›v1,å¦åˆ™è¿”å›v2CASE WHEN (v1) THEN (res1)WHEN (v2) THEN (res2)....ELSE default END<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="çº¦æŸ-ä½œç”¨åŸŸè¡¨ä¸­å­—æ®µä¸Šçš„è§„åˆ™ï¼Œç”¨äºé™åˆ¶å­˜å‚¨åœ¨è¡¨ä¸­çš„æ•°æ®"><a href="#çº¦æŸ-ä½œç”¨åŸŸè¡¨ä¸­å­—æ®µä¸Šçš„è§„åˆ™ï¼Œç”¨äºé™åˆ¶å­˜å‚¨åœ¨è¡¨ä¸­çš„æ•°æ®" class="headerlink" title="çº¦æŸ ä½œç”¨åŸŸè¡¨ä¸­å­—æ®µä¸Šçš„è§„åˆ™ï¼Œç”¨äºé™åˆ¶å­˜å‚¨åœ¨è¡¨ä¸­çš„æ•°æ®"></a>çº¦æŸ ä½œç”¨åŸŸè¡¨ä¸­å­—æ®µä¸Šçš„è§„åˆ™ï¼Œç”¨äºé™åˆ¶å­˜å‚¨åœ¨è¡¨ä¸­çš„æ•°æ®</h2><p>ç›®çš„æ˜¯æœªæ¥ä¿è¯æ•°æ®åº“ä¸­æ•°æ®çš„æ­£ç¡®æ€§å’Œå®Œæ•´æ€§æœ‰æ•ˆæ€§<br>åˆ†ç±»</p><blockquote><p>éç©ºçº¦æŸï¼Œå­—æ®µä¸èƒ½ä¸ºnull     å…³é”®å­—: NOT NULL<br>å”¯ä¸€çº¦æŸ å­—æ®µä¸èƒ½é‡å¤           UNIQUE<br>ä¸»é”®çº¦æŸ ä¸»é”®æ˜¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€è¡¨ç¤ºï¼Œè¦æ±‚éç©ºä¸”å”¯ä¸€ PRIMARY KEY<br>é»˜è®¤çº¦æŸ ä½¿ç”¨é»˜è®¤å€¼ DEFAULT<br>æ£€æŸ¥çº¦æŸ ä¿è¯å­—æ®µå€¼æ»¡è¶³æŸä¸€ä¸ªæ¡ä»¶ CHECK<br>å¤–é”®çº¦æŸ æ¥è®©ä¸¤æ•´è¡¨ä¹‹é—´å»ºç«‹ç»ƒä¹ ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ FOREIGN KEY</p></blockquote><p>ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">create table user  (      name   varchar(10) not null unique comment 'å§“åä¸ä¸ºç©ºä¸”ä¸èƒ½é‡å¤',      age    int check ( age &gt; 0 &amp;&amp; age &lt;= 120) comment 'å¹´é¾„æ£€æŸ¥ä¸º0-120',      status char(1) default '1' comment 'çŠ¶æ€é»˜è®¤ä¸º1',      gender char(1) comment 'æ€§åˆ«'  ) comment 'ç”¨æˆ·è¡¨';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¤–é”®</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">1.å»ºè¡¨æ—¶CREATE TABLE ( .... .... CONSTRAINT å¤–é”®åç§° FOREGIN KEY (å¤–é”®å­—æ®µå) REFERENCES ä¸»è¡¨åˆ—å)2. ALTER TABLE è¡¨ ADD CONSTRAINT å¤–é”®å(è‡ªå®šä¹‰) FOREIGN KEY (æœ¬è¡¨)å­—æ®µå REFERENCES å¤–è¡¨+(å­—æ®µå)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ é™¤/æ›´æ–°</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">ALTER TABLE è¡¨ ADD CONSTRAINT å¤–é”®å(è‡ªå®šä¹‰) FOREIGN KEY (æœ¬è¡¨)å­—æ®µå REFERENCES å¤–è¡¨+(å­—æ®µå) ON UPDATE æ›´æ–°æ—¶çš„æ“ä½œ  ON DELETE åˆ é™¤æ—¶è¦æ‰§è¡Œçš„æ“ä½œæ“ä½œæœ‰NO ACTION åœ¨çˆ¶è¡¨ä¸­åˆ é™¤/æ›´æ–°æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥ï¼Œè¯¥è®°å½•æ˜¯å¦æœ‰å¤–é”®ï¼Œå¦‚æœæœ‰åˆ™ä¸å…è®¸æ›´æ–°æˆ–è€…åˆ é™¤RESTRICT  åŒ NO ACTION CASCADE å¯ä»¥åˆ é™¤/æ›´æ–°å¤–é”®åœ¨å­è¡¨ä¸­çš„è®°å½•SET NULL è®¾ç½®å­è¡¨ä¸­çš„å¤–é”®è®°å½•ä¸ºNULLSET DEFAULT è®¾ç½®ä¸ºä¸€ä¸ªé»˜è®¤å€¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¤šè¡¨æŸ¥è¯¢"><a href="#å¤šè¡¨æŸ¥è¯¢" class="headerlink" title="å¤šè¡¨æŸ¥è¯¢"></a>å¤šè¡¨æŸ¥è¯¢</h2><blockquote><p>å¤šè¡¨å…³ç³»ï¼š<br>ä¸€å¯¹å¤š å¤šçš„ä¸€æ–¹å»ºç«‹å¤–é”®æŒ‡å‘ä¸€<br>å¤šå¯¹å¤š å»ºç«‹ç¬¬ä¸‰å¼ ä¸­é—´è¡¨ï¼Œä¸­é—´è¡¨è‡³å°‘åŒ…å«ä¸¤ä¸ªå¤–é”®ï¼Œåˆ†åˆ«å…³è”ä¸¤æ–¹<br>ä¸€å¯¹ä¸€ ä»»æ„ä¸€æ–¹åŠ ä¸Šå¤–é”®å¹¶è®¾ç½®ä¸ºUNIQUE</p></blockquote><h3 id="å­æŸ¥è¯¢ï¼š"><a href="#å­æŸ¥è¯¢ï¼š" class="headerlink" title="å­æŸ¥è¯¢ï¼š"></a>å­æŸ¥è¯¢ï¼š</h3><p>æŸ¥è¯¢åµŒå¥—ï¼Œæ‹¬å·å†…çš„æŸ¥è¯¢ç»“æœä½œä¸ºæ‹¬å·å¤–çš„æ¡ä»¶ ä¾‹å­ï¼š</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT cust_id FROM Orders WHERE order_num IN (SELECT order_num  FROM OrderItems  WHERE prod_id = 'RGAN01');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ–è€…</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT cust_name,  cust_state,  (SELECT COUNT(*)  FROM Orders  WHERE Orders.cust_id = Customers.cust_id) AS orders FROM Customers ORDER BY cust_name;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ ‡é‡å­æŸ¥è¯¢<br>å­æŸ¥è¯¢è¿”å›å•ä¸ªå€¼<br>åˆ—å­æŸ¥è¯¢ï¼Œè¿”å›ç»“æœæ˜¯ä¸€åˆ—æˆ–è€…å¤šè¡Œ<br>å¸¸ç”¨æ“ä½œç¬¦å·</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">INNOT INANYSOME  å’ŒANYç›¸åŒALL <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¡Œå­æŸ¥è¯¢ï¼Œè¿”å›ä¸€è¡Œæˆ–è€…æ˜¯å¤šåˆ—</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">= &lt; &gt; IN NOT IN <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¡¨å­æŸ¥è¯¢<br>è¿”å›å¤šè¡Œå¤šåˆ—<br>å¸¸ç”¨IN æ¥è¿›è¡ŒæŸ¥è¯¢</p><h2 id="è”ç»“è¡¨"><a href="#è”ç»“è¡¨" class="headerlink" title="è”ç»“è¡¨"></a>è”ç»“è¡¨</h2><ol><li>å†…è”ç»“</li></ol><p>æ¯”å¦‚</p><p>è¿›è¡Œæ•°æ®å­˜å‚¨çš„æ—¶å€™ï¼Œä¼šæŒ‡å®šä¸€ç§è”ç³»æ–¹å¼</p><p>å¯ä»¥ç±»æ¯”ä¸ºæ•£åˆ—è¡¨æˆ–è€…map</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT vend_name, prod_name, prod_price FROM Vendors, Products WHERE Vendors.vend_id = Products.vend_id;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ­£å¼ç”¨æ³•</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT vend_name, prod_name, prod_price FROM Vendors INNER JOIN Products  ON Vendors.vend_id = Products.vend_id;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>onä¹‹åçš„å¼åŒ¹é…è§„åˆ™ï¼ŒåŒæ—¶ä¸ºäº†é˜²æ­¢å†²çªï¼Œå°½é‡ç”¨ç‚¹æ¥è·å–æ¯ä¸ªä¸åŒçš„åº“çš„æ•°æ®</p><p>è”ç»“å¤šä¸ªè¡¨</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT prod_name, vend_name, prod_price, quantity FROM OrderItems, Products, Vendors WHERE Products.vend_id = Vendors.vend_id  AND OrderItems.prod_id = Products.prod_id  AND order_num = 20007;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2.è‡ªè”ç»“</p><p><u>è”ç»“ä¸­ä»ç„¶å¯ä»¥ä½¿ç”¨å†…èšå‡½æ•°</u></p><p>ä¾‹å¦‚</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT Customers.cust_id,  COUNT(Orders.order_num) AS num_ord FROM Customers INNER JOIN Orders  ON Customers.cust_id = Orders.cust_id GROUP BY Customers.cust_id;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»Ÿä¸€è¡¨å†…è”ç»“è‡ªå·±</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT c1.cust_id, c1.cust_name, c1.cust_contact FROM Customers AS c1, Customers AS c2 WHERE c1.cust_name = c2.cust_name  AND c2.cust_contact = 'Jim Jones';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>3.è‡ªç„¶è”ç»“</p><blockquote><p>è‡ªç„¶è”ç»“æ’é™¤å¤šæ¬¡å‡ºç°ï¼Œä½¿æ¯ä¸€åˆ—åªè¿”å›ä¸€æ¬¡ã€‚</p></blockquote><blockquote><p>è‡ªç„¶è”ç»“è¦æ±‚ä½ åªèƒ½é€‰æ‹©é‚£äº›å”¯ä¸€çš„åˆ—ï¼Œä¸€èˆ¬é€šè¿‡å¯¹ä¸€ä¸ªè¡¨ä½¿ç”¨é€šé…ç¬¦</p><p>ï¼ˆSELECT *ï¼‰ï¼Œè€Œå¯¹å…¶ä»–è¡¨çš„åˆ—ä½¿ç”¨æ˜ç¡®çš„å­é›†æ¥å®Œæˆã€‚</p></blockquote><p>è¦è‡ªå·±å®Œæˆï¼Œç³»ç»Ÿä¸æä¾›</p><p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬è¿„ä»Šä¸ºæ­¢å»ºç«‹çš„æ¯ä¸ªå†…è”ç»“éƒ½æ˜¯è‡ªç„¶è”ç»“ï¼Œå¾ˆå¯èƒ½æ°¸è¿œéƒ½</p><p>ä¸ä¼šç”¨åˆ°ä¸æ˜¯è‡ªç„¶è”ç»“çš„å†…è”ç»“ã€‚</p><p>4.å¤–è”ç»“</p><blockquote><p>è”ç»“åŒ…å«äº†é‚£äº›åœ¨ç›¸å…³è¡¨ä¸­æ²¡æœ‰å…³è”è¡Œçš„è¡Œã€‚è¿™ç§è”ç»“</p><p>ç§°ä¸ºå¤–è”ç»“ã€‚</p></blockquote><p>è¯­æ³•ï¼š</p><p>å…§è”ç»“ï¼š</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT Customers.cust_id, Orders.order_num FROM Customers INNER JOIN Orders  ON Customers.cust_id = Orders.cust_id;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¤–è”ç»“ï¼š<br>ä½¿ç”¨åœºæ™¯</p><ul><li><p><input disabled="" type="checkbox"> å¯¹æ¯ä¸ªé¡¾å®¢ä¸‹çš„è®¢å•è¿›è¡Œè®¡æ•°ï¼ŒåŒ…æ‹¬é‚£äº›è‡³ä»Šå°šæœªä¸‹è®¢å•çš„é¡¾å®¢ï¼›</p></li><li><p><input disabled="" type="checkbox"> åˆ—å‡ºæ‰€æœ‰äº§å“ä»¥åŠè®¢è´­æ•°é‡ï¼ŒåŒ…æ‹¬æ²¡æœ‰äººè®¢è´­çš„äº§å“ï¼›</p></li><li><p><input disabled="" type="checkbox"> è®¡ç®—å¹³å‡é”€å”®è§„æ¨¡ï¼ŒåŒ…æ‹¬é‚£äº›è‡³ä»Šå°šæœªä¸‹è®¢å•çš„é¡¾å®¢ã€‚</p></li></ul><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT Customers.cust_id, Orders.order_num FROM Customers LEFT OUTER JOIN Orders  ON Customers.cust_id = Orders.cust_id;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>åœ¨ä½¿ç”¨ OUTER </p><p>JOIN è¯­æ³•æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ RIGHT æˆ– LEFT å…³é”®å­—æŒ‡å®šåŒ…æ‹¬å…¶æ‰€æœ‰è¡Œçš„è¡¨</p><p>ï¼ˆRIGHT æŒ‡å‡ºçš„æ˜¯ OUTER JOIN å³è¾¹çš„è¡¨ï¼Œè€Œ LEFT æŒ‡å‡ºçš„æ˜¯ OUTER JOIN</p><p>å·¦è¾¹çš„è¡¨ï¼‰ã€‚</p><p>ä¹Ÿå°±æ˜¯left å°†è¦è”ç»“å·¦ä¾§çš„é‚£ä¸ªè¡¨å…¨éƒ¨é€‰å‡º</p><p>right å°†å³ä¾§çš„é‚£ä¸ªè¡¨å…¨é€‰å‡º</p></blockquote><p><strong>å…¨å¤–è”ç»“</strong></p><p><u><em>Accessã€MariaDBã€MySQLã€Open Office Base å’Œ SQLite ä¸æ”¯æŒ FULL</em></u></p><blockquote><p>è¿˜å­˜åœ¨å¦ä¸€ç§å¤–è”ç»“ï¼Œå°±æ˜¯å…¨å¤–è”ç»“ï¼ˆfull outer joinï¼‰ï¼Œå®ƒæ£€ç´¢ä¸¤ä¸ªè¡¨ä¸­</p><p>çš„æ‰€æœ‰è¡Œå¹¶å…³è”é‚£äº›å¯ä»¥å…³è”çš„è¡Œã€‚ä¸å·¦å¤–è”ç»“æˆ–å³å¤–è”ç»“åŒ…å«ä¸€ä¸ªè¡¨</p><p>çš„ä¸å…³è”çš„è¡Œä¸åŒï¼Œå…¨å¤–è”ç»“åŒ…å«ä¸¤ä¸ªè¡¨çš„ä¸å…³è”çš„è¡Œã€‚</p></blockquote><h2 id="è”ç»“ä½¿ç”¨æ¡ä»¶"><a href="#è”ç»“ä½¿ç”¨æ¡ä»¶" class="headerlink" title="è”ç»“ä½¿ç”¨æ¡ä»¶"></a>è”ç»“ä½¿ç”¨æ¡ä»¶</h2><blockquote><p><strong><u>ï± æ³¨æ„æ‰€ä½¿ç”¨çš„è”ç»“ç±»å‹ã€‚ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨å†…è”ç»“ï¼Œä½†ä½¿ç”¨å¤–è”ç»“ä¹Ÿæœ‰æ•ˆã€‚</u></strong></p><p><u><strong>ï± å…³äºç¡®åˆ‡çš„è”ç»“è¯­æ³•ï¼Œåº”è¯¥æŸ¥çœ‹å…·ä½“çš„æ–‡æ¡£ï¼Œçœ‹ç›¸åº”çš„ DBMS æ”¯æŒä½•</strong></u><u><strong>ç§è¯­æ³•ï¼ˆå¤§å¤šæ•° DBMS ä½¿ç”¨è¿™ä¸¤è¯¾ä¸­æè¿°çš„æŸç§è¯­æ³•ï¼‰ã€‚</strong></u></p><p><u><strong>ï± ä¿è¯ä½¿ç”¨æ­£ç¡®çš„è”ç»“æ¡ä»¶ï¼ˆä¸ç®¡é‡‡ç”¨å“ªç§è¯­æ³•ï¼‰ï¼Œå¦åˆ™ä¼šè¿”å›ä¸æ­£ç¡®</strong></u></p><p><u><strong>çš„æ•°æ®ã€‚</strong></u></p><p><u><strong>ï± åº”è¯¥æ€»æ˜¯æä¾›è”ç»“æ¡ä»¶ï¼Œå¦åˆ™ä¼šå¾—å‡ºç¬›å¡å„¿ç§¯ã€‚</strong></u></p><p><u><strong>ï± åœ¨ä¸€ä¸ªè”ç»“ä¸­å¯ä»¥åŒ…å«å¤šä¸ªè¡¨ï¼Œç”šè‡³å¯ä»¥å¯¹æ¯ä¸ªè”ç»“é‡‡ç”¨ä¸åŒçš„è”ç»“</strong></u></p><p><u><strong>ç±»å‹ã€‚è™½ç„¶è¿™æ ·åšæ˜¯åˆæ³•çš„ï¼Œä¸€èˆ¬ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œä½†åº”è¯¥åœ¨ä¸€èµ·æµ‹è¯•å®ƒä»¬</strong></u></p><p><strong><u><strong>å‰åˆ†åˆ«æµ‹è¯•æ¯ä¸ªè”ç»“ã€‚è¿™ä¼šä½¿æ•…éšœæ’é™¤æ›´ä¸ºç®€å•ã€‚</strong></u></strong> </p></blockquote><h3 id="joinåŒºåˆ«"><a href="#joinåŒºåˆ«" class="headerlink" title="joinåŒºåˆ«"></a>joinåŒºåˆ«</h3><p><strong>æ™®é€šçš„joinæ˜¯ç¬›å¡å°”ç§¯ï¼Œå³ä¸ºä¸¤å¼ è¡¨çš„æ’åˆ—ç»„åˆ</strong></p><p><img src="/2023/08/02/58/join.jpg"></p><h2 id="èµ·åˆ«å"><a href="#èµ·åˆ«å" class="headerlink" title="èµ·åˆ«å"></a>èµ·åˆ«å</h2><p>åœ¨ä½¿ç”¨æ—¶ç›´æ¥ç”¨AS +åˆ«åå°±å¯ä»¥ç”¨äº† ^1cd456</p><p><strong>åªèƒ½æ¯æ¬¡ç”¨çš„æ—¶å€™èµ·ä¸€æ¬¡åˆ«åå¹¶ä¸”å½“æ—¶ä½¿ç”¨</strong></p><p>ä¸‹ä¸€ä¸ªè¯­å¥åˆ«åå°±ä¸èƒ½ç”¨äº†ï¼Œè¦é‡æ–°èµ·åå­—</p><h2 id="UNION"><a href="#UNION" class="headerlink" title=" UNION "></a><u> UNION </u></h2><p>è¯­æ³•ï¼š</p><p>é€‚ç”¨äºä»å¤šä¸ªä¸åŒçš„è¡¨ä¸­æŒ‘é€‰ä¸åŒçš„åˆ—</p><blockquote><p>UNION ä¸­çš„æ¯ä¸ªæŸ¥è¯¢å¿…é¡»åŒ…å«ç›¸åŒçš„åˆ—ã€è¡¨è¾¾å¼æˆ–èšé›†å‡½æ•°ï¼ˆä¸è¿‡ï¼Œ</p><p>å„ä¸ªåˆ—ä¸éœ€è¦ä»¥ç›¸åŒçš„æ¬¡åºåˆ—å‡ºï¼‰</p></blockquote><blockquote><p>UNION ä»æŸ¥è¯¢ç»“æœé›†ä¸­è‡ªåŠ¨å»é™¤äº†é‡å¤çš„è¡Œï¼›æ¢å¥è¯è¯´ï¼Œå®ƒçš„è¡Œä¸ºä¸ä¸€</p><p>æ¡ SELECT è¯­å¥ä¸­ä½¿ç”¨å¤šä¸ª WHERE å­å¥æ¡ä»¶ä¸€æ ·ã€‚</p><p>è¿™æ˜¯ UNION çš„é»˜è®¤è¡Œä¸ºï¼Œå¦‚æœæ„¿æ„ä¹Ÿå¯ä»¥æ”¹å˜å®ƒã€‚äº‹å®ä¸Šï¼Œå¦‚æœæƒ³è¿”å›</p><p>æ‰€æœ‰çš„åŒ¹é…è¡Œï¼Œå¯ä½¿ç”¨ UNION ALL è€Œä¸æ˜¯ UNION</p></blockquote><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT cust_name, cust_contact, cust_email FROM Customers WHERE cust_state IN ('IL','IN','MI') UNION SELECT cust_name, cust_contact, cust_email FROM Customers WHERE cust_name = 'Fun4All';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h3><blockquote><p>SELECT è¯­å¥çš„è¾“å‡ºç”¨ ORDER BY å­å¥æ’åºã€‚åœ¨ç”¨ UNION ç»„åˆæŸ¥è¯¢æ—¶ï¼Œåª</p><p>èƒ½ä½¿ç”¨ä¸€æ¡ ORDER BY å­å¥ï¼Œå®ƒå¿…é¡»ä½äºæœ€åä¸€æ¡ SELECT è¯­å¥ä¹‹åã€‚å¯¹</p><p>äºç»“æœé›†ï¼Œä¸å­˜åœ¨ç”¨ä¸€ç§æ–¹å¼æ’åºä¸€éƒ¨åˆ†ï¼Œè€Œåˆç”¨å¦ä¸€ç§æ–¹å¼æ’åºå¦ä¸€éƒ¨åˆ†çš„æƒ…å†µï¼Œå› æ­¤ä¸å…è®¸ä½¿ç”¨å¤šæ¡ ORDER BY å­å¥</p><p>ç”¨å®ƒæ¥æ’åºæ‰€æœ‰ SELECT è¯­å¥è¿”å›çš„æ‰€æœ‰ç»“æœã€‚</p></blockquote><h2 id="å»ºè¡¨"><a href="#å»ºè¡¨" class="headerlink" title="å»ºè¡¨"></a>å»ºè¡¨</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE A(  prod_id CHAR(10) NOT NULL,  vend_id CHAR(10) NOT NULL,  prod_name CHAR(254) NOT NULL,  prod_price DECIMAL(8,2) NOT NULL,  prod_desc VARCHAR(1000) NULL );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¦æŒ‡å®šè¡Œåˆ—,å¹¶ä¸”åè·Ÿåˆ—çš„æ•°æ®</p><p>ç±»å‹</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE Orders (  order_num INTEGER NOT NULL,  order_date DATETIME NOT NULL,  cust_id CHAR(10) NOT NULL );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>ä¸è¦æŠŠ NULL å€¼ä¸ç©ºå­—ç¬¦ä¸²ç›¸æ··æ·†ã€‚NULL å€¼æ˜¯æ²¡æœ‰å€¼ï¼Œä¸æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚</p><p>å¦‚æœæŒ‡å®šâ€™â€™ï¼ˆä¸¤ä¸ªå•å¼•å·ï¼Œå…¶é—´æ²¡æœ‰å­—ç¬¦ï¼‰ï¼Œè¿™åœ¨ NOT NULL åˆ—ä¸­æ˜¯å…</p><p>è®¸çš„ã€‚ç©ºå­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å€¼ï¼Œå®ƒä¸æ˜¯æ— å€¼ã€‚NULL å€¼ç”¨å…³é”®å­— NULL</p><p>è€Œä¸æ˜¯ç©ºå­—ç¬¦ä¸²</p><p>é»˜è®¤å€¼åœ¨ CREATE TABLE è¯­å¥çš„åˆ—å®šä¹‰ä¸­ç”¨å…³é”®å­— DEFAULT æŒ‡å®š</p></blockquote><p>æ›´æ–°è¡¨å®šä¹‰ï¼Œå¯ä»¥ä½¿ç”¨ ALTER TABLE è¯­å¥ã€‚</p><blockquote><p>ä½¿ç”¨ ALTER TABLE æ›´æ”¹è¡¨ç»“æ„ï¼Œå¿…é¡»ç»™å‡ºä¸‹é¢çš„ä¿¡æ¯ï¼š</p><p>ï± åœ¨ ALTER TABLE ä¹‹åç»™å‡ºè¦æ›´æ”¹çš„è¡¨åï¼ˆè¯¥è¡¨å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™å°†</p><p>å‡ºé”™ï¼‰ï¼›</p><p>ï± åˆ—å‡ºè¦åšå“ªäº›æ›´æ”¹</p></blockquote><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">ALTER TABLE Vendors ADD vend_phone CHAR(20);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>æ›´æ”¹æˆ–åˆ é™¤åˆ—ã€å¢åŠ çº¦æŸæˆ–å¢åŠ é”®ï¼Œè¿™äº›æ“ä½œä¹Ÿä½¿ç”¨ç±»ä¼¼çš„è¯­æ³•ï¼ˆæ³¨æ„ï¼Œ</p><p>ä¸‹é¢çš„ä¾‹å­å¹¶éå¯¹æ‰€æœ‰ DBMS éƒ½æœ‰æ•ˆï¼‰ï¼š</p><p>è¾“å…¥â–¼</p><p>ALTER TABLE Vendors </p><p>DROP COLUMN vend_phone; </p></blockquote><blockquote><p><u><em><strong>ä½¿ç”¨ ALTER TABLE è¦æä¸ºå°å¿ƒï¼Œåº”è¯¥åœ¨è¿›è¡Œæ”¹åŠ¨å‰åšå®Œæ•´çš„å¤‡ä»½ï¼ˆè¡¨</strong></em></u></p><p><u><em><strong>ç»“æ„å’Œæ•°æ®çš„å¤‡ä»½ï¼‰ã€‚æ•°æ®åº“è¡¨çš„æ›´æ”¹ä¸èƒ½æ’¤é”€ï¼Œå¦‚æœå¢åŠ äº†ä¸éœ€è¦çš„</strong></em></u></p><p><u><em><strong>åˆ—ï¼Œä¹Ÿè®¸æ— æ³•åˆ é™¤å®ƒä»¬ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœåˆ é™¤äº†ä¸åº”è¯¥åˆ é™¤çš„åˆ—ï¼Œå¯èƒ½</strong></em></u></p><p><u><em><strong>ä¼šä¸¢å¤±è¯¥åˆ—ä¸­çš„æ‰€æœ‰æ•°æ®ã€‚</strong></em></u></p></blockquote><p>åˆ é™¤è¡¨ï¼ˆåˆ é™¤æ•´ä¸ªè¡¨è€Œä¸æ˜¯å…¶å†…å®¹ï¼‰éå¸¸ç®€å•ï¼Œä½¿ç”¨ DROP TABLE è¯­å¥å³å¯ï¼š</p><p>DELETE  åªåˆ é™¤è¡¨çš„å†…å®¹ä¸åˆ é™¤è¡¨æœ¬èº«</p><h2 id="é‡æ–°å‘½å"><a href="#é‡æ–°å‘½å" class="headerlink" title="é‡æ–°å‘½å"></a>é‡æ–°å‘½å</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">ALTER TABLE oldname RENAME TO newname;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h2><blockquote><p><u><em><strong>è§†å›¾ä¸ºè™šæ‹Ÿçš„è¡¨ã€‚å®ƒä»¬åŒ…å«çš„ä¸æ˜¯æ•°æ®è€Œæ˜¯æ ¹æ®éœ€è¦æ£€ç´¢æ•°æ®çš„æŸ¥è¯¢ã€‚</strong></em></u></p><p><u><em><strong>è§†å›¾æä¾›äº†ä¸€ç§å°è£… SELECT è¯­å¥çš„å±‚æ¬¡ï¼Œå¯ç”¨æ¥ç®€åŒ–æ•°æ®å¤„ç†ï¼Œé‡æ–°</strong></em></u></p><p><u><em><strong>æ ¼å¼åŒ–æˆ–ä¿æŠ¤åŸºç¡€æ•°æ®ã€‚</strong></em></u></p></blockquote><p>ç”¨è§†å›¾å°†è”ç»“é›†åˆèµ·æ¥ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå­æŸ¥è¯¢ï¼Œç›¸å½“äºä¸€ä¸ªAPI</p><p>åˆ›å»º è§†å›¾ç”¨ CREATE VIEW è¯­å¥æ¥åˆ›å»ºã€‚ä¸ CREATE TABLE ä¸€æ ·ï¼ŒCREATE VIEW</p><p>åˆ é™¤ åˆ é™¤è§†å›¾ï¼Œå¯ä»¥ä½¿ç”¨ DROP è¯­å¥ï¼Œå…¶è¯­æ³•ä¸º DROP VIEW viewname;ã€‚</p><p>è¦†ç›–ï¼ˆæˆ–æ›´æ–°ï¼‰è§†å›¾ï¼Œå¿…é¡»å…ˆåˆ é™¤å®ƒï¼Œç„¶åå†é‡æ–°åˆ›å»ºã€‚</p><p>ç”¨æ³•ï¼š</p><p>å»ºç«‹è§†å›¾</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE VIEW ProductCustomers AS SELECT cust_name, cust_contact, prod_id FROM Customers, Orders, OrderItems WHERE Customers.cust_id = Orders.cust_id  AND OrderItems.order_num = Orders.order_num;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ¡è¯­å¥åˆ›å»ºä¸€ä¸ªåä¸º ProductCustomers çš„è§†å›¾ï¼Œå®ƒè”ç»“ä¸‰ä¸ªè¡¨ï¼Œè¿”</p><p>å›å·²è®¢è´­äº†ä»»æ„äº§å“çš„æ‰€æœ‰é¡¾å®¢çš„åˆ—è¡¨ã€‚</p><p>ä½¿ç”¨è§†å›¾</p><p>ä½¿ç”¨æ—¶ï¼Œ</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT cust_name, cust_contact FROM ProductCustomers WHERE prod_id = 'RGAN01';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥ç”¨äºç»Ÿä¸€æ ¼å¼</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE VIEW VendorLocations AS SELECT RTRIM(vend_name) || ' (' || RTRIM(vend_country) || ')'  AS vend_title FROM Vendors;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹‹åå¯ç”¨</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM VendorLocations;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç”¨äºè¿‡æ»¤ä¹Ÿä¸€æ ·</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE VIEW CustomerEMailList AS SELECT cust_id, cust_name, cust_email FROM Customers WHERE cust_email IS NOT NULL;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹‹å</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM CustomerEMailList;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è®¡ç®—å­—æ®µ</p><pre class="line-numbers language-none"><code class="language-none">CREATE VIEW OrderItemsExpanded AS SELECT order_num,  prod_id,  quantity, item_price,  quantity*item_price AS expanded_price FROM OrderItems;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹‹å</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM OrderItemsExpanded WHERE order_num = 20008;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="å­˜å‚¨ï¼ˆä¸ä¼šï¼‰"><a href="#å­˜å‚¨ï¼ˆä¸ä¼šï¼‰" class="headerlink" title="å­˜å‚¨ï¼ˆä¸ä¼šï¼‰"></a>å­˜å‚¨ï¼ˆ<u><em><strong>ä¸ä¼š</strong></em></u>ï¼‰</h2><blockquote><p>å¯ä»¥åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ã€‚ç®€å•æ¥è¯´ï¼Œå­˜å‚¨è¿‡ç¨‹å°±æ˜¯ä¸ºä»¥åä½¿ç”¨è€Œä¿å­˜çš„ä¸€æ¡</p><p>æˆ–å¤šæ¡ SQL è¯­å¥ã€‚å¯å°†å…¶è§†ä¸ºæ‰¹æ–‡ä»¶ï¼Œè™½ç„¶å®ƒä»¬çš„ä½œç”¨ä¸ä»…é™äºæ‰¹å¤„ç†</p><p>ï± é€šè¿‡æŠŠå¤„ç†å°è£…åœ¨ä¸€ä¸ªæ˜“ç”¨çš„å•å…ƒä¸­ï¼Œå¯ä»¥ç®€åŒ–å¤æ‚çš„æ“ä½œï¼ˆå¦‚å‰é¢</p><p>ä¾‹å­æ‰€è¿°ï¼‰ã€‚</p><p>ï± ç”±äºä¸è¦æ±‚åå¤å»ºç«‹ä¸€ç³»åˆ—å¤„ç†æ­¥éª¤ï¼Œå› è€Œä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚å¦‚</p><p>æœæ‰€æœ‰å¼€å‘äººå‘˜å’Œåº”ç”¨ç¨‹åºéƒ½ä½¿ç”¨åŒä¸€å­˜å‚¨è¿‡ç¨‹ï¼Œåˆ™æ‰€ä½¿ç”¨çš„ä»£ç éƒ½</p><p>æ˜¯ç›¸åŒçš„ã€‚</p></blockquote><blockquote><p>EXECUTE AddNewProduct( â€˜JTS01â€™, </p><p>â€˜Stuffed Eiffel Towerâ€™, </p><p>6.49, </p><p>â€˜Plush stuffed toy with the text La </p><p>â¥Tour Eiffel in red white and blueâ€™ ); </p></blockquote><h2 id="ç®¡ç†äº‹åŠ¡å¤„ç†ï¼ˆä¸ä¼šæ·±å…¥å­¦ä¹ çš„æ—¶å€™å†çœ‹ï¼‰"><a href="#ç®¡ç†äº‹åŠ¡å¤„ç†ï¼ˆä¸ä¼šæ·±å…¥å­¦ä¹ çš„æ—¶å€™å†çœ‹ï¼‰" class="headerlink" title="ç®¡ç†äº‹åŠ¡å¤„ç†ï¼ˆä¸ä¼šæ·±å…¥å­¦ä¹ çš„æ—¶å€™å†çœ‹ï¼‰"></a>ç®¡ç†äº‹åŠ¡å¤„ç†ï¼ˆä¸ä¼šæ·±å…¥å­¦ä¹ çš„æ—¶å€™å†çœ‹ï¼‰</h2><blockquote><p>ä½¿ç”¨äº‹åŠ¡å¤„ç†ï¼ˆtransaction processingï¼‰ï¼Œé€šè¿‡ç¡®ä¿æˆæ‰¹çš„ SQL æ“ä½œè¦ä¹ˆ</p><p>å®Œå…¨æ‰§è¡Œï¼Œè¦ä¹ˆå®Œå…¨ä¸æ‰§è¡Œï¼Œæ¥ç»´æŠ¤æ•°æ®åº“çš„å®Œæ•´æ€§</p></blockquote><blockquote><p>ï± äº‹åŠ¡ï¼ˆtransactionï¼‰æŒ‡ä¸€ç»„ SQL è¯­å¥ï¼›</p><p>ï± å›é€€ï¼ˆrollbackï¼‰æŒ‡æ’¤é”€æŒ‡å®š SQL è¯­å¥çš„è¿‡ç¨‹ï¼›</p><p>ï± æäº¤ï¼ˆcommitï¼‰æŒ‡å°†æœªå­˜å‚¨çš„ SQL è¯­å¥ç»“æœå†™å…¥æ•°æ®åº“è¡¨ï¼›</p><p>ï± ä¿ç•™ç‚¹ï¼ˆsavepointï¼‰æŒ‡äº‹åŠ¡å¤„ç†ä¸­è®¾ç½®çš„ä¸´æ—¶å ä½ç¬¦ï¼ˆplaceholderï¼‰ï¼Œ</p><p>å¯ä»¥å¯¹å®ƒå‘å¸ƒå›é€€ï¼ˆä¸å›é€€æ•´ä¸ªäº‹åŠ¡å¤„ç†ä¸åŒï¼‰ã€‚</p></blockquote><p><strong>äº‹åŠ¡å¤„ç†ç”¨æ¥ç®¡ç† INSERTã€UPDATE å’Œ DELETE è¯­å¥ã€‚ä¸èƒ½å›é€€ SELECT</strong></p><p><strong>è¯­å¥ï¼ˆå›é€€ SELECT è¯­å¥ä¹Ÿæ²¡æœ‰å¿…è¦ï¼‰ï¼Œä¹Ÿä¸èƒ½å›é€€ CREATE æˆ– DROP æ“</strong></p><p><strong>ä½œã€‚äº‹åŠ¡å¤„ç†ä¸­å¯ä»¥ä½¿ç”¨è¿™äº›è¯­å¥ï¼Œä½†è¿›è¡Œå›é€€æ—¶ï¼Œè¿™äº›æ“ä½œä¹Ÿä¸æ’¤é”€ã€‚</strong></p><h2 id="æ¸¸æ ‡"><a href="#æ¸¸æ ‡" class="headerlink" title="æ¸¸æ ‡"></a>æ¸¸æ ‡</h2><blockquote><p>æœ‰æ—¶ï¼Œéœ€è¦åœ¨æ£€ç´¢å‡ºæ¥çš„è¡Œä¸­å‰è¿›æˆ–åé€€ä¸€è¡Œæˆ–å¤šè¡Œï¼Œè¿™å°±æ˜¯æ¸¸æ ‡çš„ç”¨</p><p>é€”æ‰€åœ¨ã€‚æ¸¸æ ‡ï¼ˆcursorï¼‰æ˜¯ä¸€ä¸ªå­˜å‚¨åœ¨ DBMS æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“æŸ¥è¯¢ï¼Œ</p><p>å®ƒä¸æ˜¯ä¸€æ¡ SELECT è¯­å¥ï¼Œè€Œæ˜¯è¢«è¯¥è¯­å¥æ£€ç´¢å‡ºæ¥çš„ç»“æœé›†ã€‚åœ¨å­˜å‚¨äº†</p><p>æ¸¸æ ‡ä¹‹åï¼Œåº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®éœ€è¦æ»šåŠ¨æˆ–æµè§ˆå…¶ä¸­çš„æ•°æ®ã€‚</p></blockquote><p>æ¸¸æ ‡çš„é€‰é¡¹å’Œç‰¹æ€§</p><blockquote><p>ï± èƒ½å¤Ÿæ ‡è®°æ¸¸æ ‡ä¸ºåªè¯»ï¼Œä½¿æ•°æ®èƒ½è¯»å–ï¼Œä½†ä¸èƒ½æ›´æ–°å’Œåˆ é™¤ã€‚</p><p>ï± èƒ½æ§åˆ¶å¯ä»¥æ‰§è¡Œçš„å®šå‘æ“ä½œï¼ˆå‘å‰ã€å‘åã€ç¬¬ä¸€ã€æœ€åã€ç»å¯¹ä½ç½®ã€</p><p>ç›¸å¯¹ä½ç½®ç­‰ï¼‰ã€‚</p><p>ï± èƒ½æ ‡è®°æŸäº›åˆ—ä¸ºå¯ç¼–è¾‘çš„ï¼ŒæŸäº›åˆ—ä¸ºä¸å¯ç¼–è¾‘çš„ã€‚</p><p>ï± è§„å®šèŒƒå›´ï¼Œä½¿æ¸¸æ ‡å¯¹åˆ›å»ºå®ƒçš„ç‰¹å®šè¯·æ±‚ï¼ˆå¦‚å­˜å‚¨è¿‡ç¨‹ï¼‰æˆ–å¯¹æ‰€æœ‰è¯·æ±‚</p><p>å¯è®¿é—®ã€‚</p><p>ï± æŒ‡ç¤º DBMS å¯¹æ£€ç´¢å‡ºçš„æ•°æ®ï¼ˆè€Œä¸æ˜¯æŒ‡å‡ºè¡¨ä¸­æ´»åŠ¨æ•°æ®ï¼‰è¿›è¡Œå¤åˆ¶ï¼Œ</p><p>ä½¿æ•°æ®åœ¨æ¸¸æ ‡æ‰“å¼€å’Œè®¿é—®æœŸé—´ä¸å˜åŒ–ã€‚</p></blockquote><p>æ¸¸æ ‡ä½¿ç”¨</p><blockquote><p>ï± åœ¨ä½¿ç”¨æ¸¸æ ‡å‰ï¼Œå¿…é¡»å£°æ˜ï¼ˆå®šä¹‰ï¼‰å®ƒã€‚è¿™ä¸ªè¿‡ç¨‹å®é™…ä¸Šæ²¡æœ‰æ£€ç´¢æ•°æ®ï¼Œ</p><p>å®ƒåªæ˜¯å®šä¹‰è¦ä½¿ç”¨çš„ SELECT è¯­å¥å’Œæ¸¸æ ‡é€‰é¡¹ã€‚</p><p>ï± ä¸€æ—¦å£°æ˜ï¼Œå°±å¿…é¡»æ‰“å¼€æ¸¸æ ‡ä»¥ä¾›ä½¿ç”¨ã€‚è¿™ä¸ªè¿‡ç¨‹ç”¨å‰é¢å®šä¹‰çš„ SELECT</p><p>è¯­å¥æŠŠæ•°æ®å®é™…æ£€ç´¢å‡ºæ¥ã€‚</p><p>ï± å¯¹äºå¡«æœ‰æ•°æ®çš„æ¸¸æ ‡ï¼Œæ ¹æ®éœ€è¦å–å‡ºï¼ˆæ£€ç´¢ï¼‰å„è¡Œã€‚</p><p>ï± åœ¨ç»“æŸæ¸¸æ ‡ä½¿ç”¨æ—¶ï¼Œå¿…é¡»å…³é—­æ¸¸æ ‡ï¼Œå¯èƒ½çš„è¯ï¼Œé‡Šæ”¾æ¸¸æ ‡ï¼ˆæœ‰èµ–äºå…·</p><p>ä½“çš„ DBMSï¼‰ã€‚</p><p>å£°æ˜æ¸¸æ ‡åï¼Œå¯æ ¹æ®éœ€è¦é¢‘ç¹åœ°æ‰“å¼€å’Œå…³é—­æ¸¸æ ‡ã€‚åœ¨æ¸¸æ ‡æ‰“å¼€æ—¶ï¼Œå¯æ ¹</p><p>æ®éœ€è¦é¢‘ç¹åœ°æ‰§è¡Œå–æ“ä½œã€‚</p></blockquote><p>åˆ›å»ºæ¸¸æ ‡</p><blockquote><p>ä½¿ç”¨ DECLARE è¯­å¥åˆ›å»ºæ¸¸æ ‡ï¼Œè¿™æ¡è¯­å¥åœ¨ä¸åŒçš„ DBMS ä¸­æœ‰æ‰€ä¸åŒã€‚</p><p>DECLARE å‘½åæ¸¸æ ‡ï¼Œå¹¶å®šä¹‰ç›¸åº”çš„ SELECT è¯­å¥ï¼Œæ ¹æ®éœ€è¦å¸¦ WHERE å’Œ</p><p>å…¶ä»–å­å¥ã€‚ä¸ºäº†è¯´æ˜ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ¸¸æ ‡æ¥æ£€ç´¢æ²¡æœ‰ç”µå­é‚®ä»¶åœ°å€çš„æ‰€</p><p>æœ‰é¡¾å®¢ï¼Œä½œä¸ºåº”ç”¨ç¨‹åºçš„ç»„æˆéƒ¨åˆ†ï¼Œå¸®åŠ©æ“ä½œäººå‘˜æ‰¾å‡ºç©ºç¼ºçš„ç”µå­é‚®ä»¶</p><p>åœ°å€</p></blockquote><p>è¯­æ³•</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">DECLARE CustCursor CURSOR FOR SELECT * FROM Customers WHERE cust_email IS NULL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨æ¸¸æ ‡</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">OPEN CURSOR CustCursor<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å…³é—­æ¸¸æ ‡</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CLOSE CustCursor DEALLOCATE CURSOR CustCursor<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="çº¦æŸï¼ˆä¸ä¼šæï¼‰"><a href="#çº¦æŸï¼ˆä¸ä¼šæï¼‰" class="headerlink" title="çº¦æŸï¼ˆä¸ä¼šæï¼‰"></a>çº¦æŸï¼ˆä¸ä¼šæï¼‰</h2><blockquote><p>DBMS é€šè¿‡åœ¨æ•°æ®åº“è¡¨ä¸Šæ–½åŠ çº¦æŸæ¥å®æ–½å¼•ç”¨å®Œæ•´æ€§ã€‚å¤§å¤šæ•°çº¦æŸæ˜¯åœ¨</p><p>è¡¨å®šä¹‰ä¸­å®šä¹‰çš„ï¼Œå¦‚ç¬¬ 17 è¯¾æ‰€è¿°ï¼Œç”¨ CREATE TABLE æˆ– ALTER TABLE</p><p>è¯­å¥ã€‚</p></blockquote><p>ä¸»é”®</p><blockquote><p>æˆ‘ä»¬åœ¨ç¬¬ 1 è¯¾ç®€å•æè¿‡ä¸»é”®ã€‚ä¸»é”®æ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¦æŸï¼Œç”¨æ¥ä¿è¯ä¸€åˆ—ï¼ˆæˆ–</p><p>ä¸€ç»„åˆ—ï¼‰ä¸­çš„å€¼æ˜¯å”¯ä¸€çš„ï¼Œè€Œä¸”æ°¸ä¸æ”¹åŠ¨ã€‚æ¢å¥è¯è¯´ï¼Œè¡¨ä¸­çš„ä¸€åˆ—ï¼ˆæˆ–</p><p>å¤šä¸ªåˆ—ï¼‰çš„å€¼å”¯ä¸€æ ‡è¯†è¡¨ä¸­çš„æ¯ä¸€è¡Œã€‚è¿™æ–¹ä¾¿äº†ç›´æ¥æˆ–äº¤äº’åœ°å¤„ç†è¡¨ä¸­</p><p>çš„è¡Œã€‚æ²¡æœ‰ä¸»é”®ï¼Œè¦å®‰å…¨åœ° UPDATE æˆ– DELETE ç‰¹å®šè¡Œè€Œä¸å½±å“å…¶ä»–è¡Œä¼š</p><p>éå¸¸å›°éš¾ã€‚</p><p>è¡¨ä¸­ä»»æ„åˆ—åªè¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œéƒ½å¯ä»¥ç”¨äºä¸»é”®ã€‚</p><p>ï± ä»»æ„ä¸¤è¡Œçš„ä¸»é”®å€¼éƒ½ä¸ç›¸åŒã€‚</p><p>ï± æ¯è¡Œéƒ½å…·æœ‰ä¸€ä¸ªä¸»é”®å€¼ï¼ˆå³åˆ—ä¸­ä¸å…è®¸ NULL å€¼ï¼‰ã€‚</p><p>ï± åŒ…å«ä¸»é”®å€¼çš„åˆ—ä»ä¸ä¿®æ”¹æˆ–æ›´æ–°ã€‚ï¼ˆå¤§å¤šæ•° DBMS ä¸å…è®¸è¿™ä¹ˆåšï¼Œä½†</p><p>å¦‚æœä½ ä½¿ç”¨çš„ DBMS å…è®¸è¿™æ ·åšï¼Œå¥½å§ï¼Œåƒä¸‡åˆ«ï¼ï¼‰</p><p>ï± ä¸»é”®å€¼ä¸èƒ½é‡ç”¨ã€‚å¦‚æœä»è¡¨ä¸­åˆ é™¤æŸä¸€è¡Œï¼Œå…¶ä¸»é”®å€¼ä¸åˆ†é…ç»™æ–°è¡Œã€‚</p><p>ä¸€ç§å®šä¹‰ä¸»é”®çš„æ–¹æ³•æ˜¯åˆ›å»ºå®ƒï¼Œå¦‚ä¸‹æ‰€ç¤º</p></blockquote><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE Vendors (  vend_id CHAR(10) NOT NULL PRIMARY KEY,  vend_name CHAR(50) NOT NULL,  vend_address CHAR(50) NULL,  vend_city CHAR(50) NULL,  vend_state CHAR(5) NULL,  vend_zip CHAR(10) NULL,  vend_country CHAR(50) NULL );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æ­¤ä¾‹å­ä¸­ï¼Œç»™è¡¨çš„ vend_id åˆ—å®šä¹‰æ·»åŠ å…³é”®å­— PRIMARY KEYï¼Œä½¿å…¶æˆ</p><p>ä¸ºä¸»é”®ã€‚</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">ALTER TABLE Vendors ADD CONSTRAINT PRIMARY KEY (vend_id);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™é‡Œå®šä¹‰ç›¸åŒçš„åˆ—ä¸ºä¸»é”®ï¼Œä½†ä½¿ç”¨çš„æ˜¯ CONSTRAINT è¯­æ³•ã€‚æ­¤è¯­æ³•ä¹Ÿå¯</p><p>ä»¥ç”¨äº CREATE TABLE å’Œ ALTER TABLE è¯­å¥</p><h3 id="å¤–é”®"><a href="#å¤–é”®" class="headerlink" title="å¤–é”®"></a>å¤–é”®</h3><p>å¤–é”®æ˜¯è¡¨ä¸­çš„ä¸€åˆ—ï¼Œå…¶å€¼å¿…é¡»åˆ—åœ¨å¦ä¸€è¡¨çš„ä¸»é”®ä¸­ã€‚å¤–é”®æ˜¯ä¿è¯å¼•ç”¨å®Œ</p><p>æ•´æ€§çš„æå…¶é‡è¦éƒ¨åˆ†ã€‚æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­æ¥ç†è§£å¤–é”®</p><blockquote><p>å¦‚ç¬¬ 6 è¯¾æ‰€è¿°ï¼Œé™¤å¸®åŠ©ä¿è¯å¼•ç”¨å®Œæ•´æ€§å¤–ï¼Œå¤–é”®è¿˜æœ‰å¦ä¸€ä¸ªé‡è¦ä½œç”¨ã€‚</p><p>åœ¨å®šä¹‰å¤–é”®åï¼ŒDBMS ä¸å…è®¸åˆ é™¤åœ¨å¦ä¸€ä¸ªè¡¨ä¸­å…·æœ‰å…³è”è¡Œçš„è¡Œã€‚ä¾‹</p><p>å¦‚ï¼Œä¸èƒ½åˆ é™¤å…³è”è®¢å•çš„é¡¾å®¢ã€‚åˆ é™¤è¯¥é¡¾å®¢çš„å”¯ä¸€æ–¹æ³•æ˜¯é¦–å…ˆåˆ é™¤ç›¸</p><p>å…³çš„è®¢å•ï¼ˆè¿™è¡¨ç¤ºè¿˜è¦åˆ é™¤ç›¸å…³çš„è®¢å•é¡¹ï¼‰ã€‚ç”±äºéœ€è¦ä¸€ç³»åˆ—çš„åˆ é™¤ï¼Œ</p><p>å› è€Œåˆ©ç”¨å¤–é”®å¯ä»¥é˜²æ­¢æ„å¤–åˆ é™¤æ•°æ®ã€‚</p><p>æœ‰çš„ DBMS æ”¯æŒç§°ä¸ºçº§è”åˆ é™¤ï¼ˆcascading deleteï¼‰çš„ç‰¹æ€§ã€‚å¦‚æœå¯ç”¨ï¼Œ</p><p>è¯¥ç‰¹æ€§åœ¨ä»ä¸€ä¸ªè¡¨ä¸­åˆ é™¤è¡Œæ—¶åˆ é™¤æ‰€æœ‰ç›¸å…³çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¯ç”¨</p><p>çº§è”åˆ é™¤å¹¶ä¸”ä» Customers è¡¨ä¸­åˆ é™¤æŸä¸ªé¡¾å®¢ï¼Œåˆ™ä»»ä½•å…³è”çš„è®¢å•è¡Œ</p><p>ä¹Ÿä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚</p></blockquote><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE Orders (  order_num INTEGER NOT NULL PRIMARY KEY,  order_date DATETIME NOT NULL, cust_id CHAR(10) NOT NULL REFERENCES â¥Customers(cust_id) );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE [ UNIQUE | FULLTEXT ] INDEX index_name ON table_name (inex_col_name,... ) ; UNIQUE ä»£è¡¨çš„æ˜¯ä¸€ä¸ªå”¯ä¸€çš„ç´¢å¼•ï¼Œä¸å¯é‡å¤SHOW INDEX FROM table_name ;iDROP INDEX index_name ON table_name ;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">è§¦å‘å™¨&gt; è§¦å‘å™¨æ˜¯ç‰¹æ®Šçš„å­˜å‚¨è¿‡ç¨‹ï¼Œå®ƒåœ¨ç‰¹å®šçš„æ•°æ®åº“æ´»åŠ¨å‘ç”Ÿæ—¶è‡ªåŠ¨æ‰§è¡Œã€‚è§¦å‘&gt;&gt; å™¨å¯ä»¥ä¸ç‰¹å®šè¡¨ä¸Šçš„ INSERTã€UPDATE å’Œ DELETE æ“ä½œï¼ˆæˆ–ç»„åˆï¼‰ç›¸å…³è”ã€‚&gt;&gt; ä¸å­˜å‚¨è¿‡ç¨‹ä¸ä¸€æ ·ï¼ˆå­˜å‚¨è¿‡ç¨‹åªæ˜¯ç®€å•çš„å­˜å‚¨ SQL è¯­å¥ï¼‰ï¼Œè§¦å‘å™¨ä¸å•&gt;&gt; ä¸ªçš„è¡¨ç›¸å…³è”ã€‚ä¸ Orders è¡¨ä¸Šçš„ INSERT æ“ä½œç›¸å…³è”çš„è§¦å‘å™¨åªåœ¨&gt;&gt; Orders è¡¨ä¸­æ’å…¥è¡Œæ—¶æ‰§è¡Œã€‚ç±»ä¼¼åœ°ï¼ŒCustomers è¡¨ä¸Šçš„ INSERT å’Œ&gt;&gt; UPDATE æ“ä½œçš„è§¦å‘å™¨åªåœ¨è¡¨ä¸Šå‡ºç°è¿™äº›æ“ä½œæ—¶æ‰§è¡Œã€‚&gt; è§¦å‘å™¨å†…çš„ä»£ç å…·æœ‰ä»¥ä¸‹æ•°æ®çš„è®¿é—®æƒï¼š&gt;&gt; ï± INSERT æ“ä½œä¸­çš„æ‰€æœ‰æ–°æ•°æ®ï¼›&gt;&gt; ï± UPDATE æ“ä½œä¸­çš„æ‰€æœ‰æ–°æ•°æ®å’Œæ—§æ•°æ®ï¼›&gt;&gt; ï± DELETE æ“ä½œä¸­åˆ é™¤çš„æ•°æ®ã€‚&gt;&gt; æ ¹æ®æ‰€ä½¿ç”¨çš„ DBMSçš„ä¸åŒï¼Œè§¦å‘å™¨å¯åœ¨ç‰¹å®šæ“ä½œæ‰§è¡Œä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œã€‚&gt;&gt; ä¸‹é¢æ˜¯è§¦å‘å™¨çš„ä¸€äº›å¸¸è§ç”¨é€”ã€‚&gt;&gt; ï± ä¿è¯æ•°æ®ä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œåœ¨ INSERT æˆ– UPDATE æ“ä½œä¸­å°†æ‰€æœ‰å·åè½¬æ¢&gt;&gt; ä¸ºå¤§å†™ã€‚&gt;&gt; ï± åŸºäºæŸä¸ªè¡¨çš„å˜åŠ¨åœ¨å…¶ä»–è¡¨ä¸Šæ‰§è¡Œæ´»åŠ¨ã€‚ä¾‹å¦‚ï¼Œæ¯å½“æ›´æ–°æˆ–åˆ é™¤ä¸€è¡Œ&gt;&gt; æ—¶å°†å®¡è®¡è·Ÿè¸ªè®°å½•å†™å…¥æŸä¸ªæ—¥å¿—è¡¨ã€‚```mysqlCREATE TRIGGER customer_state ON Customers FOR INSERT, UPDATE AS UPDATE Customers SET cust_state = Upper(cust_state) WHERE Customers.cust_id = inserted.cust_id;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="case-æ¥è¿›è¡Œå¤šæ¡ä»¶åˆ¤æ–­-ä¸è¦å¿˜è®°END"><a href="#case-æ¥è¿›è¡Œå¤šæ¡ä»¶åˆ¤æ–­-ä¸è¦å¿˜è®°END" class="headerlink" title="case æ¥è¿›è¡Œå¤šæ¡ä»¶åˆ¤æ–­ ä¸è¦å¿˜è®°END"></a>case æ¥è¿›è¡Œå¤šæ¡ä»¶åˆ¤æ–­ ä¸è¦å¿˜è®°END</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CASE WHEN XXXæ¡ä»¶ THEN æ»¡è¶³çš„ç»“æœ ELSE ä¸æ»¡è¶³ç»“æœ END<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¤šè¡Œè€¦åˆ</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CASE WHEN XXXæ¡ä»¶1 THEN Y1 WHEN XXX æ¡ä»¶2 THEN  Y2 WHEN XXX æ¡ä»¶3 THEN Y3 ELSE Y4 END  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h2><blockquote><p>ä¸€ç»„æ“ä½œçš„é›†åˆï¼Œä¸å¯åˆ†å‰²ï¼Œè¿™äº›æ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ï¼Œmysqlé»˜è®¤æäº¤æ–¹å¼æ˜¯è‡ªåŠ¨æäº¤çš„ï¼Œæ‰€ä»¥è¦æ”¹ä¸ºæ‰‹åŠ¨æäº¤æ‰è¡Œ</p></blockquote><p>æ–¹å¼1</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select @@autocommit; æŸ¥çœ‹æäº¤æ–¹å¼ï¼Œè¿”å›ä¸º1åˆ™ä¸ºè‡ªåŠ¨æäº¤ï¼Œå¦åˆ™ä¸ºæ‰‹åŠ¨æäº¤set @@autocommit = 0 ; è®¾ç½®ä¸ºæ‰‹åŠ¨æäº¤commit æäº¤rollback å›æ»š<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ–¹å¼äºŒ<br>äº‹åŠ¡æ“ä½œ</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">start transaction æˆ–è€… begin å¼€å¯äº‹åŠ¡commit æäº¤rollback å›æ»š <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>äº‹åŠ¡ç‰¹ç‚¹</p><ul><li><p><strong>åŸå­æ€§</strong> ä¸€ä¸ªäº‹åŠ¡ï¼ˆtransactionï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›æ»šï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚</p></li><li><p><strong>ä¸€è‡´æ€§</strong> åœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾è§„åˆ™ï¼Œè¿™åŒ…å«èµ„æ–™çš„ç²¾ç¡®åº¦ã€ä¸²è”æ€§ä»¥åŠåç»­æ•°æ®åº“å¯ä»¥è‡ªå‘æ€§åœ°å®Œæˆé¢„å®šçš„å·¥ä½œã€‚</p></li><li><p><strong>éš”ç¦»æ€§</strong> æ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬è¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰ã€è¯»æäº¤ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ã€‚</p></li><li><p><strong>æŒä¹…æ€§</strong> äº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p></li></ul><h3 id="å¹¶å‘äº‹åŠ¡é—®é¢˜"><a href="#å¹¶å‘äº‹åŠ¡é—®é¢˜" class="headerlink" title="å¹¶å‘äº‹åŠ¡é—®é¢˜"></a>å¹¶å‘äº‹åŠ¡é—®é¢˜</h3><ul><li>è„è¯» ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°å¦ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®</li><li>ä¸å¯é‡å¤è¯»ï¼Œä¸€ä¸ªäº‹åŠ¡å…ˆåè¯»å–ä¸€æ¡é‡å¤è®°å½•ï¼Œä½†ä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸åŒï¼Œæˆä¸ºä¸å¯é‡å¤è¯»</li><li>å¹»è¯» ä¸€ä¸ªäº‹åŠ¡æŒ‰ç…§æ¡ä»¶æŸ¥è¯¢æ—¶ï¼Œæ²¡æœ‰å¯¹åº”çš„æ•°æ®è¡Œä½†æ˜¯åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œè¿™è¡Œæ•°æ®å·²ç»å­˜åœ¨äº†ï¼Œå‡ºç°äº†å¹»å½±<br>äº‹åŠ¡éš”ç¦»çº§åˆ«<br><img src="/2023/08/02/58/1.png"><br>å¯ä»¥æ‰‹åŠ¨è®¾ç½®ç³»ç»Ÿçš„éš”ç¦»çº§åˆ«</li></ul><h2 id="å¼•æ“"><a href="#å¼•æ“" class="headerlink" title="å¼•æ“"></a>å¼•æ“</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE è¡¨å(å­—æ®µ1 å­—æ®µ1ç±»å‹ [ COMMENT å­—æ®µ1æ³¨é‡Š ] ,......å­—æ®µn å­—æ®µnç±»å‹ [COMMENT å­—æ®µnæ³¨é‡Š ]) ENGINE = INNODB [ COMMENT è¡¨æ³¨é‡Š ] ;show engines;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>InnoDBç‰¹ç‚¹<br>æ”¯æŒäº‹åŠ¡ï¼Œè¡Œçº§é”ï¼Œå¤–é”®çº¦æŸ</p><h3 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h3><blockquote><p>å…¨å±€é”ï¼šé”å®šæ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ã€‚<br>è¡¨çº§é”ï¼šæ¯æ¬¡æ“ä½œé”ä½æ•´å¼ è¡¨ã€‚<br>è¡Œçº§é”ï¼šæ¯æ¬¡æ“ä½œé”ä½å¯¹åº”çš„è¡Œæ•°æ®ã€‚</p></blockquote><h2 id="å¸¸ç”¨å‡½æ•°"><a href="#å¸¸ç”¨å‡½æ•°" class="headerlink" title="å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h2><blockquote><p>ã€€1ï¼‰ã€length()ï¼šmysqlé‡Œé¢çš„length()å‡½æ•°æ˜¯ä¸€ä¸ªç”¨æ¥è·å–å­—ç¬¦ä¸²é•¿åº¦çš„å†…ç½®å‡½æ•°ã€‚<br>ã€€ã€€2ï¼‰ã€char_length()ï¼šåœ¨mysqlå†…ç½®å‡½æ•°é‡Œé¢æŸ¥çœ‹å­—ç¬¦ä¸²é•¿åº¦çš„è¿˜æœ‰ä¸€ä¸ªå‡½æ•°æ˜¯char_length()ã€‚<br>ã€€ã€€3ï¼‰ã€è¿™ä¸¤ä¸ªå‡½æ•°çš„åŒºåˆ«æ˜¯ï¼š<br>ã€€ã€€ã€€ã€€aï¼‰ã€length()ï¼š å•ä½æ˜¯å­—èŠ‚ï¼Œutf8ç¼–ç ä¸‹,ä¸€ä¸ªæ±‰å­—ä¸‰ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªæ•°å­—æˆ–å­—æ¯ä¸€ä¸ªå­—èŠ‚ã€‚gbkç¼–ç ä¸‹,ä¸€ä¸ªæ±‰å­—ä¸¤ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªæ•°å­—æˆ–å­—æ¯ä¸€ä¸ªå­—èŠ‚ã€‚<br>ã€€ã€€ã€€ã€€bï¼‰ã€char_length()ï¼šå•ä½ä¸ºå­—ç¬¦ï¼Œä¸ç®¡æ±‰å­—è¿˜æ˜¯æ•°å­—æˆ–è€…æ˜¯å­—æ¯éƒ½ç®—æ˜¯ä¸€ä¸ªå­—ç¬¦ã€‚</p></blockquote><h2 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">^ï¼šè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è¡Œçš„å¼€å¤´[a-z]ï¼šè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦èŒƒå›´ï¼ŒåŒ¹é…ä» a åˆ° z çš„ä»»ä½•å­—ç¬¦ã€‚[0-9]ï¼šè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦èŒƒå›´ï¼ŒåŒ¹é…ä» 0 åˆ° 9 çš„ä»»ä½•å­—ç¬¦ã€‚[a-zA-Z]ï¼šè¿™ä¸ªå˜é‡åŒ¹é…ä» a åˆ° z æˆ– A åˆ° Z çš„ä»»ä½•å­—ç¬¦ã€‚è¯·æ³¨æ„ï¼Œä½ å¯ä»¥åœ¨æ–¹æ‹¬å·å†…æŒ‡å®šçš„å­—ç¬¦èŒƒå›´çš„æ•°é‡æ²¡æœ‰é™åˆ¶ï¼Œæ‚¨å¯ä»¥æ·»åŠ æƒ³è¦åŒ¹é…çš„å…¶ä»–å­—ç¬¦æˆ–èŒƒå›´ã€‚[^a-z]ï¼šè¿™ä¸ªå˜é‡åŒ¹é…ä¸åœ¨ a åˆ° z èŒƒå›´å†…çš„ä»»ä½•å­—ç¬¦ã€‚è¯·æ³¨æ„ï¼Œå­—ç¬¦ ^ ç”¨æ¥å¦å®šå­—ç¬¦èŒƒå›´ï¼Œå®ƒåœ¨æ–¹æ‹¬å·å†…çš„å«ä¹‰ä¸å®ƒçš„æ–¹æ‹¬å·å¤–è¡¨ç¤ºå¼€å§‹çš„å«ä¹‰ä¸åŒã€‚[a-z]*ï¼šè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦èŒƒå›´ï¼ŒåŒ¹é…ä» a åˆ° z çš„ä»»ä½•å­—ç¬¦ 0 æ¬¡æˆ–å¤šæ¬¡ã€‚[a-z]+ï¼šè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦èŒƒå›´ï¼ŒåŒ¹é…ä» a åˆ° z çš„ä»»ä½•å­—ç¬¦ 1 æ¬¡æˆ–å¤šæ¬¡ã€‚.ï¼šåŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚\.ï¼šè¡¨ç¤ºå¥ç‚¹å­—ç¬¦ã€‚è¯·æ³¨æ„ï¼Œåæ–œæ ç”¨äºè½¬ä¹‰å¥ç‚¹å­—ç¬¦ï¼Œå› ä¸ºå¥ç‚¹å­—ç¬¦åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­å…·æœ‰ç‰¹æ®Šå«ä¹‰ã€‚è¿˜è¦æ³¨æ„ï¼Œåœ¨è®¸å¤šè¯­è¨€ä¸­ï¼Œä½ éœ€è¦è½¬ä¹‰åæ–œæ æœ¬èº«ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨\\.ã€‚$ï¼šè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è¡Œçš„ç»“å°¾ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">//å¯¼åŒ…import com.mysql.jdbc.Driver;    import javax.swing.plaf.nimbus.State;  import java.sql.*;  public class Name {  public static void main(String[] args) throws Exception {  //æ³¨å†Œé©±åŠ¨ç¨‹åº  Class.forName("com.mysql.jdbc.Driver");  //è·å–è¿æ¥  String url = "jdbc:mysql://localhost:3306/t";  String username = "root";  String password = "hutao1224";  Connection conn = DriverManager.getConnection(url,username,password);  //è·å–æ‰§è¡Œsqlè¯­å¥çš„å¯¹è±¡  String sql = "insert into employees (name)value ('Amy');";  Statement stmt = conn.createStatement();  //æ‰§è¡Œsqlè¯­å¥  int count = stmt.executeUpdate(sql);  //å¤„ç†ç»“æœ  System.out.println(count);  //é‡Šæ”¾èµ„æº  stmt.close();  conn.close();}    }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é˜²æ­¢sqlæ³¨å…¥ä½¿ç”¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPreparedStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span> <span class="token punctuation">{</span>    <span class="token comment">//2. è·å–è¿æ¥ï¼šå¦‚æœè¿æ¥çš„æ˜¯æœ¬æœºmysqlå¹¶ä¸”ç«¯å£æ˜¯é»˜è®¤çš„ 3306 å¯ä»¥ç®€åŒ–ä¹¦å†™</span>    <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql:///db1?useSSL=false"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"1234"</span><span class="token punctuation">;</span>    <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ¥æ”¶ç”¨æˆ·è¾“å…¥ ç”¨æˆ·åå’Œå¯†ç </span>    <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">"zhangsan"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> pwd <span class="token operator">=</span> <span class="token string">"' or '1' = '1"</span><span class="token punctuation">;</span>    <span class="token comment">// å®šä¹‰sql</span>    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from tb_user where username = ? and password = ?"</span><span class="token punctuation">;</span>    <span class="token comment">// è·å–pstmtå¯¹è±¡</span>    <span class="token class-name">PreparedStatement</span> pstmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è®¾ç½®ï¼Ÿçš„å€¼</span>    pstmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//?çš„ä½ç½®å’Œå‚æ•°</span>    pstmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ‰§è¡Œsql</span>    <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> pstmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä¸éœ€è¦ä¼ é€’sqlè¯­å¥äº†</span>    <span class="token comment">// åˆ¤æ–­ç™»å½•æ˜¯å¦æˆåŠŸ</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç™»å½•æˆåŠŸ~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç™»å½•å¤±è´¥~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">//7. é‡Šæ”¾èµ„æº</span>    rs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    pstmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å˜é‡çš„ä½¿ç”¨"><a href="#å˜é‡çš„ä½¿ç”¨" class="headerlink" title="å˜é‡çš„ä½¿ç”¨"></a>å˜é‡çš„ä½¿ç”¨</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">å ä½ç¬¦ï¼Ÿåªèƒ½ç”¨æ¥å–ä»£sqlè¯­å¥ä¸­çš„å¸¸å˜é‡ï¼Œè€Œä¸èƒ½å–ä»£åˆ—åæˆ–è€…è¡¨åselect <span class="token operator">?</span> from <span class="token operator">?</span> where  <span class="token operator">?</span>   å‰ä¸¤ä¸ª<span class="token operator">?</span>ä¸æˆç«‹ï¼Œåªèƒ½ç”¨ <span class="token string">"+variable+"</span> çš„æ–¹å¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h3 id="é¢è¯•å¸¸é—®"><a href="#é¢è¯•å¸¸é—®" class="headerlink" title="é¢è¯•å¸¸é—®"></a>é¢è¯•å¸¸é—®</h3><ul><li>ä¸€è‡´æ€§å“ˆå¸Œï¼šæ•´ä¸ªå“ˆå¸Œå€¼çš„ç©ºé—´è¢«è§†ä¸ºä¸€ä¸ªç¯å½¢ï¼Œæ¯ä¸ªèŠ‚ç‚¹æˆ–æ•°æ®éƒ½è¢«æ˜ å°„åˆ°æ•´ä¸ªç¯ä¸Šï¼Œå½“éœ€è¦æŸ¥æ‰¾æŸä¸ªé”®æ—¶ï¼Œä¼šæ²¿ç€ç¯æŸ¥æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…çš„èŠ‚ç‚¹ã€‚</li><li>æ•°æ®ç»“æ„ï¼š<ul><li>SkipListè·³è¡¨ï¼ŒZSetä¸­å¦‚æœä¿å­˜åˆ°é”®å€¼å¯¹æ•°é‡&lt;128 &amp;&amp; æ¯ä¸ªå…ƒç´ çš„é•¿åº¦å°äº64Bå°±ä½¿ç”¨ziplistï¼Œå¦åˆ™åˆ™ä½¿ç”¨skiplist<ul><li>æ•°æ®æŒ‰ç…§å‡åºæ’åºå­˜å‚¨</li><li>èŠ‚ç‚¹å¯èƒ½åŒ…å«å¤šä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆè·¨åº¦ä¸åŒ</li></ul></li><li>SortedSetæ˜¯æœ‰åºé›†åˆï¼Œåº•å±‚å­˜å‚¨çš„æ¯ä¸ªæ•°æ®éƒ½åŒ…å«elementå’Œscoreä¸¤ä¸ªå€¼ï¼Œscoreæ˜¯å¾—åˆ†ï¼Œelementæ˜¯å­—ç¬¦ä¸²å€¼ï¼Œä¼šæ ¹æ®elementå’Œscoreå€¼æ’åºï¼Œå½¢æˆæœ‰åºé›†åˆï¼ŒåŸºäºSkipListå®ç°çš„</li><li>Rediså¦‚ä½•åˆ¤æ–­KEYæ˜¯å¦è¿‡æœŸå‘¢ï¼Ÿ<ul><li><strong>ç­”</strong>ï¼šåœ¨Redisä¸­ä¼šæœ‰ä¸¤ä¸ªDictï¼Œä¹Ÿå°±æ˜¯HashTableï¼Œå…¶ä¸­ä¸€ä¸ªè®°å½•KEY-VALUEé”®å€¼å¯¹ï¼Œå¦ä¸€ä¸ªè®°å½•KEYå’Œè¿‡æœŸæ—¶é—´ã€‚è¦åˆ¤æ–­ä¸€ä¸ªKEYæ˜¯å¦è¿‡æœŸï¼Œåªéœ€è¦åˆ°è®°å½•è¿‡æœŸæ—¶é—´çš„Dictä¸­æ ¹æ®KEYæŸ¥è¯¢å³å¯ã€‚</li></ul></li></ul></li><li>é›†ç¾¤é—®é¢˜ï¼š<ol><li>Sentinelæ˜¯å“¨å…µï¼šç›‘æ§èŠ‚ç‚¹çŠ¶æ€å¹¶è‡ªåŠ¨å®ç°æ•…éšœè½¬ç§» <img src="/2023/08/02/58/%E5%93%A8%E5%85%B5%E5%8E%9F%E7%90%86.png" alt="|400"><ul><li>å“¨å…µçš„ä½œç”¨ï¼šçŠ¶æ€ç›‘æ§ï¼Œæ•…éšœè½¬ç§»ï¼ŒçŠ¶æ€é€šçŸ¥</li><li>ä¸»è§‚ä¸‹çº¿æ˜¯æŸä¸€ä¸ªsentinelèŠ‚ç‚¹å‘ç°æŸä¸ªèŠ‚ç‚¹æ²¡åœ¨è§„å®šæ—¶é—´å†…å“åº”ï¼Œå®¢è§‚ä¸‹çº¿æ˜¯æŒ‡çš„æ˜¯æœ‰ä¸€åŠä»¥ä¸Šçš„sentineléƒ½è®¤ä¸ºä¸‹çº¿äº†æ‰è¡Œ</li><li>é€‰ä¸¾æ–°çš„master: </li><li>é€‰ä¸¾è§„åˆ™ï¼šåˆ¤æ–­ä¼˜å…ˆçº§ï¼Œåˆ¤æ–­offsetå€¼ï¼Œè¶Šé«˜è¶Šä¼˜å…ˆï¼Œåˆ¤æ–­idï¼Œè¶Šå°è¶Šä¼˜å…ˆ<ol><li>æ•…éšœæ£€æµ‹ï¼šsentinelæ£€æµ‹ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹çš„åœ¨çº¿æƒ…å†µï¼Œå¦‚æœæœ‰åŠæ•°ä»¥ä¸Šçš„sentinelè®¤ä¸ºä¸»èŠ‚ç‚¹æ•…éšœï¼Œå°±ä¼šå¼€å§‹é€‰ä¸¾</li><li>sentinelé€‰ä¸¾å‡ºä¸€ä¸ªleaderèŠ‚ç‚¹ï¼Œæ¯ä¸ªsentineléƒ½æœ‰èµ„æ ¼ï¼Œsentinelç¡®å®šmasterä¸‹çº¿ä¹‹åå°±ä¼šè¯·æ±‚å…¶ä»–sentinelåŒæ„è‡ªå·±æˆä¸ºleaderï¼Œç¥¨æ•°å¤§äºä¸€åŠçš„sentinelå³å¯æˆä¸ºleader,å¦‚æœæ²¡æœ‰é€‰å‡ºï¼Œå°±é‡å¤ç›´åˆ°é€‰å‡º</li><li>é€‰ä¸¾æ ¹æ® æ•°æ®å¤åˆ¶çš„åç§»é‡æ›´å¤§(æ•°æ®æœ€æ–°)ï¼Œè¿è¡Œidæ›´å°(è¿è¡Œæ—¶é—´æ›´é•¿ )ï¼ŒèŠ‚ç‚¹çš„ä¼˜å…ˆçº§è¿›è¡Œé€‰ä¸¾</li><li>é€šçŸ¥æ‰€æœ‰çš„ä»èŠ‚ç‚¹è®¾ç½®æ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¹¶ä¸”è¿›è¡Œå¤åˆ¶</li><li>é€šçŸ¥å®¢æˆ·ç«¯é‡æ–°è¿æ¥ä¸»èŠ‚ç‚¹</li></ol></li><li>ä¸»ä»å¤åˆ¶ï¼š<ul><li>å…¨é‡åŒæ­¥ï¼Œå½“slaveç¬¬ä¸€æ¬¡è¿æ¥åˆ°masteræˆ–è€…slaveæ–­å¼€å¤ªä¹…äº†ï¼Œrepl_baklog(å¤åˆ¶ç§¯å‹ç¼“å†²åŒº)çš„offsetå·²ç»è¢«è¦†ç›–äº†ï¼ŒåŒæ­¥è¿‡ç¨‹ä¸­æ”¶åˆ°çš„è¯»å†™å‘½ä»¤éƒ½ä¼šå…ˆæ‰§è¡Œç„¶åè®°å½•åœ¨repl_baklogä¸­ï¼Œé€ä¸ªå‘é€ç»™slave <img src="/2023/08/02/58/%E5%85%A8%E9%87%8F%E5%90%8C%E6%AD%A5.png" alt="|550"><ol><li>ä»èŠ‚ç‚¹ä¿å­˜ä¸»èŠ‚ç‚¹ä¿¡æ¯ï¼Œä¸ä¸»èŠ‚ç‚¹å»ºç«‹è¿æ¥ï¼Œä¸»èŠ‚ç‚¹åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œæ˜¯å°±ä¸ä»èŠ‚ç‚¹åŒæ­¥ç‰ˆæœ¬ä¿¡æ¯</li><li>ä¸»èŠ‚ç‚¹forkä¸€ä¸ªå­è¿›ç¨‹ä¿å­˜å½“å‰æ‰€æœ‰çš„æ•°æ®ï¼Œ2.å‘é€æ•°æ®å¿«ç…§3.ä¹‹åä¸»èŠ‚ç‚¹æ¯æ¬¡æ‰§è¡Œå…¶ä»–çš„æ“ä½œéƒ½ä¼šåŒæ­¥ç»™ä»èŠ‚ç‚¹<ul><li><p>**<code>Replication Id</code>**ï¼šç®€ç§°<code>replid</code>ï¼Œæ˜¯æ•°æ®é›†çš„æ ‡è®°ï¼Œreplidä¸€è‡´åˆ™æ˜¯åŒä¸€æ•°æ®é›†ã€‚æ¯ä¸ª<code>master</code>éƒ½æœ‰å”¯ä¸€çš„<code>replid</code>ï¼Œ<code>slave</code>åˆ™ä¼šç»§æ‰¿<code>master</code>èŠ‚ç‚¹çš„<code>replid</code></p></li><li><p>**<code>offset</code>**ï¼šåç§»é‡ï¼Œéšç€è®°å½•åœ¨<code>repl_baklog</code>ä¸­çš„æ•°æ®å¢å¤šè€Œé€æ¸å¢å¤§ã€‚<code>slave</code>å®ŒæˆåŒæ­¥æ—¶ä¹Ÿä¼šè®°å½•å½“å‰åŒæ­¥çš„<code>offset</code>ã€‚å¦‚æœ<code>slave</code>çš„<code>offset</code>å°äº<code>master</code>çš„<code>offset</code>ï¼Œè¯´æ˜<code>slave</code>æ•°æ®è½åäº<code>master</code>ï¼Œéœ€è¦æ›´æ–°ã€‚</p></li></ul></li></ol></li><li>å¢é‡åŒæ­¥ï¼š<img src="/2023/08/02/58/%E5%A2%9E%E9%87%8F%E5%90%8C%E6%AD%A5.png" alt="|750"><ul><li>æ ¹æ®offsetæ¥è¿›è¡ŒåŒæ­¥</li><li>å…·ä½“çš„æ¯”è¾ƒæ˜¯é€šè¿‡<code>repl_baklog</code>ï¼Œè®°å½•Rediså¤„ç†è¿‡çš„å‘½ä»¤åŠ<code>offset</code>ï¼ŒåŒ…æ‹¬masterå½“å‰çš„<code>offset</code>ï¼Œå’Œslaveå·²ç»æ‹·è´åˆ°çš„<code>offset</code>å‘é€çš„æ˜¯å‘½ä»¤ï¼š <img src="/2023/08/02/58/%E7%8E%AF%E5%BD%A2%E6%95%B0%E7%BB%84.png"></li></ul></li></ul></li><li>é˜²æ­¢è„‘è£‚é—®é¢˜ï¼šè®¾ç½®ä¸»èŠ‚ç‚¹æœ€å°‘éœ€è¦çš„ä»èŠ‚ç‚¹æ•°ï¼Œå°äºè¿™ä¸ªæ•°é‡ä¸»èŠ‚ç‚¹å°±ä¼šç¦æ­¢å†™æ•°æ®ï¼Œè®¾ç½®ä¸»ä»å¤åˆ¶å’ŒåŒæ­¥çš„æœ€å¤§å»¶è¿Ÿï¼Œå¦‚æœæ—¶é—´è¶…è¿‡è¿™ä¸ªå»¶è¿Ÿå°±ä¼šç¦æ­¢å†™æ•°æ®ã€‚åŒæ—¶å¯ä»¥ç”¨ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿ï¼Œå½“å‡ºç°ç½‘ç»œåˆ†åŒºæ—¶ï¼Œæœ‰éƒ¨åˆ†çš„èŠ‚ç‚¹ä»ç„¶èƒ½å¤Ÿè¿æ¥ä¸Šä¸»èŠ‚ç‚¹ï¼Œäºæ˜¯å°±ä¸ä¼šå‡ºç°é‡æ–°é€‰ä¸¾ä¸»èŠ‚ç‚¹ã€‚</li><li>offsetå¤åˆ¶åç§»é‡ï¼šä¸»ä»å„è‡ªç»´æŠ¤è‡ªå·±çš„offsetï¼Œå­èŠ‚ç‚¹æŠŠè‡ªå·±çš„offsetä¸ŠæŠ¥ï¼Œmasterä¿å­˜offset ï¼Œéƒ¨åˆ†å¤åˆ¶ä½¿ç”¨äºŒè€…çš„åç§»é‡æ¥åŒæ­¥ç¼ºå¤±çš„æ•°æ®</li></ul></li><li>åˆ†ç‰‡é›†ç¾¤ï¼š<img src="/2023/08/02/58/%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4.png"><ul><li>æ¯ä¸ªmasterä¿å­˜ä¸åŒçš„æ•°æ®ï¼Œç„¶åæ¯ä¸ªmasteréƒ½å¯ä»¥æœ‰å¤šä¸ªslaveèŠ‚ç‚¹ï¼Œä¹‹åmasterä¹‹é—´é€šè¿‡pingæ¥æ£€æµ‹å½¼æ­¤ä¹‹é—´çš„å¥åº·çŠ¶æ€ï¼Œå®¢æˆ·ç«¯è¯·æ±‚å¯ä»¥è®¿é—®é›†ç¾¤ä»»æ„èŠ‚ç‚¹ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«è½¬å‘åˆ°æ•°æ®æ‰€åœ¨çš„èŠ‚ç‚¹</li><li>æ•…éšœè½¬ç§»ï¼šæ¯ä¸ªmasterè½¬ç§»åˆ°è‡ªå·±çš„slaveå³å¯</li><li>ä¸ºä»€ä¹ˆæ’æ§½çš„æ•°é‡æ˜¯16384,16384æ˜¯2çš„14æ¬¡æ–¹ï¼Œæ˜¯ä¸€ä¸ªå¹³è¡¡æ€§ã€è¡Œå‘¢ä¸ªå’Œå…¼å®¹æ€§ä¹‹é—´å–å¾—æŠ˜è¡·çš„ç»“æœ</li><li>å¦‚ä½•å°†åŒä¸€ç±»æ•°æ®å›ºå®šçš„ä¿å­˜åœ¨åŒä¸€ä¸ªRediså®ä¾‹ï¼Ÿ<ul><li>Redisè®¡ç®—keyçš„æ’æ§½å€¼æ—¶ä¼šåˆ¤æ–­keyä¸­æ˜¯å¦åŒ…å«<code>{}</code>ï¼Œå¦‚æœæœ‰åˆ™åŸºäº<code>{}</code>å†…çš„å­—ç¬¦è®¡ç®—æ’æ§½</li><li>æ‰€ä»¥åªè¦ç”¨{key} ä½œä¸ºå‰ç¼€å³å¯æŠŠç›¸åŒçš„ç±»å‹çš„æ•°æ®è®¡ç®—çš„æ’æ§½ä¸€å®šç›¸åŒ</li></ul></li></ul></li><li>å¸¸è§çš„ç¼“å­˜æœ‰å‡ ç§ï¼š<ul><li>æ—è·¯ç¼“å­˜ï¼šä½¿ç”¨åº”ç”¨ç¨‹åºæ¥ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„ä¸€è‡´æ€§<ol><li>å…ˆå†™DBç„¶åç›´æ¥åˆ é™¤cache<ul><li>ä¸ºä½•åˆ é™¤ï¼Ÿ 1.å¦‚æœdbé¢‘ç¹æ›´æ”¹ï¼Œå¯¼è‡´cacheä¸­çš„æ•°æ®å¾ˆå°‘è¢«è®¿é—®ï¼Œåˆ é™¤å¯ä»¥èŠ‚çœæœåŠ¡ç«¯çš„èµ„æº 2. æ›´æ–°cacheæ›´å®¹æ˜“é€ æˆç¼“å­˜ä¸ä¸€è‡´çš„ç°è±¡</li><li>ä¸ºä½•ä¸èƒ½å…ˆåˆ é™¤cache? å› ä¸º å¦‚æœæœ‰ä¸¤ä¸ªè¯·æ±‚åŒæ—¶è®¿é—®ï¼Œè¯·æ±‚1å…ˆæŠŠcacheä¸­çš„æ•°æ®åˆ é™¤äº†ï¼Œè¯·æ±‚äºŒå°±ä¼šä»dbä¸­è¯»å–æ•°æ®ï¼Œç„¶åè¯·æ±‚ä¸€å†æ›´æ”¹dbï¼Œä¼šå¯¼è‡´è¯·æ±‚2è¯»åˆ°çš„æ˜¯æ—§å€¼</li><li>å†™cacheçš„é€Ÿåº¦è¦æ¯”å†™dbå¿«å¾ˆå¤šï¼Œæ‰€ä»¥å¾ˆå°‘ä¼šé€ æˆä¸ä¸€è‡´</li></ul></li><li>ä»cacheä¸­è¯»å–æ•°æ®ï¼Œè¯»ä¸åˆ°å†ä»dbä¸­è¯»å…¥å¹¶è¿”å›ï¼Œç„¶åæ”¾åˆ°cacheä¸­</li><li>ç¼ºç‚¹ï¼š<ul><li>é¦–æ¬¡è¯·æ±‚ä¸åœ¨cacheä¸­ï¼šå¯ä»¥å°†çƒ­ç‚¹æ•°æ®æå‰æ”¾å…¥</li></ul></li></ol></li><li>è¯»å†™ç©¿é€ï¼šä»¥cacheä¸ºä¸»ï¼Œè®©cacheæœåŠ¡æ“ä½œï¼Œä¸éœ€è¦<ul><li>å†™:å…ˆå†™cache,cacheæ²¡æœ‰æ—¶ç›´æ¥å†™db,æœ‰çš„è¯å…ˆæ›´æ–°cache,ä¹‹åæ›´æ–°db åŒæ­¥æ›´æ–°</li><li>è¯»ï¼šç›´æ¥è¯»cache,cacheæ²¡æœ‰ç›´æ¥è¯»dbï¼Œç„¶åæ”¾å…¥cache.</li></ul></li><li>å¼‚æ­¥ç¼“å­˜å†™å…¥ï¼šä¹Ÿæ˜¯ç”±cacheæœåŠ¡æ¥å¤„ç†,ä½†æ˜¯æ›´æ–°æ—¶ï¼Œåªæ›´æ–°cache,ç”±å¼‚æ­¥å¤„ç†æ¥æ›´æ–°db<ul><li>ç¼ºç‚¹ï¼šå®¹æ˜“é€ æˆæ•°æ®ä¸ä¸€è‡´</li><li>é€‚åˆå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚æ²¡é‚£ä¹ˆ é«˜çš„</li></ul></li></ul></li><li>Rediså•çº¿ç¨‹æ¨¡å‹ï¼šRediså¯¹äºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥éƒ½å…³è”ä¸€ä¸ªæŒ‡ä»¤é˜Ÿåˆ—å’Œå“åº”é˜Ÿåˆ—<ul><li>ä¸ºä½•å•çº¿ç¨‹æ€§èƒ½è¿˜è¿™ä¹ˆé«˜ï¼Ÿ <ol><li>ä½¿ç”¨çº¯å†…å­˜è®¿é—®ï¼Œ</li><li>å•çº¿ç¨‹é¿å…ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰</li><li>IOå¤šè·¯å¤ç”¨ï¼Œå¯¹äºå¤šä¸ªIOï¼ŒRedisæ¯æ¬¡å¤„ç†å…¶ä¸­ä¸€ä¸ªIOç„¶åæš‚åœå¯¹å…¶ä»–çš„IOäº‹ä»¶ã€‚ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥ç›‘å¬å¤šä¸ªsocketæŸä¸ªsocketå¯è¯»æ—¶åŠé€†è¡Œè¯»å†™<ul><li>å®ç°ï¼šselect(æ–‡ä»¶æè¿°ç¬¦æœ‰ä¸Šé™)ï¼Œpollè¿™ä¿©åªä¼šé€šçŸ¥ç”¨æˆ·æœ‰æœ‰Socketå°±ç»ªï¼Œä¸ç¡®å®šå…·ä½“çš„æ˜¯å“ªä¸ªï¼Œéœ€è¦è½®è¯¢æ¥æ‰¾</li><li>epollä¼šé€šçŸ¥ç”¨æˆ·çš„æ—¶å€™æŠŠå“ªä¸ªsocketä¹Ÿç›´æ¥å†™å…¥ç”¨æˆ·ç©ºé—´ </li><li>è¯¦ç»†ä»‹ç»ä¸€ä¸‹ä¸ºä»€ä¹ˆI/Oå¤ç”¨</li></ul><ol start="2"><li>Redisæ˜¯çº¯å†…å­˜çš„ï¼Œæ‰€ä»¥æ€§èƒ½å–å†³äºç½‘ç»œå»¶è¿Ÿï¼ŒI/Oå¤šè·¯å¤ç”¨å®ç°äº†é«˜æ•ˆçš„ç½‘ç»œè¯·æ±‚<ol><li>å¸¸è§çš„IOæœ‰ é˜»å¡ï¼Œéé˜»å¡ï¼Œå¤šè·¯å¤ç”¨</li><li>éé˜»å¡å¼IOï¼Œè¯»åˆ°å¤šå°‘å°±éƒ½å¤šå°‘ï¼Œå†™å¤šå°‘ï¼Œä¸ä¼šç­‰å¾…æ»¡è¶³å­—èŠ‚è¦æ±‚</li></ol></li></ol></li></ol></li><li>ä¼˜ç‚¹ï¼šé¿å…äº†çº¿ç¨‹åˆ‡æ¢çš„æ¶ˆè€—ã€‚</li></ul></li></ol><ul><li>ä¸»ä»å¤åˆ¶ï¼š ä¸»æœåŠ¡å™¨æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œä¼šå°†å†™æ“ä½œåŒæ­¥ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨åªè¯»ï¼Œå¹¶æ‰§è¡Œä¸»æœåŠ¡å™¨åŒæ­¥è¿‡æ¥çš„æŒ‡ä»¤ ç¼ºç‚¹ï¼šä¸»æœåŠ¡å™¨å®•æœºæ—¶å¿…é¡»æ‰‹åŠ¨æ¢å¤</li><li>å“¨å…µæ¨¡å¼ï¼š ç›‘æ§ä¸»ä»æœåŠ¡å™¨ï¼Œæä¾›ä¸»ä»èŠ‚ç‚¹æ•…éšœè½¬ç§»çš„åŠŸèƒ½</li><li>åˆ‡ç‰‡é›†ç¾¤ï¼šå°†æ•°æ®åˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä»¥æ­¤æ¥é™ä½ç³»ç»Ÿå¯¹å•ä¸»èŠ‚ç‚¹çš„ä¾èµ–ï¼Œä»è€Œæé«˜ Redis æœåŠ¡çš„è¯»å†™æ€§èƒ½ã€‚</li><li>è„‘è£‚é—®é¢˜ï¼š ç”±äºç½‘ç»œé—®é¢˜ï¼Œé›†ç¾¤èŠ‚ç‚¹ä¹‹é—´å¤±å»è”ç³»ã€‚ä¸»ä»æ•°æ®ä¸åŒæ­¥ï¼›é‡æ–°å¹³è¡¡é€‰ä¸¾ï¼Œäº§ç”Ÿä¸¤ä¸ªä¸»æœåŠ¡ã€‚ç­‰ç½‘ç»œæ¢å¤ï¼Œæ—§ä¸»èŠ‚ç‚¹ä¼šé™çº§ä¸ºä»èŠ‚ç‚¹ï¼Œå†ä¸æ–°ä¸»èŠ‚ç‚¹è¿›è¡ŒåŒæ­¥å¤åˆ¶çš„æ—¶å€™ï¼Œç”±äºä¼šä»èŠ‚ç‚¹ä¼šæ¸…ç©ºè‡ªå·±çš„ç¼“å†²åŒºï¼Œæ‰€ä»¥å¯¼è‡´ä¹‹å‰å®¢æˆ·ç«¯å†™å…¥çš„æ•°æ®ä¸¢å¤±äº†ã€‚ è§£å†³ï¼š å½“ä¸»èŠ‚ç‚¹å‘ç°ä»èŠ‚ç‚¹ä¸‹çº¿æˆ–è€…é€šä¿¡è¶…æ—¶çš„æ€»æ•°é‡å¤§äºé˜ˆå€¼æ—¶ï¼Œé‚£ä¹ˆç¦æ­¢ä¸»èŠ‚ç‚¹è¿›è¡Œå†™æ•°æ®ï¼Œç›´æ¥æŠŠé”™è¯¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ul></li><li>æ•°æ®ç›¸å…³ï¼š<ul><li>æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š<ul><li>å¦‚ä½•ä¿è¯Redisä¸­çš„æ•°æ®æ˜¯çƒ­ç‚¹æ•°æ®ï¼Ÿ ç­”æ¡ˆæ˜¯å¯ä»¥ä½¿ç”¨LRUåˆ é™¤ç­–ç•¥ï¼Œæ¯æ¬¡åˆ é™¤æ•°æ®æ—¶åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é”®ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¸»åŠ¨å»æ›´æ–°çƒ­ç‚¹æ•°æ®</li><li>å…¶ä½™çš„å„ç§å†…å­˜æ·˜æ±°æœºåˆ¶ï¼š1.å†…å­˜åˆ°è¾¾é™åˆ¶æ—¶è¿”å›é”™è¯¯ï¼Œä¸åˆ é™¤ï¼Œ2.åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨é”®ï¼Œ3.lruä½†æ˜¯åªåˆ é™¤è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ï¼Œ4.éšæœºåˆ é™¤ä¸€äº› 5. éšæœºåˆ é™¤ä¸€äº›è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®6. å¯¹è®¿é—®é¢‘ç‡æ¥è¿›è¡Œåˆ é™¤<img src="/2023/08/02/58/redis%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5.png"></li></ul></li><li>æŒä¹…åŒ–ï¼š<ul><li>RDBï¼šåˆ›å»ºæ•°æ®çš„å¿«ç…§ï¼Œå­˜çš„æ˜¯å®é™…çš„æ•°æ®<ul><li>rediså»ºç«‹æ–°çš„å­è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹ç»§ç»­å¤„ç†è¯·æ±‚ï¼Œå­è¿›ç¨‹è´Ÿè´£å°†å†…å­˜å†…å®¹å†™åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œosçš„å®æ—¶å¤å†™copy-on-writeä¼šä½¿å¾—çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹å…±äº«ä¸€ä¸ªç‰©ç†é¡µé¢ï¼Œæ‰€ä»¥ä¼šä¸ºçˆ¶è¿›ç¨‹è¦ä¿®æ”¹çš„é¡µé¢åˆ›å»ºå‰¯æœ¬ï¼Œæ‰€ä»¥å­è¿›ç¨‹å†…çš„æ•°æ®å°±æ˜¯forkæ—¶çš„å¿«ç…§ã€‚ å­è¿›ç¨‹å†™å®Œæ–‡ä»¶ä¹‹åï¼Œä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ä»£æ›¿åŸæ¥çš„å¿«ç…§æ–‡ä»¶ï¼Œä¹‹åå­è¿›ç¨‹quit, <strong>è¿›è¡Œçš„æ˜¯å…¨é‡å¿«ç…§ï¼Œä¼šæŠŠæ•´ä¸ªæ•°æ®å…¨éƒ¨ä¿å­˜</strong></li></ul></li><li>AOFï¼š<ul><li>é‡å†™ï¼šAOFé‡å†™ä¼šè°ƒç”¨ä¸€ä¸ªå­è¿›ç¨‹ï¼Œç”±å­è¿›ç¨‹å»è¿›è¡Œé‡å†™ï¼Œä¼šè¯»å–æ•°æ®åº“ä¸­çš„é”®å€¼å¯¹ä¸ºæ¯ä¸€ä¸ªé”®å€¼å¯¹ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªå†™å‘½ä»¤ï¼Œè¿™äº›å†™å‘½ä»¤è¶³ä»¥æ¢å¤è¿™ä¸ªé”®å€¼å¯¹çš„çŠ¶æ€ã€‚ç„¶åæŠŠä»–ä»¬å†™å…¥ä¸€ä¸ªæ–°çš„AOFæ–‡ä»¶ä¸­ï¼ŒåŒæ—¶Redisä¼šç»´æŠ¤ä¸€ä¸ªAOFç¼“å†²åŒºï¼ŒæŠŠé‡å†™æœŸé—´è¿›è¡Œçš„æ•°æ®åº“å†™æ“ä½œè®°å½•åˆ°ç¼“å†²åŒºä¸­ï¼Œé‡å†™å®Œæ¯•ä¹‹åä¼šæŠŠæ–°çš„AOFæ–‡ä»¶å‘ç»™ä¸»è¿›ç¨‹ï¼Œç„¶åé€€å‡ºï¼Œä¸»è¿›ç¨‹æŠŠç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤å†™å…¥å…¶ä¸­å¹¶ä½¿ç”¨æ–°çš„AOFæ–‡ä»¶æ›¿æ¢æ—§çš„AOFæ–‡ä»¶</li></ul></li></ul></li><li>æ³¨æ„ï¼šå®ç°åŸç†æ˜¯æ“ä½œç³»ç»Ÿä¼šä¸ºè¿›ç¨‹<ul><li>AOFï¼šè®°å½•æ“ä½œå‘½ä»¤è€Œä¸æ˜¯å‰¯æœ¬ã€‚<ol><li>fork,å­è¿›ç¨‹å‘ä¸´æ—¶æ–‡ä»¶ä¸­å†™å…¥é‡å»ºæ•°æ®åº“çŠ¶æ€çš„å‘½ä»¤</li><li>çˆ¶è¿›ç¨‹æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒæŠŠå†™å‘½ä»¤å†™å…¥åˆ°åŸæ¥çš„aofæ–‡ä»¶ä¸­ï¼Œç„¶åç¼“å­˜èµ·æ¥è¿™äº›å‘½ä»¤</li><li>å­è¿›ç¨‹æå®Œä¹‹åï¼Œé€šçŸ¥çˆ¶è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹æŠŠç¼“å­˜èµ·æ¥çš„å‘½ä»¤å†™å…¥ä¸´æ—¶æ–‡ä»¶</li><li>ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶æ›¿ä»£è€æ–‡ä»¶,æ³¨æ„ä¸ä¼šè¯»å–è€æ–‡ä»¶</li></ol></li><li>æ··åˆæŒä¹…åŒ–ï¼šä¸¤è€…ç»“åˆï¼Œæƒ°æ€§åˆ é™¤ï¼šåªæœ‰åœ¨è®¿é—®è¿™ä¸ªé”®çš„æ—¶å€™æ‰æ£€æŸ¥æ˜¯å¦è¿‡æœŸ</li></ul><ol><li>è¯»å†™åˆ†ç¦»é—®é¢˜ï¼šè¯»å æ¯”è¾ƒå¤§æ—¶å¯ä»¥æŠŠä¸€éƒ¨åˆ†çš„æµé‡æ‘Šåˆ°ä»èŠ‚ç‚¹ï¼Œåªå¯¹ä¸»èŠ‚ç‚¹è¿›è¡Œå†™æœåŠ¡ã€‚</li></ol></li><li>è¿‡æœŸç­–ç•¥ï¼šæƒ°æ€§åˆ é™¤å’Œå®šæ—¶åˆ é™¤ï¼ŒRedisä½¿ç”¨äº†ä¸¤ç§ç»“åˆçš„æ–¹å¼ï¼šå½“æŸä¸ªkeyè¢«è®¿é—®æ—¶ï¼Œä¼šå®šæœŸæ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸå°±åˆ é™¤ï¼ŒåŒæ—¶ä¼šå®šæœŸå¯¹ä¸€éƒ¨åˆ†keyè¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœè¿‡æœŸå°±åˆ é™¤<ul><li>å‘¨æœŸåˆ é™¤çš„æ¨¡å¼ï¼š<ol><li>SLOWæ¨¡å¼ï¼šé€šè¿‡å®šæ—¶ä»»åŠ¡å®šæœŸæŠ½æ ·éƒ¨åˆ†å¸¦æœ‰TTLçš„keyï¼Œåˆ¤æ–­æ˜¯å¦è¿‡æœŸã€‚å¦‚æœè¿‡æœŸkeyæ¯”ä¾‹è¾ƒé«˜ä¼šå¤šæ¬¡æŠ½è±¡</li><li>FASTæ¨¡å¼ï¼šRedisæ¯æ¬¡å¤„ç†NIOäº‹ä»¶ä¹‹å‰ï¼Œéƒ½ä¼šæŠ½æ ·éƒ¨åˆ†å¸¦æœ‰TTLçš„keyï¼Œåˆ¤æ–­æ˜¯å¦è¿‡ç¨‹ï¼Œå› æ­¤é¢‘ç‡è¾ƒé«˜ã€‚å¦‚æœæ—¶é—´å……è¶³å¹¶ä¸”è¿‡æœŸkeyæ¯”ä¾‹è¿‡é«˜ï¼Œä¹Ÿä¼šå¤šæ¬¡æŠ½æ ·ã€‚</li></ol></li></ul></li></ul></li></ul><h2 id="ç¼“å­˜é—®é¢˜"><a href="#ç¼“å­˜é—®é¢˜" class="headerlink" title="ç¼“å­˜é—®é¢˜"></a>ç¼“å­˜é—®é¢˜</h2><ul><li><strong>ç¼“å­˜é—®é¢˜</strong>:<ul><li>ç¼“å­˜é›ªå´©ï¼š<strong>å¤§é‡ç¼“å­˜</strong> åœ¨åŒä¸€æ—¶é—´å¤±æ•ˆæˆ–è€…Rediså®•æœºå¯¼è‡´åé¢çš„è¯·æ±‚éƒ½ç›´æ¥è½åˆ°äº†db<ul><li>ä¿®æ”¹keyçš„TTLï¼Œè®¾ç½®éšæœºTTL<ol><li>å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´æ‰“æ•£ï¼Œåœ¨å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸ŠåŠ ä¸€ä¸ªéšæœºå€¼</li><li>è®¾ç½®ç¼“å­˜ä¸è¿‡æœŸ</li></ol></li><li>æ­å»ºRedisçš„é›†ç¾¤ï¼Œå“¨å…µæ¨¡å¼ï¼Œé›†ç¾¤æ¨¡å¼<ul><li>ç»™ä¸šåŠ¡é™æµï¼Œnginxå’Œspring cloud gateway</li></ul></li><li>ä½¿ç”¨å¤šçº§ç¼“å­˜ï¼ŒGuavaå’ŒCaffeine + Redisï¼Œ å‰é¢è¿™ä¿©æ˜¯ç¼“å­˜åœ¨æœåŠ¡ä¸­çš„JVMä¸­çš„ï¼Œåˆ†å¸ƒå¼é¡¹ç›®ä¸­ä¸èƒ½è·¨æœåŠ¡ï¼Œä½†æ˜¯è¯·æ±‚é€Ÿåº¦æ˜¯æœ€å¿«çš„ï¼Œå› ä¸ºæ˜¯æœ¬åœ°çš„ç¼“å­˜</li><li>ç»™ç¼“å­˜ä¸šåŠ¡æ·»åŠ é™çº§é™æµç­–ç•¥</li></ul></li><li><strong>ç¼“å­˜å‡»ç©¿</strong>ï¼šçƒ­ç‚¹keyè¿‡æœŸï¼Œå¤§é‡çš„è¯·æ±‚ç›´æ¥ç»™æ•°æ®åº“å‹åŠ›<ul><li>äº’æ–¥é”æ–¹æ¡ˆï¼Œä¿è¯åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªä¸šåŠ¡çº¿ç¨‹è¯·æ±‚ä¸šåŠ¡ç¼“å­˜</li><li>ä¸ç»™çƒ­ç‚¹æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œç”±å¼‚æ­¥æ›´æ–°ç¼“å­˜ï¼Œæˆ–è€…åœ¨çƒ­ç‚¹æ•°æ®è¦è¿‡æœŸçš„æ—¶å€™ï¼Œæå‰é€šçŸ¥å‰å°çº¿ç¨‹æ›´æ–°ç¼“å­˜æˆ–è€…é‡æ–°è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¿è¯é«˜å¯ç”¨ï¼Œæ•°æ®ä¸ä¼šæ˜¯ç»å¯¹ä¸€è‡´çš„</li></ul></li><li>ç¼“å­˜ç©¿é€ï¼šè®¿é—®çš„æ•°æ®ä¸åœ¨ç¼“å­˜ä¸­ï¼Œæ¯æ¬¡éƒ½ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼Œç»™æ•°æ®åº“å¾ˆå¤§å‹åŠ› ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨<ul><li>éæ³•è¯·æ±‚çš„é™åˆ¶ï¼Œå½“æœ‰å¤§é‡æ¶æ„è¯·æ±‚è®¿é—®ä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œåœ¨APIå…¥å£è¦åˆ¤æ–­è¯·æ±‚å‚æ•°æ˜¯å¦åˆç†</li><li>è®¾ç½®ç©ºå€¼æˆ–è€…é»˜è®¤å€¼</li><li>ä½¿ç”¨<strong>å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œé¿å…é€šè¿‡æŸ¥è¯¢æ•°æ®åº“æ¥åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨</strong>ï¼š</li><li><a href="https://zhuanlan.zhihu.com/p/94433082">å¸ƒéš†è¿‡æ»¤å™¨</a>å¯¹ä¸€ä¸ªæ•°æ®ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°æ¥æ˜ å°„ï¼Œå½“æŸ¥è¯¢æ—¶ï¼Œå¦‚æœå¤šä¸ªå“ˆå¸Œå‡½æ•°çš„æ˜ å°„åä»»ä½•ä¸€ä¸ªç´¢å¼•éƒ½ä¸º0ï¼Œåˆ™ä¸€å®šä¸å­˜åœ¨ï¼Œå¦‚æœæ‰€æœ‰çš„æ˜ å°„åçš„ä½ç½®éƒ½æ˜¯1æ—¶ï¼Œåˆ™å¯èƒ½å­˜åœ¨é›†åˆä¸­ã€‚ä½¿ç”¨çš„æ˜¯ä½å›¾<img src="/2023/08/02/58/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8.png"></li></ul></li><li>æ•°æ®ä¸€è‡´æ€§<ul><li><strong>åŒå†™ä¸€è‡´é—®é¢˜ï¼š</strong><ul><li>ä¿è¯ä¸€è‡´æ€§<br>  1. å†™ä½¿ç”¨çš„<strong>å»¶è¿ŸåŒåˆ </strong>ï¼Œåˆ ä¸¤æ¬¡ç¼“å­˜ï¼Œç­‰æ•°æ®åº“ä¿®æ”¹å®Œä¹‹åå†åˆ é™¤ä¸€æ¬¡ç¼“å­˜ï¼Œç”¨äºè§£å†³æ•°æ®åº“ä¸»ä»ä¸€è‡´æ€§é—®é¢˜ï¼Œä¸ç¼“å­˜åŒæ­¥ä¸ºuç®¡ã€‚<br>  2. Cache Aside æ—è·¯ç¼“å­˜ç­–ç•¥<br>      - å†™ç­–ç•¥ï¼šå…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜ä¸­çš„æ•°æ®<br>      - è¯»ç­–ç•¥ï¼šå¦‚æœå‘½ä¸­äº†ç¼“å­˜ï¼Œç›´æ¥è¿”å›ï¼Œå¦åˆ™ä»æ•°æ®åº“ä¸­è¯»å…¥æ•°æ®å¹¶å†™å…¥ç¼“å­˜ï¼Œè¿”å›ç»™ç”¨æˆ·<br>  3. Read/Write Through è¯»ç©¿/å†™ç©¿ç­–ç•¥: åº”ç”¨ç¨‹åºåªä¸ç¼“å­˜äº¤äº’ï¼Œç”±ç¼“å­˜ç»„ä»¶å’Œæ•°æ®åº“äº¤äº’ï¼Œ<br>      - è¯»ä¸ºåå‘¨ç›´æ¥æŸ¥æ•°æ®åº“ç„¶åå†™å…¥ç¼“å­˜<br>      - å†™æœªå‘½ä¸­ï¼Œç¼“å­˜å­˜åœ¨ç›´æ¥å†™ç¼“å­˜ï¼Œç„¶åç”±ç¼“å­˜ç»„ä»¶å»æ›´æ–°æ•°æ®åº“ã€‚ç¼“å­˜ä¸å­˜åœ¨åˆ™ç›´æ¥æ›´æ–°æ•°æ®åº“<br>  4. Write Backï¼ˆå†™å›ï¼‰ç­–ç•¥<ul><li>ä½¿ç”¨è¯»é”(å…±äº«é”)å’Œå†™é”(æ’ä»–é”)</li></ul></li><li>å…è®¸çŸ­æš‚ä¸ä¸€è‡´ï¼š<ul><li>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå…ˆä¿®æ”¹æ•°æ®åº“ï¼Œæ•°æ®åº“ä¿®æ”¹å®Œä¹‹åå‘MQå‘é€æ¶ˆæ¯ï¼Œç”±caheæœåŠ¡æ¥å—æ¶ˆæ¯æ¥å¯¹ç¼“å­˜è¿›è¡Œæ›´æ–°</li><li>å–å†³äºmqçš„å¯é æ€§</li></ul></li></ul></li></ul></li></ul></li><li>å»¶æ—¶é˜Ÿåˆ—ï¼š æŠŠå½“å‰è¦åšçš„äº‹æƒ…æ¨è¿Ÿä¸€æ®µæ—¶é—´å†åšï¼Œå¦‚ä¸‹å•æœªä»˜æ¬¾å–æ¶ˆ<ul><li>å¯ä»¥ä½¿ç”¨ Zsetæ¥çº¯ç†ï¼ŒScoreå±æ€§æ¥å­˜å‚¨å»¶è¿Ÿæ‰§è¡Œçš„æ—¶é—´</li><li>zadd score1 value1;</li><li>å¤§key  valueçš„å€¼å¾ˆå¤§</li></ul></li><li>åˆ†å¸ƒå¼é—®é¢˜ï¼š<ol><li>åˆ†å¸ƒå¼é”ï¼šsetnx å®é™…ä½¿ç”¨åº”è¯¥ä½¿ç”¨ set key value nx ex time å› ä¸ºè¿™ä¸ªå¯ä»¥ç›´æ¥åœ¨åŸå­æ€§æŒ‡å®šæ—¶é—´</li><li>Reddsionæ¥ç»­é”ï¼šä½¿ç”¨luaè„šæœ¬ï¼Œæ¥ä¿è¯åŸå­æ€§<ol><li>ä¸€ä¸ªçº¿ç¨‹è·å¾—é”ï¼Œç„¶ååœ¨äº‹åŠ¡ä¸­è°ƒç”¨äº†å¦ä¸€ä¸ªäº‹åŠ¡ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ä¹ŸåŒæ ·å¯¹ç›¸åŒçš„é”åŠ é”ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ<ul><li>å¦‚æœæ˜¯ç›´æ¥ä½¿ç”¨Redisï¼Œä¼šé˜»å¡ï¼Œç„¶åç­‰é”è¿‡æœŸåï¼Œè¢«è°ƒç”¨çš„å‡½æ•°å¯ä»¥æ‰§è¡Œï¼Œè¢«è°ƒç”¨çš„å‡½æ•°æ‰§è¡Œä¹‹åä¼šé‡Šæ”¾é”ï¼Œè¿”å›åˆ°ç¬¬ä¸€ä¸ªå‡½æ•°æ‰§è¡Œï¼Œç¬¬ä¸€ä¸ªå‡½æ•°æ‰§è¡Œä¹‹åå°±ä¼šé‡å¤é‡Šæ”¾è¿™ä¸ªé”ï¼Œæ— æ³•ä¿è¯åŸå­æ€§äº†ã€‚</li><li>å¦‚æœä½¿ç”¨Redssionï¼ŒRedssionçš„RLockæ•°æ®ç»“æ„å®ç°äº†å¯é‡å…¥é”ï¼š<ul><li>keyï¼ŒstatusæŒæœ‰è¿˜æ˜¯é‡Šæ”¾ ï¼ŒUUIDæ ‡è¯†çº¿ç¨‹ ï¼Œ æŒæœ‰æ—¶é—´(æœ€é•¿çš„å­˜æ´»æ—¶é—´)</li><li>Redisä¸­å­˜çš„valueå­—æ®µä¸ºé”çš„æ¬¡æ•°</li></ul></li></ul></li></ol></li></ol></li></ul><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"myLock"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"status"</span><span class="token operator">:</span> <span class="token string">"LOCKED"</span><span class="token punctuation">,</span>    <span class="token property">"owner"</span><span class="token operator">:</span> <span class="token string">"some-unique-uuid"</span><span class="token punctuation">,</span>    <span class="token property">"hold_count"</span><span class="token operator">:</span> <span class="token number">2</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code>        - è¿™ä¸ªé—®é¢˜ä¸­å°±ä¼šç›´æ¥åˆ¤æ–­å‡ºæ˜¯åŒä¸€ä¸ªçº¿ç¨‹çš„è°ƒç”¨ï¼Œæ‰€ä»¥åªä¼šç»™é”çš„æŒæœ‰æŠ€æœ¯+1ï¼Œä¸ä¼šé˜»å¡</code></pre><ul><li><p>multiå¼€å§‹äº‹åŠ¡ï¼Œdiscardå–æ¶ˆäº‹åŠ¡redisçš„äº‹åŠ¡åœ¨å‡ºé”™æ—¶ï¼Œåªä¼šå›æ»šå‡ºé”™çš„å‘½ä»¤</p></li><li><p>ä½¿ç”¨watch key æ¥å¯¹æŸä¸€ä¸ªkeyåŠ ä¸Šä¹è§‚é”</p></li><li><p>Redis ä¸ Memcached&nbsp;<strong>åŒºåˆ«</strong>ï¼š</p><ol><li>Redisæ”¯æŒçš„æ•°æ®ç±»å‹æ›´ä¸°å¯Œï¼šSting Hash List Set Zsetï¼Œ Måªæ”¯æŒkey-valueæ•°æ®ç±»å‹</li><li>Redisæ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åœ¨ç£ç›˜ä¸­ã€‚</li><li>RedisåŸç”Ÿæ”¯æŒé›†ç¾¤æ¨¡å¼</li><li>Redisæ”¯æŒå‘å¸ƒè®¢é˜…æ¨¡å‹ï¼ŒLUaå‰å¥¥æœ¬ï¼Œäº‹åŠ¡ç­‰</li></ol></li><li><p>æ•°æ®ç±»å‹</p><ul><li>String ç±»å‹çš„åº”ç”¨åœºæ™¯ï¼šSDSï¼Œå¯ä»¥å­˜ä»»ä½•ç±»å‹ï¼Œç›´æ¥å­˜åœ¨äºŒè¿›åˆ¶bufæ•°ç»„é‡Œ</li><li>List å®ç°æ˜¯ï¼š</li><li>Hash ç±»å‹ï¼šç¼“å­˜å¯¹è±¡ã€è´­ç‰©è½¦ç­‰ã€‚</li><li>Set ç±»å‹ï¼šèšåˆè®¡ç®—ï¼ˆå¹¶é›†ã€äº¤é›†ã€å·®é›†ï¼‰åœºæ™¯ï¼Œæ¯”å¦‚ç‚¹èµã€å…±åŒå…³æ³¨ã€æŠ½å¥–æ´»åŠ¨ç­‰ã€‚</li><li>Zset ç±»å‹ï¼šæ’åºåœºæ™¯ï¼Œæ¯”å¦‚æ’è¡Œæ¦œã€ç”µè¯å’Œå§“åæ’åºç­‰ã€‚</li><li>BitMapï¼ˆ2.2 ç‰ˆæ–°å¢ï¼‰ï¼šäºŒå€¼çŠ¶æ€ç»Ÿè®¡çš„åœºæ™¯ï¼Œæ¯”å¦‚ç­¾åˆ°ã€åˆ¤æ–­ç”¨æˆ·ç™»é™†çŠ¶æ€ã€è¿ç»­ç­¾åˆ°ç”¨æˆ·æ€»æ•°ç­‰ï¼›</li><li>HyperLogLogï¼ˆ2.8 ç‰ˆæ–°å¢ï¼‰ï¼šæµ·é‡æ•°æ®åŸºæ•°ç»Ÿè®¡çš„åœºæ™¯ï¼Œæ¯”å¦‚ç™¾ä¸‡çº§ç½‘é¡µ UV è®¡æ•°ç­‰ï¼›</li><li>GEOï¼ˆ3.2 ç‰ˆæ–°å¢ï¼‰ï¼šå­˜å‚¨åœ°ç†ä½ç½®ä¿¡æ¯çš„åœºæ™¯ï¼Œæ¯”å¦‚æ»´æ»´å«è½¦ï¼›</li><li>Streamï¼ˆ5.0 ç‰ˆæ–°å¢ï¼‰ï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç›¸æ¯”äºåŸºäº List ç±»å‹å®ç°çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæœ‰è¿™ä¸¤ä¸ªç‰¹æœ‰çš„ç‰¹æ€§ï¼šè‡ªåŠ¨ç”Ÿæˆå…¨å±€å”¯ä¸€æ¶ˆæ¯IDï¼Œæ”¯æŒä»¥æ¶ˆè´¹ç»„å½¢å¼æ¶ˆè´¹æ•°æ®ã€‚</li></ul></li><li><h3 id="Redisåœ¨æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™æ˜¯å•çº¿ç¨‹ï¼Œä½†æ˜¯ä¹Ÿä½¿ç”¨äº†å¤šçº¿ç¨‹çš„æ¥å¤„ç†ç½‘ç»œIOæ“ä½œ"><a href="#Redisåœ¨æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™æ˜¯å•çº¿ç¨‹ï¼Œä½†æ˜¯ä¹Ÿä½¿ç”¨äº†å¤šçº¿ç¨‹çš„æ¥å¤„ç†ç½‘ç»œIOæ“ä½œ" class="headerlink" title="Redisåœ¨æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™æ˜¯å•çº¿ç¨‹ï¼Œä½†æ˜¯ä¹Ÿä½¿ç”¨äº†å¤šçº¿ç¨‹çš„æ¥å¤„ç†ç½‘ç»œIOæ“ä½œ"></a>Redisåœ¨æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™æ˜¯å•çº¿ç¨‹ï¼Œä½†æ˜¯ä¹Ÿä½¿ç”¨äº†å¤šçº¿ç¨‹çš„æ¥å¤„ç†ç½‘ç»œIOæ“ä½œ</h3><ul><li>ä¸æ˜¯ï¼ŒRedisä¼šå¯åŠ¨åå°ï¼š ä¸‰ä¸ªçº¿ç¨‹å„è‡ªæœ‰è‡ªå·±çš„ä»»åŠ¡é˜Ÿåˆ—,<ol><li>å¤„ç†å…³é—­æ–‡ä»¶</li><li>å¤„ç†AOFåˆ·ç›˜</li><li>å¼‚æ­¥é‡Šæ”¾Rediså†…å­˜ï¼Œä¹Ÿå°±æ˜¯lazyfreeçº¿ç¨‹</li><li>ä¸»çº¿ç¨‹ï¼Œè´Ÿè´£æ‰§è¡Œå‘½ä»¤</li><li>ä¸‰ä¸ªI/Oçº¿ç¨‹æ¥åˆ†æ‹…ç½‘ç»œI/Oå‹åŠ›</li></ol></li><li>è¿™äº›ä»»åŠ¡çš„æ“ä½œéƒ½æ˜¯å¾ˆè€—æ—¶çš„ï¼Œå¦‚æœæŠŠè¿™äº›ä»»åŠ¡éƒ½æ”¾åœ¨ä¸»çº¿ç¨‹æ¥å¤„ç†ï¼Œé‚£ä¹ˆ Redis ä¸»çº¿ç¨‹å°±å¾ˆå®¹æ˜“å‘ç”Ÿé˜»å¡ï¼Œè¿™æ ·å°±æ— æ³•å¤„ç†åç»­çš„è¯·æ±‚äº†ã€‚</li></ul></li><li><p>è¿‡æœŸåˆ é™¤å’Œå†…å­˜æ·˜æ±°ï¼š Redisä½¿ç”¨æ‡’æƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤ã€‚ æƒ°æ€§åˆ é™¤æ—¶æŒ‡ä¸ä¸»åŠ¨åˆ é™¤è¿‡æœŸé”®ï¼Œæ¯æ¬¡åé—®keyæ—¶æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸï¼Œåˆ™åˆ é™¤ã€‚ ä¼˜ç‚¹æ˜¯ï¼šå‡å°‘å¯¹ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨ï¼Œç¼ºç‚¹æ˜¯ï¼šä¸èƒ½åŠæ—¶é‡Šæ”¾å†…å­˜</p><ul><li>å®šæœŸåˆ é™¤ï¼šæ¯è¿‡ä¸€æ®µæ—¶é—´ï¼Œä»æ•°æ®åº“ä¸­å–å‡ºä¸€å®šæ•°é‡çš„keyæ¥è¿›è¡Œæ£€æŸ¥ï¼Œåˆ é™¤å…¶ä¸­çš„è¿‡æœŸkeyï¼Œå¦‚æœè¿‡æœŸkeyè¶…è¿‡ä¸€å®šæ¯”ä¾‹ï¼Œé‡å¤æ‰§è¡Œå®šæœŸåˆ é™¤</li><li>å½“ Redis è¿è¡Œåœ¨ä¸»ä»æ¨¡å¼ä¸‹æ—¶ï¼Œ<strong>ä»åº“ä¸ä¼šè¿›è¡Œè¿‡æœŸæ‰«æï¼Œä»åº“å¯¹è¿‡æœŸçš„å¤„ç†æ˜¯è¢«åŠ¨çš„</strong>ã€‚ä¹Ÿå°±æ˜¯å³ä½¿ä»åº“ä¸­çš„ key è¿‡æœŸäº†ï¼Œå¦‚æœæœ‰å®¢æˆ·ç«¯è®¿é—®ä»åº“æ—¶ï¼Œä¾ç„¶å¯ä»¥å¾—åˆ° key å¯¹åº”çš„å€¼ï¼Œåƒæœªè¿‡æœŸçš„é”®å€¼å¯¹ä¸€æ ·è¿”å›ã€‚</li><li>ä»åº“çš„è¿‡æœŸé”®å¤„ç†ä¾é ä¸»æœåŠ¡å™¨æ§åˆ¶ï¼Œ<strong>ä¸»åº“åœ¨ key åˆ°æœŸæ—¶ï¼Œä¼šåœ¨ AOF æ–‡ä»¶é‡Œå¢åŠ ä¸€æ¡ del æŒ‡ä»¤ï¼ŒåŒæ­¥åˆ°æ‰€æœ‰çš„ä»åº“</strong>ï¼Œä»åº“é€šè¿‡æ‰§è¡Œè¿™æ¡ del æŒ‡ä»¤æ¥åˆ é™¤è¿‡æœŸçš„ keyã€‚REmote DIctionary Server(Redis) æ˜¯ä¸€ä¸ªç”± Salvatore Sanfilippo å†™çš„ key-value å­˜å‚¨ç³»ç»Ÿï¼Œæ˜¯è·¨å¹³å°çš„éå…³ç³»å‹æ•°æ®åº“ï¼Œéå…³ç³»å‹æ•°æ®åº“ï¼Œ</li></ul></li><li><p>å†…å­˜æ·˜æ±°ï¼š éšæœºæ·˜æ±°ï¼ŒLRUæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œæ ¹æ®æœ€åä¸€æ¬¡è®¿é—®çš„æ—¶é—´ , LFUæœ€è¿‘æœ€ä¸å¸¸ä½¿ç”¨ï¼Œæ ¹æ®è®¿é—®æ¬¡æ•°æ¥æ·˜æ±°</p></li><li><p>Lua :Redis åœ¨æ‰§è¡Œ Lua è„šæœ¬æ—¶ï¼Œå¯ä»¥ä»¥åŸå­æ€§çš„æ–¹å¼æ‰§è¡Œ</p></li><li><p>Luaè„šæœ¬ä½¿ç”¨</p><ol><li>EVALæ‰§è¡Œè„šæœ¬<code> EVAL script numkeys key [key â€¦] arg [arg â€¦]</code></li><li>SCRIPT LOAD script.lua æŠŠè„šæœ¬åŠ è½½åˆ°redis-serveä¸­ï¼Œè¿”ä¼šä¸€ä¸ª&nbsp;SHA1æ ¡éªŒå’Œï¼Œä¹‹åæ— è®ºæ˜¯å“ªä¸ªå®¢æˆ·ç«¯éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ ¡éªŒå’Œæ¥è¿è¡Œè„šæœ¬ã€‚</li><li>EVALSHA sha1æ ¡éªŒå’Œ  numkeys key [key â€¦] arg [arg â€¦]</li><li>SCRIPT EXISTS sha1æ¥æ£€éªŒè¿™ä¸ªè„šæœ¬æ˜¯å¦è¿˜åœ¨</li><li>SCRIPT FLUSHåˆ·æ–°æ‰€æœ‰å·²ç»ä¿å­˜çš„è„šæœ¬</li><li>redis-cli -a å¯†ç  â€“eval luaè„šæœ¬å†…å®¹</li></ol></li><li><p>å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹çš„æ“ä½œ</p><ol><li>string <ul><li>redisä¸­çš„stringå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ï¼ŒåŒ…æ‹¬jpgå’Œåºåˆ—åŒ–çš„å¯¹è±¡ï¼Œå› ä¸ºstringæ˜¯byte [] æ•°ç»„</li><li>setrange key number string ä»numberå¼€å§‹çš„ä¸‹æ ‡å¤„æ›¿æ¢string,ä»0å¼€å§‹</li><li>mset è®¾ç½®å¤šä¸ª</li><li>xxnx not exit ä¸å­˜åœ¨çš„è¯åœ¨è®¾ç½®</li><li>getrange key begin end</li><li>incryby key å¢é‡ ä¿®æ”¹æ•°æ®</li><li>append key åŠ </li><li>strlen è·å–é•¿åº¦</li></ul></li><li>hash: stringç±»å‹çš„ field å’Œ valueçš„æ˜ å°„è¡¨,å ç”¨å†…å­˜æ›´å°‘ï¼Œæ–¹ä¾¿å–æ•´ä¸ªå¯¹è±¡<ul><li>hset/hsetnx key field1 value1</li><li>hmget è·å–å¤šä¸ªfields</li><li>hexists key field æµ‹è¯•fieldæ˜¯å¦å­˜åœ¨</li><li>hlen key æœ‰å¤šå°‘field</li><li>hkeys key è·å–æ‰€æœ‰çš„field</li><li>hvals è·å–æ‰€æœ‰çš„value</li><li>hgetall == hvals + hkeys</li></ul></li><li>list åº•å±‚æ˜¯é“¾è¡¨ï¼Œå¯å½“ä½œqueueä½¿ç”¨ï¼Œæœ‰åºï¼Œå¯é‡å¤ï¼Œkeyä¸ºé“¾è¡¨çš„åå­—<ul><li>lpush å¤´éƒ¨æ·»åŠ  rpushå°¾éƒ¨æ·»åŠ ,linsert key</li><li>lset é‡æ–°è®¾å®šæŒ‡å®šä½ç½®çš„æ•°æ® </li><li>lrem key count value ä»å¤´å¼€å§‹åˆ é™¤countä¸ªå’Œvalueä¸€æ ·å€¼çš„æ•°æ®ï¼Œ count &gt; 0 ä»å¤´å¼€å§‹,count &lt; 0ä»å°¾éƒ¨å¼€å§‹ï¼Œcount == 0 åˆ é™¤æ‰€æœ‰çš„</li><li>ltrim åªä¿ç•™ç»™å®šèŒƒå›´çš„æ•°æ®</li><li>lpop/rpop</li><li>rpoplpush key1 key2 å°†key1çš„å°¾éƒ¨ç§»é™¤å¹¶åŠ å…¥key2çš„å¤´éƒ¨ï¼ŒåŸå­æ“ä½œ</li><li>lindexä¸‹æ ‡è®¿é—®</li><li>llenè·å–é•¿åº¦</li></ul></li><li>set<ul><li>ä¾¿äºæ±‚é›†åˆçš„äº¤å¹¶å·®,æ— åºé›†åˆï¼Œä¸å¯é‡å¤</li><li>sadd key value</li><li>srem key value</li><li>spop key éšæœºåˆ é™¤å¹¶è¿”å›ä¸€ä¸ªå…ƒç´ </li><li>sdiff æ±‚äº¤é›† ä¸€ä¸ªkey1 å¤šä¸ªkey2 , key3ï¼Œä¹Ÿå°±æ˜¯åœ¨å…¶ä»–keyä¸­ä¸å…¶ä»–keyä¸åŒå…ƒç´ </li><li>sdiffstore å°†diffçš„ç»“æœä¿å­˜åˆ°å¦ä¸€ä¸ªkeyä¸­</li><li>sinter(store) äº¤é›†(å­˜å‚¨)</li><li>sunion(store) å¹¶é›†</li><li>smove å°†key1 ä¸­çš„åˆ é™¤æ·»åŠ ç»™ç¬¬äºŒä¸ª</li><li>scard ç»Ÿè®¡å…ƒç´ ä¸ªæ•°</li><li>sismemberæµ‹è¯•æ˜¯å¦ä¸ºkeyçš„å…ƒç´ </li><li>srandmemberéšæœºè¿”å›ä¸åˆ é™¤</li></ul></li><li>sorted sets<ul><li>æœ‰åºï¼Œä¸å¯é‡å¤ï¼Œä¼šå…³è”ä¸€ä¸ªdoubleç±»å‹scoreæ¥è¿›è¡Œæ’åº,æ˜¯skip list å’Œ hash tableçš„æ··åˆï¼Œscoreè¶Šå°çš„è¶Šåœ¨å‰é¢</li><li>zadd key score value</li><li>zrem</li><li>zincrby key score value ç»™è¿™ä¸ªå…ƒç´ çš„scoreæ·»åŠ </li><li>zrank æŒ‰ç…§ä»å°åˆ°å¤§æ’åºè¿”å›æŸä¸ªmemberçš„æ’å</li><li>zrerankåå‘æ’åº</li><li>zcount è¿”å›ç»™å®šåŒºé—´scoreå†…çš„æ•°é‡</li><li>zcarf è¿”å›å…ƒç´ æ•°é‡</li><li>zscore è¿”å›score</li></ul></li></ol><ul><li>å¸¸ç”¨æŒ‡ä»¤ï¼škeys ï¼Œ del , expire,moveè½¬ç§»æŠŠå½“å‰æ•°æ®åº“ä¸­çš„æ•°æ®è½¬ç§»åˆ°å…¶ä»–æ•°æ®ä¸­,persistç§»é™¤ç»™å®škeyçš„è¿‡æœŸæ—¶é—´ï¼Œrandomkeyéšæœºè¿”å›ä¸€ä¸ªkey,rename,type</li><li>ping,echo,select(0~15),dbsizeè¿”å›å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰çš„keyæ•°é‡,infoè·å–æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯</li><li>monitorå®æ—¶è½¬å­˜æ”¶åˆ°çš„è¯·æ±‚</li><li>flushdbåˆ é™¤æ‰€é€‰æ‹©çš„æ•°æ®åº“çš„æ‰€æœ‰key</li><li>fushall åˆ é™¤æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰key</li></ul></li></ul><h3 id="Redis-è„šæœ¬å‘½ä»¤"><a href="#Redis-è„šæœ¬å‘½ä»¤" class="headerlink" title="Redis è„šæœ¬å‘½ä»¤"></a>Redis è„šæœ¬å‘½ä»¤</h3><h3 id="dockercomposeå¿«é€Ÿæ­å»ºä¸€ä¸»äºŒä»ä¸€å“¨å…µçš„redisé›†ç¾¤"><a href="#dockercomposeå¿«é€Ÿæ­å»ºä¸€ä¸»äºŒä»ä¸€å“¨å…µçš„redisé›†ç¾¤" class="headerlink" title="dockercomposeå¿«é€Ÿæ­å»ºä¸€ä¸»äºŒä»ä¸€å“¨å…µçš„redisé›†ç¾¤"></a>dockercomposeå¿«é€Ÿæ­å»ºä¸€ä¸»äºŒä»ä¸€å“¨å…µçš„redisé›†ç¾¤</h3><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token property">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span><span class="token property">services</span><span class="token punctuation">:</span>  <span class="token property">redis-master</span><span class="token punctuation">:</span> # ä¸»èŠ‚ç‚¹    <span class="token property">image</span><span class="token punctuation">:</span> <span class="token property">redis</span><span class="token punctuation">:</span>latest    <span class="token property">command</span><span class="token punctuation">:</span> redis-server --appendonly yes --requirepass bronya # è®¾ç½®å¯†ç     <span class="token property">volumes</span><span class="token punctuation">:</span>      - ./data/<span class="token property">master</span><span class="token punctuation">:</span>/data    <span class="token property">ports</span><span class="token punctuation">:</span>      - <span class="token string">"6379:6379"</span>    <span class="token property">networks</span><span class="token punctuation">:</span>      - redis-network  <span class="token property">redis-slave1</span><span class="token punctuation">:</span>    <span class="token property">image</span><span class="token punctuation">:</span> <span class="token property">redis</span><span class="token punctuation">:</span>latest    <span class="token property">command</span><span class="token punctuation">:</span> redis-server --slaveof redis-master 6379 --appendonly yes --masterauth bronya    <span class="token property">depends_on</span><span class="token punctuation">:</span>      - redis-master    <span class="token property">volumes</span><span class="token punctuation">:</span>      - ./data/<span class="token property">slave1</span><span class="token punctuation">:</span>/data    <span class="token property">networks</span><span class="token punctuation">:</span>      - redis-network  <span class="token property">redis-slave2</span><span class="token punctuation">:</span>    <span class="token property">image</span><span class="token punctuation">:</span> <span class="token property">redis</span><span class="token punctuation">:</span>latest    <span class="token property">command</span><span class="token punctuation">:</span> redis-server --slaveof redis-master 6379 --appendonly yes --masterauth bronya    <span class="token property">depends_on</span><span class="token punctuation">:</span>      - redis-master    <span class="token property">volumes</span><span class="token punctuation">:</span>      - ./data/<span class="token property">slave2</span><span class="token punctuation">:</span>/data    <span class="token property">networks</span><span class="token punctuation">:</span>      - redis-network  <span class="token property">redis-sentinel</span><span class="token punctuation">:</span>    <span class="token property">image</span><span class="token punctuation">:</span> <span class="token property">redis</span><span class="token punctuation">:</span>latest    <span class="token property">command</span><span class="token punctuation">:</span> redis-sentinel /etc/redis/sentinel.conf    <span class="token property">depends_on</span><span class="token punctuation">:</span>      - redis-master    <span class="token property">volumes</span><span class="token punctuation">:</span>      - ./sentinel.<span class="token property">conf</span><span class="token punctuation">:</span>/etc/redis/sentinel.conf    <span class="token property">networks</span><span class="token punctuation">:</span>      - redis-network<span class="token property">networks</span><span class="token punctuation">:</span>  <span class="token property">redis-network</span><span class="token punctuation">:</span>    <span class="token property">driver</span><span class="token punctuation">:</span> bridge<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸‹è¡¨åˆ—å‡ºäº† redis è„šæœ¬å¸¸ç”¨å‘½ä»¤ï¼š</p><table><thead><tr><th>åºå·</th><th>å‘½ä»¤åŠæè¿°</th></tr></thead><tbody><tr><td>1</td><td><a href="https://www.runoob.com/redis/scripting-eval.html">EVAL script numkeys key [key â€¦] arg [arg â€¦]</a>  <br>æ‰§è¡Œ Lua è„šæœ¬ã€‚</td></tr><tr><td>2</td><td><a href="https://www.runoob.com/redis/scripting-evalsha.html">EVALSHA sha1 numkeys key [key â€¦] arg [arg â€¦]</a>  <br>æ‰§è¡Œ Lua è„šæœ¬ã€‚</td></tr><tr><td>3</td><td><a href="https://www.runoob.com/redis/scripting-script-exists.html">SCRIPT EXISTS script [script â€¦]</a>  <br>æŸ¥çœ‹æŒ‡å®šçš„è„šæœ¬æ˜¯å¦å·²ç»è¢«ä¿å­˜åœ¨ç¼“å­˜å½“ä¸­ã€‚</td></tr><tr><td>4</td><td><a href="https://www.runoob.com/redis/scripting-script-flush.html">SCRIPT FLUSH</a>  <br>ä»è„šæœ¬ç¼“å­˜ä¸­ç§»é™¤æ‰€æœ‰è„šæœ¬ã€‚</td></tr><tr><td>5</td><td><a href="https://www.runoob.com/redis/scripting-script-kill.html">SCRIPT KILL</a>  <br>æ€æ­»å½“å‰æ­£åœ¨è¿è¡Œçš„ Lua è„šæœ¬ã€‚</td></tr><tr><td>6</td><td><a href="https://www.runoob.com/redis/scripting-script-load.html">SCRIPT LOAD script</a>  <br>å°†è„šæœ¬ script æ·»åŠ åˆ°è„šæœ¬ç¼“å­˜ä¸­ï¼Œä½†å¹¶ä¸ç«‹å³æ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚</td></tr></tbody></table><ul><li>é€‰æ‹©æ•°æ®åº“å’Œç™»å½•<br>å¦‚æœä½ æƒ³åœ¨RedisæœåŠ¡å™¨å¯åŠ¨æ—¶æŒ‡å®šè¦ä½¿ç”¨çš„æ•°æ®åº“å’Œå¯†ç ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•°è¿›è¡Œè®¾ç½®ï¼Œä¾‹å¦‚ï¼š</li></ul><p><code>redis-server --port 6379 --requirepass your_password --db 3</code><br>redisé»˜è®¤æœ‰0-15ä¸ªæ•°æ®åº“ï¼Œç›´æ¥é€‰æ‹©å³å¯</p><p>info æ¥è·å¾—æœåŠ¡å™¨å’Œæ•°æ®åº“ä¿¡æ¯</p><h2 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h2><p>æ˜¯ä¸€ç§æºä»£ç å¯ç”¨çš„æ–‡æ¡£æ•°æ®åº“ï¼Œä»¥åºåˆ—åŒ–çš„ JSON æ ¼å¼å­˜å‚¨æ•°æ®ã€‚MongoDB å°†æ•°æ®å­˜å‚¨åœ¨å¤–éƒ¨å­˜å‚¨å™¨ä¸­ï¼Œä½†åœ¨ä¼ä¸šç‰ˆä¸­åŒ…å«å†…å­˜å­˜å‚¨å¼•æ“ã€‚<br>å¸¸ç”¨äºåº”å¯¹é«˜å¹¶å‘ã€æµ·é‡æ•°æ®å­˜å‚¨ã€æ•°æ®åº“çš„é«˜å¯æ‰©å±•æ€§<br>ä¾‹å¦‚ï¼šç¤¾äº¤åœºæ™¯ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œé€šè¿‡åœ°ç†ä½ç½®ç´¢å¼•æ¥å®ç°é™„è¿‘çš„äºº<br>æ¸¸æˆåœºæ™¯å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œæ–¹ä¾¿é«˜æ•ˆ<br>æ—¥å¿—</p><h4 id="åŸºæœ¬æ¦‚å¿µï¼š"><a href="#åŸºæœ¬æ¦‚å¿µï¼š" class="headerlink" title="åŸºæœ¬æ¦‚å¿µï¼š"></a>åŸºæœ¬æ¦‚å¿µï¼š</h4><ol><li>æ–‡æ¡£ï¼šæ•°æ®å­˜å‚¨çš„åŸºæœ¬å•ä½</li><li>ç´¢å¼•ï¼š<ul><li>å•å­—æ®µç´¢å¼•ï¼šç´¢å¼•å»ºç«‹çš„é¡ºåºæ— æ‰€è°“ï¼ŒMongoDBä¼šå¯ä»¥ä»å¤´/å°¾å¼€å§‹éå†</li><li>å¤åˆç´¢å¼•ï¼šå»ºç«‹åœ¨å¤šä¸ªå­—æ®µä¹‹ä¸Šçš„ç´¢å¼•,é¡ºåºå¾ˆé‡è¦</li><li>å¤šé”®ç´¢å¼•ï¼šå¦‚æœä¸€ä¸ªå­—æ®µæ˜¯æ•°ç»„ï¼Œå¯¹æ•°ç»„å»ºç«‹çš„ç´¢å¼•å°±æ˜¯å¤šé”®ç´¢å¼•ï¼Œç›¸å½“äºä¼šå¯¹æ•°ç»„çš„æ¯ä¸ªå€¼éƒ½å»ºç«‹å•å­—æ®µç´¢å¼•ï¼Œä¸¾ä¾‹ï¼šç»™Tagså»ºç«‹ç´¢å¼•ï¼Œæœç´¢æ—¶åªéœ€è¦tagsæ•°ç»„å³å¯ç­›é€‰å‡ºå¸¦æœ‰tagsçš„æ‰€æœ‰æ–‡æ¡£</li><li>å“ˆå¸Œç´¢å¼•ï¼šæŒ‰ç…§æ•°æ®çš„å“ˆå¸Œå€¼è¿›è¡Œç´¢å¼•ï¼Œç”¨åœ¨å“ˆå¸Œåˆ†ç‰‡é›†ç¾¤ä¸Š</li><li>æ–‡æœ¬ç´¢å¼•ï¼šä¸å»ºè®®ä½¿ç”¨ï¼Œæ€§èƒ½ä½ä¸‹</li><li>åœ°ç†ä½ç½®ç´¢å¼•ï¼š</li><li>å”¯ä¸€ç´¢å¼•ï¼šç¡®ä¿ç´¢å¼•å­—æ®µä¸ä¼šå­˜å‚¨é‡å¤å€¼</li><li>TTLç´¢å¼•ï¼šæä¾›ä¸€ä¸ªè¿‡æœŸæœºåˆ¶ï¼Œå…è®¸ä¸ºæ¯ä¸€ä¸ªæ–‡æ¡£è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œå½“æ–‡æ¡£è¾¾åˆ°è¿‡æœŸæ—¶é—´å°±ä¼šè¢«åˆ é™¤ï¼Œç¤ºä¾‹ä»£ç ï¼š`    @Indexed(expireAfterSeconds = 60 * 60 * 24 * 30)private Date createdAt;<ul><li>TTLç´¢å¼•åªèƒ½ç”¨äºå•å­—æ®µ</li><li><code>_id</code> ä¸æ”¯æŒTTLç´¢å¼•</li><li>ä¸èƒ½åœ¨ä¸Šé™é›†åˆ(ä¸Šé™é›†åˆï¼ˆCapped Collectionsï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„é›†åˆï¼Œå®ƒæœ‰å›ºå®šçš„å¤§å°ã€‚å½“é›†åˆè¾¾åˆ°å…¶æœ€å¤§å¤§å°æ—¶ï¼ŒMongoDBä¼šè‡ªåŠ¨è¦†ç›–æœ€æ—§çš„æ–‡æ¡£ã€‚)ä¸­åˆ é™¤æ–‡æ¡£</li></ul></li><li>è¦†ç›–ç´¢å¼•æŸ¥è¯¢ï¼š<ol><li>æ‰€æœ‰æŸ¥è¯¢å­—æ®µéƒ½è¦æ±‚æ˜¯ç´¢å¼•çš„ä¸€éƒ¨åˆ†</li><li>ç»“æœä¸­è¿”å›çš„æ‰€æœ‰å­—æ®µéƒ½åœ¨åŒä¸€ä¸ªç´¢å¼•ä¸­</li><li>æŸ¥è¯¢ä¸­æ²¡æœ‰å­—æ®µä¸ºnull</li></ol></li></ul></li><li>é›†åˆï¼šé›†åˆæ˜¯åŠ¨æ€çš„ï¼Œå¯ä»¥æŠŠä¸åŒç±»å‹çš„æ–‡æ¡£å½’ä¸ºä¸€ä¸ªé›†åˆ<ul><li>ç›–å­é›†åˆ: æœ‰ä¸Šé™çš„é›†åˆï¼Œç”¨äºæ—¥å¿—ï¼Œä¸æ”¯æŒcrud,å½“è¶…è¿‡ä¸Šé™æ—¶ï¼Œä¼šä»æœ€è€çš„æ–‡æ¡£å¼€å§‹åˆ é™¤<ul><li><code>db.createCollection("users.actions",{capped:true,size:16384,max:100})</code></li></ul></li><li>TTLé›†åˆ: MongoDBä¹Ÿå…è®¸åœ¨ç‰¹å®šçš„æ—¶é—´ååºŸå¼ƒæ–‡æ¡£æ•°æ®ï¼Œæœ‰æ—¶å€™å«åšç”Ÿå­˜æ—¶é—´time-to-live (TTLï¼‰é›†åˆè¿™ä¸ªåŠŸèƒ½å®é™…ä¸Šæ˜¯é€šè¿‡ä¸€ä¸ªç‰¹æ®Šçš„ç´¢å¼•å®ç°çš„ åˆ›å»ºTTLç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š<ul><li><code>db.reviews.createIndex({time_field:1},{expireAfterSeconds:3600})</code></li><li>time_fieldå­—æ®µä¼šå®šæœŸæ£€æŸ¥æ—¶é—´æˆ³ï¼Œä¸å½“å‰æ—¶é—´æ¯”è¾ƒï¼Œå¦‚æœæ—¶é—´å·®å¤§äºè®¾ç½®çš„æ—¶é—´ï¼Œæ–‡æ¡£ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œå•ä½æ˜¯s</li></ul></li></ul></li><li>æ–‡æ¡£-&gt;é›†åˆ-&gt;æ•°æ®åº“-&gt;MongoDB</li><li>mongoshæ˜¯ä¸€ä¸ªjsè§£é‡Šå™¨ï¼Œå¯ä»¥ä½¿ç”¨jsæ ‡å‡†åº“æˆ–è€…è¿è¡Œå‡½æ•°</li><li>ä½¿ç”¨jsè¯­æ³•ï¼Œdbå˜é‡ä»£è¡¨å½“å‰é€‰ç”¨çš„æ•°æ®åº“</li></ol><ul><li>CRUD:<ul><li>æŸ¥è¯¢å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</li><li>å»ºç«‹æ•°æ®åº“ç›´æ¥useä¸€ä¸ªæ–°çš„æ•°æ®åº“å³å¯</li><li>å˜é‡ = {â€¦},ä¹‹ådb.é›†åˆ.insertOne(å˜é‡)æˆ–è€…insertMany()</li><li>db.é›†åˆ.find()æˆ–è€…findOne()</li><li>updateOne()</li><li>db.é›†åˆ.deleteOne/Many()</li><li>db.dropDatabase()åˆ é™¤å½“å‰æ•°æ®åº“</li><li>db.collection.drop() åˆ é™¤æŒ‡å®šé›†åˆ</li><li>db.col.update({â€˜titleâ€™:â€™MongoDB æ•™ç¨‹â€™},{$set:{â€˜titleâ€™:â€™MongoDBâ€™}}) å¯¹åº”çš„å˜é‡å({ â€œnMatchedâ€ : 1, â€œnUpsertedâ€ : 0, â€œnModifiedâ€ : 1 },{multi:true}) è®¾ç½®multi : trueå¯ä»¥ä¿®æ”¹é€‰å®šçš„æ‰€æœ‰æ–‡æ¡£</li><li>æƒ³æ˜¾å¼åˆ›å»ºé›†åˆï¼šdb.createCollection(xxx),é€šè¿‡sizeå­—æ®µå¯ä»¥é¢„åˆ†é…ç©ºé—´çš„å­—èŠ‚å¤§å°</li></ul></li><li>åˆ›å»ºç´¢å¼•:db.products.createIndex({slug: 1}, {unique: true})<ul><li>1ä»£è¡¨æ˜¯å‡åºï¼Œuniqueæ˜¯æŒ‡å®šç´¢å¼•çš„é€‰é¡¹ï¼ŒæŒ‡å®šäº†ç´¢å¼•æ˜¯å”¯ä¸€çš„ï¼Œslugä¸€èˆ¬ç”¨äºå­˜å‚¨URL</li></ul></li><li>èšåˆç®¡é“ï¼š ç±»ä¼¼streamæµå’Œchannelç®¡é“ï¼Œå¯ä»¥æ‰§è¡Œä¸€ç³»åˆ—çš„handler,æœ€åè¿”å›ç»“æœ <img src="/2023/08/02/58/%E8%81%9A%E5%90%88%E7%AE%A1%E9%81%93.png"><ol><li><img src="/2023/08/02/58/SQL%E5%AF%B9%E6%AF%94%E8%81%9A%E5%90%88.png"></li></ol></li></ul><h2 id="Mybatisé¢è¯•"><a href="#Mybatisé¢è¯•" class="headerlink" title="Mybatisé¢è¯•"></a>Mybatisé¢è¯•</h2><ul><li>mybatisæ‰§è¡Œæµç¨‹ï¼š<ul><li>è¯»å–é…ç½®æ–‡ä»¶</li><li>æ„å»ºä¼šè¯å·¥å‚ï¼šä¼šè¯å·¥å‚å…¨å±€ä¸€ä¸ªï¼Œç”Ÿäº§sqlSession</li><li>åˆ›å»ºä¼šè¯ï¼šé¡¹ç›®ä¸æ•°æ®åº“çš„ä¼šè¯ï¼ŒåŒ…å«äº†æ‰§è¡Œsqlè¯­å¥çš„æ‰€æœ‰æ–¹æ³•ï¼Œæ¯æ¬¡æ“ä½œä¸€ä¸ªä¼šè¯ï¼Œæœ‰å¤šä¸ª</li><li>Executoræ‰§è¡Œå™¨</li><li>è¿”å›ç»“æœ</li></ul></li><li>å»¶è¿ŸåŠ è½½ï¼šæ‡’åŠ è½½ï¼Œæ—¨åœ¨éœ€è¦ä½¿ç”¨æ•°æ®çš„æ—¶å€™æ‰è¿›è¡Œå®é™…çš„SQLæŸ¥è¯¢<ul><li>æ¯”å¦‚æˆ‘ä»¬åœ¨å…³è”æŸ¥è¯¢ä¸­ï¼Œæˆ‘ä»¬ä¼šè‡ªåŠ¨çš„æŠŠå…³è”çš„ç”¨æˆ·æ•°æ®ä¹ŸæŸ¥è¯¢å‡ºæ¥äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸éœ€è¦ç”¨æˆ·çš„ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å»¶è¿ŸåŠ è½½ï¼Œåªæœ‰åœ¨æˆ‘ä»¬ä½¿ç”¨ç”¨æˆ·ä¿¡æ¯çš„æ—¶å€™æ‰ä¼šæŠŠç»“æœæŸ¥è¯¢å‡ºæ¥</li></ul></li><li>ç¼“å­˜ï¼šæœ¬åœ°ç¼“å­˜<ul><li>ä¸€çº§ç¼“å­˜ï¼šsqlsession ï¼Œå®ç°æ–¹å¼æ˜¯PerpertualCache,å½“Sessionè¿›è¡Œflushæˆ–è€…closeæ—¶ä¼šåˆ·æ–°ç¼“å­˜</li><li>äºŒçº§ç¼“å­˜ï¼šmapperçº§åˆ«çš„</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tools</title>
      <link href="/2023/07/04/56/"/>
      <url>/2023/07/04/56/</url>
      
        <content type="html"><![CDATA[<h2 id="è™šæ‹Ÿæœºè®¾ç½®é™æ€ip"><a href="#è™šæ‹Ÿæœºè®¾ç½®é™æ€ip" class="headerlink" title="è™šæ‹Ÿæœºè®¾ç½®é™æ€ip"></a>è™šæ‹Ÿæœºè®¾ç½®é™æ€ip</h2><p><a href="https://wangyi.one/vmware%E4%B8%AD%E9%85%8D%E7%BD%AEubuntu%E9%9D%99%E6%80%81ip/">https://wangyi.one/vmware%E4%B8%AD%E9%85%8D%E7%BD%AEubuntu%E9%9D%99%E6%80%81ip/</a><br><del>Emacsåç»­å­¦ä¹ </del><br>å¸¸ç”¨é”®ä½</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token property">æ›¿æ¢</span>  <span class="token punctuation">:</span> %s/åŸ/ä¿®æ”¹ä¹‹åçš„/g   gä»£è¡¨ä¿®æ”¹æ•´ä¸ªæ–‡ä»¶<span class="token property">æŸ¥æ‰¾</span>  <span class="token punctuation">:</span> ä½¿ç”¨ n æŸ¥æ‰¾ä¸‹ä¸€ä¸ª<span class="token punctuation">,</span> N <span class="token property">ä¸‹ä¸€ä¸ª</span><span class="token punctuation">:</span> é¦–è¡Œ<span class="token punctuation">,</span>å°¾è¡Œ s/åŸ/æ–°/<span class="token property">g</span><span class="token punctuation">:</span> .<span class="token punctuation">,</span>+ns/æ—§/æ–°/g å½“å‰è¡Œå’Œæ¥ä¸‹æ¥çš„nè¡Œ. é‡å¤ä¹‹å‰çš„æ“ä½œ   ###<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">å¿«æ·é”®ä¹‹ç±»çš„ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯å¯ä»¥ç»„åˆä½¿ç”¨çš„é”®ä½ç»ƒä¹ ï¼šå‘½ä»¤è¡Œè¾“å…¥ vimtutor #####COMMANDæ¨¡å¼:set ic / noic  æŸ¥æ‰¾æ—¶ä¸/åŒºåˆ†å¤§å°å†™ä½¿ç”¨vé€‰ä¸­ä¹‹åä½¿ç”¨:ä¼šçœ‹è§'&lt;'&gt;ä¹‹åå¯ä»¥é€šè¿‡ w + filename å°†é€‰ä¸­çš„å­—ä¿å­˜ä¸ºæ–°çš„æ–‡ä»¶:! + shell å‘½ä»¤ï¼Œåœ¨ä¸é€€å‡ºvimçš„æƒ…å†µä¸‹ä½¿ç”¨shellæŒ‡ä»¤ ######:! + sh å†å¼€ä¸€ç»ˆç«¯ï¼Œæš‚æ—¶é€€å‡ºå½“å‰æ–‡ä»¶çš„é¡µé¢ï¼Œä½¿ç”¨ctrl- dè¿”å›æ–‡ä»¶ #########:r + filename å°†filenameæ–‡ä»¶ä¸­çš„æ–‡å­—å†™å…¥å½“å‰å…‰æ ‡æ‰€åœ¨ä½ç½®:set number æ˜¾ç¤ºè¡Œå·:s/old/new/g  æ›¿æ¢ä¸€è¡Œä¸­çš„oldä¸ºnew,åŠ ä¸Šgä¼šå¯¹æ•´è¡Œéƒ½èµ·ä½œç”¨ï¼Œä¸åŠ gåªä¼šä¿®æ”¹ç¬¬ä¸€ä¸ªold:sp æ‰“å¼€å½“å‰æ–‡ä»¶æ‰“å¼€å¤šä¸ªçª—å£:qa å…³é—­æ‰€æœ‰çª—å£normalæ¨¡å¼A        append  ç§»åŠ¨åˆ°æœ«å°¾è¿›è¡Œinsert ###I                        ç§»åŠ¨åˆ°è¿™ä¸€è¡Œçš„å¼€å¤´è¿›è¡Œinsert ###J                        å°†ä¸‹ä¸€è¡Œå’Œè¿™ä¸€è¡Œè¿æ¥åœ¨ä¸€èµ·a                å…‰æ ‡ä¹‹åæ’å…¥å†…å®¹ctrl + r redou   æ’¤é”€hjkl å·¦ä¸‹ä¸Šå³v     è¿›å…¥é€‰ä¸­å—æ¨¡å¼V    é€‰ä¸­æ¨¡å¼ï¼Œæ¯æ¬¡é€‰ä¸­ä¸€è¡Œctrl + w         åˆ‡æ¢window ctrl + v         é€‰ä¸­ä¸€ä¸ªçŸ©å½¢~é€‰ä¸­ä¹‹åï¼Œä½¿å¾—å¤§å°å†™äº’æ¢ ### f + è¦æŸ¥æ‰¾çš„å­—ç¬¦   find è¿™ä¸€è¡Œä¸­å…‰æ ‡ä¹‹åç¬¬ä¸€ä¸ªå…³é”®å­—F + xxx           find åå‘æŸ¥æ‰¾t + xxx           ç§»åŠ¨åˆ°è¿™ä¸ªå­—ç¬¦çš„å‰é¢ä¸€ä¸ªå­—ç¬¦T + xxx           åå‘æŸ¥æ‰¾ï¼Œç§»åŠ¨åˆ°å­—ç¬¦ä¹‹åä¸€ä¸ªå­—ç¬¦d + ç§»åŠ¨çš„é”®ä½     åˆ é™¤  d + $ åˆ é™¤åˆ°(ä¸€è¡Œ)ç»“å°¾ï¼Œ d + 0 åˆ é™¤åˆ°(ä¸€è¡Œ)å¼€å¤´c + ç§»åŠ¨çš„é”®ä½     change åˆ é™¤å¹¶è¿›å…¥insertè¿›è¡Œä¿®æ”¹dd        åˆ é™¤ä¸€è¡Œccåˆ é™¤ä¸€è¡Œå¹¶è¿›å…¥insertx             åˆ é™¤å½“å‰å­—ç¬¦r + å­—ç¬¦          æ›¿æ¢å½“å‰ä¸€ä¸ªå­—ç¬¦R                 è¿ç»­æ›¿æ¢ ###w  word å‘åç§»åŠ¨ä¸€ä¸ªå•è¯b  å‘å‰ç§»åŠ¨ä¸€ä¸ªå•è¯e  end ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•è¯çš„æœ€åä¸€ä¸ªå­—æ¯o  ä¸‹æ–¹å¼€ä¸€ä¸ªæ–°è¡ŒO  ä¸Šæ–¹å¼€ä¸€ä¸ªæ–°è¡Œ0  ç§»åŠ¨åˆ°è¡Œé¦–%  ä»</span><span class="token punctuation">{</span>/[/<span class="token punctuation">(</span> ç§»åŠ¨åˆ°<span class="token punctuation">)</span>/]/<span class="token punctuation">}</span><span class="token selector">$  ç§»åŠ¨åˆ°è¡Œæœ«æ•°å­— + G         è·³è½¬åˆ°æŒ‡å®šè¡Œctrl + g         æ˜¾ç¤ºå½“å‰çš„è¡Œæ•°G  æœ€åä¸€è¡Œgg ç¬¬ä¸€è¡Œy + ç§»åŠ¨çš„é”®ä½   å¤åˆ¶yy         å¤åˆ¶ä¸€è¡Œp   ç²˜è´´L/M/H å½“å‰é¡µé¢çš„lowest/middle/highestctrl + u / d å‘ä¸Šæ»šåŠ¨/å‘ä¸‹æ»šåŠ¨æ•°å­— + é”®ä½   æ‰§è¡Œå‡ æ¬¡è¿™ä¸ªé”®ä½æ“ä½œä¾‹å¦‚:7dw          åˆ é™¤ä¸ƒä¸ªå•è¯ä¿®é¥°è¯a åˆ é™¤æ‰€åœ¨çš„æ•´ä½“ä¾‹å¦‚ï¼š</span><span class="token punctuation">{</span>djsafljaflsjlf<span class="token punctuation">}</span><span class="token selector">123ä½¿ç”¨di</span><span class="token punctuation">{</span><span class="token selector">åªå‰©ä¸‹äº†123Fi å†…éƒ¨ï¼Œä¾‹å¦‚</span><span class="token punctuation">{</span>skdajsldjas<span class="token punctuation">}</span><span class="token selector">æƒ³è¦åˆ é™¤</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token selector">å†…çš„ä¸œè¥¿åªéœ€è¦ci</span><span class="token punctuation">{</span>/ + å†…å®¹      å…¨æ–‡æŸ¥æ‰¾<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¥½ç”¨çš„æ“ä½œ</li></ul><ol><li>ä¸€é”®å–æ¶ˆæ³¨é‡Š,ctrl + vè¿›å…¥å—é€‰æ‹©æ¨¡å¼ï¼Œç„¶åä½¿ç”¨æ–¹å‘é”®é€‰æ‹©æ‰€æœ‰çš„æ³¨é‡Šï¼ŒæŒ‰dåˆ é™¤å³å¯</li></ol><h1 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h1><p>åˆ‡æ¢åˆ†æ”¯å’Œç‰ˆæœ¬å·å®é™…ä¸Šå°±æ˜¯æŒ‡é’ˆçš„åˆ‡æ¢</p><p>å·¥ä½œåŒºï¼šç£ç›˜ç›®å½•</p><p>ä½¿ç”¨git addæŠŠå·¥ä½œåŒºä»£ç åŠ å…¥æš‚å­˜åŒº ä¸´æ—¶å‚¨å­˜</p><p>git commit</p><p>å°†æš‚å­˜åŒºä»£ç æäº¤åˆ°æœ¬åœ°åº“ï¼Œå¾—åˆ°å†å²ç‰ˆæœ¬(ä»£ç åˆ é™¤ä¸äº†äº†)</p><p>push </p><p>æ¨é€åˆ°è¿œç¨‹åº“</p><p>githubæ˜¯è¿œç¨‹åº“</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> init åˆå§‹åŒ–ä»“åº“<span class="token function">git</span> status æŸ¥çœ‹ä»“åº“çŠ¶æ€<span class="token comment">##Untracked files: æ˜¯æœªè¿½è¸ªçš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶åªå¤„äºå·¥ä½œåŒºï¼Œä¸å¤„äºæš‚å­˜åŒºå’Œæœ¬åœ°åº“ï¼Œçº¢è‰²çš„æ–‡å­—</span><span class="token comment">##ç»¿è‰²çš„æ–‡ä»¶åæ˜¯å­˜åœ¨äºæš‚å­˜åŒº</span><span class="token function">git</span> <span class="token function">add</span> + filename æ·»åŠ åˆ°æš‚å­˜åŒº<span class="token function">git</span> <span class="token function">add</span> <span class="token parameter variable">-A</span>    å…¨éƒ¨æäº¤<span class="token function">git</span> <span class="token function">add</span> <span class="token parameter variable">-i</span>    æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œä½†æ˜¯ä¼šæœ‰æé—®<span class="token function">git</span> <span class="token function">rm</span> <span class="token parameter variable">--cached</span> filename åˆ é™¤æš‚å­˜åŒºçš„æ–‡ä»¶<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"æ—¥å¿—ä¿¡æ¯"</span> filenaem æäº¤åˆ°æœ¬åœ°åº“<span class="token function">git</span> commit <span class="token parameter variable">--amend</span> + æ—¥å¿— <span class="token comment">#è¦†ç›–æœ€æ–°çš„ä¸€æ¬¡æäº¤æ—¥å¿—</span><span class="token comment">##æäº¤ä¹‹ågit status ä¼šæ˜¾ç¤ºä¸ºæ²¡æœ‰æäº¤</span><span class="token function">git</span> reflog æŸ¥çœ‹æäº¤è®°å½•<span class="token function">git</span> log    æŸ¥çœ‹æ—¥å¿—ï¼ŒåŒ…æ‹¬æäº¤è®°å½•å’Œæäº¤ç”¨æˆ·<span class="token function">git</span> log <span class="token parameter variable">--author</span><span class="token operator">=</span>xxx  åªæŸ¥çœ‹æŸäººçš„æäº¤è®°å½•<span class="token function">git</span> log <span class="token parameter variable">--pretty</span><span class="token operator">=</span>oneline æ¯ä¸€ä¸ªæäº¤è®°å½•åªå ä¸€è¡Œ<span class="token function">git</span> log <span class="token parameter variable">--graph</span> <span class="token parameter variable">--oneline</span> <span class="token parameter variable">--decorate</span> <span class="token parameter variable">--all</span> é€šè¿‡ ASCII è‰ºæœ¯çš„æ ‘å½¢ç»“æ„æ¥å±•ç¤ºæ‰€æœ‰çš„åˆ†æ”¯<span class="token function">git</span> log --name-status çœ‹å“ªä¸ªæ–‡ä»¶æ”¹å˜äº†<span class="token parameter variable">-n</span> nä¸ºæ•°å­— //æœ€æ–°nä¸ªæäº¤<span class="token comment">##ç‰ˆæœ¬ç©¿è¶Šï¼Œä¿®æ”¹HEADæŒ‡é’ˆ æœ¬åœ°åŸæ–‡ä»¶ä¸€å¹¶ä¼šè¢«ä¿®æ”¹</span><span class="token function">git</span> reset <span class="token parameter variable">--hard</span> + ç‰ˆæœ¬å·<span class="token function">git</span> tag xxx æäº¤IDå‰10ä¸ªå­—ç¬¦ï¼Œåˆ›å»ºä¸€ä¸ªæ ‡ç­¾   <span class="token function">git</span> cherry-pick +xx xxx xx æŠŠæŸå‡ ä¸ªåˆ†æ”¯å¤åˆ¶åˆ°å½“å‰åˆ†æ”¯ä¸Š<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ†æ”¯æ“ä½œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> branch åˆ›å»ºåˆ†æ”¯<span class="token function">git</span> branch <span class="token parameter variable">-v</span> æŸ¥çœ‹æœ‰å“ªäº›åˆ†æ”¯<span class="token parameter variable">-m</span> æ”¹å<span class="token parameter variable">-d</span> åˆ é™¤<span class="token function">git</span> checkout  + name åˆ‡æ¢åˆ†æ”¯<span class="token function">git</span> merge  + name    å°†å½“nameåˆå¹¶åœ¨å½“å‰åˆ†æ”¯<span class="token function">git</span> reset    æ’¤é”€æäº¤è®°å½•,ä½†æ˜¯æ’¤é”€ä¹‹å‰çš„è¿˜æ˜¯å­˜åœ¨çš„ï¼Œåªæ˜¯å¤„äºæœªåŠ å…¥ç¼“å†²åŒºçš„çŠ¶æ€ï¼Œä»…é™æœ¬åœ°<span class="token function">git</span> revert   æ’¤é”€æ›´æ”¹åˆ†äº«ç»™åˆ«äºº<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ†æ”¯å†²çªï¼šä¸¤ä¸ªäººåŒæ—¶å¯¹åŒä¸€ä¸ªå†…å®¹ è¿›è¡Œäº†ä¸¤ä¸ªä¸åŒçš„ä¿®æ”¹ï¼Œgitæ— æ³•å†³å®šæ–°çš„æ–‡ä»¶æ‰‹</p><p>æ‰‹åŠ¨ä¿®æ”¹åï¼Œcommit ä¸è¦å†åŠ ä¸Šæ–‡ä»¶åäº†</p><p>HEADæŒ‡å‘çš„æ˜¯å½“å‰åˆ†æ”¯</p><p>è¿œç¨‹å¼€å‘ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> remote <span class="token parameter variable">-v</span> æŸ¥çœ‹æ‰€æœ‰è¿œç¨‹åœ°å€åˆ«å<span class="token function">git</span> remote <span class="token function">add</span> åˆ«å + è¿œç¨‹åœ°å€    ç»™è¿œç¨‹åœ°å€èµ·ä¸€ä¸ªåˆ«åï¼Œæ–¹ä¾¿åˆ‡æ¢<span class="token function">git</span> push +åˆ«å/åº“åœ°å€ + åˆ†æ”¯å    æŠŠè¿™ä¸ªåˆ†æ”¯æ¨é€åˆ°è¿œç¨‹åº“<span class="token function">git</span> pull +åˆ«å/åº“åœ°å€ + åˆ†æ”¯å    æŠŠè¿œç¨‹çš„åˆ†æ”¯åæ‹‰å–<span class="token function">git</span> clone + åº“åœ°å€               å…‹éš†åˆ°æœ¬åœ°  ä¼šè¿›è¡Œï¼š1.æ‹‰å–ä»£ç 2.åˆå§‹åŒ–æœ¬åœ°åº“3.åˆ›å»ºåˆ«å<span class="token comment">###############</span><span class="token function">git</span> clone <span class="token parameter variable">-b</span> <span class="token operator">&lt;</span>branchname<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>remote-repo-url<span class="token operator">&gt;</span> å…‹éš†æŒ‡å®šåˆ†æ”¯<span class="token comment">###############</span><span class="token function">git</span> fetch + xxx <span class="token function">git</span> reset <span class="token parameter variable">--hard</span> origin/master  è·å–æœåŠ¡å™¨ä¸Šæœ€åä¸€æ¬¡æ”¹åŠ¨ï¼Œå¹¶å°†æœ¬åœ°ä¸»åˆ†æ”¯æŒ‡å‘å®ƒï¼Œå®ç°æ”¾å¼ƒæœ¬åœ°æ‰€æœ‰æ”¹åŠ¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä»–çŸ¥è¯†</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gitk å†…å»ºçš„å›¾å½¢åŒ–<span class="token comment">##æ˜¾ç¤ºå†å²è®°å½•æ—¶ï¼Œæ¯ä¸ªæäº¤çš„ä¿¡æ¯åªæ˜¾ç¤ºä¸€è¡Œï¼š</span><span class="token function">git</span> config format.pretty oneline<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å…¶ä»–ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> count-objects <span class="token parameter variable">-vH</span> <span class="token comment">#æŸ¥çœ‹ä»“åº“å¤§å°</span><span class="token function">git</span> log <span class="token parameter variable">--reverse</span>  <span class="token comment">#ä»æ—§åˆ°æ–°æŸ¥çœ‹æäº¤è®°å½•</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="gitignoreé…ç½®"><a href="#gitignoreé…ç½®" class="headerlink" title=".gitignoreé…ç½®"></a>.gitignoreé…ç½®</h2><ul><li>æ‰€æœ‰ä»¥#å¼€å¤´çš„è¡Œä¼šè¢«å¿½ç•¥</li><li>å¯ä»¥ä½¿ç”¨globæ¨¡å¼åŒ¹é…</li><li>åŒ¹é…æ¨¡å¼åè·Ÿåæ–œæ ï¼ˆ/ï¼‰è¡¨ç¤ºè¦å¿½ç•¥çš„æ˜¯ç›®å½•</li><li>å¦‚æœä¸è¦å¿½ç•¥æŸæ¨¡å¼çš„æ–‡ä»¶åœ¨æ¨¡å¼å‰åŠ â€!â€</li></ul><p>ã€€ã€€æ¯”å¦‚ï¼š</p><blockquote><p># æ­¤ä¸ºæ³¨é‡Š â€“ å°†è¢« Git å¿½ç•¥<br><em>.a # å¿½ç•¥æ‰€æœ‰ .a ç»“å°¾çš„æ–‡ä»¶<br>!lib.a # ä½† lib.a é™¤å¤–<br>/TODO # ä»…ä»…å¿½ç•¥é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ TODO æ–‡ä»¶,ä¸åŒ…æ‹¬ subdir/TODO<br>build/ # å¿½ç•¥ build/ ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶<br>doc/</em>.txt # ä¼šå¿½ç•¥ doc/notes.txt ä½†ä¸åŒ…æ‹¬ doc/server/arch.txt</p></blockquote><h3 id="å·¥ä½œä¸­å¸¸ç”¨"><a href="#å·¥ä½œä¸­å¸¸ç”¨" class="headerlink" title="å·¥ä½œä¸­å¸¸ç”¨"></a>å·¥ä½œä¸­å¸¸ç”¨</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> stash //å°†å½“å‰çš„å·¥ä½œæš‚å­˜ï¼Œä½†æ˜¯ä¸è¿›è¡Œæäº¤<span class="token function">git</span> stash show //æ˜¾ç¤ºæš‚å­˜çš„å†…å®¹ï¼Œå“ªäº›è¢«ä¿®æ”¹äº†ï¼Œå¯æŒ‡å®šåºå·<span class="token function">git</span> stash list //å·²ç»æš‚å­˜çš„åˆ—è¡¨å’Œåºå·<span class="token function">git</span> stash apply + stash@<span class="token punctuation">{</span>æ•°å­—<span class="token punctuation">}</span> //åˆ‡æ¢å›æ¥ç»§ç»­å·¥ä½œ //å¯ä»¥åŠ ä¸Š--index æ¥å›åˆ°åŸæ¥æ–‡ä»¶çš„æš‚å­˜çŠ¶æ€<span class="token function">git</span> stash drop //ä¸¢å¼ƒæŒ‡å®šçš„stash<span class="token function">git</span> stash pop //apply + drop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="Scoop"><a href="#Scoop" class="headerlink" title="Scoop"></a>Scoop</h1><blockquote><p>Scoopæ˜¯ä¸€ä¸ªWindowsç³»ç»Ÿç®¡ç†åŒ…çš„å¼€æºè½¯ä»¶ï¼Œç›¸æ¯”ä»ç™¾åº¦ä¸Šæœç´¢ï¼Œä»å‡ åæ¡åƒåœ¾ä¿¡æ¯ä¸­ç­›é€‰å‡ºä¸€ä¸ªèƒ½ç”¨çš„å®‰è£…é“¾æ¥ï¼ŒScoopå¯ä»¥åªä½¿ç”¨ä¸€è¡Œä»£ç è¿›è¡Œå®‰è£…</p></blockquote><h2 id="å®‰è£…ç¯å¢ƒï¼š"><a href="#å®‰è£…ç¯å¢ƒï¼š" class="headerlink" title="å®‰è£…ç¯å¢ƒï¼š"></a>å®‰è£…ç¯å¢ƒï¼š</h2><p>æœ¬äººä½¿ç”¨çš„æ˜¯Windows11ç³»ç»Ÿï¼Œå·²ç»å†…ç½®PowerShelläº†ï¼Œå¦‚æœæ˜¯Windows7ç³»ç»Ÿï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…æ–°ç‰ˆæœ¬çš„PowerShell</p><p>Scoop æºæ–‡ä»¶åœ¨GitHubä¸Šï¼Œæ¨èä½¿ç”¨<strong>é­”æ³•</strong></p><h2 id="æ­¥éª¤ï¼š"><a href="#æ­¥éª¤ï¼š" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h2><p>ä½¿ç”¨å¿«æ·é”®win+ x æ‰“å¼€ Windowsç»ˆç«¯ï¼Œ<strong>ä¸è¦æ‰“å¼€ç®¡ç†å‘˜çš„ç»ˆç«¯</strong></p><p><img src="/2023/07/04/56/Scoop.png" alt="Scoop"></p><p>ä¹‹åè¾“å…¥</p><pre class="line-numbers language-shel" data-language="shel"><code class="language-shel"># è®¾ç½® PowerShell æ‰§è¡Œç­–ç•¥Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser# ä¸‹è½½å®‰è£…è„šæœ¬irm get.scoop.sh -outfile 'install.ps1'# æ‰§è¡Œå®‰è£…, --ScoopDir å‚æ•°æŒ‡å®š Scoop å®‰è£…è·¯å¾„ ' ' å†…çš„æ˜¯è‡ªå®šä¹‰çš„å®‰è£…ç›®å½•.\install.ps1 -ScoopDir 'D:\Scoop'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä½¿ç”¨æŠ€å·§"><a href="#ä½¿ç”¨æŠ€å·§" class="headerlink" title="ä½¿ç”¨æŠ€å·§"></a>ä½¿ç”¨æŠ€å·§</h2><p><a href="https://github.com/ScoopInstaller/Scoop">å®˜æ–¹æ–‡æ¡£</a> æˆ– <a href="https://github.com/ScoopInstaller/Scoop/wiki/Quick-Start">å¿«é€Ÿå…¥é—¨</a> </p><p><a href="https://p3terx.com/archives/scoop-the-best-windows-package-manager.html">å¤§ä½¬çš„åšå®¢</a></p><p>scoopç¤¾åŒºç»´æŠ¤çš„å®‰è£…è·¯å¾„å¤§éƒ¨åˆ†åœ¨å›½å¤–ï¼Œæ‰€ä»¥ä¸‹è½½æ—¶å»ºè®®ä½¿ç”¨é­”æ³•</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">scoop <span class="token builtin class-name">help</span>  å‘½ä»¤å‚è€ƒè¯´æ˜scoop + åŠ¨ä½œ + å¯¹è±¡ï¼Œ å¯¹è±¡å¯ä»¥çœç•¥scoop +search æœç´¢è½¯ä»¶å<span class="token function">install</span> å®‰è£…è½¯ä»¶update  æ›´æ–°è½¯ä»¶status  æŸ¥çœ‹è½¯ä»¶è£…å¡«uninstall å¸è½½è½¯ä»¶info     æŸ¥çœ‹è½¯ä»¶è¯¦æƒ…home     æ‰“å¼€è½¯ä»¶ä¸»é¡µ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸¾ä¾‹ï¼š</p><ul><li>æŸ¥çœ‹æœ¬æœºæœ‰æ— å®‰è£…typora</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">scoop search typora<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>Scoopä¸‹è½½è½¯ä»¶çš„å®‰è£…è·¯å¾„æ˜¯è‡ªå®šä¹‰ä¸‹è½½è·¯å¾„ä¸­çš„appsæ–‡ä»¶å¤¹</strong></p><h2 id="æ­£åˆ™è¡¨è¾¾å¼ï¼š"><a href="#æ­£åˆ™è¡¨è¾¾å¼ï¼š" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼ï¼š"></a>æ­£åˆ™è¡¨è¾¾å¼ï¼š</h2><pre class="line-numbers language-none"><code class="language-none">$ åŒ¹é…æœ«å°¾ä½ç½®  ^ åŒ¹é…å¼€å¤´ä½ç½®* åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦çš„0æ¬¡æˆ–næ¬¡  ä¾‹å¦‚ï¼š zo* ä¼šåŒ¹é…z zo zoo zooo z......  ç­‰+ åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦ä¸€æ¬¡æˆ–å¤šæ¬¡u        zo+ åŒ¹é… zo zoo zooo zo...... ç­‰? åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦0æ¬¡æˆ–1æ¬¡           zo?      z  zo{n,m}  åŒ¹é… n åˆ° m æ¬¡{n}      n æ¬¡? + å…¶ä»–é™å®šç¬¦ï¼Œè¡¨ç¤ºåŒ¹é…éè´ªå¿ƒï¼Œé»˜è®¤çš„åŒ¹é…ä¼šå°½åŠ›åŒ¹é…è¾ƒé•¿çš„æ»¡è¶³æ¡ä»¶çš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨è¿™ä¸ªåå°½åŠ›åŒ¹é…è¾ƒçŸ­çš„å­—ç¬¦ä¸².  åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦//(pattern) åŒ¹é…pattern å¹¶æ•è·ä»–çš„å­è¡¨è¾¾å¼(?:pattern) ä¸æ•è·å­è¡¨è¾¾å¼(?=pattern) å‰é¢çš„å­—ç¬¦åŒ¹é…åˆ°ä¹‹åï¼Œåˆ¤æ–­åé¢çš„æ˜¯å¦èƒ½å¤ŸåŒ¹é…pattern å¦‚æœèƒ½é‚£ä¹ˆå°±æ•è·ï¼Œå¦åˆ™ä¸åŒ¹é…(?!pattern) åå‘æ•è·ï¼Œä¸æ•è·åŒ…å«patterçš„å­—ç¬¦ä¸²//è§„åˆ™é›†x|y åŒ¹é…xæˆ–y[xyz] å­—ç¬¦é›†ï¼ŒåŒ¹é…ä¸‰è€…çš„ä»»ä¸€å­—ç¬¦[^xyz] åå‘æ•è·[a-z]  åŒ¹é…a-z ä¸­çš„ä»»ä¸€å­—ç¬¦[^a-z] åå‘åŒ¹é…ä¸åŒ…å«çš„//\b     border ä»¥è¿™ä¸ªç¬¦å·ä¹‹å‰çš„å­—ç¬¦(ä¸²)ä¸ºè¾¹ç•Œçš„åŒ¹é…\B     éè¾¹ç•ŒåŒ¹é…\cx    x ä¸º[a-z] æˆ– [A-Z] åŒ¹é…ctrl + x\d     æ•°å­—åŒ¹é…ï¼Œåè¿›åˆ¶[0-9]\D     [^0-9]\f     åŒ¹é…æ¢é¡µç¬¦\n     æ¢è¡Œç¬¦\r     åŒ¹é…å›è½¦\w     åŒ¹é…å­—ç±»å­—ç¬¦ [A-Za-z0-9]\W     éå­—ç±»å­—ç¬¦<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h1><h2 id="åæ ‡"><a href="#åæ ‡" class="headerlink" title="åæ ‡"></a>åæ ‡</h2><ul><li><strong>groupId</strong>(å¿…é¡»): å®šä¹‰äº†å½“å‰ Maven é¡¹ç›®éš¶å±çš„ç»„ç»‡æˆ–å…¬å¸ã€‚groupId ä¸€èˆ¬åˆ†ä¸ºå¤šæ®µï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œç¬¬ä¸€æ®µä¸ºåŸŸï¼Œç¬¬äºŒæ®µä¸ºå…¬å¸åç§°ã€‚åŸŸåˆåˆ†ä¸º orgã€comã€cn ç­‰ï¼Œå…¶ä¸­ org ä¸ºéè¥åˆ©ç»„ç»‡ï¼Œcom ä¸ºå•†ä¸šç»„ç»‡ï¼Œcn è¡¨ç¤ºä¸­å›½ã€‚ä»¥ apache å¼€æºç¤¾åŒºçš„ tomcat é¡¹ç›®ä¸ºä¾‹ï¼Œè¿™ä¸ªé¡¹ç›®çš„ groupId æ˜¯ org.apacheï¼Œå®ƒçš„åŸŸæ˜¯ orgï¼ˆå› ä¸º tomcat æ˜¯éè¥åˆ©é¡¹ç›®ï¼‰ï¼Œå…¬å¸åç§°æ˜¯ apacheï¼ŒartifactId æ˜¯ tomcatã€‚</li><li><strong>artifactId</strong>(å¿…é¡»)ï¼šå®šä¹‰äº†å½“å‰ Maven é¡¹ç›®çš„åç§°ï¼Œé¡¹ç›®çš„å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå¯¹åº”é¡¹ç›®æ ¹ç›®å½•çš„åç§°ã€‚</li><li><strong>version</strong>(å¿…é¡»)ï¼šå®šä¹‰äº† Maven é¡¹ç›®å½“å‰æ‰€å¤„ç‰ˆæœ¬ã€‚</li><li><strong>packaging</strong>ï¼ˆå¯é€‰ï¼‰ï¼šå®šä¹‰äº† Maven é¡¹ç›®çš„æ‰“åŒ…æ–¹å¼ï¼ˆæ¯”å¦‚ jarï¼Œwarâ€¦ï¼‰ï¼Œé»˜è®¤ä½¿ç”¨ jarã€‚</li><li><strong>classifier</strong>(å¯é€‰)ï¼šå¸¸ç”¨äºåŒºåˆ†ä»åŒä¸€ POM æ„å»ºçš„å…·æœ‰ä¸åŒå†…å®¹çš„æ„ä»¶ï¼Œå¯ä»¥æ˜¯ä»»æ„çš„å­—ç¬¦ä¸²ï¼Œé™„åŠ åœ¨ç‰ˆæœ¬å·ä¹‹åã€‚</li></ul><hr><h2 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h2><ul><li>dependenciesï¼šä¸€ä¸ª pom.xml æ–‡ä»¶ä¸­åªèƒ½å­˜åœ¨ä¸€ä¸ªè¿™æ ·çš„æ ‡ç­¾ï¼Œæ˜¯ç”¨æ¥ç®¡ç†ä¾èµ–çš„æ€»æ ‡ç­¾ã€‚</li><li>dependencyï¼šåŒ…å«åœ¨ dependencies æ ‡ç­¾ä¸­ï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œæ¯ä¸€ä¸ªè¡¨ç¤ºé¡¹ç›®çš„ä¸€ä¸ªä¾èµ–ã€‚</li><li>groupId,artifactId,version(å¿…è¦)ï¼šä¾èµ–çš„åŸºæœ¬åæ ‡ï¼Œå¯¹äºä»»ä½•ä¸€ä¸ªä¾èµ–æ¥è¯´ï¼ŒåŸºæœ¬åæ ‡æ˜¯æœ€é‡è¦çš„ï¼ŒMaven æ ¹æ®åæ ‡æ‰èƒ½æ‰¾åˆ°éœ€è¦çš„ä¾èµ–ã€‚æˆ‘ä»¬åœ¨ä¸Šé¢è§£é‡Šè¿‡è¿™äº›å…ƒç´ çš„å…·ä½“æ„æ€ï¼Œè¿™é‡Œå°±ä¸é‡å¤æäº†ã€‚</li><li>type(å¯é€‰)ï¼šä¾èµ–çš„ç±»å‹ï¼Œå¯¹åº”äºé¡¹ç›®åæ ‡å®šä¹‰çš„ packagingã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¯¥å…ƒç´ ä¸å¿…å£°æ˜ï¼Œå…¶é»˜è®¤å€¼æ˜¯ jarã€‚</li><li>scope(å¯é€‰)ï¼šä¾èµ–çš„èŒƒå›´ï¼Œé»˜è®¤å€¼æ˜¯ compileã€‚</li><li>optional(å¯é€‰)ï¼šæ ‡è®°ä¾èµ–æ˜¯å¦å¯é€‰</li><li>exclusions(å¯é€‰)ï¼šç”¨æ¥æ’é™¤ä¼ é€’æ€§ä¾èµ–,ä¾‹å¦‚ jar åŒ…å†²çª</li></ul><hr><p>è‘—ä½œæƒå½’JavaGuide(javaguide.cn)æ‰€æœ‰ åŸºäºMITåè®® åŸæ–‡é“¾æ¥ï¼š<a href="https://javaguide.cn/tools/maven/maven-core-concepts.html">https://javaguide.cn/tools/maven/maven-core-concepts.html</a></p><p>è‘—ä½œæƒå½’JavaGuide(javaguide.cn)æ‰€æœ‰ åŸºäºMITåè®® åŸæ–‡é“¾æ¥ï¼š<a href="https://javaguide.cn/tools/maven/maven-core-concepts.html">https://javaguide.cn/tools/maven/maven-core-concepts.html</a></p><h1 id="xml"><a href="#xml" class="headerlink" title="xml"></a>xml</h1><p>eXtensible Markup Language å³å¯æ‰©å±•æ ‡è®°è¯­è¨€ã€‚<br>ä¸€èˆ¬ç”¨äºåšæ•°æ®å­˜å‚¨ï¼Œæ”¯æŒè‡ªå®šä¹‰æ ‡ç­¾</p><blockquote><p>é€šè¿‡ XMLï¼Œæ•°æ®èƒ½å¤Ÿå­˜å‚¨åœ¨ç‹¬ç«‹çš„ XML æ–‡ä»¶ä¸­ã€‚è¿™æ ·æ‚¨å°±å¯ä»¥ä¸“æ³¨äºä½¿ç”¨ HTML/CSS è¿›è¡Œæ˜¾ç¤ºå’Œå¸ƒå±€ï¼Œå¹¶ç¡®ä¿ä¿®æ”¹åº•å±‚æ•°æ®ä¸å†éœ€è¦å¯¹ HTML è¿›è¡Œä»»ä½•çš„æ”¹å˜ã€‚<br>é€šè¿‡ä½¿ç”¨å‡ è¡Œ JavaScript ä»£ç ï¼Œæ‚¨å°±å¯ä»¥è¯»å–ä¸€ä¸ªå¤–éƒ¨ XML æ–‡ä»¶ï¼Œå¹¶æ›´æ–°æ‚¨çš„ç½‘é¡µçš„æ•°æ®å†…å®¹ã€‚</p></blockquote><h2 id="åŸºç¡€è¯­æ³•ï¼š"><a href="#åŸºç¡€è¯­æ³•ï¼š" class="headerlink" title="åŸºç¡€è¯­æ³•ï¼š"></a>åŸºç¡€è¯­æ³•ï¼š</h2><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">//æ–‡æ¡£å£°æ˜:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>?xml</span> <span class="token attr-name">version</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>xxx<span class="token punctuation">"</span></span> <span class="token attr-name">?</span> <span class="token attr-name">encodiing</span> <span class="token attr-name">standlone</span><span class="token punctuation">&gt;</span></span>encoding æŒ‡å®šæ–‡æ¡£çš„ç¼–ç  UTF-8ç­‰standalone æ–‡æ¡£æ˜¯å¦ç‹¬ç«‹ yes or noæ³¨é‡Šï¼š<span class="token comment">&lt;!--comment --&gt;</span>æ ‡ç­¾å†…è¦åŒ…å«è¦ä¼ é€’çš„ä¿¡æ¯<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>message</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>message</span><span class="token punctuation">/&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¤ºä¾‹: Bobå†™ä¸ªTomçš„ä¿¡<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>?xml</span> <span class="token attr-name">version</span> <span class="token attr-name">"1.0"</span> <span class="token attr-name">encoding</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--å£°æ˜--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>note</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- æ ¹å…ƒç´ ï¼Œæ¥è¡¨ç¤ºæœ¬æ–‡æ¡£çš„ç±»å‹--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>to</span><span class="token punctuation">&gt;</span></span> Tom <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>to</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>from</span><span class="token punctuation">&gt;</span></span> Bob <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>from</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heading</span><span class="token punctuation">&gt;</span></span> Reminder <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heading</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span> Dont' forget me this weekend <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>note</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>xmlæ–‡æ¡£å¿…é¡»åŒ…å«ä¸€ä¸ªæ ¹å…ƒç´ ï¼Œä¸”åªèƒ½æœ‰ä¸€ä¸ªæ ¹å…ƒç´ ï¼Œå…¶ä»–æ‰€æœ‰å…ƒç´ éƒ½æ˜¯æ ¹å…ƒç´ çš„å­å…ƒç´ </li><li>æ‰€æœ‰çš„æ ‡ç­¾éƒ½æœ‰ä¸€ä¸ªé—­æ ‡ç­¾ &lt;/â€¦&gt;</li><li>xml æ ‡ç­¾å¯¹å¤§å°å†™æ•æ„Ÿ</li><li>å±æ€§å€¼å¿…é¡»åŠ å¼•å·<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>note</span> <span class="token attr-name">date</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12/11/2023<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>å®ä½“å¼•ç”¨ï¼Œç”¨äºè½¬ä¹‰æŸäº›ç¬¦å·</li></ul><pre class="line-numbers language-XML" data-language="XML"><code class="language-XML">&lt;  &lt;  less than&gt;  &gt;  greater than&amp; &amp;  ampersand&amp;apos; ' apostrophe" " quotation mark<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ ‡ç­¾å‘½åï¼š å°½é‡ç”¨ __ æ¥è¿›è¡Œå‘½å first_name</li><li>å±æ€§Attribute : æä¾›æœ‰å…³å…ƒç´ çš„é¢å¤–ä¿¡æ¯ (å°½é‡å‡å°‘å±æ€§çš„ä½¿ç”¨ï¼Œå°†å±æ€§ä½œä¸ºä¸€ä¸ªæ–°çš„æ ‡ç­¾å³å¯)</li><li>DTD ç”¨äºå®šä¹‰xmlæ–‡æ¡£ç»“æ„ Schema åŸºäºxmlçš„DTDæ›¿ä»£</li><li>XSLTæ¥æ˜¾ç¤ºXML</li></ul><h2 id="XMLHttpRequest-å¯¹è±¡-JavaScript"><a href="#XMLHttpRequest-å¯¹è±¡-JavaScript" class="headerlink" title="XMLHttpRequest å¯¹è±¡(JavaScript)"></a>XMLHttpRequest å¯¹è±¡(JavaScript)</h2><p>åŠŸèƒ½ï¼š</p><blockquote><p>åœ¨ä¸é‡æ–°åŠ è½½é¡µé¢çš„æƒ…å†µä¸‹æ›´æ–°ç½‘é¡µ<br>åœ¨é¡µé¢å·²åŠ è½½åä»æœåŠ¡å™¨è¯·æ±‚æ•°æ®<br>åœ¨é¡µé¢å·²åŠ è½½åä»æœåŠ¡å™¨æ¥æ”¶æ•°æ®<br>åœ¨åå°å‘æœåŠ¡å™¨å‘é€æ•°æ®</p></blockquote><h1 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h1><p>ç‰¹ç‚¹:</p><ol><li>ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»</li><li>ç¼©è¿›ä¸èƒ½ä½¿ç”¨tabé”®</li><li>åªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦å¯¹é½å³å¯ï¼Œä¸éœ€è¦æ§åˆ¶å¤šå°‘ç©ºæ ¼æ•°</li><li><h1 id="è¡¨ç¤ºæ³¨é‡Š"><a href="#è¡¨ç¤ºæ³¨é‡Š" class="headerlink" title="è¡¨ç¤ºæ³¨é‡Š"></a>è¡¨ç¤ºæ³¨é‡Š</h1></li></ol><p>ç¤ºä¾‹:</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">key</span><span class="token punctuation">:</span><span class="token key atrule">child-key</span><span class="token punctuation">:</span> value <span class="token comment"># ç»™äºˆå€¼çš„æ—¶å€™è¦ç©ºä¸€ä¸ªé¢æ ¼</span><span class="token comment">#è¾ƒä¸ºå¤æ‚çš„å¯¹è±¡æ ¼å¼ï¼Œå¯ä»¥ä½¿ç”¨é—®å·åŠ ä¸€ä¸ªç©ºæ ¼ä»£è¡¨ä¸€ä¸ªå¤æ‚çš„ keyï¼Œé…åˆä¸€ä¸ªå†’å·åŠ ä¸€ä¸ªç©ºæ ¼ä»£è¡¨ä¸€ä¸ª valueï¼š</span><span class="token punctuation">?</span>      <span class="token punctuation">-</span> complexkey1    <span class="token punctuation">-</span> <span class="token key atrule">complexkey2</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> complexvalue1    <span class="token punctuation">-</span> complexvalue2æ„æ€å³å¯¹è±¡çš„å±æ€§æ˜¯ä¸€ä¸ªæ•°ç»„ <span class="token punctuation">[</span>complexkey1<span class="token punctuation">,</span>complexkey2<span class="token punctuation">]</span>ï¼Œå¯¹åº”çš„å€¼ä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„ <span class="token punctuation">[</span>complexvalue1<span class="token punctuation">,</span>complexvalue2<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ•°ç»„<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"> <span class="token comment"># å¤šç»´æ•°ç»„</span><span class="token punctuation">-</span> a<span class="token punctuation">-</span> b<span class="token punctuation">-</span> c  <span class="token punctuation">-</span> d  <span class="token punctuation">-</span> e    <span class="token punctuation">-</span> f<span class="token key atrule">companies</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span>        <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">1</span>        <span class="token key atrule">name</span><span class="token punctuation">:</span> company1        <span class="token key atrule">price</span><span class="token punctuation">:</span> 200W    <span class="token punctuation">-</span>        <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">2</span>        <span class="token key atrule">name</span><span class="token punctuation">:</span> company2        <span class="token key atrule">price</span><span class="token punctuation">:</span> 500W<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="å¤åˆç»“æ„"><a href="#å¤åˆç»“æ„" class="headerlink" title="å¤åˆç»“æ„"></a>å¤åˆç»“æ„</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">æ•°ç»„å’Œå¯¹è±¡å¯ä»¥æ„æˆå¤åˆç»“æ„ï¼Œä¾‹ï¼š<span class="token key atrule">languages</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> Ruby  <span class="token punctuation">-</span> Perl  <span class="token punctuation">-</span> Python <span class="token key atrule">websites</span><span class="token punctuation">:</span>  <span class="token key atrule">YAML</span><span class="token punctuation">:</span> yaml.org   <span class="token key atrule">Ruby</span><span class="token punctuation">:</span> ruby<span class="token punctuation">-</span>lang.org   <span class="token key atrule">Python</span><span class="token punctuation">:</span> python.org   <span class="token key atrule">Perl</span><span class="token punctuation">:</span> use.perl.orgè½¬æ¢ä¸º json ä¸ºï¼š<span class="token punctuation">{</span>   <span class="token key atrule">languages</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">'Ruby'</span><span class="token punctuation">,</span> <span class="token string">'Perl'</span><span class="token punctuation">,</span> <span class="token string">'Python'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token key atrule">websites</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token key atrule">YAML</span><span class="token punctuation">:</span> <span class="token string">'yaml.org'</span><span class="token punctuation">,</span>    <span class="token key atrule">Ruby</span><span class="token punctuation">:</span> <span class="token string">'ruby-lang.org'</span><span class="token punctuation">,</span>    <span class="token key atrule">Python</span><span class="token punctuation">:</span> <span class="token string">'python.org'</span><span class="token punctuation">,</span>    <span class="token key atrule">Perl</span><span class="token punctuation">:</span> <span class="token string">'use.perl.org'</span>   <span class="token punctuation">}</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><ol><li>å®‰è£…ï¼Œå¹¶ä¿®æ”¹å®‰è£…è·¯å¾„(windows)<br>æ­¤æ–¹æ³•å®˜æ–¹æ–‡æ¡£é‡Œæœ‰<br>å…ˆä¸‹è½½å®‰è£…åŒ…<br>åœ¨æƒ³å®‰è£…çš„åœ°æ–¹å»ºç«‹æ–‡ä»¶å¤¹Dockerå³å¯<br>ç„¶åæ‰“å¼€cmdï¼Œè¾“å…¥<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token string">"Docker Desktop Installer.exe"</span> <span class="token function">install</span> --installation-dir<span class="token operator">=</span><span class="token string">"E:\Program Files\Docker"</span>åé¢çš„æ˜¯ä½ è‡ªå·±çš„è·¯å¾„ï¼Œæ ¹æ®å®é™…ä¿®æ”¹å³å¯ï¼Œç­‰å¾…å®‰è£…å®Œæ¯•å³å¯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol><h2 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h2><p>å®¹å™¨æ˜¯é•œåƒçš„å®ä¾‹åŒ–ï¼Œå®¹å™¨æ˜¯ä¸€ä¸ªå°å‹çš„osï¼ŒåŒ…å«åº”ç”¨å’Œå…¶æœ¬èº«æ‰€éœ€è¦çš„ç¯å¢ƒï¼Œé•œåƒæ˜¯åªè¯»çš„ï¼Œè€Œå®¹å™¨æ˜¯å¯ä»¥è¿è¡Œçš„å¯å†™çš„ï¼Œå…¶ä¸­çš„å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€</p><h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><p><img src="/2023/07/04/56/docker%E5%91%BD%E4%BB%A4.webp"></p><ul><li>åŸºç¡€é•œåƒå‘½ä»¤(ä¸gitç±»ä¼¼)</li><li>ls , tag , inspect<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">docker tag æ—§ æ–°docker inspect è·å¾—è¯¥é•œåƒçš„è¯¦ç»†ä¿¡æ¯.-f åé¢åŠ ä¸Šæƒ³è·å¾—çš„æŸä¸€é¡¹çš„keyå°±å¯ä»¥å•ç‹¬è·å¾—è¿™ä¸€é¡¹çš„å†…å®¹äº†æ ¼å¼ä¸º</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token string">".keyå"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>docker history æŸ¥çœ‹æŸä¸€é•œåƒçš„å†å²docker search -f=is-official=true --limit 5 --no-trunc  nginx  -f è¿‡æ»¤æ¡ä»¶limit é™åˆ¶è¾“å‡ºçš„æ•°é‡--no-trunc ä¸æˆªæ–­è¾“å‡ºç»“æœdocker rmi  -f  myubuntu å½“å­˜åœ¨å¤šä¸ªæ ‡ç­¾æ—¶ï¼Œåˆ é™¤çš„åªæ˜¯æ ‡ç­¾ï¼Œå½“ä»…ä»…å‰©ä¸‹ä¸€ä¸ªæ ‡ç­¾æ—¶ä¼šæŠŠè¿™ä¸ªé•œåƒç›´æ¥åˆ é™¤ -få¼ºåˆ¶åˆ é™¤docker image prune æ¸…ç†ä¸´æ—¶é•œåƒæ–‡ä»¶<span class="token punctuation">,</span>è™šæ‚¬æ–‡ä»¶ï¼ŒæŒ‡çš„æ˜¯docker images ä¸­æ²¡æœ‰åå­—çš„æ–‡ä»¶-a åˆ é™¤æ‰€æœ‰æ— ç”¨image ä¸å…‰æ˜¯ä¸´æ—¶é•œåƒ-filter åªåˆ é™¤ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„é•œåƒ- `until`<span class="token punctuation">:</span> æ ¹æ®é•œåƒçš„åˆ›å»ºæ—¶é—´æ¥ç­›é€‰ã€‚ä¾‹å¦‚ï¼Œ`until=24h`å°†åˆ é™¤24å°æ—¶ä¹‹å‰åˆ›å»ºçš„é•œåƒã€‚    - `label`<span class="token punctuation">:</span> æ ¹æ®æ ‡ç­¾æ¥ç­›é€‰ã€‚ä¾‹å¦‚ï¼Œ`label=myapp`å°†åˆ é™¤å¸¦æœ‰æ ‡ç­¾ä¸º<span class="token string">"myapp"</span>çš„é•œåƒã€‚    - `dangling`<span class="token punctuation">:</span> ç­›é€‰å‡ºæ‚¬æŒ‚ï¼ˆæ— ç”¨ï¼‰é•œåƒã€‚ä½¿ç”¨`dangling=true`æ¥åˆ é™¤æ‚¬æŒ‚é•œåƒã€‚-f å¼ºåˆ¶åˆ é™¤åˆ›å»ºé•œåƒdocker commit [OPTIONS] CONTAINER [REPOSITORY[<span class="token punctuation">:</span>TAG]]docker commit [é€‰é¡¹] &lt;å®¹å™¨IDæˆ–å®¹å™¨å&gt; [&lt;ä»“åº“å&gt;[<span class="token punctuation">:</span>&lt;æ ‡ç­¾&gt;]] docker commit \    --author <span class="token string">"Tao Wang &lt;twang2218@gmail.com&gt;"</span> \    --message <span class="token string">"ä¿®æ”¹äº†é»˜è®¤ç½‘é¡µ"</span> \    webserver \    <span class="token property">nginx</span><span class="token punctuation">:</span>v2//- `CONTAINER`æ˜¯è¦ä¿å­˜çŠ¶æ€çš„å®¹å™¨çš„åç§°æˆ–å®¹å™¨IDã€‚- `REPOSITORY[<span class="token punctuation">:</span>TAG]`æ˜¯æ–°é•œåƒçš„åç§°å’Œæ ‡ç­¾ã€‚å¦‚æœä¸æä¾›æ ‡ç­¾ï¼Œå°†é»˜è®¤ä½¿ç”¨<span class="token string">"latest"</span>æ ‡ç­¾ã€‚docker commit -m <span class="token string">"xxx"</span> è¢«æäº¤çš„å®¹å™¨//å¯¼å…¥å¯¼å‡ºé•œåƒdocker save -o my_images.tar <span class="token property">image1</span><span class="token punctuation">:</span>tag <span class="token property">image2</span><span class="token punctuation">:</span>tag <span class="token property">image3</span><span class="token punctuation">:</span>tag  ä¿å­˜å¤šä¸ªåˆ°é•œåƒåˆ°æŒ‡å®šçš„æ–‡ä»¶å¤¹docker load -i my_image.tar <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>å®¹å™¨æ“ä½œ</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">docker create  xxxå¯é€‰ã€‚ã€‚ã€‚-i é»˜è®¤æ‰“å¼€æ ‡å‡†è¾“å…¥-tåˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯docker start xx  å¯åŠ¨ä¸€ä¸ªå®¹å™¨docker run --name æ–°åå­— options é•œåƒ åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨å¯é€‰-d ä»¥å®ˆæŠ¤æ€åå°è¿è¡Œï¼Œå®¹å™¨æ˜¯å¦ä¼šé•¿ä¹…è¿è¡Œï¼Œæ˜¯å’Œ `docker run` æŒ‡å®šçš„å‘½ä»¤æœ‰å…³ï¼Œå’Œ `-d` å‚æ•°æ— å…³ã€‚-t åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯-i è®©å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¿æŒæ‰“å¼€docker restart å…³é—­å®¹å™¨å¹¶é‡æ–°å¯åŠ¨docker logs -details-f follow æŒç»­ä¿æŒè¾“å‡ºsince string ä»æŸä¸€ä¸ªæ—¶é—´å¼€å§‹æ—¥å¿—-tail string è¾“å‡ºæœ€è¿‘çš„è‹¥å¹²æ—¥å¿—-t timestamps æ˜¾ç¤ºæ—¶é—´æˆ³ä¿¡æ¯-until string è¾“å‡ºæŸä¸ªæ—¶é—´æ®µä¹‹å‰çš„ä¿¡æ¯docker exec -it xxx è¿›å…¥ä¸€ä¸ªåå°çš„å®¹å™¨ ä½¿ç”¨è¿™ä¸ªä¹‹åå†å®¹å™¨å†…éƒ¨æ‰§è¡Œexit æ—¶ä¸ä¼šå¯¼è‡´å®¹å™¨åœæ­¢ï¼Œä½†æ˜¯ä½¿ç”¨ docker attach è¿›å…¥å®¹å™¨å¹¶é€€å‡ºçš„è¯ä¼šå¯¼è‡´å®¹å™¨åœæ­¢å¹¶é€€å‡ºdocker rm -f å¼ºåˆ¶ç»ˆæ­¢å¹¶åˆ é™¤ä¸€ä¸ªå®¹å™¨-l åˆ é™¤å®¹å™¨çš„é“¾æ¥ï¼Œä½†ä¿ç•™å®¹å™¨-v åˆ é™¤å®¹å™¨æŒ‚åœ¨çš„æ•°æ®å·docker top å®¹å™¨åç§° æŸ¥çœ‹å®¹å™¨çš„è¿›ç¨‹docker inspect å®¹å™¨åç§° æŸ¥çœ‹å®¹å™¨ä¿¡æ¯docker cp &lt;æœ¬åœ°æ–‡ä»¶/ç›®å½•è·¯å¾„&gt; &lt;å®¹å™¨IDæˆ–åç§°&gt;<span class="token punctuation">:</span>&lt;å®¹å™¨å†…éƒ¨è·¯å¾„&gt;docker cp &lt;å®¹å™¨IDæˆ–åç§°&gt;<span class="token punctuation">:</span>&lt;å®¹å™¨å†…éƒ¨è·¯å¾„&gt; &lt;æœ¬åœ°æ–‡ä»¶/ç›®å½•è·¯å¾„&gt;-a æ‰“åŒ…-L è·Ÿéšè½¯è¿æ¥docker pause id æš‚åœ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><ol><li><strong>åˆ›å»ºå·</strong>ï¼š æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªå·ï¼š</li></ol><p>  bashCopy code</p><p>  <code>docker volume create my_volume</code></p><p>  è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º <code>my_volume</code> çš„å·ã€‚</p></li></ul><ol start="2"><li><p><strong>æŸ¥çœ‹å·åˆ—è¡¨</strong>ï¼š è¦æŸ¥çœ‹ç³»ç»Ÿä¸­çš„æ‰€æœ‰å·ï¼Œå¯ä»¥è¿è¡Œï¼š</p><p> bashCopy code</p><p> <code>docker volume ls</code></p></li><li><p><strong>åˆ é™¤å·</strong>ï¼š è¦åˆ é™¤ä¸€ä¸ªä¸å†éœ€è¦çš„å·ï¼Œå¯ä»¥è¿è¡Œï¼š</p><p> bashCopy code</p><p> <code>docker volume rm my_volume</code></p></li><li><p><strong>æŒ‚è½½å·åˆ°å®¹å™¨</strong>ï¼š åœ¨è¿è¡Œå®¹å™¨æ—¶ï¼Œä½¿ç”¨ <code>-v</code> æˆ– <code>--volume</code> æ ‡å¿—æ¥å°†å·æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨ã€‚ä¾‹å¦‚ï¼š</p><p> bashCopy code</p><p> <code>docker run -d -v my_volume:/path/in/container my_image</code></p><p> è¿™å°†æŠŠ <code>my_volume</code> å·æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„ <code>/path/in/container</code> ç›®å½•ã€‚</p></li><li><p><strong>æŒ‚è½½ä¸»æœºç›®å½•åˆ°å®¹å™¨</strong>ï¼š æ‚¨è¿˜å¯ä»¥å°†ä¸»æœºä¸Šçš„ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…ã€‚ä¾‹å¦‚ï¼š</p><p> bashCopy code</p><p> <code>docker run -d -v /host/path:/path/in/container my_image</code></p><p> è¿™å°†æŠŠä¸»æœºä¸Šçš„ <code>/host/path</code> ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„ <code>/path/in/container</code>ã€‚</p></li><li><p><strong>æŸ¥çœ‹å®¹å™¨çš„æŒ‚è½½å·</strong>ï¼š è¦æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨æŒ‚è½½äº†å“ªäº›å·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><p> bashCopy code</p><p> <code>docker inspect -f '{{ .Mounts }}' container_name_or_id</code></p></li><li><p><strong>å¤åˆ¶æ–‡ä»¶åˆ°å·</strong>ï¼š å¦‚æœéœ€è¦å°†æ–‡ä»¶å¤åˆ¶åˆ°å·ä¸­ï¼Œå¯ä»¥è¿è¡Œä¸€ä¸ªä¸´æ—¶å®¹å™¨ï¼Œç„¶åå°†æ–‡ä»¶å¤åˆ¶åˆ°æŒ‚è½½å·çš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼š</p><p> bashCopy code</p><p> <code>docker run --rm -v my_volume:/path/in/container -v /local/path/to/file:/data busybox cp /local/path/to/file /path/in/container</code></p><p> è¿™å°†å¤åˆ¶ <code>/local/path/to/file</code> åˆ° <code>my_volume</code> å·çš„ <code>/path/in/container</code>ã€‚</p></li><li><p><strong>å·æ•°æ®å¤‡ä»½å’Œæ¢å¤</strong>ï¼š æ‚¨å¯ä»¥ä½¿ç”¨å·¥å…·å¦‚ <code>docker cp</code> æˆ– <code>docker export</code> æ¥å¤‡ä»½å·æ•°æ®ï¼Œç„¶åä½¿ç”¨ <code>docker create</code> å’Œ <code>docker start</code> æ¥æ¢å¤å®ƒä»¬ã€‚å¤‡ä»½å’Œæ¢å¤æ•°æ®çš„ç¡®åˆ‡æ–¹æ³•å–å†³äºæ‚¨çš„éœ€æ±‚å’Œå®¹å™¨çš„æƒ…å†µã€‚</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">æŒ‚è½½æ•°æ®å·1.å»ºç«‹æ•°æ®å·docker run -it -v /db --name db0 ubuntudocker run -it --volume-from db --name db1 ubuntudocker run -it --volume-from db --name db2 ubuntu<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><ul><li>VOLUME çš„ä½¿ç”¨<br>å°†æ•°æ®è¯»å†™å­˜å‚¨åœ¨æ•°æ®å·ä¸­ï¼Œä½¿å¾—å®¹å™¨å°½é‡ä¸å‘ç”Ÿè¯»å†™æ“ä½œï¼Œdockerfile ä¸­çš„VOLUMEæ˜¯å¯ä»¥å‘—docker runè¦†ç›–çš„</li></ul><h3 id="dockerfile"><a href="#dockerfile" class="headerlink" title="dockerfile"></a>dockerfile</h3><h2 id="æŒ‡ä»¤è¯¦è§£"><a href="#æŒ‡ä»¤è¯¦è§£" class="headerlink" title="æŒ‡ä»¤è¯¦è§£"></a>æŒ‡ä»¤è¯¦è§£</h2><table><thead><tr><th>Dockerfile æŒ‡ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>FROM</td><td>æŒ‡å®šåŸºç¡€é•œåƒï¼Œç”¨äºåç»­çš„æŒ‡ä»¤æ„å»ºã€‚</td></tr><tr><td>LABEL</td><td>æ·»åŠ é•œåƒçš„å…ƒæ•°æ®ï¼Œä½¿ç”¨é”®å€¼å¯¹çš„å½¢å¼ï¼Œæ–¹ä¾¿åç»­è¿›è¡Œfilteræ¥ç­›é€‰ã€‚</td></tr><tr><td>RUN</td><td>åœ¨æ„å»ºè¿‡ç¨‹ä¸­åœ¨é•œåƒä¸­æ‰§è¡Œå‘½ä»¤ã€‚</td></tr><tr><td>CMD</td><td>æŒ‡å®šå®¹å™¨åˆ›å»ºæ—¶çš„é»˜è®¤å‘½ä»¤ã€‚ï¼ˆå¯ä»¥è¢«è¦†ç›–ï¼‰</td></tr><tr><td>ENTRYPOINT</td><td>è®¾ç½®å®¹å™¨åˆ›å»ºæ—¶çš„ä¸»è¦å‘½ä»¤ã€‚ï¼ˆä¸å¯è¢«è¦†ç›–ï¼‰ï¼Œ</td></tr><tr><td>EXPOSE</td><td>å£°æ˜å®¹å™¨è¿è¡Œæ—¶ç›‘å¬çš„ç‰¹å®šç½‘ç»œç«¯å£ï¼Œä¸ä¼šè‡ªåŠ¨æ˜ å°„ï¼Œåªæ˜¯å£°æ˜ï¼Œéœ€è¦è‡ªå·±é…ç½®</td></tr><tr><td>ENV</td><td>åœ¨å®¹å™¨å†…éƒ¨è®¾ç½®ç¯å¢ƒå˜é‡ã€‚</td></tr><tr><td>ADD</td><td>å°†æ–‡ä»¶ã€ç›®å½•æˆ–è¿œç¨‹URLå¤åˆ¶åˆ°é•œåƒï¼Œè‡ªåŠ¨è§£å‹</td></tr><tr><td>COPY</td><td>å°†æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ°é•œåƒä¸­ã€‚</td></tr><tr><td>VOLUME</td><td>ä¸ºå®¹å™¨åˆ›å»ºæŒ‚è½½ç‚¹æˆ–å£°æ˜å·ã€‚</td></tr><tr><td>WORKDIR</td><td>è®¾ç½®åç»­æŒ‡ä»¤çš„å·¥ä½œç›®å½•ã€‚</td></tr><tr><td>USER</td><td>æŒ‡å®šåç»­æŒ‡ä»¤çš„ç”¨æˆ·ä¸Šä¸‹æ–‡ã€‚</td></tr><tr><td>ARG</td><td>å®šä¹‰åœ¨æ„å»ºè¿‡ç¨‹ä¸­ä¼ é€’ç»™æ„å»ºå™¨çš„å˜é‡ï¼Œå¯ä½¿ç”¨ â€œdocker buildâ€ å‘½ä»¤è®¾ç½®ã€‚</td></tr><tr><td>ONBUILD</td><td>å½“è¯¥é•œåƒè¢«ç”¨ä½œå¦ä¸€ä¸ªæ„å»ºè¿‡ç¨‹çš„åŸºç¡€æ—¶ï¼Œæ·»åŠ è§¦å‘å™¨ã€‚</td></tr><tr><td>STOPSIGNAL</td><td>è®¾ç½®å‘é€ç»™å®¹å™¨ä»¥é€€å‡ºçš„ç³»ç»Ÿè°ƒç”¨ä¿¡å·ã€‚</td></tr><tr><td>HEALTHCHECK</td><td>å®šä¹‰å‘¨æœŸæ€§æ£€æŸ¥å®¹å™¨å¥åº·çŠ¶æ€çš„å‘½ä»¤</td></tr><tr><td>SHELL</td><td>è¦†ç›–Dockerä¸­é»˜è®¤çš„shellï¼Œç”¨äºRUNã€CMDå’ŒENTRYPOINTæŒ‡ä»¤ã€‚</td></tr><tr><td>RUN</td><td>è¿è¡ŒæŒ‡å®šå‘½ä»¤</td></tr><tr><td>CMD</td><td>å¯åŠ¨å®¹å™¨æ—¶æŒ‡å®šé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤</td></tr><tr><td>ADD</td><td>æ·»åŠ å†…å®¹åˆ°é•œåƒ</td></tr><tr><td>COPY</td><td>å¤åˆ¶å†…å®¹åˆ°é•œåƒ</td></tr></tbody></table><h3 id="å®é™…æ“ä½œ"><a href="#å®é™…æ“ä½œ" class="headerlink" title="å®é™…æ“ä½œ"></a>å®é™…æ“ä½œ</h3><p>æ¨èä½¿ç”¨åŸºç¡€é•œåƒï¼š<br>BusyBox é›†æˆLinuxçš„å‘½ä»¤<br>Alpine  åœ¨BusyBoxåŸºç¡€ä¸Šå‡å°ä½“ç§¯å’Œæ¶ˆè€—ï¼Œå¹¶æä¾›äº†aptç®¡ç†å·¥å…·</p><ul><li>ä½¿ç”¨dockerfileä¸ºé•œåƒæ·»åŠ sshæœåŠ¡<pre class="line-numbers language-css" data-language="css"><code class="language-css">#è®¾ç½®ç»§æ‰¿é•œåƒFROM myub#æä¾›ä½œè€…ä¿¡æ¯MAINTAINER docker_user <span class="token punctuation">(</span>user@docker.com<span class="token punctuation">)</span>#æ‰§è¡Œå‘½ä»¤RUN apt-get updateRUN apt-get install -y openssh-serverRUN mkdir -p /var/run/sshdRUN mkdir -p /root/.sshRUN sed -ri <span class="token string">'s/session required pam_loginid.so/#session required pam_loginuid.so/g'</span> /etc/pam.d/sshd#å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°å¯¹åº”ä½ç½®ï¼Œå¹¶èµ‹äºˆå…¶å¯æ‰§è¡Œæƒé™ADD authorized_keys /root/.ssh/authorized_eysADD run.sh /run.shRUN chmod 755 /run.sh#å¼€æ”¾ç«¯å£EXPOSE 22#è®¾ç½®è‡ªå¯åŠ¨å‘½ä»¤CMD [<span class="token string">"/run.sh"</span>]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>FROM scratch</p><p>å¦‚æœä½ ä»¥ <code>scratch</code> ä¸ºåŸºç¡€é•œåƒçš„è¯ï¼Œæ„å‘³ç€ä½ ä¸ä»¥ä»»ä½•é•œåƒä¸ºåŸºç¡€ï¼Œæ¥ä¸‹æ¥æ‰€å†™çš„æŒ‡ä»¤å°†ä½œä¸ºé•œåƒç¬¬ä¸€å±‚å¼€å§‹å­˜åœ¨ã€‚</p><p>ä¸ä»¥ä»»ä½•ç³»ç»Ÿä¸ºåŸºç¡€ï¼Œç›´æ¥å°†å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶è¿›é•œåƒçš„åšæ³•å¹¶ä¸ç½•è§ï¼Œå¯¹äº Linux ä¸‹é™æ€ç¼–è¯‘çš„ç¨‹åºæ¥è¯´ï¼Œå¹¶ä¸éœ€è¦æœ‰æ“ä½œç³»ç»Ÿæä¾›è¿è¡Œæ—¶æ”¯æŒï¼Œæ‰€éœ€çš„ä¸€åˆ‡åº“éƒ½å·²ç»åœ¨å¯æ‰§è¡Œæ–‡ä»¶é‡Œäº†ï¼Œå› æ­¤ç›´æ¥ <code>FROM scratch</code> ä¼šè®©é•œåƒä½“ç§¯æ›´åŠ å°å·§ã€‚ä½¿ç”¨ <a href="https://golang.google.cn/">Go è¯­è¨€</a> å¼€å‘çš„åº”ç”¨å¾ˆå¤šä¼šä½¿ç”¨è¿™ç§æ–¹å¼æ¥åˆ¶ä½œé•œåƒï¼Œè¿™ä¹Ÿæ˜¯æœ‰äººè®¤ä¸º Go æ˜¯ç‰¹åˆ«é€‚åˆå®¹å™¨å¾®æœåŠ¡æ¶æ„çš„è¯­è¨€çš„åŸå› ä¹‹ä¸€ã€‚</p><p>æ¯ä¸€ä¸ªRUNä¼šå»ºç«‹ä¸€å±‚ï¼Œæ‰€ä»¥è¦è¿›è¡Œå¤šé‡æ“ä½œçš„æ—¶å€™ä¸è¦æ¯ä¸€è¡Œéƒ½å»ºç«‹ä¸€ä¸ªRUNè€Œæ˜¯å°†ä»–ä»¬åˆåœ¨ä¸€å±‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM debian:stretchRUN <span class="token builtin class-name">set</span> -x<span class="token punctuation">;</span> <span class="token assign-left variable">buildDeps</span><span class="token operator">=</span><span class="token string">'gcc libc6-dev make wget'</span> <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> update <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token variable">$buildDeps</span> <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> <span class="token parameter variable">-O</span> redis.tar.gz <span class="token string">"http://download.redis.io/releases/redis-5.0.3.tar.gz"</span> <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/src/redis <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">tar</span> <span class="token parameter variable">-xzf</span> redis.tar.gz <span class="token parameter variable">-C</span> /usr/src/redis --strip-components<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token parameter variable">-C</span> /usr/src/redis <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token parameter variable">-C</span> /usr/src/redis <span class="token function">install</span> <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/apt/lists/* <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> redis.tar.gz <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> <span class="token parameter variable">-r</span> /usr/src/redis <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> purge <span class="token parameter variable">-y</span> --auto-remove <span class="token variable">$buildDeps</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>docker ä¸æ˜¯è™šæ‹Ÿæœºä¸å­˜åœ¨åå°è¿è¡Œï¼Œå…¶ä¸­çš„æ‰€æœ‰åº”ç”¨éƒ½æ˜¯åœ¨å‰å°è¿è¡Œçš„ï¼Œæ‰€ä»¥dockerfile ä¸­ç›´æ¥æ‰§è¡Œè¿™ä¸ªåº”ç”¨å³å¯ï¼Œç„¶åé€€å‡ºå®¹å™¨ï¼Œè®©å®¹å™¨åœ¨åå°è¿è¡Œå³å¯</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">"nginx"</span>, <span class="token string">"-g"</span>, <span class="token string">"daemon off;"</span>]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ˜¯å› ä¸ºå½“å­˜åœ¨ <code>ENTRYPOINT</code> åï¼Œ<code>CMD</code> çš„å†…å®¹å°†ä¼šä½œä¸ºå‚æ•°ä¼ ç»™ <code>ENTRYPOINT</code>ï¼Œè€Œè¿™é‡Œ <code>-i</code> å°±æ˜¯æ–°çš„ <code>CMD</code>ï¼Œå› æ­¤ä¼šä½œä¸ºå‚æ•°ä¼ ç»™ <code>curl</code>ï¼Œä»è€Œè¾¾åˆ°äº†æˆ‘ä»¬é¢„æœŸçš„æ•ˆæœã€‚</p></li><li><p>ENV è®¾ç½®</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">ENV</span> key1=value1 key2=value2 .....</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>ARG è®¾ç½®å˜é‡ ç­‰äº <code>docker build</code> ä¸­ç”¨ <code>--build-arg &lt;å‚æ•°å&gt;=&lt;å€¼&gt;</code></p></li><li><p>ARG æŒ‡ä»¤æœ‰ç”Ÿæ•ˆèŒƒå›´ï¼Œå¦‚æœåœ¨ <code>FROM</code> æŒ‡ä»¤ä¹‹å‰æŒ‡å®šï¼Œé‚£ä¹ˆåªèƒ½ç”¨äº <code>FROM</code> æŒ‡ä»¤ä¸­ã€‚</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token comment"># åªåœ¨ FROM ä¸­ç”Ÿæ•ˆ</span><span class="token instruction"><span class="token keyword">ARG</span> DOCKER_USERNAME=library</span><span class="token instruction"><span class="token keyword">FROM</span> <span class="token variable">${DOCKER_USERNAME}</span>/alpine</span><span class="token comment"># è¦æƒ³åœ¨ FROM ä¹‹åä½¿ç”¨ï¼Œå¿…é¡»å†æ¬¡æŒ‡å®š</span><span class="token instruction"><span class="token keyword">ARG</span> DOCKER_USERNAME=library</span><span class="token instruction"><span class="token keyword">RUN</span> set -x ; echo <span class="token variable">${DOCKER_USERNAME}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>HEALTHCHECK</p></li><li><p><code>--interval=&lt;é—´éš”&gt;</code>ï¼šä¸¤æ¬¡å¥åº·æ£€æŸ¥çš„é—´éš”ï¼Œé»˜è®¤ä¸º 30 ç§’ï¼›</p></li><li><p><code>--timeout=&lt;æ—¶é•¿&gt;</code>ï¼šå¥åº·æ£€æŸ¥å‘½ä»¤è¿è¡Œè¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œæœ¬æ¬¡å¥åº·æ£€æŸ¥å°±è¢«è§†ä¸ºå¤±è´¥ï¼Œé»˜è®¤ 30 ç§’ï¼›</p></li><li><p><code>--retries=&lt;æ¬¡æ•°&gt;</code>ï¼šå½“è¿ç»­å¤±è´¥æŒ‡å®šæ¬¡æ•°åï¼Œåˆ™å°†å®¹å™¨çŠ¶æ€è§†ä¸º <code>unhealthy</code>ï¼Œé»˜è®¤ 3 æ¬¡ã€‚</p></li></ul><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> nginx</span><span class="token instruction"><span class="token keyword">RUN</span> apt-get update &amp;&amp; apt-get install -y curl &amp;&amp; rm -rf /var/lib/apt/lists/*</span><span class="token instruction"><span class="token keyword">HEALTHCHECK</span> <span class="token options"><span class="token property">--interval</span><span class="token punctuation">=</span><span class="token string">5s</span> <span class="token property">--timeout</span><span class="token punctuation">=</span><span class="token string">3s</span></span> <span class="token operator">\</span>  <span class="token keyword">CMD</span> curl -fs http://localhost/ || exit 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¤šé˜¶æ®µæ„é€ é•œåƒ<ol><li>å¤šä¸ªFROM å’Œ æ„é€ è¿‡ç¨‹å†™åœ¨ä¸€ä¸ªdockerfile ä¸­</li><li>ä½¿ç”¨as æ¥ä¸ºæŸä¸€é˜¶æ®µçš„æ„é€ å‘½å FROM golang:alpine as builderä¹‹åæ„é€ æ—¶ç›´æ¥æŒ‡å®šåå­—å³å¯, $ docker build â€“target builder -t username/imagename:tag .</li></ol></li><li>docker å¯¼å…¥å¯¼å‡ºå®¹å™¨<br>ç¤ºä¾‹ï¼š<pre class="line-numbers language-css" data-language="css"><code class="language-css">docker export 7691a814370e &gt; ubuntu.tarcat ubuntu.tar | docker import - test/<span class="token property">ubuntu</span><span class="token punctuation">:</span>v1.0 # å°†æ–‡ä»¶è¯»å…¥åˆ°æ ‡å‡†è¾“å…¥æµï¼Œå†å°†å…¶å¯¼å…¥åˆ°é•œåƒä¸­# æˆ–è€…ä½¿ç”¨URL æ¥å¯¼å…¥ä¹Ÿè¡Œ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="docker-æŸ¥çœ‹å®¹å™¨ip"><a href="#docker-æŸ¥çœ‹å®¹å™¨ip" class="headerlink" title="docker æŸ¥çœ‹å®¹å™¨ip"></a>docker æŸ¥çœ‹å®¹å™¨ip</h3><pre class="line-numbers language-none"><code class="language-none">docker inspect å®¹å™¨ID | grep IPAddress<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Nexus-å®¹å™¨"><a href="#Nexus-å®¹å™¨" class="headerlink" title="Nexus å®¹å™¨"></a>Nexus å®¹å™¨</h3><p>å¯ä»¥æ–¹ä¾¿è¿›è¡Œå¯¹Maven , Docker ,Yum,PyPIçš„ç®¡ç†</p><h1 id="Lua-ä¸€ç§å¯ä»¥åµŒå…¥ç¨‹åºçš„ç®€ä¾¿è¯­è¨€"><a href="#Lua-ä¸€ç§å¯ä»¥åµŒå…¥ç¨‹åºçš„ç®€ä¾¿è¯­è¨€" class="headerlink" title="Lua ä¸€ç§å¯ä»¥åµŒå…¥ç¨‹åºçš„ç®€ä¾¿è¯­è¨€"></a>Lua ä¸€ç§å¯ä»¥åµŒå…¥ç¨‹åºçš„ç®€ä¾¿è¯­è¨€</h1><p>ä¸€èˆ¬åªé€‚åˆåœ¨linuxä¸Šä½¿ç”¨<br>å®‰è£…ï¼š<br><code>apt-get install luaxxx(ç‰ˆæœ¬å·)</code><br>æ‰§è¡Œ<br><code>lua xxx.lua</code></p><h2 id="äº¤äº’å¼ç¼–ç¨‹"><a href="#äº¤äº’å¼ç¼–ç¨‹" class="headerlink" title="äº¤äº’å¼ç¼–ç¨‹"></a>äº¤äº’å¼ç¼–ç¨‹</h2><p>Lua æä¾›äº†äº¤äº’å¼ç¼–ç¨‹æ¨¡å¼ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ç¨‹åºå¹¶ç«‹å³æŸ¥çœ‹æ•ˆæœã€‚</p><p>Lua äº¤äº’å¼ç¼–ç¨‹æ¨¡å¼å¯ä»¥é€šè¿‡å‘½ä»¤&nbsp;<strong>lua -i</strong>&nbsp;æˆ–&nbsp;<strong>lua</strong>&nbsp;æ¥å¯ç”¨</p><ol><li>åŸºæœ¬è¯­æ³•<ul><li>æ³¨é‡Š â€“ å•è¡Œ  <code>--[[xxxx --]]</code> å¤šè¡Œæ³¨é‡Š</li><li>é»˜è®¤ä¸ºå…¨å±€å˜é‡ï¼Œå…¨å±€å˜é‡ä¸éœ€è¦å£°æ˜ï¼Œä¸éœ€è¦æ—¶ç½®ä¸ºnilå³å¯,å±€éƒ¨å˜é‡ä½¿ç”¨ local æ¥æŒ‡å®š</li><li>åŸºæœ¬æ•°æ®ç±»å‹: nil ,boolean , number(ä¸ºdoubleç±»å‹) , string ,userdata (ä»»æ„å­˜å‚¨åœ¨å˜é‡ä¸­çš„æ•°æ®ç»“æ„)</li><li>userdata æ˜¯ä¸€ç§ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ï¼Œç”¨äºè¡¨ç¤ºä¸€ç§ç”±åº”ç”¨ç¨‹åºæˆ– C/C++ è¯­è¨€åº“æ‰€åˆ›å»ºçš„ç±»å‹ã€‚ å¯ä»¥å°†ä»»æ„ C/C++ çš„ä»»æ„æ•°æ®ç±»å‹çš„æ•°æ®ï¼ˆé€šå¸¸æ˜¯ struct å’Œ æŒ‡é’ˆï¼‰å­˜å‚¨åˆ° Lua å˜é‡ä¸­è°ƒç”¨</li><li>function(ç”±C æˆ–Luaç¼–å†™çš„å‡½æ•°) , thread(çº¿ç¨‹), table(å…³è”æ•°ç»„)</li><li>ä½¿ç”¨<code>[[]]</code> æ¥è·¨è¶Šå¤šè¡Œèµ‹å€¼</li><li>Luaå¯ä»¥å¯¹å¤šä¸ªå˜é‡åŒæ—¶èµ‹å€¼ï¼Œå˜é‡åˆ—è¡¨å’Œå€¼åˆ—è¡¨çš„å„ä¸ªå…ƒç´ ç”¨é€—å·åˆ†å¼€ï¼Œèµ‹å€¼è¯­å¥å³è¾¹çš„å€¼ä¼šä¾æ¬¡èµ‹ç»™å·¦è¾¹çš„å˜é‡<pre class="line-numbers language-Lua" data-language="Lua"><code class="language-Lua">html = [[&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;    &lt;a href="https://www.twle.cn/"&gt;ç®€å•ç¼–ç¨‹&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;]]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ol><ul><li>luaä¼šå°è¯•å°†å­—ç¬¦æ•°å­—è½¬åŒ–ä¸ºæ•°å­—æ¥è¿›è¡Œæ•°å­—è®¡ç®—ï¼Œå­—ç¬¦ä¸²è¿æ¥ç¬¦æ˜¯ <code>..</code></li><li><h1 id="string-æ¥è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦"><a href="#string-æ¥è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦" class="headerlink" title="string æ¥è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦"></a>string æ¥è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦</h1></li><li><strong>é»˜è®¤ç´¢å¼•æ˜¯ä»1å¼€å§‹</strong></li><li>function å¯ä»¥ä»¥åŒ¿åå‡½æ•°ï¼ˆanonymous functionï¼‰çš„æ–¹å¼é€šè¿‡å‚æ•°ä¼ é€’<pre class="line-numbers language-lua" data-language="lua"><code class="language-lua"><span class="token comment">-- !/usr/bin/lua</span><span class="token comment">-- -*- encoding:utf-8 -*-</span><span class="token comment">-- filename: main.lua</span><span class="token comment">-- author: ç®€å•æ•™ç¨‹(www.twle.cn)</span><span class="token comment">-- Copyright Â© 2015-2065 www.twle.cn. All rights reserved.</span><span class="token keyword">function</span> <span class="token function">testFun</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span>fun<span class="token punctuation">)</span>    <span class="token keyword">for</span> k <span class="token punctuation">,</span>v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>tab<span class="token punctuation">)</span> <span class="token keyword">do</span>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">fun</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span>tab<span class="token operator">=</span><span class="token punctuation">{</span>key1<span class="token operator">=</span><span class="token string">"val1"</span><span class="token punctuation">,</span>key2<span class="token operator">=</span><span class="token string">"val2"</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">testFun</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>val<span class="token punctuation">)</span><span class="token comment">--åŒ¿åå‡½æ•°</span>    <span class="token keyword">return</span> key<span class="token operator">..</span><span class="token string">"="</span><span class="token operator">..</span>val<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>tableå˜é‡å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œkeyï¼Œæˆ–è€… . æ¥è·å–å€¼</li><li>æ³¨æ„ : Lua ä¸­ 0 ä¸º true</li><li><strong>å¤šè¿”å›å€¼</strong>Lua ä¸­çš„å‡½æ•°å¯ä»¥è¿”å›<strong>å¤šä¸ªç»“æœå€¼</strong>ï¼Œä¾‹å¦‚&nbsp;<strong>string.find</strong>&nbsp;è¿”å›åŒ¹é…ä¸² â€œå¼€å§‹å’Œç»“æŸçš„ä¸‹æ ‡â€ï¼ˆå¦‚æœä¸å­˜åœ¨åŒ¹é…ä¸²è¿”å› nil ï¼‰<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">&gt;</span> s, e <span class="token operator">=</span> string.find<span class="token punctuation">(</span><span class="token string">"www.twle.cn"</span>, <span class="token string">"twle"</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> print<span class="token punctuation">(</span>s, e<span class="token punctuation">)</span><span class="token number">5</span>   <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li>å¯å˜å‚æ•° ä½¿ç”¨ â€¦ æ¥ä»£è¡¨</li><li>ç®—æœ¯è¿ç®—ç¬¦ æœ‰ ^ å¹‚è¿ç®—å“¦ </li><li>ä¸ç­‰äºæ˜¯ -= ä¸æ˜¯ != </li><li>é€»è¾‘è¿ç®— and , or ,not</li><li><h1 id="è¿”å›å­—ç¬¦ä¸²ä¸ªæ•°æˆ–è€…ä¼ å…¥å‚æ•°ä¸ªæ•°"><a href="#è¿”å›å­—ç¬¦ä¸²ä¸ªæ•°æˆ–è€…ä¼ å…¥å‚æ•°ä¸ªæ•°" class="headerlink" title="è¿”å›å­—ç¬¦ä¸²ä¸ªæ•°æˆ–è€…ä¼ å…¥å‚æ•°ä¸ªæ•°.."></a>è¿”å›å­—ç¬¦ä¸²ä¸ªæ•°æˆ–è€…ä¼ å…¥å‚æ•°ä¸ªæ•°..</h1></li></ul><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>\a</td><td>å“é“ƒ(BEL)</td><td>007</td></tr><tr><td>\b</td><td>é€€æ ¼(BS) ï¼Œå°†å½“å‰ä½ç½®ç§»åˆ°å‰ä¸€åˆ—</td><td>008</td></tr><tr><td>\f</td><td>æ¢é¡µ(FF)ï¼Œå°†å½“å‰ä½ç½®ç§»åˆ°ä¸‹é¡µå¼€å¤´</td><td>012</td></tr><tr><td>\n</td><td>æ¢è¡Œ(LF) ï¼Œå°†å½“å‰ä½ç½®ç§»åˆ°ä¸‹ä¸€è¡Œå¼€å¤´</td><td>010</td></tr><tr><td>\r</td><td>å›è½¦(CR) ï¼Œå°†å½“å‰ä½ç½®ç§»åˆ°æœ¬è¡Œå¼€å¤´</td><td>013</td></tr><tr><td>\t</td><td>æ°´å¹³åˆ¶è¡¨(HT) ï¼ˆè·³åˆ°ä¸‹ä¸€ä¸ªTABä½ç½®ï¼‰</td><td>009</td></tr><tr><td>\v</td><td>å‚ç›´åˆ¶è¡¨(VT)</td><td>011</td></tr><tr><td>\</td><td>ä»£è¡¨ä¸€ä¸ªåæ–œçº¿å­—ç¬¦â€™â€™'</td><td>092</td></tr><tr><td>'</td><td>ä»£è¡¨ä¸€ä¸ªå•å¼•å·ï¼ˆæ’‡å·ï¼‰å­—ç¬¦</td><td>039</td></tr><tr><td>"</td><td>ä»£è¡¨ä¸€ä¸ªåŒå¼•å·å­—ç¬¦</td><td>034</td></tr><tr><td>\0</td><td>ç©ºå­—ç¬¦(NULL)</td><td>000</td></tr><tr><td>\ddd</td><td>1åˆ°3ä½å…«è¿›åˆ¶æ•°æ‰€ä»£è¡¨çš„ä»»æ„å­—ç¬¦</td><td>ä¸‰ä½å…«è¿›åˆ¶</td></tr><tr><td>\xhh</td><td>1åˆ°2ä½åå…­è¿›åˆ¶æ‰€ä»£è¡¨çš„ä»»æ„å­—ç¬¦</td><td>äºŒä½åå…­è¿›åˆ¶</td></tr></tbody></table><ul><li><p>å¸¸ç”¨å­—ç¬¦ä¸²æ–¹æ³• string + . +</p><ul><li>upper å¤§å†™ lower å°å†™</li><li>gsub(string , findstring , replacestring ,num) ä»stringä¸­æŸ¥æ‰¾findstring,å¹¶æ›¿æ¢ä¸ºreplacestring ï¼Œnumæ˜¯æ›¿æ¢çš„æ¬¡æ•°</li><li>find ()  è¿”å›é¦–æ¬¡å‡ºç°è¯¥å­—ç¬¦ä¸²çš„å‰åä½ç½®ï¼ŒåŒ…æ‹¬å¼€å§‹å’Œç»“æŸçš„ä½ç½®</li><li>reverse åè½¬</li><li>char(num1,num2â€¦) å°†æ•°å­—å˜ä¸ºå­—æ¯ï¼Œasciiç </li><li>byte(å­—æ¯ä¸²,æŒ‡å®šæŸä¸ªå­—ç¬¦) å°†å­—æ¯å˜ä¸ºæ•°å­—</li><li>len é•¿åº¦</li><li>rep(string,num) è¿”å›é‡å¤numæ¬¡çš„string</li><li>gmatch(string,pattern) è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¿”å›ä¸€ä¸ªç¬¦åˆpatternçš„å­—ä¸²ï¼Œå¯ä»¥ä½¿ç”¨ </li><li>format ()æ ¼å¼åŒ– <a href="https://www.twle.cn/l/yufei/lua53/lua-basic-strings-format.html">è½¬ä¹‰ç </a></li></ul></li><li><p>æ•°ç»„ luaçš„æ•°ç»„å¯ä»¥ä»è´Ÿæ•°å¼€å§‹éå†ç´¢å¼•ä»1å¼€å§‹</p><ul><li><code>for i= -1 , 10 do ...</code></li><li>è¿­ä»£å™¨: <pre class="line-numbers language-lua" data-language="lua"><code class="language-lua"><span class="token comment">-- pairsç”¨äºåŒ¹é…é”®å€¼å¯¹</span><span class="token keyword">local</span> myTable <span class="token operator">=</span> <span class="token punctuation">{</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>myTable<span class="token punctuation">)</span> <span class="token keyword">do</span>    <span class="token function">print</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token keyword">end</span><span class="token comment">--ispairs ç”¨äºéå†æ•°ç»„ï¼Œå­—ç¬¦ä¸²ç­‰</span><span class="token keyword">local</span> myArray <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token keyword">for</span> index<span class="token punctuation">,</span> value <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>myArray<span class="token punctuation">)</span> <span class="token keyword">do</span>    <span class="token function">print</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token keyword">end</span><span class="token comment">--è‡ªå®šä¹‰è¿­ä»£å™¨ï¼Œå®é™…å°±æ˜¯è‡ªå·±å†™çš„éå†ç®—æ³•ã€‚ã€‚</span><span class="token keyword">function</span> <span class="token function">myIterator</span><span class="token punctuation">(</span>collection<span class="token punctuation">)</span>    <span class="token keyword">local</span> index <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">local</span> size <span class="token operator">=</span> <span class="token operator">#</span>collection    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> index <span class="token operator">&lt;=</span> size <span class="token keyword">then</span>            <span class="token keyword">local</span> value <span class="token operator">=</span> collection<span class="token punctuation">[</span>index<span class="token punctuation">]</span>            index <span class="token operator">=</span> index <span class="token operator">+</span> <span class="token number">1</span>            <span class="token keyword">return</span> value        <span class="token keyword">end</span>    <span class="token keyword">end</span><span class="token keyword">end</span><span class="token keyword">local</span> myArray <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">}</span><span class="token keyword">local</span> iter <span class="token operator">=</span> <span class="token function">myIterator</span><span class="token punctuation">(</span>myArray<span class="token punctuation">)</span><span class="token keyword">for</span> value <span class="token keyword">in</span> iter <span class="token keyword">do</span>    <span class="token function">print</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>tableå¸¸ç”¨æ–¹æ³• table + . +</p><ul><li>concat æ˜¯ concatenate (è¿é”, è¿æ¥) çš„ç¼©å†™. table.concat() å‡½æ•°åˆ—å‡ºå‚æ•°ä¸­æŒ‡å®š table çš„æ•°ç»„éƒ¨åˆ†ä» start ä½ç½®åˆ° end ä½ç½®çš„æ‰€æœ‰å…ƒç´ , å…ƒç´ é—´ä»¥æŒ‡å®šçš„åˆ†éš”ç¬¦(sep)éš”å¼€</li><li>insert(table,pos,value) åœ¨æŒ‡å®šä½ç½®æ·»åŠ ä¸€ä¸ªvalue ,å¦‚æœæœªæŒ‡å®šä½ç½®ï¼Œé»˜è®¤ä»å°¾éƒ¨åŠ å…¥</li><li>remove(table,post) è¿”å›å¹¶ç§»é™¤table ä½äºposä½ç½®çš„å…ƒç´ ï¼Œåé¢çš„å…ƒç´ ä¼šè‡ªåŠ¨å‘å‰</li><li>sort è¿›è¡Œå‡åºæ’åº</li></ul></li><li><p>luaçš„æ¨¡å¼åŒ¹é…<br><a href="https://tool.oschina.net/uploads/apidocs/jquery/regexp.html">å¼€æºä¸­å›½ä¸­æ­£åˆ™è¡¨è¾¾å¼åˆ—è¡¨</a><br><a href="https://www.twle.cn/l/yufei/lua53/lua-basic-strings-match.html">luaæ¨¡å¼åŒ¹é…</a></p></li><li><p>% ç”¨äºå°†åé¢çš„å­—ç¬¦è½¬ä¹‰ä¸ºå­—é¢é‡è€Œä¸æ˜¯ç‰¹æ®Šå­—ç¬¦ï¼Œä¾‹å¦‚</p></li><li><p>%ã€‚ åŒ¹é…çš„æ˜¯ã€‚è€Œä¸æ˜¯å…¶ä»–çš„</p></li><li><p>æœ‰æ—¶ä¹Ÿä¼šæœ‰ç‰¹æ®Šå«ä¹‰: %a ä»£è¡¨çš„æ˜¯åŒ¹é…ä¸€ä¸ªå­—æ¯ï¼Œ%d ä»£è¡¨åŒ¹é…ä¸€ä¸ªæ•°å­—</p></li><li><p>å­—ç¬¦ç±» %d åŒ¹é…ä»»æ„æ•°å­—ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨æ¨¡å¼ä¸² â€˜%d%d/%d%d/%d%d%d%dâ€™ æœç´¢ dd/mm/yyyy æ ¼å¼</p></li><li><p>æ¨¡å—å’Œå¯¼åŒ…</p></li><li><p>å¯¼åŒ…require(æ¨¡å—å)ï¼Œç”šè‡³å¯ä»¥åŠ ä¸ª.varèµ‹ç»™ä¸€ä¸ªå˜é‡æ¥è°ƒç”¨æ¨¡å—</p></li><li><p>å…ƒè¡¨ï¼Ÿ</p></li><li><p>åç¨‹</p></li><li><p><a href="https://www.twle.cn/l/yufei/lua53/lua-basic-file-io.html">æ–‡ä»¶</a></p></li></ul><h1 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h1><p>ä¸€ç§é«˜æ€§èƒ½çš„ HTTP å’Œ&nbsp;åå‘ä»£ç†çš„æœåŠ¡å™¨ï¼Œ<strong>é»˜è®¤ç›‘å¬ç«¯å£æ˜¯80</strong>ä¸æ˜¯8080</p><ul><li>åŸºæœ¬å‘½ä»¤<pre class="line-numbers language-css" data-language="css"><code class="language-css">nginx å¯åŠ¨nginx -s quit ä¼˜é›…çš„é€€å‡ºï¼Œå®Œæˆæ‰€æœ‰ä»»åŠ¡åé€€å‡ºnginx -s stop å¼ºåˆ¶é€€å‡ºnginx -s reload é‡å¯ï¼Œæ¥åˆ·æ–°é…ç½®æ–‡ä»¶nginx -t æµ‹è¯•é…ç½®æ–‡ä»¶æ˜¯å¦å¯ç”¨ï¼ŒåŒæ—¶ä¼šæ˜¾ç¤ºé…ç½®æ–‡ä»¶çš„è·¯å¾„<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><strong>é…ç½®æ–‡ä»¶</strong><br>é…ç½®æ–‡ä»¶åˆ†ä¸ºä¸‰ç±»</li></ul><ol><li>å…¨å±€å—,æœåŠ¡å™¨é…ç½®ï¼Œæ—¥å¿—å­˜æ”¾ç­‰</li><li>events ä¸»è¦å½±å“æœåŠ¡å™¨å’Œç”¨æˆ·çš„ç½‘ç»œè¿æ¥</li><li>http å¯ä»¥åˆ†å¾ˆå¤šå—<ul><li><p>serverå—  å…¨å±€å— æœ¬æœºç›‘å¬é…ç½®å’Œipé…ç½®</p></li><li><p>location å±€éƒ¨å—  æ§åˆ¶åœ°å€å®šå‘ï¼Œè½¬å‘ç­‰ ï¼Œ åœ¨serverå—å†…æ¥åŒ¹é…æ–°çš„è½¬å‘è·¯å¾„</p></li></ul></li></ol><p>ç”¨æ³•ä¸€ï¼šåå‘ä»£ç†ï¼Œä½œä¸ºå¦ä¸€ä¸ªæœåŠ¡å™¨çš„è½¬å‘æœåŠ¡å™¨æ¥éšè—å¦ä¸€ä¸ªæœåŠ¡å™¨<br>ä½¿ç”¨docker å¯åŠ¨ä¸€ä¸ªtomcatæœåŠ¡å™¨ï¼Œå¹¶è¿›å…¥å¹¶å¯åŠ¨æœåŠ¡</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">docker run -itd tomcat /bin/shè¿›å…¥tomcat/binç›®å½•./startup.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>é”™è¯¯æƒ…å†µï¼š</p><p>docker tomcatæ— æ³•å¯åŠ¨</p><ol><li>å¯èƒ½æ²¡æœ‰æ˜ å°„ç«¯å£æˆ–è€…æ²¡æœ‰å…³é—­é˜²ç«å¢™</li><li>æŠŠwebapps.distç›®å½•æ¢æˆwebapps</li><li>å°†æ–‡ä»¶æ‰”åˆ°webappså³å¯</li></ol><p>æµ‹è¯•ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œè§£å†³é—®é¢˜ï¼</p><p>è¿›å…¥å®¹å™¨å†…éƒ¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">docker exec <span class="token operator">-</span>it mytomcat <span class="token operator">/</span>bin<span class="token operator">/</span>bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¤åˆ¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">rm <span class="token operator">-</span>rf webappsmv webapps<span class="token punctuation">.</span>dist webapps<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¤åˆ¶</p><p>é‡å¯tomcat</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">docker restart mytomcat<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹dockerçš„tomcat ip<br><code>docker inspect ID | grep IPAddress</code><br>é…ç½®æ–‡ä»¶:</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">server</span> <span class="token punctuation">{</span>    listen       8888 <span class="token punctuation">;</span> ##è®¾ç½®æˆ‘ä»¬nginxç›‘å¬ç«¯å£ä¸º8888    server_name  [æœåŠ¡å™¨çš„ipåœ°å€]<span class="token punctuation">;</span> # ä¸å¸¦http    # Load configuration files for the default server block.    include /etc/nginx/default.d/*.conf<span class="token punctuation">;</span>    <span class="token selector">location /</span> <span class="token punctuation">{</span>        proxy_pass <span class="token property">http</span><span class="token punctuation">:</span>//<span class="token property">tomcatæœåŠ¡å™¨ip</span><span class="token punctuation">:</span>8080<span class="token punctuation">;</span> ##éœ€è¦ä»£ç†çš„æœåŠ¡å™¨åœ°å€        index index.html<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    error_page 404 /404.html<span class="token punctuation">;</span>        <span class="token selector">location = /40x.html</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    error_page 500 502 503 504 /50x.html<span class="token punctuation">;</span>        <span class="token selector">location = /50x.html</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰“å¼€æµè§ˆå™¨è¾“å…¥æœåŠ¡å™¨çš„ipå’Œä»£ç†ç«¯å£ï¼Œå°±å¯ä»¥çœ‹åˆ°dockerå®¹å™¨ä¸­tomcatçš„ä¸»ç•Œé¢</p><ul><li><p>å®ç°æœåŠ¡å™¨åˆ†å‘<br>é…ç½®</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">server</span> <span class="token punctuation">{</span>    listen       8888 <span class="token punctuation">;</span> ##è®¾ç½®æˆ‘ä»¬nginxç›‘å¬ç«¯å£ä¸º8888    server_name  [æœåŠ¡å™¨çš„ipåœ°å€]<span class="token punctuation">;</span>    # Load configuration files for the default server block.    include /etc/nginx/default.d/*.conf<span class="token punctuation">;</span>    <span class="token selector">location /hi/</span> <span class="token punctuation">{</span>        proxy_pass <span class="token property">http</span><span class="token punctuation">:</span>//æœåŠ¡å™¨2<span class="token punctuation">;</span> ##éœ€è¦ä»£ç†çš„æœåŠ¡å™¨åœ°å€        index index.html<span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token selector">location /hello/</span> <span class="token punctuation">{</span>        proxy_pass <span class="token property">http</span><span class="token punctuation">:</span>//æœåŠ¡å™¨2<span class="token punctuation">;</span> ##éœ€è¦ä»£ç†çš„æœåŠ¡å™¨åœ°å€        index index.html<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    error_page 404 /404.html<span class="token punctuation">;</span>        <span class="token selector">location = /40x.html</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    error_page 500 502 503 504 /50x.html<span class="token punctuation">;</span>        <span class="token selector">location = /50x.html</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><a href="https://segmentfault.com/a/1190000022315733">location åŒ¹é…</a></p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">location [ = | ~ | ~* | ^~ ] /URI</span> <span class="token punctuation">{</span> â€¦ <span class="token punctuation">}</span><span class="token selector">location @/name/</span> <span class="token punctuation">{</span> â€¦ <span class="token punctuation">}</span>########### é¡ºåº1. location =    # ç²¾å‡†åŒ¹é…2. location ^~   # å¸¦å‚å‰ç¼€åŒ¹é…3. location ~    # æ­£åˆ™åŒ¹é…ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰4. location ~*   # æ­£åˆ™åŒ¹é…ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰5. location /a   # æ™®é€šå‰ç¼€åŒ¹é…ï¼Œä¼˜å…ˆçº§ä½äºå¸¦å‚æ•°å‰ç¼€åŒ¹é…ã€‚6. location /    # ä»»ä½•æ²¡æœ‰åŒ¹é…æˆåŠŸçš„ï¼Œéƒ½ä¼šåŒ¹é…è¿™é‡Œå¤„ç†<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th>å‚æ•°</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td><strong><code>ç©º</code></strong></td><td>location åæ²¡æœ‰å‚æ•°ç›´æ¥è·Ÿç€&nbsp;<strong>æ ‡å‡† URI</strong>ï¼Œè¡¨ç¤ºå‰ç¼€åŒ¹é…ï¼Œä»£è¡¨è·Ÿè¯·æ±‚ä¸­çš„ URI ä»å¤´å¼€å§‹åŒ¹é…ã€‚</td></tr><tr><td><strong><code>=</code></strong></td><td>ç”¨äº<strong>æ ‡å‡† URI</strong>&nbsp;å‰ï¼Œè¦æ±‚è¯·æ±‚å­—ç¬¦ä¸²ä¸å…¶ç²¾å‡†åŒ¹é…ï¼ŒæˆåŠŸåˆ™ç«‹å³å¤„ç†ï¼Œnginxåœæ­¢æœç´¢å…¶ä»–åŒ¹é…ã€‚</td></tr><tr><td><strong><code>^~</code></strong></td><td>ç”¨äº<strong>æ ‡å‡† URI</strong>&nbsp;å‰ï¼Œå¹¶è¦æ±‚ä¸€æ—¦åŒ¹é…åˆ°å°±ä¼šç«‹å³å¤„ç†ï¼Œä¸å†å»åŒ¹é…å…¶ä»–çš„é‚£äº›ä¸ªæ­£åˆ™ URIï¼Œä¸€èˆ¬ç”¨æ¥åŒ¹é…ç›®å½•</td></tr><tr><td><strong><code>~</code></strong></td><td>ç”¨äº<strong>æ­£åˆ™ URI</strong>&nbsp;å‰ï¼Œè¡¨ç¤º URI åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œ&nbsp;<strong>åŒºåˆ†</strong>å¤§å°å†™</td></tr><tr><td><strong><code>~*</code></strong></td><td>ç”¨äº<strong>æ­£åˆ™ URI</strong>&nbsp;å‰ï¼Œ è¡¨ç¤º URI åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œ&nbsp;<strong>ä¸åŒºåˆ†</strong>å¤§å°å†™</td></tr><tr><td><strong><code>@</code></strong></td><td>@ å®šä¹‰ä¸€ä¸ªå‘½åçš„ locationï¼Œ@ å®šä¹‰çš„locaitonåå­—ä¸€èˆ¬ç”¨åœ¨å†…éƒ¨å®šå‘ï¼Œä¾‹å¦‚error_page, try_fileså‘½ä»¤ä¸­ã€‚å®ƒçš„åŠŸèƒ½ç±»ä¼¼äºç¼–ç¨‹ä¸­çš„gotoã€‚</td></tr></tbody></table></li><li><p>é¡ºåº</p></li></ul><ol><li>å…ˆç²¾å‡†åŒ¹é…&nbsp;<strong><code>=</code></strong>&nbsp;ï¼Œç²¾å‡†åŒ¹é…æˆåŠŸåˆ™ä¼šç«‹å³åœæ­¢å…¶ä»–ç±»å‹åŒ¹é…ï¼›</li><li>æ²¡æœ‰ç²¾å‡†åŒ¹é…æˆåŠŸæ—¶ï¼Œè¿›è¡Œå‰ç¼€åŒ¹é…ã€‚å…ˆæŸ¥æ‰¾å¸¦æœ‰&nbsp;<strong><code>^~</code></strong>&nbsp;çš„å‰ç¼€åŒ¹é…ï¼Œå¸¦æœ‰&nbsp;<strong><code>^~</code></strong>&nbsp;çš„å‰ç¼€åŒ¹é…æˆåŠŸåˆ™ç«‹å³åœæ­¢å…¶ä»–ç±»å‹åŒ¹é…ï¼Œæ™®é€šå‰ç¼€åŒ¹é…ï¼ˆä¸å¸¦å‚æ•°&nbsp;<strong><code>^~</code></strong>&nbsp;ï¼‰æˆåŠŸåˆ™ä¼šæš‚å­˜ï¼Œç»§ç»­æŸ¥æ‰¾æ­£åˆ™åŒ¹é…ï¼›</li><li><strong><code>=</code></strong>&nbsp;å’Œ&nbsp;<strong><code>^~</code></strong>&nbsp;å‡æœªåŒ¹é…æˆåŠŸå‰æä¸‹ï¼ŒæŸ¥æ‰¾æ­£åˆ™åŒ¹é…&nbsp;<strong><code>~</code></strong>&nbsp;å’Œ&nbsp;<strong><code>~*</code></strong>&nbsp;ã€‚å½“åŒæ—¶æœ‰å¤šä¸ªæ­£åˆ™åŒ¹é…æ—¶ï¼ŒæŒ‰å…¶åœ¨é…ç½®æ–‡ä»¶ä¸­å‡ºç°çš„å…ˆåé¡ºåºä¼˜å…ˆåŒ¹é…ï¼Œå‘½ä¸­åˆ™ç«‹å³åœæ­¢å…¶ä»–ç±»å‹åŒ¹é…ï¼›</li><li>æ‰€æœ‰æ­£åˆ™åŒ¹é…å‡æœªæˆåŠŸæ—¶ï¼Œè¿”å›æ­¥éª¤ 2 ä¸­æš‚å­˜çš„æ™®é€šå‰ç¼€åŒ¹é…ï¼ˆä¸å¸¦å‚æ•°&nbsp;<strong><code>^~</code></strong>&nbsp;ï¼‰ç»“æœ</li></ol><ul><li>è´Ÿè½½å‡è¡¡<br>é…ç½®æ–‡ä»¶(serverå—)<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">http</span> <span class="token punctuation">{</span><span class="token selector">###æ­¤å¤„çœç•¥ä¸€å¤§å †æ²¡æœ‰æ”¹çš„é…ç½®    ##è‡ªå®šä¹‰æˆ‘ä»¬çš„æœåŠ¡åˆ—è¡¨    upstream myserver</span><span class="token punctuation">{</span>    #### å¯ä»¥ä½¿ç”¨ ip_hash æ¥è¿›è¡Œhash åˆ†é…ï¼Œå¯ä»¥ä¸weightä¸€èµ·ä½¿ç”¨   ip_hash<span class="token punctuation">;</span>       server æœåŠ¡å™¨1åŠç«¯å£<span class="token punctuation">;</span> # å¯åŠ æƒå€¼æ¥è¡¨ç¤ºä¼˜å…ˆçº§ï¼Œserver æœåŠ¡å™¨1åŠç«¯å£ + weight = æ•°å­—<span class="token punctuation">;</span> æ•°å­—è¶Šå¤§ï¼Œæƒé‡è¶Šé«˜       server æœåŠ¡å™¨2åŠæ¥å£<span class="token punctuation">;</span>   â€¦â€¦     <span class="token punctuation">}</span>   <span class="token selector">server</span> <span class="token punctuation">{</span>       listen       8888 <span class="token punctuation">;</span> ##è®¾ç½®æˆ‘ä»¬nginxç›‘å¬ç«¯å£ä¸º8888       server_name  [æœåŠ¡å™¨çš„ipåœ°å€]<span class="token punctuation">;</span>       # Load configuration files for the default server block.       include /etc/nginx/default.d/*.conf<span class="token punctuation">;</span>       <span class="token selector">location /</span> <span class="token punctuation">{</span>           proxy_pass <span class="token property">http</span><span class="token punctuation">:</span>//myserver<span class="token punctuation">;</span> ##å®ï¼Œæ ¸å¿ƒé…ç½®åœ¨è¿™é‡Œ           proxy_connect_timeout 10<span class="token punctuation">;</span> #è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’       <span class="token punctuation">}</span>       error_page 404 /404.html<span class="token punctuation">;</span>           <span class="token selector">location = /40x.html</span> <span class="token punctuation">{</span>       <span class="token punctuation">}</span>       error_page 500 502 503 504 /50x.html<span class="token punctuation">;</span>           <span class="token selector">location = /50x.html</span> <span class="token punctuation">{</span>       <span class="token punctuation">}</span>   <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å…³é—­ä¸€ä¸ªtomcatä¹‹åï¼Œå‘ç°ä»ç„¶å¯ä»¥è®¿é—®ï¼Œä½†å…³é—­æ‰€æœ‰çš„tomcatæ—¶å‘ç°æ— æ³•è®¿é—®äº†ï¼Œè¯´æ˜å®ç°äº†è´Ÿè½½å‡è¡¡</li></ul><h1 id="LinuxåŸºæœ¬æ“ä½œ"><a href="#LinuxåŸºæœ¬æ“ä½œ" class="headerlink" title="LinuxåŸºæœ¬æ“ä½œ"></a>LinuxåŸºæœ¬æ“ä½œ</h1><h2 id="å¸¸ç”¨æ“ä½œï¼š"><a href="#å¸¸ç”¨æ“ä½œï¼š" class="headerlink" title="å¸¸ç”¨æ“ä½œï¼š"></a>å¸¸ç”¨æ“ä½œï¼š</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">lsof</span> <span class="token parameter variable">-i:9999</span> æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µtop/htop æŸ¥çœ‹ç³»ç»Ÿèµ„æºå ç”¨æƒ…å†µ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="Bashç•Œé¢"><a href="#Bashç•Œé¢" class="headerlink" title="Bashç•Œé¢"></a>Bashç•Œé¢</h2><p>å¿«æ·é”®</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">Ctl-U   åˆ é™¤å…‰æ ‡åˆ°è¡Œé¦–çš„æ‰€æœ‰å­—ç¬¦<span class="token punctuation">,</span>åœ¨æŸäº›è®¾ç½®ä¸‹<span class="token punctuation">,</span>åˆ é™¤å…¨è¡ŒCtl-W   åˆ é™¤å½“å‰å…‰æ ‡åˆ°å‰è¾¹çš„æœ€è¿‘ä¸€ä¸ªç©ºæ ¼ä¹‹é—´çš„å­—ç¬¦Ctl-H   backspace<span class="token punctuation">,</span>åˆ é™¤å…‰æ ‡å‰è¾¹çš„å­—ç¬¦Ctl-R   åŒ¹é…æœ€ç›¸è¿‘çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åè¾“å‡º<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç”¨æˆ·æ“ä½œ"><a href="#ç”¨æˆ·æ“ä½œ" class="headerlink" title="ç”¨æˆ·æ“ä½œ"></a>ç”¨æˆ·æ“ä½œ</h2><pre class="line-numbers language-css" data-language="css"><code class="language-css">useradd -m username åˆ›å»ºç”¨æˆ·ï¼Œ-mæ˜¯ä¼šåˆ›å»ºå¯¹åº”çš„ç”¨æˆ·ç›®å½•åˆ°/homeä¸‹ï¼Œä¸åŠ çš„è¯ä¸ä¼šåˆ›å»ºè¿™ä¸ªç›®å½•ï¼Œ-d å‚æ•°ç”¨æ¥æŒ‡å®šç”¨æˆ·ç›®å½•çš„ä½ç½®userdel -r ç›´æ¥æŠŠç”¨æˆ·ç›®å½•åˆ æ‰äº†ä¸åŠ rå°±ä¸åˆ é™¤ç›®å½•who am i çœ‹å½“å‰è´¦å·æ˜¯ä»€ä¹ˆgroupadd åˆ›å»ºä¸€ä¸ªç”¨æˆ·ç»„useradd -g ç”¨æˆ·ç»„ ç”¨æˆ·å   æŠŠè¿™ä¸ªç”¨æˆ·åŠ å…¥åˆ°ç”¨æˆ·ç»„usermod -g ç”¨æˆ·ç»„ ç”¨æˆ·å  ä¿®æ”¹usermod -d ç›®å½•å ç”¨æˆ·å æ”¹å˜è¯¥ç”¨æˆ·ç™»å½•çš„åˆå§‹ç›®å½•<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä»–æŒ‡ä»¤</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">mkdir -p åˆ›å»ºå¤šçº§ç›®å½•cp -r é€’å½’çš„å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å¤¹cat -n æ˜¾ç¤ºè¡Œhead -n æ•°å­— é»˜è®¤çœ‹å‰10è¡Œ ï¼Œ åŠ ä¸Š-n ä¹‹åå¯ä»¥æŒ‡å®šæŸ¥çœ‹å¤šå°‘è¡Œtial -n æ•°å­— æŸ¥çœ‹æœ€åå‡ è¡Œ tail -f å®æ—¶è¿½è¸ªè¯¥æ–‡ä»¶çš„æ‰€æœ‰æ›´æ–°&gt; å°†å†…å®¹è¦†ç›–åœ¨æ–‡ä»¶ä¸­&gt;&gt; åœ¨åé¢è¿½åŠ ln -s æ–‡ä»¶ é“¾æ¥çš„åœ°æ–¹ history ! + history ä¸­çš„æŒ‡ä»¤ç¼–å·ï¼Œé‡æ–°æ‰§è¡Œè¿™æ¡æŒ‡ä»¤datecal æ—¥å†find è·¯å¾„ -name åŒ¹é…æ–‡ä»¶å-user å±äºæŸä¸ªç”¨æˆ·çš„-size +n /-n /n åŒ¹é…æ–‡ä»¶å¤§å° + ä»£è¡¨å¤§äºï¼Œ-ä»£è¡¨å°äºï¼Œä¸åŠ ä»£è¡¨ç­‰äº å¯åŠ å•ä½ K/M/Glocate é€šè¿‡è‡ªå»ºçš„æ•°æ®åº“æ¥è¿›è¡ŒæŸ¥æ‰¾ï¼Œé€Ÿåº¦è¿…é€Ÿï¼Œä½†æ˜¯éœ€è¦è‡ªå·±æ›´æ–°æ•°æ®åº“é™åˆ¶æ€§updatedbgrep |grep + -n æ˜¾ç¤ºè¡Œå·/ -i å¿½ç•¥å­—æ¯å¤§å°å†™åŒ¹é… + è¦åŒ¹é…çš„å…³é”®å­—æƒé™1-9ä½ä¾æ¬¡æ˜¯ user group otherçš„æ­¦å®‰å¿chown  -R ç”¨æˆ· æ–‡ä»¶ æ”¹å˜æ‰€å± -Ræ¥æŠŠé‡Œé¢çš„æ–‡ä»¶ä¹Ÿæ‰§è¡Œè¿™ç§ä¿®æ”¹chgrp  ç»„å æ–‡ä»¶å æ”¹å˜æ‰€æœ‰ç»„<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä»»åŠ¡æŒ‰æ—¶è°ƒåº¦"><a href="#ä»»åŠ¡æŒ‰æ—¶è°ƒåº¦" class="headerlink" title="ä»»åŠ¡æŒ‰æ—¶è°ƒåº¦"></a>ä»»åŠ¡æŒ‰æ—¶è°ƒåº¦</h2><pre class="line-numbers language-css" data-language="css"><code class="language-css">crond -l æ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡crontab -e æ¥ç¼–è¾‘å†…å®¹è¯­æ³•ï¼š* * * * * /path/to/command ä¹Ÿå¯ä»¥ç›´æ¥å†™ä¸€è¡Œshellè„šæœ¬1. ç¬¬ä¸€ä¸ªæ˜Ÿå·ï¼šåˆ†é’Ÿï¼ˆ0-59ï¼‰2. ç¬¬äºŒä¸ªæ˜Ÿå·ï¼šå°æ—¶ï¼ˆ0-23ï¼‰3. ç¬¬ä¸‰ä¸ªæ˜Ÿå·ï¼šæ—¥æœŸï¼ˆ1-31ï¼‰4. ç¬¬å››ä¸ªæ˜Ÿå·ï¼šæœˆä»½ï¼ˆ1-12æˆ–ä½¿ç”¨ç¼©å†™ï¼Œå¦‚1ä»£è¡¨ä¸€æœˆï¼Œ2ä»£è¡¨äºŒæœˆï¼Œä»¥æ­¤ç±»æ¨ï¼‰5. ç¬¬äº”ä¸ªæ˜Ÿå·ï¼šæ˜ŸæœŸå‡ ï¼ˆ0-7æˆ–ä½¿ç”¨ç¼©å†™ï¼Œ0å’Œ7éƒ½ä»£è¡¨æ˜ŸæœŸæ—¥ï¼Œ1ä»£è¡¨æ˜ŸæœŸä¸€ï¼Œä»¥æ­¤ç±»æ¨ï¼‰ä½¿ç”¨è¿™äº›æ˜Ÿå·ï¼Œæ‚¨å¯ä»¥å®šä¹‰å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š- `* * * * *`ï¼šæ¯åˆ†é’Ÿéƒ½æ‰§è¡Œä»»åŠ¡ã€‚- `0 * * * *`ï¼šæ¯å°æ—¶çš„å¼€å§‹æ—¶æ‰§è¡Œä»»åŠ¡ã€‚- `0 0 * * *`ï¼šæ¯å¤©çš„åˆå¤œï¼ˆå‡Œæ™¨12ç‚¹ï¼‰æ‰§è¡Œä»»åŠ¡ã€‚- `0 0 1 * *`ï¼šæ¯ä¸ªæœˆçš„ç¬¬ä¸€å¤©ï¼ˆæ—¥æœŸ1ï¼‰çš„åˆå¤œæ‰§è¡Œä»»åŠ¡ã€‚- `0 0 * * 5`ï¼šæ¯ä¸ªæ˜ŸæœŸäº”çš„åˆå¤œæ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœæ‚¨æƒ³è¦æ›´å…·ä½“çš„æ—¶é—´è¡¨ï¼Œå¯ä»¥å°†å…·ä½“çš„æ•°å­—æ›¿æ¢æ˜Ÿå·ï¼Œä¾‹å¦‚ `30 8 * * 1-5` è¡¨ç¤ºæ¯ä¸ªå·¥ä½œæ—¥çš„ä¸Šåˆ8ç‚¹30åˆ†æ‰§è¡Œä»»åŠ¡ã€‚at æ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡åªä¼šåœ¨æŒ‡å®šçš„æ—¶é—´ç‚¹æ‰§è¡Œä½†æ˜¯ä¸ä¼šé‡å¤æ‰§è¡Œæªè¾ç”¨æ³•1. at + æ—¶é—´  <span class="token property">hh</span><span class="token punctuation">:</span>mm2. è¾“å…¥è¦æ‰§è¡Œçš„æŒ‡ä»¤ç„¶åæŒ‰ ctrl + d ä¿å­˜atq æŸ¥çœ‹è®¡åˆ’ä¸­çš„ä»»åŠ¡åˆ é™¤è®¡åˆ’ä»»åŠ¡atrm  id crontab -r åˆ é™¤å®šæ—¶ä»»åŠ¡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç£ç›˜æ“ä½œ"><a href="#ç£ç›˜æ“ä½œ" class="headerlink" title="ç£ç›˜æ“ä½œ"></a>ç£ç›˜æ“ä½œ</h2><pre class="line-numbers language-css" data-language="css"><code class="language-css">lsblk æ˜¾ç¤ºæ‰€æœ‰çš„ç£ç›˜å’Œåˆ†åŒºå’ŒæŒ‚è½½æƒ…å†µfdisk æŒ‡å®šç›®å½•ä¸‹çš„ç£ç›˜mkfs æ ¼å¼åŒ–ç£ç›˜mount ç£ç›˜ç›®å½• æŒ‚è½½ç›®å½• æŒ‚è½½åˆ†åŒºumount å–æ¶ˆæŒ‚è½½df-h æŸ¥çœ‹ç£ç›˜çŠ¶æ€ -T æŸ¥çœ‹ç£ç›˜ç±»å‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è®¡ç®—æœºç½‘ç»œ"><a href="#è®¡ç®—æœºç½‘ç»œ" class="headerlink" title="è®¡ç®—æœºç½‘ç»œ"></a>è®¡ç®—æœºç½‘ç»œ</h2><pre class="line-numbers language-css" data-language="css"><code class="language-css">ifconfig æŸ¥çœ‹ipnetstat  æŸ¥çœ‹ç³»ç»Ÿç½‘ç»œæƒ…å†µ-an æŒ‰ç…§ä¸€å®šé¡ºåºæ’åºè¾“å‡º-p  ä¸åŠ å‚æ•° æ˜¾ç¤ºå“ªä¸ªè¿›ç¨‹åœ¨è°ƒç”¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¿›ç¨‹ç®¡ç†</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">ps -a æ˜¾ç¤ºå½“å‰æ‰€æœ‰è¿›ç¨‹ä¿¡æ¯-u ä»¥ç”¨æˆ·çš„æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯-x æ˜¾ç¤ºåå°è¿è¡Œçš„å‚æ•°-e æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ åŒ…æ‹¬çˆ¶è¿›ç¨‹ç­‰ç­‰-f å…¨æ ¼å¼kill  + pid åˆ é™¤è¿›ç¨‹-9 å¼ºåˆ¶killall è¿›ç¨‹åç§°<span class="token punctuation">(</span>æ”¯æŒé€šé…ç¬¦åŒ¹é…<span class="token punctuation">)</span>pstree æŸ¥çœ‹è¿›ç¨‹æ ‘-p æ˜¾ç¤ºpid-u æ˜¾ç¤ºè¿›ç¨‹æ‰€å±ç”¨æˆ·<span class="token comment">/*service*/</span>systemctl +start xxx stoprestartstatus æŸ¥çœ‹æŸä¸ªæœåŠ¡çš„çŠ¶æ€enable å¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼Œä½¿å…¶è‡ªå¯åŠ¨list-unit-files --type=service | grep enabled æŸ¥çœ‹æ‰€æœ‰å·²å¯åŠ¨çš„æœåŠ¡get-default æŸ¥çœ‹ç³»ç»Ÿçš„é»˜è®¤ç›®æ ‡set-default è®¾ç½®é»˜è®¤ç›®æ ‡list-units åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„å•å…ƒtop å’Œpsç›¸ä¼¼ï¼Œä½†æ˜¯å¯ä»¥å®æ—¶æ›´æ–°æ­£åœ¨è¿è¡Œçš„çš„è¿›ç¨‹-d + ç§’æ•° æ¯éš”å¤šå°‘ç§’æ›´æ–°ä¸€æ¬¡-i ä½¿topä¸æ˜¾ç¤ºä»»ä½•åƒµæ­»è¿›ç¨‹-p + pid ç›‘è§†æŸä¸ªæŒ‡å®šè¿›ç¨‹çš„çŠ¶æ€topä¸­ä½¿ç”¨P æŒ‰ç…§cpuä½¿ç”¨ç‡æ’åºï¼Œé»˜è®¤M ä»¥å†…å­˜ä½¿ç”¨ç‡N ä»¥PIDq é€€å‡º<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="shell-ç¼–ç¨‹"><a href="#shell-ç¼–ç¨‹" class="headerlink" title="shell ç¼–ç¨‹"></a>shell ç¼–ç¨‹</h1><ul><li>é‡å®šå‘</li><li>here document<pre class="line-numbers language-css" data-language="css"><code class="language-css">#!/bin/bashcat &lt;&lt; END<span class="token string">"è¿™é‡Œæ˜¯lsçš„ä½¿ç”¨æ–¹æ³•"</span>ENDls /root/shell_testè¾“å‡º&gt;&gt;&gt;<span class="token string">"è¿™é‡Œæ˜¯lsçš„ä½¿ç”¨æ–¹æ³•"</span>hell.sh  ls.shsay.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>ç®¡é“<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token operator">|</span><span class="token operator">&amp;</span>    å°†æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯ä¸€èµ·ä¼ é€’ç»™åé¢çš„å‘½ä»¤<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>å‘½ä»¤åˆ†ç»„<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token punctuation">{</span>commands.......<span class="token punctuation">}</span> &gt; æ–‡ä»¶ä½¿ç”¨ <span class="token punctuation">(</span><span class="token punctuation">)</span> ä¼šå°†å‘½ä»¤ç”±å­shellæ¥è¿›è¡Œæ‰§è¡Œ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><code>:</code> ç­‰äºtrue</li><li>echo<pre class="line-numbers language-css" data-language="css"><code class="language-css">echo -e åé¢å°±å¯ä»¥åŠ ä¸Šæ¢è¡Œç¬¦å’Œåˆ¶è¡¨ç¬¦ç­‰ç‰¹æ®Šç¬¦å·äº†<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li>printf<pre class="line-numbers language-css" data-language="css"><code class="language-css">printf æ ¼å¼<span class="token punctuation">(</span>%sç­‰<span class="token punctuation">)</span> å‚æ•°<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>set / unset è®¾ç½®/å–æ¶ˆ ç¯å¢ƒå˜é‡</li><li>read ä»æ ‡å‡†è¾“å…¥è¯»å…¥æ”¾å…¥åé¢ç»™å‡ºçš„å˜é‡</li><li>wait æ§åˆ¶å¤šè¿›ç¨‹</li><li>eval , exec , sed</li><li>source æ‰§è¡Œshellè„šæœ¬</li></ul><h1 id="k8s-kubernetes"><a href="#k8s-kubernetes" class="headerlink" title="k8s kubernetes"></a>k8s kubernetes</h1><blockquote><p>è§£å†³å®¹å™¨ç¼–æ’é—®é¢˜ï¼Œå®ç°åˆ†å¸ƒå¼éƒ¨ç½²å’Œæ›¿æ¢ï¼Œå®ç°æœåŠ¡å™¨é›†ç¾¤</p></blockquote><p>kubernetesç»„ä»¶<br>ä¸€ä¸ªkubernetesé›†ç¾¤ä¸»è¦æ˜¯ç”±æ§åˆ¶èŠ‚ç‚¹(master)ã€**å·¥ä½œèŠ‚ç‚¹(node)**æ„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šå®‰è£…ä¸åŒçš„ç»„ä»¶ã€‚  </p><ul><li>masterï¼šé›†ç¾¤çš„æ§åˆ¶å¹³é¢ï¼Œè´Ÿè´£é›†ç¾¤çš„å†³ç­– ( ç®¡ç† )</li></ul><p>ApiServer : èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œæä¾›è®¤è¯ã€æˆæƒã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶  </p><p>Scheduler : è´Ÿè´£é›†ç¾¤èµ„æºè°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†Podè°ƒåº¦åˆ°ç›¸åº”çš„nodeèŠ‚ç‚¹ä¸Š  </p><p>ControllerManager : è´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚ç¨‹åºéƒ¨ç½²å®‰æ’ã€æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰  </p><p>Etcd ï¼šè´Ÿè´£å­˜å‚¨é›†ç¾¤ä¸­å„ç§èµ„æºå¯¹è±¡çš„ä¿¡æ¯  </p><ul><li>nodeï¼šé›†ç¾¤çš„æ•°æ®å¹³é¢ï¼Œè´Ÿè´£ä¸ºå®¹å™¨æä¾›è¿è¡Œç¯å¢ƒ ( å¹²æ´» )</li></ul><p>Kubelet : è´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³é€šè¿‡æ§åˆ¶dockerï¼Œæ¥åˆ›å»ºã€æ›´æ–°ã€é”€æ¯å®¹å™¨  </p><p>KubeProxy : è´Ÿè´£æä¾›é›†ç¾¤å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡  </p><p>Docker : è´Ÿè´£èŠ‚ç‚¹ä¸Šå®¹å™¨çš„å„ç§æ“ä½œ</p><ul><li>åŸºç¡€æ¦‚å¿µ<br>Masterï¼šé›†ç¾¤æ§åˆ¶èŠ‚ç‚¹ï¼Œæ¯ä¸ªé›†ç¾¤éœ€è¦è‡³å°‘ä¸€ä¸ªmasterèŠ‚ç‚¹è´Ÿè´£é›†ç¾¤çš„ç®¡æ§</li></ul><p>Nodeï¼šå·¥ä½œè´Ÿè½½èŠ‚ç‚¹ï¼Œç”±masteråˆ†é…å®¹å™¨åˆ°è¿™äº›nodeå·¥ä½œèŠ‚ç‚¹ä¸Šï¼Œç„¶ånodeèŠ‚ç‚¹ä¸Šçš„dockerè´Ÿè´£å®¹å™¨çš„è¿è¡Œ  </p><p>Podï¼škubernetesçš„æœ€å°æ§åˆ¶å•å…ƒï¼Œå®¹å™¨éƒ½æ˜¯è¿è¡Œåœ¨podä¸­çš„ï¼Œä¸€ä¸ªpodä¸­å¯ä»¥æœ‰1ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨  </p><p>Controllerï¼šæ§åˆ¶å™¨ï¼Œé€šè¿‡å®ƒæ¥å®ç°å¯¹podçš„ç®¡ç†ï¼Œæ¯”å¦‚å¯åŠ¨podã€åœæ­¢podã€ä¼¸ç¼©podçš„æ•°é‡ç­‰ç­‰  </p><p>Serviceï¼špodå¯¹å¤–æœåŠ¡çš„ç»Ÿä¸€å…¥å£ï¼Œä¸‹é¢å¯ä»¥ç»´æŠ¤è€…åŒä¸€ç±»çš„å¤šä¸ªpod  </p><p>Labelï¼šæ ‡ç­¾ï¼Œç”¨äºå¯¹podè¿›è¡Œåˆ†ç±»ï¼ŒåŒä¸€ç±»podä¼šæ‹¥æœ‰ç›¸åŒçš„æ ‡ç­¾  </p><p>NameSpaceï¼šå‘½åç©ºé—´ï¼Œç”¨æ¥éš”ç¦»podçš„è¿è¡Œç¯å¢ƒ</p><h1 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h1><p>JenkinsåŸç†<img src="/2023/07/04/56/jenkins%E5%8E%9F%E7%90%86.png"></p><h1 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h1><p>ä¸Mavenç›¸æ¯”ï¼ŒMavenæ›´ä¾§é‡äºåŒ…çš„ç®¡ç†ï¼Œè€ŒGradleä¾§é‡äºå¤§é¡¹ç›®æ„å»º</p><h1 id="SVN"><a href="#SVN" class="headerlink" title="SVN"></a>SVN</h1><p>ä¸€ç§ä¸åŒäºgit çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ<br>SVNä¸»è¦æ˜¯é›†ä¸­å¼çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼šæ‰€æœ‰çš„æ–‡ä»¶ç‰ˆæœ¬ä¿¡æ¯éƒ½å­˜å‚¨åœ¨ä¸­å¤®æœåŠ¡å™¨ï¼Œç”¨æˆ·è¿›è¡Œå·¥ä½œæ—¶æ˜¯åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ï¼Œæ‰€ä»¥ç‰ˆæœ¬çš„å†å²æ˜¯çº¿æ€§çš„<br>ç›®å½•ä¹Ÿæ˜¯ç‰ˆæœ¬æ§åˆ¶çš„ä¸€éƒ¨åˆ†ï¼Œåˆ†æ”¯å’Œæ ‡ç­¾æ˜¯ç›®å½•çš„å¤åˆ¶<br>è€Œgitæ˜¯æ¯ä¸ªäººçš„ç”µè„‘ä¸Šéƒ½æ˜¯ä¸€ä¸ªå…·ä½“çš„ç‰ˆæœ¬åº“ï¼Œç‰ˆæœ¬çš„å†å²ä¸æ˜¯çº¿æ€§çš„ï¼Œåˆ†æ”¯å¤„ç†æ›´åŠ é«˜æ•ˆã€‚<br>SVNçš„åˆ†æ”¯å®é™…ä¸Šå°±æ˜¯æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œç„¶åæŠŠåŸæ¥çš„æ–‡ä»¶å¤åˆ¶ä¸€ä»½è¿›å»ã€‚<br>ä¼˜ç¼ºç‚¹å¯¹æ¯”ï¼š</p><ul><li>SVNï¼š<ul><li>ä¼˜ç‚¹ æ›´åŠ é«˜æ•ˆçš„å¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç‰ˆæœ¬å†å²çº¿æ€§ï¼Œå®¹æ˜“ç†è§£ï¼Œæ›´å¥½çš„å¤„ç†æƒé™è®¿é—®å’Œæ§åˆ¶ã€‚</li><li>ç¼ºç‚¹ï¼šæäº¤å’Œæ›´æ”¹éœ€è¦è”ç½‘ï¼Œç„¶ååˆ†æ”¯åˆå¹¶æ›´åŠ éº»çƒ¦ï¼Œé€Ÿåº¦æ…¢ï¼Œæ¯æ¬¡æ“ä½œéƒ½éœ€è¦ä¸æœåŠ¡å™¨é€šä¿¡ã€‚</li></ul></li><li>Git <ul><li>ä¼˜ç‚¹ï¼šåˆ†å¸ƒå¼æ§åˆ¶ï¼Œç¦»çº¿ä¹Ÿå¯ä»¥è¿›è¡Œå¼€å‘ï¼Œé€Ÿåº¦æ›´å¿«</li><li>ç¼ºç‚¹ï¼šå­¦ä¹ æ¯”SVNå¤æ‚ï¼Œå¯¹äºŒè¿›åˆ¶çš„å¤„ç†ä¸å¥½ï¼Œå®¹æ˜“é€ æˆæ€§èƒ½é—®é¢˜ã€‚</li></ul></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> vim git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go</title>
      <link href="/2023/06/28/59/"/>
      <url>/2023/06/28/59/</url>
      
        <content type="html"><![CDATA[<h1 id="Goå­¦ä¹ "><a href="#Goå­¦ä¹ " class="headerlink" title="Goå­¦ä¹ "></a>Goå­¦ä¹ </h1><h1 id="é¢ç»"><a href="#é¢ç»" class="headerlink" title="é¢ç»"></a>é¢ç»</h1><h2 id="åŸºæœ¬æ•°æ®ç±»å‹"><a href="#åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹"></a>åŸºæœ¬æ•°æ®ç±»å‹</h2><p>bool,string,int,byte(int8),int16,rune(int32),float32,float64,complex64/128</p><p>Goæ¯”èµ·Javaå’ŒC++ ï¼Œä»–ä¸Cçš„å…³ç³»æ›´å¯†åˆ‡</p><h2 id="å˜é‡ï¼š"><a href="#å˜é‡ï¼š" class="headerlink" title="å˜é‡ï¼š"></a>å˜é‡ï¼š</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">//å£°æ˜å¤šä¸ªå˜é‡</span><span class="token keyword">var</span> <span class="token punctuation">(</span>v1    v2<span class="token punctuation">)</span><span class="token comment">//å˜é‡åˆå§‹åŒ–ï¼Œæ— éœ€å£°æ˜å˜é‡ç±»å‹</span>v1 <span class="token operator">:=</span> <span class="token number">1</span><span class="token comment">//å¤šé‡èµ‹å€¼</span>v1 <span class="token punctuation">,</span> v2 <span class="token operator">=</span> v2 <span class="token punctuation">,</span> v1 <span class="token comment">//å®ç°äº¤æ¢ä¸¤ä¸ªå˜é‡ï¼Œä½†æ˜¯åªèƒ½äº¤æ¢ä¸¤ä¸ªåŒä¸€ç±»å‹çš„å˜é‡</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>^75e37b</p><h2 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹:"></a>ç±»å‹:</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token builtin">float32</span> <span class="token comment">//ç­‰äºcä¸­çš„float</span><span class="token builtin">float64</span> <span class="token comment">// double</span><span class="token comment">//å¤æ•°ç±»å‹ï¼Œå’Œæ•°å­¦ä¸Šçš„è¡¨è¾¾ä¸€æ ·</span><span class="token keyword">var</span> <span class="token punctuation">(</span>v1 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">5i</span>v2 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">6i</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v1 <span class="token operator">+</span> v2<span class="token punctuation">)</span><span class="token comment">//è¾“å‡ºä¸º</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1i</span><span class="token punctuation">)</span><span class="token comment">//ä¸­æ–‡å­—ç¬¦åœ¨UTF-8ä¸­å ä¸‰ä¸ªå­—èŠ‚</span>s <span class="token operator">:=</span> <span class="token string">"ä½ å¥½"</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//æ•°ç»„é€šè¿‡rangeæ¥éå†ï¼Œrangeæœ‰ä¸¤ä¸ªè¿”å›å€¼æ‰€ä»¥ï¼Œç¬¬ä¸€ä¸ªè¿”å›çš„æ˜¯æ•°ç»„çš„ä¸‹æ ‡ï¼Œç¬¬äºŒä¸ªæ˜¯è¿”å›çš„æ•°ç»„çš„æ•°å€¼ï¼Œæ‰€ä»¥è¦ç”¨ä¸¤ä¸ªå˜é‡æ¥å­˜å‚¨</span>s <span class="token operator">:=</span> <span class="token string">"0123456"</span><span class="token keyword">for</span> i<span class="token punctuation">,</span> value <span class="token operator">:=</span> <span class="token keyword">range</span> s <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> value<span class="token operator">-</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// å•ä¸ªå­—ç¬¦</span><span class="token keyword">var</span> b <span class="token builtin">byte</span> <span class="token operator">=</span> <span class="token char">'a'</span>æ³¨æ„ï¼šç¦æ­¢å­—ç¬¦ä¸²è½¬<span class="token builtin">int</span><span class="token builtin">rune</span> æ˜¯å•ä¸ªUnicode å­—ç¬¦<span class="token comment">//åŒæ—¶æ³¨æ„æ•°ç»„çš„åˆå§‹åŒ–çš„æ–¹å¼æ˜¯è¿™è¿™æ ·çš„</span>s <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">}</span> <span class="token comment">//å½“ä¸éœ€è¦æŸä¸ªè¿”å›ç±»å‹æ—¶ä½¿ç”¨_æ¥è·³è¿‡è¿™ä¸ªè¿”å›ç±»å‹å³å¯</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> value <span class="token operator">:=</span> <span class="token keyword">range</span> s <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç±»ä¼¼ type ofçš„æ–¹æ³•</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> åˆ«å <span class="token operator">=</span> åŸæ¥çš„ç±»å‹å<span class="token keyword">const</span> å¸¸é‡å£°æ˜<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>itoa ç”¨äºè®°å½•å¸¸é‡</p><h3 id="å­—ç¬¦è½¬æ¢"><a href="#å­—ç¬¦è½¬æ¢" class="headerlink" title="å­—ç¬¦è½¬æ¢"></a>å­—ç¬¦è½¬æ¢</h3><pre class="line-numbers language-none"><code class="language-none">strconv.xxxxå³å¯<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h3><p>æ•°ç»„å®šäºçš„ä¸€ç§æ–¹å¼ï¼Œä¼šæ ¹æ®ç»™å®šçš„åˆå§‹åŒ–çš„å…ƒç´ å†³å®šæ•°ç»„çš„é•¿åº¦</p><p><code>a := [...]int{1}</code></p><p>æ•°ç»„åˆ‡ç‰‡ï¼Œç±»ä¼¼äºvector</p><p>åˆ‡ç‰‡åˆ›å»ºæ–¹å¼æœ‰ï¼š</p><ol><li><p>åŸºäºåŸæœ‰çš„æ•°ç»„æ¥åˆ›å»º</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">a <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token keyword">var</span> s <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token comment">//éœ€è¦ä½¿ç”¨Var æ¥å£°æ˜åˆ‡ç‰‡æ•°ç»„çš„ç±»å‹ï¼Œç­‰å·çš„å³ä¾§å¯ä»¥æ—¶ array[first , end] ,æƒ³è¦æˆªå–çš„é¦–ä½ä½ç½®</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p><u><strong>ç›´æ¥åˆ›å»º</strong></u></p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">//ä½¿ç”¨makeè¿›è¡Œç›´æ¥åˆ›å»º</span>s <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token comment">//å»ºç«‹ä¸€ä¸ªåˆå§‹åŸä¸º5ä¸ªä½†æ˜¯é¢„ç•™åä¸ªå…ƒç´ çš„ç©ºé—´çš„åˆ‡ç‰‡</span><span class="token comment">//ç›´æ¥åœ¨å»ºç«‹çš„è¿‡ç¨‹ä¸­èµ‹äºˆåˆå€¼</span>s <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ol><p>åˆ‡ç‰‡çš„éƒ¨åˆ†å¸¸ç”¨å‡½æ•°</p><ul><li>len() è¿”å›å·²ç»å­˜å‚¨çš„å…ƒç´ çš„ä¸ªæ•°</li><li>cap() è¿”å›åˆ‡ç‰‡åˆ†é…çš„ç©ºé—´å¤§å°</li><li>append() è¿½åŠ å…ƒç´ </li><li>copy() å¤åˆ¶</li></ul><p>æ•°ç»„ä¹Ÿå¯ä»¥å®šä¸ºæ¥å£æ•°ç»„ï¼Œç»“æ„ä½“æ•°ç»„ï¼Œç®¡é“æ•°ç»„ç­‰ç­‰</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">//æ¥å£æ•°ç»„</span><span class="token keyword">var</span> unknown <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">var</span> unknown <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token number">123</span><span class="token punctuation">,</span><span class="token string">"ä½ å¥½"</span><span class="token punctuation">}</span><span class="token comment">//ç®¡é“æ•°ç»„</span><span class="token keyword">var</span> chanList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®šä¹‰ç©ºæ•°ç»„:</p><p><code>var a [0] int</code></p><pre class="line-numbers language-go" data-language="go"><code class="language-go">a <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="mapç±»å‹"><a href="#mapç±»å‹" class="headerlink" title="mapç±»å‹"></a><u>mapç±»å‹</u></h3><p>Goä¸­å°†å…¶å˜ä¸ºåŸºæœ¬ç±»å‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦å¼•å…¥åº“</p><p>å£°æ˜:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> myMap <span class="token keyword">map</span><span class="token punctuation">[</span>é”®çš„ç±»å‹<span class="token punctuation">]</span>å€¼çš„ç±»å‹<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åˆ›å»º:åˆå§‹åŒ–åˆ›å»ºæ—¶è¦æ³¨æ„åœ¨åˆå§‹åŒ–çš„æœ€åä¸€ä¸ªæ•°æ®çš„åé¢åŠ ä¸Šé€—å·æ‰ä»£è¡¨åˆå§‹åŒ–å®Œæˆï¼Œå¦åˆ™ä¼šæŠ¥é”™</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">//æŒ‡å®šå®¹é‡</span>myMap <span class="token operator">=</span> <span class="token builtin">make</span> <span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span>é”®<span class="token punctuation">]</span>å€¼ <span class="token punctuation">,</span> capacity<span class="token punctuation">)</span><span class="token comment">//ç›´æ¥åˆå§‹åŒ–</span>myMap <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token string">"1234"</span><span class="token punctuation">:</span> <span class="token number">1234</span><span class="token punctuation">,</span> <span class="token comment">//ä¸€å®šè¦åŠ ä¸Šé€—å·</span><span class="token punctuation">}</span><span class="token comment">//ç›´æ¥å£°æ˜ï¼‹åˆå§‹åŒ–ä¸€èµ·</span>myMap <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token string">"1234"</span><span class="token punctuation">:</span> <span class="token number">1234</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ é™¤</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token builtin">delete</span> <span class="token punctuation">(</span>myMap <span class="token punctuation">,</span> key<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥æ‰¾</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">value<span class="token punctuation">,</span> ok <span class="token operator">:=</span> myMap<span class="token punctuation">[</span><span class="token string">"4"</span><span class="token punctuation">]</span><span class="token keyword">if</span> ok <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> ok<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"No"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><ol><li><p>if else ç»“æ„</p><ul><li><p>if else çš„æ‹¬å·å¿…é¡»åœ¨ä¸€è¡Œï¼Œå¦åˆ™ç¼–è¯‘å¤±è´¥ï¼Œå½“å‡ºç°elseæ—¶ï¼Œelse å¿…é¡»å’Œ â€˜â€™} â€˜â€™åœ¨ä¸€è¡Œ</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">//æ­£ç¡®</span><span class="token keyword">if</span> ok <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> ok<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"No"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">//é”™è¯¯</span><span class="token keyword">if</span> ok <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> ok<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"No"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">//æ‰€ä»¥ä¹Ÿæ¨èä½¿ç”¨çœç•¥elseçš„è¯­å¥</span><span class="token keyword">if</span> ok <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> ok<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"No"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ¡ä»¶ä¸éœ€è¦ä½¿ç”¨æ‹¬å·</p></li><li><p>èŠ±æ‹¬å·å¿…é¡»å­˜åœ¨</p></li></ul></li><li><p>switch : ä¸éœ€è¦æ˜¾æ€§çš„ä½¿ç”¨breakæ¥é€€å‡ºåˆ¤æ–­ï¼Œé»˜è®¤çš„å·²ç»å¸¦æœ‰breakäº†</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">t <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">switch</span> <span class="token punctuation">{</span><span class="token comment">//ç”¨æ¥æ›¿ä»£if è¯­å¥ï¼Œæ¯”èµ·åµŒå¥—ifæ›´å¥½åˆ¤æ–­ä»£ç </span><span class="token keyword">case</span> t<span class="token punctuation">.</span><span class="token function">Hour</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">12</span> <span class="token punctuation">:</span>    xxxx<span class="token punctuation">;</span><span class="token keyword">default</span> <span class="token punctuation">:</span>    xxxx<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¾ªç¯ </p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">for</span> i<span class="token operator">:=</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">{</span>                      <span class="token punctuation">}</span><span class="token comment">// whileå¾ªç¯</span><span class="token keyword">for</span> a <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"a = %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>        a<span class="token operator">--</span>   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ›´å¼ºå¤§çš„break breakåé¢å¯ä»¥åŠ ä¸Šæ ‡ç­¾ï¼Œä½¿ç”¨æ–¹æ³•ä¸gotoä¸€è‡´</p></li><li><p>å‡½æ•° </p><p>Goçš„å‡½æ•°æ‹¥æœ‰å¤šé‡è¿”å›å€¼ï¼Œå¯ä»¥æ›´æ–¹ä¾¿çš„æŠŠå‡½æ•°çš„æ‰§è¡Œç»“æœè¿”å›</p><p>æ³¨æ„ï¼šå°å†™å­—æ¯å¼€å¤´çš„å‡½æ•°åªæœ‰æœ¬åŒ…å¯è§ï¼Œè€Œå¤§å†™å­—æ¯å¼€å¤´çš„å‡½æ•°æ‰å¯ä»¥è¢«å…¶ä»–åŒ…ä½¿ç”¨</p><p>ä¸€èˆ¬è¯­æ³•</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> å‡½æ•°å <span class="token punctuation">(</span>å‚æ•°<span class="token punctuation">)</span><span class="token punctuation">(</span>è¿”å›åˆ—è¡¨<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¸å®šå‚æ•° åœ¨å†™å½¢å‚åˆ—è¡¨çš„æ—¶å€™ä½¿ç”¨â€¦æ¥çœç•¥å‚æ•°å³å¯è¾¾åˆ°ä¸å®šå‚æ•°çš„ä½œç”¨</p><p>ä¾‹:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">name</span><span class="token punctuation">(</span>a <span class="token operator">...</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¦‚å¿µ: è¿™ç§ä½¿ç”¨æ–¹å¼æ˜¯è¯­æ³•ç³–ï¼Œè¯­æ³•ç³–å¯¹è¯­è¨€çš„åŠŸèƒ½æ²¡æœ‰ç”¨å½±å“ä½†æ˜¯å¯ä»¥æ–¹ä¾¿ä½¿ç”¨ï¼Œä¹Ÿèƒ½å¤Ÿå¢åŠ ç¨‹åºçš„å¯è¯»æ€§ï¼Œå‡å°‘å‡ºé”™çš„æœºä¼š</p><p>è¿™é‡Œçš„ â€¦ ç›¸å½“äºä¸€ä¸ªæ•°ç»„åˆ‡ç‰‡ï¼Œç­‰ä»·äºä¸‹é¢çš„è¯­å¥</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">name</span><span class="token punctuation">(</span>args <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">//è°ƒç”¨çš„æ—¶å€™å¿…é¡»ä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡Œè°ƒç”¨äº†</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒ¿åå‡½æ•°ï¼šGoæ”¯æŒéšæ—¶éšåœ°å®šä¹‰åŒ¿åå‡½æ•°</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">//åœ¨å®šä¹‰çš„æ—¶å€™è¿›è¡Œè°ƒç”¨</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>a <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span><span class="token keyword">return</span> a<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">//åŒ¿åå‡½æ•°èµ‹ç»™å˜é‡</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>f <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>a <span class="token operator">...</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span><span class="token keyword">return</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// æ³¨æ„æ­¤å¤„çš„aç›¸å½“äº args [] æ‰€ä»¥aä¸æ˜¯intå‹ä¸å¯ä»¥ç›´æ¥è¿”å›</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>é—­åŒ…</strong></p><p>é—­åŒ…æ˜¯ç”±å‡½æ•°åŠå…¶ç›¸å…³çš„å¼•ç”¨ç¯å¢ƒç»„åˆè€Œæˆçš„å®ä½“(å³ï¼šé—­åŒ…=å‡½æ•°+å¼•ç”¨ç¯å¢ƒ)ã€‚</p><p>åŒ¿åå‡½æ•°æ˜¯ä¸€ç±»é—­åŒ…</p><ul><li>åŒ…å«è‡ªç”±å˜é‡çš„ä»£ç å—ï¼Œè¿™äº›å˜é‡ä¸åœ¨è¿™ä¸ªä»£ç å—å†…æˆ–è€…ä»»ä½•å…¨å±€ä¸Šä¸‹æ–‡ä¸­å®šä¹‰ï¼Œè€Œæ˜¯åœ¨å®šä¹‰ä»£ç å—ä¸­çš„ç¯å¢ƒä¸­è¿›è¡Œå®šä¹‰çš„ã€‚è¦æ‰§è¡Œçš„ä»£ç å—ä¸ºè‡ªç”±å˜é‡æä¾›ç»‘å®šçš„è®¡ç®—ç¯å¢ƒ(ä½œç”¨åŸŸ)</li><li>é—­åŒ…æ¯æ¬¡è°ƒç”¨éƒ½æ˜¯æ–°çš„å®ä¾‹</li><li>é—­åŒ…ä¸­çš„å˜é‡ä¼šä¿å­˜ï¼Œå³ä½¿è°ƒç”¨ç»“æŸä¹Ÿä¼šä¿å­˜ï¼Œï¼Œå¯ä»¥ä¿è¯é—­åŒ…ä¸­çš„å˜é‡çš„å®‰å…¨æ€§ï¼Œä¸ä¼šè¢«å¤–éƒ¨å‡½æ•°ä¿®æ”¹</li></ul><p>é—­åŒ…å¯ä»¥è·å¾—æ‰€åœ¨å‡½æ•°å†…çš„ä½œç”¨åŸŸï¼Œä½†æ˜¯å¤–éƒ¨ä¸å¯ä¿®æ”¹é—­åŒ…çš„æ•°æ®</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>b <span class="token operator">:=</span> <span class="token number">0</span>    <span class="token comment">//é—­åŒ…</span>f <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>b<span class="token operator">++</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">f</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token function">f</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">//æ¯ä¸€æ¬¡è°ƒç”¨éƒ½æ˜¯æ–°çš„å®ä¾‹</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿”å›å‡½æ•°çš„å‡½æ•°</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token string">"fmt"</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>f <span class="token operator">:=</span> <span class="token function">Add1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//fmt.Println(Add1()(1, 2)) å¦ä¸€ç§æ–¹å¼</span><span class="token punctuation">}</span><span class="token comment">//è¿”å›äº†ä¸€ä¸ª åŒ¿åå‡½æ•°</span><span class="token keyword">func</span> <span class="token function">Add1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span><span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>é”™è¯¯å¤„ç†</p><p>erroræ¥å£æ˜¯å†…ç½®çš„ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> <span class="token builtin">error</span> <span class="token keyword">interface</span> <span class="token punctuation">{</span>      <span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>defer</p><p>ç±»ä¼¼äºææ„å‡½æ•°ï¼Œéµå¾ªå…ˆè¿›åå‡ºï¼Œç”¨äºå‡½æ•°æ‰§è¡Œä¹‹åè¿›è¡Œä¸€äº›èµ„æºé‡Šæ”¾çš„æ”¶å°¾å·¥ä½œ</p><p>ä½¿ç”¨è¯­æ³•ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">defer</span> <span class="token operator">+</span> æ‰§è¡Œè¯­å¥è¦æ‰§è¡Œè¯­å¥å¾ˆå¤šæ—¶å¯ä»¥å†™ä¸€ä¸ªåŒ¿åå‡½æ•°æ¥è¿›è¡Œå¤„ç†<span class="token keyword">defer</span> <span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    å›æ”¶å·¥ä½œ<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//è°ƒç”¨</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>panic() å’Œ recover()</p><p>panic ( ) ç”¨äºç«‹åˆ»ç»ˆæ­¢ç¨‹åºï¼Œä½†æ˜¯deferä¸å½±å“ï¼Œä¼šæ­£å¸¸æ‰§è¡Œï¼Œpanicå¯ä»¥æ¥å—ä»»æ„ç±»å‹çš„æ•°æ®</p><p>recover ( ) ç”¨äºç»ˆæ­¢é”™è¯¯å¤„ç†æµç¨‹ï¼Œä¸€èˆ¬æ”¾åœ¨deferä¸­æ¥æˆªå–é”™è¯¯ä¿¡æ¯</p></li></ol><h2 id="é¢å‹å¯¹è±¡ç¼–ç¨‹-OOP-Object-Oriented-Programming"><a href="#é¢å‹å¯¹è±¡ç¼–ç¨‹-OOP-Object-Oriented-Programming" class="headerlink" title="é¢å‹å¯¹è±¡ç¼–ç¨‹(OOP , Object Oriented Programming)"></a>é¢å‹å¯¹è±¡ç¼–ç¨‹(OOP , Object Oriented Programming)</h2><ol><li><p>ç±»å‹ç³»ç»Ÿ</p><p>Goå¯ä»¥ç»™ä»»æ„ç±»å‹(åŒ…æ‹¬å†…ç½®ç±»å‹ï¼Œä½†ä¸åŒ…æ‹¬æŒ‡é’ˆç±»å‹)æ·»åŠ ç›¸åº”çš„æ–¹æ³•</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> Integer <span class="token builtin">int</span><span class="token comment">//Integer ä¸int å¹¶æ— åŒºåˆ«ï¼Œåªæ˜¯æˆ‘ä»¬è®¤ä¸ºç»™ä»–åŠ ä¸Šäº†ä¸€ä¸ªè‡ªå¸¦çš„æ–¹æ³•</span><span class="token keyword">func</span> <span class="token punctuation">(</span>a Integer<span class="token punctuation">)</span> <span class="token function">less</span><span class="token punctuation">(</span>b Integer<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span><span class="token keyword">return</span> a <span class="token operator">&lt;</span> b<span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">var</span> a Integer <span class="token operator">=</span> <span class="token number">5</span><span class="token keyword">defer</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"å›æ”¶äº†"</span><span class="token punctuation">)</span><span class="token keyword">if</span> a<span class="token punctuation">.</span><span class="token function">less</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">"&lt;"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">defer</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"é”™è¯¯å›æ”¶"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>é¢å‘å¯¹è±¡åªæ˜¯æ¢äº†ä¸€ç§æ–¹å¼æ¥è¡¨è¾¾è¯­æ³•ï¼Œæ‰€ä»¥å®è´¨ä¸Šä¹Ÿæ˜¯è¯­æ³•ç³–</p><p>Goæ²¡æœ‰éšè—çš„æŒ‡é’ˆ</p><ul><li>æ–¹æ³•çš„å¯¹è±¡æ˜¾å¼ä¼ é€’</li><li>æ–¹æ³•çš„å¯¹è±¡ä¸éœ€è¦æ˜¯æŒ‡é’ˆï¼Œä¹Ÿä¸éœ€è¦æ˜¯this</li></ul></li><li><p>å¯¹äºpublic ç±»ï¼Œ éœ€è¦é‡‡ç”¨ç±»åé¦–å­—æ¯å¤§å†™</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token string">"fmt"</span><span class="token keyword">type</span> Base <span class="token keyword">struct</span> <span class="token punctuation">{</span>Name <span class="token builtin">string</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token punctuation">(</span>base <span class="token operator">*</span>Base<span class="token punctuation">)</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token punctuation">(</span>base <span class="token operator">*</span>Base<span class="token punctuation">)</span> <span class="token function">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">type</span> Foo <span class="token keyword">struct</span> <span class="token punctuation">{</span>Base<span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token punctuation">(</span>foo <span class="token operator">*</span>Foo<span class="token punctuation">)</span> <span class="token function">Foo</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>foo<span class="token punctuation">.</span>Name <span class="token operator">=</span> name<span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token punctuation">(</span>foo <span class="token operator">*</span>Foo<span class="token punctuation">)</span> <span class="token function">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">println</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>base <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span>base<span class="token punctuation">.</span><span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>foo <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>Foo<span class="token punctuation">)</span>foo<span class="token punctuation">.</span><span class="token function">Foo</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>æ¥å£</strong></p><p>å…¶ä»–è¯­è¨€åœ¨ä½¿ç”¨æ¥å£æ—¶å¿…é¡»è¦å…ˆä»æ¥å£è¿›è¡Œç»§æ‰¿ï¼Œæ‰èƒ½è¿›è¡Œå®ç°æ¥å£</p><p>ç®€è¨€ä¹‹ï¼Œå¿…é¡»çŸ¥é“æ¥å£è¦å®ç°ä»€ä¹ˆæ‰èƒ½å®šä¹‰æ¥å£ï¼Œä½†å®é™…æƒ…å†µæ˜¯ï¼Œä¸çŸ¥é“æ¥å£è¦å®ç°ä»€ä¹ˆ</p><p>ä¾‹å¦‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//Java è¯­æ³•</span><span class="token keyword">interface</span> <span class="token class-name">IFoo</span><span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token keyword">implements</span> <span class="token class-name">IFoo</span> <span class="token punctuation">{</span>    <span class="token comment">//....</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é—®é¢˜ï¼š</p><ol><li>æä¾›å“ªäº›æ¥å£å¥½å‘¢ï¼Ÿ</li><li>å¦‚æœä¸¤ä¸ªç±»å®ç°äº†ç›¸åŒçš„æ¥å£ï¼Œåº”è¯¥æŠŠæ¥å£æ”¾è¿›å“ªä¸ªåŒ…å†…ï¼Ÿ</li></ol><p>Goçš„æ¥å£æ˜¯éä¾µå…¥å¼çš„ï¼Œåªè¦ç±»å®ç°äº†æ¥å£è¦æ±‚çš„æ‰€æœ‰å‡½æ•°ï¼Œå°±ç®—æ˜¯å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œèµ‹å€¼</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token string">"fmt"</span><span class="token comment">//å®ç°æ¥å£çš„ç±»</span><span class="token keyword">type</span> File <span class="token keyword">struct</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment">// å®ç°ç±»æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æ¥å£çš„æ–¹æ³•</span><span class="token keyword">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>File<span class="token punctuation">)</span> <span class="token function">Print</span><span class="token punctuation">(</span>str <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">//ä¸¤ä¸ªä»¥åå‡ºç°çš„æ¥å£</span><span class="token keyword">type</span> IFile <span class="token keyword">interface</span> <span class="token punctuation">{</span><span class="token function">Print</span><span class="token punctuation">(</span>str <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">type</span> IPrint <span class="token keyword">interface</span> <span class="token punctuation">{</span><span class="token function">Print</span><span class="token punctuation">(</span>str <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">var</span> file1 IFile <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>File<span class="token punctuation">)</span><span class="token keyword">var</span> file2 IPrint <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>File<span class="token punctuation">)</span>file3 <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>File<span class="token punctuation">)</span>file1<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"IFileæ¥å£å®ç°"</span><span class="token punctuation">)</span>file2<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"IPrintæ¥å£å®ç°"</span><span class="token punctuation">)</span>file3<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"å®ç°æ¥å£çš„ç±»ï¼Œå¹¶ä¸éœ€è¦æå‰çŸ¥é“æœ‰å“ªäº›æ¥å£ï¼Œåªè¦èƒ½å¤Ÿå®ç°äº†ä»¥åä¼šå‡ºç°çš„æ¥å£çš„å‡½æ•°å³å¯ç›´æ¥ä½¿ç”¨"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯ Go è¯­è¨€é‡Œæœ‰éå¸¸çµæ´»çš„ <strong>æ¥å£</strong> æ¦‚å¿µï¼Œé€šè¿‡å®ƒå¯ä»¥å®ç°å¾ˆå¤šé¢å‘å¯¹è±¡çš„ç‰¹æ€§ã€‚æ¥å£æä¾›äº†ä¸€ç§æ–¹å¼æ¥ <strong>è¯´æ˜</strong> å¯¹è±¡çš„è¡Œä¸ºï¼šå¦‚æœè°èƒ½æå®šè¿™ä»¶äº‹ï¼Œå®ƒå°±å¯ä»¥ç”¨åœ¨è¿™å„¿ã€‚</p><p>æ¥å£å®šä¹‰äº†ä¸€ç»„æ–¹æ³•ï¼ˆæ–¹æ³•é›†ï¼‰ï¼Œä½†æ˜¯è¿™äº›æ–¹æ³•ä¸åŒ…å«ï¼ˆå®ç°ï¼‰ä»£ç ï¼šå®ƒä»¬æ²¡æœ‰è¢«å®ç°ï¼ˆå®ƒä»¬æ˜¯æŠ½è±¡çš„ï¼‰ã€‚æ¥å£é‡Œä¹Ÿä¸èƒ½åŒ…å«å˜é‡ã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> Namer <span class="token keyword">interface</span> <span class="token punctuation">{</span>    <span class="token function">Method1</span><span class="token punctuation">(</span>param_list<span class="token punctuation">)</span> return_type    <span class="token function">Method2</span><span class="token punctuation">(</span>param_list<span class="token punctuation">)</span> return_type    <span class="token operator">...</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨æ¥å£æ—¶ï¼Œå¦‚æœæŸä¸ªç±»å®ç°äº†æ¥å£çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæ¥å£ç±»å‹çš„å˜é‡å¯ä»¥èµ‹å€¼ä¸ºè¿™ä¸ªç±»çš„å˜é‡</p><p>å¦‚æœæ¥å£æ¥å£Aå’Œæ¥å£Bçš„æ–¹æ³•æ˜¯ä¸€è‡´çš„ï¼Œé‚£ä¹ˆåœ¨Goä¸­å±äºå®Œå…¨ç­‰ä»·</p><p>å¦‚æœAæ¥å£çš„æ–¹æ³•æ˜¯Bæ¥å£æ–¹æ³•çš„å­é›†ï¼Œé‚£ä¹ˆBæ¥å£å¯ä»¥èµ‹å€¼ç»™Aæ¥å£ï¼Œè€ŒAæ¥å£ä¸èƒ½èµ‹å€¼ç»™Bæ¥å£</p><p>æ¥å£æŸ¥è¯¢ï¼šç”¨äºæŸ¥è¯¢æŸä¸ªæ¥å£æ˜¯å¦å±äºæŸä¸ªç±»å‹</p><blockquote><p>å®ä¾‹ <code>num2</code> æ˜¯å¦å±äºæ¥å£ <code>Number1</code>ï¼Œå¯ä»¥è¿™ä¹ˆåšï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> num1 Number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">var</span> num2 Number2 <span class="token operator">=</span> <span class="token operator">&amp;</span>num1<span class="token punctuation">;</span><span class="token keyword">if</span> num3<span class="token punctuation">,</span> ok <span class="token operator">:=</span> num2<span class="token punctuation">.</span><span class="token punctuation">(</span>Number1<span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>num3<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœnum2 å®ä¾‹æ‰€æŒ‡çš„å¯¹è±¡æ˜¯å±äºNumber1çš„ï¼Œé‚£ä¹ˆokå€¼ä¸º1 ï¼Œnum3 è½¬åŒ–ä¸º Number1çš„ä¸€ä¸ªå®ä¾‹ï¼Œä¹‹åæ‰§è¡Œæ¡ä»¶å†…çš„ä»£ç </p></blockquote><p>ç±»å‹æŸ¥è¯¢ï¼šç”¨äºæŸ¥è¯¢æ¥å£æŒ‡å‘çš„å¯¹è±¡å®ä¾‹çš„ç±»å‹</p><p>è¯­æ³•:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">switch</span> v <span class="token operator">:=</span> v1<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">case</span> <span class="token builtin">int</span><span class="token punctuation">:</span>    <span class="token keyword">case</span> <span class="token builtin">string</span><span class="token punctuation">:</span>    <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸¤è€…ä¸€èˆ¬æ­é…ä½¿ç”¨</p><p>Anyç±»å‹</p><p>ä»»ä½•å¯¹è±¡å®ä¾‹éƒ½æ»¡è¶³ç©ºæ¥å£ interface { } æ‰€ä»¥interface { } å¯ä»¥ä½œä¸ºä¸€ä¸ªå¯ä»¥æŒ‡å‘ä»»ä½•å¯¹è±¡çš„Anyç±»å‹ï¼Œå½“å‡½æ•°å¯ä»¥æ¥å—ä»»ä½•å®ä¾‹æ—¶ï¼Œå¯ä»¥å°†å…¶å£°æ˜ä¸ºinterface { } </p><p>ä¾‹å¦‚ï¼š fmtåº“ä¸­çš„Printå‡½æ•°</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> Print <span class="token punctuation">(</span>fmt <span class="token builtin">string</span> <span class="token punctuation">,</span> args <span class="token operator">...</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h2 id="å¹¶å‘ç¼–ç¨‹"><a href="#å¹¶å‘ç¼–ç¨‹" class="headerlink" title="å¹¶å‘ç¼–ç¨‹"></a>å¹¶å‘ç¼–ç¨‹</h2><p>ä¸»æµå®ç°æ¨¡å‹:</p><ol><li><p>å¤šè¿›ç¨‹</p><p>æ“ä½œç³»ç»Ÿå±‚é¢è¿›è¡Œçš„</p></li><li><p>å¤šçº¿ç¨‹</p><p>æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„è°ƒåº¦</p></li><li><p>åŸºäºå›è°ƒçš„éé˜»å¡/å¼‚æ­¥IO</p><p>é€šè¿‡äº‹ä»¶é©±åŠ¨çš„æ–¹å¼ä½¿ç”¨å¼‚æ­¥IOï¼Œä½¿æœåŠ¡å™¨æŒç»­è¿è½¬å¹¶ä¸”å°½å¯èƒ½çš„å°‘ç”¨çº¿ç¨‹ï¼Œé™ä½å¼€é”€ï¼Œä»£è¡¨æœ‰Node.jsï¼Œä¼šå¯¹æµç¨‹è¿›è¡Œåˆ†å‰²</p></li><li><p>åç¨‹</p><p>æœ¬è´¨æ˜¯ç”¨æˆ·æ€çº¿ç¨‹ï¼Œä¸éœ€è¦æŠ¢å å¼è°ƒåº¦ï¼Œå¯„å­˜äºçº¿ç¨‹ï¼Œç¼ºç‚¹æ˜¯éœ€è¦è¯­è¨€æ”¯æŒ</p></li></ol><p> <strong><u>gorountine</u></strong></p><p>é€šè¿‡åœ¨ä»£ç ä¸­åŠ ä¸Šgoå…³é”®å­—å¯ç”¨åç¨‹ï¼Œä¸»ç¨‹åºç»“æŸæ—¶ï¼Œå†™æˆä¼šè¢«ç»“æŸ</p><p>é€šä¿¡æ–¹å¼ï¼šæ¶ˆæ¯æœºåˆ¶å’Œå…±äº«å†…å­˜</p><p>æ¶ˆæ¯æœºåˆ¶ï¼šæ¯ä¸ªå¹¶å‘å•ä½éƒ½æ˜¯è‡ªåŒ…å«ã€ç‹¬ç«‹çš„ä¸ªä½“ï¼Œéƒ½æœ‰è‡ªå·±çš„å˜é‡ï¼Œå¹¶ä¸”å•å…ƒé—´çš„å˜é‡ä¸å…±äº«ï¼Œæ¯ä¸ªå•å…ƒçš„è¾“å…¥è¾“å‡ºåªæœ‰ä¸€ç§é‚£å°±æ˜¯æ¶ˆæ¯ã€‚ä¸åŒè¿›ç¨‹ä¾é æ¶ˆæ¯æ¥è¿›è¡Œé€šä¿¡ï¼Œä»–ä»¬ä¸ä¼šå…±äº«å†…å­˜</p><p><strong><u>channel</u></strong></p><p>Goæä¾›çš„goroutineé—´çš„é€šä¿¡æ–¹å¼ï¼Œæ˜¯è¿›ç¨‹å†…çš„é€šä¿¡æ–¹å¼ï¼Œä¸é€‚åˆè¿›ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡</p><p>ä¸€ä¸ªchannel åªèƒ½ä¼ é€’ä¸€ç§ç±»å‹çš„å€¼</p><p>åŸºæœ¬è¯­æ³•</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">//å£°æ˜</span><span class="token keyword">var</span> chanName <span class="token keyword">chan</span> ElemenType <span class="token comment">//ä¾‹å¦‚ å£°æ˜ä¸€ä¸ªä¼ é€’ç±»å‹ä¸ºintçš„channel</span><span class="token keyword">var</span> ch <span class="token keyword">chan</span> <span class="token builtin">int</span> <span class="token comment">//å®šä¹‰</span>ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span> <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">//ç¼“å†²å¤§å°ä¸º2</span><span class="token comment">//å†™å…¥channel</span>ch <span class="token operator">&lt;-</span> value <span class="token comment">//å†™å…¥æ•°æ®ä¼šå¯¼è‡´é™ˆå­¤è™šé˜»å¡ï¼Œç›´åˆ°æœ‰å…¶ä»–goroutine ä»channelä¸­è¯»å–æ•°æ®</span><span class="token comment">//è¯»å–</span>value <span class="token operator">:=</span> <span class="token operator">&lt;-</span> ch <span class="token comment">// å¦‚æœchannelä¸­æ²¡æœ‰æ•°æ®ä¹Ÿä¼šè¿›è¡Œå µå¡</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token string">"fmt"</span><span class="token keyword">func</span> <span class="token function">Count</span><span class="token punctuation">(</span>ch <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Counting"</span><span class="token punctuation">)</span>ch <span class="token operator">&lt;-</span> <span class="token number">1</span> <span class="token comment">//å†™å…¥æ•°æ®,å¯¼è‡´è¿™ä¸ªgoroutineé˜»å¡ï¼Œç›´åˆ°æœ‰å…¶ä»–goroutineä»ä¸­è¯»å–æ•°æ®</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>chs <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// å‚¨å­˜åä¸ªgoroutineçš„channelæ•°ç»„</span><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>chs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token comment">//å¯åŠ¨åä¸ªåç¨‹</span><span class="token keyword">go</span> <span class="token function">Count</span><span class="token punctuation">(</span>chs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> ch <span class="token operator">:=</span> <span class="token keyword">range</span> chs <span class="token punctuation">{</span><span class="token operator">&lt;-</span>ch <span class="token comment">//è¯»å–channel</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>select</p><p>æ–‡ä»¶å‘ç”ŸIOåŠ¨ä½œï¼Œselectä¼šè¢«è°ƒç”¨å¹¶è¿”å›</p><p>è¯­æ³•ï¼š æ¡ä»¶å¿…é¡»æ˜¯IOæ“ä½œ</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">select</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> <span class="token operator">&lt;-</span> chan1 <span class="token punctuation">:</span> <span class="token comment">//ä»chan1æˆåŠŸè¯»å–åˆ°æ•°æ®</span>    <span class="token keyword">case</span> chan2 <span class="token operator">&lt;-</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token comment">//æˆåŠŸå‘chan2å†™å…¥æ•°æ®</span>    <span class="token keyword">default</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token string">"fmt"</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">for</span> j <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">{</span><span class="token comment">//éšæœºå‘ch ä¸­å†™å…¥ä¸€ä¸ª1æˆ–è€…æ˜¯0</span><span class="token keyword">select</span> <span class="token punctuation">{</span><span class="token keyword">case</span> ch <span class="token operator">&lt;-</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token keyword">case</span> ch <span class="token operator">&lt;-</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">}</span>i <span class="token operator">:=</span> <span class="token operator">&lt;-</span>chfmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Value Received :"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¼“å†²æœºåˆ¶</p><p>å»ºç«‹channelæ•°ç»„å³å¯å®ç°ç¼“å†²</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">ch <span class="token operator">:=</span> <span class="token builtin">make</span> <span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span> <span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¶…æ—¶æœºåˆ¶</p><p>Goä¸­æ²¡æœ‰æä¾›æŸ¥å®å¤„ç†æœºåˆ¶ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨selectæ¥å¤„ç†ï¼Œå› ä¸ºselectåªè¦æœ‰ä¸€ä¸ªcaseå·²ç»å®Œæˆå³å¯ç»§ç»­è¿›è¡Œä¸‹å»</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"fmt"</span><span class="token string">"time"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token comment">//æœªå†™å…¥ä»»ä½•æ•°æ®ï¼Œæ‰€ä»¥ä¼šæŠŠç¨‹åºå µå¡</span>timeout <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//ç­‰å¾…ä¸€ç§’é’Ÿ</span>time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1e9</span><span class="token punctuation">)</span>timeout <span class="token operator">&lt;-</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">select</span> <span class="token punctuation">{</span><span class="token keyword">case</span> <span class="token operator">&lt;-</span>ch<span class="token punctuation">:</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"è¯»å–ä¸­"</span><span class="token punctuation">)</span><span class="token keyword">case</span> <span class="token operator">&lt;-</span>timeout<span class="token punctuation">:</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"è¶…æ—¶äº†"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><u>channel ä¼ é€’ï¼Œå¯ä»¥ç”¨æ¥å®ç°pipe å¾…è¡¥å……</u></p><p>å•å‘channel  ç”¨äºé˜²æ­¢å†™å…¥æŸäº›ä¸éœ€è¦çš„æ•°æ®æˆ–è€…è¢«ä¸éœ€è¦çš„å‡½æ•°è¯»å–</p><p>åªèƒ½è¯»æˆ–è€…åªèƒ½å†™</p><p>å®šä¹‰</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> ch1 <span class="token keyword">chan</span> <span class="token builtin">int</span> <span class="token comment">//æ­£å¸¸çš„channel</span><span class="token keyword">var</span> ch2 <span class="token keyword">chan</span> <span class="token operator">&lt;-</span> <span class="token builtin">float64</span> <span class="token comment">// åªèƒ½å†™</span><span class="token keyword">var</span> ch3 <span class="token operator">&lt;-</span> <span class="token keyword">chan</span> <span class="token builtin">int</span> <span class="token comment">//åªèƒ½è¯»</span><span class="token comment">//åˆå§‹åŒ–</span>ch4 <span class="token operator">:=</span> <span class="token builtin">make</span> <span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token comment">// æ­£å¸¸</span>ch5 <span class="token operator">:=</span>  <span class="token operator">&lt;-</span> <span class="token keyword">chan</span> <span class="token builtin">int</span> <span class="token punctuation">(</span>ch4<span class="token punctuation">)</span> <span class="token comment">// ä»æ­£å¸¸çš„channelè¿›è¡Œç±»å‹è½¬åŒ–ä¸ºå•é¡¹è¯»å–çš„channel</span>ch6 <span class="token operator">:=</span>  <span class="token keyword">chan</span> <span class="token operator">&lt;-</span> <span class="token builtin">int</span> <span class="token punctuation">(</span>ch4<span class="token punctuation">)</span> <span class="token comment">// è½¬åŒ–ä¸ºå•é¡¹å†™å…¥çš„channel</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…³é—­channel</p><p>ä½¿ç”¨close()å³å¯</p><p>å¦‚ä½•åˆ¤æ–­å·²ç»å…³é—­?</p><p>å¤šé‡è¿”å›å€¼çš„æ–¹å¼è¿›è¡Œå¸•åŠªçš„é‚£</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">x <span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span> ch<span class="token comment">//åªéœ€è¦çœ‹okå³å¯ï¼Œå¦‚æœchå·²ç»å…³é—­ï¼Œé‚£ä¹ˆè¯»å–å¤±è´¥ï¼Œokçš„è¿”å›å€¼ä¸ºfalse </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="åŒæ­¥é—®é¢˜"><a href="#åŒæ­¥é—®é¢˜" class="headerlink" title="åŒæ­¥é—®é¢˜"></a>åŒæ­¥é—®é¢˜</h4><p>åŒæ­¥é”</p><p>syncåŒ…ä¸­æä¾›</p><p>Mutexé”</p><p>å½“ä¸€ä¸ªgoroutine è·å¾—äº†Mutex åï¼Œå…¶ä»–çš„goroutine åªèƒ½ç­‰å¾…è¿™ä¸ªé‡Šæ”¾é”</p><p>RWMutex é” </p><p>å•å†™å¤šè¯» ï¼Œ åœ¨è¯»é”å ç”¨æ—¶ï¼Œä¼šé˜»æ­¢å†™ï¼Œä½†æ˜¯ä¸ä¼šé˜»æ­¢è¯»</p><p>å…¨å±€å”¯ä¸€æ€§æ“ä½œ</p><p>ä½¿ç”¨Onceç±»å‹ï¼Œå½“åˆ«çš„goroutine </p><h2 id="ç½‘ç»œç¼–ç¨‹"><a href="#ç½‘ç»œç¼–ç¨‹" class="headerlink" title="ç½‘ç»œç¼–ç¨‹"></a>ç½‘ç»œç¼–ç¨‹</h2><h3 id="Socketç¼–ç¨‹-IP-å±‚"><a href="#Socketç¼–ç¨‹-IP-å±‚" class="headerlink" title="Socketç¼–ç¨‹  IP å±‚"></a>Socketç¼–ç¨‹  IP å±‚</h3><p>socketæ˜¯ä»€ä¹ˆï¼Ÿ</p><blockquote><p>Socketæ˜¯å¯¹TCP/IPåè®®çš„å°è£…ï¼Œè‡ªèº«å¹¶éåè®®è€Œæ˜¯ä¸€å¥—è°ƒç”¨çš„æ¥å£è§„èŒƒï¼ˆAPIï¼‰ã€‚é€šè¿‡å¥—æ¥å­—Socketï¼Œæ‰èƒ½ä½¿ç”¨TCP/IPåè®®ã€‚</p></blockquote><p>ä¼ ç»Ÿçš„Socketç¼–ç¨‹ä¸»è¦æ­¥éª¤ï¼š</p><ol><li>å»ºç«‹Socketï¼š ä½¿ç”¨socket() å‡½æ•°</li><li>ç»‘å®šSocket :ä½¿ç”¨bind() å‡½æ•°</li><li>ç›‘å¬ï¼š ä½¿ç”¨listen() å‡½æ•°ï¼Œæˆ–è€…connec() å‡½æ•°</li><li>æ¥å—è¿æ¥ï¼š accept() å‡½æ•°</li><li>æ¥æ”¶ï¼š receive() å‡½æ•° ï¼Œå‘é€send() å‡½æ•°</li></ol><p>Goçš„ï¼š</p><p>Goè¯­è¨€æ ‡å‡†åº“å¯¹æ­¤è¿‡ç¨‹è¿›è¡Œäº†æŠ½è±¡å’Œå°è£…ï¼Œæ— è®ºæˆ‘ä»¬æœŸæœ›ä½¿ç”¨ä»€ä¹ˆå½¢å¼çš„è¿æ¥ï¼Œåªéœ€è¦è°ƒç”¨net.Dial()å³å¯</p><p>DialåŸå‹</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> Dial <span class="token punctuation">(</span> net <span class="token punctuation">,</span> addr <span class="token builtin">string</span> <span class="token punctuation">)</span> <span class="token punctuation">(</span> Conn <span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token comment">/*net : ç½‘è·¯åè®®åç§°addr IPåœ°å€æˆ–åŸŸåï¼Œç«¯å£ä»¥":" çš„å½¢å¼è·Ÿåœ¨åé¢ï¼Œç«¯å£å·å¯é€‰Conn æ˜¯å¦æˆåŠŸè¿æ¥*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å·¥ç¨‹ç®¡ç†"><a href="#å·¥ç¨‹ç®¡ç†" class="headerlink" title="å·¥ç¨‹ç®¡ç†"></a>å·¥ç¨‹ç®¡ç†</h2><p>ä»£ç æ ¼å¼åŒ–</p><p>æ ¼å¼åŒ–ä¹‹å‰çš„ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token string">"fmt"</span><span class="token keyword">func</span> Foo <span class="token punctuation">(</span> a <span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ret <span class="token builtin">int</span> <span class="token punctuation">,</span>err <span class="token builtin">error</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span> a<span class="token operator">&gt;</span>b <span class="token punctuation">{</span><span class="token keyword">return</span> a <span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">return</span> b <span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token boolean">nil</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>i <span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Hello,word"</span> <span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨å‘½ä»¤è¡Œ: go fmt xxx.goå¾—åˆ°çš„ä»£ç ,ä¹Ÿå¯ä»¥ç›´æ¥go fmt ä¼šæ ¼å¼åŒ–æ‰€æœ‰*.goçš„æ–‡ä»¶</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token string">"fmt"</span><span class="token keyword">func</span> <span class="token function">Foo</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>ret <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span> a <span class="token operator">&gt;</span> b <span class="token punctuation">{</span><span class="token keyword">return</span> a<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">return</span> b<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>i<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Hello,word"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>gotool</p><p>ç”Ÿæˆexe</p><p>gobuild åé¢å¯ä»¥åŠ ä¸Š-o + name æŒ‡å®šæ‰§è¡Œæ–‡ä»¶çš„åå­—</p><p><strong>æ ¼å¼åŒ–è¾“å‡º</strong>: Printf</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token operator">%</span>væŒ‰å€¼çš„æœ¬æ¥å€¼è¾“å‡º<span class="token operator">%</span><span class="token operator">+</span>våœ¨ <span class="token operator">%</span>v åŸºç¡€ä¸Šï¼Œå¯¹ç»“æ„ä½“å­—æ®µåå’Œå€¼è¿›è¡Œå±•å¼€<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç”Ÿæˆéšæœºæ•°éœ€è¦è®¾ç½®éšæœºæ•°ç§å­</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>v <span class="token operator">:=</span> <span class="token number">100</span>rand<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¾èµ–ç®¡ç†"><a href="#ä¾èµ–ç®¡ç†" class="headerlink" title="ä¾èµ–ç®¡ç†"></a>ä¾èµ–ç®¡ç†</h2><h1 id="Gin"><a href="#Gin" class="headerlink" title="Gin"></a>Gin</h1>]]></content>
      
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Githubå­¦ç”ŸåŒ…/å­¦ç”Ÿè®¤è¯ç”³è¯·é‚£äº›äº‹</title>
      <link href="/2023/06/18/28/"/>
      <url>/2023/06/18/28/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h2><blockquote><p>Githubå¯¹å­¦ç”Ÿæœ‰å¾ˆå¤šä¼˜æƒ ï¼Œ<del>è‡³äºå“ªäº›å¯å¤ªå¤šäº†ï¼Œæ‰€ä»¥æœ‰å¿…è¦ç”³è¯·ä¸€ä¸ª</del>ï¼Œ</p><p>è¿™ä¸ªå¤§ä½¬å†™çš„å¾ˆè¯¦ç»†äº†ï¼Œæˆ‘åœ¨è¿™é‡ŒåŠ ä¸€äº›æˆ‘è¸©å¾—å‘ï¼Œå¦‚æœè·Ÿå¤§ä½¬çš„æ­¥éª¤èµ°æ²¡é€šè¿‡çš„è¯ï¼Œå¯ä»¥å›æ¥çœ‹çœ‹æœ‰æ²¡æœ‰æˆ‘è¸©è¿‡çš„å‘</p><p><a href="https://zhuanlan.zhihu.com/p/617001126">2023.3ç”³è¯·github copilot x å­¦ç”Ÿè®¤è¯ä»¥åŠJetbrainä¸“ä¸šç‰ˆå­¦ç”Ÿæ•™è‚²å…è´¹æ•™ç¨‹ - çŸ¥ä¹ (zhihu.com)</a></p></blockquote><h2 id="å‰ææ¡ä»¶ï¼š"><a href="#å‰ææ¡ä»¶ï¼š" class="headerlink" title="å‰ææ¡ä»¶ï¼š"></a>å‰ææ¡ä»¶ï¼š</h2><blockquote><ol><li>ä¸€ä¸ªå¥½çš„æµè§ˆå™¨(æ”¯æŒå®šä½çš„æµè§ˆå™¨)</li><li>ä¸€ä»½å­¦ä¿¡ç½‘å­¦ç±è®¤è¯ å’Œ ä¸€ä¸ªæ•™è‚²é‚®ç®±(æ›´å®¹æ˜“é€šè¿‡ ï¼Œå¯ä»¥å»ä¼ä¸šå¾®ä¿¡é‡Œçœ‹çœ‹æœ‰æ²¡æœ‰å¼€é€š)</li><li>ä¿®æ”¹pdfæ–‡ä»¶ä¸­çš„ä¿¡æ¯</li><li>github profile ä¸­ä¿®æ”¹ä¸ªäººä¿¡æ¯</li><li>è®¤è¯å¹¶ä¸”å…¨ç¨‹ä¸è¦æŒ‚æ¢¯å­</li></ol></blockquote><h2 id="1-å¥½çš„æµè§ˆå™¨"><a href="#1-å¥½çš„æµè§ˆå™¨" class="headerlink" title="1.å¥½çš„æµè§ˆå™¨"></a>1.å¥½çš„æµè§ˆå™¨</h2><p><strong>è¿™æ˜¯é‡ä¸­ä¹‹é‡ï¼Œæˆ‘åœ¨ç”³è¯·çš„æ—¶å€™ä¸çŸ¥é“Chromeæ€ä¹ˆäº†ï¼Œä¸€ç›´å®šä½ä¸æˆåŠŸï¼Œæ¢æˆ edgeä¹‹åå°±æˆåŠŸäº†</strong></p><h2 id="2-å­¦ä¿¡ç½‘è®¤è¯"><a href="#2-å­¦ä¿¡ç½‘è®¤è¯" class="headerlink" title="2.å­¦ä¿¡ç½‘è®¤è¯"></a>2.å­¦ä¿¡ç½‘è®¤è¯</h2><p>è¿›å…¥å­¦ä¿¡ç½‘ï¼Œä¸‹è½½ç”µå­æŠ¥å‘Šå³å¯ï¼Œç½‘ä¸Šéƒ½æœ‰æ•™ç¨‹ï¼Œè¿™é‡Œä¸åšèµ˜è¿°äº†</p><p><a href="https://www.chsi.com.cn/">ä¸­å›½é«˜ç­‰æ•™è‚²å­¦ç”Ÿä¿¡æ¯ç½‘ï¼ˆå­¦ä¿¡ç½‘ï¼‰ (chsi.com.cn)</a></p><h2 id="3-ä¿®æ”¹pdfæ–‡ä»¶ä¿¡æ¯"><a href="#3-ä¿®æ”¹pdfæ–‡ä»¶ä¿¡æ¯" class="headerlink" title="3.ä¿®æ”¹pdfæ–‡ä»¶ä¿¡æ¯"></a>3.ä¿®æ”¹pdfæ–‡ä»¶ä¿¡æ¯</h2><p>å› ä¸ºgithubä¸æ˜¯å›½å†…çš„ï¼Œæ‰€ä»¥ä¸­æ–‡æ¡£æ¡ˆæ˜¯ä¸èƒ½é€šè¿‡çš„ï¼Œè€Œä¸”pdfç¼–è¾‘å¥½åƒå¾ˆéš¾æï¼Œè¿™é‡Œç»™ä¸€ä¸ªä¸‹è½½é“¾æ¥ï¼Œä½¿ç”¨è¿™ä¸ªè¿›è¡Œç¼–è¾‘ä¼šæ–¹ä¾¿äº›</p><p>å¯†ç ï¼štko9</p><p><a href="https://cloud.189.cn/web/share?code=ZNbamiEziq6z">Adobe CC 2022 å…è´¹é«˜é€Ÿä¸‹è½½ | å¤©ç¿¼äº‘ç›˜ çè—ç¾å¥½ç”Ÿæ´» å®¶åº­äº‘|ç½‘ç›˜|æ–‡ä»¶å¤‡ä»½|èµ„æºåˆ†äº« (189.cn)</a></p><p><img src="/2023/06/18/28/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230618200641.png" alt="ä¸‹è½½å®‰è£…å³å¯"></p><p>ä¿®æ”¹å†…å®¹ï¼š</p><p><a href="https://zhuanlan.zhihu.com/p/617001126">2023.3ç”³è¯·github copilot x å­¦ç”Ÿè®¤è¯ä»¥åŠJetbrainä¸“ä¸šç‰ˆå­¦ç”Ÿæ•™è‚²å…è´¹æ•™ç¨‹ - çŸ¥ä¹ (zhihu.com)</a></p><p>å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« </p><h2 id="4-ä¿®æ”¹github-profile-ä¸­çš„ä¿¡æ¯"><a href="#4-ä¿®æ”¹github-profile-ä¸­çš„ä¿¡æ¯" class="headerlink" title="4.ä¿®æ”¹github profile ä¸­çš„ä¿¡æ¯"></a>4.ä¿®æ”¹github profile ä¸­çš„ä¿¡æ¯</h2><ul><li>åå­—æ”¹ä¸ºè‹±æ–‡å</li><li>Bio ä¿®æ”¹ä¸º   student of å­¦æ ¡è‹±æ–‡å + @ å­¦æ ¡è‹±æ–‡å</li><li>company ä¿®æ”¹ä¸ºå­¦æ ¡è‹±æ–‡å</li></ul><h2 id="5-ç”³è¯·ï¼š"><a href="#5-ç”³è¯·ï¼š" class="headerlink" title="5.ç”³è¯·ï¼š"></a>5.ç”³è¯·ï¼š</h2><p>ç½‘ç«™ï¼š<a href="https://education.github.com/discount_requests/application">Request a discount - GitHub Education</a></p><p><strong><u>å…¨ç¨‹ä¸è¦æŒ‚æ¢¯å­</u></strong></p><ol><li><p>æ·»åŠ æ•™è‚²é‚®ç®± </p><p><img src="/2023/06/18/28/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230618201441.png" alt="æ·»åŠ é‚®ç®±"></p></li><li><p>å¡«å†™ç”³è¯·ç†ç”±ï¼Œç†ç”±éšä¾¿å†™ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„</p><pre class="line-numbers language-none"><code class="language-none">I would like to use the Github Student Pack to further explore more features of Github, such as Github Copilot and Educative's learning courses.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>ç‚¹å‡»continue </p><blockquote><p>ç‚¹å‡»ä¹‹åä¼šè¯¢é—®ä½ æ˜¯å¦å…è®¸è®¿é—®ä½ç½®ï¼ŒåŒæ„å³å¯</p><p><strong><u>å¦‚æœç‚¹å‡»ä¹‹åï¼Œä¸€ç›´å¡åœ¨è¿™ä¸ªé¡µé¢ï¼Œé‚£ä¹ˆæ˜¯æµè§ˆå™¨çš„é—®é¢˜ï¼Œå¯ä»¥æ¢ä¸ªæµè§ˆå™¨è¯•è¯•æˆ–è€…è¿‡å‡ å¤©å†è¯•è¯•</u></strong> </p><p><del>æˆ‘å°±æ˜¯æ¢äº†å¥½å‡ ä¸ªä¸æˆåŠŸï¼Œæœ€åè«åå…¶å¦™å°±èƒ½è®¿é—®äº†</del></p><p>ä¹‹åè¿›å…¥ä¸Šä¼ å›¾ç‰‡çš„é¡µé¢ï¼Œå³ä¸‹è§’æœ‰ä¸Šä¼ å›¾ç‰‡ <strong>(å¦‚æœä½ æ²¡æœ‰çš„è¯ï¼Œè¯´æ˜ä½ ä¸Šæ¢¯å­äº†æˆ–è€…ç¦»å­¦æ ¡å¤ªè¿œäº†ï¼Œç›´æ¥é‡æ–°è®¤è¯ä¸€éå§)</strong></p><p>ä¸Šä¼ ä¿®æ”¹ä¹‹åçš„å­¦ä¿¡ç½‘è®¤è¯æˆªå›¾</p><p><strong>æ³¨æ„ï¼šä¸Šä¼ å›¾ç‰‡æ ¼å¼æ˜¯jpg ä¸æ”¯æŒpngï¼ï¼ï¼</strong></p></blockquote></li><li><p>ç‚¹å‡»æäº¤ï¼Œå¦‚æœæŒ‰ä»¥ä¸Šæµç¨‹èµ°çš„è¯åº”è¯¥æ˜¯ç§’é€šè¿‡çš„ï¼Œçœ‹çœ‹é‚®ç®±æ˜¯å¦æ”¶åˆ°é‚®ä»¶ï¼Œæˆ–è€…è¿”å›è®¤è¯ç”³è¯·çš„ç¬¬ä¸€é¡µï¼Œçœ‹çœ‹å³ä¾§æ˜¯å¦é€šè¿‡</p><p><a href="https://education.github.com/discount_requests/application">Request a discount - GitHub Education</a></p></li></ol><h2 id="å†™åœ¨æœ€åï¼š"><a href="#å†™åœ¨æœ€åï¼š" class="headerlink" title="å†™åœ¨æœ€åï¼š"></a>å†™åœ¨æœ€åï¼š</h2><p>ä¸€å®šè¦æœ‰è€å¿ƒï¼Œä¸æŒ‚æ¢¯å­çš„è¯ï¼Œgithubçš„è®¿é—®åŸºæœ¬ä¸Šæ˜¯æ—¶æœ‰æ—¶æ— çš„ï¼Œæ‰€ä»¥è¦æœ‰è€å¿ƒï¼Œå¤šè¯•è¯•ï¼Œè¿‡å‡ å¤©å†è¯•è¯•ï¼Œæ¨èåœ¨å­¦æ ¡é‡Œç”³è¯·ï¼Œæˆ–è€…ä½¿ç”¨å­¦æ ¡çš„vpnè®¿é—®ç½‘ç«™</p><p>ç¥é€šè¿‡ï¼ï¼ï¼</p><p><img src="/2023/06/18/28/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230618202519.png" alt="Elysiaä¼šç¥ç¦ä½ çš„"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webå­¦ä¹ </title>
      <link href="/2023/06/17/01/"/>
      <url>/2023/06/17/01/</url>
      
        <content type="html"><![CDATA[<h1 id="æ–°å‘-åˆ°P83é¡µäº†ã€‚ã€‚ã€‚"><a href="#æ–°å‘-åˆ°P83é¡µäº†ã€‚ã€‚ã€‚" class="headerlink" title="æ–°å‘  åˆ°P83é¡µäº†ã€‚ã€‚ã€‚"></a>æ–°å‘  åˆ°P83é¡µäº†ã€‚ã€‚ã€‚</h1><h2 id="HTML5åŸºæœ¬è¯­æ³•"><a href="#HTML5åŸºæœ¬è¯­æ³•" class="headerlink" title="HTML5åŸºæœ¬è¯­æ³•"></a>HTML5åŸºæœ¬è¯­æ³•</h2><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span> ä¸€ä¸ªæ¨ªçº¿<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span> ç”¨äºä¸ºinput å…ƒç´ è¿›è¡Œæ ‡æ³¨ å…¶ for å±æ€§åº”ä¸è¦ç»‘å®šçš„å…ƒç´ çš„idç›¸åŒï¼Œformå±æ€§ç”¨äºè§„å®šå…¶å±äºå“ªä¸ªæˆ–è€…å¤šä¸ªè¡¨å•<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--æ–‡æ¡£å£°æ˜ï¼Œç›®çš„æ˜¯è®©æµè§ˆå™¨çŸ¥é“è¿™æ˜¯ä»€ä¹ˆç±»å‹çš„æ–‡ä»¶--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--æ–‡æ¡£çš„å¼€å§‹ï¼Œæ²¡æœ‰ä»€ä¹ˆå®é™…å«ä¹‰--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--å¤´æ ‡è®°ï¼Œæ”¾åœ¨html å†…æ¥é˜²æ­¢è¿™ä¸ªæ–‡ä»¶ä¸­çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æä¾›ç´¢å¼•ä¿¡æ¯æˆ–è€…å®šä¹‰CSSæ ·å¼ç­‰--&gt;</span>         <span class="token comment">&lt;!--æ ‡é¢˜æ ‡è®°ï¼Œç½‘é¡µçš„æ ‡é¢˜ï¼Œä¹Ÿå°±æ˜¯ä¸Šæ–¹çš„æ ‡~ é¢˜ï¼Œä¸æ˜¯å†…å®¹çš„æ ‡é¢˜--&gt;</span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>                    æˆ‘çš„æµ‹è¯•æ–‡ä»¶        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--æ–‡æ¡£æ­£æ–‡çš„å¼€å§‹--&gt;</span> <span class="token comment">&lt;!--æ–‡æœ¬å±æ€§ä¸­å¯ä»¥åŠ å…¥text æ¥è¡¨ç¤ºæ–‡æœ¬çš„é¢œè‰²ï¼Œbgcoloræ¥è¡¨ç¤ºèƒŒæ™¯çš„é¢œè‰²--&gt;</span>        <span class="token comment">&lt;!-- &lt;body text="red" bgcolor="blue"&gt;--&gt;</span>        <span class="token comment">&lt;!--hn å„ç§å¤§å°æ ‡é¢˜--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>font</span> <span class="token attr-name">color</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>blue<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--è®¾ç½®å­—ä½“é¢œè‰²--&gt;</span>                è“è‰²çš„ä¸€çº§æ ‡é¢˜            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>font</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!--æ®µè½æ ‡è®°--&gt;</span>            è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ–‡å­—æ ·å¼æ ‡è®°--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--åŠ ç²—--&gt;</span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!--æ–œä½“--&gt;</span>            è¿™æ˜¯åŠ ç²—æ–œä½“å­—         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--åˆ é™¤çº¿--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>s</span><span class="token punctuation">&gt;</span></span>åˆ é™¤çº¿<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>s</span><span class="token punctuation">&gt;</span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--ä¸‹åˆ’çº¿--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>u</span><span class="token punctuation">&gt;</span></span>ä¸‹åˆ’çº¿<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>u</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ”¾å¤§ç¼©å°ï¼ŒåŠ å¼ºå¼ºè°ƒï¼Œå¼ºè°ƒï¼Œç°å®ç”µå­é‚®ä»¶æˆ–è€…åœ°å€ï¼Œå†™ä»£ç --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>big</span><span class="token punctuation">&gt;</span></span>æ”¾å¤§<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>big</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>small</span><span class="token punctuation">&gt;</span></span>ç¼©å°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>small</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--åŠ å¼ºå¼ºè°ƒ--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>åŠ å¼ºå¼ºè°ƒ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>å¼ºè°ƒ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>address</span><span class="token punctuation">&gt;</span></span>2354796263@qq.com<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>address</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span>            #include &lt;bits/stdc++.h&gt;            using namespace std;            int main(){                cout &lt;&lt; "Hello World!"&lt;&lt; endl;                return 0;            }        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ–‡å­—ä¸Šæµ®å’Œä¸‹æµ®--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>æ–‡å­—<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sup</span><span class="token punctuation">&gt;</span></span>ä¸Šæµ®<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sup</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sub</span><span class="token punctuation">&gt;</span></span>ä¸‹æµ®<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sub</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ–‡å­—æ ·å¼æ ‡è®°--&gt;</span>        <span class="token comment">&lt;!--æ–‡æœ¬çš„ä½ç½®--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>center</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>font</span> <span class="token attr-name">color</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>red<span class="token punctuation">"</span></span> <span class="token attr-name">face</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>å®‹ä½“<span class="token punctuation">"</span></span> <span class="token attr-name">size</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>7<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> å®ç°å±…ä¸­<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>font</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>center</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--font è¿˜å¯ä»¥è®¾ç½®å­—ä½“å’Œå¤§å°ï¼Œå±æ€§æ˜¯ face å’Œ size--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span>  <span class="token attr-name">align</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>right<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>font</span> <span class="token attr-name">color</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>blue<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>å®ç°å³ä¾§<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>font</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--ç…§ç‰‡çš„æ“ä½œ--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>source/image/Elysia.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>å›¾ç‰‡ä¸¢å¤±æ—¶æ˜¾ç¤º<span class="token punctuation">"</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>é¼ æ ‡æ”¾åœ¨ä¸Šé¢å¯ä»¥çœ‹åˆ°<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å¯¼èˆªèœå•</strong></p><pre class="line-numbers language-css" data-language="css"><code class="language-css">ä½¿ç”¨&lt;ul&gt; + &lt;li&gt; + &lt;a&gt; å³å¯ï¼Œä¹‹ååœ¨cssä¸­è¿›è¡Œè®¾ç½®æ ·å¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>è®¾ç½®è¡¨æ ¼:</strong></p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>è¡¨æ ¼ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span> å®šä¹‰ä¸€è¡Œ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>col</span><span class="token punctuation">&gt;</span></span> å®šä¹‰ä¸€åˆ— <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span> å®šä¹‰ä¸€ä¸ªå•å…ƒæ ¼  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>caption</span><span class="token punctuation">&gt;</span></span> è¡¨æ ¼çš„å¤§æ ‡é¢˜ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span> è¡¨å¤´ï¼Œä¸»è¦ç”¨äºè¡Œæˆ–åˆ—çš„åç§°ï¼Œ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span> ä¸<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span> ç›¸ä¼¼å®ä¾‹:     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">border</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">cellspacing</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">bgcolor</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>#eeeeee<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>caption</span><span class="token punctuation">&gt;</span></span>æˆç»©è¡¨<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>caption</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--å¼€å§‹å®šä¹‰è¡¨å¤´--&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>å§“å<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>æ€§åˆ«<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>æˆç»©<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>å¼ ä¸‰<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>ç”·<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>114<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>æå››<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>ç”·<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>514<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>    ä½¿ç”¨<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span> ä¸­çš„rowspan å’Œ colspan æ¥åˆå¹¶å•å…ƒæ ¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è®¾ç½®è¡¨å•</strong></p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span> å’Œ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span><span class="token punctuation">&gt;</span></span> ä¸¤ä¸ªæ ‡ç­¾å®ä¾‹ï¼š    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        å§“åï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>    type = "text"    name è®¾å®šæ–‡æœ¬æ¡†çš„åç§°ï¼Œåœ¨äº¤äº’ç¨‹åºä¸­å¯ä»¥ç”¨åˆ°    size æ•°å€¼ï¼Œè®¾å®šæ­¤ä¸€æ ä½è¦æ˜¾ç¤ºçš„å®½åº¦    value é¢„è®¾å†…å®¹    maxlength è®¾ç½®æ–‡æœ¬å¯è¾“å…¥çš„æœ€å¤§æœ€å¤§æ–‡å­—é•¿åº¦     type å±æ€§å†…å®¹:    type = "radioâ€œ å•é€‰    å¯é€‰å±æ€§ï¼š    checked è®¾ç½®æŸä¸ªé€‰é¡¹ä¸ºé»˜è®¤é€‰    name  nameå±æ€§å†…å®¹ç›¸åŒçš„ä¸¤ä¸ªé€‰é¡¹åªèƒ½é€‰ä¸­ä¸€ä¸ª    type = "checkbox" å¤šé€‰    å¯é€‰    checked    name éœ€è¦å°†ä¸€ç»„é€‰ä¸­ä¸­çš„æ‰€æœ‰å¤é€‰æŒ‰é’®è®¾ç½®ä¸ºç›¸åŒçš„åç§°æ‰èƒ½è®©æœåŠ¡å™¨å¤„ç†æ—¶çŸ¥é“è¿™å‡ ä¸ªé€‰é¡¹æ˜¯ä¸€ä¸ªç»„çš„    type = "password" å¯†ç æ¡†    å±æ€§ä¸æ–‡æœ¬ç±»å‹ç›¸åŒ    type = "submit" æäº¤æŒ‰é’®    type = "reset"  é‡ç½®æŒ‰é’®    type = "image"  æäº¤å›¾ç‰‡    type = "textarea" å¤šè¡Œæ–‡æœ¬æ¡†å¯é€‰ï¼š    cols å®šä¹‰æ–‡æœ¬æ¡†çš„å®½åº¦ï¼Œå­—ç¬¦çš„åˆ—æ•°    rows å­—ç¬¦è¡Œæ•°    wrap å®šä¹‰æ¢è¡Œæ–¹å¼ ä¸»è¦æœ‰ off æ–‡å­—ä¸è‡ªåŠ¨æ¢è¡Œï¼Œ virtual è¾“å…¥æ–‡å­—æ—¶ä¼šè‡ªåŠ¨æ¢è¡Œï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰è‡ªå·±æŒ‰ä¸‹å›è½¦é”®æ¢è¡Œï¼Œæäº¤åˆ°æœåŠ¡å™¨æ—¶ç»“æœå°±æ—¶æ²¡æœ‰æ¢è¡Œ    physical è‡ªåŠ¨æ¢è¡Œï¼Œæäº¤åˆ°æœåŠ¡å™¨ç»“æœä¹Ÿæ˜¯æ¢è¡Œ    åˆ—è¡¨æ¡†ï¼š    åœ¨formä¸­ä½¿ç”¨ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span><span class="token punctuation">&gt;</span></span> æ ‡ç­¾    åœ¨<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span><span class="token punctuation">&gt;</span></span> ä¸­ä½¿ç”¨<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span><span class="token punctuation">&gt;</span></span>æ¥è®¾ç½®é€‰é¡¹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>## class çš„ç”¨æ³•ï¼š- ä¸€ä¸ªå¯¹è±¡å¯ä»¥åŒ…å«å¤šä¸ªclass(æ–¹ä¾¿äº†åœ¨CSSä¸­å®šä¹‰)  ```css   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">          <span class="token selector">.Ely</span><span class="token punctuation">{</span>              <span class="token property">font-size</span><span class="token punctuation">:</span>larger<span class="token punctuation">;</span>          <span class="token punctuation">}</span>          <span class="token selector">.red</span><span class="token punctuation">{</span>              <span class="token property">color</span> <span class="token punctuation">:</span> purple<span class="token punctuation">;</span>          <span class="token punctuation">}</span>      </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Ely red<span class="token punctuation">"</span></span> <span class="token attr-name">align</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>center<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>Elysia  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>small</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>small</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2><ol><li><p>åŸºæœ¬è§„åˆ™:</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">å¼ é£{    èº«é«˜ï¼š    ä½“é‡ï¼š    æ€§åˆ«    æ°‘æ—}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>é€‰æ‹©å™¨</p><blockquote><p>å¯¹ç½‘é¡µä¸­æŒ‡å®šçš„å¯¹è±¡è¿›è®¾ç½®</p></blockquote><ul><li><p>æ ‡è®°é€‰æ‹©å™¨ï¼šæ‰€æœ‰åŒåçš„æ ‡ç­¾éƒ½ä¼šè¢«é€‰æ‹©</p><p>ä½¿ç”¨html çš„æ ‡è®°æ ‡ç­¾è¿›è¡Œé€‰æ‹©ï¼Œä¾‹å¦‚ï¼š<code>&lt;p&gt;</code></p><p>åŸºæœ¬è¯­æ³•ï¼š</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">&lt;style&gt;h1</span> <span class="token punctuation">{</span>     æ ‡ç­¾é€‰æ‹©    å£°æ˜    <span class="token property">color</span> <span class="token punctuation">:</span>red <span class="token punctuation">;</span>  å±æ€§ + å€¼    <span class="token property">font_size</span> <span class="token punctuation">:</span>25px<span class="token punctuation">;</span>    <span class="token punctuation">}</span>&lt;/style&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç±»åˆ«é€‰æ‹©å™¨ï¼šå®ç°åªä¿®æ”¹æŒ‡å®šçš„æ ‡ç­¾class</p><p>åŸºæœ¬è¯­æ³•ï¼š</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.class</span> <span class="token punctuation">{</span> . + ç±»åˆ«å<span class="token punctuation">(</span>è‡ªå®šä¹‰çš„åå­—<span class="token punctuation">)</span> å£°æ˜   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>IDé€‰æ‹©å™¨ï¼Œ**<u>idåœ¨HTMLä¸­å…·æœ‰å”¯ä¸€æ€§ï¼Œä¸å¯é‡å¤ï¼Œå°½é‡åšåˆ°ä¸€ä¸ªæ ‡ç­¾ä¸€ä¸ªid</u>**</p><p><strong><u>ãƒ½ï¼ˆâ‰§â–¡â‰¦ï¼‰ãƒ</u></strong></p></li></ul></li><li><p>HTMLä¸­ä½¿ç”¨æ–¹æ³•ï¼š</p><ul><li><p>è¡Œå†…å¤®è§†ï¼Œç›´æ¥ä½¿ç”¨ <code>&lt;style&gt;</code>å±æ€§ <strong><u>æ³¨æ„ï¼Œæ¯ä¸€ä¸ªå£°æ˜ä¹‹åè¦åŠ å…¥åˆ†å·</u></strong></p><pre class="line-numbers language-css" data-language="css"><code class="language-css">&lt;p style=<span class="token string">"color : purple; font-size :larger"</span> align = <span class="token string">"center"</span>&gt;Elysia    &lt;/p&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å†…åµŒå¼ä¸€èˆ¬æ”¾åœ¨ <code>&lt;head&gt;</code> æ ‡ç­¾ä¹‹é—´</p></li></ul><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">&lt;head&gt;    &lt;style type="text/css"&gt;        .Ely</span><span class="token punctuation">{</span>            <span class="token property">font-size</span><span class="token punctuation">:</span>larger<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token selector">.red</span><span class="token punctuation">{</span>            <span class="token property">color</span> <span class="token punctuation">:</span> purple<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    &lt;/style&gt;&lt;/head&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>é“¾æ¥å¼ï¼Œå°†CSSä¸HTMLæ–‡ä»¶åˆ†ç¦» åœ¨htmlä¸­ä½¿ç”¨ <code>&lt;link&gt;</code> æ ‡ç­¾è¿›è¡Œ å¯¼å…¥</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">&lt;link rel=<span class="token string">"stylesheet"</span> href=<span class="token string">"æ–‡ä»¶åœ°å€"</span>&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å¯¼å…¥å¼ ä½¿ç”¨@import åœ¨htmlåˆå§‹åŒ–æ—¶å°±ä¼šè¿›è¡Œå¯¼å…¥ï¼Œè€Œä½¿ç”¨é“¾æ¥å¼åªæœ‰åœ¨éœ€è¦æ ¼å¼æ—¶æ‰è¿›è¡Œå¯¼å…¥</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/*éœ€è¦æ”¾åœ¨style æ ‡ç­¾ä¸­*/</span>&lt;style&gt;        <span class="token atrule"><span class="token rule">@import</span> <span class="token string">"1.css"</span><span class="token punctuation">;</span></span>    &lt;/style&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>Tips:CSSä¸­éµå¾ªè¦†ç›–è§„åˆ™ï¼Œå¯¹äºåŒä¸€ä¸ªè¢«é€‰æ‹©çš„å¯¹è±¡ï¼Œåé¢çš„å®šä¹‰ä¼šè¦†ç›–å‰é¢çš„å®šä¹‰ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨æ ‡ç­¾è¿›è¡Œå…¨å±€å®šä¹‰ï¼Œåœ¨ä½¿ç”¨class æ¥å¯¹æŒ‡å®šçš„å¯¹è±¡è¿›è¡Œå¾®è°ƒ</p></li><li><p>Tips2:ä¼˜å…ˆçº§</p><p>æœ€åé¢å¯¼å…¥çš„æ ·å¼    &gt;   æœ€åé¢çš„è¿æ¥å¼ ï¼Œ é“¾æ¥å¼ä¸  <code>&lt;style&gt;</code> éµå¾ªå…ˆåé¡ºåºï¼Œ åŒä¸€ä¸ª <code>&lt;style&gt;</code> ä¸­å†…åµŒå¼   &gt;    å¯¼å…¥å¼</p></li><li><p>CSS3æ–°ç‰¹æ€§ï¼š</p><p>äº¤é›†é€‰æ‹©å™¨ï¼š</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">Ely</span><span class="token punctuation">{</span>    <span class="token property">color</span> <span class="token punctuation">:</span>purple<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">p</span><span class="token punctuation">{</span>    <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">p.Ely</span><span class="token punctuation">{</span>    <span class="token property">color</span> <span class="token punctuation">:</span>blue<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¹¶é›†é€‰æ‹©å™¨ï¼šä½¿ç”¨  ï¼Œ è¿›è¡Œéš”å¼€å³å¯</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">p,.Ely,h5</span><span class="token punctuation">{</span>    <span class="token property">color</span> <span class="token punctuation">:</span>blue<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>å…¨å±€é€‰æ‹©å™¨ï¼š*  ä½¿å¾—æ‰€æœ‰HTMLæ ‡ç­¾éƒ½éµå¾ªè¿™ä¸ªè§„åˆ™</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">*</span><span class="token punctuation">{</span>    <span class="token property">color</span> <span class="token punctuation">:</span>blue<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>åä»£é€‰æ‹©å™¨ï¼Œç©ºæ ¼éš”å¼€å³å¯</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">li ul</span> <span class="token punctuation">{</span>    <span class="token property">color</span> <span class="token punctuation">:</span>blue<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">li ul ul</span> <span class="token punctuation">{</span>    <span class="token property">color</span> <span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">li ul ul ul</span> <span class="token punctuation">{</span>    <span class="token property">color</span> <span class="token punctuation">:</span> purple<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åªå¯¹ç›´æ¥åä»£æœ‰ç”¨çš„é€‰æ‹©å™¨ï¼š p &gt;   å¯æ­é…*ä½¿ç”¨</p></li><li><p>ID é€‰æ‹©å™¨ï¼š#+id</p></li><li><p>ç›¸é‚»é€‰æ‹©å™¨ï¼šA+B ç›´æ¥å…„å¼Ÿï¼Œç´§è·Ÿç€çš„åé¢é‚£ä¸ª</p></li><li><p>ç›¸é‚»å…„å¼Ÿç»„é€‰æ‹©å™¨ï¼šA~B åé¢çš„æ‰€æœ‰å…„å¼Ÿ</p></li><li><p>å±æ€§é€‰æ‹©å™¨ï¼š ä½¿ç”¨ä¸­æ‹¬å·è¿›è¡Œé€‰æ‹©ï¼Œå±æ€§æ˜¯è‡ªå®šä¹‰çš„</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">&lt;p ely = <span class="token string">"123"</span>&gt;æœ€å–œæ¬¢çˆ±è‰å¸Œé›…äº†&lt;/p&gt;  <span class="token comment">/*è¿™é‡Œelyæ˜¯è‡ªå®šä¹‰çš„å±æ€§ï¼Œå®ƒçš„å€¼æ˜¯123*/</span><span class="token selector">p[ely]</span><span class="token punctuation">{</span> <span class="token comment">/*ä½¿ç”¨è¿™ä¸ªè¿›è¡Œé€‰æ‹©ï¼Œå³å¯*/</span>    <span class="token property">color</span> <span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/*ä¹Ÿå¯ä»¥ä½¿ç”¨å±æ€§+å±æ€§çš„å€¼æ¥è¿›è¡Œé€‰æ‹©*/</span><span class="token comment">/*éœ€è¦å±æ€§çš„å€¼å¿…é¡»æ˜¯ç»™å®šçš„è¿™ä¸ªå€¼*/</span><span class="token selector">p[ely = "123"]</span><span class="token punctuation">{</span>    <span class="token property">color</span> <span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/*å±æ€§åŒ…å«é€‰æ‹©å™¨ï¼Œåªéœ€è¦å±æ€§çš„å€¼åŒ…å«ç»™å®šçš„å€¼çš„å³å¯*/</span><span class="token selector">p[ely *= "1"]</span><span class="token punctuation">{</span>    <span class="token property">color</span> <span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token punctuation">}</span>&lt;p ely = <span class="token string">"123 4 5 6"</span>&gt;æœ€å–œæ¬¢çˆ±è‰å¸Œé›…äº†&lt;/p&gt;<span class="token comment">/*å•è¯åŒ…å«é€‰æ‹©å™¨ ï¼Œ åªè¦åŒ…å«ç»™å®šå•è¯å³å¯*/</span><span class="token selector">p[ely ~= "123"]</span><span class="token punctuation">{</span>    <span class="token property">color</span> <span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/*ä»¥æŸä¸ªå•è¯æˆ–è€…å­—æ¯å¼€å¼€å¤´çš„é€‰æ‹©å™¨*/</span><span class="token selector">p[ely ^= "1"]</span><span class="token punctuation">{</span>    <span class="token property">color</span> <span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/*ä»¥ä»€ä¹ˆç»“å°¾çš„é€‰æ‹©å™¨ï¼Œåªè¦ä»¥æŸä¸ªå•è¯ç»“å°¾æˆ–åˆ™å’ŒæŸä¸ªå­—æ¯ç»“å°¾å³å¯ï¼Œæ•°å­—ä¹Ÿè¡Œ*/</span><span class="token selector">p[ely $= "6"]</span><span class="token punctuation">{</span>    <span class="token property">color</span> <span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong><u>ç»“æ„ä¼ªç±»é€‰æ‹©å™¨</u></strong></p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/*åŸºæœ¬è¯­æ³•ï¼š Eæ˜¯çˆ¶å…ƒç´ E : nth - child ç¬¬å‡ ä¸ªå…ƒç´ E : root æ ¹å…ƒç´ ï¼ŒHTMLä¸­æ ¹å…ƒç´ å§‹ç»ˆä¸ºhtmlè¿˜æœ‰å¾ˆå¤šã€‚ã€‚ã€‚è‡ªå·±å»çœ‹å§ ç»™ä¸ªé“¾æ¥ï¼šhttps://juejin.cn/post/7001869576069873695*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong><u>ä¼ªå…ƒç´ é€‰æ‹©å™¨  <del>å¾…è¡¥</del></u></strong></p></li></ol><h3 id="CSSç»§æ‰¿å’Œå±‚å ç‰¹æ€§"><a href="#CSSç»§æ‰¿å’Œå±‚å ç‰¹æ€§" class="headerlink" title="CSSç»§æ‰¿å’Œå±‚å ç‰¹æ€§"></a>CSSç»§æ‰¿å’Œå±‚å ç‰¹æ€§</h3><p>å­æ ‡è®°ä¼šç»§æ‰¿å¤«æ ‡è®°çš„æ‰€æœ‰æ ·å¼é£æ ¼ï¼Œä½†æ˜¯å­æ ‡è®°çš„æ”¹å˜ä¸ä¼šå½±å“çˆ¶æ ‡è®°</p><p>å±‚å æ˜¯å‡ºç°å†²çªæ—¶çš„å¤„ç†æ–¹å¼ï¼Œè¶Šç‰¹æ®Šçš„æ ·å¼ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œ</p><p>å±‚å ä¼˜å…ˆçº§ï¼šè¡Œå†…æ ·å¼&gt; ID æ ·å¼ &gt; ç±»åˆ«æ ·å¼ &gt;  æ ‡è®°æ ·å¼</p><h2 id="CSSè®¾ç½®æ–‡æœ¬æ ·å¼"><a href="#CSSè®¾ç½®æ–‡æœ¬æ ·å¼" class="headerlink" title="CSSè®¾ç½®æ–‡æœ¬æ ·å¼"></a>CSSè®¾ç½®æ–‡æœ¬æ ·å¼</h2><h3 id="å•ä½ï¼š"><a href="#å•ä½ï¼š" class="headerlink" title="å•ä½ï¼š"></a>å•ä½ï¼š</h3><ol><li><p>ç›¸å¯¹ç±»å‹ï¼š</p><p>px : åƒç´ ï¼Œæ ¹æ®è®¾å¤‡ç±»åˆ†è¾¨ç‡æ¥è¿›è¡Œè°ƒæ•´ï¼Œæœ€å¸¸ç”¨çš„</p><p>em: è®¾ç½®ä»¥ç›®å‰å­—ç¬¦çš„é«˜åº¦ä¸ºå•ä½</p><p>rem: root em è®¾ç½®ä»¥ç½‘é¡µè·Ÿå…ƒç´ HTML å­—ç¬¦çš„é«˜åº¦ä¸ºå•ä½ï¼Œ ä¸€èˆ¬æµè§ˆå™¨è«é»˜è®¤å•ä½ä¸º <u><strong>1rem = 16px</strong></u></p><p>vw å’Œ vh åŸºäºè§†å›¾çª—å£çš„ç›¸å¯¹å•ï¼Œ 1vw ç­‰äºè§†å£å®½åº¦çš„1% 1vh ç­‰äºçª—å£é«˜åº¦çš„çš„1%</p></li><li><p>ç»å¯¹ç±»å‹</p><p>in è‹±å°º</p><p>cm å˜ç±³</p><p>mm </p><p>pt ç‚¹æ•°</p><p>pc å°åˆ·å•ä½ 1pc = 12pt</p></li></ol><h3 id="é¢œè‰²ï¼š"><a href="#é¢œè‰²ï¼š" class="headerlink" title="é¢œè‰²ï¼š"></a>é¢œè‰²ï¼š</h3><p>HTMLä¸­ç»Ÿä¸€ä½¿ç”¨RGBæ¨¡å¼ï¼ŒåŸºæœ¬è®¾ç½® rgb(red, green , blue , é€æ˜åº¦ )</p><h3 id="åŸºæœ¬è®¾ç½®ï¼š"><a href="#åŸºæœ¬è®¾ç½®ï¼š" class="headerlink" title="åŸºæœ¬è®¾ç½®ï¼š"></a>åŸºæœ¬è®¾ç½®ï¼š</h3><blockquote><p>font-family : è®¾ç½®å­—ä½“</p><p>font-style : è®¾ç½®æ–œä½“</p><p>font-weight: è®¾ç½®åŠ ç²—ï¼Œå‚æ•°æœ‰ normal, bold(åŠ ç²—) , bolder(æ›´ç²—),lighter(æ›´ç»†), 100- 900 æŒ‰æ¯100ä¸ºä¸ºä¸€ä¸ªé˜¶æ®µï¼Œæ•°å­—è¶Šå¤§ï¼Œå­—ä½“è¶Šç²—</p><p>font-transformï¼š å¤§å°å†™è½¬æ¢</p><p>font-size:å­—ä½“å¤§å°</p><p>text-decoration:æ–‡å­—çš„ä¿®é¥°ï¼Œä¸»è¦æœ‰underline ä¸‹åˆ’çº¿ï¼Œline-through åˆ é™¤çº¿,overlineä¸ºæ–‡å­—åŠ é¡¶çº¿ï¼Œblink æ–‡å­—é—ªçƒ(éƒ¨åˆ†æµè§ˆå™¨æ”¯æŒ)</p><p>texr-indentï¼šé¦–è¡Œç¼©è¿›ï¼Œåé¢è·Ÿç¼©è¿›çš„é•¿åº¦ï¼Œä¸€èˆ¬ä½¿ç”¨2emæ¥å®ç°ç¼©è¿›ä¸¤ä¸ªå­—</p><p>letter-spacingï¼š æ§åˆ¶å­—æ¯é—´è·</p><p>word-sacing:æ§åˆ¶å•è¯é—´è·</p><p>line-height: è¡Œé«˜</p><p>border :æ·»åŠ è¾¹æ¡†ï¼Œå¯ä»¥è®¾ç½®ç²—ç»†ï¼Œé¢œè‰²å’Œè™šå®</p><p>margin å¤–è¾¹æ¡† åé¢ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯è®¾ç½®ä¸Šä¸‹è·ç¦»å’Œå·¦å³è·ç¦»</p><p>text-align : è®¾ç½®æ–‡æœ¬çš„æ°´å¹³ä½ç½®ï¼Œleft,right,center, justify(ä¸¤ç«¯å¯¹é½)</p><p>background: è®¾ç½®èƒŒæ™¯è‰²</p><p>text-shadow: ç»™å›¾ç‰‡æ·»åŠ é˜´å½±æ•ˆæœï¼Œåé¢å››ä¸ªå‚æ•°æ˜¯xè½´çš„åç§»å°ºå¯¸ï¼Œyè½´çš„ä¾¿å®œå°ºå¯¸ï¼Œé˜´å½±åŠå¾„ï¼Œé˜´å½±é¢œè‰²</p></blockquote><h3 id="é¢œè‰²"><a href="#é¢œè‰²" class="headerlink" title="é¢œè‰²"></a>é¢œè‰²</h3><ul><li>rgba () ç¬¬å››ä¸ªå‚æ•°æ˜¯é€æ˜åº¦</li></ul><h2 id="CSSè®¾ç½®å›¾ç‰‡å±æ€§"><a href="#CSSè®¾ç½®å›¾ç‰‡å±æ€§" class="headerlink" title="CSSè®¾ç½®å›¾ç‰‡å±æ€§"></a>CSSè®¾ç½®å›¾ç‰‡å±æ€§</h2><blockquote><p>border-width è®¾ç½®è¾¹æ¡†çš„ç²—ç»†</p><p>border-color  è®¾ç½®è¾¹æ¡†çš„é¢œè‰²</p><p>border-style  çº¿æ€§ï¼Œå¯ä»¥åœ¨ä¸€äº›é¢„å…ˆå®šä¹‰å¥½çš„çº¿å‹ä¸­é€‰æ‹©</p><p>ä¹Ÿå¯ä»¥</p><p>border-ä¸Šä¸‹å·¦å³-å±æ€§   æ¥å•ç‹¬è®¾ç½®ä¸Šä¸‹å·¦å³çš„è¾¹æ¡†</p><p>ç”šè‡³å¯ä»¥ç›´æ¥border ï¼š åé¢å†™å¤§å°ç±»å‹å’Œé¢œè‰²</p><p>ä¾‹å¦‚ï¼š border : plum 2px dotted;</p><p>å®ç°æ–‡å­—ç¯ç»•ï¼š</p><p>float : å°†å›¾ç‰‡ç§»åŠ¨åˆ°é¡µé¢å·¦ä¾§æˆ–è€…å³ä¾§ä»è€Œä½¿å¾—æ–‡å­—èƒ½å¤Ÿä»å¦ä¸€ç«¯æ¥ç¯ç»•</p></blockquote><h2 id="ç›’æ¨¡å‹"><a href="#ç›’æ¨¡å‹" class="headerlink" title="ç›’æ¨¡å‹"></a>ç›’æ¨¡å‹</h2><p>DOM ï¼šdocument object model æ–‡æ¡£å¯¹è±¡æ¨¡å‹ ^eb3dd6</p><p>padding -border-margin æ¨¡å‹  (é¡ºåºæ˜¯ä¸Šå³ä¸‹å·¦) </p><ul><li><strong>Margin(å¤–è¾¹è·)</strong>&nbsp;- æ¸…é™¤è¾¹æ¡†å¤–çš„åŒºåŸŸï¼Œå¤–è¾¹è·æ˜¯é€æ˜çš„ã€‚</li><li><strong>Border(è¾¹æ¡†)</strong>&nbsp;- å›´ç»•åœ¨å†…è¾¹è·å’Œå†…å®¹å¤–çš„è¾¹æ¡†ã€‚</li><li><strong>Padding(å†…è¾¹è·)</strong>&nbsp;- æ¸…é™¤å†…å®¹å‘¨å›´çš„åŒºåŸŸï¼Œå†…è¾¹è·æ˜¯é€æ˜çš„ã€‚</li><li><strong>Content(å†…å®¹)</strong>&nbsp;- ç›’å­çš„å†…å®¹ï¼Œæ˜¾ç¤ºæ–‡æœ¬å’Œå›¾åƒã€‚</li></ul><p>ä¸€ä¸ªç›’æ¨¡å‹åŒ…æ‹¬ï¼šcontent(å†…å®¹) ã€padding(å†…è¾¹è·) ã€border(å†…å®¹çš„è¾¹æ¡†), margin (å¤–è¾¹è·)</p><p>æ ‡å‡†æ–‡æ¡£æµï¼šnormal  document stream  </p><blockquote><p>div  åŒºå—å®¹å™¨æ ‡è®°ï¼Œé‡Œé¢å¯ä»¥å®¹çº³å„ç§HTMLå…ƒç´ ï¼Œå¯ä»¥å°†divçœ‹ä½œä¸€ä¸ªå¯¹è±¡</p><p>span ä¹Ÿæ˜¯åŒºå—æ ‡è®°</p><p>äºŒè€…åŒºåˆ«ï¼š div å†…çš„å…ƒç´ å¯ä»¥è‡ªåŠ¨æ¢è¡Œï¼Œ</p><p>span ä¸ä¼šæ¢è¡Œï¼Œæ²¡ç»“æ„ä¸Šçš„æ„ä¹‰ï¼Œä»…ä»…æ˜¯ä¸€ä¸ªè¡Œå†…å…ƒç´ ï¼Œå½“å…¶ä»–è¡Œå†…å…ƒç´ ä¸é€‚åˆçš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨spanäº†</p><p>span å¯ä»¥åŒ…å«åœ¨divä¸­ï¼Œä½†æ˜¯divä¸èƒ½åŒ…å«åœ¨span ä¸­ï¼Œä½¿ç”¨displayæ¥è®©è¡Œå†…å…ƒç´ è¡¨ç°çš„åƒå—çº§å…ƒç´ </p><p>ç›¸é‚»çš„ä¸¤ä¸ªè¡Œå†…å…ƒç´ çš„margin æ˜¯ç¬¬ä¸€ä¸ªçš„right-margin ç¬¬äºŒä¸ªçš„left-margin ä¹‹å’Œ</p></blockquote><h3 id="è¾¹è·æ§åˆ¶"><a href="#è¾¹è·æ§åˆ¶" class="headerlink" title="è¾¹è·æ§åˆ¶"></a>è¾¹è·æ§åˆ¶</h3><ul><li>border-bottom</li></ul><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><blockquote><p>background-image : url() æ’å…¥å›¾ç‰‡ï¼Œ</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå›¾ç‰‡ä¼šè‡ªåŠ¨å‘æ°´å¹³å’Œæ•°å€¼ä¸¤ä¸ªæ–¹å‘å¹³é“ºï¼Œå¯ä»¥ä½¿Â·ç”¨ä»¥ä¸‹å±æ€§æ¥è¿›è¡Œæ§åˆ¶</p><p>background-repeat : </p><p>repeat é»˜è®¤ï¼Œæ²¿æ°´å¹³å’Œç«–ç›´æ–¹å‘å¹³é“º</p><p>no-repeat ä¸å¹³é“ºï¼Œåªæ˜¾ç¤ºä¸€æ¬¡</p><p>repeat-x æ²¿æ°´å¹³å¹³é“º</p><p>repeat-y æ²¿ç«–ç›´æ–¹å‘å¹³é“º</p><p>background-position è®¾ç½®èƒŒæ™¯çš„ä½ç½®</p><p>ä¹Ÿæ˜¯å¯ä»¥åˆå¹¶ä¸ºä¸€è¡Œçš„: ç›´æ¥background + å±æ€§å³å¯</p><p>background-radiusï¼š æ¥è®¾ç½®ç›’æ¨¡å‹çš„å››ä¸ªè§’æ˜¯å¦åœ†æ»‘ ï¼Œ åé¢çš„å››ä¸ªå‚æ•°æ˜¯ä»å·¦ä¸Šè§’å¼€å§‹ï¼Œé¡ºæ—¶é’ˆæ—‹è½¬çš„</p><p>box-shadow ç»™ç›’æ¨¡å‹è®¾ç½®é˜´å½±ï¼Œ åé¢å››ä¸ªå‚æ•°åˆ†åˆ«æ˜¯æ°´å¹³åç§»é‡ï¼Œå‚ç›´åç§»é‡ï¼Œæ¨¡ç³Šï¼Œé˜´å½±æ‰©å±•å°ºå¯¸ï¼Œé˜´å½±é¢œè‰²ï¼Œå¤–éƒ¨é˜´å½±æˆ–è€…æ˜¯å†…éƒ¨é˜´å½±</p></blockquote><h2 id="background-å‡½æ•°"><a href="#background-å‡½æ•°" class="headerlink" title="background å‡½æ•°"></a>background å‡½æ•°</h2><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>direction<span class="token punctuation">,</span>æŒ‡å®šæ¸å˜æ–¹å‘<span class="token punctuation">,</span>color-stop1<span class="token punctuation">,</span>...<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é“¾æ¥ï¼š</p><h2 id="æƒ³è¦æ‰“å¼€ä¸€ä¸ªæ–°çš„çª—å£ï¼Œéœ€è¦åœ¨aæ ‡ç­¾ä¸­ä½¿ç”¨target-å±æ€§ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º-bank-å¯¹é¼ æ ‡çš„æ“ä½œè¿›è¡Œååº”çš„å…ƒç´ -ä»»ä½•htmlå…ƒç´ éƒ½èƒ½åšåˆ°-å¸¸è§„é€‰æ‹©å™¨-link-å¸¸è§„çŠ¶æ€-visited-ç‚¹å‡»è¿‡ä¹‹å-hover-æ‚¬åœçŠ¶æ€-active-ç‚¹å‡»æ—¶-ä½¿ç”¨CSSå¯¹è¶…é“¾æ¥è¿›è¡Œä¿®é¥°-text-decoration-åŒ…æ‹¬color-line-style-thickness"><a href="#æƒ³è¦æ‰“å¼€ä¸€ä¸ªæ–°çš„çª—å£ï¼Œéœ€è¦åœ¨aæ ‡ç­¾ä¸­ä½¿ç”¨target-å±æ€§ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º-bank-å¯¹é¼ æ ‡çš„æ“ä½œè¿›è¡Œååº”çš„å…ƒç´ -ä»»ä½•htmlå…ƒç´ éƒ½èƒ½åšåˆ°-å¸¸è§„é€‰æ‹©å™¨-link-å¸¸è§„çŠ¶æ€-visited-ç‚¹å‡»è¿‡ä¹‹å-hover-æ‚¬åœçŠ¶æ€-active-ç‚¹å‡»æ—¶-ä½¿ç”¨CSSå¯¹è¶…é“¾æ¥è¿›è¡Œä¿®é¥°-text-decoration-åŒ…æ‹¬color-line-style-thickness" class="headerlink" title="æƒ³è¦æ‰“å¼€ä¸€ä¸ªæ–°çš„çª—å£ï¼Œéœ€è¦åœ¨aæ ‡ç­¾ä¸­ä½¿ç”¨target å±æ€§ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º_bank### å¯¹é¼ æ ‡çš„æ“ä½œè¿›è¡Œååº”çš„å…ƒç´ (ä»»ä½•htmlå…ƒç´ éƒ½èƒ½åšåˆ°)å¸¸è§„é€‰æ‹©å™¨ + : +- link å¸¸è§„çŠ¶æ€- visited ç‚¹å‡»è¿‡ä¹‹å- hover æ‚¬åœçŠ¶æ€- active ç‚¹å‡»æ—¶### ä½¿ç”¨CSSå¯¹è¶…é“¾æ¥è¿›è¡Œä¿®é¥°- text-decoration åŒ…æ‹¬color,line,style,thickness"></a>æƒ³è¦æ‰“å¼€ä¸€ä¸ªæ–°çš„çª—å£ï¼Œéœ€è¦åœ¨aæ ‡ç­¾ä¸­ä½¿ç”¨target å±æ€§ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º_bank<br>### å¯¹é¼ æ ‡çš„æ“ä½œè¿›è¡Œååº”çš„å…ƒç´ (ä»»ä½•htmlå…ƒç´ éƒ½èƒ½åšåˆ°)<br>å¸¸è§„é€‰æ‹©å™¨ + : +<br>- link å¸¸è§„çŠ¶æ€<br>- visited ç‚¹å‡»è¿‡ä¹‹å<br>- hover æ‚¬åœçŠ¶æ€<br>- active ç‚¹å‡»æ—¶<br>### ä½¿ç”¨CSSå¯¹è¶…é“¾æ¥è¿›è¡Œä¿®é¥°<br>- text-decoration åŒ…æ‹¬color,line,style,thickness</h2><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">a</span><span class="token punctuation">{</span><span class="token comment">/*é€šç”¨*/</span>    <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/*ä»¥ä¸‹æ˜¯ä½¿ç”¨äº†CSSä¼ªç±»å‹å±æ€§æ¥è¿›è¡Œä¿®é¥°*/</span><span class="token comment">/*è®¾ç½®é¡ºå¯»æ—¶ LoVw HaTe çˆ±æ¨link visitedhoveractive*/</span><span class="token selector">a:link</span><span class="token punctuation">{</span> <span class="token comment">/*æ™®é€šæµè§ˆ*/</span>    <span class="token property">color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">a:visited</span><span class="token punctuation">{</span><span class="token comment">/*ç‚¹å‡»è¿‡ä¹‹å*/</span>    <span class="token property">color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">a:hover</span><span class="token punctuation">{</span>  <span class="token comment">/*é¼ æ ‡æŒ‡é’ˆç»è¿‡æ—¶*/</span>   <span class="token property">color</span><span class="token punctuation">:</span> plum<span class="token punctuation">;</span>   <span class="token property">text-decoration</span><span class="token punctuation">:</span> underline<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">a:active</span><span class="token punctuation">{</span><span class="token comment">/*ç‚¹å‡»æ—¶*/</span>    <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/filter">https://developer.mozilla.org/zh-CN/docs/Web/CSS/filter</a><br>ä¿®é¥°é¼ æ ‡æŒ‡é’ˆ</p><blockquote><p>cursor :å±æ€§å³å¯</p></blockquote><p>ä¿®é¥°åˆ—è¡¨</p><blockquote><p>list-style-typeï¼š</p><p>å±æ€§æœ‰ï¼š</p><p>disc å®å¿ƒåœ†ã€</p><p>circle ç©ºå¿ƒåœ†</p><p>square :æ­£æ–¹å½¢</p><p>decimal : åè¿›åˆ¶æ•°å­—</p><p>upper-alpha å¤§å†™å­—æ¯</p><p>lower-alpha å°å†™å­—æ¯</p><p>upper-roman å¤§å†™ç½—é©¬æ•°å­—</p><p>lower-roman å°å†™ç½—é©¬æ•°å­—</p><p>none ä¸æ˜¾ç¤ºä»»ä½•ç¬¦å·</p></blockquote><h2 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h2><pre class="line-numbers language-none"><code class="language-none">~~æ¯”èµ·cè¯­æ³•æ›´åƒæ˜¯Java~~ç»„æˆï¼šECMAScript,DOM , BOM1. ECMScript è¯­è¨€2. DOM æ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼Œä½¿ç”¨èŠ‚ç‚¹æ¥web3. BOM æµè§ˆå™¨å¯¹è±¡æ¨¡å‹### è¯­æ³•ï¼šåŒºåˆ†å¤§å°å†™ï¼Œå˜é‡æ— ç±»å‹ï¼Œåªéœ€è¦ä½¿ç”¨letè¿›è¡Œå£°æ˜å³å¯ï¼Œå¯åˆå§‹åŒ–ä¸ºä»»æ„ç±»å‹çš„å€¼### æ•°æ®ç±»å‹```jsnumber æ•°å­—åŒ…æ‹¬ï¼Œæ•´æ•°å°æ•°,NaN Not a Numberstringbooleannull å¯¹è±¡æœªç©ºundefined å½“å£°æ˜çš„å˜é‡æœªåˆå§‹åŒ–æ—¶è¯¥å˜é‡çš„é»˜è®¤å€¼ä½¿ç”¨typeof æ¥è·å–æ•°æ®çš„ç±»å‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨é‡Šä¸Cç›¸åŒ</p><p><strong>HTMLä¸­çš„è°ƒå–æ–¹å¼ï¼š</strong></p><p>1.ä½¿ç”¨ script æ ‡ç­¾ç›´æ¥è°ƒç”¨</p><p>2.é€šè¿‡ script ä¸­srcå±æ€§è¿›è¡Œè°ƒç”¨å¤–éƒ¨æ–‡ä»¶</p><p><strong>varå’Œletçš„åŒºåˆ«</strong></p><blockquote><p><strong>var å£°æ˜æ˜¯å…¨å±€ä½œç”¨åŸŸæˆ–å‡½æ•°ä½œç”¨åŸŸï¼Œè€Œ let å’Œ const æ˜¯å—ä½œç”¨åŸŸ</strong>ã€‚ var å˜é‡å¯ä»¥åœ¨å…¶èŒƒå›´å†…æ›´æ–°å’Œé‡æ–°å£°æ˜ï¼› let å˜é‡å¯ä»¥è¢«æ›´æ–°ä½†ä¸èƒ½é‡æ–°å£°æ˜ï¼› const å˜é‡æ—¢ä¸èƒ½æ›´æ–°ä¹Ÿä¸èƒ½é‡æ–°å£°æ˜ã€‚ å®ƒä»¬éƒ½è¢«æå‡åˆ°å…¶ä½œç”¨åŸŸçš„é¡¶ç«¯</p></blockquote><p><strong><u>åˆ¤æ–­</u></strong></p><p>JavaScriptä¸­ == åœ¨æ¯”è¾ƒä¸¤ä¾§å¯¹è±¡æ—¶ï¼Œå¦‚æœä¸åŒå—ï¼Œä¼šå°†å…¶è½¬åŒ–ä¸ºåŒä¸€ä¸ªç±»å‹å†æ¯”è¾ƒï¼Œè€Œ === ä¸¥æ ¼ç­‰äºä¸ä¼šå¼ºåˆ¶ç±»å‹è½¬æ¢</p><p>!=  ä¸ç­‰äº    !== ä¸ä¸¥æ ¼ç­‰äº</p><h3 id="jQuery"><a href="#jQuery" class="headerlink" title="jQuery"></a>jQuery</h3><blockquote><p>æ˜¯JavaScriptçš„ä¸€ä¸ªåº“ï¼Œç®€åŒ– äº†jsçš„æ“ä½œ</p></blockquote><p>åŒ…å«åŠŸèƒ½:</p><ul><li>HTML å…ƒç´ é€‰å–</li><li>HTML å…ƒç´ æ“ä½œ</li><li>CSS æ“ä½œ</li><li>HTML äº‹ä»¶å‡½æ•°</li><li>JavaScript ç‰¹æ•ˆå’ŒåŠ¨ç”»</li><li>HTML DOM éå†å’Œä¿®æ”¹</li><li>AJAX</li><li>Utilities<br>ä½¿ç”¨æ–¹å¼: æŸ¥è¯¢ä½¿ç”¨ç‰ˆæœ¬ï¼ŒF12æ‰“å¼€æ§åˆ¶å°ä¹‹åä»consoleä¸­è¾“å…¥$.fn.jquery å³å¯æŸ¥è¯¢<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;script src = "æœ¬åœ°çš„jQueryæ–‡ä»¶æˆ–è€…CDNçš„urlå³å¯"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>åŸºç¡€è¯­æ³•: é€šè¿‡é€‰å–HTMLå…ƒç´ å¯¹é€‰å–çš„å…ƒç´ æ‰§è¡Œæ“ä½œ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span> selector é€‰æ‹©ç¬¦ æŸ¥è¯¢å’ŒæŸ¥æ‰¾<span class="token constant">HTML</span>å…ƒç´ <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span> æ‰§è¡Œå¯¹å…ƒç´ çš„æ“ä½œ<span class="token comment">//ç¤ºä¾‹</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> éšè—å½“å‰å…ƒç´ <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"p"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  éšè—æ‰€æœ‰<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>å…ƒç´ <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"p.test"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">class</span> <span class="token operator">=</span> <span class="token string">"test"</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#test"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> id <span class="token operator">=</span> <span class="token string">"test"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>é˜²æ­¢åœ¨æ–‡æ¡£æœªå®Œå…¨åŠ åœ¨å°±ç»ªä¹‹å‰å°±è¿è¡ŒjQueryä»£ç ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¹‹ä¸€æ¥è§£å†³<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// å¼€å§‹å†™ jQuery ä»£ç ... </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>æˆ–è€…<span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// å¼€å§‹å†™ jQuery ä»£ç ... </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>é€‰æ‹©å™¨:</li><li><ul><li>æ‰€æœ‰å…ƒç´ </li></ul></li><li>this</li><li>.class </li><li>â€œ#idâ€</li><li>xxx:first ç¬¬å‡ ä¸ªxxxå…ƒç´ </li><li>åä»£ç”¨ç©ºæ ¼éš”å¼€</li><li>â€œ[herf]â€ é€‰å–å¸¦æœ‰herf å±æ€§çš„å…ƒç´ </li><li>â€œA[B=â€™Câ€™]â€ æˆ–è€… â€œA[B!=â€™Câ€™]â€ é€‰å–æ‰€æœ‰Bå±æ€§å€¼ä¸ºCæˆ–è€…ä¸ä¸ºCçš„Açš„å…ƒç´ </li><li>:button é€‰å–æ‰€æœ‰type = buttonçš„å…ƒç´ <br>å¸¸ç”¨çš„äº‹ä»¶æ–¹æ³•ï¼š</li><li>click()ç‚¹å‡»</li><li>dbclick()åŒå‡»</li><li>mouseenteré¼ æ ‡ç©¿è¿‡å…ƒç´ æ—¶ä¼šå‘ç”Ÿ</li><li>mouseleaveé¼ æ ‡ç¦»å¼€å…ƒç´ </li><li>mousedown é¼ æ ‡ç§»åŠ¨åˆ°å…ƒç´ ä¸Šå¹¶è¿›è¡ŒæŒ‰ä¸‹</li><li>mouseup æ¾å¼€é¼ æ ‡æŒ‰é”®</li><li>hoveræ‚¬åœ</li><li>focus è·å¾—ç„¦ç‚¹</li><li>blur å¤±å»ç„¦ç‚¹<br>æ•ˆæœ:</li><li>hideï¼Œéšè—ï¼Œshowæ˜¾ç¤º</li><li>toggle åœ¨hideå’Œshowä¹‹é—´è¿›è¡Œåˆ‡æ¢</li><li>fadeInæ·¡å…¥ï¼ŒfadeOut æ·¡å‡º, fade Toggle()åˆ‡æ¢æ·¡å…¥æ·¡å‡º</li><li>fade To() å…è®¸æ¸å˜ç»™ä¸é€æ˜åº¦</li><li>$(<em>selector</em>).fadeTo(<em>speed,opacity,callback</em>);</li><li>æ»‘åŠ¨ slideDownå‘ä¸‹æ»‘ï¼Œ slideUpå‘ä¸Šæ»‘, slideToggle()åˆ‡æ¢</li><li>åŠ¨ç”»æ“ä½œ: $(<em>selector</em>).animate({<em>params</em>}<em>,speed,callback</em>);</li><li>paramså®šä¹‰åŠ¨ç”»CSSå±æ€§ï¼Œå¯ä½¿ç”¨ç›¸å¯¹å€¼, +xxx</li><li>ä½¿ç”¨é˜Ÿåˆ—:<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">var</span> div<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> div<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">height</span><span class="token operator">:</span><span class="token string">'300px'</span><span class="token punctuation">,</span><span class="token literal-property property">opacity</span><span class="token operator">:</span><span class="token string">'0.4'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"slow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> div<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token string">'300px'</span><span class="token punctuation">,</span><span class="token literal-property property">opacity</span><span class="token operator">:</span><span class="token string">'0.8'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"slow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> div<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">height</span><span class="token operator">:</span><span class="token string">'100px'</span><span class="token punctuation">,</span><span class="token literal-property property">opacity</span><span class="token operator">:</span><span class="token string">'0.4'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"slow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> div<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token string">'100px'</span><span class="token punctuation">,</span><span class="token literal-property property">opacity</span><span class="token operator">:</span><span class="token string">'0.8'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"slow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>åœæ­¢åŠ¨ç”»: stop()</li><li>åŠ¨ç”»é“¾: è¿ç»­ç‚¹å³å¯ $(â€œ#p1â€).css(â€œcolorâ€,â€redâ€).slideUp(2000).slideDown(2000);</li></ul><h4 id="DOMæ“ä½œ"><a href="#DOMæ“ä½œ" class="headerlink" title="DOMæ“ä½œ"></a>DOMæ“ä½œ</h4><ul><li>text è®¾ç½®æˆ–è¿”å›æ‰€é€‰å…ƒç´ çš„æ–‡æœ¬å†…å®¹</li><li>html è®¾ç½®æˆ–è¿”å›æ‰€é€‰å…ƒç´ çš„å†…å®¹ åŒ…æ‹¬htmlæ ‡ç­¾</li><li>val  è®¾ç½®æˆ–è¿”å›è¡¨å•å­—æ®µçš„å€¼</li><li>attr è·å¾—å±æ€§å€¼</li><li>append åœ¨è¢«é€‰ä¸­å…ƒç´ çš„ç»“å°¾è¿½åŠ å†…å®¹</li><li>prepend åœ¨è¢«é€‰ä¸­å…ƒç´ çš„å¼€å¤´æ’å…¥å†…å®¹â€˜</li><li>after åœ¨è¢«é€‰ä¸­å…ƒç´ ä¹‹ååŠ å…¥å†…å®¹</li><li>before åœ¨è¢«é€‰ä¸­å…ƒç´ ä¹‹å‰åŠ å…¥å†…å®¹</li><li>remove åˆ é™¤å…ƒç´ </li><li>empty ä»è¢«é€‰ä¸­å…ƒç´ åˆ é™¤å­å…ƒç´ </li></ul><h4 id="æ“ä½œCSSç±»-è¦æå‰å®šä¹‰cssæ ·å¼æ‰èƒ½æ·»åŠ "><a href="#æ“ä½œCSSç±»-è¦æå‰å®šä¹‰cssæ ·å¼æ‰èƒ½æ·»åŠ " class="headerlink" title="æ“ä½œCSSç±» (è¦æå‰å®šä¹‰cssæ ·å¼æ‰èƒ½æ·»åŠ )"></a>æ“ä½œCSSç±» (è¦æå‰å®šä¹‰cssæ ·å¼æ‰èƒ½æ·»åŠ )</h4><ul><li>addClass å‘è¢«é€‰ä¸­å…ƒç´ æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªç±»</li><li>removeClass ä»è¢«é€‰ä¸­å…ƒç´ åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªç±»</li><li>toggleClass å¯¹è¢«é€‰ä¸­å…ƒç´ è¿›è¡Œæ·»åŠ /åˆ é™¤çš„åˆ‡æ¢æ“¦å¶å“¦åœ¨</li><li>css è®¾ç½®æˆ–è¿”å›æ ·å¼å±æ€§ (å¯ç›´æ¥æ·»åŠ å±æ€§å€¼)</li><li>$(â€œpâ€).css(â€œbackground-colorâ€,â€yellowâ€); </li><li>$(â€œpâ€).css({â€œbackground-colorâ€:â€yellowâ€,â€font-sizeâ€:â€200%â€})<br>å°ºå¯¸</li><li>width , height , (contextå¤§å°)</li><li>innerWidth , innerHight ,(å†…è¾¹æ¡†,padding)</li><li>outerWidth , outerHight (margin)<br>éå†DOMæ ‘</li></ul><ol><li>å‘ä¸Šéå†<ul><li>parent</li><li>parent å‘ä¸Šåˆ°æ ¹å…ƒç´ </li><li>parentsUntil è¿”å›ä»‹äºä¸¤ä¸ªç»™å®šå…ƒç´ ä¹‹é—´çš„ç¥–å…ˆå…ƒç´ </li></ul></li><li>å‘ä¸‹éå†<ul><li>children ç›´æ¥å­å…ƒç´ </li><li>find æŸ¥æ‰¾åˆ°æœ€åä¸€ä¸ªå…ƒç´ </li></ul></li><li>åŒçº§éå†<ul><li>siblings æ‰€æœ‰åŒçº§å…ƒç´ </li><li>next ä¸‹ä¸€ä¸ªåŒèƒå…ƒç´ </li><li>nextAll ä¸‹ä¸€ä¸ªæ‰€æœ‰åŒèƒ</li><li>nextUntil</li><li>jQuery prev(), prevAll() &amp; prevUntil()</li></ul></li><li>è¿‡æ»¤<ul><li>first è¢«é€‰å…ƒç´ çš„é¦–ä¸ªå…ƒç´ </li><li>last</li><li>eqè¿”å›éƒ½å¸¦æœ‰æŒ‡å®šç´¢å¼•å·çš„å…ƒç´ (ç´¢å¼•ä»0å¼€å§‹)</li><li>filter è¿‡æ»¤æ¡ä»¶</li><li>not</li></ul></li></ol><h3 id="jQuery-AJAXä½¿ç”¨"><a href="#jQuery-AJAXä½¿ç”¨" class="headerlink" title="jQuery AJAXä½¿ç”¨"></a>jQuery AJAXä½¿ç”¨</h3><ul><li>load ä»æœåŠ¡å™¨åŠ åœ¨æ•°æ®å¹¶æŠŠè¿”å›çš„æ•°æ®æ”¾å…¥å¤‡é€‰å…ƒç´ ä¸­</li><li>$(selector).load(URL,data,callback)</li><li>get() post()<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"demo_test.php"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span>status</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®: "</span> <span class="token operator">+</span> data <span class="token operator">+</span> <span class="token string">"\nçŠ¶æ€: "</span> <span class="token operator">+</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">///////////////////////////////////////</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> $<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/try/ajax/demo_test_post.php"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">"èœé¸Ÿæ•™ç¨‹"</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">"http://www.runoob.com"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span>status</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®: \n"</span> <span class="token operator">+</span> data <span class="token operator">+</span> <span class="token string">"\nçŠ¶æ€: "</span> <span class="token operator">+</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><hr><p>ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">===</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¾“å‡ºä¸º</span><span class="token boolean">true</span> <span class="token boolean">false</span> <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">!=</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//ä¸è¿›è¡Œç±»å‹è½¬æ¢</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">!==</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿›è¡Œç±»å‹è½¬æ¢</span><span class="token comment">//è¾“å‡ºä¸º:</span><span class="token boolean">false</span><span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>for of è¯­å¥ (å’Œforeach ä¸€æ ·)</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span>a <span class="token keyword">of</span> b<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>for in  æšä¸¾å¯¹è±¡çš„çš„å±æ€§</p><p>å‡½æ•°ï¼šä¸¤ç§å†™æ³•</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">name</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token comment">//æˆ–è€…</span><span class="token function-variable function">name</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ä½¿ç”¨argumenså¯¹è±¡ï¼Œå¯ä»¥ ä¸ç”¨å£°æ˜å½¢å‚çš„åç§°</p><p>arguments[0] å³ä¸ºç¬¬ä¸€ä¸ªå½¢å‚</p><p>arguments.length() å¯ä»¥è·å¾—ä¼ å…¥å‡½æ•°ä¸­çš„å‚é‡ä¸ªæ•°ï¼Œä»è€Œç”¨äºåˆ¤æ–­ã€‚</p><p><strong><u>ç®­å¤´å‡½æ•°(ç±»ä¼¼äºLambdaè¡¨è¾¾å¼)</u></strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token function-variable function">name</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">å‚æ•°</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>ç±»æ˜¯å…·æœ‰ç›¸åŒå±æ€§å’ŒåŠŸèƒ½çš„â€œå¯¹è±¡â€ çš„æŠ½è±¡</strong></p><p><strong>å¯¹è±¡æ˜¯ä»ç±»ä¸­åˆ›å»ºçš„å®ä¾‹</strong></p><p>å±æ€§æ˜¯å¯¹è±¡ä¸­çš„å˜é‡</p><p>æ–¹æ³•æ˜¯ç±»ä¸­çš„å‡½æ•°</p><p>å¼•ç”¨ç±»å‹ï¼šBoolean ï¼Œ Number å’ŒString ç±»æ¯”Java</p><p>å¯¹è±¡ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token literal-property property">xxx</span> <span class="token operator">:</span> xxx  <span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>èµ‹å€¼</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> myCar <span class="token operator">=</span> <span class="token punctuation">{</span>   <span class="token literal-property property">size</span> <span class="token operator">:</span> <span class="token string">"large"</span><span class="token punctuation">,</span>   <span class="token literal-property property">color</span> <span class="token operator">:</span> <span class="token string">"blue"</span><span class="token punctuation">,</span>   <span class="token function-variable function">eat</span> <span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"åƒåƒåƒ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> <span class="token punctuation">{</span>size <span class="token punctuation">,</span> color<span class="token punctuation">}</span> <span class="token operator">=</span> myCar<span class="token punctuation">;</span> <span class="token comment">// åŒåå¯ç”¨è¿™ç§æ–¹å¼ä¸€é”®èµ‹å€¼</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h3><h4 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h4><p>   æ•°ç»„è¿›è¡Œå¤åˆ¶:</p>   <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span> <span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>a<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token comment">//è¡¥å……ï¼Œå¯¹è±¡å¤åˆ¶</span><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span> <span class="token operator">:</span> <span class="token string">"Bob"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span>obj<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>   JavaScriptä¸­æ•°ç»„å†…å®¹çš„ç±»å‹å¯ä»¥ä¸ä¸€è‡´</p><p>   è§£æ„æ•°ç»„ï¼š</p><p>   arrayçš„å‡½æ•°</p><ul><li><p>push , pop</p></li><li><p>unshift() ä»å¤´éƒ¨å¢åŠ  shift() ä»å¤´éƒ¨å¼€å§‹åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›</p></li><li><p>splice(start , deleteCount) åˆ é™¤æŒ‡å®šä½ç½® ç¬¬äºŒä¸ªå‚æ•°å¯é€‰ï¼Œå¹¶ä¸”ä»£è¡¨è¦åˆ é™¤å‡ ä¸ªå…ƒç´ </p></li><li><p>sort</p></li><li><p>indexOf() ä»å¤´å¼€å§‹æŸ¥æ‰¾ lastIndexOf () ä»å°¾å¼€å§‹æŸ¥æ‰¾ï¼Œä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯è¦æŸ¥æ‰¾çš„å†…å®¹å’Œå¼€å§‹æŸ¥æ‰¾çš„ä½ç½®</p></li><li><p>forEach() ä¸ºæ¯ä¸€ä¸ªå…ƒç´ æ‰§è¡Œä¸€ä¸ªå‡½æ•°</p></li><li><p>map() è¿”å›ä¸€ä¸ªç”±æŒ‡å®šå‡½æ•°è°ƒç”¨åå¾—åˆ°çš„æ–°æ•°ç»„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span> <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> b <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>      <span class="token keyword">return</span> e <span class="token operator">*</span><span class="token number">2</span> <span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//ä½¿ç”¨mapå»ºç«‹ä¸€ä¸ªæ–°æ•°ç»„</span>   <span class="token keyword">for</span> <span class="token punctuation">(</span>a <span class="token keyword">of</span> b<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span>   <span class="token keyword">let</span> c <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token comment">//filterç”¨äºè¿‡æ»¤æ•°ç»„çš„æŸäº›æ•°æ®</span>   <span class="token keyword">for</span> <span class="token punctuation">(</span>a <span class="token keyword">of</span> c<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span>   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å°å‡ºäº†map[a[]] = b[]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>every æ¯ä¸ªå…ƒç´ éƒ½å½“ä½œå‚æ•°ï¼Œæ‰€æœ‰éƒ½æ»¡è¶³æ‰è¿”å›true</p></li><li><p>some éƒ¨åˆ†æ»¡è¶³å³å¯true</p></li><li><p>slice æˆªå–ä¸€éƒ¨åˆ†</p></li><li><p>joint(â€˜,â€™) å°†æ•°ç»„è½¬åŒ–ä¸ºå­—ç¬¦ä¸²å¹¶è¿”å›</p></li><li><p>å±•å¼€è¿ç®—ç¬¦  æ•°ç»„[â€¦] å³å¯å±•å¼€</p></li></ul><p>   Map</p><ul><li>set(â€œkeyâ€ ,â€valueâ€)</li><li>for (let [key , value] of map)</li><li>for (let key of map)   for (let value of map)</li><li>forEach(å‡½æ•°)</li><li>åˆå¹¶ è‡ªå·±çœ‹æ–‡æ¡£å–½</li></ul><p>   Set</p><ul><li>add</li><li>å¹¶é›†ï¼Œäº¤é›†ï¼Œå·®é›† è‡ªå·±çœ‹</li></ul><h3 id="BOMå¯¹è±¡"><a href="#BOMå¯¹è±¡" class="headerlink" title="BOMå¯¹è±¡"></a>BOMå¯¹è±¡</h3><ol><li><p>windowå¯¹è±¡ï¼Œç”¨äºæ“ä½œæµè§ˆå™¨çš„çª—å£</p><p>å¸¸ç”¨çš„æœ‰  ç¬¬ä¸‰ä¸ªå‚æ•°ä¸æ–°çª—å£æœ‰å…³ï¼Œè‡ªå·±å»çœ‹</p><pre><code>- moveBy(x , y) å°†çª—å£å‘åˆæˆ–è€…å‘ä¸‹ç§»åŠ¨- moveTo(x ,y) ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®- resizeBy (dw , dh) ç¼©æ”¾- resizeTo (w ,h )  ç¼©æ”¾åˆ°æŒ‡å®šçª—å£å¤§å°- alert() è¾“å‡º- prompt() è¯»å…¥ç”¨æˆ·è¾“å…¥- confirm() æ˜¾ç¤ºç¡®è®¤å’Œå–æ¶ˆ ç¡®å®š è¿”å›å€¼æ˜¯true- setinterval() æŒ‰ç…§æŒ‡å®šå‘¨æœŸæ¥è°ƒç”¨å‡½æ•°å’Œè¡¨è¾¾å¼ å‚æ•°æœªå‡½æ•° + æ¯«ç§’æ•°- setTimeout() åœ¨æŒ‡å®šæ¯«ç§’æ•°åè°ƒç”¨å‡½æ•°è®¡ç®—è¡¨è¾¾å¼</code></pre></li><li><p>location å¯¹è±¡ï¼Œç”¨äºåˆ†æå’Œè®¾ç½®é¡µé¢çš„URLï¼Œä¸»è¦æ˜¯window å’Œ document å¯¹è±¡çš„å±æ€§<br> ç›´æ¥ä½¿ç”¨location . xxx å³å¯</p><p>æœ‰ä»¥ä¸‹å±æ€§</p><pre><code>- hash å¦‚æœURLåŒ…å«ä¹¦ç­¾#ï¼Œåˆ™è¿”å›#åè¾¹çš„å†…å®¹- host æœåŠ¡å™¨çš„åç§°- &lt;u&gt;**herf**&lt;/u&gt; å½“å‰è½½å…¥çš„å®Œæ•´çš„URL - pathname URL ä¸­ä¸»æœºåé¢çš„éƒ¨åˆ†- port è¯·æ±‚ç«¯å£- protocol åè®®- search æ‰§è¡ŒGETè¯·æ±‚çš„URLä¸­ ? ä¹‹åçš„éƒ¨åˆ†</code></pre><p>è¡¥å……ï¼šURL</p><blockquote><p><strong>URL</strong> ä»£è¡¨ç€æ˜¯ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆUniform Resource Locatorï¼‰ã€‚URL æ— éå°±æ˜¯ä¸€ä¸ªç»™å®šçš„ç‹¬ç‰¹èµ„æºåœ¨ Web ä¸Šçš„åœ°å€ã€‚ç†è®ºä¸Šè¯´ï¼Œæ¯ä¸ªæœ‰æ•ˆçš„ URL éƒ½æŒ‡å‘ä¸€ä¸ªå”¯ä¸€çš„èµ„æºã€‚è¿™ä¸ªèµ„æºå¯ä»¥æ˜¯ä¸€ä¸ª HTML é¡µé¢ï¼Œä¸€ä¸ª CSS æ–‡æ¡£ï¼Œä¸€å¹…å›¾åƒï¼Œç­‰ç­‰ã€‚è€Œåœ¨å®é™…ä¸­ï¼Œä¹Ÿæœ‰ä¸€äº›ä¾‹å¤–ï¼Œæœ€å¸¸è§çš„æƒ…å†µå°±æ˜¯ä¸€ä¸ª URL æŒ‡å‘äº†ä¸å­˜åœ¨çš„æˆ–æ˜¯è¢«ç§»åŠ¨è¿‡çš„èµ„æºã€‚ç”±äºé€šè¿‡ URL å‘ˆç°çš„èµ„æºå’Œ URL æœ¬èº«ç”± Web æœåŠ¡å™¨å¤„ç†ï¼Œå› æ­¤ web æœåŠ¡å™¨çš„æ‹¥æœ‰è€…éœ€è¦è®¤çœŸåœ°ç»´æŠ¤èµ„æºä»¥åŠä¸å®ƒå…³è”çš„ URLã€‚</p></blockquote></li><li><p>navigator å¯¹è±¡ï¼Œ è¿›è¡Œå®¢æˆ·ç«¯æ£€æµ‹</p><pre><code>- appCodeName æµè§ˆå™¨ä»£ç åçš„å­—ç¬¦ä¸²è¡¨ç¤º- appName å®˜æ–¹æµè§ˆå™¨åçš„å­—ç¬¦ä¸²è¡¨ç¤º- appVersion æµè§ˆå™¨ç‰ˆæœ¬ä¿¡æ¯è¡¨ç¤º- javaEnabled() æ˜¯å¦å¯ç”¨äº†Java- platform è¿è¡Œæµè§ˆå™¨çš„è®¡ç®—æœºå¹³å°å­—ç¬¦ä¸²è¡¨ç¤º- plugins å®‰è£…åœ¨æµè§ˆå™¨ä¸­çš„æ’ä»¶ç»„æ•°- userAgent ç”¨æˆ·ä»£ç†å¤´å­—ç¬¦ä¸²çš„å­—ç¬¦ä¸²è¡¨ç¤º æœ€å¸¸ç”¨</code></pre></li><li><p>screen å¯¹è±¡ ä¹Ÿæ˜¯ windowå¯¹è±¡çš„å±æ€§</p><pre><code>- availHeight çª—å£å¯ä»¥ä½¿ç”¨çš„å±å¹•é«˜åº¦- availWidth- colorDepth ç”¨æˆ·è¡¨ç¤ºé¢œè‰²ä½æ•°- height å±å¹•é«˜åº¦- width </code></pre></li><li><p>history å¯¼èˆªå†å²è®°å½•</p><pre><code>- go( ) å‰è¿›åé€€å‡ é¡µï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²ï¼Œå¯¼èˆªåˆ°åŒ…å“¦å«è¿™ä¸ªå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªä¹Ÿç±³å¨œ- back()- forward()- length å†å²è®°å½•ä¸­æœ‰å¤šä¸ªæ¡ç›®ï¼Œå¯ä»¥æ¥åˆ¤æ–­å½“å‰æ˜¯ä¸æ˜¯ä½ çš„ç¬¬ä¸€ä¸ªé¡µé¢</code></pre><h3 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h3><p>å°†æ ‡è®°è¯­è¨€çš„å„ä¸ªç»„æˆéƒ¨åˆ†å°è£…ä¸ºå¯¹åº”çš„å¯¹è±¡</p><blockquote><p>Document æ•´ä¸ªæ–‡æ¡£å¯¹è±¡<br>Element å…ƒç´ å¯¹è±¡<br>Text   æ–‡æœ¬å¯¹è±¡<br>Comment æ³¨é‡Šå¯¹è±¡ </p></blockquote><p>jså¯ä»¥é€šè¿‡DOMå¯¹HTMLè¿›è¡Œæ“ä½œå’Œåšå‡ºååº” ^6aefb6</p></li></ol><h3 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h3><ol><li>[[Webå­¦ä¹ #^6aefb6|Core DOM æ‰€æœ‰æ–‡æ¡£ç±»å‹çš„æ ‡å‡†æ¨¡å‹]] </li><li>XML DOM XML æ–‡æ¡£çš„æ ‡å‡†æ¨¡å‹</li><li>HTML DOM HTML æ–‡æ¡£çš„æ ‡å‡†æ¨¡å‹</li></ol><p></p><h4 id="å¸¸ç”¨å‡½æ•°"><a href="#å¸¸ç”¨å‡½æ•°" class="headerlink" title="å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h4><p>å…·ä½“çš„æ ‡ç­¾å¯¹è±¡çš„å±æ€§å’Œå‡½æ•°å»MDNé‡Œçœ‹çœ‹ </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//é€šè¿‡idå€¼æŸ¥æ‰¾å¯¹è±¡</span><span class="token keyword">var</span> h1 <span class="token operator">=</span> doucument<span class="token punctuation">.</span><span class="token function">getElementById1</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">)</span><span class="token comment">//ä»¥ä¸‹å‡½æ•°æ— æ³•æŸ¥æ‰¾ç‰¹å®šçš„æŸä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥è¿”å›çš„ä¸€ä¸ªå¯¹è±¡æ•°ç»„</span><span class="token comment">//æ ¹æ®æ ‡ç­¾åæŸ¥æ‰¾å¯¹è±¡</span><span class="token keyword">var</span> divs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token comment">//æ ¹æ®nameæ¥è·å–</span><span class="token function">getElementsByName</span><span class="token punctuation">(</span><span class="token string">'hobby'</span><span class="token punctuation">)</span><span class="token comment">//æ ¹æ®class æ¥è·å–</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'cls'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>äº‹ä»¶ç»‘å®š</p><ol><li>é€šè¿‡HTMLæ ‡ç­¾ä¸­çš„å±æ€§æ¥ç»‘å®š<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name">value1</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>æŒ‰é’®1<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">function</span> <span class="token function">on</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">alert</span> <span class="token punctuation">(</span><span class="token string">'æˆ‘è¢«ç‚¹å‡»äº†'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>é€šè¿‡DOMå…ƒç´ æ¥ç»‘å®š<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span> <span class="token attr-name">value</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>æŒ‰é’®2<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span>document.getElementById('btn').onclick = function(){alert('æˆ‘è¢«ç‚¹å‡»äº†');}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="React"><a href="#React" class="headerlink" title="React"></a>React</h2><p>   JavaScriptçš„ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“</p><p>   react app ç”±ç»„ä»¶ç»„æˆï¼Œreactç»„ä»¶æ˜¯è¿”å›htmlæ ‡ç­¾çš„JavaScriptå‡½æ•°</p><p>   react çš„ç»„ä»¶å¯ä»¥ç”¨ä½œç±»ä¼¼äºhtmlçš„æ ‡ç­¾ï¼ŒåŒºåˆ«æ˜¯React ç»„ä»¶å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼ŒHTMLæ ‡ç­¾å¿…é¡»ä»¥å°å†™å­—æ¯å¼€å¤´</p><p>   JavaScriptçš„componentå®é™…ä¸Šå°±æ˜¯JavaBean</p><p>   ä¾‹å¦‚:</p>   <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">MyButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span><span class="token constant">I</span>'m a button<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>   ä¹‹åMyButtonå¯ä½œä¸ºæ ‡ç­¾ä½¿ç”¨</p>   <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Welcome to my app<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>      <span class="token operator">&lt;</span>MyButton <span class="token operator">/</span><span class="token operator">&gt;</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>   <strong>hotloader</strong>æ˜¯å¥½ä¸œè¥¿</p><p>   <strong>Reactå‘½å:</strong></p><blockquote><p>HTMLä¸­çš„ç±»ä¸º class ï¼Œè€ŒReactä¸­çš„classå‘½åä¸ºclassName</p><p><code>&lt;h4 className="Profile-subTitle"&gt;About Me&lt;/h4&gt;</code></p><p>ç±»åä¸ºï¼šç»„ä»¶å(æ–‡ä»¶å) æ‰©æŠ˜å· æ–‡ä»¶ä¸­çš„ä½œç”¨åï¼Œéµå¾ªé©¼å³°</p></blockquote><p>   ä½¿ç”¨ import xxx from â€œxxxâ€ æ¥åœ¨jsæ–‡ä»¶ä¸­å¯¼å…¥å…¶ä»–çš„component</p><p>   ä½¿ç”¨ import â€œxxx.cssâ€ æ¥ä»å¯¼å…¥cssæ–‡ä»¶</p><p>   ä½¿ç”¨ export default xxx æ¥å¯¼å‡ºè¿™ä¸ªç»„ä»¶ï¼Œä»è€Œè®©å…¶ä»–æ–‡ä»¶èƒ½å¤Ÿè°ƒç”¨è¿™ä¸ªç»„ä»¶</p><p>   å…·ä½“å¯çœ‹ç¤ºä¾‹ catbook-react </p><h2 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h2><blockquote><p>ä½¿ç”¨jså¯¹è±¡æ ‡è®°æ³•ä¹¦å†™çš„æ–‡æœ¬</p></blockquote><p>æ ¼å¼ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//è¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„ï¼Œä¸æ˜¯å¯¹è±¡</span><span class="token keyword">var</span> å˜é‡ <span class="token operator">=</span> <span class="token string">'{"key1" : value1 , "key2" : value2}'</span><span class="token punctuation">;</span><span class="token comment">//å•å¼•å·æ¥è¡¨åæ—¶å˜é‡ç±»å‹</span><span class="token comment">//JSON å­—ç¬¦ä¸²å’Œjså¯¹è±¡è½¬åŒ–</span><span class="token keyword">var</span> jsObject <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>userStr<span class="token punctuation">)</span><span class="token keyword">var</span> jsonStr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>jsObject<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h2><h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><p>ç»„æˆï¼šURL + Methods + Request Headers + Request Body</p><blockquote><p>URL æ–‡ä»¶å®šä½ï¼Œç½‘å€ (å®šä½)<br>URIä¸»è¦ç”¨äºæ ‡è¯†ç½‘ç»œèµ„æºåç§°ï¼ˆæ¯”å¦‚ç½‘å€ï¼‰æ ‡è¯†å”¯ä¸€çš„èµ„æº (èº«ä»½è¯)</p></blockquote><h3 id="ç½‘ç»œé€šä¿¡ä¸‰è¦ç´ "><a href="#ç½‘ç»œé€šä¿¡ä¸‰è¦ç´ " class="headerlink" title="ç½‘ç»œé€šä¿¡ä¸‰è¦ç´ "></a>ç½‘ç»œé€šä¿¡ä¸‰è¦ç´ </h3><ul><li>ip:è®¡ç®—æœºåœ¨ç½‘ç»œä¸­çš„å”¯ä¸€æ ‡è¯†</li><li>ç«¯å£: åº”ç”¨ç¨‹åºåœ¨è®¡ç®—æœºä¸­çš„å”¯ä¸€è¡¨ç¤º</li><li>ä¼ è¾“åè®®:<ul><li>tcp å®‰å…¨åè®®ï¼Œä¸‰æ¬¡æ¡æ‰‹,å››æ¬¡æŒ¥æ‰‹ <a href="https://ost.51cto.com/posts/17361">æ•™ç¨‹</a></li><li>udp ä¸å®‰å…¨åè®®</li></ul></li></ul><h3 id="HTTPåè®®"><a href="#HTTPåè®®" class="headerlink" title="HTTPåè®®"></a>HTTPåè®®</h3><ul><li>è¯·æ±‚è¡Œå¤§å†™è¯·æ±‚æ–¹å¼ï¼ŒURL,è¯·æ±‚åè®®ï¼Œç‰ˆæœ¬å·</li><li>è¯·æ±‚å¤´å­˜æ”¾è¯·æ±‚å‚æ•°å’Œå€¼ï¼Œé”®å€¼å¯¹çš„æ–¹å¼ï¼Œ å‚æ•°å:å‚æ•°å€¼</li><li>è¯·æ±‚ç©ºè¡Œä¸€è¡Œæ¥åŒºåˆ†è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“</li><li>getæ–¹å¼æ²¡æœ‰è¯·æ±‚ä½“</li></ul><h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><ul><li><code>GET</code> æ–¹æ³•è¯·æ±‚ä¸€ä¸ªæŒ‡å®šèµ„æºçš„è¡¨ç¤ºå½¢å¼ï¼Œä½¿ç”¨ <code>GET</code> çš„è¯·æ±‚åº”è¯¥åªè¢«ç”¨äºè·å–æ•°æ®ã€‚</li><li><code>HEAD</code> æ–¹æ³•è¯·æ±‚ä¸€ä¸ªä¸ <code>GET</code> è¯·æ±‚çš„å“åº”ç›¸åŒçš„å“åº”ï¼Œä½†æ²¡æœ‰å“åº”ä½“</li><li><code>POST</code> æ–¹æ³•ç”¨äºå°†å®ä½“æäº¤åˆ°æŒ‡å®šçš„èµ„æºï¼Œé€šå¸¸å¯¼è‡´åœ¨æœåŠ¡å™¨ä¸Šçš„çŠ¶æ€å˜åŒ–æˆ–å‰¯ä½œç”¨ã€‚</li><li><code>PUT</code> æ–¹æ³•ç”¨æœ‰æ•ˆè½½è·è¯·æ±‚æ›¿æ¢ç›®æ ‡èµ„æºçš„æ‰€æœ‰å½“å‰è¡¨ç¤ºã€‚</li><li><code>DELETE</code> æ–¹æ³•åˆ é™¤æŒ‡å®šçš„èµ„æºã€‚</li><li><code>CONNECT</code> æ–¹æ³•å»ºç«‹ä¸€ä¸ªåˆ°ç”±ç›®æ ‡èµ„æºæ ‡è¯†çš„æœåŠ¡å™¨çš„éš§é“ã€‚</li><li><code>OPTIONS</code> æ–¹æ³•ç”¨äºæè¿°ç›®æ ‡èµ„æºçš„é€šä¿¡é€‰é¡¹ã€‚</li><li><code>TRACE</code> æ–¹æ³•æ²¿ç€åˆ°ç›®æ ‡èµ„æºçš„è·¯å¾„æ‰§è¡Œä¸€ä¸ªæ¶ˆæ¯ç¯å›æµ‹è¯•ã€‚</li><li><code>PATCH</code> æ–¹æ³•ç”¨äºå¯¹èµ„æºåº”ç”¨éƒ¨åˆ†ä¿®æ”¹ã€‚</li></ul><hr><p><strong>å“åº”éƒ¨åˆ†</strong></p><ul><li>å“åº”è¡Œ :  åè®®ï¼Œç‰ˆæœ¬å·ï¼ŒçŠ¶æ€ç ï¼ŒçŠ¶æ€æè¿°ä¿¡æ¯</li><li>å“åº”å¤´ :  å‚æ•°å’Œå€¼ï¼Œ å‚æ•°å : å‚æ•°å€¼ </li><li>å“åº”ä½“ : html æ ¼å¼<br>çŠ¶æ€ç ï¼š</li></ul><p>1xxï¼šä¿¡æ¯</p><p>2xxï¼šsucceeded</p><p>3xxï¼šredirect é‡å®šå‘</p><p>4xx:  ä½ è¯·æ±‚å‡ºé”™</p><p>5xxï¼šæœåŠ¡å™¨å‡ºé”™</p><h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><blockquote><p><strong>åº”ç”¨ç¨‹åºæ¥å£</strong>ï¼ˆè‹±è¯­ï¼š<strong>a</strong>pplication <strong>p</strong>rogramming <strong>i</strong>nterface[<a href="https://zh.wikipedia.org/zh-hans/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%8E%A5%E5%8F%A3#cite_note-%E5%88%98%E7%91%9E%E6%96%B02018-1">1]</a>ï¼‰ï¼Œç¼©å†™ä¸º<strong>API</strong>[<a href="https://zh.wikipedia.org/zh-hans/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%8E%A5%E5%8F%A3#cite_note-UnmehopaVemuri2006-2">2]</a>ï¼Œæ˜¯ä¸€ç§<a href="https://zh.wikipedia.org/wiki/%E8%AE%A1%E7%AE%97">è®¡ç®—</a><a href="https://zh.wikipedia.org/wiki/%E4%BB%8B%E9%9D%A2_(%E8%B3%87%E8%A8%8A%E7%A7%91%E6%8A%80)">æ¥å£</a>ï¼Œå®ƒå®šä¹‰å¤šä¸ª<a href="https://zh.wikipedia.org/wiki/%E8%BD%AF%E4%BB%B6">è½¯ä»¶</a><a href="https://zh.wikipedia.org/wiki/%E4%B8%AD%E4%BB%8B">ä¸­ä»‹</a>ä¹‹é—´çš„<a href="https://zh.wikipedia.org/w/index.php?title=%E4%BA%A4%E4%BA%92&amp;action=edit&amp;redlink=1">äº¤äº’</a>ï¼Œä»¥åŠå¯ä»¥è¿›è¡Œçš„<a href="https://zh.wikipedia.org/w/index.php?title=%E8%B0%83%E7%94%A8&amp;action=edit&amp;redlink=1">è°ƒç”¨</a>ï¼ˆcallï¼‰æˆ–<a href="https://zh.wikipedia.org/w/index.php?title=%E8%AF%B7%E6%B1%82&amp;action=edit&amp;redlink=1">è¯·æ±‚</a>ï¼ˆrequestï¼‰çš„ç§ç±»ï¼Œå¦‚ä½•è¿›è¡Œè°ƒç”¨æˆ–å‘å‡ºè¯·æ±‚ï¼Œåº”ä½¿ç”¨çš„æ•°æ®æ ¼å¼ï¼Œåº”éµå¾ªçš„æƒ¯ä¾‹ç­‰ã€‚å®ƒè¿˜å¯ä»¥æä¾›<a href="https://zh.wikipedia.org/w/index.php?title=%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6&amp;action=edit&amp;redlink=1">æ‰©å±•æœºåˆ¶</a>ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥é€šè¿‡å„ç§æ–¹å¼å¯¹ç°æœ‰åŠŸèƒ½è¿›è¡Œä¸åŒç¨‹åº¦çš„æ‰©å±•[<a href="https://zh.wikipedia.org/zh-hans/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%8E%A5%E5%8F%A3#cite_note-Fisher1-3">3]</a>ã€‚ä¸€ä¸ªAPIå¯ä»¥æ˜¯å®Œå…¨å®šåˆ¶çš„ï¼Œé’ˆå¯¹æŸä¸ªç»„ä»¶çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºäºè¡Œä¸šæ ‡å‡†è®¾è®¡çš„ä»¥ç¡®ä¿äº’æ“ä½œæ€§ã€‚é€šè¿‡<a href="https://zh.wikipedia.org/wiki/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1">ä¿¡æ¯éšè—</a>ï¼ŒAPIå®ç°äº†<a href="https://zh.wikipedia.org/wiki/%E6%A8%A1%E5%9D%97%E5%8C%96%E7%BC%96%E7%A8%8B">æ¨¡å—åŒ–ç¼–ç¨‹</a>ï¼Œä»è€Œå…è®¸ç”¨æˆ·å®ç°ç‹¬ç«‹åœ°ä½¿ç”¨æ¥å£ã€‚</p></blockquote><p>ç›®çš„ï¼š</p><p><img src="/2023/06/17/01/1690524156434.png"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span> <span class="token comment">//åŠ ä¸Šè¿™ä¸ªä¹‹åå˜ä¸ºè¯·æ±‚å¤„ç†ç±»  </span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>  <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token string">"hello world!"</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€äº›å‚æ•°çš„å®ç°<br><img src="/2023/06/17/01/%E5%8F%82%E6%95%B0.png"><br><img src="/2023/06/17/01/%E5%90%8C%E4%B8%80%E7%9A%84%E5%93%8D%E5%BA%94%E7%BB%93%E6%9E%9C.png"></p><h2 id="å½¢å¼è‰¯å¥½çš„-XML-æ–‡æ¡£"><a href="#å½¢å¼è‰¯å¥½çš„-XML-æ–‡æ¡£" class="headerlink" title="å½¢å¼è‰¯å¥½çš„ XML æ–‡æ¡£"></a>å½¢å¼è‰¯å¥½çš„ XML æ–‡æ¡£</h2><p>â€œå½¢å¼è‰¯å¥½â€çš„ XML æ–‡æ¡£æ‹¥æœ‰æ­£ç¡®çš„è¯­æ³•ã€‚</p><p>åœ¨å‰é¢çš„ç« èŠ‚æè¿°çš„è¯­æ³•è§„åˆ™ï¼š</p><ul><li>XML æ–‡æ¡£å¿…é¡»æœ‰ä¸€ä¸ªæ ¹å…ƒç´ </li><li>XMLå…ƒç´ éƒ½å¿…é¡»æœ‰ä¸€ä¸ªå…³é—­æ ‡ç­¾</li><li>XML æ ‡ç­¾å¯¹å¤§å°å†™æ•æ„Ÿ</li><li>XML å…ƒç´ å¿…é¡»è¢«æ­£ç¡®çš„åµŒå¥—</li><li>XML å±æ€§å€¼å¿…é¡»åŠ å¼•å·<br>åœ¨ XML ä¸­ï¼Œæœ‰ 5 ä¸ªé¢„å®šä¹‰çš„å®ä½“å¼•ç”¨ï¼š</li></ul><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>&lt;</td><td>&lt;</td><td>less than</td></tr><tr><td>&gt;</td><td>&gt;</td><td>greater than</td></tr><tr><td>&amp;</td><td>&amp;</td><td>ampersand</td></tr><tr><td>&amp;apos;</td><td>â€˜</td><td>apostrophe</td></tr><tr><td>"</td><td>â€œ</td><td>quotation mark</td></tr></tbody></table><h2 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h2><p>æ˜¯æ¥å£ï¼Œä½¿ç”¨æ—¶è¦è‡ªå·±å®ç°</p><h4 id="web-xmlä¸­é…ç½®ï¼ˆå¯ç”¨æ³¨è§£å®ç°äº†ï¼Œæš´æ€’éœ€è¦è¿™ä¹ˆå†™äº†ï¼‰"><a href="#web-xmlä¸­é…ç½®ï¼ˆå¯ç”¨æ³¨è§£å®ç°äº†ï¼Œæš´æ€’éœ€è¦è¿™ä¹ˆå†™äº†ï¼‰" class="headerlink" title="web.xmlä¸­é…ç½®ï¼ˆå¯ç”¨æ³¨è§£å®ç°äº†ï¼Œæš´æ€’éœ€è¦è¿™ä¹ˆå†™äº†ï¼‰"></a>web.xmlä¸­é…ç½®ï¼ˆå¯ç”¨æ³¨è§£å®ç°äº†ï¼Œæš´æ€’éœ€è¦è¿™ä¹ˆå†™äº†ï¼‰</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- Servlets --&gt;</span><span class="token comment">&lt;!-- é…ç½®ç±»åå’Œè·¯å¾„--&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>demo1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">&gt;</span></span>com.example.servelet_study.servlet.ServletDemo1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!-- é…ç½®è¯·æ±‚è·¯å¾„ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>demo1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/demo1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- é…ç½®servletçš„initæ—¶é—´ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>load-on-startup</span><span class="token punctuation">&gt;</span></span> æ•°å­— <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>load-on-startup</span><span class="token punctuation">&gt;</span></span> æ•°å­—ä¸ºæ­£æ•°æ—¶å¯ä»¥åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œä¸º è´Ÿæ•°æ—¶å¯ä»¥åœ¨ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™è¿›è¡ŒåŠ è½½<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span> <span class="token string">"/..."</span><span class="token punctuation">,</span><span class="token string">"/..."</span><span class="token punctuation">,</span><span class="token string">"/..."</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="æ¥å£æ–¹æ³•"><a href="#æ¥å£æ–¹æ³•" class="headerlink" title="æ¥å£æ–¹æ³•"></a>æ¥å£æ–¹æ³•</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> åœ¨ç¬¬ä¸€æ¬¡åˆ›å»º<span class="token class-name">Servlet</span>æ—¶è¢«è°ƒç”¨<span class="token function">service</span><span class="token punctuation">(</span><span class="token punctuation">)</span> åœ¨è¢«è®¿é—®æ—¶ä¼šè¢«è°ƒç”¨ï¼Œä¼šé€‚å½“çš„è°ƒç”¨doGetç­‰æ–¹æ³•<span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">getSercletConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> è·å–é…ç½®æ–‡ä»¶getServletInfo <span class="token punctuation">(</span><span class="token punctuation">)</span> è·å–servletç‰ˆæœ¬ä¿¡æ¯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">## åˆ†å±‚è§£è€¦### ä¸‰å±‚æ¶æ„1. controller : æ§åˆ¶å±‚ ï¼Œæ¥å—å‰ç«¯å‘é€çš„è¯·æ±‚ï¼Œå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œå¹¶å“åº”æ•°æ®2. service: ä¸šåŠ¡é€»è¾‘å±‚ï¼Œå¤„ç†å…·ä½“çš„ä¸šåŠ¡é€»è¾‘3. dao æ•°æ®è®¿é—®å±‚(Data Access Object ) (æŒä¹…å±‚),è´Ÿè´£æ•°æ®çš„è®¿é—®æ“ä½œï¼ŒåŒ…æ‹¬å¢åˆ æ”¹æŸ¥### IOC &amp; DI```java@Component å°†å½“å‰ç±»äº¤ç»™IOC å®¹å™¨ //åŠ åœ¨éœ€è¦è¢«newçš„å¯¹è±¡æ‰€åœ¨çš„å±‚@Autowired è¿è¡Œæ—¶IOC å®¹å™¨ä¼šæä¾›è¯¥ç±»å‹çš„beanå¹¶èµ‹å€¼ç»™å˜é‡ ä¾èµ–æ³¨å…¥ //åŠ åœ¨controllerå±‚åŠ ä¸Šä¹‹åå°±ä¸éœ€è¦è‡ªå·±è¿›è¡Œnewå¯¹è±¡äº†ï¼Œç›´æ¥å»ºç«‹å¯¹è±¡å˜é‡å³å¯//å…¶ä»–æ³¨è§£@Component å£°æ˜beançš„åŸºç¡€æ³¨è§£//ä»¥ä¸‹åœ¨webä¸­å¸¸ç”¨@Controller æ ‡æ³¨åœ¨æ§åˆ¶å™¨ä¸Š@Service æ ‡æ³¨åœ¨ä¸šåŠ¡ç±»ä¸Š//DIæ³¨è§£@Autowired é»˜è®¤æ˜¯æŒ‰ç…§ç±»å‹è¿›è¡Œçš„ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªç›¸åŒçš„ç±»å‹çš„beanå°±ä¼šå‡ºç°æŠ¥é”™@Primary æƒ³è¦å“ªä¸ªbeanè¢«æ³¨å…¥å°±ç›´æ¥åŠ åœ¨é‚£ä¸ªç±»å‰é¢@Qualifier("value") åœ¨ä½¿ç”¨çš„æ—¶å€™åŠ ä¸Šè¿™ä¸ªï¼Œvalueä¸ºbeançš„åå­—@Resource (name = "") <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="HttpServletRequestä¸­å¸¸ç”¨çš„æ–¹æ³•"><a href="#HttpServletRequestä¸­å¸¸ç”¨çš„æ–¹æ³•" class="headerlink" title="HttpServletRequestä¸­å¸¸ç”¨çš„æ–¹æ³•"></a>HttpServletRequestä¸­å¸¸ç”¨çš„æ–¹æ³•</h3><ul><li>Map&nbsp;getParameterMap()<br>  è·å–åŒ…å«æ‰€æœ‰è¯·æ±‚å‚æ•°åŠå€¼çš„ Map å¯¹è±¡ã€‚éœ€è¦æ³¨æ„ï¼Œè¯¥ Map çš„ value ä¸º String[]ï¼Œå³ä¸€ä¸ªå‚æ•°æ‰€å¯¹åº”çš„å€¼ä¸ºä¸€ä¸ªæ•°ç»„ã€‚è¯´æ˜ä¸€ä¸ªå‚æ•°å¯ä»¥å¯¹åº”å¤šä¸ªå€¼ã€‚</li><li>Enumeration&nbsp;getParameterNames()<br>  è·å–è¯·æ±‚å‚æ•° Map çš„æ‰€æœ‰ key,å³è·å–æ‰€æœ‰è¯·æ±‚å‚æ•°åã€‚</li><li>String[] getParameterValues(String name)<br>  æ ¹æ®æŒ‡å®šçš„è¯·æ±‚å‚æ•°åç§°ï¼Œè·å–å…¶å¯¹åº”çš„æ‰€æœ‰å€¼ã€‚è¿™ä¸ªæ–¹æ³•ä¸€èˆ¬ç”¨äºè·å–å¤é€‰æ¡†(checkbox)æ•°æ®ã€‚</li><li>String getParameter(String name)<br>  æ ¹æ®æŒ‡å®šçš„è¯·æ±‚å‚æ•°åç§°ï¼Œè·å–å…¶å¯¹åº”çš„å€¼ã€‚è‹¥è¯¥å‚æ•°åç§°å¯¹åº”çš„æ˜¯å¤šä¸ªå€¼ï¼Œåˆ™è¯¥æ–¹æ³•è·å–åˆ°çš„æ˜¯ç¬¬ä¸€ä¸ªå€¼ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•ã€‚</li></ul><p>è·å–å®¢æˆ·ç«¯ä¿¡æ¯çš„æ–¹æ³•ï¼š</p><ul><li>getRequestURLæ–¹æ³•è¿”å›å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚æ—¶çš„å®Œæ•´URLã€‚</li><li>getRequestURIæ–¹æ³•è¿”å›è¯·æ±‚è¡Œä¸­çš„èµ„æºåéƒ¨åˆ†ã€‚</li><li>getQueryString æ–¹æ³•è¿”å›è¯·æ±‚è¡Œä¸­çš„å‚æ•°éƒ¨åˆ†ã€‚</li><li>getRemoteAddræ–¹æ³•è¿”å›å‘å‡ºè¯·æ±‚çš„å®¢æˆ·æœºçš„IPåœ°å€</li><li>getRemoteHostæ–¹æ³•è¿”å›å‘å‡ºè¯·æ±‚çš„å®¢æˆ·æœºçš„å®Œæ•´ä¸»æœºå</li><li>getRemotePortæ–¹æ³•è¿”å›å®¢æˆ·æœºæ‰€ä½¿ç”¨çš„ç½‘ç»œç«¯å£å·</li><li>getLocalAddræ–¹æ³•è¿”å›WEBæœåŠ¡å™¨çš„IPåœ°å€ã€‚</li><li>getLocalNameæ–¹æ³•è¿”å›WEBæœåŠ¡å™¨çš„ä¸»æœºå</li><li>getMethodå¾—åˆ°å®¢æˆ·æœºè¯·æ±‚æ–¹å¼<pre class="line-numbers language-java" data-language="java"><code class="language-java">request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> æš‚å­˜reqè¯·æ±‚ä¸­çš„ä¿¡æ¯equest<span class="token punctuation">.</span><span class="token function">getRequestDispacther</span><span class="token punctuation">(</span><span class="token string">"/test.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forword</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span> è½¬å‘response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"test.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> é‡å®šå‘<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="filter-1"><a href="#filter-1" class="headerlink" title="filter"></a>filter</h3><blockquote><p>ç”±äºè¡¨å•çš„post æäº¤æ–¹å¼ï¼Œæ‰€ä»¥è¦ç¼–å†™å¥½ç¼–ç çš„è¿‡æ»¤å™¨æ¥æ”¯æŒä¸­æ–‡å­˜å–</p></blockquote><h2 id="Vue"><a href="#Vue" class="headerlink" title="Vue"></a>Vue</h2><p>å…é™¤jsä¸­çš„ DOMæ“ä½œç®€åŒ–ä¹¦å†™</p><ol><li>æ–°å»ºhtmlé¡µé¢å¼•å…¥Vue.jsæ–‡ä»¶</li><li>åˆ›å»ºVueæ ¸å¿ƒå¯¹è±¡ï¼Œå®šä¹‰æ•°æ®æ¨¡å‹<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">new</span> <span class="token class-name">Vue</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">el</span> <span class="token operator">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span> <span class="token comment">//Vueè¦æ§åˆ¶å“ªä¸ªåŒºï¼Œ #+id ç±»ä¼¼cssçš„é€‰æ‹©å™¨</span><span class="token literal-property property">data</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//æ•°æ®æ¨¡å‹</span><span class="token literal-property property">message</span> <span class="token operator">:</span> <span class="token string">"hello Vue"</span><span class="token punctuation">}</span><span class="token literal-property property">method</span> <span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//å®šä¹‰å‡½æ•°</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>ç¼–å†™è§†å›¾<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>app<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>message<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> //ç»‘å®šæ•°æ®æ¨¡å‹{{ message }} //ç›´æ¥è·å–æ•°æ®æ¨¡å‹ä¸­çš„æ•°æ®è¿›è¡Œå±•ç¤º<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>//{{}} æ’å€¼è¡¨è¾¾å¼ï¼Œä¸­é—´å¯ä»¥å¡«å…¥ å˜é‡ï¼Œä¸‰å…ƒè¿ç®—ç¬¦ï¼Œå‡½æ•°è°ƒç”¨ï¼Œç®—æ•°è¿ç®—v-model = "" æ¨¡å‹ç»‘å®š<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="å¸¸ç”¨æŒ‡ä»¤"><a href="#å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="å¸¸ç”¨æŒ‡ä»¤"></a>å¸¸ç”¨æŒ‡ä»¤</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">v<span class="token operator">-</span>bind ä¸º<span class="token constant">HTML</span> æ ‡ç­¾ç»‘å®šå±æ€§å€¼ï¼Œä¾‹å¦‚è®¾ç½®href <span class="token punctuation">,</span> css æ ·å¼<span class="token literal-property property">æˆ–è€…ç›´æ¥</span> <span class="token operator">:</span> <span class="token operator">+</span> href <span class="token operator">...</span>v<span class="token operator">-</span>model åœ¨è¡¨å•å…ƒç´ ä¸Šå®ç°åŒå‘æ•°æ®ç»‘å®šv<span class="token operator">-</span>on ä¸º<span class="token constant">HTML</span>ç»‘å®šäº‹åŠ¡ v<span class="token operator">-</span>on<span class="token operator">:</span>click å¯ç®€å†™ä¸º@click<span class="token comment">//</span><span class="token comment">//</span>v<span class="token operator">-</span><span class="token keyword">if</span> v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">-</span><span class="token keyword">if</span> æ¡ä»¶æ€§çš„æ¸²æŸ“æŸå…ƒç´ v<span class="token operator">-</span><span class="token keyword">else</span>v<span class="token operator">-</span>show æ ¹æ®æ¡ä»¶æ˜¾ç¤ºæŸå…ƒç´ ï¼ŒåŒºåˆ«æ˜¯åˆ‡æ¢çš„æ˜¯displayå±æ€§çš„å€¼v<span class="token operator">-</span><span class="token keyword">for</span> åˆ—è¡¨æ¸²æŸ“ï¼Œéå†å®¹å™¨çš„å…ƒç´ æˆ–å¯¹è±¡çš„å±æ€§<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç”Ÿå‘½å‘¨æœŸåŠå…¶å¯¹åº”çš„æ–¹æ³•"><a href="#ç”Ÿå‘½å‘¨æœŸåŠå…¶å¯¹åº”çš„æ–¹æ³•" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸåŠå…¶å¯¹åº”çš„æ–¹æ³•"></a>ç”Ÿå‘½å‘¨æœŸåŠå…¶å¯¹åº”çš„æ–¹æ³•</h3><h2 id="Ajax-å¼‚æ­¥çš„jså’Œxml"><a href="#Ajax-å¼‚æ­¥çš„jså’Œxml" class="headerlink" title="Ajax : å¼‚æ­¥çš„jså’Œxml"></a>Ajax : å¼‚æ­¥çš„jså’Œxml</h2><h3 id="Axios"><a href="#Axios" class="headerlink" title="Axios"></a>Axios</h3><p>ç®€åŒ–äº†Axios<br><code> npm install axios</code><br>åœ¨å…¥å£æ–‡ä»¶å¼•å…¥</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">"axios"</span><span class="token punctuation">;</span>  <span class="token comment">//æŠŠaxioså…¨å±€å¯¼å‡º  </span>app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$axios <span class="token operator">=</span> axios<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å‘é€å¤šä¸ªè¯·æ±‚<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//å®šä¹‰ä¸¤ä¸ªå¼‚æ­¥å‡½æ•°</span><span class="token keyword">function</span> <span class="token function">getUserAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/12345'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">function</span> <span class="token function">getUserPermissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/12345/permissions'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token comment">//ç­‰å¾…ä¸¤ä¸ªéƒ½æ‰§è¡Œå®Œæ¯•å†è¿”å›ç»“æœ</span>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">getUserAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getUserPermissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>acct<span class="token punctuation">,</span> perm<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ... });</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>ä½¿ç”¨æ—¶åªéœ€è¦åœ¨axiosä¸­ä¼ å…¥configå³å¯</li><li>åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å®ä¾‹<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> instance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">baseURL</span><span class="token operator">:</span> <span class="token string">'https://some-domain.com/api/'</span><span class="token punctuation">,</span> <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">'X-Custom-Header'</span><span class="token operator">:</span> <span class="token string">'foobar'</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><a href="https://axios-http.com/zh/docs/req_config">configé…ç½®è¯¦è§£</a></li><li>æ‹¦æˆªå™¨<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨</span>axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// åœ¨å‘é€è¯·æ±‚ä¹‹å‰åšäº›ä»€ä¹ˆ</span>    <span class="token keyword">return</span> config<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// å¯¹è¯·æ±‚é”™è¯¯åšäº›ä»€ä¹ˆ</span>    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ·»åŠ å“åº”æ‹¦æˆªå™¨</span>axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 2xx èŒƒå›´å†…çš„çŠ¶æ€ç éƒ½ä¼šè§¦å‘è¯¥å‡½æ•°ã€‚</span>    <span class="token comment">// å¯¹å“åº”æ•°æ®åšç‚¹ä»€ä¹ˆ</span>    <span class="token keyword">return</span> response<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// è¶…å‡º 2xx èŒƒå›´çš„çŠ¶æ€ç éƒ½ä¼šè§¦å‘è¯¥å‡½æ•°ã€‚</span>    <span class="token comment">// å¯¹å“åº”é”™è¯¯åšç‚¹ä»€ä¹ˆ</span>    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><a href="https://axios-http.com/zh/docs/handling_errors">é”™è¯¯å¤„ç†</a></li></ul><h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><p><strong>Nginx (engine x)</strong>&nbsp;æ˜¯ä¸€æ¬¾è½»é‡çº§çš„ Web æœåŠ¡å™¨ ã€åå‘ä»£ç†æœåŠ¡å™¨åŠç”µå­é‚®ä»¶ï¼ˆIMAP/POP3ï¼‰ä»£ç†æœåŠ¡å™¨ã€‚<br><strong>ä»€ä¹ˆæ˜¯åå‘ä»£ç†ï¼Ÿ</strong></p><p>åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰æ–¹å¼æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å— internet ä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™ internet ä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nginx <span class="token parameter variable">-s</span> stop       å¿«é€Ÿå…³é—­Nginxï¼Œå¯èƒ½ä¸ä¿å­˜ç›¸å…³ä¿¡æ¯ï¼Œå¹¶è¿…é€Ÿç»ˆæ­¢webæœåŠ¡ã€‚nginx <span class="token parameter variable">-s</span> quit       å¹³ç¨³å…³é—­Nginxï¼Œä¿å­˜ç›¸å…³ä¿¡æ¯ï¼Œæœ‰å®‰æ’çš„ç»“æŸwebæœåŠ¡ã€‚nginx <span class="token parameter variable">-s</span> reload     å› æ”¹å˜äº†Nginxç›¸å…³é…ç½®ï¼Œéœ€è¦é‡æ–°åŠ è½½é…ç½®è€Œé‡è½½ã€‚nginx <span class="token parameter variable">-s</span> reopen     é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ã€‚nginx <span class="token parameter variable">-c</span> filename   ä¸º Nginx æŒ‡å®šä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ¥ä»£æ›¿ç¼ºçœçš„ã€‚nginx <span class="token parameter variable">-t</span>            ä¸è¿è¡Œï¼Œä»…ä»…æµ‹è¯•é…ç½®æ–‡ä»¶ã€‚nginx å°†æ£€æŸ¥é…ç½®æ–‡ä»¶çš„è¯­æ³•çš„æ­£ç¡®æ€§ï¼Œå¹¶å°è¯•æ‰“å¼€é…ç½®æ–‡ä»¶ä¸­æ‰€å¼•ç”¨åˆ°çš„æ–‡ä»¶ã€‚nginx <span class="token parameter variable">-v</span>            æ˜¾ç¤º nginx çš„ç‰ˆæœ¬ã€‚nginx <span class="token parameter variable">-V</span>            æ˜¾ç¤º nginx çš„ç‰ˆæœ¬ï¼Œç¼–è¯‘å™¨ç‰ˆæœ¬å’Œé…ç½®å‚æ•°ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>å¯åŠ¨nginxæœåŠ¡ï¼Œå¯åŠ¨æ—¶ä¼šä¸€é—ªè€Œè¿‡æ˜¯æ­£å¸¸çš„</p><p>start nginx</p><p>æŸ¥çœ‹ä»»åŠ¡è¿›ç¨‹æ˜¯å¦å­˜åœ¨ï¼Œdosæˆ–æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨éƒ½è¡Œ</p><p>tasklist /fi â€œimagename eq nginx.exeâ€</p><h2 id="Vue-1"><a href="#Vue-1" class="headerlink" title="Vue"></a>Vue</h2><h2 id="Element"><a href="#Element" class="headerlink" title="Element"></a>Element</h2><h2 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h2><p>ç”¨äºé¡¹ç›®ç®¡ç†æ„å»ºå’Œä¾èµ–ç®¡ç†ï¼Œå°†ä¾èµ–å†™å…¥åˆ°mavené…ç½®æ–‡ä»¶ä¸­å³å¯è‡ªåŠ¨ä¸‹è½½åˆ°é¡¹ç›®ä¸­</p><ol><li><a href="https://m.imooc.com/wiki/mavenlesson-maveninstall">https://m.imooc.com/wiki/mavenlesson-maveninstall</a></li><li>æ„å»ºé¡¹ç›®<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mvn archetype:generate <span class="token parameter variable">-DgroupId</span><span class="token operator">=</span>com.mic.tech <span class="token parameter variable">-DartifactId</span><span class="token operator">=</span>firstProject <span class="token parameter variable">-DarchetypeArtifactId</span><span class="token operator">=</span>maven-archetype-quickstart <span class="token parameter variable">-DinteractiveMode</span><span class="token operator">=</span>false<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><ul><li><strong>-DgourpId</strong>: ç»„ç»‡åï¼Œä¸€èˆ¬ä¸ºå…¬å¸ç½‘å€çš„åå†™ï¼›</li><li><strong>-DartifactId</strong>: é¡¹ç›®å-æ¨¡å—åï¼›</li><li><strong>-DarchetypeArtifactId</strong>: ç”¨æ¥æŒ‡å®š ArchetypeIdï¼Œè¿™é‡Œç”¨åˆ°çš„æ˜¯maven-archetype-quickstartï¼Œå³åˆ›å»ºä¸€ä¸ªç®€å• Java åº”ç”¨ï¼›</li><li><strong>-DinteractiveMode</strong>: æ˜¯å¦ä½¿ç”¨äº¤äº’æ¨¡å¼ã€‚</li></ul><ol start="3"><li>ideaå·²ç»å†…ç½®maven</li></ol><p>æ·»åŠ å¤–éƒ¨ä¾èµ–</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">å°†å¤–éƒ¨æ–‡ä»¶å¯¼å…¥åˆ°é¡¹ç›®ä¸­ï¼Œé…ç½®pom.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- åœ¨è¿™é‡Œæ·»åŠ ä½ çš„ä¾èµ– --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>ldapjdk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!-- åº“åç§°ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ldapjdk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--åº“åç§°ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--ç‰ˆæœ¬å·--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>system<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--ä½œç”¨åŸŸ--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>systemPath</span><span class="token punctuation">&gt;</span></span>${basedir}\src\lib\ldapjdk.jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>systemPath</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--é¡¹ç›®æ ¹ç›®å½•ä¸‹        çš„libæ–‡ä»¶å¤¹ä¸‹--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h2><p>cookieå­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œsession å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯</p><h3 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h3><pre class="line-numbers language-JSP" data-language="JSP"><code class="language-JSP">&lt;% ä»£ç  %&gt;&lt;%! int i = 0 ; %&gt; å˜é‡å£°æ˜&lt;%= è¡¨è¾¾å¼ %&gt;  è¡¨è¾¾å¼å£°æ˜&lt;%-- æ³¨é‡Š --%&gt; æ³¨é‡Šï¼Œæ³¨é‡Šå†…å®¹ ä¸ä¼šè¢«å‘é€åˆ°æµè§ˆå™¨&lt;!-- htmlæ³¨é‡Š --&gt; å¯ä»¥é€šè¿‡æŸ¥çœ‹æºä»£ç æ¥è¿›è¡ŒæŸ¥çœ‹if --else è¯­æ³•&lt;% if (day == 1 || day == 7) { %&gt;      &lt;p&gt;ä»Šå¤©æ˜¯å‘¨æœ«&lt;/p&gt;&lt;% } else { %&gt;      &lt;p&gt;ä»Šå¤©ä¸æ˜¯å‘¨æœ«&lt;/p&gt;&lt;% } %&gt;switch &lt;% switch(day) {case 0:   out.println("æ˜ŸæœŸå¤©");   break;case 1:   out.println("æ˜ŸæœŸä¸€");   break;case 2:   out.println("æ˜ŸæœŸäºŒ");   break;case 3:   out.println("æ˜ŸæœŸä¸‰");   break;case 4:   out.println("æ˜ŸæœŸå››");   break;case 5:   out.println("æ˜ŸæœŸäº”");   break;default:   out.println("æ˜ŸæœŸå…­");}%&gt;forå¾ªç¯&lt;%for ( fontSize = 1; fontSize &lt;= 3; fontSize++){ %&gt;   &lt;font color="green" size="&lt;%= fontSize %&gt;"&gt;    èœé¸Ÿæ•™ç¨‹   &lt;/font&gt;&lt;br /&gt;&lt;%}%&gt;whileå¾ªç¯&lt;%while ( fontSize &lt;= 3){ %&gt;   &lt;font color="green" size="&lt;%= fontSize %&gt;"&gt;    èœé¸Ÿæ•™ç¨‹   &lt;/font&gt;&lt;br /&gt;&lt;%fontSize++;%&gt;&lt;%}%&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="JSPè¡Œä¸º"><a href="#JSPè¡Œä¸º" class="headerlink" title="JSPè¡Œä¸º"></a>JSPè¡Œä¸º</h3><p>ä½¿ç”¨xmlè¯­æ³•æ¥æ§åˆ¶servletå¼•æ“ï¼Œèƒ½å¤ŸåŠ¨æ€æ’å…¥ä¸€ä¸ªæ–‡ä»¶é‡ç”¨Javabeanç»„ä»¶ï¼Œåˆ‡æ¢é¡µé¢</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jsp</span> <span class="token attr-name">:action_name</span> <span class="token attr-name">attribute</span> <span class="token attr-name">attribute</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>value<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>action_name :include åœ¨å½“å‰é¡µé¢åŒ…å«é™æ€useBean å¯»æ‰¾å’Œåˆå§‹åŒ–ä¸€ä¸ªjavaç»„ä»¶setProperty è®¾ç½®JavaBeanç»„ä»¶çš„å€¼getProperty å°†JavaBean ç»„ä»¶çš„å€¼æ’å…¥åˆ°outputä¸­forward ä»ä¸€ä¸ªjspæ–‡ä»¶å‘å¦ä¸€ä¸ªæ–‡ä»¶ä¼ é€’ä¸€ä¸ªåŒ…å«ç”¨æˆ·è¯·æ±‚çš„request å¯¹è±¡plugin å†ç”Ÿæˆçš„htmlé¡µé¢ä¸­åŒ…å«Appletå’ŒJavaBeanå¯¹è±¡element åŠ¨æ€åˆ›å»ºä¸€ä¸ªxmlå…ƒç´ attribute å®šä¹‰åŠ¨æ€åˆ›å»ºçš„xmlå…ƒç´ çš„å±æ€§body åŠ¨æ€åˆ›å»ºxmlå…ƒç´ ä¸»ä½“text ç”¨äºå°è£…æ•°æ®<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="JSP-æŒ‡ä»¤"><a href="#JSP-æŒ‡ä»¤" class="headerlink" title="JSP æŒ‡ä»¤"></a>JSP æŒ‡ä»¤</h3><pre class="line-numbers language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ æŒ‡ä»¤ %&gt;  ä¸»è¦æŒ‡ä»¤æœ‰: page  å®šä¹‰ç½‘é¡µä¾èµ–å±æ€§ è„šæœ¬è¯­è¨€,erroré¡µé¢ï¼Œç¼“å­˜éœ€æ±‚ç­‰pageç›¸å…³çš„å±æ€§buffer æŒ‡å®šoutå¯¹è±¡ä½¿ç”¨ç¼“å†²åŒºå¤§å°autoFlush æ§åˆ¶out å¯¹è±¡çš„ç¼“å­˜åŒºconteneType æŒ‡å®šå½“å‰JSP é¡µé¢å‘ç”Ÿå¼‚å¸¸æ—¶éœ€è¦è½¬å‘çš„é”™è¯¯å¤„ç†é¡µé¢error Page æŒ‡å®šå½“JSPé¡µé¢å‘ç”Ÿå¼‚å¸¸æ—¶éœ€è¦è½¬å‘çš„é”™è¯¯å¤„ç†é¡µé¢isErrorPage æŒ‡å®šå½“å‰é¡µé¢æ˜¯å¦å¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªJSPé¡µé¢çš„é”™è¯¯å¤„ç†é¡µé¢extends servlet ä»å“ªä¸ªç±»ç»§æ‰¿import å¯¼å…¥è¦ä½¿ç”¨çš„java ç±»info å®šä¹‰jspé¡µé¢çš„è¡¨è¿°ä¿¡æ¯isThreadSafe æŒ‡å®šå¯¹JSPé¡µé¢çš„è®¿é—®æ˜¯å¦ä¸ºçº¿ç¨‹å®‰å…¨language å®šä¹‰JSPé¡µé¢æ‰€ç”¨çš„è„šæœ¬è¯­è¨€ï¼Œé»˜è®¤æ˜¯Javasession æŒ‡å®šJSPé¡µé¢æ˜¯å¦ä½¿ç”¨sessionisELIgnored æŒ‡å®šæ˜¯å¦æ‰§è¡ŒELè¡¨è¾¾å¼isScriptingEnabled ç¡®å®šè„šæœ¬å…ƒç´ èƒ½å¦è¢«ä½¿ç”¨include åŒ…å«å…¶ä»–æ–‡ä»¶&lt;%@ include file = "æ–‡ä»¶çš„ç›¸å¯¹url" %&gt;taglib  å¼•å…¥æ ‡ç­¾åº“çš„å®šä¹‰ï¼Œå¯ä»¥è‡ªå®šä¹‰æ ‡ç­¾&lt;% tagelib uri = "uri" prefix = "refix0Tag" %&gt;uri æ ‡ç­¾åº“çš„ä½ç½®   prefix æŒ‡å®šæ ‡ç­¾åº“çš„å‰ç¼€<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="JSPåŠ¨ä½œå…ƒç´ "><a href="#JSPåŠ¨ä½œå…ƒç´ " class="headerlink" title="JSPåŠ¨ä½œå…ƒç´ "></a>JSPåŠ¨ä½œå…ƒç´ </h3><p>JSPåŠ¨ä½œå…ƒç´ åœ¨è¯·æ±‚é˜¶æ®µå¤„ç†é˜¶æ®µèµ·ä½œç”¨ï¼Œä¸”ä½¿ç”¨çš„æ—¶xmlè¯­æ³•</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">è¯­æ³•ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">jsp:</span></span> <span class="token attr-name">action_name</span> <span class="token attr-name">attribute</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>include åœ¨é¡µé¢è¢«è¯·æ±‚çš„æ—¶å€™å¼•å…¥ä¸€ä¸ªæ–‡ä»¶page = "url" flush = "true or false" å®šä¹‰åœ¨åŒ…å«èµ„æºå‰æ˜¯å¦åˆ·æ–°ç¼“å­˜åŒºuseBean å¯»æ‰¾æˆ–è€…å®ä¾‹åŒ–ä¸€ä¸ªJavaBean<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">jsp:</span>useBean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>package.class<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>classæŒ‡å®šBeançš„å®Œæ•´åŒ…åã€‚type æŒ‡å®šå°†å¼•ç”¨è¯¥å¯¹è±¡å˜é‡çš„ç±»å‹ã€‚beanName é€šè¿‡ java.beans.Beans çš„ instantiate() æ–¹æ³•æŒ‡å®šBeançš„åå­—ã€‚setProperty è®¾ç½®JavaBeançš„å±æ€§å°†å…¶æ”¾åœ¨useBeanä¸­åªä¼šåœ¨æ‰¾åˆ°ä¸€ä¸ªBeanç¤ºä¾‹æ‰ä¼šè¿›è¡Œæ‰§è¡Œæ”¾åœ¨å¤–éƒ¨åˆ™ä¸è®ºæ˜¯å¦æ‰¾åˆ°beanéƒ½ä¼šæ‰§è¡Œå±æ€§: name è¡¨ç¤ºè¦è®¾ç½®å±æ€§çš„æ˜¯å“ªä¸ªbeanproperty æ— è®ºè¦è®¾ç½®å“ªä¸ªå±æ€§éƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šç”¨æ³•value æŒ‡å®šbeanå±æ€§çš„å€¼param æŒ‡å®šç”¨å“ªä¸ªå‚æ•°ä½œä¸ºBeanå±æ€§çš„å€¼getProperty è¾“å‡ºæŸä¸ªJavaBeançš„å±æ€§æå–å¯¹åº”çš„Beanå±æ€§çš„å€¼ï¼Œè½¬åŒ–ä¸ºå­—ç¬¦ä¸²ç„¶åè¾“å‡ºname è¯æ£€æ‰€çš„beanå±æ€§åç§°property è¡¨ç¤ºè¦æå–å±æ€§çš„å€¼forward æŠŠè¯·æ±‚è½¬åˆ°ä¸€ä¸ªæ–°çš„ç•Œé¢plugin æ ¹æ®æµè§ˆå™¨ç±»å‹ä¸ºJavaæ’ä»¶ç”Ÿæˆobeject æ´»embed æ ‡è®°element å®šä¹‰åŠ¨æ€xmlå…ƒç´ attribute è®¾ç½®åŠ¨æ€å®šä¹‰çš„xmlå±æ€§body åŠ¨æ€å®šä¹‰çš„xmlå†…å®¹text åœ¨jspé¡µé¢å’Œæ–‡æ¡£ä¸­ä½¿ç”¨å†™å…¥æ–‡æœ¬çš„æ¨¡æ¿<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="JSPéšå¼å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è€Œä¸æ˜¾ç¤ºå£°æ˜"><a href="#JSPéšå¼å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è€Œä¸æ˜¾ç¤ºå£°æ˜" class="headerlink" title="JSPéšå¼å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è€Œä¸æ˜¾ç¤ºå£°æ˜"></a>JSPéšå¼å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è€Œä¸æ˜¾ç¤ºå£°æ˜</h3><ol><li>request å¯¹è±¡ ^8a3722</li><li>responseå¯¹è±¡</li><li>out</li><li>session ç”¨æ¥è¿½è¸ªåœ¨å„ä¸ªå®¢æˆ·ç«¯è¯·æ±‚é—´çš„ä¼šè¯</li><li>application ä»£è¡¨è¿™è¿™ä¸ªJSPé¡µé¢</li><li>config </li><li>pageContext ä»£è¡¨æ•´ä¸ªjspé¡µé¢ï¼Œå­˜å‚¨äº†requestå’Œresponseçš„å¼•ç”¨ï¼Œapplication å¯¹è±¡ï¼Œconfig , session .  outå¯ä»¥è®¿é—®è¿™ä¸ªå¯¹è±¡æ¥å¯¼å‡º</li><li>page == this</li><li>exception</li></ol><h4 id="request-åŒservletä¸­çš„request"><a href="#request-åŒservletä¸­çš„request" class="headerlink" title="request(åŒservletä¸­çš„request)"></a>request(åŒservletä¸­çš„request)</h4><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>1</td><td><strong>Cookie[] getCookies()</strong><br><br>è¿”å›å®¢æˆ·ç«¯æ‰€æœ‰çš„Cookieçš„æ•°ç»„</td></tr><tr><td>2</td><td><strong>Enumeration getAttributeNames()</strong><br><br>è¿”å›requestå¯¹è±¡çš„æ‰€æœ‰å±æ€§åç§°çš„é›†åˆ</td></tr><tr><td>3</td><td><strong>Enumeration getHeaderNames()</strong><br><br>è¿”å›æ‰€æœ‰HTTPå¤´çš„åç§°é›†åˆ</td></tr><tr><td>4</td><td><strong>Enumeration getParameterNames()</strong><br><br>è¿”å›è¯·æ±‚ä¸­æ‰€æœ‰å‚æ•°çš„é›†åˆ</td></tr><tr><td>5</td><td><strong>HttpSession getSession()</strong><br><br>è¿”å›requestå¯¹åº”çš„sessionå¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ª</td></tr><tr><td>6</td><td><strong>HttpSession getSession(boolean create)</strong><br><br>è¿”å›requestå¯¹åº”çš„sessionå¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å¹¶ä¸”å‚æ•°createä¸ºtrueï¼Œåˆ™è¿”å›ä¸€ä¸ªæ–°çš„sessionå¯¹è±¡</td></tr><tr><td>7</td><td><strong>Locale getLocale()</strong><br><br>è¿”å›å½“å‰é¡µçš„Localeå¯¹è±¡ï¼Œå¯ä»¥åœ¨responseä¸­è®¾ç½®</td></tr><tr><td>8</td><td><strong>Object getAttribute(String name)</strong><br><br>è¿”å›åç§°ä¸ºnameçš„å±æ€§å€¼ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›nullã€‚</td></tr><tr><td>9</td><td><strong>ServletInputStream getInputStream()</strong><br><br>è¿”å›è¯·æ±‚çš„è¾“å…¥æµ</td></tr><tr><td>10</td><td><strong>String getAuthType()</strong><br><br>è¿”å›è®¤è¯æ–¹æ¡ˆçš„åç§°ï¼Œç”¨æ¥ä¿æŠ¤servletï¼Œæ¯”å¦‚ â€œBASICâ€ æˆ–è€… â€œSSLâ€ æˆ– null å¦‚æœ JSPæ²¡è®¾ç½®ä¿æŠ¤æªæ–½</td></tr><tr><td>11</td><td><strong>String getCharacterEncoding()</strong><br><br>è¿”å›requestçš„å­—ç¬¦ç¼–ç é›†åç§°</td></tr><tr><td>12</td><td><strong>String getContentType()</strong><br><br>è¿”å›requestä¸»ä½“çš„MIMEç±»å‹ï¼Œè‹¥æœªçŸ¥åˆ™è¿”å›null</td></tr><tr><td>13</td><td><strong>String getContextPath()</strong><br><br>è¿”å›request URIä¸­æŒ‡æ˜çš„ä¸Šä¸‹æ–‡è·¯å¾„</td></tr><tr><td>14</td><td><strong>String getHeader(String name)</strong><br><br>è¿”å›nameæŒ‡å®šçš„ä¿¡æ¯å¤´</td></tr><tr><td>15</td><td><strong>String getMethod()</strong><br><br>è¿”å›æ­¤requestä¸­çš„HTTPæ–¹æ³•ï¼Œæ¯”å¦‚ GET,ï¼ŒPOSTï¼Œæˆ–PUT</td></tr><tr><td>16</td><td><strong>String getParameter(String name)</strong><br><br>è¿”å›æ­¤requestä¸­nameæŒ‡å®šçš„å‚æ•°ï¼Œè‹¥ä¸å­˜åœ¨åˆ™è¿”å›null</td></tr><tr><td>17</td><td><strong>String getPathInfo()</strong><br><br>è¿”å›ä»»ä½•é¢å¤–çš„ä¸æ­¤request URLç›¸å…³çš„è·¯å¾„</td></tr><tr><td>18</td><td><strong>String getProtocol()</strong><br><br>è¿”å›æ­¤requestæ‰€ä½¿ç”¨çš„åè®®åå’Œç‰ˆæœ¬</td></tr><tr><td>19</td><td><strong>String getQueryString()</strong><br><br>è¿”å›æ­¤ request URLåŒ…å«çš„æŸ¥è¯¢å­—ç¬¦ä¸²</td></tr><tr><td>20</td><td><strong>String getRemoteAddr()</strong><br><br>è¿”å›å®¢æˆ·ç«¯çš„IPåœ°å€</td></tr><tr><td>21</td><td><strong>String getRemoteHost()</strong><br><br>è¿”å›å®¢æˆ·ç«¯çš„å®Œæ•´åç§°</td></tr><tr><td>22</td><td><strong>String getRemoteUser()</strong><br><br>è¿”å›å®¢æˆ·ç«¯é€šè¿‡ç™»å½•è®¤è¯çš„ç”¨æˆ·ï¼Œè‹¥ç”¨æˆ·æœªè®¤è¯åˆ™è¿”å›null</td></tr><tr><td>23</td><td><strong>String getRequestURI()</strong><br><br>è¿”å›requestçš„URI</td></tr><tr><td>24</td><td><strong>String getRequestedSessionId()</strong><br><br>è¿”å›requestæŒ‡å®šçš„session ID</td></tr><tr><td>25</td><td><strong>String getServletPath()</strong><br><br>è¿”å›æ‰€è¯·æ±‚çš„servletè·¯å¾„</td></tr><tr><td>26</td><td><strong>String[] getParameterValues(String name)</strong><br><br>è¿”å›æŒ‡å®šåç§°çš„å‚æ•°çš„æ‰€æœ‰å€¼ï¼Œè‹¥ä¸å­˜åœ¨åˆ™è¿”å›null</td></tr><tr><td>27</td><td><strong>boolean isSecure()</strong><br><br>è¿”å›requestæ˜¯å¦ä½¿ç”¨äº†åŠ å¯†é€šé“ï¼Œæ¯”å¦‚HTTPS</td></tr><tr><td>28</td><td><strong>int getContentLength()</strong><br><br>è¿”å›requestä¸»ä½“æ‰€åŒ…å«çš„å­—èŠ‚æ•°ï¼Œè‹¥æœªçŸ¥çš„è¿”å›-1</td></tr><tr><td>29</td><td><strong>int getIntHeader(String name)</strong><br><br>è¿”å›æŒ‡å®šåç§°çš„requestä¿¡æ¯å¤´çš„å€¼</td></tr><tr><td>30</td><td><strong>int getServerPort()</strong><br><br>è¿”å›æœåŠ¡å™¨ç«¯å£å·</td></tr></tbody></table><h3 id="Tokenæ˜¯ä¸€ç§ä»¤ç‰Œï¼Œç”¨æ¥è¯†åˆ«è®¿é—®äººå‘˜çš„"><a href="#Tokenæ˜¯ä¸€ç§ä»¤ç‰Œï¼Œç”¨æ¥è¯†åˆ«è®¿é—®äººå‘˜çš„" class="headerlink" title="Tokenæ˜¯ä¸€ç§ä»¤ç‰Œï¼Œç”¨æ¥è¯†åˆ«è®¿é—®äººå‘˜çš„"></a>Tokenæ˜¯ä¸€ç§ä»¤ç‰Œï¼Œç”¨æ¥è¯†åˆ«è®¿é—®äººå‘˜çš„</h3>]]></content>
      
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
