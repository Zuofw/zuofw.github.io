<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zuofw.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="ä¸ªäººç½‘ç«™ï¼Œå­¦ä¹ è®°å½•ï¼Œé¢è¯•è®°å½•å’Œç»éªŒæ€»ç»“ã€äº’è”ç½‘ä¸­ä¸€å—å±äºè‡ªå·±çš„å°çª">
<meta property="og:type" content="website">
<meta property="og:title" content="QingQiu&#39;Blog">
<meta property="og:url" content="https://zuofw.github.io/index.html">
<meta property="og:site_name" content="QingQiu&#39;Blog">
<meta property="og:description" content="ä¸ªäººç½‘ç«™ï¼Œå­¦ä¹ è®°å½•ï¼Œé¢è¯•è®°å½•å’Œç»éªŒæ€»ç»“ã€äº’è”ç½‘ä¸­ä¸€å—å±äºè‡ªå·±çš„å°çª">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="QingQiu">
<meta property="article:tag" content="åšå®¢ï¼Œå­¦ä¹ ï¼Œæˆé•¿">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://zuofw.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>QingQiu'Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>


<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">QingQiu'Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">æ¸…ç§‹çš„åšå®¢</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-fa fa-home"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-fa fa-tags"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-fa fa-th"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-fa fa-archive"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-github">

    <a href="https://github.com/Zuofw" rel="noopener" target="_blank"><i class="fa fa-fw fa-fab fa-github"></i>Github</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zuofw.github.io/2024/09/02/00/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QingQiu">
      <meta itemprop="description" content="ä¸ªäººç½‘ç«™ï¼Œå­¦ä¹ è®°å½•ï¼Œé¢è¯•è®°å½•å’Œç»éªŒæ€»ç»“ã€äº’è”ç½‘ä¸­ä¸€å—å±äºè‡ªå·±çš„å°çª">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QingQiu'Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/02/00/" class="post-title-link" itemprop="url">æ‰‹å†™rpc</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2024-09-02 11:08:00" itemprop="dateCreated datePublished" datetime="2024-09-02T11:08:00+08:00">2024-09-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-10-09 14:09:46" itemprop="dateModified" datetime="2024-10-09T14:09:46+08:00">2024-10-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">æ·±å…¥ç†è§£ç³»åˆ—</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>38k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ä¸ªäººåšå®¢"><a href="#ä¸ªäººåšå®¢" class="headerlink" title="ä¸ªäººåšå®¢"></a>ä¸ªäººåšå®¢</h2><p><a href="https://zuofw.github.io/">https://zuofw.github.io/</a><br>æœ¬é¡¹ç›®è¯¦ç»†ä»‹ç»å’Œå®ç°ï¼š<br><a href="https://zuofw.github.io/2024/09/02/00/">æ‰‹å†™rpc | QingQiuâ€™Blog (zuofw.github.io)</a><br>æºç åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/Zuofw/zuofw-rpc">Zuofw/zuofw-rpc: ä¸€ä¸ªåºŸç‰©çš„æ‰‹å†™rpc (github.com)</a></p>
<h2 id="é¡¹ç›®ä»‹ç»"><a href="#é¡¹ç›®ä»‹ç»" class="headerlink" title="é¡¹ç›®ä»‹ç»"></a>é¡¹ç›®ä»‹ç»</h2><p>zuofw-rpcæ˜¯ä¸€æ¬¾åŸºäºJavaã€Nettyã€Zookeeperå®ç°çš„RPCé€šä¿¡æ¡†æ¶ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§ï¼š</p>
<ol>
<li>ä½¿ç”¨â€å¾®å†…æ ¸+å¯æ’æ‹”â€æ¶æ„ï¼Œé€šè¿‡è‡ªå®šä¹‰SPIåŠ è½½æœºåˆ¶ï¼Œæ”¯æŒç¼“å­˜ï¼ŒåŠ¨æ€æ›¿ä»£æ‰©å±•ç‚¹ç»„ä»¶</li>
<li>çµæ´»ä½¿ç”¨è®¾è®¡æ¨¡å¼æ¥æé«˜ç³»ç»Ÿå¯æ‰©å±•æ€§ï¼Œå¦‚å•ä¾‹æ¨¡å¼ã€å·¥å‚æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼</li>
<li>å®ç°æœåŠ¡è°ƒç”¨è´Ÿè½½å‡è¡¡æœºåˆ¶ï¼Œæ”¯æŒè½®è¯¢ã€éšæœºã€ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œä¼˜åŒ–è°ƒç”¨ä½“éªŒ</li>
<li>é€šè¿‡è‡ªå®šä¹‰é€šä¿¡åè®®ã€æ”¯æŒå¤šç§åºåˆ—åŒ–æ–¹å¼ï¼ŒåŒæ—¶å®ç°Gzipå‹ç¼©ï¼Œæé«˜ç½‘ç»œä¼ è¾“æ•ˆç‡ã€‚</li>
<li>å®ç°è‡ªå®šä¹‰request - responseæ¨¡å‹ï¼Œåœ¨å¼‚æ­¥é€šä¿¡æ¡ä»¶ä¸‹ç¡®ä¿æ¶ˆæ¯çš„è¯·æ±‚å’Œå“åº”æˆåŠŸ</li>
<li>åŸºäºè‡ªå®šä¹‰starterå®ç°ï¼Œä¼˜åŒ–SpringBootç¯å¢ƒä¸‹çš„ä½¿ç”¨ã€‚</li>
</ol>
<h2 id="åŸºæœ¬æ¶æ„"><a href="#åŸºæœ¬æ¶æ„" class="headerlink" title="åŸºæœ¬æ¶æ„"></a>åŸºæœ¬æ¶æ„</h2><p><img src="/2024/09/02/00/%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84.png"></p>
<ol>
<li>æ³¨å†Œä¸­å¿ƒï¼Œç”¨äºæœåŠ¡æ³¨å†Œå’Œè·å–</li>
<li>æœåŠ¡ç«¯ï¼šæä¾›æœåŠ¡çš„ä¸€æ–¹Provider</li>
<li>å®¢æˆ·ç«¯ï¼šè°ƒç”¨æœåŠ¡çš„ä¸€æ–¹Consumer<br>åŸºæœ¬æµç¨‹ï¼š</li>
<li>æœåŠ¡ç«¯æŠŠæœåŠ¡ä¿¡æ¯æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸Šï¼Œä¸€èˆ¬åŒ…æ‹¬æœåŠ¡ç«¯åœ°å€ã€æ¥å£ç±»å’Œæ–¹æ³•</li>
<li>å®¢æˆ·ç«¯ä»æ³¨å†Œä¸­å¿ƒè·å–å¯¹åº”çš„æœåŠ¡ä¿¡æ¯</li>
<li>å®¢æˆ·ç«¯æ ¹æ®æœåŠ¡çš„ä¿¡æ¯ï¼Œé€šè¿‡ç½‘ç»œè°ƒç”¨æœåŠ¡ç«¯çš„æ¥å£</li></ol>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/09/02/00/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zuofw.github.io/2024/10/03/28/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QingQiu">
      <meta itemprop="description" content="ä¸ªäººç½‘ç«™ï¼Œå­¦ä¹ è®°å½•ï¼Œé¢è¯•è®°å½•å’Œç»éªŒæ€»ç»“ã€äº’è”ç½‘ä¸­ä¸€å—å±äºè‡ªå·±çš„å°çª">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QingQiu'Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/03/28/" class="post-title-link" itemprop="url">æ·±å…¥æµ…å‡ºï¼Œä»æºç ææ¸…Beançš„åŠ è½½è¿‡ç¨‹</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2024-10-03 20:19:28" itemprop="dateCreated datePublished" datetime="2024-10-03T20:19:28+08:00">2024-10-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">æ·±å…¥ç†è§£ç³»åˆ—</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>11k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>Beançš„åŠ è½½è¿‡ç¨‹ç®—æ˜¯é¢è¯•ä¸­çš„è€ç”Ÿå¸¸è°ˆäº†ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥ä»æºç å±‚é¢æ·±å…¥å»äº†è§£ä¸€ä¸‹Springä¸­æ˜¯å¦‚ä½•è¿›è¡ŒBeançš„åŠ è½½çš„</p>
<h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><p>å…ˆçœ‹ç¤ºä¾‹ä»£ç ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"classpath:/spring/text.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"stringutil"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>æˆ‘ä»¬å°±ä»è¿™ä¸ªgetBeanå»æ¢ç´¢Springå¦‚ä½•è¿›è¡Œç±»çš„åŠ è½½ã€‚<br>é¦–å…ˆæˆ‘ä»¬å…ˆçœ‹çœ‹ClassPathXmlApplicationContexçš„ç»§æ‰¿å…³ç³»ï¼š</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/10/03/28/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zuofw.github.io/2024/09/29/55/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QingQiu">
      <meta itemprop="description" content="ä¸ªäººç½‘ç«™ï¼Œå­¦ä¹ è®°å½•ï¼Œé¢è¯•è®°å½•å’Œç»éªŒæ€»ç»“ã€äº’è”ç½‘ä¸­ä¸€å—å±äºè‡ªå·±çš„å°çª">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QingQiu'Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/29/55/" class="post-title-link" itemprop="url">MySQLä¸­NULLå€¼æ˜¯å¦ä¼šå½±å“ç´¢å¼•çš„ä½¿ç”¨</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2024-09-29 19:13:55" itemprop="dateCreated datePublished" datetime="2024-09-29T19:13:55+08:00">2024-09-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">æ·±å…¥ç†è§£ç³»åˆ—</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>1.9k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ä¸ºä½•å†™è¿™ä¸€ç¯‡æ–‡ç« "><a href="#ä¸ºä½•å†™è¿™ä¸€ç¯‡æ–‡ç« " class="headerlink" title="ä¸ºä½•å†™è¿™ä¸€ç¯‡æ–‡ç« "></a>ä¸ºä½•å†™è¿™ä¸€ç¯‡æ–‡ç« </h1><p>ğŸ­ğŸ­åœ¨é¢è¯•çš„æ—¶å€™è¢«é—®åˆ°NULLå€¼æ˜¯å¦ä¼šèµ°ç´¢å¼•çš„æ—¶å€™ï¼Œæ„Ÿåˆ°æœ‰ç‚¹ä¸ç†è§£ï¼Œäºæ˜¯äº‹åå°±æœ‰äº†è¿™ç¯‡æ–‡ç« <br>é—®é¢˜ï¼š<br>ä¸ºnameå»ºç«‹ç´¢å¼•ï¼Œnameå¯ä»¥ä¸ºç©º<br><code>select * from user where name is null</code>æ˜¯å¦ä¼šä½¿ç”¨ç´¢å¼•ï¼Ÿ<br>ç”Ÿæ´»ä¼šæ‹·æ‰“æ¯ä¸€ä¸ªåšäº‹ä¸è®¤çœŸçš„äººğŸ˜­</p>
<h1 id="ç´¢å¼•çš„ç»“æ„"><a href="#ç´¢å¼•çš„ç»“æ„" class="headerlink" title="ç´¢å¼•çš„ç»“æ„"></a>ç´¢å¼•çš„ç»“æ„</h1><p>è¯¦ç»†çš„å¯ä»¥å‚ç…§æˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« æ·±å…¥æµ…å‡ºMySQLï¼Œé‡Œé¢æœ‰å…³äºç´¢å¼•çš„è¯¦ç»†ä»‹ç»<br>åœ¨InnoDBå¼•æ“ä¸­ï¼Œç´¢å¼•åˆ†ä¸ºèšç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•ï¼Œå¯¹äºäºŒçº§ç´¢å¼•ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸‹æˆ‘ä»¬è¦è€ƒè™‘çš„å°±æ˜¯æ˜¯å¦ä¼šä¸ºNULLå»ºç«‹ç´¢å¼•å’Œå¦‚æœåˆ—ä¸­å­˜åœ¨NULLå€¼ï¼Œæ˜¯å¦ä¼šèµ°ç´¢å¼•å»æŸ¥æ‰¾è¿™ä¸ªNULL</p>
<h1 id="è®¿é—®æ–¹æ³•"><a href="#è®¿é—®æ–¹æ³•" class="headerlink" title="è®¿é—®æ–¹æ³•"></a>è®¿é—®æ–¹æ³•</h1><p>è®¿é—®æ–¹æ³•æ˜¯MySQLæ¥å®é™…è®¿é—®æ•°æ®çš„æ‰§è¡Œæ–¹æ³•<br>å¤§è‡´åˆ†ä¸ºï¼š</p>
<ol>
<li>å…¨è¡¨æ‰«æ</li>
<li>ä½¿ç”¨ç´¢å¼•æ‰«</li>
</ol>
<h2 id="æµ‹è¯•è¡¨"><a href="#æµ‹è¯•è¡¨" class="headerlink" title="æµ‹è¯•è¡¨"></a>æµ‹è¯•è¡¨</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE user (  
                          `id` int(11) NOT NULL AUTO_INCREMENT,  
                          `name` varchar(20) NOT NULL,  
                          `age` int(11) DEFAULT NULL,  
                          `sex` varchar(20) DEFAULT NULL,  
                          PRIMARY KEY (`id`)  
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;  
  
INSERT INTO user (`id`, `name`, `age`, `sex`) VALUES ('1', 'Bob', '20', 'ç”·');  
INSERT INTO user (`id`, `name`, `age`, `sex`) VALUES ('2', 'Jack', '20', 'ç”·');  
INSERT INTO user (`id`, `name`, `age`, `sex`) VALUES ('3', 'Tony', '20', 'ç”·');  
INSERT INTO user (`id`, `name`, `age`, `sex`) VALUES ('4', 'Alan', '20', 'ç”·');  
  
CREATE  UNIQUE  INDEX indexName ON user(name(20));  
# ä¸ºageå»ºç«‹ç´¢å¼•  
CREATE INDEX indexAge ON user(age);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="const"><a href="#const" class="headerlink" title="const"></a>const</h2><p>é€šè¿‡ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—æ¥å®šä½ä¸€æ¡è®°å½•çš„è®¿é—®æ–¹æ³•<br><code>explain select * from user where id = 1;</code><br>è§£å†³å¦‚ä¸‹ï¼š<br><img src="/2024/09/29/55/const.png" alt="|1150"><br>é€šè¿‡typeæˆ‘ä»¬å¯ä»¥çœ‹è§è®¿é—®æ–¹æ³•æ˜¯const</p>
<h2 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h2><p>å¦‚æœäºŒçº§ç´¢å¼•åˆ—ä¸æ˜¯å”¯ä¸€çš„ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨äºŒçº§ç´¢å¼•çš„å€¼å»åŒ¹é…ï¼Œä¹‹åå†å›è¡¨<br><img src="/2024/09/29/55/ref.png"><br><code>explain select * from user where age = 20;</code><br><img src="/2024/09/29/55/ref-result.png"><br>å¦‚å›¾ä½¿ç”¨çš„æ˜¯refæ–¹æ³•<br><strong>äºŒçº§ç´¢å¼•åˆ—å€¼ä¸ºNULLæ—¶</strong>ï¼š<br>äºŒçº§ç´¢å¼•åˆ—å¯¹NULLå€¼çš„æ•°é‡æ—¶ä¸é™åˆ¶çš„ï¼Œæ‰€ä»¥key is NULLæœ€å¤šä½¿ç”¨çš„æ˜¯refï¼Œè€Œä¸æ˜¯const</p>
<h2 id="ref-or-null"><a href="#ref-or-null" class="headerlink" title="ref_or_null"></a>ref_or_null</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æ‰¾å‡ºäºŒçº§ç´¢å¼•ç­‰äºå¸¸æ•°å’Œä¸ºNULLçš„è®°å½•ä¸€åŒæ‰¾å‡º<br><code>explain select * from user where age = 20 or age is null ;</code><br><img src="/2024/09/29/55/ref_or_null-result.png"><br>æ‰§è¡Œçš„æµç¨‹ï¼š<br>å¦‚å›¾ï¼ŒNULLæ˜¯æ”¾åœ¨æ¯ä¸€å±‚ä¸­æœ€å·¦ä¾§çš„ï¼Œå¹¶ä¸”æ˜¯è¿åœ¨ä¸€èµ·çš„<br><img src="/2024/09/29/55/ref_or_null.png"></p>
<h2 id="range"><a href="#range" class="headerlink" title="range"></a>range</h2><p>ä½¿ç”¨ç´¢å¼•è¿›è¡ŒèŒƒå›´è®¿é—®ï¼Œå¯ä»¥æ˜¯èšç°‡ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥æ˜¯äºŒçº§ç´¢å¼•ã€‚<br><code>explain select * from user where age &gt; 11 and age &lt;= 20;</code><br><img src="/2024/09/29/55/range.png"></p>
<h2 id="index"><a href="#index" class="headerlink" title="index"></a>index</h2><p>éå†äºŒçº§ç´¢å¼•è®°å½•çš„æ‰§è¡Œæ–¹å¼ï¼Œå¸¸å¸¸å‡ºç°åœ¨æŸ¥è¯¢åˆ—å’Œæ¡ä»¶éƒ½åŒ…å«åœ¨ç´¢å¼•ä¸­ï¼Œä¸éœ€è¦å›è¡¨ï¼Œæ‰€ä»¥ç›´æ¥éå†å³å¯</p>
<h2 id="all"><a href="#all" class="headerlink" title="all"></a>all</h2><p>å…¨è¡¨æ‰«æ</p>
<h1 id="NULLåœ¨äºŒçº§ç´¢å¼•ä¸­çš„ä½ç½®"><a href="#NULLåœ¨äºŒçº§ç´¢å¼•ä¸­çš„ä½ç½®" class="headerlink" title="NULLåœ¨äºŒçº§ç´¢å¼•ä¸­çš„ä½ç½®"></a>NULLåœ¨äºŒçº§ç´¢å¼•ä¸­çš„ä½ç½®</h1><p>é€šè¿‡æŸ¥è¯¢èµ„æ–™ï¼Œå‘ç°å¦‚æœç´¢å¼•åˆ—å…è®¸NULLå€¼ï¼Œé‚£ä¹ˆNULLåœ¨äºŒçº§ç´¢å¼•ä¸­æ˜¯è¢«å½“ä½œæœ€å°å€¼æ”¾åœ¨æ ‘çš„æ¯ä¸€å±‚çš„æœ€å·¦ä¾§çš„ï¼Œä¹Ÿå°±æ˜¯NULLå€¼ä¼šè¢«å½“æˆç´¢å¼•åˆ—çš„æ•°æ®ä½¿ç”¨çš„ï¼Œæ‰€ä»¥NULLå€¼åŒ¹é…æ˜¯å¯èƒ½ä¼šèµ°ç´¢å¼•çš„</p>
<ol>
<li>å¦‚æœåœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨IS NULLæˆ–IS NOT NULLï¼ŒMySQLé€šå¸¸ä¼šèµ°ç´¢å¼•<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// typeä¸ºrefï¼Œæ‰€ä»¥èµ°ç´¢å¼•äº†</span>
explain select <span class="token operator">*</span> from user where age is <span class="token keyword">null</span><span class="token punctuation">;</span>  
<span class="token comment">// typeä¸ºrangeï¼Œæ‰€ä»¥èµ°ç´¢å¼•äº†</span>
explain select <span class="token operator">*</span> from user where age is not <span class="token keyword">null</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>ç¬¦åˆç´¢å¼•ï¼Œå¦‚æœç­¾åˆ°åˆ—ä¸ä¸ºNULLï¼Œåç»­çš„åˆ—ä¹Ÿæ˜¯å¯ä»¥èµ°ç´¢å¼•çš„</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zuofw.github.io/2024/09/28/24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QingQiu">
      <meta itemprop="description" content="ä¸ªäººç½‘ç«™ï¼Œå­¦ä¹ è®°å½•ï¼Œé¢è¯•è®°å½•å’Œç»éªŒæ€»ç»“ã€äº’è”ç½‘ä¸­ä¸€å—å±äºè‡ªå·±çš„å°çª">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QingQiu'Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/28/24/" class="post-title-link" itemprop="url">HashMapæºç åˆ†æä¸å¸¸è§å…«è‚¡</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2024-09-28 10:58:24" itemprop="dateCreated datePublished" datetime="2024-09-28T10:58:24+08:00">2024-09-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">æ·±å…¥ç†è§£ç³»åˆ—</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>17k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="æ–‡ç« æ¨è"><a href="#æ–‡ç« æ¨è" class="headerlink" title="æ–‡ç« æ¨è"></a>æ–‡ç« æ¨è</h1><p><a target="_blank" rel="noopener" href="https://javadoop.com/post/hashmap">Java7/8 ä¸­çš„ HashMap å’Œ ConcurrentHashMap å…¨è§£æ (javadoop.com)</a></p>
<h1 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h1><h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><h3 id="åŸºæœ¬å±æ€§-é˜ˆå€¼-amp-ç³»æ•°-amp-å®¹é‡"><a href="#åŸºæœ¬å±æ€§-é˜ˆå€¼-amp-ç³»æ•°-amp-å®¹é‡" class="headerlink" title="åŸºæœ¬å±æ€§(é˜ˆå€¼&amp;ç³»æ•°&amp;å®¹é‡)"></a>åŸºæœ¬å±æ€§(é˜ˆå€¼&amp;ç³»æ•°&amp;å®¹é‡)</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>
    <span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
	<span class="token comment">// åºåˆ—å·</span>
    <span class="token annotation punctuation">@java.io.Serial</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">362498820763181265L</span><span class="token punctuation">;</span>

	<span class="token comment">// é»˜è®¤å®¹é‡ï¼Œä¹Ÿå°±æ˜¯ 16</span>
	<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> 

	<span class="token comment">/**
	 * æœ€å¤§å®¹é‡ï¼Œå¦‚æœé€šè¿‡æ„é€ å‡½æ•°éšå¼æŒ‡å®šäº†æ›´é«˜çš„å€¼ï¼Œåˆ™ä½¿ç”¨æ­¤å€¼ã€‚
	 * å¿…é¡»æ˜¯2çš„å¹‚ä¸” &lt;= 1&lt;&lt;30ã€‚
	 * ä¹Ÿå°±æ˜¯æœ€å¤§å®¹é‡æ˜¯ 2^30
	 */</span>
	<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * æ„é€ å‡½æ•°æœªæŒ‡å®šæ—¶ä½¿ç”¨çš„è´Ÿè½½å› å­ã€‚
	 */</span>
	<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span> <span class="token operator">=</span> <span class="token number">0.75f</span><span class="token punctuation">;</span>

	<span class="token comment">// å½“æ¡¶ä¸Šçš„èŠ‚ç‚¹æ•°&gt;=è¿™ä¸ªå€¼æ—¶ä¼šè½¬åŒ–ä¸ºçº¢é»‘æ ‘</span>
	<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">TREEIFY_THRESHOLD</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>

	<span class="token comment">// å½“æ¡¶ä¸Šçš„èŠ‚ç‚¹æ•°å°äºè¿™ä¸ªå€¼æ—¶ä¼šè½¬åŒ–ä¸ºé“¾è¡¨</span>
	<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">UNTREEIFY_THRESHOLD</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>

	<span class="token comment">// è½¬åŒ–ä¸ºçº¢é»‘æ ‘å¯¹åº”çš„æ‰€éœ€è¦çš„æœ€å°çš„æ•°ç»„å®¹é‡</span>
	<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MIN_TREEIFY_CAPACITY</span> <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">;</span>
	<span class="token comment">// å­˜å‚¨å…ƒç´ çš„æ•°ç»„ï¼Œå®¹é‡æ€»æ˜¯2çš„å¹‚æ¬¡å€</span>
	<span class="token keyword">transient</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> table<span class="token punctuation">;</span>
	<span class="token comment">// transientç”¨äºæ ‡è¯†è¿™ä¸ªå­—æ®µä¸åº”è¯¥è¢«åºåˆ—åŒ–</span>
	<span class="token keyword">transient</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> entrySet<span class="token punctuation">;</span>
	<span class="token comment">// å­˜æ”¾å…ƒç´ çš„ä¸ªæ•°ï¼Œ</span>
	<span class="token keyword">transient</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span>
	<span class="token comment">// æ¯æ¬¡æ‰©å®¹å’Œæ›´æ”¹mapç»“æ„çš„è®¡æ•°å™¨</span>
	<span class="token comment">/*
	* 1.æ£€æµ‹å¹¶å‘ä¿®æ”¹ï¼šåœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œå¦‚æœ modCount å‘ç”Ÿå˜åŒ–ï¼Œè¿­ä»£å™¨ä¼šæŠ›å‡º ConcurrentModificationExceptionï¼Œä»¥é˜²æ­¢å¹¶å‘ä¿®æ”¹å¯¼è‡´çš„ä¸ä¸€è‡´æ€§ã€‚
	2.ç»´æŠ¤å†…éƒ¨çŠ¶æ€ï¼šåœ¨æŸäº›æ“ä½œï¼ˆå¦‚æ’å…¥ã€åˆ é™¤ã€æ‰©å®¹ï¼‰ä¸­ï¼ŒmodCount ä¼šå¢åŠ ï¼Œä»¥ç¡®ä¿ HashMap çš„å†…éƒ¨çŠ¶æ€ä¿æŒä¸€è‡´
	*/</span>
	<span class="token keyword">transient</span> <span class="token keyword">int</span> modCount<span class="token punctuation">;</span>
	<span class="token comment">// é˜ˆå€¼(å®¹é‡*è´Ÿè½½å› å­) å½“å®é™…å¤§å°è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œä¼šè¿›è¡Œæ‰©å®¹</span>
	<span class="token keyword">int</span> threshold<span class="token punctuation">;</span>
	<span class="token comment">// è´Ÿè½½å› å­</span>
	<span class="token keyword">final</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="loadFactorè´Ÿè½½å› å­"><a href="#loadFactorè´Ÿè½½å› å­" class="headerlink" title="loadFactorè´Ÿè½½å› å­"></a>loadFactorè´Ÿè½½å› å­</h4><p>è´Ÿè½½å› å­æ˜¯æ§åˆ¶æ•°ç»„å­˜æ”¾æ•°æ®çš„ç–å¯†ç¨‹åº¦ï¼ŒloadFactorè¶Šæ¥è¿‘1ï¼Œé‚£ä¹ˆæ•°ç»„ä¸­å­˜æ”¾çš„æ•°æ®(entry)ä¹Ÿå°±è¶Šå¤š,å¦åˆ™å°±è¶Šå°‘ã€‚<br>å¤ªå¤§æŸ¥æ‰¾å…ƒç´ çš„æ•ˆç‡ä½ï¼Œå¤ªå°åˆ©ç”¨ç‡å¤ªä½<br>æ‰€ä»¥é»˜è®¤ 16 * 0.75 = 12ï¼Œè¶…è¿‡è¿™ä¸ªæ•°æ®é‡æ—¶ï¼Œå°±ä¼šè¿›è¡Œæ‰©å®¹</p>
<h4 id="threshold"><a href="#threshold" class="headerlink" title="threshold"></a>threshold</h4><p>threshold = capacity * loadFacotryï¼Œæ˜¯æ•°ç»„æ‰©å®¹çš„æ ‡å‡†<br>å› ä¸ºhashmapä¸­æ²¡æœ‰capacityè¿™ä¸ªå±aæ€§ï¼Œæ‰€ä»¥å³ä½¿æŒ‡å®šäº†åˆå§‹åŒ–çš„capacityï¼Œä¹Ÿä¼šè¢«æ‰©å®¹åˆ°2çš„æœ€æ¥è¿‘è¿™ä¸ªå¤§å°çš„å¹‚æ¬¡æ–¹</p>
<h3 id="Node-èŠ‚ç‚¹ç±»æºç "><a href="#Node-èŠ‚ç‚¹ç±»æºç " class="headerlink" title="Node èŠ‚ç‚¹ç±»æºç "></a>Node èŠ‚ç‚¹ç±»æºç </h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ç»§æ‰¿Map.Entry&lt;K,V&gt;</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>  
	<span class="token comment">// hashå€¼ï¼Œå­˜æ”¾å…ƒç´ åˆ°hashmapæ—¶ç”¨æ¥ä¸å…¶ä»–å…ƒç´ è¿›è¡Œæ¯”è¾ƒ</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> hash<span class="token punctuation">;</span>  
    <span class="token keyword">final</span> <span class="token class-name">K</span> key<span class="token punctuation">;</span>  
    <span class="token class-name">V</span> value<span class="token punctuation">;</span>  
	<span class="token comment">// æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> next<span class="token punctuation">;</span>  
  
    <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token keyword">this</span><span class="token punctuation">.</span>hash <span class="token operator">=</span> hash<span class="token punctuation">;</span>  
        <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>  
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>  
        <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">K</span> <span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span> <span class="token keyword">return</span> key<span class="token punctuation">;</span> <span class="token punctuation">}</span>  
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span> <span class="token keyword">return</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>  
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> key <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token class-name">V</span> newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token class-name">V</span> oldValue <span class="token operator">=</span> value<span class="token punctuation">;</span>  
        value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>  
        <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">)</span>  
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  
  
        <span class="token keyword">return</span> o <span class="token keyword">instanceof</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> e  
                <span class="token operator">&amp;&amp;</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
                <span class="token operator">&amp;&amp;</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="æ ‘èŠ‚ç‚¹æºç "><a href="#æ ‘èŠ‚ç‚¹æºç " class="headerlink" title="æ ‘èŠ‚ç‚¹æºç "></a>æ ‘èŠ‚ç‚¹æºç </h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ä»…æˆªå–éƒ¨åˆ†æºç </span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">LinkedHashMap<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>  
    <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> parent<span class="token punctuation">;</span>  <span class="token comment">// çˆ¶</span>
    <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> left<span class="token punctuation">;</span>    <span class="token comment">// å·¦</span>
    <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> right<span class="token punctuation">;</span>   <span class="token comment">// å³ </span>
    <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> prev<span class="token punctuation">;</span>    <span class="token comment">// needed to unlink next upon deletion  </span>
    <span class="token keyword">boolean</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="hashæ–¹æ³•"><a href="#hashæ–¹æ³•" class="headerlink" title="hashæ–¹æ³•"></a>hashæ–¹æ³•</h3><h3 id="put"><a href="#put" class="headerlink" title="put"></a>put</h3><ol>
<li>åˆ¤æ–­æ•°ç»„,è‹¥å‘ç°æ•°ç»„ä¸ºç©º,åˆ™è¿›è¡Œé¦–æ¬¡æ‰©å®¹ã€‚</li>
<li>åˆ¤æ–­å¤´èŠ‚ç‚¹,è‹¥å‘ç°å¤´èŠ‚ç‚¹ä¸ºç©º,åˆ™æ–°å»ºé“¾è¡¨èŠ‚ç‚¹,å­˜å…¥æ•°ç»„ã€‚</li>
<li>åˆ¤æ–­å¤´èŠ‚ç‚¹,è‹¥å‘ç°å¤´èŠ‚ç‚¹éç©º,åˆ™å°†å…ƒç´ æ’å…¥æ§½å†…ã€‚</li>
<li>è‹¥å…ƒç´ çš„keyä¸å¤´èŠ‚ç‚¹ä¸€è‡´,åˆ™ç›´æ¥è¦†ç›–å¤´èŠ‚ç‚¹ã€‚</li>
<li>è‹¥å…ƒç´ ä¸ºæ ‘å‹èŠ‚ç‚¹,åˆ™å°†å…ƒç´ è¿½åŠ åˆ°æ ‘ä¸­ã€‚</li>
<li>è‹¥å…ƒç´ ä¸ºé“¾è¡¨èŠ‚ç‚¹,åˆ™å°†å…ƒç´ è¿½åŠ åˆ°é“¾è¡¨ä¸­ã€‚ï¼ˆè¿½åŠ å,éœ€è¦åˆ¤æ–­é“¾è¡¨é•¿åº¦ä»¥å†³å®šæ˜¯å¦è½¬ä¸ºçº¢é»‘æ ‘ã€‚è‹¥é“¾è¡¨é•¿åº¦è¾¾åˆ°8ã€æ•°ç»„å®¹é‡æœªè¾¾åˆ°64,åˆ™æ‰©å®¹ã€‚è‹¥é“¾è¡¨é•¿åº¦è¾¾åˆ°8ã€æ•°ç»„å®¹é‡è¾¾åˆ°64,åˆ™è½¬ä¸ºçº¢é»‘æ ‘ã€‚ï¼‰</li>
<li>æ’å…¥å…ƒç´ å,åˆ¤æ–­å…ƒç´ çš„ä¸ªæ•°,è‹¥å‘ç°è¶…è¿‡é˜ˆå€¼åˆ™å†æ¬¡æ‰©å®¹ã€‚<br>putæ–¹æ³•å®é™…å°±æ˜¯è°ƒç”¨putValï¼Œå¹¶ä¸”putValç”¨æˆ·ä¸å¯ç›´æ¥ä½¿ç”¨<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">return</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>

<span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">,</span>
               <span class="token keyword">boolean</span> evict<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> p<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> i<span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœè¡¨ä¸ºç©ºæˆ–é•¿åº¦ä¸º0ï¼Œåˆ™è¿›è¡Œåˆå§‹åŒ–æˆ–æ‰©å®¹</span>
    <span class="token comment">// å°†å±æ€§ä¸­çš„tableèµ‹å€¼ï¼Œå¹¶ä¸”åˆ¤æ–­æ˜¯å¦ä¸ºç©ºæˆ–è€…é•¿åº¦ä¸º0ï¼Œå¦‚æœæ˜¯å°±è¿›è¡Œåˆå§‹åŒ–æˆ–è€…æ‰©å®¹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
	    <span class="token comment">// resize()å‡½æ•°å°±æ˜¯è¿›è¡Œæ‰©å®¹æˆ–è€…åˆå§‹åŒ–</span>
        n <span class="token operator">=</span> <span class="token punctuation">(</span>tab <span class="token operator">=</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token comment">// è®¡ç®—ç´¢å¼•ä½ç½®ï¼Œå¦‚æœå½“å‰ä½ç½®ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ’å…¥æ–°èŠ‚ç‚¹</span>
    <span class="token comment">// (n - 1) &amp; hash ç¡®å®šå…ƒç´ æ”¾åœ¨å“ªä¸ªæ¡¶é‡Œï¼Œæ¡¶ä¸ºç©ºï¼Œæ–°ç”ŸæˆèŠ‚ç‚¹æ”¾å…¥æ•°ç»„ä¸­</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> tab<span class="token punctuation">[</span>i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e<span class="token punctuation">;</span> <span class="token class-name">K</span> k<span class="token punctuation">;</span>
        <span class="token comment">// å¦‚æœå½“å‰ä½ç½®çš„èŠ‚ç‚¹çš„å“ˆå¸Œå€¼å’Œé”®éƒ½ç›¸ç­‰ï¼Œåˆ™ç›´æ¥è¦†ç›–</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> p<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            e <span class="token operator">=</span> p<span class="token punctuation">;</span>
        <span class="token comment">// å¦‚æœæ˜¯æ ‘èŠ‚ç‚¹ï¼Œåˆ™è°ƒç”¨æ ‘èŠ‚ç‚¹çš„æ’å…¥æ–¹æ³•</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>
            e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> tab<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// éå†é“¾è¡¨ï¼ŒæŸ¥æ‰¾æ’å…¥ä½ç½®æˆ–ç›¸åŒé”®çš„èŠ‚ç‚¹</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    p<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// å¦‚æœé“¾è¡¨é•¿åº¦è¾¾åˆ°é˜ˆå€¼ï¼Œåˆ™è½¬æ¢ä¸ºæ ‘ç»“æ„</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">&gt;=</span> <span class="token constant">TREEIFY_THRESHOLD</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// -1 for 1st</span>
                        <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// å¦‚æœæ‰¾åˆ°ç›¸åŒé”®çš„èŠ‚ç‚¹ï¼Œåˆ™è·³å‡ºå¾ªç¯</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                p <span class="token operator">=</span> e<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// å¦‚æœæ‰¾åˆ°ç›¸åŒé”®çš„èŠ‚ç‚¹ï¼Œåˆ™æ›´æ–°å€¼</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// existing mapping for key</span>
            <span class="token class-name">V</span> oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent <span class="token operator">||</span> oldValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
            <span class="token function">afterNodeAccess</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ä¿®æ”¹è®¡æ•°å™¨</span>
    <span class="token operator">++</span>modCount<span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœå¤§å°è¶…è¿‡é˜ˆå€¼ï¼Œåˆ™è¿›è¡Œæ‰©å®¹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>size <span class="token operator">&gt;</span> threshold<span class="token punctuation">)</span>
        <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">afterNodeInsertion</span><span class="token punctuation">(</span>evict<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
åŸºæœ¬é€»è¾‘ï¼š</li>
<li>å¦‚æœå®šä½åˆ°çš„æ•°ç»„ä½ç½®æ²¡æœ‰å…ƒç´ ï¼Œåˆ™ç›´æ¥æ’å…¥</li>
<li>å¦‚æœæœ‰å…ƒç´ ï¼Œå°±è¦ä¸æ’å…¥çš„keyè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒï¼Œå°±è¦†ç›–ã€‚å¦‚æœä¸åŒå°±åˆ¤æ–­pæ˜¯å¦æ˜¯æ ‘èŠ‚ç‚¹ï¼Œå¦‚æœä¸æ˜¯å°±ç›´æ¥éå†é“¾è¡¨æ’å…¥ï¼Œä½¿ç”¨å°¾æ’æ³•ï¼Œå¦åˆ™è°ƒç”¨putTreeValå‡½æ•°</li>
</ol>
<h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>e <span class="token operator">=</span> <span class="token function">getNode</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">getNode</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> first<span class="token punctuation">,</span> e<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> hash<span class="token punctuation">;</span> <span class="token class-name">K</span> k<span class="token punctuation">;</span>
    <span class="token comment">// æ£€æŸ¥è¡¨æ˜¯å¦ä¸ºç©ºä¸”é•¿åº¦å¤§äº0ï¼Œå¹¶è®¡ç®—å“ˆå¸Œå€¼å’Œç´¢å¼•</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
        <span class="token punctuation">(</span>first <span class="token operator">=</span> tab<span class="token punctuation">[</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>hash <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ£€æŸ¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦åŒ¹é…</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>first<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span> <span class="token comment">// å§‹ç»ˆæ£€æŸ¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> first<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> first<span class="token punctuation">;</span>
        <span class="token comment">// éå†é“¾è¡¨æˆ–æ ‘èŠ‚ç‚¹</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> first<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>first <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>first<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTreeNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">do</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ£€æŸ¥é“¾è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹æ˜¯å¦åŒ¹é…</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> e<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œè¿”å›null</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="resize"><a href="#resize" class="headerlink" title="resize"></a>resize</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> oldTab <span class="token operator">=</span> table<span class="token punctuation">;</span> <span class="token comment">// æ—§çš„å“ˆå¸Œè¡¨</span>
    <span class="token keyword">int</span> oldCap <span class="token operator">=</span> <span class="token punctuation">(</span>oldTab <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> oldTab<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// æ—§çš„å®¹é‡</span>
    <span class="token keyword">int</span> oldThr <span class="token operator">=</span> threshold<span class="token punctuation">;</span> <span class="token comment">// æ—§çš„é˜ˆå€¼</span>
    <span class="token keyword">int</span> newCap<span class="token punctuation">,</span> newThr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// æ–°çš„å®¹é‡å’Œé˜ˆå€¼</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ—§çš„å®¹é‡å¤§äº0</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">&gt;=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ—§çš„å®¹é‡å·²ç»è¾¾åˆ°æœ€å¤§å®¹é‡</span>
            threshold <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span> <span class="token comment">// å°†é˜ˆå€¼è®¾ä¸ºæœ€å¤§æ•´æ•°å€¼</span>
            <span class="token keyword">return</span> oldTab<span class="token punctuation">;</span> <span class="token comment">// è¿”å›æ—§çš„å“ˆå¸Œè¡¨</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>newCap <span class="token operator">=</span> oldCap <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">&amp;&amp;</span> oldCap <span class="token operator">&gt;=</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">)</span>
            newThr <span class="token operator">=</span> oldThr <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// å°†å®¹é‡å’Œé˜ˆå€¼éƒ½ç¿»å€</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldThr <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// å¦‚æœæ—§çš„é˜ˆå€¼å¤§äº0</span>
        newCap <span class="token operator">=</span> oldThr<span class="token punctuation">;</span> <span class="token comment">// å°†æ–°çš„å®¹é‡è®¾ä¸ºæ—§çš„é˜ˆå€¼</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ—§çš„é˜ˆå€¼ä¸º0ï¼Œä½¿ç”¨é»˜è®¤å€¼</span>
        newCap <span class="token operator">=</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">;</span> <span class="token comment">// é»˜è®¤åˆå§‹å®¹é‡</span>
        newThr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_LOAD_FACTOR</span> <span class="token operator">*</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é»˜è®¤é˜ˆå€¼</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newThr <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ–°çš„é˜ˆå€¼ä¸º0</span>
        <span class="token keyword">float</span> ft <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>newCap <span class="token operator">*</span> loadFactor<span class="token punctuation">;</span> <span class="token comment">// è®¡ç®—æ–°çš„é˜ˆå€¼</span>
        newThr <span class="token operator">=</span> <span class="token punctuation">(</span>newCap <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">&amp;&amp;</span> ft <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ft <span class="token operator">:</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    threshold <span class="token operator">=</span> newThr<span class="token punctuation">;</span> <span class="token comment">// æ›´æ–°é˜ˆå€¼</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"rawtypes"</span><span class="token punctuation">,</span><span class="token string">"unchecked"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">[</span>newCap<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºæ–°çš„å“ˆå¸Œè¡¨</span>
    table <span class="token operator">=</span> newTab<span class="token punctuation">;</span> <span class="token comment">// æ›´æ–°å“ˆå¸Œè¡¨å¼•ç”¨</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldTab <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ—§çš„å“ˆå¸Œè¡¨ä¸ä¸ºç©º</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> oldCap<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// éå†æ—§çš„å“ˆå¸Œè¡¨</span>
            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ—§è¡¨ä¸­çš„æ¡¶ä¸ä¸ºç©º</span>
                oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// æ¸…ç©ºæ—§è¡¨ä¸­çš„æ¡¶</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>next <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// å¦‚æœæ¡¶ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹</span>
                    newTab<span class="token punctuation">[</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> <span class="token punctuation">(</span>newCap <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span> <span class="token comment">// ç›´æ¥æ”¾å…¥æ–°è¡¨</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span> <span class="token comment">// å¦‚æœæ¡¶ä¸­æ˜¯æ ‘èŠ‚ç‚¹</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> newTab<span class="token punctuation">,</span> j<span class="token punctuation">,</span> oldCap<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‹†åˆ†æ ‘èŠ‚ç‚¹</span>
                <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ¡¶ä¸­æ˜¯é“¾è¡¨èŠ‚ç‚¹</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> loHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> loTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// ä½ä½é“¾è¡¨çš„å¤´å’Œå°¾</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> hiHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> hiTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// é«˜ä½é“¾è¡¨çš„å¤´å’Œå°¾</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> next<span class="token punctuation">;</span>
                    <span class="token keyword">do</span> <span class="token punctuation">{</span>
                        next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> oldCap<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ä½ä½é“¾è¡¨</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                                loHead <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            <span class="token keyword">else</span>
                                loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            loTail <span class="token operator">=</span> e<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// é«˜ä½é“¾è¡¨</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                                hiHead <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            <span class="token keyword">else</span>
                                hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            hiTail <span class="token operator">=</span> e<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        newTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> loHead<span class="token punctuation">;</span> <span class="token comment">// æ”¾å…¥ä½ä½é“¾è¡¨</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        newTab<span class="token punctuation">[</span>j <span class="token operator">+</span> oldCap<span class="token punctuation">]</span> <span class="token operator">=</span> hiHead<span class="token punctuation">;</span> <span class="token comment">// æ”¾å…¥é«˜ä½é“¾è¡¨</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> newTab<span class="token punctuation">;</span> <span class="token comment">// è¿”å›æ–°çš„å“ˆå¸Œè¡¨</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h2><h2 id="JDK1-7"><a href="#JDK1-7" class="headerlink" title="JDK1.7"></a>JDK1.7</h2><p>JDK1.7ä¸­ï¼ŒConcurrentHashMapæ˜¯ç”±å¤šä¸ªSegmentç»„åˆï¼Œè€Œæ¯ä¸€ä¸ªSegmentéƒ½æ˜¯ä¸€ä¸ªç±»ä¼¼äºHashMapçš„ç»“æ„ï¼Œå¯ä»¥å†…éƒ¨è¿›è¡Œæ‰©å®¹ï¼Œä½†æ˜¯Segmentçš„ä¸ªæ•°ä¸€æ—¦åˆå§‹åŒ–å°±ä¸èƒ½æ”¹å˜äº†ã€‚é»˜è®¤æ”¯æŒ16ä¸ªï¼Œä¹Ÿå°±æ˜¯é»˜è®¤æ”¯æŒ16ä¸ªçº¿ç¨‹å¹¶å‘<img src="/2024/09/28/24/jdk1.7concurrent.png">Segment é€šè¿‡ç»§æ‰¿ ReentrantLock æ¥è¿›è¡ŒåŠ é”</p>
<h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>æ— å‚æ„é€ ä¸­è°ƒç”¨äº†æœ‰å‚æ„é€ ï¼Œä¼ å…¥ä¸‰ä¸ªé»˜è®¤å€¼</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * é»˜è®¤åˆå§‹åŒ–å®¹é‡
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span> <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * é»˜è®¤è´Ÿè½½å› å­
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span> <span class="token operator">=</span> <span class="token number">0.75f</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * é»˜è®¤å¹¶å‘çº§åˆ«
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_CONCURRENCY_LEVEL</span> <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åˆå§‹åŒ–é€»è¾‘</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ConcurrentHashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span><span class="token keyword">float</span> loadFactor<span class="token punctuation">,</span> <span class="token keyword">int</span> concurrencyLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å‚æ•°æ ¡éªŒ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>loadFactor <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> initialCapacity <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> concurrencyLevel <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ ¡éªŒå¹¶å‘çº§åˆ«å¤§å°ï¼Œå¤§äº 1&lt;&lt;16ï¼Œé‡ç½®ä¸º 65536</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>concurrencyLevel <span class="token operator">&gt;</span> <span class="token constant">MAX_SEGMENTS</span><span class="token punctuation">)</span>
        concurrencyLevel <span class="token operator">=</span> <span class="token constant">MAX_SEGMENTS</span><span class="token punctuation">;</span>
    <span class="token comment">// Find power-of-two sizes best matching arguments</span>
    <span class="token comment">// 2çš„å¤šå°‘æ¬¡æ–¹</span>
    <span class="token keyword">int</span> sshift <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> ssize <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">// è¿™ä¸ªå¾ªç¯å¯ä»¥æ‰¾åˆ° concurrencyLevel ä¹‹ä¸Šæœ€è¿‘çš„ 2çš„æ¬¡æ–¹å€¼</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>ssize <span class="token operator">&lt;</span> concurrencyLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">++</span>sshift<span class="token punctuation">;</span>
        ssize <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è®°å½•æ®µåç§»é‡</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>segmentShift <span class="token operator">=</span> <span class="token number">32</span> <span class="token operator">-</span> sshift<span class="token punctuation">;</span>
    <span class="token comment">// è®°å½•æ®µæ©ç </span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>segmentMask <span class="token operator">=</span> ssize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">// è®¾ç½®å®¹é‡</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">&gt;</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span>
        initialCapacity <span class="token operator">=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">;</span>
    <span class="token comment">// c = å®¹é‡ / ssize ï¼Œé»˜è®¤ 16 / 16 = 1ï¼Œè¿™é‡Œæ˜¯è®¡ç®—æ¯ä¸ª Segment ä¸­çš„ç±»ä¼¼äº HashMap çš„å®¹é‡</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> initialCapacity <span class="token operator">/</span> ssize<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">*</span> ssize <span class="token operator">&lt;</span> initialCapacity<span class="token punctuation">)</span>
        <span class="token operator">++</span>c<span class="token punctuation">;</span>
    <span class="token keyword">int</span> cap <span class="token operator">=</span> <span class="token constant">MIN_SEGMENT_TABLE_CAPACITY</span><span class="token punctuation">;</span>
    <span class="token comment">//Segment ä¸­çš„ç±»ä¼¼äº HashMap çš„å®¹é‡è‡³å°‘æ˜¯2æˆ–è€…2çš„å€æ•°</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>cap <span class="token operator">&lt;</span> c<span class="token punctuation">)</span>
        cap <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">// create segments and segments[0]</span>
    <span class="token comment">// åˆ›å»º Segment æ•°ç»„ï¼Œè®¾ç½® segments[0]</span>
    <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> s0 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>loadFactor<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>cap <span class="token operator">*</span> loadFactor<span class="token punctuation">)</span><span class="token punctuation">,</span>
                         <span class="token punctuation">(</span><span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">HashEntry</span><span class="token punctuation">[</span>cap<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> ss <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Segment</span><span class="token punctuation">[</span>ssize<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">putOrderedObject</span><span class="token punctuation">(</span>ss<span class="token punctuation">,</span> <span class="token constant">SBASE</span><span class="token punctuation">,</span> s0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ordered write of segments[0]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>segments <span class="token operator">=</span> ss<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>æ ¡éªŒå¹¶å‘ç­‰çº§å¤§å°ï¼Œå¦‚æœå¤§äºæœ€å¤§å€¼ï¼Œå°±é‡ç½®ä¸ºæœ€å¤§å€¼</li>
<li>åˆå§‹åŒ–å®¹é‡ä¸ºå¤§äºå¹¶å‘ç­‰çº§æœ€è¿‘çš„2çš„å¹‚æ¬¡æ–¹ï¼Œé»˜è®¤16</li>
<li>è®°å½•segmentShiftåç§»é‡ï¼Œ2^n ä¸­çš„nï¼Œé»˜è®¤ä¸º32 - sshift = 28  </li>
<li>è®°å½•segmentMaskï¼Œé»˜è®¤æ˜¯ssize - 1 = 16 - 1 = 15</li>
<li>åˆå§‹åŒ–<code>segment[0]</code>ï¼Œé»˜è®¤å¤§å°ä¸º2ï¼Œæ‰©å®¹é˜ˆå€¼ä¸º 2 * 0.75 = 1.5ã€‚æ’å…¥ç¬¬äºŒä¸ªå€¼æ—¶æ‰ä¼šè¿›è¡Œæ‰©å®¹</li>
</ol>
<h3 id="put-1"><a href="#put-1" class="headerlink" title="put"></a>put</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Maps the specified key to the specified value in this table.
 * Neither the key nor the value can be null.
 *
 * &lt;p&gt; The value can be retrieved by calling the &lt;tt&gt;get&lt;/tt&gt; method
 * with a key that is equal to the original key.
 *
 * @param key key with which the specified value is to be associated
 * @param value value to be associated with the specified key
 * @return the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or
 *         &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;
 * @throws NullPointerException if the specified key or value is null
 */</span>
<span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> s<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// hash å€¼æ— ç¬¦å·å³ç§» 28ä½ï¼ˆåˆå§‹åŒ–æ—¶è·å¾—ï¼‰ï¼Œç„¶åä¸ segmentMask=15 åšä¸è¿ç®—</span>
    <span class="token comment">// å…¶å®ä¹Ÿå°±æ˜¯æŠŠé«˜4ä½ä¸segmentMaskï¼ˆ1111ï¼‰åšä¸è¿ç®—</span>
    <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token punctuation">(</span>hash <span class="token operator">&gt;&gt;&gt;</span> segmentShift<span class="token punctuation">)</span> <span class="token operator">&amp;</span> segmentMask<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token constant">UNSAFE</span><span class="token punctuation">.</span>getObject          <span class="token comment">// nonvolatile; recheck</span>
         <span class="token punctuation">(</span>segments<span class="token punctuation">,</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;&lt;</span> <span class="token constant">SSHIFT</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">SBASE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">//  in ensureSegment</span>
        <span class="token comment">// å¦‚æœæŸ¥æ‰¾åˆ°çš„ Segment ä¸ºç©ºï¼Œåˆå§‹åŒ–</span>
        s <span class="token operator">=</span> <span class="token function">ensureSegment</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Returns the segment for the given index, creating it and
 * recording in segment table (via CAS) if not already present.
 *
 * @param k the index
 * @return the segment
 */</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">ensureSegment</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> ss <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>segments<span class="token punctuation">;</span>
    <span class="token keyword">long</span> u <span class="token operator">=</span> <span class="token punctuation">(</span>k <span class="token operator">&lt;&lt;</span> <span class="token constant">SSHIFT</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">SBASE</span><span class="token punctuation">;</span> <span class="token comment">// raw offset</span>
    <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> seg<span class="token punctuation">;</span>
    <span class="token comment">// åˆ¤æ–­ u ä½ç½®çš„ Segment æ˜¯å¦ä¸ºnull</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>seg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">getObjectVolatile</span><span class="token punctuation">(</span>ss<span class="token punctuation">,</span> u<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> proto <span class="token operator">=</span> ss<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// use segment 0 as prototype</span>
        <span class="token comment">// è·å–0å· segment é‡Œçš„ HashEntry&lt;K,V&gt; åˆå§‹åŒ–é•¿åº¦</span>
        <span class="token keyword">int</span> cap <span class="token operator">=</span> proto<span class="token punctuation">.</span>table<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token comment">// è·å–0å· segment é‡Œçš„ hash è¡¨é‡Œçš„æ‰©å®¹è´Ÿè½½å› å­ï¼Œæ‰€æœ‰çš„ segment çš„ loadFactor æ˜¯ç›¸åŒçš„</span>
        <span class="token keyword">float</span> lf <span class="token operator">=</span> proto<span class="token punctuation">.</span>loadFactor<span class="token punctuation">;</span>
        <span class="token comment">// è®¡ç®—æ‰©å®¹é˜€å€¼</span>
        <span class="token keyword">int</span> threshold <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>cap <span class="token operator">*</span> lf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºä¸€ä¸ª cap å®¹é‡çš„ HashEntry æ•°ç»„</span>
        <span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">HashEntry</span><span class="token punctuation">[</span>cap<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>seg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">getObjectVolatile</span><span class="token punctuation">(</span>ss<span class="token punctuation">,</span> u<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// recheck</span>
            <span class="token comment">// å†æ¬¡æ£€æŸ¥ u ä½ç½®çš„ Segment æ˜¯å¦ä¸ºnullï¼Œå› ä¸ºè¿™æ—¶å¯èƒ½æœ‰å…¶ä»–çº¿ç¨‹è¿›è¡Œäº†æ“ä½œ</span>
            <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>lf<span class="token punctuation">,</span> threshold<span class="token punctuation">,</span> tab<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è‡ªæ—‹æ£€æŸ¥ u ä½ç½®çš„ Segment æ˜¯å¦ä¸ºnull</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>seg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">getObjectVolatile</span><span class="token punctuation">(</span>ss<span class="token punctuation">,</span> u<span class="token punctuation">)</span><span class="token punctuation">)</span>
                   <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// ä½¿ç”¨CAS èµ‹å€¼ï¼Œåªä¼šæˆåŠŸä¸€æ¬¡</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">compareAndSwapObject</span><span class="token punctuation">(</span>ss<span class="token punctuation">,</span> u<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> seg <span class="token operator">=</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> seg<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>è®¡ç®—keyçš„ä½ç½®ï¼Œè·å–æŒ‡å®šä½ç½®çš„Segment</li>
<li>å¦‚æœæŒ‡å®šä½ç½®çš„Segmentä¸ºç©ºï¼Œåˆ™åˆå§‹åŒ–è¿™ä¸ªSegment<ul>
<li>å¦‚æœä¸ºnullï¼Œä½¿ç”¨<code>Segment[0]</code>çš„å®¹é‡å’Œè´Ÿè½½å› å­åˆ›å»ºä¸€ä¸ªHashEntryæ•°ç»„</li>
<li>å†æ¬¡æ£€æŸ¥æ˜¯å¦ä¸ºnull</li>
<li>ä½¿ç”¨HashEntryåˆå§‹åŒ–è¿™ä¸ªSegment</li>
<li>è‡ªæ—‹è®¡ç®—å¾—åˆ°çš„æŒ‡å®šä½ç½®æ˜¯å¦ä¸ºnullï¼Œä½¿ç”¨CASåœ¨è¿™ä¸ªä½ç½®èµ‹å€¼Segment</li>
</ul>
</li>
<li>Segment.putæ’å…¥keyï¼Œvalue<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·å– ReentrantLock ç‹¬å é”ï¼Œè·å–ä¸åˆ°ï¼ŒscanAndLockForPut è·å–ã€‚</span>
    <span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> node <span class="token operator">=</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> <span class="token function">scanAndLockForPut</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">V</span> oldValue<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab <span class="token operator">=</span> table<span class="token punctuation">;</span>
        <span class="token comment">// è®¡ç®—è¦putçš„æ•°æ®ä½ç½®</span>
        <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token punctuation">(</span>tab<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">;</span>
        <span class="token comment">// CAS è·å– index åæ ‡çš„å€¼</span>
        <span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> first <span class="token operator">=</span> <span class="token function">entryAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e <span class="token operator">=</span> first<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ£€æŸ¥æ˜¯å¦ key å·²ç»å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™éå†é“¾è¡¨å¯»æ‰¾ä½ç½®ï¼Œæ‰¾åˆ°åæ›¿æ¢ value</span>
                <span class="token class-name">K</span> k<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span>
                    <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
                        <span class="token operator">++</span>modCount<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// first æœ‰å€¼æ²¡è¯´æ˜ index ä½ç½®å·²ç»æœ‰å€¼äº†ï¼Œæœ‰å†²çªï¼Œé“¾è¡¨å¤´æ’æ³•ã€‚</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    node<span class="token punctuation">.</span><span class="token function">setNext</span><span class="token punctuation">(</span>first<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span>
                    node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> first<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> c <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token comment">// å®¹é‡å¤§äºæ‰©å®¹é˜€å€¼ï¼Œå°äºæœ€å¤§å®¹é‡ï¼Œè¿›è¡Œæ‰©å®¹</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">&gt;</span> threshold <span class="token operator">&amp;&amp;</span> tab<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span>
                    <span class="token function">rehash</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span>
                    <span class="token comment">// index ä½ç½®èµ‹å€¼ nodeï¼Œnode å¯èƒ½æ˜¯ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªé“¾è¡¨çš„è¡¨å¤´</span>
                    <span class="token function">setEntryAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> index<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token operator">++</span>modCount<span class="token punctuation">;</span>
                count <span class="token operator">=</span> c<span class="token punctuation">;</span>
                oldValue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<ul>
<li><p><code>tryLock()</code> è·å–é”ï¼Œè·å–ä¸åˆ°ä½¿ç”¨ <strong><code>scanAndLockForPut</code></strong> æ–¹æ³•ç»§ç»­è·å–ã€‚</p>
</li>
<li><p>è®¡ç®— put çš„æ•°æ®è¦æ”¾å…¥çš„ index ä½ç½®ï¼Œç„¶åè·å–è¿™ä¸ªä½ç½®ä¸Šçš„ <code>HashEntry</code> ã€‚</p>
</li>
<li><p>éå† put æ–°å…ƒç´ ï¼Œä¸ºä»€ä¹ˆè¦éå†ï¼Ÿå› ä¸ºè¿™é‡Œè·å–çš„ <code>HashEntry</code> å¯èƒ½æ˜¯ä¸€ä¸ªç©ºå…ƒç´ ï¼Œä¹Ÿå¯èƒ½æ˜¯é“¾è¡¨å·²å­˜åœ¨ï¼Œæ‰€ä»¥è¦åŒºåˆ«å¯¹å¾…ã€‚</p>
<p>  å¦‚æœè¿™ä¸ªä½ç½®ä¸Šçš„ <strong><code>HashEntry</code> ä¸å­˜åœ¨</strong>ï¼š</p>
<ol>
<li>å¦‚æœå½“å‰å®¹é‡å¤§äºæ‰©å®¹é˜€å€¼ï¼Œå°äºæœ€å¤§å®¹é‡ï¼Œ<strong>è¿›è¡Œæ‰©å®¹</strong>ã€‚</li>
<li>ç›´æ¥å¤´æ’æ³•æ’å…¥ã€‚</li>
</ol>
<p>  å¦‚æœè¿™ä¸ªä½ç½®ä¸Šçš„ <strong><code>HashEntry</code> å­˜åœ¨</strong>ï¼š</p>
<ol>
<li>åˆ¤æ–­é“¾è¡¨å½“å‰å…ƒç´  key å’Œ hash å€¼æ˜¯å¦å’Œè¦ put çš„ key å’Œ hash å€¼ä¸€è‡´ã€‚ä¸€è‡´åˆ™æ›¿æ¢å€¼</li>
<li>ä¸ä¸€è‡´ï¼Œè·å–é“¾è¡¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›´åˆ°å‘ç°ç›¸åŒè¿›è¡Œå€¼æ›¿æ¢ï¼Œæˆ–è€…é“¾è¡¨è¡¨é‡Œå®Œæ¯•æ²¡æœ‰ç›¸åŒçš„ã€‚<ol>
<li>å¦‚æœå½“å‰å®¹é‡å¤§äºæ‰©å®¹é˜€å€¼ï¼Œå°äºæœ€å¤§å®¹é‡ï¼Œ<strong>è¿›è¡Œæ‰©å®¹</strong>ã€‚</li>
<li>ç›´æ¥é“¾è¡¨å¤´æ’æ³•æ’å…¥ã€‚</li>
</ol>
</li>
</ol>
</li>
<li><p>å¦‚æœè¦æ’å…¥çš„ä½ç½®ä¹‹å‰å·²ç»å­˜åœ¨ï¼Œæ›¿æ¢åè¿”å›æ—§å€¼ï¼Œå¦åˆ™è¿”å› null.</p>
</li>
</ul>
<h3 id="resize-1"><a href="#resize-1" class="headerlink" title="resize"></a>resize</h3><p>æ‰©å®¹ä½¿ç”¨çš„æ˜¯å¤´æ’æ³•</p>
<h2 id="JDK1-8"><a href="#JDK1-8" class="headerlink" title="JDK1.8"></a>JDK1.8</h2><p><img src="/2024/09/28/24/jdk1.8concurrent.png"><br>ç”±åŸå…ˆçš„Segmentæ•°ç»„ + HashEntryè½¬åŒ–ä¸ºNodeæ•°ç»„ + é“¾è¡¨/çº¢é»‘æ ‘</p>
<h3 id="é‡è¦å±æ€§"><a href="#é‡è¦å±æ€§" class="headerlink" title="é‡è¦å±æ€§"></a>é‡è¦å±æ€§</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>  
    <span class="token keyword">implements</span> <span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> table<span class="token punctuation">;</span> <span class="token comment">// å“ˆå¸Œè¡¨æ•°ç»„ï¼Œå­˜å‚¨é”®å€¼å¯¹</span>

<span class="token comment">/**
 * ä¸‹ä¸€ä¸ªå“ˆå¸Œè¡¨æ•°ç»„ï¼Œä»…åœ¨æ‰©å®¹æ—¶ä½¿ç”¨ï¼Œä¸ä¸ºç©º
 */</span>
<span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> nextTable<span class="token punctuation">;</span>

<span class="token comment">/**
 * åŸºç¡€è®¡æ•°å™¨å€¼ï¼Œä¸»è¦åœ¨æ²¡æœ‰ç«äº‰æ—¶ä½¿ç”¨ï¼Œä¹Ÿä½œä¸ºè¡¨åˆå§‹åŒ–ç«äº‰æœŸé—´çš„å›é€€ã€‚é€šè¿‡CASæ›´æ–°
 */</span>
<span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token keyword">long</span> baseCount<span class="token punctuation">;</span>

<span class="token comment">/**
 * è¡¨åˆå§‹åŒ–å’Œæ‰©å®¹æ§åˆ¶ã€‚å½“ä¸ºè´Ÿæ•°æ—¶ï¼Œè¡¨ç¤ºè¡¨æ­£åœ¨åˆå§‹åŒ–æˆ–æ‰©å®¹ï¼š-1è¡¨ç¤ºåˆå§‹åŒ–ï¼Œå¦åˆ™ä¸º-(1 + æ´»åŠ¨æ‰©å®¹çº¿ç¨‹æ•°)ã€‚
 * å¦åˆ™ï¼Œå½“è¡¨ä¸ºç©ºæ—¶ï¼Œä¿å­˜åˆ›å»ºæ—¶ä½¿ç”¨çš„åˆå§‹è¡¨å¤§å°ï¼Œé»˜è®¤ä¸º0ã€‚åˆå§‹åŒ–åï¼Œä¿å­˜ä¸‹ä¸€ä¸ªç”¨äºæ‰©å®¹çš„å…ƒç´ è®¡æ•°å€¼
 */</span>
<span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> sizeCtl<span class="token punctuation">;</span>

<span class="token comment">/**
 * æ‰©å®¹æ—¶è¦æ‹†åˆ†çš„ä¸‹ä¸€ä¸ªè¡¨ç´¢å¼•ï¼ˆåŠ ä¸€ï¼‰
 */</span>
<span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> transferIndex<span class="token punctuation">;</span>

<span class="token comment">/**
 * æ‰©å®¹å’Œ/æˆ–åˆ›å»ºCounterCellsæ—¶ä½¿ç”¨çš„è‡ªæ—‹é”ï¼ˆé€šè¿‡CASé”å®šï¼‰
 */</span>
<span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> cellsBusy<span class="token punctuation">;</span>

<span class="token comment">/**
 * è®¡æ•°å•å…ƒè¡¨ã€‚å½“ä¸ä¸ºç©ºæ—¶ï¼Œå¤§å°ä¸º2çš„å¹‚
 */</span>
<span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">CounterCell</span><span class="token punctuation">[</span><span class="token punctuation">]</span> counterCells<span class="token punctuation">;</span>

<span class="token comment">// views</span>
<span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">KeySetView</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> keySet<span class="token punctuation">;</span> <span class="token comment">// é”®é›†åˆè§†å›¾</span>
<span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">ValuesView</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">;</span> <span class="token comment">// å€¼é›†åˆè§†å›¾</span>
<span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">EntrySetView</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> entrySet<span class="token punctuation">;</span> <span class="token comment">// é”®å€¼å¯¹é›†åˆè§†å›¾</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h3><p>åŸºæœ¬ä¸HashMapä¸­çš„ç›¸åŒï¼Œæ‰€ä»¥ç•¥è¿‡</p>
<h3 id="initTable"><a href="#initTable" class="headerlink" title="initTable"></a>initTable</h3><p>åˆå§‹åŒ–</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">initTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> <span class="token keyword">int</span> sc<span class="token punctuation">;</span>
       <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> tab<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// sizeCtl &lt; 0 è¯´æ˜å…¶ä»–çº¿ç¨‹CASæˆåŠŸï¼Œæ­£åœ¨åˆå§‹åŒ–æˆ–</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sc <span class="token operator">=</span> sizeCtl<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token comment">// è®©å‡ºcpu</span>
               <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
           <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">SIZECTL</span><span class="token punctuation">,</span> sc<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">try</span> <span class="token punctuation">{</span>
                   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> tab<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                       <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token punctuation">(</span>sc <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> sc <span class="token operator">:</span> <span class="token constant">DEFAULT_CAPACITY</span><span class="token punctuation">;</span>
                       <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
                       <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> nt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
                       table <span class="token operator">=</span> tab <span class="token operator">=</span> nt<span class="token punctuation">;</span>
                       sc <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token punctuation">(</span>n <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token punctuation">}</span>
               <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                   sizeCtl <span class="token operator">=</span> sc<span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">return</span> tab<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>é€šè¿‡è‡ªæ—‹ + CASæ“ä½œæ¥å®Œæˆåˆå§‹åŒ–</li>
<li>sizeCtl çš„å€¼<ul>
<li>-1 ï¼š æ­£åœ¨åˆå§‹åŒ–</li>
<li><ul>
<li>Nï¼šæ­£åœ¨æ‰©å®¹é«˜16ä½ä½æ‰©å®¹çš„æ ‡è¯†æˆ³ï¼Œä½16ä½-1ä½æ­£åœ¨æ‰©å®¹çš„çº¿ç¨‹æ•°</li>
</ul>
</li>
<li>0 ï¼štableåˆå§‹åŒ–å¤§å°ï¼Œå¦‚æœtableæ²¡æœ‰åˆå§‹åŒ–</li>
<li><blockquote>
<p>0 ï¼š æ‰©å®¹é˜ˆå€¼</p>
</blockquote>
</li>
</ul>
</li>
</ol>
<h3 id="put-2"><a href="#put-2" class="headerlink" title="put"></a>put</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">return</span> <span class="token function">putVal</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
<span class="token comment">/** Implementation for put and putIfAbsent */</span>  
<span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token comment">// è®¡ç®—hash</span>
    <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">spread</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token comment">// è®¡æ•°å™¨ï¼Œæ£€æµ‹é“¾è¡¨é•¿åº¦ï¼Œç»Ÿè®¡èŠ‚ç‚¹ä¸ªæ•°ï¼Œæ§åˆ¶å¾ªç¯</span>
    <span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab <span class="token operator">=</span> table<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
	    <span class="token comment">// fæ˜¯ç›®æ ‡å…ƒç´ çš„ä½ç½®, fhæ˜¯åé¢å­˜æ”¾ç›®æ ‡ä½ç½®å…ƒç´ çš„hashå€¼</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> f<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> i<span class="token punctuation">,</span> fh<span class="token punctuation">;</span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tab <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>  
		    <span class="token comment">// æ•°æ®æ¡¶ä¸ºç©ºï¼Œå°±å…ˆåˆå§‹åŒ–</span>
            tab <span class="token operator">=</span> <span class="token function">initTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token comment">// å®šä½åˆ°è¿™ä¸ªä½ç½®ä¹‹åå‘ç°æ¡¶ä¸­æ²¡æœ‰æ•°æ®ï¼Œå°±ç›´æ¥æ”¾å…¥ï¼Œä¸åŠ é”ï¼Œç„¶åè·³å‡ºå³å¯</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>f <span class="token operator">=</span> <span class="token function">tabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">casTabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>  
                         <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
                <span class="token keyword">break</span><span class="token punctuation">;</span>                   <span class="token comment">// no lock when adding to empty bin  </span>
        <span class="token punctuation">}</span>  
        <span class="token comment">// æ£€æŸ¥å½“å‰æ¡¶ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯ä¸€ä¸ª ForwardingNodeã€‚ForwardingNode æ˜¯åœ¨å“ˆå¸Œè¡¨æ‰©å®¹æ—¶ä½¿ç”¨çš„ä¸€ç§ç‰¹æ®ŠèŠ‚ç‚¹ç±»å‹ï¼Œç”¨äºæŒ‡ç¤ºè¯¥æ¡¶çš„å†…å®¹å·²ç»è¢«ç§»åŠ¨åˆ°æ–°çš„å“ˆå¸Œè¡¨ä¸­ã€‚ </span>
        <span class="token comment">// å¦‚æœæ˜¯å°±éœ€è¦helpTranfer</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fh <span class="token operator">=</span> f<span class="token punctuation">.</span>hash<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">MOVED</span><span class="token punctuation">)</span>  
            tab <span class="token operator">=</span> <span class="token function">helpTransfer</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">else</span> <span class="token punctuation">{</span>  
            <span class="token class-name">V</span> oldVal <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  
            <span class="token comment">// å¯¹èŠ‚ç‚¹fåŠ é”</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">tabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">==</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
	                <span class="token comment">// å‘ç°æ˜¯é“¾è¡¨</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>fh <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                        binCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  
                        <span class="token comment">// å¾ªç¯åŠ å…¥æ–°çš„èŠ‚ç‚¹ï¼Œæˆ–è€…è¦†ç›–</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e <span class="token operator">=</span> f<span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                            <span class="token class-name">K</span> ek<span class="token punctuation">;</span>  
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>  
                                <span class="token punctuation">(</span><span class="token punctuation">(</span>ek <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span>  
                                 <span class="token punctuation">(</span>ek <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>ek<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                                oldVal <span class="token operator">=</span> e<span class="token punctuation">.</span>val<span class="token punctuation">;</span>  
                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent<span class="token punctuation">)</span>  
                                    e<span class="token punctuation">.</span>val <span class="token operator">=</span> value<span class="token punctuation">;</span>  
                                <span class="token keyword">break</span><span class="token punctuation">;</span>  
                            <span class="token punctuation">}</span>                            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> pred <span class="token operator">=</span> e<span class="token punctuation">;</span>  
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                                pred<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span>  
                                                          value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                                <span class="token keyword">break</span><span class="token punctuation">;</span>  
                            <span class="token punctuation">}</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token keyword">instanceof</span> <span class="token class-name">TreeBin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                            <span class="token comment">//å‘ç°æ˜¯çº¢é»‘æ ‘</span>
                        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> p<span class="token punctuation">;</span>  
                        binCount <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeBin</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span>  
                                                       value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                            oldVal <span class="token operator">=</span> p<span class="token punctuation">.</span>val<span class="token punctuation">;</span>  
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent<span class="token punctuation">)</span>  
                                p<span class="token punctuation">.</span>val <span class="token operator">=</span> value<span class="token punctuation">;</span>  
                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">&gt;=</span> <span class="token constant">TREEIFY_THRESHOLD</span><span class="token punctuation">)</span>  
                    <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>  
                <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVal <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>  
                    <span class="token keyword">return</span> oldVal<span class="token punctuation">;</span>  
                <span class="token keyword">break</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token function">addCount</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> binCount<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>é€šè¿‡keyè®¡ç®—hashcode</li>
<li>åˆ¤æ–­æ˜¯å¦éœ€è¦åˆå§‹åŒ–</li>
<li>å®šä½åˆ°Nodeï¼Œå¦‚æœä¸ºç©ºç›´æ¥ç”¨CASå†™å…¥ï¼Œå¤±è´¥å°±è‡ªæ—‹ä¿è¯æˆåŠŸ</li>
<li>å¦‚æœhashcode == MOVED == - 1éœ€è¦è¿›è¡Œæ‰©å®¹</li>
<li>å¦‚æœéƒ½ä¸æ»¡è¶³å°±ä½¿ç”¨synchronizedé”å†™å…¥æ•°æ®</li>
<li>å¦‚æœæ•°é‡å¤§äºTREEIFY_THRESHOLDè°ƒç”¨treeifyBinè¿›è¡Œè½¬åŒ–<br><strong>å€¼å¾—ä¸€æçš„æ˜¯synchronizedåœ¨è¿™é‡Œæ˜¯é”ä½äº†è¿™ä¸ªä¸€ä¸ªæ¡¶ï¼Œä¹Ÿæ˜¯è¿™ä¸€ä¸ªNodeï¼Œè€Œä¸æ˜¯ä¸€æ•´ä¸ªè¡¨</strong></li>
</ol>
<h3 id="get-1"><a href="#get-1" class="headerlink" title="get"></a>get</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e<span class="token punctuation">,</span> p<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> eh<span class="token punctuation">;</span> <span class="token class-name">K</span> ek<span class="token punctuation">;</span>
    <span class="token comment">// key æ‰€åœ¨çš„ hash ä½ç½®</span>
    <span class="token keyword">int</span> h <span class="token operator">=</span> <span class="token function">spread</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
        <span class="token punctuation">(</span>e <span class="token operator">=</span> <span class="token function">tabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœæŒ‡å®šä½ç½®å…ƒç´ å­˜åœ¨ï¼Œå¤´ç»“ç‚¹hashå€¼ç›¸åŒ</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>eh <span class="token operator">=</span> e<span class="token punctuation">.</span>hash<span class="token punctuation">)</span> <span class="token operator">==</span> h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ek <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>ek <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>ek<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// key hash å€¼ç›¸ç­‰ï¼Œkeyå€¼ç›¸åŒï¼Œç›´æ¥è¿”å›å…ƒç´  value</span>
                <span class="token keyword">return</span> e<span class="token punctuation">.</span>val<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>eh <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token comment">// å¤´ç»“ç‚¹hashå€¼å°äº0ï¼Œè¯´æ˜æ­£åœ¨æ‰©å®¹æˆ–è€…æ˜¯çº¢é»‘æ ‘ï¼ŒfindæŸ¥æ‰¾</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> p<span class="token punctuation">.</span>val <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ˜¯é“¾è¡¨ï¼Œéå†æŸ¥æ‰¾</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> h <span class="token operator">&amp;&amp;</span>
                <span class="token punctuation">(</span><span class="token punctuation">(</span>ek <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>ek <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>ek<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> e<span class="token punctuation">.</span>val<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="å¸¸è§å…«è‚¡"><a href="#å¸¸è§å…«è‚¡" class="headerlink" title="å¸¸è§å…«è‚¡"></a>å¸¸è§å…«è‚¡</h1><h2 id="HashMapçš„åº•å±‚å®ç°æ˜¯ä»€ä¹ˆ"><a href="#HashMapçš„åº•å±‚å®ç°æ˜¯ä»€ä¹ˆ" class="headerlink" title="HashMapçš„åº•å±‚å®ç°æ˜¯ä»€ä¹ˆ"></a>HashMapçš„åº•å±‚å®ç°æ˜¯ä»€ä¹ˆ</h2><p>JDK1.8ä¹‹å‰æ˜¯æ•°ç»„ + é“¾è¡¨ï¼Œæ•°ç»„æ˜¯HashMapçš„ä¸»ä½“ï¼Œé“¾è¡¨æ˜¯ç”¨æ¥è§£å†³å“ˆå¸Œå†²çªã€‚ä½¿ç”¨æ‹‰é“¾æ³•æ¥è§£å†³ã€‚<br>JDK1.8ä¹‹åå˜ä¸ºæ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºç­‰äºé˜ˆå€¼ <u>8</u> æ—¶ï¼Œä¼šè½¬åŒ–ï¼Œå¦‚æœå½“å‰æ•°ç»„é•¿åº¦å°äº64å°±å­¦ä¼šå…ˆè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œå¦åˆ™å°±è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œé»˜è®¤å¤§å°ä¸º16ï¼Œæ¯æ¬¡æ‰©å®¹2å€ã€‚</p>
<h2 id="æ‹‰é“¾æ³•åˆ°åº•æ˜¯ä»€ä¹ˆ"><a href="#æ‹‰é“¾æ³•åˆ°åº•æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ‹‰é“¾æ³•åˆ°åº•æ˜¯ä»€ä¹ˆ"></a>æ‹‰é“¾æ³•åˆ°åº•æ˜¯ä»€ä¹ˆ</h2><p>æ‹‰é“¾æ³•å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€æ ¼éƒ½æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œå¦‚æœé‡è§å“ˆå¸Œå†²çªï¼Œåˆ™å°†å†²çªçš„å€¼åŠ åˆ°é“¾è¡¨ä¸­ã€‚<br>JDK1.8ä¹‹åä¼šå…ˆåˆ¤æ–­é“¾è¡¨çš„é•¿åº¦æ˜¯å¦å¤§äºé˜ˆå€¼8ï¼Œç„¶åå»æ ¹æ®æ•°æ®æ¥åˆ¤æ–­æ˜¯å¦è½¬åŒ–ä¸ºçº¢é»‘æ ‘ã€‚<br><img src="/2024/09/28/24/%E6%95%B0%E6%8D%AE+%E7%BA%A2%E9%BB%91%E6%A0%91.png" alt="|450"></p>
<h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨2ä½œä¸ºåº•æ•°"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨2ä½œä¸ºåº•æ•°" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨2ä½œä¸ºåº•æ•°"></a>ä¸ºä»€ä¹ˆä½¿ç”¨2ä½œä¸ºåº•æ•°</h2><ol>
<li>ä½¿ç”¨2ä½œä¸ºåº•æ•°å¯ä»¥ä½¿ç”¨ä½è¿ç®—è€Œä¸æ˜¯å–æ¨¡å»è®¡ç®—ç´¢å¼•ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼Œæé«˜æ€§èƒ½</li>
<li>åŒæ—¶å®¹é‡æ˜¯2çš„å¹‚æ¬¡æ—¶ï¼Œå“ˆå¸Œå€¼çš„ä½ä½å’Œé«˜ä½éƒ½å¯ä»¥å‚ä¸ç´¢å¼•çš„è®¡ç®—ï¼Œå‡å°‘å“ˆå¸Œå†²çª(capacity æ˜¯ 2 çš„å¹‚æ¬¡ï¼Œå› æ­¤ capacity - 1 çš„äºŒè¿›åˆ¶è¡¨ç¤ºå…¨æ˜¯ 1ï¼Œè¿™æ · hash &amp; (capacity - 1) å°±èƒ½é«˜æ•ˆåœ°è®¡ç®—å‡ºç´¢å¼•ã€‚)</li>
<li>æ‰©å®¹æ›´æ›´ç®€å•ï¼Œé‡æ–°è®¡ç®—å“ˆå¸Œåªéœ€è¦æ£€æŸ¥å“ˆå¸Œå€¼çš„ä¸€ä¸ªé¢å¤–ä½</li>
</ol>
<h2 id="è®²è§£ä¸€ä¸‹putçš„è¿‡ç¨‹"><a href="#è®²è§£ä¸€ä¸‹putçš„è¿‡ç¨‹" class="headerlink" title="è®²è§£ä¸€ä¸‹putçš„è¿‡ç¨‹"></a>è®²è§£ä¸€ä¸‹putçš„è¿‡ç¨‹</h2><ol>
<li>åˆ¤æ–­mapæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºæˆ–è€…é•¿åº¦ä½0å°±åŠé€†è¡Œåˆå§‹åŒ–æˆ–è€…æ‰©å®¹</li>
<li>ä¹‹åè®¡ç®—hashå€¼ï¼Œå»åŒ¹é…Nodeæ•°ç»„ï¼Œå¦‚æœå®šä½åˆ°çš„æ•°ç»„æ²¡æœ‰ä½ç½®ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ’å…¥åˆ°Nodeæ•°ç»„ä¸­</li>
<li>å¦‚æœä¸ä¸ºç©ºï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯æ ‘èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯å°±è°ƒç”¨putTreeValï¼Œå¦åˆ™å°±å»éå†è¿™ä¸ªæ•°ç»„æ‰€å¯¹åº”çš„é“¾è¡¨ï¼Œå¦‚æœå‡ºç°å“ˆå¸Œå€¼å’Œkeyå®Œå…¨ä¸€è‡´å°±è¦†ç›–æ•°æ®ï¼Œå¦åˆ™å°±éå†åˆ°æœ€åä½¿ç”¨å°¾æ’æ³•ï¼Œæ’å…¥æ•°æ®</li>
<li>æ’å…¥æˆ–è€…è¦†ç›–æ•°æ®ä¹‹ååˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹æˆ–è€…è½¬åŒ–ä¸ºæ ‘å½¢ç»“æ„</li>
</ol>
<h2 id="ä¸ºä»€ä¹ˆJDK1-8ä½¿ç”¨å°¾æ’æ³•è€Œä¸æ˜¯å’ŒJDK1-7ä¸€æ ·ä½¿ç”¨å¤´æ’æ³•"><a href="#ä¸ºä»€ä¹ˆJDK1-8ä½¿ç”¨å°¾æ’æ³•è€Œä¸æ˜¯å’ŒJDK1-7ä¸€æ ·ä½¿ç”¨å¤´æ’æ³•" class="headerlink" title="ä¸ºä»€ä¹ˆJDK1.8ä½¿ç”¨å°¾æ’æ³•è€Œä¸æ˜¯å’ŒJDK1.7ä¸€æ ·ä½¿ç”¨å¤´æ’æ³•"></a>ä¸ºä»€ä¹ˆJDK1.8ä½¿ç”¨å°¾æ’æ³•è€Œä¸æ˜¯å’ŒJDK1.7ä¸€æ ·ä½¿ç”¨å¤´æ’æ³•</h2><p>å› ä¸ºå¤šçº¿ç¨‹çš„æƒ…å†µå¤´æ’æ³•æœ‰å¯èƒ½ä¼šå‡ºç°ç¯</p>
<h2 id="HashMapä½•æ—¶ä¼šæ‰©å®¹"><a href="#HashMapä½•æ—¶ä¼šæ‰©å®¹" class="headerlink" title="HashMapä½•æ—¶ä¼šæ‰©å®¹"></a>HashMapä½•æ—¶ä¼šæ‰©å®¹</h2><p>å½“é“¾è¡¨çš„é•¿åº¦å¤§äºTREEIFY_THRESHOLD(é»˜è®¤ä¸º8)æ—¶ä¼šå¼€å§‹è½¬åŒ–ï¼ŒåŒæ—¶è¦åˆ¤æ–­Nodeæ•°ç»„çš„ä¸ªæ•°æ˜¯å¦å¤§äºMIN_TREEIFY_CAPACITY(é»˜è®¤64)ï¼Œå¦‚æœå°äºå°±ä¼šå…ˆè¿›è¡Œæ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬åŒ–ï¼Œå¦‚æœå¤§äºå°±ç›´æ¥è½¬åŒ–ä¸ºçº¢é»‘æ ‘</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zuofw.github.io/2025/03/14/31/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QingQiu">
      <meta itemprop="description" content="ä¸ªäººç½‘ç«™ï¼Œå­¦ä¹ è®°å½•ï¼Œé¢è¯•è®°å½•å’Œç»éªŒæ€»ç»“ã€äº’è”ç½‘ä¸­ä¸€å—å±äºè‡ªå·±çš„å°çª">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QingQiu'Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/03/14/31/" class="post-title-link" itemprop="url">ieg-è¿è¥å¼€å‘</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-03-14 11:58:31" itemprop="dateCreated datePublished" datetime="2025-03-14T11:58:31+08:00">2025-03-14</time>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>253</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="2025-3-12-iegä¸€é¢-kpi"><a href="#2025-3-12-iegä¸€é¢-kpi" class="headerlink" title="2025.3.12 iegä¸€é¢(kpi)"></a>2025.3.12 iegä¸€é¢(kpi)</h1><ol>
<li>è‡ªæˆ‘ä»‹ç»</li>
<li>ä»‹ç»è¿è¥å¼€å‘ç›¸å…³å†…å®¹ï¼šå’Œåç«¯å¼€å‘å·®ä¸å¤šï¼Œä½†æ˜¯æ˜¯åå‘è…¾è®¯å†…éƒ¨çš„ä¸€äº›æ¸¸æˆçš„è¿è¥ï¼Œä¸»è¦è¯­è¨€Pythonã€Goï¼Œä¸åè¿ç»´ï¼Œåå‘è½¯ä»¶å·¥ç¨‹å’Œè¿è¥å¹³å°çš„å¼€å‘</li>
<li>æ‰‹æ’•ï¼šç¬¬ä¸€ä¸ªå‡ºç°ä¸¤æ¬¡çš„å­—æ¯ã€è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´ç›¸å·®å¤šå°‘å¤©(Stringç±»å‹)</li>
<li>ä»‹ç»åœ¨ç¾äº‘çš„å®ä¹ ç»å†(é¢è¯•å®˜è¯„ä»·ä¸ºå±)</li>
<li>å¦‚ä½•ç¡®å®šä¼˜åŒ–æ€è·¯çš„ï¼Ÿ</li>
<li>çº¿ç¨‹æ± çš„å‚æ•°æ˜¯å¤šå°‘ï¼Œå¦‚ä½•ç¡®å®šçš„</li>
<li>å·¥ä½œå®¤æƒ…å†µä»‹ç»</li>
<li>æŒ‘æˆ˜æœ€å¤§çš„ä¸€ä»¶äº‹æƒ…</li>
<li>åé—®ï¼šè¿è¥å¼€å‘å’Œè¿ç»´å¼€å‘åŒºåˆ«(è¿è¥å¼€å‘ä¸‡é‡‘æ²¹ï¼Œä¸æ¶‰åŠä¸šåŠ¡ï¼Œä½†æ˜¯ä¹Ÿæ˜¯åå°å¼€å‘çš„)ã€è¯„ä»·(ä»£ç èƒ½åŠ›ä¸è¡Œ)ã€ç»“æœ3-5ä¸ªå·¥ä½œæ—¥ä»¥å†…</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zuofw.github.io/2025/03/14/22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QingQiu">
      <meta itemprop="description" content="ä¸ªäººç½‘ç«™ï¼Œå­¦ä¹ è®°å½•ï¼Œé¢è¯•è®°å½•å’Œç»éªŒæ€»ç»“ã€äº’è”ç½‘ä¸­ä¸€å—å±äºè‡ªå·±çš„å°çª">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QingQiu'Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/03/14/22/" class="post-title-link" itemprop="url">å“ˆå•°-kpié¢</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-03-14 11:58:22" itemprop="dateCreated datePublished" datetime="2025-03-14T11:58:22+08:00">2025-03-14</time>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>255</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="2025-3-11-ä¸€é¢-æ²¡å¼€æ‘„åƒå¤´-20åˆ†é’Ÿï¼Œé‰´å®šä¸ºkpi"><a href="#2025-3-11-ä¸€é¢-æ²¡å¼€æ‘„åƒå¤´-20åˆ†é’Ÿï¼Œé‰´å®šä¸ºkpi" class="headerlink" title="2025.3.11 ä¸€é¢(æ²¡å¼€æ‘„åƒå¤´+20åˆ†é’Ÿï¼Œé‰´å®šä¸ºkpi)"></a>2025.3.11 ä¸€é¢(æ²¡å¼€æ‘„åƒå¤´+20åˆ†é’Ÿï¼Œé‰´å®šä¸ºkpi)</h1><ol>
<li>è‡ªæˆ‘ä»‹ç»</li>
<li>å¯¹AIé¢è¯•çš„æ„Ÿè§‰</li>
<li>JVMå†…å­˜ç»“æ„</li>
<li>Stringç±»æœ‰å“ªäº›ç‰¹ç‚¹</li>
<li>HashMapçš„å®ç°åŸç†</li>
<li>çº¿ç¨‹æ± æ€ä¹ˆåˆ›å»ºï¼Œæœ‰å“ªäº›å‚æ•°</li>
<li>å®ä¹ æ‹·é—®</li>
<li>synchronizedå’Œlockçš„åŒºåˆ«</li>
<li>ThreadLocal</li>
<li>Springå¾ªç¯ä¾èµ–å¦‚ä½•è§£å†³çš„</li>
<li>MyBatisä¸­çš„ResultMapæ˜¯ä»€ä¹ˆ</li>
<li>SpringBootæœ‰å“ªäº›æ ¸å¿ƒæ³¨è§£</li>
<li>äº†è§£å¤§æ¨¡å‹å—(æˆ‘ä¸€ä¸ªç ´åŒéï¼Œä½ è¿˜æŒ‡æœ›æˆ‘æ‰‹æ“å¤§æ¨¡å‹å—)</li>
<li>åé—®ï¼šä¸šåŠ¡-&gt;ç®—æ³•å·¥ç¨‹(?æˆ‘ä»€ä¹ˆæ—¶å€™æŠ•çš„è¿™ä¸ªå²—ï¼Ÿ)ã€å¤§æ¨¡å‹å¹³å°ï¼Œè¯„ä»·ï¼šå»çœ‹çœ‹AIå·¥ç¨‹ã€IGã€å·¥ä½œæµè¿™ä¸€å—</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zuofw.github.io/2025/03/11/28/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QingQiu">
      <meta itemprop="description" content="ä¸ªäººç½‘ç«™ï¼Œå­¦ä¹ è®°å½•ï¼Œé¢è¯•è®°å½•å’Œç»éªŒæ€»ç»“ã€äº’è”ç½‘ä¸­ä¸€å—å±äºè‡ªå·±çš„å°çª">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QingQiu'Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/03/11/28/" class="post-title-link" itemprop="url">å¿«æ‰‹æ•°æ®éƒ¨é—¨-æ—¥å¸¸å®ä¹ </a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-03-11 10:50:28" itemprop="dateCreated datePublished" datetime="2025-03-11T10:50:28+08:00">2025-03-11</time>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>8.2k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="2025-3-10-ä¸€é¢-ç§’è¿‡ï¼Œæ™šä¸Šçº¦ç¬¬äºŒå¤©ä¸‹åˆäºŒé¢"><a href="#2025-3-10-ä¸€é¢-ç§’è¿‡ï¼Œæ™šä¸Šçº¦ç¬¬äºŒå¤©ä¸‹åˆäºŒé¢" class="headerlink" title="2025.3.10 ä¸€é¢(ç§’è¿‡ï¼Œæ™šä¸Šçº¦ç¬¬äºŒå¤©ä¸‹åˆäºŒé¢)"></a>2025.3.10 ä¸€é¢(ç§’è¿‡ï¼Œæ™šä¸Šçº¦ç¬¬äºŒå¤©ä¸‹åˆäºŒé¢)</h1><p>æ¯”è¾ƒæŠ½è±¡ï¼Œé¢è¯•å®˜ä¸€ç›´è¯´æ„Ÿè§‰ä½ ä»¬è¿™ä¸€å±Šæœ‰ç‚¹å·ï¼Œç–¯ç‹‚æ‰“æ–­</p>
<ol>
<li>è‡ªæˆ‘ä»‹ç»</li>
<li>ä»‹ç»ä»£è¡¨æ€§çš„é¡¹ç›®ï¼š</li>
<li>ä¸‹æ¸¸æ•°æ®ä¸ŠæŠ¥æ—¶ï¼Œåœ¨å¤šä¸ªä¸ŠæŠ¥ä¸­ï¼Œå¦‚ä½•å¤„ç†æ•°æ®ä¸€è‡´æ€§</li>
<li>ç›´æ¥æŸ¥è¡¨çš„è¯ï¼Œå¯¹è¿™å¼ è¡¨çš„åº“é€ æˆå¤§é‡å‹åŠ›ï¼Œä¸ºä»€ä¹ˆå¯ä»¥æŸ¥ä½†æ˜¯è¦åŒæ­¥åˆ°æœ¬åœ°å‘¢ï¼Ÿ</li>
<li>å®ä¹ çš„æ—¶å€™å¯ä»¥å¤šæ€è€ƒï¼Œå…¨é“¾è·¯ï¼Œæ€è€ƒå¾ˆå¤šçš„æ•°æ®ä¸€è‡´æ€§å¤„ç†ä¹‹ç±»çš„ï¼Œä¸è¦åªåœç•™åœ¨ç†è®ºï¼Œè¯¥é—®å°±é—®</li>
<li>Redisåšåˆ†å¸ƒå¼é”æœ‰ä»€ä¹ˆä¸å¥½çš„åœ°æ–¹</li>
<li>å¦‚æœæ•°æ®åŒæ­¥åˆ°ä¸€åŠï¼Œå‡ºç°äº†é—®é¢˜ï¼Œå¦‚ä½•å¤„ç†ä¸€è‡´æ€§å’Œåˆ¤æ–­ä¸Šä¸€æ¬¡åŒæ­¥çš„æ–­ç‚¹å‘¢/æ–­ç‚¹é‡æ–°åŒæ­¥å¦‚ä½•è®¾è®¡çš„ï¼Ÿ</li>
<li>å¦‚æœåŒæ­¥è¿‡ç¨‹ä¸­ï¼ŒåŒæ­¥æ²¡æœ‰å¤±è´¥ï¼ŒRedisè¿‡æœŸäº†è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œé‚£ä¹ˆå¦‚ä½•å¤„ç†</li>
<li>æ‰‹æ’•ï¼šäºŒå‰æ ‘çš„ç›´å¾„ã€kä¸ªä¸€ç»„åè½¬é“¾è¡¨</li>
<li>å·¥ä½œå®¤æƒ…å†µ</li>
<li>åé—®ï¼šéƒ¨é—¨ä¸šåŠ¡</li>
</ol>
<h2 id="ä¸‹æ¸¸æ•°æ®ä¸ŠæŠ¥æ—¶ï¼Œåœ¨å¤šä¸ªä¸ŠæŠ¥ä¸­ï¼Œå¦‚ä½•å¤„ç†æ•°æ®ä¸€è‡´æ€§"><a href="#ä¸‹æ¸¸æ•°æ®ä¸ŠæŠ¥æ—¶ï¼Œåœ¨å¤šä¸ªä¸ŠæŠ¥ä¸­ï¼Œå¦‚ä½•å¤„ç†æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="ä¸‹æ¸¸æ•°æ®ä¸ŠæŠ¥æ—¶ï¼Œåœ¨å¤šä¸ªä¸ŠæŠ¥ä¸­ï¼Œå¦‚ä½•å¤„ç†æ•°æ®ä¸€è‡´æ€§"></a>ä¸‹æ¸¸æ•°æ®ä¸ŠæŠ¥æ—¶ï¼Œåœ¨å¤šä¸ªä¸ŠæŠ¥ä¸­ï¼Œå¦‚ä½•å¤„ç†æ•°æ®ä¸€è‡´æ€§</h2><ol>
<li>å¯ä»¥è®¾ç½®ç‰ˆæœ¬å·æˆ–è€…å”¯ä¸€æ ‡è¯†æ¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</li>
<li>äº‹åŠ¡ç®¡ç†ï¼Œå°†å¤šä¸ªç›¸å…³æ•°æ®ä¸ŠæŠ¥æ“ä½œå°è£…åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¦‚æœåœ¨äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­å‡ºç°ä»»ä½•é”™è¯¯ï¼Œäº‹åŠ¡å¯ä»¥å›æ»šï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</li>
</ol>
<h2 id="Redisåˆ†å¸ƒå¼é”çš„ç¼ºé™·å’Œè§£å†³æ–¹æ¡ˆ"><a href="#Redisåˆ†å¸ƒå¼é”çš„ç¼ºé™·å’Œè§£å†³æ–¹æ¡ˆ" class="headerlink" title="Redisåˆ†å¸ƒå¼é”çš„ç¼ºé™·å’Œè§£å†³æ–¹æ¡ˆ"></a>Redisåˆ†å¸ƒå¼é”çš„ç¼ºé™·å’Œè§£å†³æ–¹æ¡ˆ</h2><ol>
<li>é”å¤±æ•ˆï¼šå¦‚æœä¸šåŠ¡æ‰§è¡Œæ—¶é—´è¶…è¿‡é”è¿‡æœŸæ—¶é—´ï¼Œå¯èƒ½ä¼šå¯¼è‡´é”è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼Œä»è€Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚ <ul>
<li>è§£å†³æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨çœ‹é—¨ç‹—æœºåˆ¶å’Œè®¾ç½®è¶…æ—¶æ—¶é—´</li>
</ul>
</li>
<li>é”è¯¯åˆ é—®é¢˜ï¼šçº¿ç¨‹Aé‡Šæ”¾é”æ—¶å¯èƒ½è¯¯åˆ çº¿ç¨‹Bçš„é”(å¦‚Açš„é”è¿‡æœŸåï¼ŒBè·å–ä¿¡çš„é”ï¼Œä½†æ˜¯Aåœ¨æ‰§è¡Œè§£é”æ“ä½œ)<ul>
<li>è§£å†³æ–¹æ¡ˆæ˜¯ï¼šä½¿ç”¨å”¯ä¸€æ ‡è¯†æˆ–è€…ä½¿ç”¨Luaè„šæœ¬æ¥å®ç°æ ¡éªŒæ ‡è¯†+åˆ é™¤é”çš„åŸå­æ“ä½œï¼Œé¿å…ä¸­é—´çŠ¶æ€ã€‚</li>
</ul>
</li>
<li>ä¸»ä»åŒæ­¥å»¶è¿Ÿé—®é¢˜ï¼šä¸»èŠ‚ç‚¹å†™å…¥é”åä½åŒæ­¥åˆ°ä»èŠ‚ç‚¹å³å®•æœºï¼Œå¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹ä»æ–°ä¸»èŠ‚ç‚¹è·å–é‡å¤é”ã€‚<ul>
<li>è§£å†³æ–¹æ¡ˆï¼šRedLockç®—æ³•ã€ä½¿ç”¨ZooKeeperæ¥ä¿è¯å¼ºä¸€è‡´æ€§</li>
</ul>
</li>
</ol>
<h1 id="2025-3-11-äºŒé¢-ä¸‹åˆäº”ç‚¹é¢ï¼Œç¬¬äºŒå¤©æ—©ä¸Š9ç‚¹é€šçŸ¥ä¸‰é¢"><a href="#2025-3-11-äºŒé¢-ä¸‹åˆäº”ç‚¹é¢ï¼Œç¬¬äºŒå¤©æ—©ä¸Š9ç‚¹é€šçŸ¥ä¸‰é¢" class="headerlink" title="2025.3.11 äºŒé¢(ä¸‹åˆäº”ç‚¹é¢ï¼Œç¬¬äºŒå¤©æ—©ä¸Š9ç‚¹é€šçŸ¥ä¸‰é¢)"></a>2025.3.11 äºŒé¢(ä¸‹åˆäº”ç‚¹é¢ï¼Œç¬¬äºŒå¤©æ—©ä¸Š9ç‚¹é€šçŸ¥ä¸‰é¢)</h1><p>æ‰‹æ’•äº†ä¸‰é“ç®—æ³•</p>
<ol>
<li>è‡ªæˆ‘ä»‹ç»</li>
<li>ä»‹ç»ä¸€ä¸‹çº¿ç¨‹æ± ï¼Œæœ‰å“ªäº›çº¿ç¨‹æ± (è¢«å…«è‚¡ï¼Œå·´æ‹‰å·´æ‹‰ï¼ŒèƒŒåˆ°ä¸€åŠç»™æˆ‘æ‰“æ–­äº†)</li>
<li>CompletableFutureå’ŒFutureçš„åŒºåˆ«</li>
<li>forkjoinçº¿ç¨‹æ± åŸç†ï¼Œä¸ºä»€ä¹ˆCFè¦ä½¿ç”¨forkjoinçº¿ç¨‹æ± </li>
<li>ä¸ºä»€ä¹ˆä½¿ç”¨RocketMQ</li>
<li>å¦‚ä½•æ‰‹åŠ¨é€šè¿‡Kafkaå®ç°äº‹åŠ¡æ¶ˆæ¯å’Œæ­»ä¿¡é˜Ÿåˆ—</li>
<li>é™¤äº†Redisè¿˜æœ‰å“ªäº›å¯ä»¥å®ç°ZooKeeperï¼Œå®ç°åŸç†</li>
<li>æ‰‹æ’•ï¼šå¤§æ•°ç›¸åŠ (å­—ç¬¦ä¸²æ¨¡æ‹Ÿ)ã€å¯»æ‰¾é‡å¤å­æ ‘ã€å²›å±¿æ•°é‡</li>
<li>åé—®ï¼šåšè¿‡å¤šå°‘ç®—æ³•é¢˜ã€æ˜¯æ—¥å¸¸å—-&gt;é—®hrï¼Œè¿˜æœ‰ä¸‰é¢å—-&gt;åº”è¯¥æœ‰ï¼Œé¢è¯•ç»“æœå¤šä¹…å¯ä»¥å‡º-&gt; é—®hr</li>
<li>å¯¹æœªæ¥çš„æŒ‡ç‚¹ï¼šå¤šå­¦ç‚¹æŠ€æœ¯ã€å¤§æ•°æ®æ–¹é¢çš„å¯ä»¥çœ‹ä¸€çœ‹ã€‚</li>
</ol>
<h2 id="ForkJoinçš„æ ¸å¿ƒåŸç†"><a href="#ForkJoinçš„æ ¸å¿ƒåŸç†" class="headerlink" title="ForkJoinçš„æ ¸å¿ƒåŸç†"></a>ForkJoinçš„æ ¸å¿ƒåŸç†</h2><h2 id="æ ¸å¿ƒæ€æƒ³æ˜¯åˆ†æ²»ç®—æ³•å’Œå·¥ä½œçªƒå–æœºåˆ¶ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡å¹¶è¡Œä»»åŠ¡çš„é«˜æ•ˆå¤„ç†ã€‚-åˆ†æ”¯ç®—æ³•ï¼šå°†å¤§ä»»åŠ¡æ‹†åˆ†ä¸ºå­ä»»åŠ¡-fork-ï¼Œç›´åˆ°å­ä»»åŠ¡è¶³å¤Ÿå°ï¼Œç›´æ¥è®¡ç®—ç»“æœåé€å±‚åˆå¹¶-join-å·¥ä½œçªƒå–æœºåˆ¶ï¼š-æ¯ä¸ªå·¥ä½œçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œä¼˜å…ˆä»é˜Ÿå°¾å–å‡ºè‡ªå·±çš„ä»»åŠ¡æ‰§è¡Œ-å½“çº¿ç¨‹ç©ºé—²æ—¶ï¼Œä»å…¶ä»–çº¿ç¨‹çš„é˜Ÿå¤´çªƒå–ä»»åŠ¡ï¼Œå‡å°‘çº¿ç¨‹é˜»å¡ã€‚-æ•°æ®ç»“æ„ä½¿ç”¨çš„æ˜¯ForkJoinTaskï¼Œä»»åŠ¡é˜Ÿåˆ—åŸºäºWorkQueueä¼˜åŒ–"><a href="#æ ¸å¿ƒæ€æƒ³æ˜¯åˆ†æ²»ç®—æ³•å’Œå·¥ä½œçªƒå–æœºåˆ¶ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡å¹¶è¡Œä»»åŠ¡çš„é«˜æ•ˆå¤„ç†ã€‚-åˆ†æ”¯ç®—æ³•ï¼šå°†å¤§ä»»åŠ¡æ‹†åˆ†ä¸ºå­ä»»åŠ¡-fork-ï¼Œç›´åˆ°å­ä»»åŠ¡è¶³å¤Ÿå°ï¼Œç›´æ¥è®¡ç®—ç»“æœåé€å±‚åˆå¹¶-join-å·¥ä½œçªƒå–æœºåˆ¶ï¼š-æ¯ä¸ªå·¥ä½œçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œä¼˜å…ˆä»é˜Ÿå°¾å–å‡ºè‡ªå·±çš„ä»»åŠ¡æ‰§è¡Œ-å½“çº¿ç¨‹ç©ºé—²æ—¶ï¼Œä»å…¶ä»–çº¿ç¨‹çš„é˜Ÿå¤´çªƒå–ä»»åŠ¡ï¼Œå‡å°‘çº¿ç¨‹é˜»å¡ã€‚-æ•°æ®ç»“æ„ä½¿ç”¨çš„æ˜¯ForkJoinTaskï¼Œä»»åŠ¡é˜Ÿåˆ—åŸºäºWorkQueueä¼˜åŒ–" class="headerlink" title="æ ¸å¿ƒæ€æƒ³æ˜¯åˆ†æ²»ç®—æ³•å’Œå·¥ä½œçªƒå–æœºåˆ¶ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡å¹¶è¡Œä»»åŠ¡çš„é«˜æ•ˆå¤„ç†ã€‚- åˆ†æ”¯ç®—æ³•ï¼šå°†å¤§ä»»åŠ¡æ‹†åˆ†ä¸ºå­ä»»åŠ¡(fork)ï¼Œç›´åˆ°å­ä»»åŠ¡è¶³å¤Ÿå°ï¼Œç›´æ¥è®¡ç®—ç»“æœåé€å±‚åˆå¹¶(join)- å·¥ä½œçªƒå–æœºåˆ¶ï¼š    - æ¯ä¸ªå·¥ä½œçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œä¼˜å…ˆä»é˜Ÿå°¾å–å‡ºè‡ªå·±çš„ä»»åŠ¡æ‰§è¡Œ    - å½“çº¿ç¨‹ç©ºé—²æ—¶ï¼Œä»å…¶ä»–çº¿ç¨‹çš„é˜Ÿå¤´çªƒå–ä»»åŠ¡ï¼Œå‡å°‘çº¿ç¨‹é˜»å¡ã€‚    - æ•°æ®ç»“æ„ä½¿ç”¨çš„æ˜¯ForkJoinTaskï¼Œä»»åŠ¡é˜Ÿåˆ—åŸºäºWorkQueueä¼˜åŒ–"></a>æ ¸å¿ƒæ€æƒ³æ˜¯åˆ†æ²»ç®—æ³•å’Œå·¥ä½œçªƒå–æœºåˆ¶ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡å¹¶è¡Œä»»åŠ¡çš„é«˜æ•ˆå¤„ç†ã€‚<br>- åˆ†æ”¯ç®—æ³•ï¼šå°†å¤§ä»»åŠ¡æ‹†åˆ†ä¸ºå­ä»»åŠ¡(fork)ï¼Œç›´åˆ°å­ä»»åŠ¡è¶³å¤Ÿå°ï¼Œç›´æ¥è®¡ç®—ç»“æœåé€å±‚åˆå¹¶(join)<br>- å·¥ä½œçªƒå–æœºåˆ¶ï¼š<br>    - æ¯ä¸ªå·¥ä½œçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œä¼˜å…ˆä»é˜Ÿå°¾å–å‡ºè‡ªå·±çš„ä»»åŠ¡æ‰§è¡Œ<br>    - å½“çº¿ç¨‹ç©ºé—²æ—¶ï¼Œä»å…¶ä»–çº¿ç¨‹çš„é˜Ÿå¤´çªƒå–ä»»åŠ¡ï¼Œå‡å°‘çº¿ç¨‹é˜»å¡ã€‚<br>    - æ•°æ®ç»“æ„ä½¿ç”¨çš„æ˜¯ForkJoinTaskï¼Œä»»åŠ¡é˜Ÿåˆ—åŸºäºWorkQueueä¼˜åŒ–</h2><h1 id="2025-3-12-ä¸‰é¢-ä¸‹åˆäº”ç‚¹ï¼Œç¬¬äºŒå¤©æ—©ä¸Š10ç‚¹çº¦ä¸‹åˆhré¢ï¼Œå¸Œæœ›èƒ½é¡ºåˆ©ä¸€ç‚¹å§"><a href="#2025-3-12-ä¸‰é¢-ä¸‹åˆäº”ç‚¹ï¼Œç¬¬äºŒå¤©æ—©ä¸Š10ç‚¹çº¦ä¸‹åˆhré¢ï¼Œå¸Œæœ›èƒ½é¡ºåˆ©ä¸€ç‚¹å§" class="headerlink" title="2025.3.12 ä¸‰é¢ (ä¸‹åˆäº”ç‚¹ï¼Œç¬¬äºŒå¤©æ—©ä¸Š10ç‚¹çº¦ä¸‹åˆhré¢ï¼Œå¸Œæœ›èƒ½é¡ºåˆ©ä¸€ç‚¹å§)"></a>2025.3.12 ä¸‰é¢ (ä¸‹åˆäº”ç‚¹ï¼Œç¬¬äºŒå¤©æ—©ä¸Š10ç‚¹çº¦ä¸‹åˆhré¢ï¼Œå¸Œæœ›èƒ½é¡ºåˆ©ä¸€ç‚¹å§)</h1><ol>
<li>è‡ªæˆ‘ä»‹ç»</li>
<li>å®ä¹ åœ°ç‚¹å’Œå¸‚åœº</li>
<li>è®²è®²æœ€æœ‰æŒ‘æˆ˜çš„é¡¹ç›®ï¼šæˆ‘çœŸçš„å¥½æƒ³æŠŠç¾çš„è¿™ä¸ªåƒåœ¾é¡¹ç›®æ¢æ‰å•Šï¼Œå±å±±</li>
<li>RPCç›¸å…³(è‡ªå·±å»çœ‹æ–‡æ¡£)</li>
<li>ä»‹ç»ä¸€ä¸‹ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</li>
<li>å¦‚æœèŠ‚ç‚¹æŒ‚æ‰ï¼Œæ˜¯å¦‚ä½•ä»å“ˆå¸Œç¯ä¸­æ‰¾åˆ°æ›¿ä»£èŠ‚ç‚¹(è¿˜æœ‰èŠ‚ç‚¹é‡æ–°å“ˆå¸Œçš„ä½ç½®å¦‚ä½•ç¡®å®š)</li>
<li>å¾ˆå¤šçš„èŠ‚ç‚¹å®•æœºäº†ï¼Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹éœ€è¦æ‹†åˆ†(è™šæ‹ŸèŠ‚ç‚¹)å¦‚ä½•ç¡®å®šæ–°çš„èŠ‚ç‚¹åº”è¯¥å“ˆå¸Œåˆ°å“ªä¸ªä½ç½®ã€‚</li>
<li>çœ‹æºç çš„æ—¶å€™æœ‰è§‰å¾—å“ªäº›æ¯”è¾ƒæœ‰æ„æ€çš„æºç (æˆ‘è®²çš„CFå’ŒFutureTask) <code>public class CompletableFuture&lt;T&gt; implements Future&lt;T&gt;, CompletionStage&lt;T&gt; </code></li>
<li>å›´ç»•ç€Javaçš„ç‰¹æ€§ï¼Œä½ è§‰å¾—Javaæ˜¯ä¸€ç§ä»€ä¹ˆæ ·çš„è¯­è¨€</li>
<li>GC(ç–¯ç‹‚æ‰“æ–­)</li>
<li>å¦‚ä½•ç¡®å®šéœ€è¦è¢«æ¸…é™¤çš„åƒåœ¾</li>
<li>å“ªäº›èŠ‚ç‚¹å¯ä»¥ä½œä¸ºGC Roots</li>
<li>ç®€å•ä»‹ç»ä¸€ä¸‹æœ¬åœ°æ–¹æ³•æ ˆ</li>
<li>æœ¬åœ°æ–¹æ³•åœ¨æ ˆä¸­æ˜¯æ€ä¹ˆå­˜å‘¢</li>
<li>æ–¹æ³•å†…è”ï¼Ÿ</li>
<li>G1(Garbage First)ï¼Œä»‹ç»ä¸€ä¸‹ä»–çš„å®ç°è¿˜æœ‰ä½¿ç”¨çš„ç®—æ³•</li>
<li>å¦‚ä½•åˆ¤æ–­å“ªäº›Regionéœ€è¦è¿›è¡Œå›æ”¶ã€å¦‚ä½•åˆ¤æ–­å“ªäº›Regionéœ€è¦è¿›è¡Œå›æ”¶ã€Regionå›æ”¶çš„è¯„ä¼°æ ‡å‡†(ä¸ä¼š)</li>
<li>Synchronizedå’ŒReentrantLockåº•å±‚</li>
<li>æ‰‹å†™ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼(å¤šçº¿ç¨‹)</li>
<li>è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ</li>
<li>åé—®ï¼šè¿˜æœ‰æ–°çš„ä¸€è½®æŠ€æœ¯é¢çš„ï¼šæ²¡æœ‰äº†</li>
<li>å¤šä¹…å‡ºç»“æœï¼šå¾ˆå¿«ï¼Œç­‰é€šçŸ¥å§</li>
<li>æœ‰å“ªäº›æŒ‡ç‚¹å—ï¼šæŒºä¸é”™çš„ï¼Œæ²¡å•¥æŒ‡ç‚¹çš„ï¼Œçœ‹ä¸‹æ¥æ¯”åŒé¾„äººä¼˜ç§€ä¸å°‘</li>
</ol>
<h2 id="æ‰‹æ’•ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼-å¤šçº¿ç¨‹å¹¶å‘ç‰ˆï¼Œsynchronizedçš„ä½¿ç”¨æ–¹å¼"><a href="#æ‰‹æ’•ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼-å¤šçº¿ç¨‹å¹¶å‘ç‰ˆï¼Œsynchronizedçš„ä½¿ç”¨æ–¹å¼" class="headerlink" title="æ‰‹æ’•ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼(å¤šçº¿ç¨‹å¹¶å‘ç‰ˆï¼Œsynchronizedçš„ä½¿ç”¨æ–¹å¼)"></a>æ‰‹æ’•ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼(å¤šçº¿ç¨‹å¹¶å‘ç‰ˆï¼Œsynchronizedçš„ä½¿ç”¨æ–¹å¼)</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProducerConsumerWithBoundedArray</span> <span class="token punctuation">{</span>  
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer<span class="token punctuation">;</span>  
    <span class="token keyword">private</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// å½“å‰å…ƒç´ æ•°é‡  </span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> putIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// ä¸‹ä¸€ä¸ªæ’å…¥ä½ç½®  </span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> takeIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// ä¸‹ä¸€ä¸ªå–å‡ºä½ç½®  </span>
  
    <span class="token keyword">public</span> <span class="token class-name">ProducerConsumerWithBoundedArray</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>capacity<span class="token punctuation">]</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token comment">// ç”Ÿäº§è€…  </span>
    <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>  
        <span class="token annotation punctuation">@Override</span>  
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                    <span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> buffer<span class="token punctuation">.</span>length<span class="token punctuation">)</span>  <span class="token punctuation">{</span> <span class="token comment">// ç¼“å†²åŒºæ»¡åˆ™ç­‰å¾…  </span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>  
                            <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                        <span class="token punctuation">}</span>  
                    <span class="token punctuation">}</span>  
                    <span class="token keyword">int</span> item <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                    buffer<span class="token punctuation">[</span>putIndex<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">;</span>  
                    putIndex <span class="token operator">=</span> <span class="token punctuation">(</span>putIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> buffer<span class="token punctuation">.</span>length<span class="token punctuation">;</span>  <span class="token comment">// å¾ªç¯æ•°ç»„  </span>
                    count<span class="token operator">++</span><span class="token punctuation">;</span>  
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" ç”Ÿäº§: "</span> <span class="token operator">+</span> item <span class="token operator">+</span> <span class="token string">"ï¼Œå½“å‰æ•°é‡: "</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>  
                    <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å”¤é†’æ¶ˆè´¹è€…  </span>
                <span class="token punctuation">}</span>  
                <span class="token keyword">try</span> <span class="token punctuation">{</span>  
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ¨¡æ‹Ÿç”Ÿäº§è€—æ—¶  </span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                <span class="token punctuation">}</span>  
            <span class="token punctuation">}</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token comment">// æ¶ˆè´¹è€…  </span>
    <span class="token keyword">class</span> <span class="token class-name">Consumer</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>  
        <span class="token annotation punctuation">@Override</span>  
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                    <span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ç¼“å†²åŒºç©ºåˆ™ç­‰å¾…  </span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>  
                            <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                        <span class="token punctuation">}</span>  
                    <span class="token punctuation">}</span>  
                    <span class="token keyword">int</span> item <span class="token operator">=</span> buffer<span class="token punctuation">[</span>takeIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>  
                    takeIndex <span class="token operator">=</span> <span class="token punctuation">(</span>takeIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> buffer<span class="token punctuation">.</span>length<span class="token punctuation">;</span>  <span class="token comment">// å¾ªç¯æ•°ç»„  </span>
                    count<span class="token operator">--</span><span class="token punctuation">;</span>  
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" æ¶ˆè´¹: "</span> <span class="token operator">+</span> item <span class="token operator">+</span> <span class="token string">"ï¼Œå‰©ä½™æ•°é‡: "</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>  
                    <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å”¤é†’ç”Ÿäº§è€…  </span>
                <span class="token punctuation">}</span>  
                <span class="token keyword">try</span> <span class="token punctuation">{</span>  
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ¨¡æ‹Ÿæ¶ˆè´¹è€—æ—¶  </span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                <span class="token punctuation">}</span>  
            <span class="token punctuation">}</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token class-name">ProducerConsumerWithBoundedArray</span> pc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProducerConsumerWithBoundedArray</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>pc<span class="token punctuation">.</span><span class="token keyword">new</span>  <span class="token class-name">Producer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>pc<span class="token punctuation">.</span><span class="token keyword">new</span>  <span class="token class-name">Consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="ä¸€è‡´æ€§å“ˆå¸Œè¯¦è§£"><a href="#ä¸€è‡´æ€§å“ˆå¸Œè¯¦è§£" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œè¯¦è§£"></a>ä¸€è‡´æ€§å“ˆå¸Œè¯¦è§£</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>å°†èŠ‚ç‚¹(ç‰©ç†æˆ–è€…è™šæ‹Ÿ)å’Œæ•°æ®é€šè¿‡å“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°å›ºå®šèŒƒå›´å†…çš„åŸå‹ç©ºé—´ã€‚å¯ä»¥æ ¹æ®èŠ‚ç‚¹IPæˆ–è€…å”¯ä¸€æ ‡è¯†è®¡ç®—å“ˆå¸Œå€¼ã€‚æ•°æ®å“ˆå¸Œå€¼æŒ‰ç…§é¡ºæ—¶é’ˆæ–¹å‘æ‰¾åˆ°<strong>æœ€è¿‘çš„èŠ‚ç‚¹ä½œä¸ºç›®æ ‡èŠ‚ç‚¹ã€‚</strong> å¯ä»¥ç»™æ¯ä¸ªç‰©ç†èŠ‚ç‚¹å¯¹åº”å¤šä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œé€šè¿‡å“ˆå¸Œåˆ†æ•£åˆ°ç¯çš„ä¸åŒä½ç½®ï¼Œè§£å†³æ•°æ®å€¾æ–œé—®é¢˜ã€‚</p>
<h3 id="èŠ‚ç‚¹æ•…éšœå¤„ç†å’Œæ›¿ä»£èŠ‚ç‚¹é€‰æ‹©"><a href="#èŠ‚ç‚¹æ•…éšœå¤„ç†å’Œæ›¿ä»£èŠ‚ç‚¹é€‰æ‹©" class="headerlink" title="èŠ‚ç‚¹æ•…éšœå¤„ç†å’Œæ›¿ä»£èŠ‚ç‚¹é€‰æ‹©"></a>èŠ‚ç‚¹æ•…éšœå¤„ç†å’Œæ›¿ä»£èŠ‚ç‚¹é€‰æ‹©</h3><p>æ›¿ä»£èŠ‚ç‚¹é€‰æ‹©ï¼šå½“èŠ‚ç‚¹å®•æœºæ—¶ï¼ŒåŸæœ¬è·¯ç”±åˆ°è¯¥èŠ‚ç‚¹çš„æ•°æ®ä¼šé¡ºæ—¶é’ˆæ‰¾åˆ°ç¯çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºæ–°å½’å±ã€‚<br>æ•°æ®è¿ç§»èŒƒå›´ï¼šä»…å½±å“å®•æœºèŠ‚ç‚¹åˆ°å…¶å‰é©±èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®ï¼Œå…¶ä»–èŠ‚ç‚¹ä¸å—å½±å“ã€‚</p>
<h3 id="é‡æ–°å“ˆå¸Œç¡®å®šä½ç½®"><a href="#é‡æ–°å“ˆå¸Œç¡®å®šä½ç½®" class="headerlink" title="é‡æ–°å“ˆå¸Œç¡®å®šä½ç½®"></a>é‡æ–°å“ˆå¸Œç¡®å®šä½ç½®</h3><p>æ–°å¢èŠ‚ç‚¹æ—¶ï¼Œé€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—å…¶IPæˆ–è€…æ ‡è¯†çš„å“ˆå¸Œå€¼ï¼Œç¡®å®šåœ¨å“ˆå¸Œç¯ä¸Šçš„ä½ç½®ã€‚<br>é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹æœºåˆ¶ï¼Œæ–°å¢èŠ‚ç‚¹çš„è™šæ‹Ÿä½ç½®ä¼šå‡åŒ€åˆ†å¸ƒåœ¨ç¯ä¸Šï¼Œå‡å°‘æ•°æ®è¿ç§»é‡ã€‚</p>
<h3 id="å¦‚ä½•å¤„ç†é«˜QPSèŠ‚ç‚¹"><a href="#å¦‚ä½•å¤„ç†é«˜QPSèŠ‚ç‚¹" class="headerlink" title="å¦‚ä½•å¤„ç†é«˜QPSèŠ‚ç‚¹"></a>å¦‚ä½•å¤„ç†é«˜QPSèŠ‚ç‚¹</h3><ol>
<li>åŠ¨æ€è´Ÿè½½å‡è¡¡ï¼š<ul>
<li>è™šæ‹ŸèŠ‚ç‚¹æ‰©å®¹ï¼šä¸ºæ›´é«˜è´Ÿè½½èŠ‚ç‚¹åŠ¨æ€å¢åŠ è™šæ‹ŸèŠ‚ç‚¹çš„æ•°æ®é‡</li>
<li>å¯¹çƒ­ç‚¹æ•°æ®ç”Ÿæˆå¤šä¸ªå‰¯æœ¬ï¼Œæ˜ å°„åˆ°å“ˆå¸Œç¯ä¸Šçš„ä¸åŒä½ç½®</li>
</ul>
</li>
<li>æœ¬åœ°ç¼“å­˜ä¸è¯·æ±‚é™æµï¼š<ul>
<li>å®¢æˆ·ç«¯æˆ–è€…ä»£ç†å±‚å¯¹çƒ­ç‚¹æ•°æ®å¢åŠ æœ¬åœ°ç¼“å­˜ï¼Œå‡å°‘å¯¹èŠ‚ç‚¹çš„ç›´æ¥è®¿é—®</li>
<li>é€šè¿‡ä»¤ç‰Œæ¡¶ç­‰ç®—æ³•é™åˆ¶å•ä¸ªèŠ‚ç‚¹çš„è¯·æ±‚é€Ÿç‡ã€‚</li>
</ul>
</li>
</ol>
<h3 id="å¤§é‡èŠ‚ç‚¹å®•æœºåçš„è™šæ‹ŸèŠ‚ç‚¹æ‹†åˆ†"><a href="#å¤§é‡èŠ‚ç‚¹å®•æœºåçš„è™šæ‹ŸèŠ‚ç‚¹æ‹†åˆ†" class="headerlink" title="å¤§é‡èŠ‚ç‚¹å®•æœºåçš„è™šæ‹ŸèŠ‚ç‚¹æ‹†åˆ†"></a>å¤§é‡èŠ‚ç‚¹å®•æœºåçš„è™šæ‹ŸèŠ‚ç‚¹æ‹†åˆ†</h3><p>è™šæ‹ŸèŠ‚ç‚¹é‡æ–°åˆ†é…ï¼š<br>    æŒ‰ç…§æƒé‡åˆ†é…ï¼šæ ¹æ®å‰©ä½™èŠ‚ç‚¹çš„å®¹é‡æ¯”ä¾‹åˆ†é…è™šæ‹ŸèŠ‚ç‚¹<br>    å“ˆå¸Œå‡åŒ€æ€§ï¼šé€šè¿‡å“ˆå¸Œå‡½æ•°å°†åŸè™šæ‹ŸèŠ‚ç‚¹é‡æ–°æ˜ å°„åˆ°å‰©ä½™èŠ‚ç‚¹ã€‚<code>new_virtual_node = hash(old_virtual_node + "_replica") % 2^32</code> </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span> 
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">MessageDigest</span></span><span class="token punctuation">;</span> 
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsistentHash</span> <span class="token punctuation">{</span>
    <span class="token comment">// å“ˆå¸Œç¯å­˜å‚¨è™šæ‹ŸèŠ‚ç‚¹ï¼ˆTreeMapå®ç°æœ‰åºç¯ç»“æ„ï¼‰</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> virtualNodes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> virtualNodeCount<span class="token punctuation">;</span> <span class="token comment">// æ¯ä¸ªç‰©ç†èŠ‚ç‚¹å¯¹åº”è™šæ‹ŸèŠ‚ç‚¹æ•° </span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> downNodes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å®•æœºèŠ‚ç‚¹è®°å½• </span>
 
    <span class="token keyword">public</span> <span class="token class-name">ConsistentHash</span><span class="token punctuation">(</span><span class="token keyword">int</span> virtualNodeCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>virtualNodeCount  <span class="token operator">=</span> virtualNodeCount<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">// å“ˆå¸Œç”Ÿæˆç®—æ³•ï¼ˆåŸºäºMD5ï¼‰</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">MessageDigest</span> md5 <span class="token operator">=</span> <span class="token class-name">MessageDigest</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"MD5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> digest <span class="token operator">=</span> md5<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>digest<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0</span>xFFL<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>digest<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0</span>xFFL<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span>
                    <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>digest<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0</span>xFFL<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>digest<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0</span>xFFL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"MD5 not supported"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">// æ·»åŠ ç‰©ç†èŠ‚ç‚¹ï¼ˆè‡ªåŠ¨åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹ï¼‰</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addNode</span><span class="token punctuation">(</span><span class="token class-name">String</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> virtualNodeCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> virtualNode <span class="token operator">=</span> node <span class="token operator">+</span> <span class="token string">"#VN"</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>
            <span class="token keyword">long</span> hash <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>virtualNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            virtualNodes<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span>  node<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">// ç§»é™¤æ•…éšœèŠ‚ç‚¹ï¼ˆè‡ªåŠ¨ç§»é™¤æ‰€æœ‰è™šæ‹ŸèŠ‚ç‚¹ï¼‰</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeNode</span><span class="token punctuation">(</span><span class="token class-name">String</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> it <span class="token operator">=</span> virtualNodes<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
            <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
                it<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        downNodes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è®°å½•å®•æœºèŠ‚ç‚¹ </span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">// è¯·æ±‚è·¯ç”±ï¼ˆå¸¦æ•…éšœè½¬ç§»æœºåˆ¶ï¼‰</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>virtualNodes<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"No available nodes"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">long</span> hash <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">=</span> virtualNodes<span class="token punctuation">.</span><span class="token function">ceilingEntry</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">if</span> <span class="token punctuation">(</span>entry <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ç¯çŠ¶å¤„ç†ï¼šè¿”å›ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ </span>
            entry <span class="token operator">=</span> virtualNodes<span class="token punctuation">.</span><span class="token function">firstEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
        
        <span class="token comment">// æ£€æŸ¥èŠ‚ç‚¹å¥åº·çŠ¶æ€ï¼ˆæ­¤å¤„ç®€åŒ–å®ç°ï¼‰</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>downNodes<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">findNextAvailableNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
 
    <span class="token comment">// æ•…éšœèŠ‚ç‚¹è‡ªåŠ¨è·³è¿‡é€»è¾‘ </span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">findNextAvailableNode</span><span class="token punctuation">(</span><span class="token keyword">long</span> hash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SortedMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tailMap <span class="token operator">=</span> virtualNodes<span class="token punctuation">.</span><span class="token function">tailMap</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> tailMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>downNodes<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
                <span class="token keyword">return</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> virtualNodes<span class="token punctuation">.</span><span class="token function">firstEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="CompletableFutureå’ŒFutureTaskæºç ç›¸å…³"><a href="#CompletableFutureå’ŒFutureTaskæºç ç›¸å…³" class="headerlink" title="CompletableFutureå’ŒFutureTaskæºç ç›¸å…³"></a>CompletableFutureå’ŒFutureTaskæºç ç›¸å…³</h2><p>çœ‹æˆ‘è‡ªå·±çš„æºç åˆ†æï¼Œè¿™é‡Œä¸»è¦è®°å½•è·å–ç»“æœçš„å®ç°æ–¹å¼</p>
<h3 id="FutureTask"><a href="#FutureTask" class="headerlink" title="FutureTask"></a>FutureTask</h3><p>ä½¿ç”¨volatile int stateæ ‡è¯†ä»»åŠ¡çŠ¶æ€(NEWã€COMPLETINGã€CANCELLED)ï¼Œé€šè¿‡AQSçš„å˜ç§æ¥å®ç°çº¿ç¨‹é˜»å¡å’Œå”¤é†’ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> s <span class="token operator">=</span> state<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">&lt;=</span> <span class="token constant">COMPLETING</span><span class="token punctuation">)</span> <span class="token comment">// æœªå®Œæˆæ—¶é˜»å¡ </span>
        s <span class="token operator">=</span> <span class="token function">awaitDone</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">report</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿”å›ç»“æœæˆ–å¼‚å¸¸ </span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>get()æ–¹æ³•ä¼šä½¿å¾—è°ƒç”¨çº¿ç¨‹è¢«æŒ‚èµ·ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆæˆ–è€…è¶…æ—¶æ‰è¿”å›ç»“æœã€‚</p>
<h3 id="CompletableFuture"><a href="#CompletableFuture" class="headerlink" title="CompletableFuture"></a>CompletableFuture</h3><p>ä½¿ç”¨æ— é”çš„CASæ“ä½œå’ŒåŸå­å˜é‡æ¥ç®¡ç†çŠ¶æ€ï¼Œæ¯ä¸ªé˜¶æ®µé€šè¿‡é“¾è¡¨ç»“æ„è®°å½•ä¾èµ–å…³ç³»ï¼Œé¿å…é”ç«äº‰ã€‚<br>æ”¯æŒå¼‚æ­¥å›è°ƒè·å¾—ç»“æœï¼Œé€šè¿‡æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œä»»åŠ¡å®Œæˆåè‡ªåŠ¨è§¦å‘å›è°ƒï¼Œä¸»çº¿ç¨‹æ— éœ€é˜»å¡ã€‚</p>
<ol>
<li>é“¾å¼è°ƒç”¨å®ä¹ åŸç†ï¼šå®ç°äº†CompletionStageæ¥å£ï¼Œè¿™ä¸ªæ¥å£å®šä¹‰äº†åˆ†é˜¶æ®µä»»åŠ¡ç¼–æ’çš„èƒ½åŠ›ï¼Œé€šè¿‡ä»»åŠ¡æ‰§è¡Œåè¿”å›ä¸€ä¸ªæ–°çš„CompletionStageå¯¹è±¡ï¼Œå½¢æˆé“¾å¼è°ƒç”¨<img src="/2025/03/11/28/%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8.png"></li>
<li>ä»»åŠ¡ä¾èµ–ç®¡ç†ï¼šæ¯ä¸ªé˜¶æ®µä»»åŠ¡é€šè¿‡æ ˆå­˜å‚¨ä¾èµ–å…³ç³»ã€‚å½“ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å®Œæˆæ—¶ï¼Œä¼šä»æ ˆé¡¶ä¾æ¬¡è§¦å‘åç»­çš„å›è°ƒä»»åŠ¡ï¼Œç¡®ä¿æ‰§è¡Œé¡ºåºå¯æ§<img src="/2025/03/11/28/%E5%9B%9E%E8%B0%83%E6%A0%88.png"><br>å›è°ƒèŠ‚ç‚¹Completionçš„è®¾è®¡ï¼Œé€šè¿‡ç»§æ‰¿ForkJoinTaskå¹¶å®ç°Runnableä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œèŠ‚ç‚¹ã€‚<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">abstract</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Completion</span> <span class="token keyword">extends</span> <span class="token class-name">ForkJoinTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> 
    <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">,</span> <span class="token class-name">AsynchronousCompletionTask</span> <span class="token punctuation">{</span>
    <span class="token keyword">volatile</span> <span class="token class-name">Completion</span> next<span class="token punctuation">;</span>  <span class="token comment">// æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ„æˆé“¾è¡¨ </span>
    <span class="token comment">// æ ¸å¿ƒæ–¹æ³•ï¼šè§¦å‘ä»»åŠ¡æ‰§è¡Œ </span>
    <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">tryFire</span><span class="token punctuation">(</span><span class="token keyword">int</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
æ“ä½œå‹æ ˆï¼š<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">uniApplyStage</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">uniApplyStage</span><span class="token punctuation">(</span>
    <span class="token class-name">Executor</span> e<span class="token punctuation">,</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>d<span class="token punctuation">.</span><span class="token function">uniApply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>  f<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UniApply</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UniApply</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> d<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">push</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å‹æ ˆæ“ä½œ </span>
        c<span class="token punctuation">.</span><span class="token function">tryFire</span><span class="token punctuation">(</span><span class="token constant">SYNC</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> d<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token comment">// å‹æ ˆé€»è¾‘ï¼ˆé€šè¿‡ CAS æ“ä½œä¿è¯çº¿ç¨‹å®‰å…¨ï¼‰</span>
<span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Completion</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">tryPushStack</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
å›è°ƒè§¦å‘ï¼šå½“è°ƒç”¨complete()æˆ–è€…è¿”å›ç»“æœæ—¶ï¼Œä¼šéå†æ ˆä¸­çš„CompletionèŠ‚ç‚¹å¹¶ä¸”è§¦å‘åç»­çš„æ“ä½œã€‚<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">postComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> f <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token class-name">Completion</span> h<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>h <span class="token operator">=</span> f<span class="token punctuation">.</span>stack<span class="token punctuation">)</span>  <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> d<span class="token punctuation">;</span> <span class="token class-name">Completion</span> t<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">casStack</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span>  t <span class="token operator">=</span> h<span class="token punctuation">.</span>next<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>  <span class="token comment">// å‡ºæ ˆæ“ä½œ </span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">pushStack</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                h<span class="token punctuation">.</span>next  <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token comment">// æ–­å¼€é“¾è¡¨ </span>
            <span class="token punctuation">}</span>
            f <span class="token operator">=</span> <span class="token punctuation">(</span>d <span class="token operator">=</span> h<span class="token punctuation">.</span><span class="token function">tryFire</span><span class="token punctuation">(</span><span class="token constant">NESTED</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">this</span> <span class="token operator">:</span> d<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h2 id="æœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä»€ä¹ˆ"><a href="#æœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä»€ä¹ˆ" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä»€ä¹ˆ"></a>æœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä»€ä¹ˆ</h2><p>æœ¬åœ°æ–¹æ³•æ ˆæ˜¯JVMå†…å­˜ç»“æ„çš„ä¸€éƒ¨åˆ†ï¼Œä¸“é—¨ç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨å’Œæ‰§è¡Œï¼Œæ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹æ‹¥æœ‰å±äºè‡ªå·±çš„æœ¬åœ°æ–¹æ³•æ ˆï¼Œç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ç»‘å®šã€‚</p>
<h2 id="æœ¬åœ°æ–¹æ³•åœ¨æœ¬åœ°æ–¹æ³•æ ˆä¸­çš„å­˜å‚¨æ–¹å¼æ˜¯ä»€ä¹ˆ"><a href="#æœ¬åœ°æ–¹æ³•åœ¨æœ¬åœ°æ–¹æ³•æ ˆä¸­çš„å­˜å‚¨æ–¹å¼æ˜¯ä»€ä¹ˆ" class="headerlink" title="æœ¬åœ°æ–¹æ³•åœ¨æœ¬åœ°æ–¹æ³•æ ˆä¸­çš„å­˜å‚¨æ–¹å¼æ˜¯ä»€ä¹ˆ"></a>æœ¬åœ°æ–¹æ³•åœ¨æœ¬åœ°æ–¹æ³•æ ˆä¸­çš„å­˜å‚¨æ–¹å¼æ˜¯ä»€ä¹ˆ</h2><p>æ ˆå¸§ç»“æ„ï¼š<br>æœ¬åœ°æ–¹æ³•è°ƒç”¨æ—¶ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¼šä¸ºè¯¥æ–¹æ³•åˆ†é…ä¸€ä¸ªæˆ˜é˜µï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<ol>
<li>å±€éƒ¨å˜é‡è¡¨ï¼šå­˜å‚¨æ–¹æ³•çš„å‚æ•°å’Œå±€éƒ¨å˜é‡</li>
<li>æ“ä½œæ•°æ ˆï¼šç”¨äºæ‰§è¡Œæœ¬åœ°æ–¹æ³•çš„æŒ‡ä»¤æ“ä½œ</li>
<li>åŠ¨æ€è¿æ¥ï¼šæŒ‡å‘æ–¹æ³•æ‰€å±ç±»çš„è¿è¡Œæ—¶å¸¸é‡æ± å¼•ç”¨</li>
<li>æ–¹æ³•å‡ºå£ï¼šè®°å½•æ–¹æ³•æ‰§è¡Œå®Œæˆåçš„è¿”å›åœ°å€ã€‚<br>æœ¬åœ°æ–¹æ³•çš„å®é™…æ‰§è¡Œç”±æ“ä½œç³»ç»Ÿå®Œï¼ŒJVMä»…é€šè¿‡æœ¬åœ°æ–¹æ³•æ ˆç®¡ç†å…¶è°ƒç”¨çŠ¶æ€ï¼Œè°ƒç”¨æœ¬åœ°æ–¹æ³•æ—¶ï¼ŒJVMä¸ä¼šåœ¨Javaè™šæ‹Ÿæœºä¸­åˆ›å»ºæ ˆå¸§è€Œæ˜¯ç›´æ¥æ“ä½œæœ¬åœ°æ–¹æ³•æ ˆã€‚</li>
</ol>
<h2 id="ä»€ä¹ˆæ˜¯æ–¹æ³•å†…è”"><a href="#ä»€ä¹ˆæ˜¯æ–¹æ³•å†…è”" class="headerlink" title="ä»€ä¹ˆæ˜¯æ–¹æ³•å†…è”"></a>ä»€ä¹ˆæ˜¯æ–¹æ³•å†…è”</h2><p>æ–¹æ³•å†…è”æ˜¯JVMçš„ç¼–è¯‘å™¨ä¼˜åŒ–æŠ€æœ¯ï¼Œå°†æ–¹æ³•è°ƒç”¨æ›¿æ¢æˆæ–¹æ³•ä½“çš„å®é™…ä»£ç ï¼Œä»¥å‡å°‘å‡½æ•°è°ƒç”¨çš„å¼€é”€(æ ˆå¸§åˆ›å»ºã€ä¸Šä¸‹æ–‡åˆ‡æ¢)<br>åŸç†ï¼š<br>å½“æŸä¸ªæ–¹æ³•(å¦‚çŸ­å°çš„Getter/Setter)è¢«é¢‘ç¹è°ƒç”¨æ—¶ï¼ŒJITç¼–è¯‘å™¨ä¼šå°†å…¶ä»£ç ç›´æ¥åµŒå…¥è°ƒç”¨å‡ºï¼Œé¿å…è·³è½¬å¼€é”€ã€‚</p>
<h2 id="æœ¬åœ°æ–¹æ³•å¯ä»¥å†…è”å—"><a href="#æœ¬åœ°æ–¹æ³•å¯ä»¥å†…è”å—" class="headerlink" title="æœ¬åœ°æ–¹æ³•å¯ä»¥å†…è”å—"></a>æœ¬åœ°æ–¹æ³•å¯ä»¥å†…è”å—</h2><p>æœ¬åœ°æ–¹æ³•é€šå¸¸ä¸èƒ½å¤Ÿå†…è”ï¼Œå› ä¸ºå…¶å®ç°åœ¨JVMå¤–éƒ¨ï¼Œç¼–è¯‘å™¨æ— æ³•è®¿é—®å…¶ä»£ç é€»è¾‘<br>å†…è”ä¼˜åŒ–ä¸»è¦é’ˆå¯¹Javaæ–¹æ³•ï¼Œæœ¬åœ°æ–¹æ³•éœ€è¦é€šè¿‡JNIæ¥å£è°ƒç”¨ï¼Œå­˜åœ¨é¢å¤–æ€§èƒ½æŸå¤±ã€‚</p>
<h1 id="2025-3-13-hré¢-åªé¢äº†ååˆ†é’Ÿï¼Œæ„Ÿè§‰è¦ç‹ ç‹ æ’åºäº†ï¼Œå”‰ï¼Œåªèƒ½ç­‰å¾…äº†"><a href="#2025-3-13-hré¢-åªé¢äº†ååˆ†é’Ÿï¼Œæ„Ÿè§‰è¦ç‹ ç‹ æ’åºäº†ï¼Œå”‰ï¼Œåªèƒ½ç­‰å¾…äº†" class="headerlink" title="2025.3.13 hré¢(åªé¢äº†ååˆ†é’Ÿï¼Œæ„Ÿè§‰è¦ç‹ ç‹ æ’åºäº†ï¼Œå”‰ï¼Œåªèƒ½ç­‰å¾…äº†)"></a>2025.3.13 hré¢(åªé¢äº†ååˆ†é’Ÿï¼Œæ„Ÿè§‰è¦ç‹ ç‹ æ’åºäº†ï¼Œå”‰ï¼Œåªèƒ½ç­‰å¾…äº†)</h1><ol>
<li>è‡ªæˆ‘ä»‹ç»</li>
<li>åç»­çš„å®ä¹ æ—¶é—´è§„åˆ’å’Œè¯‰æ±‚å¤§æ¦‚æ€ä¹ˆæ ·</li>
<li>ä¸ºä»€ä¹ˆä¸åœ¨ç¾çš„æ¥ç€å®ä¹ äº†</li>
<li>èŠä¸€èŠå·¥ä½œå†…å®¹ï¼Œæœ‰å“ªäº›éš¾ç‚¹</li>
<li>å®ä¹ çš„æ”¶è·ç‚¹ã€å¯¹ä¸ªäººæå‡çš„åœ°æ–¹</li>
<li>æ€ä¹ˆä¸ä¸šåŠ¡æ–¹è¿›è¡Œåˆä½œå’Œäº¤æµ</li>
<li>è·Ÿäº§å“ã€æµ‹è¯•æ²Ÿé€šçš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†å“ªäº›éš¾ç‚¹ï¼Œå¦‚ä½•è§£å†³çš„</li>
<li>å¯¹ç¾çš„çš„ä¼ä¸šæ–‡åŒ–æ„Ÿè§‰æ€ä¹ˆæ ·</li>
<li>ä»»åŠ¡é‡ä¸€å¤©ä¼šæœ‰å¤šå°‘ï¼Œä¸Šä¸‹ç­çš„æ—¶é—´å¦‚ä½•å‘¢</li>
<li>ä¸æ‰“ç®—è¯»ç ”å—</li>
<li>åé—®ï¼šè¿˜ä¼šæœ‰é¢è¯•å—ï¼Œå‡ºç»“æœçš„æ—¶é—´(å¿«çš„è¯ä¸‹å‘¨ä¸€å§)</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zuofw.github.io/2025/02/27/50/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QingQiu">
      <meta itemprop="description" content="ä¸ªäººç½‘ç«™ï¼Œå­¦ä¹ è®°å½•ï¼Œé¢è¯•è®°å½•å’Œç»éªŒæ€»ç»“ã€äº’è”ç½‘ä¸­ä¸€å—å±äºè‡ªå·±çš„å°çª">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QingQiu'Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/27/50/" class="post-title-link" itemprop="url">è´§æ‹‰æ‹‰-javaå®ä¹ ç”Ÿ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-02-27 14:08:50" itemprop="dateCreated datePublished" datetime="2025-02-27T14:08:50+08:00">2025-02-27</time>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>1.3k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="2025-02-27-ä¸€é¢-28å·ä¸‹åˆçº¦äºŒé¢"><a href="#2025-02-27-ä¸€é¢-28å·ä¸‹åˆçº¦äºŒé¢" class="headerlink" title="2025.02.27 ä¸€é¢ 28å·ä¸‹åˆçº¦äºŒé¢"></a>2025.02.27 ä¸€é¢ 28å·ä¸‹åˆçº¦äºŒé¢</h1><ol>
<li>æˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡çš„åŒºåˆ«ã€ç”Ÿå­˜æ—¶é—´</li>
<li>é™æ€æ–¹æ³•ä¸ºä»€ä¹ˆä¸èƒ½è°ƒç”¨éé™æ€æ–¹æ³•ï¼Œéé™æ€æ–¹æ³•å’Œé™æ€æ–¹æ³•ç”Ÿæˆçš„æ—¶æœº</li>
<li>æµ®ç‚¹æ•°è¿ç®—å­˜åœ¨ç²¾åº¦ä¸¢å¤±å¦‚ä½•è§£å†³</li>
<li>é›†åˆæœ‰å“ªäº›å®ç°</li>
<li>ArrayListå’ŒLinkedListä»ä¸­é—´æ’å…¥æ˜¯å¦‚ä½•æ“ä½œçš„</li>
<li>çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</li>
<li>å•æ ¸CPUæ˜¯å¦‚ä½•ä½¿å¾—ä¸¤ä¸ªåº”ç”¨å¥½åƒåœ¨åŒæ—¶è¿›è¡Œçš„</li>
<li>CASå’ŒAQSçš„åŒºåˆ«å’Œè¯¦ç»†ä»‹ç»</li>
<li>ä»»åŠ¡æ˜¯å¦‚ä½•åœ¨AQSä¸­è¿›è¡Œæ’é˜Ÿçš„</li>
<li>å¤šä¸ªçº¿ç¨‹æ˜¯æ ¹æ®ä»€ä¹ˆåŸç†å»ç­‰å¾…èµ„æºçš„è·å¾—</li>
<li>synchronizedå’ŒreentrantlockåŒºåˆ«</li>
<li>threadpoolexecutoræœ‰å“ªäº›æ ¸å¿ƒå‚æ•°(çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°)</li>
<li>äº‹åŠ¡éš”ç¦»çº§åˆ«</li>
<li>å¹»è¯»æ˜¯å¦‚ä½•äº§ç”Ÿçš„</li>
<li>ä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘è€Œä¸æ˜¯ä½¿ç”¨äºŒå‰æœç´¢æ ‘æˆ–è€…Bæ ‘</li>
<li>B+æ ‘å’ŒBæ ‘çš„åŒºåˆ«</li>
<li>ä¸»é”®ç´¢å¼•å’Œæ™®é€šç´¢å¼•çš„åŒºåˆ«</li>
<li>è”åˆç´¢å¼•(a,b,c)å¦‚æœç°åœ¨æ¡ä»¶åªæœ‰b,cä¼šèµ°ç´¢å¼•å—</li>
<li>MySQLçš„ä¸»ä»åŒæ­¥çš„åŸç†</li>
<li>binlogæ˜¯å¦‚ä½•è¿›è¡Œæ•°æ®æ¢å¤çš„</li>
<li>mysqlä¸‰ç§logçš„åŒºåˆ«å’Œç”¨å¤„</li>
<li>rediså¸¸ç”¨ç±»å‹</li>
<li>è®¾è®¡æ’è¡Œæ¦œä½¿ç”¨ä»€ä¹ˆredisæ•°æ®ç±»å‹</li>
<li>å¦‚æœæ¯ä¸ªæ–‡ç« çš„idæ˜¯é€’å¢çš„ï¼Œå¦‚æœæœ‰äººç›´æ¥è¿ç»­å‘é€1wæ¡ï¼Œå¦‚ä½•é˜²èŒƒä»–</li>
<li>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨è€Œä¸æ˜¯ç›´æ¥hashï¼Œå¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†</li>
<li>redisæŒä¹…åŒ–</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—çš„å¹‚ç­‰æ€§å’Œæ¶ˆæ¯é¡ºåºæ€§(æ”¾åœ¨åŒä¸€ä¸ªåˆ†åŒº)(é¢è¯•å®˜è¯´æ¶ˆè´¹è€…ä¸ºäº†ä¿è¯é¡ºåºæ¶ˆè´¹ï¼Œåªèƒ½å•çº¿ç¨‹å»æ¶ˆè´¹)</li>
<li>10å¼ è¡¨ï¼Œå­—æ®µç›¸åŒï¼Œæ¯ä¸€å¼ 1000wæ¡æ•°æ®ï¼Œæœ‰ç´¢å¼•ï¼Œå¦‚ä½•å¿«é€ŸæŸ¥å‡ºå‰100çš„è®°å½•</li>
<li>åé—®ï¼šä¸šåŠ¡ï¼Œå‡ºè¡Œæ–¹é¢ã€è´Ÿè´£å¸æœºç«¯çš„æ¥å•å’Œå±¥çº¦å’Œæ”¶æ¬¾ï¼Œè¡¨ç°ï¼šç­”å¾—æŒºå¥½çš„ï¼Œæ²¡å•¥çº°æ¼ï¼Œè¡¨è¾¾ä¹Ÿæ¯”è¾ƒæ¸…æ™°ï¼ŒæŒ‘ä¸å‡ºä»€ä¹ˆé—®é¢˜</li>
</ol>
<h2 id="åœºæ™¯é¢˜"><a href="#åœºæ™¯é¢˜" class="headerlink" title="åœºæ™¯é¢˜"></a>åœºæ™¯é¢˜</h2><h3 id="10å¼ è¡¨ï¼Œå­—æ®µç›¸åŒï¼Œæ¯ä¸€å¼ 1000wæ¡æ•°æ®ï¼Œæœ‰ç´¢å¼•ï¼Œå¦‚ä½•å¿«é€ŸæŸ¥å‡ºå‰100çš„è®°å½•"><a href="#10å¼ è¡¨ï¼Œå­—æ®µç›¸åŒï¼Œæ¯ä¸€å¼ 1000wæ¡æ•°æ®ï¼Œæœ‰ç´¢å¼•ï¼Œå¦‚ä½•å¿«é€ŸæŸ¥å‡ºå‰100çš„è®°å½•" class="headerlink" title="10å¼ è¡¨ï¼Œå­—æ®µç›¸åŒï¼Œæ¯ä¸€å¼ 1000wæ¡æ•°æ®ï¼Œæœ‰ç´¢å¼•ï¼Œå¦‚ä½•å¿«é€ŸæŸ¥å‡ºå‰100çš„è®°å½•"></a>10å¼ è¡¨ï¼Œå­—æ®µç›¸åŒï¼Œæ¯ä¸€å¼ 1000wæ¡æ•°æ®ï¼Œæœ‰ç´¢å¼•ï¼Œå¦‚ä½•å¿«é€ŸæŸ¥å‡ºå‰100çš„è®°å½•</h3><p>åŸºäºç´¢å¼•å¿«é€Ÿåˆ†æ‰¹æŸ¥è¯¢ï¼š</p>
<ol>
<li>å¯¹äºæ¯å¼ è¡¨ï¼Œåˆ©ç”¨ç´¢å¼•å¿«é€Ÿè·å–è¯¥è¡¨çš„å‰100ä¸ªæœ€å¤§å€¼ã€‚å¦‚æœç´¢å¼•å­˜åœ¨ï¼Œé‚£ä¹ˆåªéœ€è¦æ‰«æå‰100è¡Œã€‚</li>
<li>åˆå¹¶ç»“æœï¼Œå°†ç»“æœæ”¾åœ¨ä¸€å¼ ä¸´æ—¶è¡¨ä¸­</li>
<li>å…¨å±€ç­›é€‰å‡ºå‰100ä¸ªæœ€å¤§å€¼<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> index_key <span class="token keyword">FROM</span> tableX <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> index_key <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLE</span> temp_results <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> index_key <span class="token keyword">FROM</span> table1 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> index_key <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> index_key <span class="token keyword">FROM</span> table2 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> index_key <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span> <span class="token comment">-- é‡å¤è‡³table10</span>

<span class="token keyword">SELECT</span> index_key <span class="token keyword">FROM</span> temp_results <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> index_key <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">100</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h1 id="2025-3-3-äºŒé¢-é¢è¯•å®˜å¾ˆå¥½ï¼Œä½†æ˜¯å¾ˆå¯æƒœï¼Œæˆ‘çš„å®ä¹ ç»å†è¿˜æ˜¯å¤ªå¹³æ·¡äº†"><a href="#2025-3-3-äºŒé¢-é¢è¯•å®˜å¾ˆå¥½ï¼Œä½†æ˜¯å¾ˆå¯æƒœï¼Œæˆ‘çš„å®ä¹ ç»å†è¿˜æ˜¯å¤ªå¹³æ·¡äº†" class="headerlink" title="2025.3.3 äºŒé¢(é¢è¯•å®˜å¾ˆå¥½ï¼Œä½†æ˜¯å¾ˆå¯æƒœï¼Œæˆ‘çš„å®ä¹ ç»å†è¿˜æ˜¯å¤ªå¹³æ·¡äº†)"></a>2025.3.3 äºŒé¢(é¢è¯•å®˜å¾ˆå¥½ï¼Œä½†æ˜¯å¾ˆå¯æƒœï¼Œæˆ‘çš„å®ä¹ ç»å†è¿˜æ˜¯å¤ªå¹³æ·¡äº†)</h1><ol>
<li>è‡ªæˆ‘ä»‹ç»</li>
<li>ä»‹ç»æ²¡æœ‰è½¬æ­£æœºä¼šã€å¦‚æœé€šè¿‡çš„è¯ï¼Œå…¥èŒæ—¶é—´å’Œå®ä¹ åœ°ç‚¹</li>
<li>ä»‹ç»å®ä¹ é¡¹ç›®(æˆ‘çœŸçš„å”‰ï¼Œæˆ‘ä¹Ÿæƒ³å†™tocå•Šï¼ŒçœŸçš„å¥½æƒ³æŠŠç¾çš„çš„å®ä¹ åˆ æ‰å•Š)</li>
<li>ä¸ºä»€ä¹ˆä½¿ç”¨çº¿ç¨‹æ± </li>
<li>å¦‚ä½•ä¼˜åŒ–çš„sqlï¼Œè·¨äº†å‡ ä¸ªè¡¨ã€æ¯ä¸ªè¡¨çš„åˆ—æ•°å’Œå¤§å°</li>
<li>æ¯”è¾ƒæœ‰æŒ‘æˆ˜æ€§ã€æ”¶è·æ¯”è¾ƒå¤§çš„</li>
<li>æ‹·é—®ç¬¬ä¸€æ®µå°å‚çš„ä¸šåŠ¡</li>
<li>ä¸ªäººé¡¹ç›®è§‰å¾—æ²¡å•¥æ„æ€ï¼Œç›´æ¥ä¸é—®äº†</li>
<li>åé—®ï¼šä¸šåŠ¡ï¼Œå°æ‹‰å‡ºè¡Œï¼Œtocä¸šåŠ¡(å¥½æƒ³å»ï¼Œå¯æƒœäº†)ï¼Œå¸æœºç«¯ï¼Œé¢è¯•è¯„ä»·ï¼šé¡¹ç›®ç»å†ä¸ç”¨å†™äº†ï¼Œå†™å®ä¹ ç»å†ï¼Œå¯ä»¥å°†ç»ƒæ‰‹é¡¹ç›®çš„ç‰¹ç‚¹å†™åˆ°å®ä¹ ä¸­</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zuofw.github.io/2025/02/19/24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QingQiu">
      <meta itemprop="description" content="ä¸ªäººç½‘ç«™ï¼Œå­¦ä¹ è®°å½•ï¼Œé¢è¯•è®°å½•å’Œç»éªŒæ€»ç»“ã€äº’è”ç½‘ä¸­ä¸€å—å±äºè‡ªå·±çš„å°çª">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QingQiu'Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/19/24/" class="post-title-link" itemprop="url">æœªå‘½å</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-02-19 23:03:24" itemprop="dateCreated datePublished" datetime="2025-02-19T23:03:24+08:00">2025-02-19</time>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>60</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>è¿™æ˜¯ä½ çš„æ–°<em>ä»“åº“</em>ã€‚</p>
<p>å†™ç‚¹ç¬”è®°ï¼Œ[[åˆ›å»ºé“¾æ¥]]ï¼Œæˆ–è€…è¯•ä¸€è¯•<a target="_blank" rel="noopener" href="https://help.obsidian.md/Plugins/Importer">å¯¼å…¥å™¨</a>æ’ä»¶!</p>
<p>å½“ä½ å‡†å¤‡å¥½äº†ï¼Œå°±å°†è¯¥ç¬”è®°æ–‡ä»¶åˆ é™¤ï¼Œä½¿è¿™ä¸ªä»“åº“ä¸ºä½ æ‰€ç”¨ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zuofw.github.io/2025/02/17/38/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QingQiu">
      <meta itemprop="description" content="ä¸ªäººç½‘ç«™ï¼Œå­¦ä¹ è®°å½•ï¼Œé¢è¯•è®°å½•å’Œç»éªŒæ€»ç»“ã€äº’è”ç½‘ä¸­ä¸€å—å±äºè‡ªå·±çš„å°çª">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QingQiu'Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/17/38/" class="post-title-link" itemprop="url">ğŸ“ºbåç«¯å®ä¹ é¢ç»(é¡¹ç›®æ‹·æ‰“ï¼Œé‡ç‚¹çœ‹)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-02-17 17:36:38" itemprop="dateCreated datePublished" datetime="2025-02-17T17:36:38+08:00">2025-02-17</time>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>3.8k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>å‰è¨€ï¼šæˆ‘çš„ç®—æ³•å°±æ˜¯å±ï¼Œèµ¶ç‚¹æƒ³æƒ³åŠæ³•å§</p>
<h1 id="2025-02-17-bç«™ä¸€é¢-é¡¹ç›®å’Œå®ä¹ æ‹·æ‰“ï¼Œç¬¬äºŒå¤©æ™šä¸Šoc"><a href="#2025-02-17-bç«™ä¸€é¢-é¡¹ç›®å’Œå®ä¹ æ‹·æ‰“ï¼Œç¬¬äºŒå¤©æ™šä¸Šoc" class="headerlink" title="2025.02.17 bç«™ä¸€é¢(é¡¹ç›®å’Œå®ä¹ æ‹·æ‰“ï¼Œç¬¬äºŒå¤©æ™šä¸Šoc)"></a>2025.02.17 bç«™ä¸€é¢(é¡¹ç›®å’Œå®ä¹ æ‹·æ‰“ï¼Œç¬¬äºŒå¤©æ™šä¸Šoc)</h1><p>æ‹·æ‰“é¡¹ç›®</p>
<ol>
<li>æ•°æ®åŒæ­¥çš„è€—æ—¶æœ‰æ²¡æœ‰è¦æ±‚ï¼Ÿ</li>
<li>ä»€ä¹ˆåœºæ™¯éœ€è¦éœ€è¦ç™¾ä¸‡æ•°æ®ï¼Ÿ ä»ä¸Šæµæ•°æ®åº“æ‰¹å¤„ç†å·¥å…·</li>
<li>æ•°æ®çš„ä¸€è‡´æ€§ã€æ•°æ®çš„ç¨³å®šæ€§ã€ç³»ç»Ÿçš„ç¨³å®šæ€§ã€æ•ˆç‡éƒ½æ˜¯å¦‚ä½•è€ƒè™‘çš„ï¼Ÿä¼šä¸ä¼šæœ‰ä¸¢çš„æƒ…å†µï¼Œä¸¢çš„è¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ(å¥½éš¾)</li>
<li>Redisé”å¦‚æœè¶…æ—¶äº†ï¼Œæœ‰æ²¡æœ‰è‡ªåŠ¨é‡Šæ”¾æœºåˆ¶(æ³¨æ„ï¼Œä¸èƒ½å‰¥å¤ºï¼Œä¸è¦è¯´å¼ºè¡Œå‰¥å¤ºï¼Œå› ä¸ºä¸åˆå¸¸ç†)</li>
<li>SQLæŸ¥è¯¢æ˜¯å¦‚ä½•åšåˆ°çš„ï¼Ÿå•è¡¨è¿˜æ˜¯å¤šè¡¨ï¼Ÿæ•°æ®é‡ï¼Ÿå¤§æ¦‚æœ‰å¤šå°‘åˆ—ï¼Ÿ</li>
<li>B+æ ‘çš„ç»“æ„ã€èŠ‚ç‚¹æ˜¯æ€ä¹ˆç»„ç»‡çš„ï¼Œå­˜çš„æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆæ•ˆç‡æ¯”è¾ƒé«˜ï¼Ÿå’ŒBæ ‘çš„åŒºåˆ«ï¼Ÿ</li>
<li>B+æ ‘ä¸€ä¸ªæ•°æ®é¡µå¦‚æœæ»¡äº†ï¼Œä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</li>
<li>æœ‰æ²¡æœ‰ç”¨è¿‡NoSQLå‹æ•°æ®åº“ï¼Ÿtidbæœ‰äº†è§£è¿‡å—ï¼Ÿ</li>
<li>æœ‰æ²¡æœ‰åˆ†è¡¨åˆ†åº“ï¼Ÿä½¿ç”¨äº†ä»€ä¹ˆä¸­é—´ä»¶ï¼Ÿ</li>
<li>é¡¹ç›®çš„çµæ„Ÿæ¥æºï¼Ÿä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªé¡¹ç›®ï¼Ÿä¸ºä»€ä¹ˆwebsocketçš„é€šä¿¡ä¼šæ¯”è¾ƒæ…¢ï¼Ÿ</li>
<li>rpcï¼šè´Ÿè½½å‡è¡¡ã€è½®è¯¢ã€ä¸€è‡´æ€§å“ˆå¸Œå¦‚ä½•å®ç°çš„</li>
<li>ä¸€è‡´æ€§å“ˆå¸Œæ•°æ®è¿ç§»çš„è¿‡ç¨‹æ˜¯å¦‚ä½•çš„ï¼Ÿ</li>
<li>è‡ªå®šä¹‰é€šä¿¡åè®®æ˜¯æ€ä¹ˆåšçš„ï¼Ÿå’Œä¼ ç»Ÿçš„é€šä¿¡åè®®æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li>
<li>TCPä¸ºä»€ä¹ˆä¸‰æ¬¡æ¡æ‰‹è€Œä¸æ˜¯å››æ¬¡æ¡æ‰‹ï¼Ÿ</li>
<li>TCPæ¯æ¬¡è¿æ¥æ—¶åºåˆ—å·éƒ½ä¸€æ ·å—ï¼Ÿä¸ºä»€ä¹ˆä¸ä¸€æ ·ï¼Œæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</li>
<li>time_waitä¸ºä»€ä¹ˆæ˜¯2MSLï¼ŸMSLæ˜¯ä»€ä¹ˆï¼Ÿ(æŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´)</li>
<li>TCPæ»‘åŠ¨çª—å£çš„ç®—æ³•ï¼Ÿ(ä¸ä¼šï¼Œæˆ‘æ¢æˆæ‹¥å¡æ§åˆ¶ç®—æ³•äº†ï¼Œæ‹¥å¡æ§åˆ¶ç®—æ³•ä¹Ÿè¦çœ‹ä¸€çœ‹)</li>
<li>ç®€å•ä»‹ç»ä¸€ä¸‹é™æµç®—æ³•ï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆè¦åšZClubï¼Ÿå‚è€ƒäº†å°çº¢ä¹¦å“ªäº›æ¨¡å—ï¼Ÿ(è·Ÿä¸Šè®¾è®¡æ€è·¯)</li>
<li>åˆ†ç‰‡ä¸Šä¼ æ˜¯æ€ä¹ˆæƒ³åˆ°çš„ï¼Ÿæ€ä¹ˆè®¾è®¡çš„ï¼Ÿ</li>
<li>æ–­ç‚¹é‡ä¼ æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ</li>
<li>ç§’ä¼ æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿï¼ˆæœ‰ç‚¹æ‰¯æ·¡çš„è®¾è®¡)</li>
<li>Nettyç›¸å…³ï¼Ÿé›¶æ‹·è´æŠ€æœ¯ä»‹ç»ä¸€ä¸‹ï¼Ÿ</li>
<li>å¤šè·¯å¤ç”¨ï¼Ÿselectã€pollã€epollä»‹ç»ä¸€äº›</li>
<li>æ‰‹æ’•é‡æ’é“¾è¡¨</li>
<li>åé—®ï¼šè¡¨ç°å¦‚ä½•(å‰é¢è¿˜å¯ä»¥ï¼ŒåŸºç¡€æ‰å®ï¼Œä½†æ˜¯ç®—æ³•æœ‰ç‚¹å¯æƒœï¼Œè¦åŠ å¼ºä¸€ä¸‹ï¼Œé¡¹ç›®ä¹Ÿè¿˜å¯ä»¥ï¼Œç»“æœä¼šåœ¨ä¸€å‘¨å†…ç»™å‡º)</li>
</ol>
<h2 id="æ•°æ®çš„ä¸€è‡´æ€§ã€æ•°æ®çš„ç¨³å®šæ€§ã€ç³»ç»Ÿçš„ç¨³å®šæ€§ã€æ•ˆç‡éƒ½æ˜¯å¦‚ä½•è€ƒè™‘çš„ï¼Ÿä¼šä¸ä¼šæœ‰ä¸¢çš„æƒ…å†µï¼Œä¸¢çš„è¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ"><a href="#æ•°æ®çš„ä¸€è‡´æ€§ã€æ•°æ®çš„ç¨³å®šæ€§ã€ç³»ç»Ÿçš„ç¨³å®šæ€§ã€æ•ˆç‡éƒ½æ˜¯å¦‚ä½•è€ƒè™‘çš„ï¼Ÿä¼šä¸ä¼šæœ‰ä¸¢çš„æƒ…å†µï¼Œä¸¢çš„è¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ" class="headerlink" title="æ•°æ®çš„ä¸€è‡´æ€§ã€æ•°æ®çš„ç¨³å®šæ€§ã€ç³»ç»Ÿçš„ç¨³å®šæ€§ã€æ•ˆç‡éƒ½æ˜¯å¦‚ä½•è€ƒè™‘çš„ï¼Ÿä¼šä¸ä¼šæœ‰ä¸¢çš„æƒ…å†µï¼Œä¸¢çš„è¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ"></a>æ•°æ®çš„ä¸€è‡´æ€§ã€æ•°æ®çš„ç¨³å®šæ€§ã€ç³»ç»Ÿçš„ç¨³å®šæ€§ã€æ•ˆç‡éƒ½æ˜¯å¦‚ä½•è€ƒè™‘çš„ï¼Ÿä¼šä¸ä¼šæœ‰ä¸¢çš„æƒ…å†µï¼Œä¸¢çš„è¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ</h2><ol>
<li>ä½¿ç”¨äº‹åŠ¡ï¼Œä¿è¯æ•°æ®çš„ç»„è£…ã€æ ¡éªŒã€å¯¼å…¥ç­‰æ“ä½œçš„åŸå­æ€§ï¼Œå¦‚æœä¸­é—´ç¯èŠ‚å¤±è´¥ï¼Œè‡ªåŠ¨å›æ»šã€‚</li>
<li>å¢é‡æ›´æ–°ä½¿ç”¨æ—¥æœŸï¼Œä»¥æ—¥ä¸ºå•ä½è¿›è¡Œæ›´æ–°ï¼Œé˜²æ­¢é‡å¤æ›´æ–°</li>
<li>åŒæ—¶å¯¹äºåŒä¸€ä¸šåŠ¡å®ä½“çš„æ•°æ®ï¼Œé€šè¿‡RocketMQé¡ºåºæ¶ˆæ¯å‘é€ï¼Œç¡®ä¿æ¶ˆè´¹è€…æŒ‰ç…§é¡ºåºå¤„ç†ï¼Œé¿å…å¹¶å‘å¯¼è‡´çš„è„æ•°æ®ã€‚</li>
<li>å¯¹äºå¼‚å¸¸æƒ…å†µï¼Œè®°å½•æ—¥å¿—ï¼Œè¿›è¡Œè¡¥å¿ã€‚RocketMQå¼€å¯æ‰‹åŠ¨ACKæ¨¡å¼ï¼Œä»…åœ¨æ•°æ®æˆåŠŸè½åº“ä¹‹åæäº¤Offsetï¼Œå¤šæ¬¡é‡è¯•ä¹‹åè½¬å­˜åˆ°æ­»ä¿¡é˜Ÿåˆ—äººå·¥ä»‹å…¥ã€‚</li>
</ol>
<h2 id="ç³»ç»Ÿç¨³å®šæ€§å¦‚ä½•ä¿è¯çš„"><a href="#ç³»ç»Ÿç¨³å®šæ€§å¦‚ä½•ä¿è¯çš„" class="headerlink" title="ç³»ç»Ÿç¨³å®šæ€§å¦‚ä½•ä¿è¯çš„"></a>ç³»ç»Ÿç¨³å®šæ€§å¦‚ä½•ä¿è¯çš„</h2><p>ä½¿ç”¨Redisè®°å½•æœ€åå¤„ç†çš„æ‰¹æ¬¡IDï¼Œæ•…éšœåä»æ–­ç‚¹å¤„ç†</p>
<h2 id="æ•ˆç‡ä¸Šå¦‚ä½•ä¼˜åŒ–çš„"><a href="#æ•ˆç‡ä¸Šå¦‚ä½•ä¼˜åŒ–çš„" class="headerlink" title="æ•ˆç‡ä¸Šå¦‚ä½•ä¼˜åŒ–çš„"></a>æ•ˆç‡ä¸Šå¦‚ä½•ä¼˜åŒ–çš„</h2><p>ä½¿ç”¨CFå¯¹å¤šæ•°æ®æºè¿›è¡Œæ‹‰å–ï¼Œå¼‚æ­¥å¹¶è¡Œå¤„ç†</p>
<h2 id="Redisåˆ†å¸ƒå¼-é”å¦‚ä½•å®ç°çš„ï¼Œæœ‰æ²¡æœ‰å…œåº•ç­–ç•¥å•¥çš„ï¼Ÿ"><a href="#Redisåˆ†å¸ƒå¼-é”å¦‚ä½•å®ç°çš„ï¼Œæœ‰æ²¡æœ‰å…œåº•ç­–ç•¥å•¥çš„ï¼Ÿ" class="headerlink" title="Redisåˆ†å¸ƒå¼ é”å¦‚ä½•å®ç°çš„ï¼Œæœ‰æ²¡æœ‰å…œåº•ç­–ç•¥å•¥çš„ï¼Ÿ"></a>Redisåˆ†å¸ƒå¼ é”å¦‚ä½•å®ç°çš„ï¼Œæœ‰æ²¡æœ‰å…œåº•ç­–ç•¥å•¥çš„ï¼Ÿ</h2><p>åŠ é”çš„æ—¶å€™è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè§£é”çš„æ—¶å€™ä½¿ç”¨luaè„šæœ¬ï¼Œç¡®ä¿åˆ¤æ–­é”å­˜åœ¨ï¼Œç„¶ååˆ é™¤é”æ˜¯ä¸€ä¸ªåŸå­æ“ä½œã€‚<br>å…œåº•ç­–ç•¥ï¼šåˆç†çš„è¿‡æœŸæ—¶é—´ï¼Œä½¿ç”¨çœ‹é—¨ç‹—ï¼Œåå°çº¿ç¨‹å®šæœŸæ£€æµ‹ä¸šåŠ¡æ˜¯å¦èƒ½å¤Ÿå®Œæˆï¼Œå»¶é•¿é”çš„æ—¶é—´ï¼Œç§ä¿¡é˜Ÿåˆ—/æ—¥å¿—è®°å½•é”çš„å¼‚å¸¸è¡Œä¸ºï¼Œäººå·¥æ’æŸ¥åå¼ºåˆ¶é‡Šæ”¾<br>çœ‹é—¨ç‹—æœºåˆ¶ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨ç»­æœŸä¸€æ¬¡ï¼Œä¿è¯é”ä¸ä¼šè¿‡æœŸã€‚å¦‚æœçœ‹é—¨ç‹—æ²¡æœ‰åœ¨æŒ‡å®šæ—¶é—´å†…æ”¶åˆ°å¿ƒè·³æ¢å¤ï¼Œä¼šè®¤ä¸ºé”çš„å†™çº¿ç¨‹å·²ç»å‘ç”Ÿäº†æ•…éšœï¼Œä¼šå°½é‡çš„å¤„ç†æ­»é”(å¼ºåˆ¶è§£é”æˆ–è€…è§¦å‘ä¸€ä¸ªå›è°ƒæ–¹æ³•æ¥å¤„ç†æ­»é”)</p>
<h2 id="B-æ ‘çš„ç»“æ„ã€èŠ‚ç‚¹æ˜¯æ€ä¹ˆç»„ç»‡çš„ï¼Œå­˜çš„æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆæ•ˆç‡æ¯”è¾ƒé«˜ï¼Ÿå’ŒBæ ‘çš„åŒºåˆ«ï¼Ÿ"><a href="#B-æ ‘çš„ç»“æ„ã€èŠ‚ç‚¹æ˜¯æ€ä¹ˆç»„ç»‡çš„ï¼Œå­˜çš„æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆæ•ˆç‡æ¯”è¾ƒé«˜ï¼Ÿå’ŒBæ ‘çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="B+æ ‘çš„ç»“æ„ã€èŠ‚ç‚¹æ˜¯æ€ä¹ˆç»„ç»‡çš„ï¼Œå­˜çš„æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆæ•ˆç‡æ¯”è¾ƒé«˜ï¼Ÿå’ŒBæ ‘çš„åŒºåˆ«ï¼Ÿ"></a>B+æ ‘çš„ç»“æ„ã€èŠ‚ç‚¹æ˜¯æ€ä¹ˆç»„ç»‡çš„ï¼Œå­˜çš„æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆæ•ˆç‡æ¯”è¾ƒé«˜ï¼Ÿå’ŒBæ ‘çš„åŒºåˆ«ï¼Ÿ</h2><ol>
<li>éå¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•(é”®å€¼)ï¼Œä¸å­˜å‚¨æ•°æ®ï¼Œæ”¯æŒæ›´å¤šåˆ†æ”¯ï¼Œé™ä½æ ‘çš„é«˜åº¦ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®ï¼Œå¹¶ä¸”é€šè¿‡åŒå‘é“¾è¡¨è¿æ¥ï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢</li>
<li>æ ‘ä½å¯ä»¥å‡å°‘ç£ç›˜I/Oæ¬¡æ•°</li>
<li>Bæ ‘éå¶å­èŠ‚ç‚¹ä¹Ÿå­˜æ•°æ®ï¼Œå¹¶ä¸”æ¯ä¸€å±‚çš„åˆ†æ”¯æ›´å°‘ï¼Œæ ‘æ›´é«˜ï¼Œä¸”æ•°æ®ä¹‹é—´æ²¡æœ‰å½¢æˆé“¾è¡¨ï¼ŒèŒƒå›´æŸ¥è¯¢æ—¶éœ€è¦è¿›è¡Œå›æº¯ã€‚</li>
</ol>
<h2 id="B-æ ‘ä¸€ä¸ªæ•°æ®é¡µå¦‚æœæ»¡äº†ï¼Œä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ"><a href="#B-æ ‘ä¸€ä¸ªæ•°æ®é¡µå¦‚æœæ»¡äº†ï¼Œä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ" class="headerlink" title="B+æ ‘ä¸€ä¸ªæ•°æ®é¡µå¦‚æœæ»¡äº†ï¼Œä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ"></a>B+æ ‘ä¸€ä¸ªæ•°æ®é¡µå¦‚æœæ»¡äº†ï¼Œä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h2><p>ä¼šåˆ†è£‚ä¸ºä¸¤ä¸ªé¡µï¼Œä¸­é—´é”®æå‡åˆ°çˆ¶èŠ‚ç‚¹<br>æµç¨‹ï¼š</p>
<ol>
<li>åˆ›å»ºæ–°é¡µï¼šå³åŠéƒ¨åˆ†ç§»åˆ°æ–°é¡µï¼Œæå–ä¸­é—´é”®(å¦‚åŸè¡¨æœ€åä¸€æ¡æ•°æ®)æ’å…¥çˆ¶èŠ‚ç‚¹ã€‚</li>
<li>æ›´æ–°çˆ¶èŠ‚ç‚¹ç´¢å¼•ï¼šçˆ¶èŠ‚ç‚¹æœªæ»¡ï¼Œç›´æ¥æ’å…¥ä¸­é—´é”®</li>
<li>è‹¥çˆ¶èŠ‚ç‚¹æ»¡ï¼Œåˆ™é€’å½’åˆ†è£‚ï¼šçˆ¶èŠ‚ç‚¹å·²æ»¡ï¼Œé€’å½’è§¦å‘çˆ¶èŠ‚ç‚¹åˆ†è£‚</li>
<li>åˆ†è£‚ä¹‹åç»´æŠ¤åŒå‘é“¾è¡¨ä»¥ä¿è¯é¡ºåºè®¿é—®èƒ½å¤Ÿæ­£å¸¸</li>
</ol>
<h2 id="åˆ†åº“åˆ†è¡¨"><a href="#åˆ†åº“åˆ†è¡¨" class="headerlink" title="åˆ†åº“åˆ†è¡¨"></a>åˆ†åº“åˆ†è¡¨</h2><p>ä½¿ç”¨ShardingSphereæˆ–è€…MyCatï¼Œæ¯”å¦‚å¯ä»¥å°†å¸–å­æŒ‰ç…§æ—¶é—´åˆ†ç‰‡</p>
<h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨WebSocketé€šä¿¡ï¼Œæ•ˆç‡ä¼šæ¯”è¾ƒæ…¢"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨WebSocketé€šä¿¡ï¼Œæ•ˆç‡ä¼šæ¯”è¾ƒæ…¢" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨WebSocketé€šä¿¡ï¼Œæ•ˆç‡ä¼šæ¯”è¾ƒæ…¢"></a>ä¸ºä»€ä¹ˆä½¿ç”¨WebSocketé€šä¿¡ï¼Œæ•ˆç‡ä¼šæ¯”è¾ƒæ…¢</h2><p>æ¡æ‰‹é˜¶æ®µéœ€è¦HTTPå‡çº§ï¼Œå¤´éƒ¨è¾ƒå¤§ï¼Œå¹¶ä¸”ä¼šé•¿æœŸå ç”¨èµ„æºï¼Œé«˜å¹¶å‘æ—¶ä¼šå½±å“æ€§èƒ½</p>
<h2 id="RPCè´Ÿè½½å‡è¡¡çš„è®¾è®¡"><a href="#RPCè´Ÿè½½å‡è¡¡çš„è®¾è®¡" class="headerlink" title="RPCè´Ÿè½½å‡è¡¡çš„è®¾è®¡"></a>RPCè´Ÿè½½å‡è¡¡çš„è®¾è®¡</h2><p>è½®è¯¢ã€ä¸€è‡´æ€§å“ˆå¸Œ(ç›¸åŒè¯·æ±‚å‘½ä¸­å›ºå®šèŠ‚ç‚¹ï¼Œå‡å°‘æ•°æ®è¿ç§»)</p>
<h2 id="ä¸€è‡´æ€§å“ˆå¸Œæ•°æ®è¿ç§»"><a href="#ä¸€è‡´æ€§å“ˆå¸Œæ•°æ®è¿ç§»" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œæ•°æ®è¿ç§»"></a>ä¸€è‡´æ€§å“ˆå¸Œæ•°æ®è¿ç§»</h2><p>ä¸€è‡´æ€§å“ˆå¸Œé€šè¿‡è™šæ‹ŸèŠ‚ç‚¹å’Œå±€éƒ¨è¿ç§»å‡å°‘æ•°æ®ç§»åŠ¨ã€‚ä¾‹å¦‚ï¼Œæ–°å¢èŠ‚ç‚¹æ—¶ï¼Œä»…å½±å“ç›¸é‚»åŒºé—´çš„æ•°æ®ï¼Œ</p>
<ol>
<li>æ–°å¢èŠ‚ç‚¹ï¼š<ul>
<li>å“ˆå¸Œç¯ä¸Šæ’å…¥æ–°èŠ‚ç‚¹çš„å¤šä¸ªè™šæ‹ŸèŠ‚ç‚¹</li>
<li>ä»…è¿ç§»æ–°èŠ‚ç‚¹ä¸é¡ºæ—¶é’ˆç›¸é‚»èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®</li>
</ul>
</li>
<li>åˆ é™¤èŠ‚ç‚¹ï¼š<ol>
<li>ç§»é™¤ç›®æ ‡èŠ‚ç‚¹çš„æ‰€æœ‰è™šæ‹ŸèŠ‚ç‚¹</li>
<li>å°†æ•°æ®è¿ç§»åˆ°é¡ºæ—¶é’ˆä¸‹ä¸€ä¸ªèŠ‚ç‚¹</li>
</ol>
</li>
<li>å®¢æˆ·ç«¯è¿›è¡Œåˆ‡æ¢ï¼Œé€æ­¥å°†è¯·æ±‚è·¯ç”±åˆ°æ–°èŠ‚ç‚¹ï¼Œé¿å…ç¬æ—¶è´Ÿè½½è¿‡é«˜ã€‚</li>
</ol>
<h2 id="è‡ªå®šä¹‰é€šä¿¡åè®®è®¾è®¡ï¼Œå¯¹æ¯”ä¼ ç»Ÿåè®®å¦‚ä½•ï¼Ÿ"><a href="#è‡ªå®šä¹‰é€šä¿¡åè®®è®¾è®¡ï¼Œå¯¹æ¯”ä¼ ç»Ÿåè®®å¦‚ä½•ï¼Ÿ" class="headerlink" title="è‡ªå®šä¹‰é€šä¿¡åè®®è®¾è®¡ï¼Œå¯¹æ¯”ä¼ ç»Ÿåè®®å¦‚ä½•ï¼Ÿ"></a>è‡ªå®šä¹‰é€šä¿¡åè®®è®¾è®¡ï¼Œå¯¹æ¯”ä¼ ç»Ÿåè®®å¦‚ä½•ï¼Ÿ</h2><p>åè®®çš„ç»„æˆï¼š</p>
<ol>
<li>Header<ul>
<li>é­”æ•°ï¼š1å­—èŠ‚</li>
<li>ç‰ˆæœ¬å·ï¼š1å­—èŠ‚</li>
<li>åºåˆ—åŒ–å™¨ï¼š1å­—èŠ‚</li>
<li>æ¶ˆæ¯ç±»å‹ï¼š1å­—èŠ‚</li>
<li>æ¶ˆæ¯çŠ¶æ€ï¼š1å­—èŠ‚</li>
<li>è¯·æ±‚idï¼š8ä¸ªå­—èŠ‚</li>
<li>å‹ç¼©æ–¹å¼ï¼š1å­—èŠ‚</li>
<li>æ¶ˆæ¯ä½“é•¿åº¦ï¼š4å­—èŠ‚</li>
</ul>
</li>
<li>Body(ä»»æ„å†…å®¹ï¼Œå­—èŠ‚)<br>ä¼˜åŠ¿ï¼šæ”¯æŒå¤šç§åºåˆ—åŒ–ä¸å‹ç¼©(å¦‚Gzip)ï¼Œä½¿ç”¨æ›´çµæ´»ï¼Œæ— HTTPå¤´éƒ¨å†—ä½™</li>
</ol>
<h2 id="ä¸ºä»€ä¹ˆTCPæ¯æ¬¡å»ºç«‹è¿æ¥æ—¶åºåˆ—å·ä¸åŒï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆTCPæ¯æ¬¡å»ºç«‹è¿æ¥æ—¶åºåˆ—å·ä¸åŒï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆTCPæ¯æ¬¡å»ºç«‹è¿æ¥æ—¶åºåˆ—å·ä¸åŒï¼Ÿ"></a>ä¸ºä»€ä¹ˆTCPæ¯æ¬¡å»ºç«‹è¿æ¥æ—¶åºåˆ—å·ä¸åŒï¼Ÿ</h2><p>ä¸ºäº†é˜²æ­¢é‡æ”¾æ”»å‡»</p>
<h2 id="time-waitä¸ºä»€ä¹ˆæ˜¯2MSLï¼ŸMSLæ˜¯ä»€ä¹ˆï¼Ÿ-æŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´"><a href="#time-waitä¸ºä»€ä¹ˆæ˜¯2MSLï¼ŸMSLæ˜¯ä»€ä¹ˆï¼Ÿ-æŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´" class="headerlink" title="time_waitä¸ºä»€ä¹ˆæ˜¯2MSLï¼ŸMSLæ˜¯ä»€ä¹ˆï¼Ÿ(æŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´)"></a>time_waitä¸ºä»€ä¹ˆæ˜¯2MSLï¼ŸMSLæ˜¯ä»€ä¹ˆï¼Ÿ(æŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´)</h2><p>MSLè¦å¤§äºç­‰äºTTLæ¶ˆè€—ä¸º0çš„æ—¶é—´<br>MSLæ˜¯æŠ¥æ–‡çš„æœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼Œç½‘ç»œä¸­å¯èƒ½å­˜åœ¨æ¥è‡ªå‘é€æ–¹çš„æ•°æ®è¢«æ¥æ”¶æ–¹å¤„ç†ä¹‹åï¼Œåˆä¼šå‘é€å“åº”ï¼Œä¸€æ¥ä¸€å›æ‰€ä»¥éœ€è¦ç­‰å¾…äºŒå€çš„æ—¶é—´ã€‚</p>
<h2 id="æ‹¥å¡ç®—æ³•"><a href="#æ‹¥å¡ç®—æ³•" class="headerlink" title="æ‹¥å¡ç®—æ³•"></a>æ‹¥å¡ç®—æ³•</h2><ul>
<li><strong>æ…¢å¯åŠ¨</strong>ï¼šåˆå§‹æ‹¥å¡çª—å£æŒ‡æ•°å¢é•¿ã€‚</li>
<li><strong>æ‹¥å¡é¿å…</strong>ï¼šçª—å£çº¿æ€§å¢é•¿ã€‚</li>
<li><strong>å¿«é‡ä¼ </strong>ï¼šæ”¶åˆ°3ä¸ªé‡å¤ACKç«‹å³é‡ä¼ ã€‚</li>
<li><strong>å¿«æ¢å¤</strong>ï¼šçª—å£å‡åŠåè¿›å…¥æ‹¥å¡é¿å…ã€‚</li>
</ul>
<h2 id="é™æµç®—æ³•æœ‰å“ªäº›ï¼Ÿ"><a href="#é™æµç®—æ³•æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="é™æµç®—æ³•æœ‰å“ªäº›ï¼Ÿ"></a>é™æµç®—æ³•æœ‰å“ªäº›ï¼Ÿ</h2><ul>
<li><strong>å›ºå®šçª—å£</strong>ï¼šå•ä½æ—¶é—´é™è¯·æ±‚æ•°ï¼Œç®€å•ä½†ä¸´ç•Œçªå‘ã€‚</li>
<li><strong>æ»‘åŠ¨çª—å£</strong>ï¼šç»†åˆ†æ—¶é—´å—ï¼Œå¹³æ»‘é™æµã€‚</li>
<li><strong>ä»¤ç‰Œæ¡¶</strong>ï¼šåŒ€é€Ÿç”Ÿæˆä»¤ç‰Œï¼Œå…è®¸çªå‘ã€‚</li>
<li><strong>æ¼æ¡¶</strong>ï¼šæ’å®šé€Ÿç‡å¤„ç†ï¼Œå¹³æ»‘æµé‡ã€‚</li>
</ul>
<h2 id="åˆ†ç‰‡ä¸Šä¼ ã€æ–­ç‚¹é‡ä¼ ã€ç§’ä¼ è®¾è®¡çš„ç»†èŠ‚"><a href="#åˆ†ç‰‡ä¸Šä¼ ã€æ–­ç‚¹é‡ä¼ ã€ç§’ä¼ è®¾è®¡çš„ç»†èŠ‚" class="headerlink" title="åˆ†ç‰‡ä¸Šä¼ ã€æ–­ç‚¹é‡ä¼ ã€ç§’ä¼ è®¾è®¡çš„ç»†èŠ‚"></a>åˆ†ç‰‡ä¸Šä¼ ã€æ–­ç‚¹é‡ä¼ ã€ç§’ä¼ è®¾è®¡çš„ç»†èŠ‚</h2><ul>
<li><strong>åˆ†ç‰‡ä¸Šä¼ </strong>ï¼š<ol>
<li>å‰ç«¯å°†æ–‡ä»¶åˆ‡åˆ†ä¸ºå›ºå®šå¤§å°ï¼ˆå¦‚5MBï¼‰ã€‚</li>
<li>æœåŠ¡ç«¯ä¸ºæ¯ä¸ªåˆ†ç‰‡ç”Ÿæˆå”¯ä¸€IDï¼Œå¹¶è¡Œä¸Šä¼ ã€‚</li>
<li>æ‰€æœ‰åˆ†ç‰‡ä¸Šä¼ å®Œæˆååˆå¹¶ã€‚</li>
</ol>
</li>
<li><strong>æ–­ç‚¹ç»­ä¼ </strong>ï¼š<ul>
<li>è®°å½•å·²ä¸Šä¼ åˆ†ç‰‡IDè‡³Redisã€‚</li>
<li>ç»­ä¼ æ—¶è·³è¿‡å·²ä¼ åˆ†ç‰‡ã€‚</li>
</ul>
</li>
<li><strong>ç§’ä¼ </strong><ul>
<li>è®¡ç®—æ–‡ä»¶MD5ä½œä¸ºå”¯ä¸€æ ‡è¯†</li>
<li>ä¸Šä¼ å‰æŸ¥è¯¢æœåŠ¡å™¨æ˜¯å¦å­˜åœ¨ç›¸åŒå“ˆå¸Œ</li>
<li>å¦‚æœå­˜åœ¨ç›´æ¥è¿”å›åœ°å€ï¼Œæ— éœ€é‡å¤ä¸Šä¼ </li>
</ul>
</li>
</ul>
<h2 id="TCPæ»‘åŠ¨çª—å£ç®—æ³•"><a href="#TCPæ»‘åŠ¨çª—å£ç®—æ³•" class="headerlink" title="TCPæ»‘åŠ¨çª—å£ç®—æ³•"></a>TCPæ»‘åŠ¨çª—å£ç®—æ³•</h2><ol>
<li>æ¥æ”¶æ–¹ç»´æŠ¤ä¸€ä¸ªå¯æ¥å—çš„æ•°æ®é‡å¤§å°ï¼Œä¹Ÿå°±æ˜¯æ»‘åŠ¨çª—å£å¤§å°ï¼Œå¹¶ä¸”é€šè¿‡ACKæŠ¥æ–‡æ¥é€šå‘Šå¯¹æ–¹å¤§å°ï¼Œå‘é€æ–¹æ®æ­¤æ¥è°ƒæ•´å‘é€é€Ÿç‡</li>
<li>åŠ¨æ€æ»‘åŠ¨ï¼šæ¯æ”¶åˆ°ä¸€ä¸ªACKçª—å£å‘å‰æ»‘åŠ¨å…è®¸å‘é€æ–°çš„æ•°æ®</li>
<li>æµé‡æ§åˆ¶ï¼šæ¥æ”¶æ–¹é€šè¿‡å‡å°çª—å£ï¼ŒæŠ‘åˆ¶å‘é€æ–¹é€Ÿç‡ï¼Œé˜²æ­¢ç¼“å†²åŒºæº¢å‡º</li>
</ol>
<h2 id="å››æ¬¡æŒ¥æ‰‹æ˜¯å¦å¯ä»¥åˆå¹¶ä¸ºä¸‰æ¬¡"><a href="#å››æ¬¡æŒ¥æ‰‹æ˜¯å¦å¯ä»¥åˆå¹¶ä¸ºä¸‰æ¬¡" class="headerlink" title="å››æ¬¡æŒ¥æ‰‹æ˜¯å¦å¯ä»¥åˆå¹¶ä¸ºä¸‰æ¬¡"></a>å››æ¬¡æŒ¥æ‰‹æ˜¯å¦å¯ä»¥åˆå¹¶ä¸ºä¸‰æ¬¡</h2><p>å¦‚æœè¢«åŠ¨å…³é—­æ–¹æ— æ•°æ®å‘é€ï¼Œå¯å°†FINå’ŒACKåˆå¹¶ï¼Œä¾èµ–å»¶è¿Ÿç¡®è®¤æœºåˆ¶ã€‚<br>å¯èƒ½ä¼šå¯¼è‡´ä¸»åŠ¨å…³é—­æ–¹æ¯æ”¶åˆ°æœ€ç»ˆçš„ACKï¼Œè¢«åŠ¨æ–¹å·²ç»å…³é—­</p>
<h2 id="ç®€å•ä»‹ç»ä¸€ä¸‹PageCache"><a href="#ç®€å•ä»‹ç»ä¸€ä¸‹PageCache" class="headerlink" title="ç®€å•ä»‹ç»ä¸€ä¸‹PageCache"></a>ç®€å•ä»‹ç»ä¸€ä¸‹PageCache</h2><p><strong>PageCacheé€šè¿‡å†…å­˜ç¼“å­˜ç£ç›˜æ•°æ®ï¼ŒåŠ é€Ÿæ–‡ä»¶è®¿é—®ã€‚ä¾‹å¦‚ï¼Œè¯»å–æ–‡ä»¶æ—¶ï¼Œä¼˜å…ˆä»PageCacheè·å–ï¼Œæœªå‘½ä¸­å†è®¿é—®ç£ç›˜ï¼Œç»“åˆé¢„è¯»å’Œå†™å›ä¼˜åŒ–æ•´ä½“æ€§èƒ½ã€‚</strong></p>
<p>å°†é¢‘ç¹è®¿é—®çš„æ–‡ä»¶æ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä»è€Œå‡å°‘ç£ç›˜IOï¼ŒåŒæ—¶å¯ä»¥æ ¹æ®è®¿é—®æ¨¡å¼é¢„åŠ è½½åç»­æ•°æ®ï¼Œæå‡è¯»å–æ•ˆç‡ï¼Œå†™å›æ—¶å¯ä»¥å»¶è¿Ÿç£ç›˜å†™å…¥ï¼Œåˆå¹¶å¤šæ¬¡å†™æ“ä½œï¼Œé™ä½ç£ç›˜IO</p>
<h1 id="2025-02-19-äºŒé¢-20å¤šåˆ†é’Ÿ-ï¼Œé—®äº†ä¸€ç‚¹å®ä¹ ï¼Œè¿˜æœ‰ä¸€ç‚¹è®¡ç½‘ï¼Œç„¶åå†™äº†ä¸ªLRU-ç§’äº†ï¼Œæ€€ç–‘æ˜¯kpi"><a href="#2025-02-19-äºŒé¢-20å¤šåˆ†é’Ÿ-ï¼Œé—®äº†ä¸€ç‚¹å®ä¹ ï¼Œè¿˜æœ‰ä¸€ç‚¹è®¡ç½‘ï¼Œç„¶åå†™äº†ä¸ªLRU-ç§’äº†ï¼Œæ€€ç–‘æ˜¯kpi" class="headerlink" title="2025.02.19 äºŒé¢ (20å¤šåˆ†é’Ÿ ï¼Œé—®äº†ä¸€ç‚¹å®ä¹ ï¼Œè¿˜æœ‰ä¸€ç‚¹è®¡ç½‘ï¼Œç„¶åå†™äº†ä¸ªLRU ç§’äº†ï¼Œæ€€ç–‘æ˜¯kpi)"></a>2025.02.19 äºŒé¢ (20å¤šåˆ†é’Ÿ ï¼Œé—®äº†ä¸€ç‚¹å®ä¹ ï¼Œè¿˜æœ‰ä¸€ç‚¹è®¡ç½‘ï¼Œç„¶åå†™äº†ä¸ªLRU ç§’äº†ï¼Œæ€€ç–‘æ˜¯kpi)</h1><ol>
<li>è‡ªæˆ‘ä»‹ç»</li>
<li>å®ä¹ æ—¶é—´ï¼Œä½•æ—¶åˆ°å²—(ç”»é¥¼è¯´å¦‚æœæœ‰hcçš„å¯ä»¥è½¬æ­£ï¼Œæ„Ÿè§‰çº¯ç”»é¥¼)</li>
<li>å­¦æ ¡å®‰æ’ï¼Œå¦‚ä½•å¤„ç†è€ƒè¯•å•¥çš„</li>
<li>åˆ°å²—æ—¶é—´</li>
<li>å®ä¹ ä»‹ç»</li>
<li>æ‰‹æ’•LRU</li>
<li>åé—®å²—ä½ï¼šç›´æ’­ç»“ç®—ï¼Ÿæ•´ä½“åŸºç¡€ä¸é”™ï¼Œä½†æ˜¯å®ä¹ ç»å†æ¯”è¾ƒå¹³æ·¡</li>
</ol>
<p>åç»­ï¼šæŒ‚äº†</p>
<h2 id="mysqlä¸€æ¬¡æ€§æŸ¥è¯¢200wæ•°æ®ï¼Œmsyqlä¼šå‡ºç°é—®é¢˜ï¼Œæˆ‘è¯¥å¦‚ä½•å¤„ç†ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Œä¸šåŠ¡æ˜¯æ•°æ®æ‰¹å¤„ç†å’ŒåŒæ­¥åˆ°å…¶ä»–æ•°æ®åº“ä¸­ï¼Œå¦‚ä½•ä¿è¯è¿™200wæ¡æ•°æ®çš„ä¸€è‡´æ€§ã€å‡†ç¡®æ€§ã€ç¨³å®šæ€§ã€å®¹é”™å‘¢ï¼Œæ€ä¹ˆæ ·ä¿è¯è¿™ä¸ªæŸ¥è¯¢ä¸ä¼šå½±å“å…¶ä»–æŸ¥è¯¢çš„æ€§èƒ½å‘¢ï¼Ÿ"><a href="#mysqlä¸€æ¬¡æ€§æŸ¥è¯¢200wæ•°æ®ï¼Œmsyqlä¼šå‡ºç°é—®é¢˜ï¼Œæˆ‘è¯¥å¦‚ä½•å¤„ç†ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Œä¸šåŠ¡æ˜¯æ•°æ®æ‰¹å¤„ç†å’ŒåŒæ­¥åˆ°å…¶ä»–æ•°æ®åº“ä¸­ï¼Œå¦‚ä½•ä¿è¯è¿™200wæ¡æ•°æ®çš„ä¸€è‡´æ€§ã€å‡†ç¡®æ€§ã€ç¨³å®šæ€§ã€å®¹é”™å‘¢ï¼Œæ€ä¹ˆæ ·ä¿è¯è¿™ä¸ªæŸ¥è¯¢ä¸ä¼šå½±å“å…¶ä»–æŸ¥è¯¢çš„æ€§èƒ½å‘¢ï¼Ÿ" class="headerlink" title="mysqlä¸€æ¬¡æ€§æŸ¥è¯¢200wæ•°æ®ï¼Œmsyqlä¼šå‡ºç°é—®é¢˜ï¼Œæˆ‘è¯¥å¦‚ä½•å¤„ç†ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Œä¸šåŠ¡æ˜¯æ•°æ®æ‰¹å¤„ç†å’ŒåŒæ­¥åˆ°å…¶ä»–æ•°æ®åº“ä¸­ï¼Œå¦‚ä½•ä¿è¯è¿™200wæ¡æ•°æ®çš„ä¸€è‡´æ€§ã€å‡†ç¡®æ€§ã€ç¨³å®šæ€§ã€å®¹é”™å‘¢ï¼Œæ€ä¹ˆæ ·ä¿è¯è¿™ä¸ªæŸ¥è¯¢ä¸ä¼šå½±å“å…¶ä»–æŸ¥è¯¢çš„æ€§èƒ½å‘¢ï¼Ÿ"></a>mysqlä¸€æ¬¡æ€§æŸ¥è¯¢200wæ•°æ®ï¼Œmsyqlä¼šå‡ºç°é—®é¢˜ï¼Œæˆ‘è¯¥å¦‚ä½•å¤„ç†ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Œä¸šåŠ¡æ˜¯æ•°æ®æ‰¹å¤„ç†å’ŒåŒæ­¥åˆ°å…¶ä»–æ•°æ®åº“ä¸­ï¼Œå¦‚ä½•ä¿è¯è¿™200wæ¡æ•°æ®çš„ä¸€è‡´æ€§ã€å‡†ç¡®æ€§ã€ç¨³å®šæ€§ã€å®¹é”™å‘¢ï¼Œæ€ä¹ˆæ ·ä¿è¯è¿™ä¸ªæŸ¥è¯¢ä¸ä¼šå½±å“å…¶ä»–æŸ¥è¯¢çš„æ€§èƒ½å‘¢ï¼Ÿ</h2><ol>
<li>ä½¿ç”¨åŸºäºæœ‰åºä¸»é”®çš„èŒƒå›´æŸ¥è¯¢WHERE id &gt; last_max_id LIMIT batich_size</li>
<li>æµå¼æŸ¥è¯¢ï¼šä½¿ç”¨JDBC/è¿æ¥å™¨çš„æ¸¸æ ‡ï¼Œæˆ–è€…æœåŠ¡ç«¯æ¸¸æ ‡ï¼Œå‡å°‘å†…å­˜å‹åŠ›</li>
<li>ç´¢å¼•è¦†ç›–ï¼šç¡®ä¿æŸ¥è¯¢ä»…èƒ½é€šè¿‡æ‰€ä»¥å³å¯å®Œæˆé¿å…å›è¡¨</li>
<li>èµ„æºéš”ç¦»ï¼šé€šè¿‡MySQLèµ„æºç»„å’Œä¸­é—´ä»¶é™åˆ¶æŸ¥è¯¢çš„CPU/IOèµ„æº<br>æ•°æ®ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ï¼š</li>
<li>äº‹åŠ¡ä¸æ‰¹æ¬¡æäº¤ï¼šä½¿ç”¨äº‹åŠ¡ä¿è¯å•æ‰¹æ¬¡æ“ä½œçš„åŸå­æ€§ï¼Œåˆ†æ‰¹æäº¤(æ¯1000æ¡æäº¤ä¸€æ¬¡)</li>
<li>å¹‚ç­‰è®¾è®¡ï¼šé€šè¿‡å”¯ä¸€é”®ã€ç‰ˆæœ¬å·é¿å…é‡å¤å¤„ç†</li>
<li>åˆ†å¸ƒå¼é”ï¼šåŒæ­¥æ—¶æ ‡è®°æ­£åœ¨å¤„ç†çš„è®°å½•ï¼Œé˜²æ­¢å¹¶å‘å†²çª</li>
<li>è¡¥å¿æœºåˆ¶ï¼šè®°å½•åŒæ­¥æ—¥å¿—ï¼Œé€šè¿‡å®šæ—¶ä»»åŠ¡ä¿®å¤ä¸ä¸€è‡´æ•°æ®<br>ç¨³å®šæ€§è®¾è®¡ï¼š</li>
<li>ç†”æ–­é™çº§ï¼šæœåŠ¡ä¸­å¼•å…¥ç†”æ–­æœºåˆ¶ï¼Œå¼‚å¸¸æ—¶æš‚åœä»»åŠ¡å¹¶ä¸”å‘Šè­¦</li>
<li>é‡è¯•ç­–ç•¥ï¼šç½‘ç»œæŠ–åŠ¨ä½¿ç”¨æŒ‡æ•°é¿é€€é‡è¯•</li>
<li>å¼‚æ­¥åŒ–å¤„ç†ï¼šå°†æ•°æ®åŒæ­¥ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± æˆ–è€…æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè§£è€¦è¯•è¯•æ€§è¦æ±‚</li>
</ol>
<h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨RocketMQå’ŒKafkaå¯¹æ¯”ï¼Œé€‚åˆåœºæ™¯ï¼ŒRocketMQåº•å±‚æ˜¯å¦‚ä½•åšçš„é¡ºåºä¿éšœçš„"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨RocketMQå’ŒKafkaå¯¹æ¯”ï¼Œé€‚åˆåœºæ™¯ï¼ŒRocketMQåº•å±‚æ˜¯å¦‚ä½•åšçš„é¡ºåºä¿éšœçš„" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨RocketMQå’ŒKafkaå¯¹æ¯”ï¼Œé€‚åˆåœºæ™¯ï¼ŒRocketMQåº•å±‚æ˜¯å¦‚ä½•åšçš„é¡ºåºä¿éšœçš„"></a>ä¸ºä»€ä¹ˆä½¿ç”¨RocketMQå’ŒKafkaå¯¹æ¯”ï¼Œé€‚åˆåœºæ™¯ï¼ŒRocketMQåº•å±‚æ˜¯å¦‚ä½•åšçš„é¡ºåºä¿éšœçš„</h2><p>Kafkaï¼š</p>
<ol>
<li>é«˜ååæ—¥å¿—æµå¤„ç†ï¼Œé€‚åˆå¤§æ•°æ®åœºæ™¯</li>
<li>é¡ºåºæ¶ˆæ¯åªèƒ½ä¿è¯åˆ†åŒºå†…é¡ºåºï¼Œéœ€è¦ä¸šåŠ¡è‡ªè¡Œç®¡ç†åˆ†åŒºé”®<br>RocketMQï¼š</li>
<li>é‡‘èçº§äº‹åŠ¡æ¶ˆæ¯ã€é¡ºåºæ¶ˆæ¯ã€å»¶è¿Ÿæ¶ˆæ¯æ”¯æŒæ›´å¥½</li>
<li>é€šè¿‡MessageQueueé”æœºåˆ¶ä¸¥æ ¼ä¿è¯åŒä¸€é˜Ÿåˆ—çš„é¡ºåºæ€§</li>
<li>æä¾›ä¸¤é˜¶æ®µæäº¤(ç‰ˆæ¶ˆæ¯æœºåˆ¶)ï¼ŒKafkaéœ€è¦è‡ªè¡Œå®ç°ã€‚</li>
</ol>
<h3 id="RocketMQé¡ºåºæ€§çš„å®ç°åŸç†"><a href="#RocketMQé¡ºåºæ€§çš„å®ç°åŸç†" class="headerlink" title="RocketMQé¡ºåºæ€§çš„å®ç°åŸç†"></a>RocketMQé¡ºåºæ€§çš„å®ç°åŸç†</h3><ol>
<li>é˜Ÿåˆ—åˆ†é…ï¼šç”Ÿäº§è€…é€šè¿‡MessageQueueSelectorå°†åŒä¸€ä¸šåŠ¡IDçš„æ¶ˆæ¯å‘é€åˆ°å›ºå®šçš„é˜Ÿåˆ—ä¸­</li>
<li>æ¶ˆè´¹ç«¯ï¼šæ¶ˆè´¹è€…å¯¹é˜Ÿåˆ—åŠ é”ï¼Œå•çº¿ç¨‹é¡ºåºæ¶ˆè´¹</li>
<li>å¤±è´¥é‡è¯•ï¼šè‹¥æŸæ¡æ¶ˆæ¯æ¶ˆè´¹å¤±è´¥ï¼Œä¼šé˜»å¡åç»­æ¶ˆæ¯ç›´åˆ°å¤„ç†æˆåŠŸ</li>
</ol>
<h2 id="MongoDBäº†è§£å’ŒMySQLçš„åŒºåˆ«"><a href="#MongoDBäº†è§£å’ŒMySQLçš„åŒºåˆ«" class="headerlink" title="MongoDBäº†è§£å’ŒMySQLçš„åŒºåˆ«"></a>MongoDBäº†è§£å’ŒMySQLçš„åŒºåˆ«</h2><h2 id="çœ‹é—¨ç‹—çš„åº•å±‚"><a href="#çœ‹é—¨ç‹—çš„åº•å±‚" class="headerlink" title="çœ‹é—¨ç‹—çš„åº•å±‚"></a>çœ‹é—¨ç‹—çš„åº•å±‚</h2><h2 id="æµè§ˆå™¨é”®å…¥URLä¼šå‘ç”Ÿä»€ä¹ˆï¼Œè·¯ç”±è½¬å‘è¿‡ç¨‹ï¼Œæ¯ä¸€å±‚å¦‚ä½•å¯»å€ï¼Œå¦‚ä½•è§£æ•°æ®åŒ…å’ŒåŒ…è£…"><a href="#æµè§ˆå™¨é”®å…¥URLä¼šå‘ç”Ÿä»€ä¹ˆï¼Œè·¯ç”±è½¬å‘è¿‡ç¨‹ï¼Œæ¯ä¸€å±‚å¦‚ä½•å¯»å€ï¼Œå¦‚ä½•è§£æ•°æ®åŒ…å’ŒåŒ…è£…" class="headerlink" title="æµè§ˆå™¨é”®å…¥URLä¼šå‘ç”Ÿä»€ä¹ˆï¼Œè·¯ç”±è½¬å‘è¿‡ç¨‹ï¼Œæ¯ä¸€å±‚å¦‚ä½•å¯»å€ï¼Œå¦‚ä½•è§£æ•°æ®åŒ…å’ŒåŒ…è£…"></a>æµè§ˆå™¨é”®å…¥URLä¼šå‘ç”Ÿä»€ä¹ˆï¼Œè·¯ç”±è½¬å‘è¿‡ç¨‹ï¼Œæ¯ä¸€å±‚å¦‚ä½•å¯»å€ï¼Œå¦‚ä½•è§£æ•°æ®åŒ…å’ŒåŒ…è£…</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">QingQiu</p>
  <div class="site-description" itemprop="description">ä¸ªäººç½‘ç«™ï¼Œå­¦ä¹ è®°å½•ï¼Œé¢è¯•è®°å½•å’Œç»éªŒæ€»ç»“ã€äº’è”ç½‘ä¸­ä¸€å—å±äºè‡ªå·±çš„å°çª</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">62</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Zuofw/zuofw-rpc" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;Zuofw&#x2F;zuofw-rpc" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2022 â€“ 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">QingQiu</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">479k</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  















  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
